---
title: PythonğŸŒˆ
date: 2015-02-10 22:19:59
tags: [python]
toc_min_heading_level: 2
toc_max_heading_level: 5
---

https://github.com/g1879/DrissionPage

https://github.com/VinciGit00/Scrapegraph-ai åŸºäº ai çˆ¬è™«
https://blog.csdn.net/m0_51156601/article/details/126886040 playwright 

https://github.com/crazyguitar/pysheeet?tab=readme-ov-file py å®ç°çš„å°åŠŸèƒ½

https://github.com/vinta/awesome-python

https://www.pythonweekly.com/

https://python-patterns.guide/

https://github.com/faif/python-patterns?utm_source=bestxtools.com

https://github.com/qiandao-today/qiandao ç­¾åˆ°æ¡†æ¶

æŠ€æœ¯æ ˆ Flask ã€peewee ã€Celery ã€MySQL ã€Redis

https://github.com/xuanhun/PythonHackingBook1 é»‘å®¢

https://www.osgeo.cn/python-guide/scenarios/web.html#heroku
https://learnku.com/docs/python-guide/2018/structure/3260#f294d6

https://learnku.com/articles/23010/teach-you-to-read-the-python-open-source-project-code ä»£ç é˜…è¯»

https://github.com/HT524/500LineorLess_CN å®ç°ç®€å•ç³»ç»Ÿ

https://github.com/iswbm/pycharm-guide
https://github.com/iswbm

https://zhuanlan.zhihu.com/p/24132781 ç»éªŒç®€å†

https://github.com/lalor è¿ç»´å¤§ç‰›

https://github.com/jobbole/awesome-python-cn
https://github.com/vinta/awesome-python

https://python-web-guide.readthedocs.io/zh/latest/index.html å·¥ç¨‹å®è·µ ç»éªŒåˆ†äº«

https://learnku.com/docs/python-guide/2018 æŠ€æœ¯æ ˆ

https://bramblexu.com/posts/b1c0cc4f/#toc-heading-5 vscode é…ç½® 


https://www.zhihu.com/question/19827960 æŒ‡çš„å…³æ³¨çš„ç¤¾åŒº

<!--truncate-->

- [ä»‹ç»](#ä»‹ç»)
    - [python ç‰¹ç‚¹](#python-ç‰¹ç‚¹)
    - [å®‰è£… å‡çº§](#å®‰è£…-å‡çº§)
    - [vscode ç¯å¢ƒé…ç½®](#vscode-ç¯å¢ƒé…ç½®)
    - [è®¾ç½®å›½å†…pipæº](#è®¾ç½®å›½å†…pipæº)
    - [è§£é‡Šå™¨](#è§£é‡Šå™¨)
- [python tricks å‘](#python-tricks-å‘)
    - [å‡½æ•°çš„é»˜è®¤å‚æ•°](#å‡½æ•°çš„é»˜è®¤å‚æ•°)
    - [åˆ›å»ºç”Ÿæˆå™¨åŒæ—¶å­˜åœ¨æ¡ä»¶è¿‡æ»¤](#åˆ›å»ºç”Ÿæˆå™¨åŒæ—¶å­˜åœ¨æ¡ä»¶è¿‡æ»¤)
    - [æµ®ç‚¹æ•°æ— æ³•è¢«ç²¾ç¡®è®¡ç®—](#æµ®ç‚¹æ•°æ— æ³•è¢«ç²¾ç¡®è®¡ç®—)
    - [é€’å½’è°ƒç”¨æ— æ³•ä¿è¯è°ƒç”¨çš„æ˜¯è‡ªèº«](#é€’å½’è°ƒç”¨æ— æ³•ä¿è¯è°ƒç”¨çš„æ˜¯è‡ªèº«)
- [è¯­æ³•](#è¯­æ³•)
    - [è¾“å…¥è¾“å‡º æ‰“å° mainé­”æ³•å˜é‡](#è¾“å…¥è¾“å‡º-æ‰“å°-mainé­”æ³•å˜é‡)
    - [åŸºæœ¬æ•°æ®ç±»å‹](#åŸºæœ¬æ•°æ®ç±»å‹)
        - [å­—ç¬¦ä¸²](#å­—ç¬¦ä¸²)
            - [å¤šè¡Œ ä¸å¯å˜ æ¯”è¾ƒ](#å¤šè¡Œ-ä¸å¯å˜-æ¯”è¾ƒ)
            - [å­—ç¬¦ç¼–ç ](#å­—ç¬¦ç¼–ç )
            - [æ ¼å¼åŒ–](#æ ¼å¼åŒ–)
            - [å­—ç¬¦ä¸²å¤„ç†](#å­—ç¬¦ä¸²å¤„ç†)
        - [å­—èŠ‚æ•°ç»„ bytes bytearray](#å­—èŠ‚æ•°ç»„-bytes-bytearray)
        - [æ•°å­—](#æ•°å­—)
        - [å¸ƒå°”å€¼ ç©ºå€¼](#å¸ƒå°”å€¼-ç©ºå€¼)
        - [æ•°ç»„ array](#æ•°ç»„-array)
        - [é›†åˆ](#é›†åˆ)
            - [list æœ‰åºå¯å˜](#list-æœ‰åºå¯å˜)
                - [slices åˆ‡ç‰‡](#slices-åˆ‡ç‰‡)
            - [tuple æœ‰åºä¸å¯å˜åˆ—è¡¨](#tuple-æœ‰åºä¸å¯å˜åˆ—è¡¨)
                - [namedtuple() åˆ›å»ºå¸¦åå­—ä¸‹æ ‡çš„å…ƒç»„](#namedtuple-åˆ›å»ºå¸¦åå­—ä¸‹æ ‡çš„å…ƒç»„)
                - [typeing.NamedTulple å‘½åçš„å…ƒç»„](#typeingnamedtulple-å‘½åçš„å…ƒç»„)
                - [å…ƒç»„è§£åŒ…](#å…ƒç»„è§£åŒ…)
            - [set æ— åºä¸å¯é‡å¤](#set-æ— åºä¸å¯é‡å¤)
                - [frosenset ä¸å¯å˜set](#frosenset-ä¸å¯å˜set)
            - [deque åŒç«¯é˜Ÿåˆ— æ ˆ](#deque-åŒç«¯é˜Ÿåˆ—-æ ˆ)
            - [queue.Queue é˜»å¡é˜Ÿåˆ—](#queuequeue-é˜»å¡é˜Ÿåˆ—)
            - [queue.LifoQueue é˜»å¡æ ˆ](#queuelifoqueue-é˜»å¡æ ˆ)
            - [multiprocessing.Queue è·¨è¿›ç¨‹é˜»å¡é˜Ÿåˆ—](#multiprocessingqueue-è·¨è¿›ç¨‹é˜»å¡é˜Ÿåˆ—)
            - [queue.PriorityQueue heapq ä¼˜å…ˆçº§é˜Ÿåˆ—](#queuepriorityqueue-heapq-ä¼˜å…ˆçº§é˜Ÿåˆ—)
        - [å­—å…¸ dict](#å­—å…¸-dict)
            - [åŸºæœ¬ dict](#åŸºæœ¬-dict)
            - [å­—å…¸è§£åŒ…](#å­—å…¸è§£åŒ…)
            - [å­—å…¸æ ¼å¼åŒ–](#å­—å…¸æ ¼å¼åŒ–)
            - [defaultdict é»˜è®¤å€¼dict](#defaultdict-é»˜è®¤å€¼dict)
            - [OrderedDict å­—å…¸æ’åº](#ordereddict-å­—å…¸æ’åº)
            - [åˆå¹¶å¤šä¸ªå­—å…¸](#åˆå¹¶å¤šä¸ªå­—å…¸)
                - [å†…ç½®æ–¹æ³•åˆå¹¶](#å†…ç½®æ–¹æ³•åˆå¹¶)
                - [ChainMap æä¾›åŠ¨æ€è§†å›¾ é¦–ä¸ª dict å¯ä¿®æ”¹](#chainmap-æä¾›åŠ¨æ€è§†å›¾-é¦–ä¸ª-dict-å¯ä¿®æ”¹)
            - [MappingProxyType åªè¯»è§†å›¾](#mappingproxytype-åªè¯»è§†å›¾)
            - [Counter é€šè¿‡å­—å…¸è¡¨ç¤ºåˆ—è¡¨](#counter-é€šè¿‡å­—å…¸è¡¨ç¤ºåˆ—è¡¨)
            - [dict åœºæ™¯](#dict-åœºæ™¯)
                - [æ¨¡æ‹Ÿ switch case](#æ¨¡æ‹Ÿ-switch-case)
            - [dict å­—å…¸æ¨å¯¼å¼](#dict-å­—å…¸æ¨å¯¼å¼)
        - [åˆ—è¡¨æ¨å¯¼å¼](#åˆ—è¡¨æ¨å¯¼å¼)
        - [ç”Ÿæˆå™¨ generator](#ç”Ÿæˆå™¨-generator)
        - [è¿­ä»£å™¨](#è¿­ä»£å™¨)
        - [äºŒè¿›åˆ¶ç»“æ„å°åŒ…è§£åŒ…](#äºŒè¿›åˆ¶ç»“æ„å°åŒ…è§£åŒ…)
        - [SimpleNamespace åˆ›å»ºç®€å•ç±»](#simplenamespace-åˆ›å»ºç®€å•ç±»)
        - [container å®¹å™¨](#container-å®¹å™¨)
    - [ä½œç”¨åŸŸ](#ä½œç”¨åŸŸ)
    - [æ¡ä»¶å¾ªç¯](#æ¡ä»¶å¾ªç¯)
    - [æ¯”è¾ƒåˆ¤æ–­](#æ¯”è¾ƒåˆ¤æ–­)
    - [å‡½æ•°](#å‡½æ•°)
        - [å†…ç½®å‡½æ•°](#å†…ç½®å‡½æ•°)
        - [å‚æ•°æ£€æŸ¥](#å‚æ•°æ£€æŸ¥)
        - [å¤šç§å‚æ•°](#å¤šç§å‚æ•°)
        - [é€’å½’](#é€’å½’)
        - [é«˜é˜¶å‡½æ•°](#é«˜é˜¶å‡½æ•°)
    - [æ–‡ä»¶å¤„ç†](#æ–‡ä»¶å¤„ç†)
        - [åˆ›å»ºæ–‡ä»¶](#åˆ›å»ºæ–‡ä»¶)
        - [è¯»å†™æ–‡ä»¶æ•°æ®](#è¯»å†™æ–‡ä»¶æ•°æ®)
    - [è£…é¥°å™¨ decorator](#è£…é¥°å™¨-decorator)
        - [è£…é¥°å™¨ä»‹ç»](#è£…é¥°å™¨ä»‹ç»)
        - [ç±»è£…é¥°å™¨](#ç±»è£…é¥°å™¨)
        - [æ¡ˆä¾‹: å¤±è´¥é‡è¯•](#æ¡ˆä¾‹-å¤±è´¥é‡è¯•)
        - [æ¡ˆä¾‹: ä¾èµ–æ³¨å…¥](#æ¡ˆä¾‹-ä¾èµ–æ³¨å…¥)
    - [é¢å‘å¯¹è±¡](#é¢å‘å¯¹è±¡)
        - [ç±» å¯¹è±¡](#ç±»-å¯¹è±¡)
        - [æè¿°å™¨](#æè¿°å™¨)
            - [æè¿°å™¨ä»‹ç»](#æè¿°å™¨ä»‹ç»)
            - [å±æ€§çš„æŸ¥è¯¢é“¾è·¯é¡ºåº](#å±æ€§çš„æŸ¥è¯¢é“¾è·¯é¡ºåº)
            - [æ¡ˆä¾‹: è®°å½•å±æ€§è®¿é—®æ—¥å¿—](#æ¡ˆä¾‹-è®°å½•å±æ€§è®¿é—®æ—¥å¿—)
            - [æ¡ˆä¾‹: å±æ€§æ ¡éªŒ](#æ¡ˆä¾‹-å±æ€§æ ¡éªŒ)
            - [æ¡ˆä¾‹: ç®€åŒ–å±æ€§çš„å®šä¹‰](#æ¡ˆä¾‹-ç®€åŒ–å±æ€§çš„å®šä¹‰)
            - [æ¡ˆä¾‹: ç®€å•çš„ orm](#æ¡ˆä¾‹-ç®€å•çš„-orm)
            - [æ¡ˆä¾‹: å®ç°å±æ€§æ‡’åŠ è½½](#æ¡ˆä¾‹-å®ç°å±æ€§æ‡’åŠ è½½)
        - [ç»§æ‰¿ é¸­å­ç±»å‹](#ç»§æ‰¿-é¸­å­ç±»å‹)
        - [åˆ¤æ–­ç±»å‹ä¿¡æ¯](#åˆ¤æ–­ç±»å‹ä¿¡æ¯)
        - [åŠ¨æ€æ“ä½œ](#åŠ¨æ€æ“ä½œ)
        - [æšä¸¾](#æšä¸¾)
        - [å¯¹è±¡å…‹éš† æ‹·è´ shadow-copy deep-copy](#å¯¹è±¡å…‹éš†-æ‹·è´-shadow-copy-deep-copy)
        - [abcæ¨¡å— å®šä¹‰æŠ½è±¡åŸºç±»](#abcæ¨¡å—-å®šä¹‰æŠ½è±¡åŸºç±»)
    - [æ•°æ®ç±»](#æ•°æ®ç±»)
        - [@dataclass åˆ›å»ºå®ä½“ç±»](#dataclass-åˆ›å»ºå®ä½“ç±»)
        - [hashç­–ç•¥](#hashç­–ç•¥)
    - [å…ƒç±» Metaclass](#å…ƒç±»-metaclass)
    - [é”™è¯¯å¼‚å¸¸å¤„ç†](#é”™è¯¯å¼‚å¸¸å¤„ç†)
        - [ç³»ç»Ÿå†…ç½®çš„å¼‚å¸¸](#ç³»ç»Ÿå†…ç½®çš„å¼‚å¸¸)
        - [å¼‚å¸¸æ•è·æŠ›å‡º](#å¼‚å¸¸æ•è·æŠ›å‡º)
        - [è‡ªå®šä¹‰å¼‚å¸¸](#è‡ªå®šä¹‰å¼‚å¸¸)
    - [é­”æœ¯æ–¹æ³•](#é­”æœ¯æ–¹æ³•)
        - [åˆ›å»º `__new__`](#åˆ›å»º-__new__)
        - [åˆå§‹åŒ– `__init__` `__post_init__`](#åˆå§‹åŒ–-__init__-__post_init__)
        - [`__del__`](#__del__)
        - [`__exit__` è‡ªåŠ¨å…³é—­å›æ”¶](#__exit__-è‡ªåŠ¨å…³é—­å›æ”¶)
        - [å¯è¿­ä»£ `__iter__`](#å¯è¿­ä»£-__iter__)
        - [å¯è°ƒç”¨å¯¹è±¡å®ä¾‹ `__call__`](#å¯è°ƒç”¨å¯¹è±¡å®ä¾‹-__call__)
        - [å±æ€§ç›‘æ§å›è°ƒ `__getattr__` `__getattribute__`](#å±æ€§ç›‘æ§å›è°ƒ-__getattr__-__getattribute__)
        - [å¯è¿ç®— æ“ä½œç¬¦é‡è½½](#å¯è¿ç®—-æ“ä½œç¬¦é‡è½½)
            - [åŠ å‡ä¹˜é™¤](#åŠ å‡ä¹˜é™¤)
            - [ç›¸ç­‰æ¯”è¾ƒ `==`, `is`, `__eq__`, ` id()`](#ç›¸ç­‰æ¯”è¾ƒ--is-__eq__--id)
        - [æ‰“å°æ ¼å¼åŒ–  `__str__` `__repr__`](#æ‰“å°æ ¼å¼åŒ–--__str__-__repr__)
        - [ç±»å‹è½¬æ¢ `__bool__`](#ç±»å‹è½¬æ¢-__bool__)
- [æ ‡å‡†åº“](#æ ‡å‡†åº“)
    - [æ—¥æœŸå¤„ç†](#æ—¥æœŸå¤„ç†)
- [è®¾è®¡æ¨¡å¼ design pattern](#è®¾è®¡æ¨¡å¼-design-pattern)
    - [ä»£ç†æ¨¡å¼ proxy](#ä»£ç†æ¨¡å¼-proxy)
    - [å·¥å‚æ¨¡å¼ factory](#å·¥å‚æ¨¡å¼-factory)
    - [å•ä¾‹æ¨¡å¼ singleton](#å•ä¾‹æ¨¡å¼-singleton)
- [å·¥ç¨‹åŒ–](#å·¥ç¨‹åŒ–)
    - [ä¾èµ–æ³¨å…¥](#ä¾èµ–æ³¨å…¥)
    - [cookiecutter é¡¹ç›®æ¨¡æ¿](#cookiecutter-é¡¹ç›®æ¨¡æ¿)
    - [Setuptools: ç®¡ç†ä¾èµ–ã€æ„å»ºå’Œå‘å¸ƒ](#setuptools-ç®¡ç†ä¾èµ–æ„å»ºå’Œå‘å¸ƒ)
    - [è™šæ‹Ÿç¯å¢ƒ virtual environment](#è™šæ‹Ÿç¯å¢ƒ-virtual-environment)
    - [devops æ„å»ºæµæ°´çº¿](#devops-æ„å»ºæµæ°´çº¿)
    - [å‘å¸ƒè‡ªå®šä¹‰åº“](#å‘å¸ƒè‡ªå®šä¹‰åº“)
    - [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
    - [æ¨¡å— import](#æ¨¡å—-import)
        - [æ¨¡å—ç®€ä»‹](#æ¨¡å—ç®€ä»‹)
            - [æ¨¡å—æœç´¢è·¯å¾„](#æ¨¡å—æœç´¢è·¯å¾„)
            - [importåŸç† æ¨¡å—æŸ¥è¯¢é“¾è·¯](#importåŸç†-æ¨¡å—æŸ¥è¯¢é“¾è·¯)
            - [è‡ªå®šä¹‰å¯¼å…¥å™¨](#è‡ªå®šä¹‰å¯¼å…¥å™¨)
        - [åŒ…å†…èµ„æº `importlib.resources`](#åŒ…å†…èµ„æº-importlibresources)
        - [å»¶è¿Ÿå¯¼å…¥ lazy import](#å»¶è¿Ÿå¯¼å…¥-lazy-import)
        - [åŠ¨æ€å¯¼å…¥ å®ç°æ’ä»¶æ¨¡å¼](#åŠ¨æ€å¯¼å…¥-å®ç°æ’ä»¶æ¨¡å¼)
        - [å¯¼å…¥é’©å­ import hook](#å¯¼å…¥é’©å­-import-hook)
        - [path hook](#path-hook)
    - [`__main__` `__name__` `__file__`](#__main__-__name__-__file__)
    - [type hints ç±»å‹æç¤º](#type-hints-ç±»å‹æç¤º)
    - [linter å·¥å…·](#linter-å·¥å…·)
    - [ä¾èµ–å®‰å…¨æ€§æ£€æŸ¥](#ä¾èµ–å®‰å…¨æ€§æ£€æŸ¥)
    - [ä»£ç é£æ ¼ æ ¼å¼åŒ–](#ä»£ç é£æ ¼-æ ¼å¼åŒ–)
    - [é…ç½®æ–‡ä»¶ç®¡ç†](#é…ç½®æ–‡ä»¶ç®¡ç†)
    - [æµ‹è¯•test](#æµ‹è¯•test)
        - [å•å…ƒæµ‹è¯•](#å•å…ƒæµ‹è¯•)
        - [æ€§èƒ½å‹æµ‹](#æ€§èƒ½å‹æµ‹)
        - [é›†æˆæµ‹è¯• integration test](#é›†æˆæµ‹è¯•-integration-test)
    - [åŒ…ç®¡ç†](#åŒ…ç®¡ç†)
        - [rye ä½¿ç”¨](#rye-ä½¿ç”¨)
        - [uv](#uv)
    - [æ—¥å¿—](#æ—¥å¿—)
    - [ç”Ÿæˆæ–‡æ¡£](#ç”Ÿæˆæ–‡æ¡£)
- [å¹¶å‘](#å¹¶å‘)
    - [GIL ç®€ä»‹](#gil-ç®€ä»‹)
    - [å¤šçº¿ç¨‹](#å¤šçº¿ç¨‹)
    - [å¤šè¿›ç¨‹](#å¤šè¿›ç¨‹)
    - [å¯å˜ ä¸å¯å˜](#å¯å˜-ä¸å¯å˜)
- [å¼‚æ­¥ åç¨‹](#å¼‚æ­¥-åç¨‹)
    - [yield æ‰‹åŠ¨åˆ‡æ¢](#yield-æ‰‹åŠ¨åˆ‡æ¢)
    - [gevent è‡ªåŠ¨åˆ‡æ¢](#gevent-è‡ªåŠ¨åˆ‡æ¢)
- [ç¼–å†™å‘½ä»¤è¡Œç¨‹åº](#ç¼–å†™å‘½ä»¤è¡Œç¨‹åº)
    - [å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨](#å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨)
- [è°ƒè¯•](#è°ƒè¯•)
    - [æ–­è¨€](#æ–­è¨€)
    - [è®¾ç½®æ–­ç‚¹ pdb](#è®¾ç½®æ–­ç‚¹-pdb)
- [jinja2 æ¨¡æ¿](#jinja2-æ¨¡æ¿)
- [è·¯å¾„é—®é¢˜](#è·¯å¾„é—®é¢˜)
    - [æ–‡ä»¶è·¯å¾„ and ç»ˆç«¯è·¯å¾„](#æ–‡ä»¶è·¯å¾„-and-ç»ˆç«¯è·¯å¾„)
    - [è·å–è„šæœ¬ä½ç½®](#è·å–è„šæœ¬ä½ç½®)
- [shutil ä½¿ç”¨](#shutil-ä½¿ç”¨)
- [web å¼€å‘](#web-å¼€å‘)
    - [ç”¨Pythonå†™ui](#ç”¨pythonå†™ui)
    - [litestar](#litestar)
    - [fastapi](#fastapi)
    - [Django](#django)
    - [flask](#flask)
        - [flaskè§£å†³è·¨åŸŸé—®é¢˜](#flaskè§£å†³è·¨åŸŸé—®é¢˜)
        - [ä¿æŠ¤ flask api](#ä¿æŠ¤-flask-api)
        - [å‘½ä»¤è¡Œor idea å¯åŠ¨](#å‘½ä»¤è¡Œor-idea-å¯åŠ¨)
        - [rest api](#rest-api)
        - [æ•°æ®åº“äº¤äº’](#æ•°æ®åº“äº¤äº’)
        - [flask ä¸­çš„æ—¥å¿—](#flask-ä¸­çš„æ—¥å¿—)
        - [blueprintè“å›¾ æ¨¡å—åŒ–å¼€å‘](#blueprintè“å›¾-æ¨¡å—åŒ–å¼€å‘)
        - [ä¸Šä¸‹æ–‡å¯¹è±¡](#ä¸Šä¸‹æ–‡å¯¹è±¡)
- [db é©±åŠ¨ é—®é¢˜](#db-é©±åŠ¨-é—®é¢˜)
- [çˆ¬è™« spider crawler](#çˆ¬è™«-spider-crawler)
- [ä»£æ›¿ shell è¿ç»´](#ä»£æ›¿-shell-è¿ç»´)
    - [å®ç”¨è„šæœ¬](#å®ç”¨è„šæœ¬)
        - [å‘½ä»¤è¡Œå‚æ•°è§£æ](#å‘½ä»¤è¡Œå‚æ•°è§£æ)
        - [è·¯å¾„](#è·¯å¾„)
        - [æ–‡ä»¶æ“ä½œ](#æ–‡ä»¶æ“ä½œ)
        - [sh å‘½ä»¤æ‰§è¡Œ](#sh-å‘½ä»¤æ‰§è¡Œ)
    - [ä¼ é€’å‘½ä»¤è¡Œå‚æ•°](#ä¼ é€’å‘½ä»¤è¡Œå‚æ•°)
    - [shell è°ƒç”¨ Python](#shell-è°ƒç”¨-python)
        - [shel è¯»å– Python å‡½æ•°è¿”å›å€¼](#shel-è¯»å–-python-å‡½æ•°è¿”å›å€¼)
        - [ç»Ÿè®¡å‡ºç°æ¬¡æ•°](#ç»Ÿè®¡å‡ºç°æ¬¡æ•°)
        - [è¯»å– csv æ–‡ä»¶](#è¯»å–-csv-æ–‡ä»¶)
    - [Python è°ƒç”¨ shell](#python-è°ƒç”¨-shell)
        - [subprocess](#subprocess)
        - [os.system](#ossystem)
        - [os.popen](#ospopen)
        - [system](#system)
        - [sh](#sh)
        - [paramiko](#paramiko)
    - [éƒ¨ç½² springboot](#éƒ¨ç½²-springboot)
- [å¼€æºåº“](#å¼€æºåº“)
    - [æ—¥æœŸæ—¶é—´](#æ—¥æœŸæ—¶é—´)
    - [çˆ¬è™« crawler](#çˆ¬è™«-crawler)
    - [å˜å£° è¯­éŸ³åˆæˆ](#å˜å£°-è¯­éŸ³åˆæˆ)
    - [ç³»ç»Ÿè¿ç»´](#ç³»ç»Ÿè¿ç»´)
    - [å£°éŸ³](#å£°éŸ³)
    - [å›¾åƒ](#å›¾åƒ)
    - [æ•°æ®æ¨¡å‹å®šä¹‰](#æ•°æ®æ¨¡å‹å®šä¹‰)
    - [åºåˆ—åŒ–ååºåˆ—åŒ–](#åºåˆ—åŒ–ååºåˆ—åŒ–)
    - [åš web å¼€å‘](#åš-web-å¼€å‘)
- [è°ƒJava](#è°ƒjava)
    - [jpype](#jpype)
    - [jython](#jython)
- [è°ƒç”¨ rust](#è°ƒç”¨-rust)
- [cffi ç»‘å®š](#cffi-ç»‘å®š)
- [webåº”ç”¨éƒ¨ç½²](#webåº”ç”¨éƒ¨ç½²)
    - [ç”Ÿæˆä¾èµ–æ¸…å•](#ç”Ÿæˆä¾èµ–æ¸…å•)
    - [gunicorn](#gunicorn)
    - [supervisord ç®¡ç† daemon](#supervisord-ç®¡ç†-daemon)
    - [pm2](#pm2)
- [setup.py](#setuppy)
- [wheel](#wheel)
- [è‡ªåŠ¨æŠ¢è´­è„šæœ¬](#è‡ªåŠ¨æŠ¢è´­è„šæœ¬)



# ä»‹ç»

## python ç‰¹ç‚¹

python ä½œä¸ºè„šæœ¬è¯­è¨€, æ–¹æ³•å®šä¹‰è°ƒç”¨æœ‰å‰åé¡ºåº

åº“å¤š

èƒ¶æ°´è¯­è¨€, cpp äº¤äº’æ–¹ä¾¿

é¢å‘å¯¹è±¡, ç±»ä¼¼ ruby, ä½†æ˜¯æ²¡æœ‰ ruby é¢å‘å¯¹è±¡çº¯ç²¹


## å®‰è£… å‡çº§

wls é»˜è®¤è£…çš„æ˜¯ python2

```sh
# æ›´æ–°æº
apt-get update
# å®‰è£… (æˆ‘çš„wls æ˜¯ Ubuntu)
apt-get install python3
# éªŒè¯
python3 --version


```

å‡çº§

https://www.cnblogs.com/dotnetcrazy/p/9360831.html

http://npm.taobao.org/mirrors Python å‹ç¼©åŒ…é•œåƒä¸‹è½½


```sh
wget http://npm.taobao.org/mirrors/python/3.9.4/Python-3.9.4.tgz
tar -xzvf Python-3.9.4.tgz
# è®¾ç½®ä¸€ä¸‹é…ç½®æ–‡ä»¶
cd Pythonxxx
./configure prefix=/usr/local/python3.7
# centos
# ï¼ˆyumå®‰è£…æ²¡æœ‰aptå®‰è£…æ–¹ä¾¿ï¼‰
make && make install
# è®¾ç½®è½¯é“¾æ¥ï¼š
ln -s /usr/local/python3/bin/python3 /usr/bin/python3



```

## vscode ç¯å¢ƒé…ç½®


[wsl ä¸­ä½¿ç”¨ vscode](https://code.visualstudio.com/docs/remote/wsl#_getting-started)

[wsl install python3.7, ä¿®æ”¹å¿«æ·æ–¹å¼](https://blog.csdn.net/u014775723/article/details/85213793)

```sh
# install python
sudo apt-get install python3.7
# check py version
python3 --version
# install pip3
apt-get install python3-pip
# check pip version
pip3 --version

```

vscode å®‰è£…å®Œ python æ’ä»¶å, ä¼šæœ‰ pylint (åŒç±» flake8) æ’ä»¶å®‰è£…æç¤º, ä¹Ÿå¯èƒ½æ²¡æœ‰ pylint å®‰è£…æç¤º, é‚£ä¹ˆéœ€è¦æ‰‹åŠ¨è®¾ç½® `.vscode/settings.json`:

(pylint æ¯” flake8 æ›´ä¸¥æ ¼ï¼Œé—®é¢˜æè¿°ä¹Ÿæ›´ç²¾å‡†ï¼Œé€Ÿåº¦è¾ƒåè€…æ…¢ä¸€äº›ã€‚pylint çš„ä¸¥æ ¼ä¸å¦‚è¯´æœ‰äº›ä¸¥è‹›äº†ï¼Œç»å¸¸å•°é‡Œå•°å—¦æŠ¥å‡ºä¸€å¤§ä¸²é—®é¢˜ï¼Œæ ¹æ®åœºæ™¯ä¸åŒï¼Œå¯èƒ½éœ€è¦é…ç½®è®¸å¤šå¿½ç•¥é¡¹)

```json
"python.pythonPath": "/usr/bin/python",
  "python.linting.pylintEnabled": true,
  "python.linting.enabled": true
```

autopep8 æ ¼å¼åŒ–ä»£ç åº“, vscode ä¼šè‡ªåŠ¨æç¤º (åŒç±»æ˜¯ black, yapf)

Coverage æœ‰å¤šç§å‘ä½ æŠ¥å‘Šæµ‹è¯•è¦†ç›–ç‡çš„æ–¹å¼ï¼ŒåŒ…æ‹¬å°†ç»“æœè¾“å‡ºåˆ°æ§åˆ¶å°æˆ– HTML é¡µé¢ï¼Œå¹¶æç¤ºå“ªäº›è¡Œå·æ²¡æœ‰è¦†ç›–åˆ°ã€‚ä½ å¯ä»¥è®¾ç½®é…ç½®æ–‡ä»¶ä»¥è‡ªå®šä¹‰ Coverage æ£€æŸ¥çš„å†…å®¹å¹¶ä½¿å…¶æ›´ä¾¿äºè¿è¡Œ

## è®¾ç½®å›½å†…pipæº

```
sudo vim ~/.pip/pip.conf  

[global] 
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
[install]
trusted-host = https://pypi.tuna.tsinghua.edu.cn  # trusted-host æ­¤å‚æ•°æ˜¯ä¸ºäº†é¿å…éº»çƒ¦ï¼Œå¦åˆ™ä½¿ç”¨çš„æ—¶å€™å¯èƒ½ä¼šæç¤ºä¸å—ä¿¡ä»»

```

or

https://mirrors.tuna.tsinghua.edu.cn/help/pypi/


```
é˜¿é‡Œäº‘ http://mirrors.aliyun.com/pypi/simple/

ä¸­å›½ç§‘æŠ€å¤§å­¦ https://pypi.mirrors.ustc.edu.cn/simple/

è±†ç“£(douban) http://pypi.douban.com/simple/ æ¸…åå¤§å­¦

https://pypi.tuna.tsinghua.edu.cn/simple/ ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦

http://pypi.mirrors.ustc.edu.cn/simple/

```


## è§£é‡Šå™¨

CPython (é»˜è®¤)

PyPy, é‡‡ç”¨ JIT æŠ€æœ¯ï¼Œå¯¹ Python ä»£ç è¿›è¡ŒåŠ¨æ€ç¼–è¯‘, PyPy å’Œ CPython æœ‰ä¸€äº›æ˜¯ä¸åŒçš„ï¼Œè¿™å°±å¯¼è‡´ç›¸åŒçš„ Python ä»£ç åœ¨ä¸¤ç§è§£é‡Šå™¨ä¸‹æ‰§è¡Œå¯èƒ½ä¼šæœ‰ä¸åŒçš„ç»“æœ

Jython, ç›´æ¥æŠŠ Python ä»£ç ç¼–è¯‘æˆ Java å­—èŠ‚ç æ‰§è¡Œ

IronPython, æŠŠ Python ä»£ç ç¼–è¯‘æˆ.Net çš„å­—èŠ‚ç ã€‚

å¦‚æœè¦å’Œ Java æˆ–.Net å¹³å°äº¤äº’ï¼Œæœ€å¥½çš„åŠæ³•ä¸æ˜¯ç”¨ Jython æˆ– IronPythonï¼Œè€Œæ˜¯é€šè¿‡ç½‘ç»œè°ƒç”¨æ¥äº¤äº’ï¼Œç¡®ä¿å„ç¨‹åºä¹‹é—´çš„ç‹¬ç«‹æ€§ã€‚


# python tricks å‘

## å‡½æ•°çš„é»˜è®¤å‚æ•°

```python
# è‹¥å‡½æ•°æœ‰é»˜è®¤å‚æ•°, è¦å°å¿ƒè¿™ä¸ªå‘
# åœ¨ Python ä¸­, é»˜è®¤å‚æ•°è¡¨è¾¾å¼, é‚£åªä¼šè¢«æ±‚å€¼ä¸€æ¬¡, æ— è®ºè¢« call å¤šå°‘æ¬¡, éƒ½ä¼šä½¿ç”¨è¿™åŒä¸ªå€¼çš„å¼•ç”¨

class Person():
    def __init__(self, name: str, items: list[str]=[]):
        self.name = name
        self.items = items

per1 = Person('her')
per2 = Person('me')

per1.items.append('aa')
per2.items.append('bb')
print(per1.items) # ['aa', 'bb']    ??



# å¦‚ä½•ä¿®å¤:
# é»˜è®¤å€¼ä¸è¦ç»™æ¯ä½“è¡¨è¾¾å¼, ç»™ä¸ª none, ç„¶åæ ¹æ®æƒ…å†µæ‰‹åŠ¨èµ‹å€¼
class Person():
    def __init__(self, name: str, items: list[str]=None):
        self.name = name
        self.items = [] if items is None else items
```


## åˆ›å»ºç”Ÿæˆå™¨åŒæ—¶å­˜åœ¨æ¡ä»¶è¿‡æ»¤

```python


source_list = [0, 1, 2]
white_list = [0, 1]
# åˆ›å»ºç”Ÿæˆå™¨æ—¶, source_list ç›¸å½“äºä¼ çš„ä¸€ä¸ªæ•°æ®å‰¯æœ¬è¿›å…¥ç”Ÿæˆå™¨çš„æ„é€ å‡½æ•°çš„, å–å€¼åœ¨ä¼ å…¥çš„ä¸€ç¬é—´å°±è¢«å›ºå®šäº†
# è€Œ white_list æ˜¯åœ¨æ„é€ å‡½æ•°å†…éƒ¨ä½¿ç”¨çš„ä¸€ä¸ªå…¨å±€å˜é‡, å–å€¼ä¼šå®æ—¶å˜åŒ–
g = (i for i in source_list if i in white_list)

# so æ­¤å¤„å³ä½¿ source è¢«æ”¹å˜äº†, ä¹Ÿä¸å½±ç”Ÿæˆå™¨è¾“å‡º
source_list = [3]  
print(list(g))  # [0, 1]

# ç”±äºç”Ÿæˆå™¨å†…éƒ¨çš„ white_list å®æ—¶å˜åŒ–, æ‰€ä»¥ä¼šå½±å“ç”Ÿæˆå™¨è¾“å‡º
white_list = [3]
prit(list(g)) # []





```

## æµ®ç‚¹æ•°æ— æ³•è¢«ç²¾ç¡®è®¡ç®—

```python
a = 0.1 + 0.2
b = 0.3
print( a == b) # false
# å¦‚ä½•æ¯”è¾ƒ?
print(abs(a - b) <= 0.0001) #true

#  1e50 é»˜è®¤ä¼šè½¬æˆ float, 10**50 ä¼šè¢«å½“æˆ big integer
# float æ˜¯ä¸ç²¾ç¡®çš„, è€Œ integer è‚¯å®šæ˜¯ç²¾ç¡®çš„, æ‰€ä»¥ä¸ç­‰
print(1e50 == 10 ** 50) # false

print(1e500) # inf  è¡¨ç¤ºæ— ç©·

import math
print(math.isinf(1e500)) # true
print(math.isnan(1e500 / 1e500)) # true
```

## é€’å½’è°ƒç”¨æ— æ³•ä¿è¯è°ƒç”¨çš„æ˜¯è‡ªèº«

```python

def fib(n):
    if n < 2:
        return 1
    return fib(n - 1) + fib(n - 2)

print(fib(5)) # 8 æ­£å¸¸

def g(n):
    return 0
f = fib
fib = g  # fib è¢«æ”¹å˜äº†, é€’å½’è°ƒç”¨é‡Œ, æ‰çš„ fib å˜æˆ g å‡½æ•°äº†
print(f(5))  # 0   ??




# å¦‚ä½•ä¿®å¤
# å°†é€’å½’é€»è¾‘å°è£…æˆé—­åŒ…, å¤–éƒ¨æ— æ³•ä¿®æ”¹è¿™æ®µé€»è¾‘
def fib(n):
    def _fib(x):
        if x < 2:
            return 1
        return _fib(x - 1) + _fib(x - 2)
    return _fib(n)

```


# è¯­æ³•

## è¾“å…¥è¾“å‡º æ‰“å° mainé­”æ³•å˜é‡

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# ä»¥ä¸Šä¸¤è¡Œè¡¨ç¤ºpython è§£é‡Šå™¨ç‰ˆæœ¬ï¼›ä»¥utf-8ç¼–ç 

# æ¨¡å—çš„æ–‡æ¡£æ³¨é‡Š
' a test module '

__author__ = 'xiaoyu'


def hello_print():
    '''æ–¹æ³•æ³¨é‡Š
    å¯ä»¥é€šè¿‡ hello_print.__doc__ è·å–, æˆ–è€… help(hello_print) è·å–æ–‡æ¡£å­—ç¬¦ä¸²
    '''
    print("Hello world!")
    print("aa", "bb", "ccc")  # ç±»ä¼¼

    # é—´éš”
    print(1, 2, 3, sep="   ")  # 1   2   3
    # ä¸æ¢è¡Œ
    print('hello', end='')
    print('æ²¡æ¢è¡Œ')  # helloæ²¡æ¢è¡Œ

    # å‘½ä»¤è¡Œè¾“å…¥
    # name = input('please enter your name: ')
    # print(name)


# 
# å‘½ä»¤è¡Œimportæ–¹å¼è°ƒ æœ¬æ–‡ä»¶ä¸­çš„æ–¹æ³•, å°†ä¸è¿›å…¥ifåˆ¤æ–­ï¼Œæ­¤æ—¶é€šè¿‡ main.xxx() è°ƒç”¨
# å¦‚æœç›´æ¥ python main.py, åˆ™è¿›å…¥ if
if __name__ == "__main__":
    hello_print()

```


## åŸºæœ¬æ•°æ®ç±»å‹

### å­—ç¬¦ä¸² 

#### å¤šè¡Œ ä¸å¯å˜ æ¯”è¾ƒ

```py
# å­—ç¬¦ä¸²
    a='a'
    b="b"
    c="I'm xy."
    d='I\'m \"OK\"!'
    # r'' å½¢å¼çš„é»˜è®¤ä¸è½¬ä¹‰
    e=r'\\\t\\'
    f='''å¤šè¡Œå†…å®¹'''
    g = f'''xx{xxx_var}''' # æ ¼å¼åŒ–

    ss = 'abcde'
    s1 = ss[0]  # a

# éå†
for s in 'abcd':
    print(s)


# str æ˜¯ä¸å¯å˜å¯¹è±¡
    # ä¸å¯å˜å¯¹è±¡ä¸å¯ä¿®æ”¹ï¼Œä¸€æ—¦ä¿®æ”¹ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡, ä¹Ÿå°±æ˜¯ id(a) çš„åœ°å€ä¸åŒäº†
    # >>> a = 'abc'
    # >>> a.replace('a', 'A')
    # 'Abc'
    # >>> a
    # 'abc'


# æ¯”è¾ƒå­—ç¬¦ä¸²æ˜¯å¦ç›¸åŒ ä½¿ç”¨ ==, è¿™ç‚¹å’Œ java ä¸åŒ
# is, is not å¯¹æ¯”çš„æ˜¯ä¸¤ä¸ªå˜é‡çš„å†…å­˜åœ°å€
# ==,!= å¯¹æ¯”çš„æ˜¯ä¸¤ä¸ªå˜é‡çš„å€¼
if 'ab' == 'ab':   # true
    print('ab == ab')


```


#### å­—ç¬¦ç¼–ç 

```py
 ### ç¼–ç å¤„ç† å­—ç¬¦å¤„ç†
    #
    # å­—ç¬¦
    # å­—ç¬¦ç¼–ç 
    # ord:æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºASCII    bin:æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆäºŒè¿›åˆ¶
    # oct:æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆå…«è¿›åˆ¶    hex:æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆ16è¿›åˆ¶
    #  chr: å§asciiç¼–ç è½¬æ¢ä¸ºå­—ç¬¦ä¸²
    ord('A')
    #65
    ord('ä¸­')
    #20013
    chr(66)
    #'B'
    chr(25991)
    #'æ–‡'
    #>>> 'u4e2du6587'
    #'ä¸­æ–‡'

    s1 = u'å“ˆ'
    type(s) # åˆ™ä¼šå¾—åˆ°<type â€˜unicodeâ€™>ï¼Œä¹Ÿå°±æ˜¯åœ¨å­—ç¬¦å‰é¢åŠ uå°±è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªunicodeå¯¹è±¡ï¼Œè¿™ä¸ªå­—ä¼šä»¥unicodeæ ¼å¼å­˜åœ¨äºå†…å­˜ä¸­
    # å¦‚æœä¸åŠ uï¼Œè¡¨æ˜è¿™ä»…ä»…æ˜¯ä¸€ä¸ªä½¿ç”¨æŸç§ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œç¼–ç æ ¼å¼å–å†³äºpythonå¯¹æºç æ–‡ä»¶ç¼–ç çš„è¯†åˆ«ï¼Œå¦‚ # -*- coding: utf-8 -*-
    # https://www.cnblogs.com/yyxayz/p/4044528.html


    # å­—èŠ‚
    # å¦‚æœè¦åœ¨ç½‘ç»œä¸Šä¼ è¾“ï¼Œæˆ–è€…ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œå°±éœ€è¦æŠŠstrå˜ä¸ºä»¥å­—èŠ‚ä¸ºå•ä½çš„bytesã€‚
    # Pythonå¯¹bytesç±»å‹çš„æ•°æ®ç”¨å¸¦bå‰ç¼€çš„å•å¼•å·æˆ–åŒå¼•å·è¡¨ç¤ºï¼š
    x = b'ABC'
    print(b"hello...")

    'ABC'.encode('ascii')
    # b'ABC'
    b'ABC'.decode('ascii')
    # 'ABC'

    'ä¸­æ–‡'.encode('utf-8')
    # b'xe4xb8xadxe6x96x87'
    b'xe4xb8xadxe6x96x87'.decode('utf-8')
    # 'ä¸­æ–‡'

  

    
    len('ABC')
    # 3
    len('ä¸­æ–‡')
    # 2
```

#### æ ¼å¼åŒ–

```py
# æ ¼å¼åŒ– å ä½ç¬¦
    #
    # %sè¡¨ç¤ºç”¨å­—ç¬¦ä¸²æ›¿æ¢ï¼Œ%dè¡¨ç¤ºç”¨æ•´æ•°æ›¿æ¢ï¼Œæœ‰å‡ ä¸ª%?å ä½ç¬¦ï¼Œåé¢å°±è·Ÿå‡ ä¸ªå˜é‡æˆ–è€…å€¼ï¼Œé¡ºåºè¦å¯¹åº”å¥½ã€‚å¦‚æœåªæœ‰ä¸€ä¸ª%?ï¼Œæ‹¬å·å¯ä»¥çœç•¥
    # å¦‚æœä½ ä¸å¤ªç¡®å®šåº”è¯¥ç”¨ä»€ä¹ˆï¼Œ%sæ°¸è¿œèµ·ä½œç”¨ï¼Œå®ƒä¼šæŠŠä»»ä½•æ•°æ®ç±»å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²
    print('Hi, %s, you have $%d.' % ('Michael', 1000000))
    # 'Hi, Michael, you have $1000000.'
    #
    print("{} {}".format("hello", "world"))   # ä¸è®¾ç½®æŒ‡å®šä½ç½®ï¼ŒæŒ‰é»˜è®¤é¡ºåº
    print("{0} {1}".format("hello", "world"))  # è®¾ç½®æŒ‡å®šä½ç½®
    print('hello {name}'.format(name='xiaoyu'))
    # é€šè¿‡å­—å…¸è®¾ç½®å‚æ•°
    site = {"name": "xi", "url": "xiaoyureed.github.io"}
    print("ç½‘ç«™åï¼š{name}, åœ°å€ {url}".format(**site))
    # é€šè¿‡åˆ—è¡¨ç´¢å¼•è®¾ç½®å‚æ•°
    my_list = ['hello', 'world']
    print("ç½‘ç«™åï¼š{0[0]}, åœ°å€ {0[1]}".format(my_list))  # "0" æ˜¯å¿…é¡»çš„
    # ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ 
    # my_value = {"value": "hello"}
    # print('value ä¸º: {0.value}'.format(my_value))  # "0" æ˜¯å¯é€‰çš„, my_value å¯¹è±¡éœ€è¦æœ‰ value å±æ€§

    # æ ¼å¼åŒ–æ•°å­—
    print("{:.2f}".format(3.1415926))  # 3.14


    print('=' * 40)  # æ‰“å° 40 ä¸ª'='
```

#### å­—ç¬¦ä¸²å¤„ç†

```py

 #
    # å­—ç¬¦ä¸²å¤„ç†æ–¹æ³•
    #
    #

    len(b'ABC')  # 3
    len(b'xe4xb8xadxe6x96x87')  # 6
    len('ä¸­æ–‡'.encode('utf-8'))
    # 6

    # count(xxx) æŸä¸ªå…ƒç´ å‡ºç°æ¬¡æ•°
    # è®¡ç®—è¡Œæ•°
    myString = '''line1
sf
sdfsf
sdfs
    '''
    print(myString)
    c = myString.count("\n")+(not myString.endswith("\n"))
    print(c)  # 5
    # or
    c1 = myString.count("\n")+[1, 0][myString.endswith("\n")]
    print(c1)  # 5



# æ–¹ä¾¿çš„ä¿®æ”¹å­—ç¬¦ä¸²
str_list = list('abcde') # [a b c d e]
res = ''.join(str_list)

# åˆ¤æ–­å­—ç¬¦æ˜¯å¦ä¸ºç©º
s = 'ab'
if s:      # true
    pass



    # æŸ¥æ‰¾
    find = myString.find("sf")
    print("find = ", find)  # 6, ä» 0 å¼€å§‹, ç¬¬ 6 ä¸ªå­—ç¬¦
    find1 = myString.find("220")
    print("find1 =  ", find1)  # -1
    
    if 'world' in string:
        xxx

    # åˆ‡å‰²ä¸º list
    string = "hello\nworld xxx yyy zzz"
    print(string.split("\n"))  # ['hello', 'world xxx yyy zzz']
    # ä»¥ sep ä¸ºåˆ†éš”ç¬¦åˆ‡ç‰‡ stringï¼Œå¦‚æœ maxsplit æœ‰æŒ‡å®šå€¼ï¼Œåˆ™æœ€å¤šåˆ‡å‰²å¤šå°‘æ¬¡ (å¿…é¡»å¸¦ä¸Š maxsplit)
    print(string.split(sep='o', maxsplit=1))  # ['hell', '\nworld xxx yyy zzz']
    #æŒ‰ç…§è¡Œ('\r', '\r\n', \n')åˆ†éš”ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«å„è¡Œä½œä¸ºå…ƒç´ çš„åˆ—è¡¨ï¼Œå¦‚
    # æœå‚æ•° keepends ä¸º Falseï¼Œä¸åŒ…å«æ¢è¡Œç¬¦ï¼Œå¦‚æœä¸º Trueï¼Œåˆ™ä¿ç•™æ¢è¡Œç¬¦ã€‚é»˜è®¤ false
    print(string.splitlines(True)) # ['hello\n', 'world xxx yyy zzz']
    print(string.splitlines(False)) # ['hello', 'world xxx yyy zzz']
    print(string.splitlines()) # ['hello', 'world xxx yyy zzz']


    # åˆ‡å‰²æˆ tuple
    #
    #æœ‰ç‚¹åƒ find()å’Œ split()çš„ç»“åˆä½“,ä» str å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®èµ·,æŠŠ å­— ç¬¦ ä¸² string åˆ†
    #æˆ ä¸€ ä¸ª 3 å…ƒ ç´  çš„ å…ƒ ç»„ (string_pre_str,str,string_post_str),å¦‚
    # æœ string ä¸­ä¸åŒ…å«str åˆ™ string_pre_str == string.
    print(string.partition('w') ) # ('hello\n', 'w', 'orld xxx yyy zzz')

    # string.rpartition(str) #ç±»ä¼¼äº partition()å‡½æ•°,ä¸è¿‡æ˜¯ä»å³è¾¹å¼€å§‹æŸ¥æ‰¾


    # # æ‹¼æ¥
    print('\n'.join(['aaa', 'bbb', 'ccc']))

    # # å°†å­—ç¬¦ä¸²è½¬ä¸º å­—ç¬¦åˆ—è¡¨
    print(list("12345")) # ['1', '2', '3', '4', '5']

    # # 
    #
    #  å¸¸ç”¨å†…å»ºå‡½æ•°
    #
    #
    # # strip() 
    # ç”¨äºç§»é™¤å­—ç¬¦ä¸²å¤´å°¾æŒ‡å®šçš„å­—ç¬¦ï¼ˆé»˜è®¤ä¸ºç©ºæ ¼æˆ–æ¢è¡Œç¬¦ï¼‰æˆ–å­—ç¬¦åºåˆ—
    str = "00000003210Runoob01230000000"
    # ç§»é™¤æŒ‡å®šå­—ç¬¦
    print(str.strip( '0' ))  # 3210Runoob0123
    str2 = "   Runoob      "   # Runoob
    # é»˜è®¤æ˜¯ç§»é™¤ç©ºæ ¼
    print(str2.strip())
    str = "123abcrunoob321"
    # æŒ‡å®šçš„å­—ç¬¦æ²¡æœ‰é¡ºåºä¹‹åˆ†
    print (str.strip( '12' ))  # 3abcrunoob3

    string = "   hello    "
    string = string.lstrip()#æˆªæ‰ string å·¦è¾¹çš„ç©ºæ ¼
    string = string.rstrip()#åˆ é™¤ string å­—ç¬¦ä¸²æœ«å°¾çš„ç©ºæ ¼.
    print("string = " + string)


    print(string.capitalize()) # æŠŠå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¤§å†™
    # string.lower()#è½¬æ¢ string ä¸­æ‰€æœ‰å¤§å†™å­—ç¬¦ä¸ºå°å†™.
    # string.upper()#è½¬æ¢ string ä¸­çš„å°å†™å­—æ¯ä¸ºå¤§å†™
    # string.swapcase()#ç¿»è½¬ string ä¸­çš„å¤§å°å†™
    # string.title()#è¿”å›"æ ‡é¢˜åŒ–"çš„ string,å°±æ˜¯è¯´æ‰€æœ‰å•è¯éƒ½æ˜¯ä»¥å¤§å†™å¼€å§‹ï¼Œå…¶ä½™å­—æ¯å‡ä¸ºå°å†™(è§ istitle())

    # string.center(width) #è¿”å›ä¸€ä¸ªåŸå­—ç¬¦ä¸²å±…ä¸­,å¹¶ä½¿ç”¨ç©ºæ ¼å¡«å……è‡³é•¿åº¦ width çš„æ–°å­—ç¬¦ä¸²
    # string.ljust(width)#è¿”å›ä¸€ä¸ªåŸå­—ç¬¦ä¸²å·¦å¯¹é½,å¹¶ä½¿ç”¨ç©ºæ ¼å¡«å……è‡³é•¿åº¦ width çš„æ–°å­—ç¬¦ä¸²
    # string.rjust(width)#è¿”å›ä¸€ä¸ªåŸå­—ç¬¦ä¸²å³å¯¹é½,å¹¶ä½¿ç”¨ç©ºæ ¼å¡«å……è‡³é•¿åº¦ width çš„æ–°å­—ç¬¦ä¸²
    # string.zfill(width)#è¿”å›é•¿åº¦ä¸º width çš„å­—ç¬¦ä¸²ï¼ŒåŸå­—ç¬¦ä¸² string å³å¯¹é½ï¼Œå‰é¢å¡«å……0

    # è¿”å› str åœ¨ string é‡Œé¢å‡ºç°çš„æ¬¡æ•°ï¼Œå¦‚æœ beg æˆ–è€… end æŒ‡å®šåˆ™è¿”å›æŒ‡å®šèŒƒå›´å†… str å‡ºç°çš„æ¬¡æ•°
    string = "xsdf aa sfefaafsef"
    print(string.count("aa")) # 2
    print(string.count("aa", 7, len(string))) # 1

    #ä»¥ encoding æŒ‡å®šçš„ç¼–ç æ ¼å¼è§£ç  stringï¼Œå¦‚æœå‡ºé”™é»˜è®¤æŠ¥ä¸€ä¸ª ValueError çš„ å¼‚ å¸¸ ï¼Œ 
    # é™¤é errors æŒ‡ å®š çš„ æ˜¯ 'ignore' æˆ– è€…'replace'
    # string.decode(encoding='UTF-8', errors='strict') 
    # string.encode(encoding='UTF-8', errors='strict')


    # string.endswith(obj, beg=0, end=len(string))#æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä»¥ obj ç»“æŸï¼Œå¦‚æœbeg æˆ–è€… end æŒ‡å®šåˆ™æ£€æŸ¥æŒ‡å®šçš„èŒƒå›´å†…æ˜¯å¦ä»¥ obj ç»“æŸï¼Œå¦‚æœæ˜¯ï¼Œè¿”å› True,å¦åˆ™è¿”å› False.
    # string.startswith(obj, beg=0,end=len(string))#æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦æ˜¯ä»¥ obj å¼€å¤´ï¼Œæ˜¯åˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› Falseã€‚å¦‚æœbeg å’Œ end æŒ‡å®šå€¼ï¼Œåˆ™åœ¨æŒ‡å®šèŒƒå›´å†…æ£€æŸ¥.

    # string.expandtabs(tabsize=8) #æŠŠå­—ç¬¦ä¸² string ä¸­çš„ tab ç¬¦å·è½¬ä¸ºç©ºæ ¼ï¼Œtab ç¬¦å·é»˜è®¤çš„ç©ºæ ¼æ•°æ˜¯ 8ã€‚

    # string.find(str, beg=0, end=len(string)) #æ£€æµ‹ str æ˜¯å¦åŒ…å«åœ¨ string ä¸­ï¼Œå¦‚æœ beg å’Œ end æŒ‡å®šèŒƒå›´ï¼Œåˆ™æ£€æŸ¥æ˜¯å¦åŒ…å«åœ¨æŒ‡å®šèŒƒå›´å†…ï¼Œå¦‚æœæ˜¯è¿”å›å¼€å§‹çš„ç´¢å¼•å€¼ï¼Œå¦åˆ™è¿”å›-1
    # string.rfind(str, beg=0,end=len(string) )#ç±»ä¼¼äº find()å‡½æ•°ï¼Œä¸è¿‡æ˜¯ä»å³è¾¹å¼€å§‹æŸ¥æ‰¾.

    # string.index(str, beg=0, end=len(string)) #è·Ÿfind()æ–¹æ³•ä¸€æ ·ï¼Œåªä¸è¿‡å¦‚æœsträ¸åœ¨ stringä¸­ä¼šæŠ¥ä¸€ä¸ªå¼‚å¸¸.
    # string.rindex( str, beg=0,end=len(string))#ç±»ä¼¼äº index()ï¼Œä¸è¿‡æ˜¯ä»å³è¾¹å¼€å§‹.

    # string.isalnum()#å¦‚æœ string è‡³å°‘æœ‰ä¸€ä¸ªå­—ç¬¦å¹¶ä¸”æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯å­—æ¯æˆ–æ•°å­—åˆ™è¿”å› True,å¦åˆ™è¿”å› False
    # string.isalpha() #å¦‚æœ string è‡³å°‘æœ‰ä¸€ä¸ªå­—ç¬¦å¹¶ä¸”æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯å­—æ¯åˆ™è¿”å› True,å¦åˆ™è¿”å› False

    # string.isdecimal()#å¦‚æœ string åªåŒ…å«åè¿›åˆ¶æ•°å­—åˆ™è¿”å› True å¦åˆ™è¿”å› False.
    # string.isdigit()# å¦‚æœ string åªåŒ…å«æ•°å­—åˆ™è¿”å› True å¦åˆ™è¿”å› False.
    # string.isnumeric()#å¦‚æœ string ä¸­åªåŒ…å«æ•°å­—å­—ç¬¦ï¼Œåˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False

    # string.islower()#å¦‚æœ string ä¸­åŒ…å«è‡³å°‘ä¸€ä¸ªåŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ï¼Œå¹¶ä¸”æ‰€æœ‰è¿™äº›(åŒºåˆ†å¤§å°å†™çš„)å­—ç¬¦éƒ½æ˜¯å°å†™ï¼Œåˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False
    # string.isupper()#å¦‚æœ string ä¸­åŒ…å«è‡³å°‘ä¸€ä¸ªåŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ï¼Œå¹¶ä¸”æ‰€æœ‰è¿™äº›(åŒºåˆ†å¤§å°å†™çš„)å­—ç¬¦éƒ½æ˜¯å¤§å†™ï¼Œåˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False

    # string.isspace()#å¦‚æœ string ä¸­åªåŒ…å«ç©ºæ ¼ï¼Œåˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False.

    # string.istitle() #å¦‚æœ string æ˜¯æ ‡é¢˜åŒ–çš„(è§ title())åˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False


    # string.join(seq)#ä»¥ string ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå°† seq ä¸­æ‰€æœ‰çš„å…ƒç´ (çš„å­—ç¬¦ä¸²è¡¨ç¤º)åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²


    # string.maketrans(intab, outtab]) #maketrans() æ–¹æ³•ç”¨äºåˆ›å»ºå­—ç¬¦æ˜ å°„çš„è½¬æ¢è¡¨ï¼Œå¯¹äºæ¥å—ä¸¤ä¸ªå‚æ•°çš„æœ€ç®€å•çš„è°ƒç”¨æ–¹å¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºéœ€è¦è½¬æ¢çš„å­—ç¬¦ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¹Ÿæ˜¯å­—ç¬¦ä¸²è¡¨ç¤ºè½¬æ¢çš„ç›®æ ‡ã€‚

    # max(str)#è¿”å›å­—ç¬¦ä¸² str ä¸­æœ€å¤§çš„å­—æ¯ã€‚
    # min(str)#è¿”å›å­—ç¬¦ä¸² str ä¸­æœ€å°çš„å­—æ¯ã€‚

    # string.replace(str1, str2,  num=string.count(str1)) #æŠŠ string ä¸­çš„ str1 æ›¿æ¢æˆ str2,å¦‚æœ num æŒ‡å®šï¼Œåˆ™æ›¿æ¢ä¸è¶…è¿‡ num æ¬¡.


    # string.translate(str, del="")#æ ¹æ® str ç»™å‡ºçš„è¡¨(åŒ…å« 256 ä¸ªå­—ç¬¦)è½¬æ¢ string çš„å­—ç¬¦, è¦è¿‡æ»¤æ‰çš„å­—ç¬¦æ”¾åˆ° del å‚æ•°ä¸­
```

### å­—èŠ‚æ•°ç»„ bytes bytearray

```python

byte_arr = bytes([1, 2, 3])  # ä¸å¯å˜

byte_arr2 = bytearray((1, 2,3)) # å¯å˜ï¼Œ å†…å­˜åŠ¨æ€åˆ†é…

# è½¬æ¢
byte_arr3 = bytearray(byte_arr)
byte_arr4 = bytes(byte_arr3)
```


### æ•°å­—

```py
# æ•´æ•°
    c=2
    a=0xff00  # 16è¿›åˆ¶

    # æµ®ç‚¹æ•°
    #
    # é™¤æ³•è®¡ç®—ç»“æœæ˜¯æµ®ç‚¹æ•°ï¼Œå³ä½¿æ˜¯ä¸¤ä¸ªæ•´æ•°æ°å¥½æ•´é™¤ï¼Œç»“æœä¹Ÿæ˜¯æµ®ç‚¹æ•°
    a=1.24
    b=3.33
    c=1.23e9  # 1.23x10çš„9æ¬¡æ–¹
    d=1.2e-5  # 0.000012

    
    # ç‰¹æœ‰çš„è¿ç®—ç¬¦
    # 2**3 == 8 æ¬¡å¹‚
    # 9 // 2 == 4 é™¤æ³•å–æ•´, ç§°ä¸ºåœ°æ¿é™¤ï¼Œä¸¤ä¸ªæ•´æ•°çš„é™¤æ³•ä»ç„¶æ˜¯æ•´æ•°, åªå–ç»“æœçš„æ•´æ•°éƒ¨åˆ†

    # è½¬æ¢
    age_str="11"
    age_num=int(age_str)
    print(age_num)

    # åˆ¤æ–­æ˜¯å¦å¯ä»¥è½¬æ¢ä¸ºæ•´å‹
    a="1,2,3"
    print(a.isdecimal())  # False
    print(a.isdigit())  # False
    print("ä¹".isnumeric())  # True

```

### å¸ƒå°”å€¼ ç©ºå€¼


```py
# å¸ƒå°”å€¼
    # åœ¨ Python æ˜¯æ˜¯ä½œä¸º integer çš„ä¸€ä¸ªå­ç±»å‹
        True å¯¹åº” 1
        False å¯¹åº” 0
    # åªæœ‰Trueã€Falseä¸¤ç§å€¼
    # å¯ä»¥ç”¨ and ,or, not è¿ç®—

    # ç©ºå€¼
    # ç”¨Noneè¡¨ç¤ºã€‚Noneä¸èƒ½ç†è§£ä¸º0

assert True == 1     #true
assert True == 1.0    #true
assert 1 == 1.0      #true
assert 1 == 1.0 == True   #true

assert True == [1, 2]
assert False == []

assert True == 'a'
assert False == ''

assert False == {}
assert True == {'a': None}

assert False == ()
assert True == (1,)

assert True == XxxException


def he():
    pass
assert True == he

# æ ¸å¿ƒå‡†åˆ™æ˜¯: åªè¦å˜é‡ä¸ä¸º None, å°±æ˜¯å¸ƒå°”å€¼çš„ true
```

### æ•°ç»„ array

```python

arr = array.array('f', [11.11, 2.00, 0.156]) # 'f' æŒ‡å®šå…ƒç´ ç±»å‹ï¼Œ ä¸å¯æ·»åŠ å…¶ä»–ç±»å‹å…ƒç´ 
print(arr)
for a in arr:
    print(a)

```

### é›†åˆ


#### list æœ‰åºå¯å˜ 

```py
 #
    #
    ##### List å¯å˜æœ‰åºåˆ—è¡¨
    #
    #
    #
    classmates = ['Michael', 'Bob', 'Tracy']
    print("classmates = ", classmates) # ['Michael', 'Bob', 'Tracy']
    print (len(classmates))

    # è·å–
    # # è·å–ç¬¬ä¸€ä¸ª
    classmates[0]
    # 'Michael'
    # # æœ€åä¸€ä¸ªå…ƒç´ 
    classmates[-1] 
    # or
    classmates[len(classmates) - 1]
    # 'Tracy'
    # # ä»¥æ­¤ç±»æ¨ï¼Œå¯ä»¥è·å–å€’æ•°ç¬¬2ä¸ªã€å€’æ•°ç¬¬3ä¸ªï¼š
    classmates[-2]
    # 'Bob'

    # æŸ¥æ‰¾
    # index() å‡½æ•°ç”¨äºä»åˆ—è¡¨ä¸­æ‰¾å‡ºæŸä¸ªå€¼ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ç´¢å¼•ä½ç½®
        
    # # æ·»åŠ åˆ°æœ«å°¾
    classmates.append('Adam')
    # >>> classmates ['Michael', 'Bob', 'Tracy', 'Adam']
    # or
    classmates += ['abc', 'def']
    # # æ·»åŠ åˆ°æŒ‡å®šä½ç½®
    classmates.insert(1, 'Jack')
    # >>> classmates ['Michael', 'Jack', 'Bob', 'Tracy', 'Adam']
    # # åˆ é™¤æœ«å°¾å…ƒç´ , å¹¶è¿”å›
    classmates.pop()
    # 'Adam'
    # # åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ 
    # >>> classmates.pop(1)
    # 'Jack'

    # or
    # åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ 
    del classmates[-1]
    # åˆ é™¤ä¸‹æ ‡ä¸º 0, 1, 2 çš„å…ƒç´ 
    del classmates[:3]

    #
    # å¸¦ä¸‹æ ‡éå†
    # enumerate()å¯ä»¥å°†listå˜ä¸ºç´¢å¼•-å…ƒç´  tuple
    # for i, value in enumerate([1,2,'3', '4']):
    #     print(i, value)
    #


    # åˆ¤æ–­å¯¹è±¡æ˜¯å¦èƒ½è¿­ä»£
    # from collections import Iterable
    # if (isinstance("acb", Iterable)):
    #     print('ok!')

    # åˆ¤æ–­ä¸¤ä¸ª list æ˜¯å¦ç›¸ç­‰
    # å¯è½¬ä¸º tuple ä¹‹åå†æ¯”è¾ƒ
    @dataclass(frozen=True)
    class Person:
        name: str
        age: int
    lst1 = [Person('a', 11), Person('b', 11)]
    lst2 = [Person('a', 11), Person('b', 11)]
    tuple(lst1) == tuple(lst2)  # true

    #
    # åˆ—è¡¨ç”Ÿæˆå¼
    #
    l = list(range(1,11))
    print(l)
    l1 = [x*x for x in l]
    print(l1)
    l2 = [x*x for x in l if x%2 ==0]
    print(l2)

    m = [x+y for x in 'abc' for y in 'ABC']
    print(m)
    import os
    d = [d for d in os.listdir('.')]
    print(d)
```

##### slices åˆ‡ç‰‡ 

```py
# slices  ä¼šç”Ÿæˆæ–°çš„åˆ—è¡¨ (åŒ…å¤´ä¸åŒ…å°¾)
    #
    #
    l = list(range(10))
    print(l)
    print(l[0:3]) # 0 1 2
    print(l[:3]) # 0 1 2
    print(l[-1]) # 9
    print(l[-1:])  # [9]
    print(l[-2:-1]) # [8]
    print(l[-2:]) # [8, 9]
    print(l)  # [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]

    l2 = ['a', 'b', 'c', 'd']
    (ele1, ele2, remaining) = l2[0], l2[1], l2[2:] # 
    # ç­‰ä»·
        (ele1, ele2, *remaining) = l2
    ele1 # a
    ele2 # b
    remaining # [c, d]

    (e1, middle, e2) = l2[0], l2[1:-1], l2[-1]
    # ç­‰ä»·
        (e1, *middle, e2) = l2



```


#### tuple æœ‰åºä¸å¯å˜åˆ—è¡¨ 

```py
 # Tuple ä¸å¯å˜æœ‰åºåˆ—è¡¨
    #
    # å› ä¸ºtupleä¸å¯å˜ï¼Œæ‰€ä»¥ä»£ç æ›´å®‰å…¨ã€‚å¦‚æœå¯èƒ½ï¼Œèƒ½ç”¨tupleä»£æ›¿listå°±å°½é‡ç”¨tuple
    # 
    # åˆ›å»º
    classmates = ('Michael', 'Bob', 'Tracy')

    # # å®šä¹‰ç©º
    t = ()

    # # å®šä¹‰ä¸€ä¸ªå…ƒç´ çš„tuple
    t = (1,)
      # ä¸ºä»€ä¹ˆè¿™æ ·è§„å®š?
    # è¿™æ˜¯å› ä¸ºæ‹¬å·()æ—¢å¯ä»¥è¡¨ç¤ºtupleï¼Œåˆå¯ä»¥è¡¨ç¤ºæ•°å­¦å…¬å¼ä¸­çš„å°æ‹¬å·ï¼Œè¿™å°±äº§ç”Ÿäº†æ­§ä¹‰.æ‰€ä»¥ï¼Œåªæœ‰1ä¸ªå…ƒç´ çš„tupleå®šä¹‰æ—¶å¿…é¡»åŠ ä¸€ä¸ªé€—å·,ï¼Œæ¥æ¶ˆé™¤æ­§ä¹‰

    # # å¯å˜çš„tuple
    # è‹¥å…ƒç´ ä¸æ˜¯åŸºæœ¬ç±»å‹ï¼šï¼ˆè¿™ç§æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼‰
    t = ('a', 'b', ['A', 'B'])
    # >>> t[2][0] = 'X'
    # >>> t[2][1] = 'Y'
    # >>> t
    # ('a', 'b', ['X', 'Y'])



```

##### namedtuple() åˆ›å»ºå¸¦åå­—ä¸‹æ ‡çš„å…ƒç»„


```python
# namedtupleæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒç”¨æ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„tupleå¯¹è±¡ï¼Œå¹¶ä¸”è§„å®šäº†tupleå…ƒç´ çš„ä¸ªæ•°ï¼Œå¹¶å¯ä»¥ç”¨å±æ€§è€Œä¸æ˜¯ç´¢å¼•æ¥å¼•ç”¨tupleçš„æŸä¸ªå…ƒç´ 
# æä¾›äº†é€šè¿‡åç§°è€Œä¸æ˜¯ç´¢å¼•è®¿é—®å­—æ®µçš„é¢å¤–ä¼˜åŠ¿

# -*- coding: utf-8 -*-
# author: xiaoyu 775000738@qq.com 2021/6/11

from collections import namedtuple
from random import choice


def named_tuple_intro():

    # å¿«é€Ÿæ„é€ ä¸€ä¸ªç±», 

    # ç±»å People, å±æ€§ name, age, like
    Car = namedtuple('Car', 'name, mileage')
    # or
    Person = namedtuple('Person', 'name age')
    # or
    Book = namedtuple('Book', ['name', 'price'])

    c = Car('car', 11.1)
    print(c[0], c.mileage) # car 11.1
    print(isinstance(c, Car))   # true 

    car_as_dict = c._asdict()
    print(car_as_dict) # {'name': 'car', 'mileage': 11.1}

    car_new = c._replace(name='car11')
    print(car_new._asdict()) # {'name': 'car11', 'mileage': 11.1}
    
    c.name = 'rain' # AttributeError: can't set attribute




# è¯»å– csv æ–‡ä»¶
def read_csv():
    Person = namedtuple('Person', 'name, age, salary')
    for per in map(Person._make, csv.reader(open('/tmp/xx.csv', 'r'))):
        print(per.name, per.age, per.salary)





# è¯»å–æ•°æ®åº“æ•°æ®

Person = namedtuple('Person', 'name, age, salary')
import sqlite3
conn = sqlite3.connect('/tmp/data.xx')
cur = conn.cursor()
cur.execute('select name, age, salary from tbl_person')
for per in map(Person._make, cur.fetchall()):
    print(per)
pass



def french_deck():
    """
    æ‰‘å…‹æ¸¸æˆ
    """
    Card = namedtuple('Card', ['rank', 'suit'])

    class FrenchDeck:
        # ç‚¹æ•°
        ranks = [str(n) for n in range(2, 11) ] + list('JQKA')
        # èŠ±è‰²
        suits = 'é»‘æ¡ƒ æ–¹ç‰‡ æ¢…èŠ± çº¢æ¡ƒ'.split()

        def __init__(self):
            self._card = [Card(rank, suit) for suit in self.suits
                          for rank in self.ranks]

        def __len__(self):
            return len(self._card)

        # after this method defined, FrenchDeck will become a iterable obj
        def __getitem__(self, item_index):
            return self._card[item_index]

    deck = FrenchDeck()
    print(len(deck))
    # ç¬¬ä¸€å¼ ç‰Œ
    print(deck[0])
    # æœ€åä¸€å¼ ç‰Œ
    print(deck[-1])
    cards = []
    for card in deck:
        cards.append(card)
    print(cards)
    reversed_cards = []
    for card in reversed(deck):
        reversed_cards.append(card)
    print(reversed_cards)

    # ä» iterable obj ä¸­éšæœºé€‰å–
    random_card = choice(deck)
    print(random_card)

    # åˆ¤æ–­æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­
    print(Card('Q', 'æ–¹ç‰‡') in deck)
    print(Card('Q', 'block') in deck)

    suit_values = dict(é»‘æ¡ƒ=3, æ–¹ç‰‡=2, æ¢…èŠ±=1, çº¢æ¡ƒ=0)
    print(suit_values)


if __name__ == '__main__':
    french_deck()

```

##### typeing.NamedTulple å‘½åçš„å…ƒç»„

```python

    from typing import NamedTuple
    class Person(NamedTuple):
        name: str
        age: int
        sal: float = 10000.01
        
        def __repr__(self):
            return f'Person {self.name} {self.age} {self.sal}'
    per = Person('rain', 11) 
    per_str = str(per) # Person rain 11 10000.01
    print(per_str) 
   
```

##### å…ƒç»„è§£åŒ…

```python

    (name, age, sal) = ['Rain', 11, 10000.11]
    print(name, age, sal)
    
    def print_names(*names):
        print(type(names))
        for name in names:
            print(name)
    print_names('rain', 'Mary', 'Dany') # type: tuple      names æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œ æœ‰ä¸‰ä¸ªå…ƒç´ 
    print_names(['rain', 'mary'])   # type: tuple , ['rain', 'mary'] ï¼Œ names æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œ æœ‰ä¸€ä¸ªå…ƒç´ ï¼Œ è¿™ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼ˆåˆ—è¡¨æœ‰ä¸‰ä¸ªå…ƒç´ ï¼‰

    tu1 = (1, 2,)
    tu2 = (2, 3)
    tu4 = (tu1, tu2, 100) #  # ((1, 2), (2, 3), 100)
    print(tu4)
    tu3 = (*tu1, *tu2, 100) # (1, 2, 2, 3, 100)
    print(tu3)





    Person = namedtuple('Person', 'name, age, salary')
    p = Person('rain', 1, 1000)
    (name, _, _) = p # rain
    print(name)
    (name, *_) = p
    print(name) # rain
    (name, _) = p # ValueError: too many values to unpack (expected 2)

    (*name_and_age, _) = p # ['rain', 1]
    print(name_and_age)
    
```

#### set æ— åºä¸å¯é‡å¤ 

```py
  # Set æ— åºä¸å¯é‡å¤
    #
    #set å’Œ dict çš„å”¯ä¸€åŒºåˆ«ä»…åœ¨äºæ²¡æœ‰å­˜å‚¨å¯¹åº”çš„ value
    #
    # è¦åˆ›å»ºä¸€ä¸ªsetï¼Œéœ€è¦æä¾›ä¸€ä¸ªlistä½œä¸ºè¾“å…¥é›†åˆï¼š
    s = set([1, 2, 3])
    # {1, 2, 3}

    # or
    s = {1,2,3}

    # ç©º set ä¸è¦ç”¨{}, ä¼šè¯¯è®¤ä¸ºæ˜¯å®šä¹‰å­—å…¸
    s = set()

    # æ¨å¯¼å¼
    s = {x*x for x in range(4)}

    # # é‡å¤å…ƒç´ åœ¨setä¸­è‡ªåŠ¨è¢«è¿‡æ»¤
    s = set([1, 1, 2, 2, 3, 3])
    # {1, 2, 3}

    # # æ·»åŠ å…ƒç´ ï¼Œé‡å¤æ·»åŠ æ— æ•ˆ
    s.add(4)
    # {1, 2, 3, 4}
    s.add(4)
    # {1, 2, 3, 4}

    # # åˆ é™¤
    s.remove(4)
    # {1, 2, 3}

    # # äº¤é›†  O(n)
    s1 = set([1, 2, 3])
    s2 = set([2, 3, 4])
    s1 & s2
    # {2, 3}

    s1 | s2  # å¹¶é›†     O(n)
    # {1, 2, 3, 4}

    # å·®é›†
    s1 - s2

    # æ˜¯å¦å­˜åœ¨ O(1)
    assert 1 in {1, 2, 3}   # true


```

##### frosenset ä¸å¯å˜set

```python

s  = fronsenset([1, 2, 3])
fronsenset((1, 2, 3,))

frosenset({'a': 1, 'b': 2}) # {'a', 'b'}

```

#### deque åŒç«¯é˜Ÿåˆ— æ ˆ

```python
# Python æ ‡å‡†åº“é›†åˆæ¡†æ¶ä¸­çš„ deque ç±»å®ç°äº†ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„åŒç«¯é˜Ÿåˆ—ï¼Œæ”¯æŒåœ¨ O(1) æ—¶é—´å†…ä»ä¸¤ç«¯æ’å…¥å’Œåˆ é™¤ã€‚è€ƒè™‘åˆ°åŒç«¯æ“ä½œï¼Œæ‚¨å¯ä»¥å°†è¿™äº›æ•°æ®ç»“æ„ç”¨ä½œé˜Ÿåˆ—å’Œå †æ ˆã€‚åœ¨å†…éƒ¨ï¼ŒPython ä¸­çš„åŒç«¯é˜Ÿåˆ—è¢«å®ç°ä¸ºåŒå‘é“¾è¡¨ï¼Œåœ¨æ’å…¥å’Œåˆ é™¤æ“ä½œä¸­ä¿æŒä¸€è‡´çš„æ€§èƒ½ï¼Œä½†åœ¨éšæœºè®¿é—®å †æ ˆä¸­çš„ä¸­é—´å…ƒç´ çš„ O(n) æ€§èƒ½æ–¹é¢è¡¨ç°ä¸ä½³

from collections import  deque

    # dequeæ˜¯ä¸ºäº†é«˜æ•ˆå®ç°æ’å…¥å’Œåˆ é™¤æ“ä½œçš„åŒå‘åˆ—è¡¨
    #  æ˜¯ä¸ºäº†å¼¥è¡¥ list  æ’å…¥å’Œåˆ é™¤æ•ˆç‡å¾ˆä½ çš„ç¼ºç‚¹
    q = deque(['a', 'b', 'c'])
    q.append('d')
    q.appendleft('e')
    print(q)  # deque(['e', 'a', 'b', 'c', 'd'])

    q.pop()
    q.popleft()

    # å›ºå®šçª—å£æ—‹è½¬ï¼Œ   æ­£æ•°åˆ™æ•°å­—åœ†ç›˜å¾€å³è½¬
    d = deque([a, b, c])
    d.rotate(1)     # [c, a, b]
    m = deque([a, b, c])
    m.rotate(-1)  # è´Ÿæ•°å¾€å·¦è½¬     [b, c, a]


def tail(filename, n):
    """return the last n lines of a file"""
    with open(filename, 'r') as f:
        return deque(f, n)  # åŸç†æ˜¯å°† f è¿­ä»£å‡ºçš„æ¯è¡Œå…¥æ ˆï¼Œ ä¼šä¿ç•™æœ€å n è¡Œ



# è½®è¯¢
# roundrobin('abc', 'd', 'ef') --> [a d e b d f c]
def roundrobin(*iterables):
    iters = deque(map(iter, iterables)) # å°†å‚æ•°è½¬ä¸º iter é˜Ÿåˆ—
    while iters:
        try:
            while True:
                yield next(iters[0])
                iters.rotate(-1)
        except StopException:
            iters.popleft()

```

#### queue.Queue é˜»å¡é˜Ÿåˆ—

#### queue.LifoQueue é˜»å¡æ ˆ

#### multiprocessing.Queue è·¨è¿›ç¨‹é˜»å¡é˜Ÿåˆ—

```python

# multiprocessing æ˜¯ä¸€ä¸ªæ”¯æŒç”Ÿæˆè¿›ç¨‹çš„åŒ…
# é€šè¿‡ä½¿ç”¨å­è¿›ç¨‹è€Œä¸æ˜¯çº¿ç¨‹æ¥æœ‰æ•ˆåœ°å›é¿å…¨å±€è§£é‡Šå™¨é”ï¼ˆ ç»•å¼€ GILï¼‰ã€‚å› æ­¤ï¼Œmultiprocessingæ¨¡å—å…è®¸å¼€å‘äººå‘˜å……åˆ†åˆ©ç”¨ç»™å®šæœºå™¨ä¸Šçš„å¤šä¸ªå¤„ç†å™¨ã€‚å®ƒå¯ä»¥åœ¨ Unix/Linux å’Œ Windows ä¸Šè¿è¡Œã€‚

# multiprocessing.Queue  è·¨è¿›ç¨‹å…±äº«æ•°æ®
```

#### queue.PriorityQueue heapq ä¼˜å…ˆçº§é˜Ÿåˆ—

```python
# heapq åŒ…æä¾›äº†å †ä¼˜å…ˆçº§çš„ç®—æ³•
import heapq as hq
items = []
hq.heappush(items, (2, 'a'))
hq.heappush(items, (1, 'b'))
hq.heappush(items, (4, 'c'))
while items:
    it = hq.heappop(items)
    print(it)
# (1, 'b')
# (2, 'a')
# (4, 'c')


from queue import PriorityQueue

pq = PriorityQueue()
pq.put(2, 'a') # ä¹Ÿå¯ä»¥å•çº¯ put æ•°å­—ï¼Œ é‚£ä¹ˆpop çš„é¡ºåºæ˜¯æŒ‰ç…§ indexï¼Œ å°çš„å…ˆ pop å‡ºæ¥
pq.put(1, 'b')
while not pq.empty():
    it = pq.get()
    print(it)


```

###  å­—å…¸ dict

#### åŸºæœ¬ dict

```py
# Dict é”®å€¼å­˜å‚¨
    #
    # å’Œ list æ¯”è¾ƒï¼Œdict æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š
    #
    # 1.  æŸ¥æ‰¾å’Œæ’å…¥çš„é€Ÿåº¦æå¿«ï¼Œä¸ä¼šéšç€ key çš„å¢åŠ è€Œå˜æ…¢ï¼›
    # 2.  éœ€è¦å ç”¨å¤§é‡çš„å†…å­˜ï¼Œå†…å­˜æµªè´¹å¤šã€‚
    # 3.  Key æ˜¯ä¸å¯å˜å¯¹è±¡ (å¦‚å­—ç¬¦ä¸²ï¼Œ æ•°ç»„ï¼Œ å…ƒç»„)
    #     éœ€è¦æˆ‘ä»¬è‡ªå·±åœ¨ä»£ç ä¸­ä¿è¯ , å› ä¸ºdictæ ¹æ®keyæ¥è®¡ç®—valueçš„å­˜å‚¨ä½ç½®ï¼Œå¦‚æœæ¯æ¬¡è®¡ç®—ç›¸åŒçš„keyå¾—å‡ºçš„ç»“æœä¸åŒï¼Œé‚£dictå†…éƒ¨å°±å®Œå…¨æ··ä¹±äº†
    #     åœ¨Pythonä¸­ï¼Œå­—ç¬¦ä¸²ã€æ•´æ•°ç­‰éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤ï¼Œå¯ä»¥æ”¾å¿ƒåœ°ä½œä¸ºkeyã€‚è€Œlistæ˜¯å¯å˜çš„ï¼Œå°±ä¸èƒ½ä½œä¸ºkey
    # 
    #   å¦‚æœéœ€è¦è‡ªå®šä¹‰å¯¹è±¡ä½œä¸º key, éœ€è¦ä¿è¯è¿™ä¸ªç±»çš„ä¸¤ä¸ªå¯¹è±¡çš„ __eq__ ä¸åŒ
# 
    #
    # è€Œ list ç›¸åï¼š
    # 1.  æŸ¥æ‰¾å’Œæ’å…¥çš„æ—¶é—´éšç€å…ƒç´ çš„å¢åŠ è€Œå¢åŠ ï¼›
    # 2.  å ç”¨ç©ºé—´å°ï¼Œæµªè´¹å†…å­˜å¾ˆå°‘ã€‚
    # æ‰€ä»¥ï¼Œdict æ˜¯ç”¨ç©ºé—´æ¥æ¢å–æ—¶é—´çš„ä¸€ç§æ–¹æ³•ã€‚
    #
    # åˆ›å»º
    d = {'Michael': 95, 'Bob': 75, 'Tracy': 85}

    # è·å–å€¼ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šæŠ¥é”™
    d['Michael'] # 95
    # æˆ–è€…é€šè¿‡getæ–¹æ³•ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œä¸ä¼šæŠ¥é”™ï¼Œåªä¼šè¿”å›None
    d.get('Thomas')
    d.get('Thomas', -1)
    # -1

    # # æ·»åŠ /è®¾ç½®é”®å€¼å¯¹
    d['Adam'] = 67
    d['Adam']
    # 67

    # æ·»åŠ ç›¸åŒçš„é”®ï¼Œä¼šå†²æ‰å·²å­˜åœ¨çš„
    d['Tracy'] = 90
    d['Tracy']
    # 90

    # è®¾ç½®å€¼ï¼ˆå¸¦é»˜è®¤ï¼‰
    d.setdefault('a', 0)  # è‹¥ â€˜aâ€™ keyä¸å­˜åœ¨ï¼Œ åˆ™è®¾ç½®value ä¸º0

    # æ·»åŠ /æ›´æ–°
    d.update('aa'=11, 'bb'=22)

    # é”®æ˜¯å¦å­˜åœ¨
    'Thomas' in d
    # False

    
    # # åˆ é™¤
    d.pop('Bob')
    # 75

    d
    # {'Michael': 95, 'Tracy': 85}


    #
    # è¿­ä»£ éå† dict
    #
    d = {'a': 1, 'b': 2, 'c': 3}
    for key in d:
        print(key)
    for value in d.values():
        print(value)
    # åŒæ—¶è¿­ä»£keyå’Œvalueï¼Œè¿™ç§å¤ªéº»çƒ¦ï¼Œä¸æ¨è
    for key in d:
        print(key + ': ' + str(d.get(key)))

    for key,value in d.items():
        print(key, str(value))
    
```

#### å­—å…¸è§£åŒ…

```python

data = {
    'arr': [{
        'name': 'aa',
        'age': 12,
    }, {
        'name': 'bb',
        'age': 11,
    }]
}
class Person():
    def __init__(self, name, age):
        self.name = name
        self.age = age

persons = []
for ele in data['arr']:
    persons.appand(Person(**ele)) # è¿™é‡Œæ˜¯å°†å­—å…¸è§£åŒ…ä¸º key=value çš„å½¢å¼

```

#### å­—å…¸æ ¼å¼åŒ–

```python

print(m)   # ä¸€è¡Œä¸­æ‰“å°ï¼Œ æ— ç¼©è¿›ï¼Œä¸å¥½çœ‹

import json
json_str_with_indent = json.dumps(m, indent=4, sort_keys=False, ensure_ascii=False)
print(json_str_with_indent)


install pyyaml
import yaml
string = yaml.dump(m, allow_unicode=True)

```

#### defaultdict é»˜è®¤å€¼dict

```python

# defaultdict æ˜¯ dict å­ç±»ï¼Œ
    # ä½¿ç”¨dictæ—¶ï¼Œå¦‚æœå¼•ç”¨çš„Keyä¸å­˜åœ¨ï¼Œå°±ä¼šæŠ›å‡ºKeyErrorã€‚å¦‚æœå¸Œæœ›keyä¸å­˜åœ¨æ—¶ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå°±å¯ä»¥ç”¨defaultdict


from collections import defaultdict

di = defaultdict(list) # è¿™é‡Œ list æ˜¯ä¼ å…¥çš„ä¸€ä¸ªå‡½æ•°(è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªå‡½æ•° / lambda è¡¨è¾¾å¼)ï¼Œ è‹¥æŸä¸ªé”®ä¸å­˜åœ¨ï¼Œ è¿™è°ƒç”¨è¿™ä¸ªå‡½æ•°ä½œä¸ºé»˜è®¤å€¼
di['missing_key'].append('a')
di['missing_key'].append('b')
di['missing_key'].append(123)
di['missing_key']
# ['a', 'b', 123]

# ç»Ÿè®¡å­—ç¬¦ä¸ªæ•°
s = 'abcaab'
count_mapping = defaultdict(int)
for si in s:
    count_mapping[si] += 1


# eg: ç¼ºå¤±æç¤º
def missing_prompt(value):
    return lambda: value
d = defaultdict(missing_prompt('<missing>'))
d['unknown'] # 'missing'
```

#### OrderedDict å­—å…¸æ’åº

```python

py2 å­—å…¸ä¸ä¿è¯æœ‰åºï¼Œ
py3 å­—å…¸é»˜è®¤æŒ‰ç…§æ’å…¥é¡ºåºæ’åº

 å¯é€šè¿‡ä½¿ç”¨ OrderedDict æ¥ä¿è¯æœ‰åº


    d = {'a': 100, 'c': 200, 'b': 300}
    # å¦‚ä½•æŒ‰ç…§ key æ’åº
    d2 = sorted(d)  # ç­‰ä»·     d2 = sorted(d.keys())
    print(d2) # ['a', 'b', 'c']

    # é€†åº
    sorted(d, reverse=True)

    d3 = sorted(d.items()) # å…ƒç»„æ’åºé¦–å…ˆæ¯”è¾ƒç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ ç¬¬ä¸€ä¸ªå…ƒç´ ç›¸åŒå†æ¯”è¾ƒç¬¬äºŒä¸ªå…ƒç´ 
    print(d3) # [('a', 100), ('b', 300), ('c', 200)]
    
    # æŒ‰ç…§ value æ’åº
    d4 = sorted(d.items(), key=lambda x: x[1]) 
    # ç­‰ä»·
    d4 =sorted(d.items(), key=operator.itemgetter(1))  
    print(d4) # [('a', 100), ('c', 200), ('b', 300)]
    



from collections import OrderedDict

# åˆ›å»ºä¸€ä¸ªæœ‰åºå­—å…¸
od = OrderedDict()
od['first'] = 1
od['second'] = 2
od['third'] = 3

print(od)  # OrderedDict([('first', 1), ('second', 2), ('third', 3)])

# éå†æœ‰åºå­—å…¸
for key, value in od.items():
    print(key, value)


od.move_to_end('banana')  # å°† 'banana' ç§»åŠ¨åˆ°æœ«å°¾
od.move_to_end('orange', last=False)  # å°† 'orange' ç§»åŠ¨åˆ°å¼€å¤´

od.popitem()  # é»˜è®¤ç§»é™¤å¹¶è¿”å›æœ€åä¸€ä¸ªé”®å€¼å¯¹ ('orange', 2)ï¼Œ ç±»æ¯”æ ˆç»“æ„
od.popitem(last=False)  # ç§»é™¤å¹¶è¿”å›ç¬¬ä¸€ä¸ªé”®å€¼å¯¹ ('banana', 3) ï¼Œ ç±»æ¯”é˜Ÿåˆ—ç»“æ„
```

#### åˆå¹¶å¤šä¸ªå­—å…¸

##### å†…ç½®æ–¹æ³•åˆå¹¶

```python

# å°†åæ¥çš„ map è¦†ç›–åˆ°å‰é¢çš„ map é‡Œ
m.update(m1).update(m2)


m3 = dict(m1, **m2) # é€šè¿‡**è§£åŒ…ä¸€æ¬¡åˆå¹¶ä¸¤ä¸ª ï¼ˆè§£åŒ…ç¬¦å·é€Ÿåº¦å¿«ï¼Œç‰¹åˆ«æ˜¯å¤§å‹å­—å…¸ï¼ŒPython ä¸­å¯¹**æœ‰ä¼˜åŒ–ï¼‰

m4 = {           # ä¸€æ¬¡åˆå¹¶å¤šä¸ª
    **m1,
    **m2,
    **m3
}
```

##### ChainMap æä¾›åŠ¨æ€è§†å›¾ é¦–ä¸ª dict å¯ä¿®æ”¹


```python
# ChainMap æ˜¯å¤„ç†å¤šå±‚æ¬¡æ˜ å°„å’Œä¼˜å…ˆçº§åˆå¹¶çš„å¼ºå¤§å·¥å…·ï¼Œèƒ½å¤Ÿåœ¨ä¸æ”¹å˜åŸå§‹æ•°æ®ç»“æ„çš„æƒ…å†µä¸‹æä¾›åŠ¨æ€è§†å›¾ã€‚

# æ›´æ–°æ“ä½œï¼šChainMap åªä¼šå½±å“ç¬¬ä¸€ä¸ªå­—å…¸ï¼Œå³é“¾ä¸­ç¬¬ä¸€ä¸ªæ˜ å°„ã€‚
# å¯¹äºæŸ¥æ‰¾æ“ä½œï¼šChainMap ä¼šä»å·¦åˆ°å³ä¾æ¬¡æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…çš„é”®ä¸ºæ­¢ã€‚è‹¥è¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œ ä¼š KeyError


from collections import ChainMap

# åˆ›å»ºä¸¤ä¸ªå­—å…¸
dict1 = {'a': 1, 'b': 2}
dict2 = {'b': 3, 'c': 4}

# ä½¿ç”¨ ChainMap å°†å®ƒä»¬åˆå¹¶
chain_map = ChainMap(dict1, dict2)
print(chain_map)  # ChainMap({'a': 1, 'b': 2}, {'b': 3, 'c': 4})

# è®¿é—®å…ƒç´ 
print(chain_map['a'])  # 1
print(chain_map['b'])  # 2  # ä»ç¬¬ä¸€ä¸ªå­—å…¸ä¸­æ‰¾åˆ° 'b'
print(chain_map['c'])  # 4  # ä»ç¬¬äºŒä¸ªå­—å…¸ä¸­æ‰¾åˆ° 'c'

# æ›´æ–°
chain_map['b'] = 10
# åˆ é™¤æ“ä½œ
del chain_map['a']


# æ–°çš„å­æ˜ å°„
#  new_child æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å­æ˜ å°„ï¼Œå®ƒå°†ä¸€ä¸ªæ–°çš„å­—å…¸æ·»åŠ åˆ°ç°æœ‰çš„é“¾ä¸­ã€‚è¿™å¯¹äºéœ€è¦ä¸´æ—¶è¦†ç›–æŸäº›å€¼æˆ–æä¾›å±€éƒ¨å˜é‡éå¸¸æœ‰ç”¨ã€‚
# å¦‚ é…ç½®ç®¡ç†ï¼Œåˆå¹¶å¤šä¸ªé…ç½®æ–‡ä»¶æˆ–é…ç½®æºã€‚
new_chain = chain_map.new_child({'a': 42, 'e': 99})
print(new_chain)  # ChainMap({'a': 42, 'e': 99}, {'b': 10, 'd': 5}, {'b': 3, 'c': 4})

print(new_chain['a'])  # 42
print(new_chain['b'])  # 10
print(new_chain['e'])  # 99

```

#### MappingProxyType åªè¯»è§†å›¾

```python
from types import MappingProxyType
# åˆ›å»ºä¸€ä¸ªå­—å…¸
original_dict = {'a': 1, 'b': 2}
# åˆ›å»ºå­—å…¸çš„åªè¯»è§†å›¾
read_only_dict = MappingProxyType(original_dict)
# è®¿é—®å…ƒç´ 
print(read_only_dict['a'])  # 1

# å°è¯•ä¿®æ”¹å…ƒç´ ä¼šå¼•å‘ TypeError
# åªæ˜¯æµ…æ‹·è´äº†åŸæ¥çš„å­—å…¸ï¼Œæ‰€ä»¥å¦‚æœå€¼æ˜¯å¼•ç”¨çš„è¯ï¼Œä¿®æ”¹å€¼çš„å†…å®¹ä¹Ÿæ˜¯ä¼šå½±å“åˆ°æºçš„ï¼
# è‹¥çœŸæ­£å®ç°ä¸å¯å˜  --> frozendict
try:
    read_only_dict['a'] = 3
except TypeError as e:
    print(e)  # 'mappingproxy' object does not support item assignment


# å¦‚æœä¿®æ”¹åŸå§‹å­—å…¸ï¼ŒMappingProxyType çš„è§†å›¾ä¹Ÿä¼šéšä¹‹æ›´æ–° (è¯»å†™åˆ†ç¦»)
# ä¿®æ”¹åŸå§‹å­—å…¸
original_dict['a'] = 3
print(read_only_dict['a'])  # 3
# æ·»åŠ æ–°å…ƒç´ 
original_dict['c'] = 4
print(read_only_dict['c'])  # 4

```


#### Counter é€šè¿‡å­—å…¸è¡¨ç¤ºåˆ—è¡¨

```python
    c = Counter('aabbbc')
    print(list(c.elements())) # ['a', 'a', 'b', 'b', 'b', 'c']

    c = Counter({'a': 2, 'b': 1})
    print(list(c.elements())) # [a a b]
    len(c)  # 2
    sum(c.values()) # 3

    c = Counter(a=2, b=1)
    print(list(c.elements())) # ['a', 'a', 'b']
```


#### dict åœºæ™¯

##### æ¨¡æ‹Ÿ switch case

```python

def calc(v1, v2, op_flag):
    ops = {
        '+': operator.add,
        '-': operator.sub,
        '*': operator.mul,
        '/': operator.truediv,
    }
    return ops[op_flag](v1, v2)

```

#### dict å­—å…¸æ¨å¯¼å¼

```python
@dataclass
class Person:
    name: str
    age: int

users = [Person('a', 11), Person('b', 22)]
# å¯ä»¥ç±»æ¯”åˆ—è¡¨æ¨å¯¼å¼
age_mapping = { user.name: user.age
    for user in users if user.age != 0
}
```

### åˆ—è¡¨æ¨å¯¼å¼

```python

l = [x*x for x in range(3)] # [0, 1, 4]

def read_file(path: str) -> [str]:
    with open(path, 'r') as f:
        lines = [for line in f if line.startswith('<<')]
    return lines

# çœå†…å­˜
def read_file2(path: str) -> Generator[str]:
    with open(path, 'r') as f:
        for line in f:
            if line.startswith('<<'):
                yield line

```

### ç”Ÿæˆå™¨ generator

```py
# ç”Ÿæˆå™¨
å’Œ æ¨å¯¼å¼åŒºåˆ«ï¼š æ¨å¯¼å¼ä¼šä¸€ä¸‹å°†åˆ—è¡¨å†…å®¹ç”Ÿæˆå‡ºæ¥ï¼Œ å ç”¨å†…å­˜é«˜
              ç”Ÿæˆå™¨åœ¨ next(gen) çš„æ—¶å€™æ‰ä¼šç”Ÿæˆå‡ºä¸€ä¸ªå…ƒç´  ï¼ˆå³â€˜æƒ°æ€§è®¡ç®—â€™ç‰¹æ€§ï¼‰ï¼Œ èŠ‚çœå†…å­˜ ï¼ˆè¯»å–å¤§æ–‡ä»¶çš„æ—¶å€™å¯ç”¨è¿™ä¸ªæ–¹å¼ï¼‰


    #
    # æŠŠä¸€ä¸ªåˆ—è¡¨ç”Ÿæˆå¼çš„[]æ”¹æˆ()ï¼Œå°±åˆ›å»ºäº†ä¸€ä¸ªgenerator
    # è¦è·å– generator å†…çš„å€¼ï¼Œ éœ€ next(gen) , æˆ–è€… for i in xxx_gen
    gen = (x for x in range(3))
    i = next(gen) # 0
    j = next(gen) # 1
    k = next(gen) # 2
    # m = next(gen)   # error : StopIteration
    print(i, j, k)
    
    #
    # æˆ–è€… , å¦‚æœä¸€ä¸ªå‡½æ•°å®šä¹‰ä¸­åŒ…å«yieldå…³é”®å­—ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±ä¸å†æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªgenerator
    def get_gen():
        for i in range(2):
            yield i
        # æ‹¿ä¸åˆ°generatorçš„returnè¯­å¥çš„è¿”å›å€¼ã€‚å¦‚æœæƒ³è¦æ‹¿åˆ°è¿”å›å€¼ï¼Œå¿…é¡»æ•è·StopIterationé”™è¯¯ï¼Œè¿”å›å€¼åŒ…å«åœ¨StopIterationçš„valueä¸­
        return 'done' 
    gen1 = get_gen()
    g1 = next(gen1) # 0
    g2 = next(gen1) # 1
    print(g1, g2)
    try:
        r = next(gen1)
    except Exception as e:
        print(str(e)) # 'done'
    #
    # å‡½æ•°åŒºåˆ«:generatorå’Œå‡½æ•°çš„æ‰§è¡Œæµç¨‹ä¸ä¸€æ ·ã€‚å‡½æ•°æ˜¯é¡ºåºæ‰§è¡Œï¼Œ
    # é‡åˆ°returnè¯­å¥æˆ–è€…æœ€åä¸€è¡Œå‡½æ•°è¯­å¥å°±è¿”å›ã€‚è€Œå˜æˆ
    # generatorçš„å‡½æ•°ï¼Œåœ¨æ¯æ¬¡è°ƒç”¨next()çš„æ—¶å€™æ‰§è¡Œ(å¦‚ next(g))ï¼Œé‡
    # åˆ°yieldè¯­å¥è¿”å›ï¼Œå†æ¬¡æ‰§è¡Œæ—¶ä»ä¸Šæ¬¡è¿”å›çš„yieldè¯­å¥å¤„ç»§ç»­æ‰§è¡Œ
    #
    
    


    # æ–æ³¢æ‹‰å¥‘æ•°åˆ—
    def fib(max):
        n, a, b = 0, 0, 1
        while n < max:
            yield b
            a, b = b, a + b
            n = n + 1
        return 'done' 
    for n in fib(6):
        print(n)

```

### è¿­ä»£å™¨


```py
åœ¨ç”¨ for..in.. è¿­ä»£å¯¹è±¡æ—¶ï¼Œè§£é‡Šå™¨å…ˆæ£€æŸ¥è¢«è¿­ä»£ç›®æ ‡æ˜¯å¦æœ‰ __iter__ or __next__ æ–¹æ³•
å¦‚æœå¯¹è±¡æ²¡æœ‰å®ç° __iter__ __next__ è¿­ä»£å™¨åè®®ï¼ŒPythonçš„è§£é‡Šå™¨å°±ä¼šå»å¯»æ‰¾__getitem__ , __len__ æ¥è¿­ä»£å¯¹è±¡ï¼Œ
å¦‚æœè¿__getitem__, __len__ éƒ½æ²¡æœ‰å®šä¹‰ï¼Œè¿™è§£é‡Šå™¨å°±ä¼šæŠ¥å¯¹è±¡ä¸æ˜¯è¿­ä»£å™¨çš„é”™è¯¯

__iter__  å†…å­˜æ¶ˆè€—å°‘, ä¾æ¬¡è¯»å–åˆ°å†…å­˜, ä½†æ˜¯éšæœºè®¿é—®æ•ˆç‡å·®
__getitem__  å…ˆç”¨å†…å­˜å¸ƒç½®å¥½æ•°æ®, å†…å­˜æ¶ˆè€—å¤§, ä½†éšæœºè®¿é—®æ•ˆç‡é«˜




å®ç°äº†é­”æœ¯æ–¹æ³• __iter__, __next__, å³ä¸º è¿­ä»£å™¨, è‹¥ä»…ä»…å®ç°äº† iter (iter è¿”å›ä¸€ä¸ªå¯¹è±¡, è¯¥å¯¹è±¡å®ç°äº† __next__), åªèƒ½è§†ä¸º å¯è¿­ä»£å¯¹è±¡(iterable). 
è‹¥ä¸º iterator, ä¸€å®šä¸º iterable, åä¹‹ä¸ä¸€å®š

å®ç°äº†é­”æœ¯æ–¹æ³• `__getitem__`, å³ä¸º å¯è¿­ä»£å¯¹è±¡



åŒºåˆ«:  å½“ä¸ºç´¢å¼•è¡Œæ•°æ®ç±»å‹ï¼ˆå¦‚ï¼šlist, tuple,str)æ—¶ï¼Œå¯ä»¥æ›¿æ¢ï¼Œå½“å­—æ®µä¸ºhashå‹ç±»å‹ï¼ˆå¦‚dict,set)æ—¶ï¼Œä¸èƒ½æ›¿æ¢







import datetime
class DateRange():
    def __init__(self, start, end):
    	self.start = start
        self.end = end
        self._cur = start

    def __iter__(self):
        return self
    
    def __next__(self):
        if self._cur >= self.end:
            raise StopIteration
        
        res = self._cur

        self._cur += datetime.timedelta(days=1)
        
        return res
    




class DateRange():
    def __init__(self, start, end):   
    	
        self.start = start
        self.end = end
        self._all = self._get_all()

    def _get_all(self):
        res = []
        
        cur = self.start
        while cur < self.end:
            res.append(cur)
            cur += datetime.timedelta(days=1)
        
        return res
    
    def __len__(self):
        return len(self._all)
    
    def __getitem__(self, index):
        return self._all[index]

```




### äºŒè¿›åˆ¶ç»“æ„å°åŒ…è§£åŒ…

```python
from struct import Struct
my_struct = Struct('i?f') # i - int, ? - bool, f - float
data = my_struct.pack(11, False, 11.11)
print(data) # b'f\x00\xx....'  , æ­¤æ—¶ï¼Œ data å¯ä»¥è¢«å‘é€å‡ºå»äº†
un_data = my_struct.unpack(data)
print(un_data) # (11, False, 11.11)
```


### SimpleNamespace åˆ›å»ºç®€å•ç±»

```python
from types import SimpleNamespace

sn = SimpleNamespace(a=1, b=[1, 2], c(3,))
sn1 = SimpleNamespace(a=1, b=[1, 2], c(3,))
assert sn == sn1   #true        é€šè¿‡å†…éƒ¨å€¼è¿›è¡Œæ¯”è¾ƒçš„

class Person(SimpleNamespace):
    # é‡å†™
    def __repr__(self):
        xxxxx

```


### container å®¹å™¨

```python

# Python ä¸­å®ç° __contains__ é­”æœ¯æ–¹æ³•å¹¶è¿”å›çœŸå€¼çš„å¯¹è±¡ç§°ä¸ºå®¹å™¨ã€‚å®ƒé€šå¸¸ä¸ in è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ä»¥æ£€æŸ¥æˆå‘˜æ˜¯å¦å­˜åœ¨
# Pythonå†…å»ºçš„å®¹å™¨: tupleã€listã€setã€dictç­‰
# æµ‹è¯•ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œåº”è¯¥ä½¿ç”¨ isinstance(x, collections.abc.Container) ã€‚


```


## ä½œç”¨åŸŸ

```python
# åŒ…çº§ä½œç”¨åŸŸ, åŒ…è¢«å¯¼å…¥åˆ™è‡ªåŠ¨æ‰§è¡Œ
hehe=6

def var_demo():
    # ä½œç”¨åŸŸå
    # å‡½æ•°å®šä¹‰äº†æœ¬åœ°ä½œç”¨åŸŸï¼Œè€Œæ¨¡å—å®šä¹‰çš„æ˜¯å…¨å±€ä½œç”¨åŸŸ, å¦‚æœæƒ³è¦åœ¨å‡½æ•°å†…å®šä¹‰/ä¿®æ”¹å…¨å±€ä½œç”¨åŸŸï¼Œéœ€è¦åŠ ä¸Šglobalä¿®é¥°ç¬¦
    global hehe
    print(hehe) # 6
    hehe=3 # ä¿®æ”¹
    pass


```


## æ¡ä»¶å¾ªç¯

```py
def condition_loop():
    """
    æ¡ä»¶ å¾ªç¯
    """
    names = ['Michael', 'Bob', 'Tracy']
    for name in names:
        print(name)

    fruits = ['banana', 'apple',  'mango']
    for index in range(len(fruits)):
        print('å½“å‰æ°´æœ :', fruits[index])

    count = 0
    while (count < 9):
        print ('The count is:', count)
        count = count + 1
```

## æ¯”è¾ƒåˆ¤æ–­

```py
# åœ¨pythonä¸­ None, False, ç©ºå­—ç¬¦ä¸²"", 0, ç©ºåˆ—è¡¨[], ç©ºå­—å…¸{}, ç©ºå…ƒç»„()éƒ½ç›¸å½“äºFalse
# (ob1 is ob2) ç­‰ä»·äº (id(ob1) == id(ob2))

# åˆ¤ç©º
if x is None
if x is not None


```

## å‡½æ•°

### å†…ç½®å‡½æ•°

```python

next(xxx_generator)   # è°ƒç”¨ä¸€æ¬¡ç”Ÿæˆå™¨

sum_a = sum([1, 2])   # 3 å¯¹åˆ—è¡¨æ±‚å’Œ

map(), filter()
list_b = list(map(lambda x: x * 2, xxx_list))   # å»ºè®®ç”¨åˆ—è¡¨æ¨å¯¼ä»£æ›¿
list_a = list(filter(xxx_predicate, xxx_list))

all() å…ƒç´ å‡ä¸º true, any()
def exist_zero(iter: iterable) -> bool: # åˆ¤æ–­æ˜¯å¦å­˜åœ¨ 0 ï¼Œ ï¼ˆ0 å³ä¸º falseï¼‰
    return not all(iter)

```

### å‚æ•°æ£€æŸ¥

```py
def function_demo():
    # å‚æ•°æ£€æŸ¥ç±»å‹
    def my_abs(x):
        if not isinstance(x, (int, float)):
            raise TypeError('bad operand type')
        if x >= 0:
            return x
        else:
            return -x

    # * æ£€æŸ¥å‚æ•°æœ‰æ•ˆæ€§
    def person(name, age, **kw):
        if 'city' in kw:
            # æœ‰cityå‚æ•°
            pass
        if 'job' in kw:
            # æœ‰jobå‚æ•°
            pass
        print('name:', name, 'age:', age, 'other:', kw)

```

### å¤šç§å‚æ•°

```py

    # å‚æ•°é¡ºåº
    #
    #å¿…é€‰å‚æ•°ã€é»˜è®¤å‚æ•°ã€å¯å˜å‚æ•°ã€å‘½åå…³é”®å­—å‚æ•°ã€å…³é”®å­—å‚æ•°
    #
    # å®šä¹‰
    # c ä¸ºé»˜è®¤å‚æ•°
    # *args ä¸º å¯å˜å‚æ•°, ä¸ªæ•°å¯å˜, å‡½æ•°å†…éƒ¨è‡ªåŠ¨ç»„è£…ä¸º tuple
    # **kw  å…³é”®å­—å‚æ•°, å†…éƒ¨è‡ªåŠ¨ç»„è£…ä¸ºä¸€ä¸ª dict
    #
    # æ‰€ä»¥ï¼Œå¯¹äºä»»æ„å‡½æ•°ï¼Œéƒ½å¯ä»¥é€šè¿‡ç±»ä¼¼func(*args, **kw)çš„å½¢å¼è°ƒç”¨å®ƒï¼Œæ— è®ºå®ƒçš„å‚æ•°æ˜¯å¦‚ä½•å®šä¹‰çš„ã€‚
    #
    from typing import Optional
    def f1(a, b, c: Optional[int]=0, *args, **kw):
        print('a =', a, 'b =', b, 'c =', c, 'args =', args, 'kw =', kw)

    def f2(a, b, c=0, *, d, **kw):
        print('a =', a, 'b =', b, 'c =', c, 'd =', d, 'kw =', kw)
    # è°ƒç”¨
    # >>> f1(1, 2)
    # a = 1 b = 2 c = 0 args = () kw = {}
    # >>> f1(1, 2, c=3)
    # a = 1 b = 2 c = 3 args = () kw = {}
    # >>> f1(1, 2, 3, 'a', 'b')
    # a = 1 b = 2 c = 3 args = ('a', 'b') kw = {}
    # >>> f1(1, 2, 3, 'a', 'b', x=99)
    # a = 1 b = 2 c = 3 args = ('a', 'b') kw = {'x': 99}
    # >>> f2(1, 2, d=99, ext=None)
    # a = 1 b = 2 c = 0 d = 99 kw = {'ext': None}

    # é€šè¿‡ä¸€ä¸ªtupleå’Œdictï¼Œä½ ä¹Ÿå¯ä»¥è°ƒç”¨ä¸Šè¿°å‡½æ•°ï¼š
    # >>> args = (1, 2, 3, 4)
    # >>> kw = {'d': 99, 'x': '#'}
    # >>> f1(*args, **kw)
    # a = 1 b = 2 c = 3 args = (4,) kw = {'d': 99, 'x': '#'}
    # >>> args = (1, 2, 3)
    # >>> kw = {'d': 88, 'x': '#'}
    # >>> f2(*args, **kw)
    # a = 1 b = 2 c = 3 d = 88 kw = {'x': '#'}

    #
    # å‘½åå…³é”®å­—å‚æ•°
    #å¯ä»¥é™åˆ¶ä¼ å…¥çš„å‚æ•°çš„é”®
    #ä¾‹å¦‚ï¼Œåªæ¥æ”¶ city å’Œ job ä½œä¸ºå…³é”®å­—å‚æ•°ã€‚è¿™ç§æ–¹å¼å®šä¹‰çš„å‡½æ•°å¦‚ä¸‹ï¼š
    #
    def person1(name, age, *, city, job):# * ä½œä¸ºåˆ†éš”ç¬¦
        print(name, age, city, job)

    # # è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š
    # # å¿…éœ€è¦æœ‰å‚æ•°åï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¼šè§†ä¸ºæœ‰å››ä¸ªä½ç½®å‚æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°åªæœ‰ä¸¤ä¸ªä½ç½®å‚æ•°ï¼ŒæŠ¥é”™
    # >>> person1('Jack', 24, city='Beijing', job='Engineer')
    # Jack 24 Beijing Engineer
    #
    # å¦‚æœå‡½æ•°å®šä¹‰ä¸­å·²ç»æœ‰äº†ä¸€ä¸ªå¯å˜å‚æ•°ï¼Œåé¢è·Ÿç€çš„å‘½åå…³é”®å­—å‚æ•°å°±ä¸å†éœ€è¦ä¸€ä¸ªç‰¹æ®Šåˆ†éš”ç¬¦*äº†ï¼š
    #
    def person2(name, age, *args, city, job):
        print(name, age, args, city, job)

```

### é€’å½’

```py

    ###
    ##
    ## é€’å½’
    # å°¾é€’å½’ä¼˜åŒ–: ä½¿å¾— è¿”å›å€¼ä¸å«æœ‰è¡¨è¾¾å¼
    #
    # é˜¶ä¹˜
    def recu(n):
        if n == 1:
            return 1
        return n*recu(n-1) # è¿”å›å€¼å¸¦æœ‰è¡¨è¾¾å¼, ä¸å¥½
    # ä¼˜åŒ–å
    def fact(n):
        return fact_iter(n, 1)

    def fact_iter(num, product):
        if num == 1:
            return product
        return fact_iter(num - 1, num * product)

```


### é«˜é˜¶å‡½æ•°


```py
def map_reduce_closure_lambda():
    l = list(range(1,11))
    def f(x):
        return x*x
    r = map(f, l) # <map object at 0x10298b2d0>
    print("r = ", list(r))# r =  [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]
    r1 = map(str, l)
    print(list(r1)) # ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10']

    from functools import reduce
    l = [1, 2, 3]
    def add(x, y):
        return x+y
    r2 = reduce(add, l)
    print("r2 = ", r2) # 6


    n = sorted([36, 5, -12, 9, -21])
    print(n) # [-21, -12, 5, 9, 36]
    n1 = sorted(['bob', 'about', 'Zoo', 'Credit'],reverse=True, key=str.lower)
    print(n1) # ['Zoo', 'Credit', 'bob', 'about']

    def lazy_sum(*args):
        def sum():
            ax = 0
            for n in args:
                ax = ax + n
            return ax
        return sum
    f = lazy_sum(1, 3, 5, 7, 9)
    print("f() = ", f()) # 25

    lambda x: x*x


```

## æ–‡ä»¶å¤„ç†

### åˆ›å»ºæ–‡ä»¶

```py
def file_dir_demo():
    import os
    import sys
    print(os.name) # æ“ä½œç³»ç»Ÿç±»å‹, å¦‚æœæ˜¯posixï¼Œè¯´æ˜ç³»ç»Ÿæ˜¯Linuxã€Unixæˆ–Mac OS Xï¼Œå¦‚æœæ˜¯ntï¼Œå°±æ˜¯Windowsç³»ç»Ÿ
    print(os.environ.get('PATH', ['default Value'])) # åœ¨æ“ä½œç³»ç»Ÿä¸­å®šä¹‰çš„ç¯å¢ƒå˜é‡
    # æŸ¥çœ‹å½“å‰ç›®å½•çš„ç»å¯¹è·¯å¾„:
    print(os.path.abspath('.')) # /Users/xiaoyu/repo/code/back_end/python-demos

    # è·¯å¾„æ‹¼æ¥
    #
    # æŠŠä¸¤ä¸ªè·¯å¾„åˆæˆä¸€ä¸ªæ—¶ï¼Œä¸è¦ç›´æ¥æ‹¼å­—ç¬¦ä¸²ï¼Œè€Œè¦é€šè¿‡os.path.join()å‡½æ•°ï¼Œè¿™æ ·å¯ä»¥æ­£ç¡®å¤„ç†ä¸åŒæ“ä½œç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦
    #os.path.join('/Users/michael', 'testdir')
    #'/Users/michael/testdir'
    #
    # æ‹†åˆ†
    #
    # è¦æ‹†åˆ†è·¯å¾„æ—¶ï¼Œä¹Ÿä¸è¦ç›´æ¥å»æ‹†å­—ç¬¦ä¸²ï¼Œè€Œè¦é€šè¿‡os.path.split()å‡½æ•°ï¼Œè¿™æ ·å¯ä»¥æŠŠä¸€ä¸ªè·¯å¾„æ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåä¸€éƒ¨åˆ†æ€»æ˜¯æœ€åçº§åˆ«çš„ç›®å½•æˆ–æ–‡ä»¶å
    #>>> os.path.split('/Users/michael/testdir/file.txt')
    #('/Users/michael/testdir', 'file.txt')

    # åˆ›å»ºä¸€ä¸ªç›®å½•:
    #>>> os.mkdir('/Users/michael/testdir')
    # åˆ æ‰ä¸€ä¸ªç›®å½•:
    #>>> os.rmdir('/Users/michael/testdir')

    # æ–‡ä»¶æ‹“å±•å
    #
    # os.path.splitext()å¯ä»¥ç›´æ¥è®©ä½ å¾—åˆ°æ–‡ä»¶æ‰©å±•å
    # >>> os.path.splitext('/path/to/file.txt')
    # ('/path/to/file', '.txt')

    #  å¯¹æ–‡ä»¶é‡å‘½å:
    # >>> os.rename('test.txt', 'test.py')
    # åˆ æ‰æ–‡ä»¶:
    # >>> os.remove('test.py')

    # å¤åˆ¶æ–‡ä»¶
    #
    # shutilæ¨¡å—æä¾›äº†copyfile()çš„å‡½æ•°ï¼Œä½ è¿˜å¯ä»¥åœ¨shutilæ¨¡å—ä¸­æ‰¾åˆ°å¾ˆå¤šå®ç”¨å‡½æ•°ï¼Œå®ƒä»¬å¯ä»¥çœ‹åšæ˜¯osæ¨¡å—çš„è¡¥å……

    # åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•
    # os.listdir('.')
    #
    # >>> [x for x in os.listdir('.') if os.path.isdir(x)]
    # ['.lein', '.local', '.m2', '.npm', '.ssh', '.Trash', '.vim', 'Applications', 'Desktop', ...]

    # åˆ—å‡ºæ‰€æœ‰çš„.pyæ–‡ä»¶
    # >>> [x for x in os.listdir('.') if os.path.isfile(x) and os.path.splitext(x)[1]=='.py']
    # ['apis.py', 'config.py', 'models.py', 'pymonitor.py', 'test_db.py', 'urls.py', 'wsgiapp.py']

    # path è·¯å¾„ å¯¹æ¯”    
    #
    print(__file__)  # D:/repo/repo_github/shared_already/python-demos/module_test.py
    print(os.path.dirname(__file__))  # D:/repo/repo_github/shared_already/python-demos
    curPath = os.path.abspath(os.path.dirname(__file__))
    print(curPath)  # D:\repo\repo_github\shared_already\python-demos
    rootPath = os.path.split(curPath)[0]
    print(rootPath)  # D:\repo\repo_github\shared_already
    # sys.path.append(curPath)
    sys.path.append(rootPath)
    print(sys.path)


```

### è¯»å†™æ–‡ä»¶æ•°æ®

```py
def read_write_file():
    """
    open(file, mode='r', buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None)
        file: å¿…éœ€ï¼Œæ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹æˆ–è€…ç»å¯¹è·¯å¾„ï¼‰ã€‚
        mode: å¯é€‰ï¼Œæ–‡ä»¶æ‰“å¼€æ¨¡å¼
            r ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚æ–‡ä»¶çš„æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚è¿™æ˜¯é»˜è®¤æ¨¡å¼ã€‚
            x å†™æ¨¡å¼ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™ä¼šæŠ¥é”™ã€‚
            b äºŒè¿›åˆ¶æ¨¡å¼ã€‚
            w æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åªç”¨äºå†™å…¥ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚
            a æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚
            t æ–‡æœ¬æ¨¡å¼(é»˜è®¤)
            + æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œæ›´æ–°(å¯è¯»å¯å†™)ã€‚
        buffering: è®¾ç½®ç¼“å†²
            é€šè¿‡0ä»¥å…³é—­ç¼“å†²ï¼ˆä»…åœ¨äºŒè¿›åˆ¶æ¨¡å¼ä¸‹å…è®¸ï¼‰
            1 é€‰æ‹©è¡Œç¼“å†²ï¼ˆä»…åœ¨æ–‡æœ¬æ¨¡å¼ä¸‹å¯ç”¨ï¼‰
            å½“æœªç»™å‡ºbufferså‚æ•°æ—¶ï¼Œé»˜è®¤ç¼“å†²ç­–ç•¥å·¥ä½œå¦‚ä¸‹:
                
        encoding: ä¸€èˆ¬ä½¿ç”¨utf8
            å¦‚æœæœªæŒ‡å®šencodingï¼Œåˆ™ä½¿ç”¨çš„ç¼–ç å–å†³äºå¹³å°: locale.getpreferredencodingï¼ˆFalseï¼‰
        errors: æŠ¥é”™çº§åˆ«, å¸¸ç”¨ 'ignore'
        newline: åŒºåˆ†æ¢è¡Œç¬¦
            å¯ä»¥æ˜¯Noneã€''ã€'\n'ã€'\r'ã€'\r\n'
            è¯»å–æ•°æ®æ—¶, 
                å¦‚æœnewlineå‚æ•°ä¸ºNone, æ–‡ä»¶ä¸­çš„'\n'ï¼Œ'\r\n'ï¼Œ'\r'ï¼Œåœ¨è¿”è¿˜ç»™è°ƒç”¨è€…çš„æ—¶å€™éƒ½ä¼šè¢«è½¬åŒ–ä¸º'\n'
                å¦‚æœnewline = '', ä½†æ˜¯è¡Œçš„ç»“å°¾ç¬¦å·å¹¶ä¸ä¼šè¢«è½¬åŒ–
                å¦‚æœå®ƒå…·æœ‰ä»»ä½•å…¶å®ƒåˆæ³•å€¼ï¼Œåˆ™è¾“å…¥è¡Œä»…ç”±ç»™å®šå­—ç¬¦ä¸²ç»ˆæ­¢ï¼Œ
            å†™å…¥æ—¶
                å¦‚æœä¸è®¾ç½®newlineå‚æ•°, å³ä¸º None æ—¶, ä»»ä½•'\n'éƒ½ä¼šè¢«ç¿»è¯‘æˆå½“å‰ç³»ç»Ÿçš„line separatorï¼ˆä¹Ÿå°±æ˜¯os.linesep)
                å¦‚æœå‚æ•°ä¸º''æˆ–è€…'\n'ï¼Œä¸ä¼šæœ‰ä»»ä½•ç¿»è¯‘ã€‚
        closefd: ä¼ å…¥çš„fileå‚æ•°ç±»å‹
        opener:
    """
    f=None
    try:
        # read()ä¼šä¸€æ¬¡æ€§è¯»å–æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹ï¼Œå¦‚æœæ–‡ä»¶æœ‰10Gï¼Œå†…å­˜å°±çˆ†äº†ï¼Œ
        #æ‰€ä»¥ï¼Œè¦ä¿é™©èµ·è§ï¼Œå¯ä»¥åå¤è°ƒç”¨read(size)æ–¹æ³•ï¼Œæ¯æ¬¡æœ€å¤šè¯»å–sizeä¸ªå­—èŠ‚çš„å†…å®¹ã€‚
        # r è¡¨ç¤º æ¨¡å¼ä¸º åªè¯», è¿˜æœ‰ w å†™, rw è¯»å†™, rb/wb äºŒè¿›åˆ¶
        f = open('./readme.md', 'r')
        print(f.read())
    finally:
        if f:
            f.close()

    # å¦‚æœæ–‡ä»¶å¾ˆå°ï¼Œread()ä¸€æ¬¡æ€§è¯»å–æœ€æ–¹ä¾¿ï¼›å¦‚æœä¸èƒ½ç¡®å®šæ–‡ä»¶å¤§å°ï¼Œåå¤è°ƒç”¨read(size)æ¯”è¾ƒä¿é™©ï¼›å¦‚æœæ˜¯é…ç½®æ–‡ä»¶ï¼Œè°ƒç”¨readlines()æœ€æ–¹ä¾¿ï¼š
    # è¯»å–é…ç½®æ–‡ä»¶
    for line in f.readlines():
        print(line.strip()) # æŠŠæœ«å°¾çš„'\n'åˆ æ‰

    # æ›´å¥½çš„æ–¹æ³• ---- è‡ªåŠ¨å…³é—­ f
    #
    # ä½†æ˜¯æ¯æ¬¡éƒ½è¿™ä¹ˆå†™å®åœ¨å¤ªç¹çï¼Œæ‰€ä»¥ï¼ŒPythonå¼•å…¥äº†withè¯­å¥æ¥è‡ªåŠ¨å¸®æˆ‘ä»¬è°ƒç”¨close()
    with open('./readme.md', 'r') as f:
        print(f.read())


    #è¦è¯»å–éUTF-8ç¼–ç çš„æ–‡æœ¬æ–‡ä»¶ï¼Œéœ€è¦ç»™open()å‡½æ•°ä¼ å…¥encodingå‚æ•°
    # >>> f = open('/Users/michael/gbk.txt', 'r', encoding='gbk')
    # >>> f.read()
    # 'æµ‹è¯•'

    # é”™è¯¯å¤„ç†
    #ç›´æ¥å¿½ç•¥
    f = open('/Users/michael/gbk.txt', 'r', encoding='gbk', errors='ignore')

    # è¯»äºŒè¿›åˆ¶æ–‡ä»¶
    f = open('/Users/michael/test.jpg', 'rb')
    f.read()
    # b'\xff\xd8\xff\xe1\x00\x18Exif\x00\x00...' # åå…­è¿›åˆ¶è¡¨ç¤ºçš„å­—èŠ‚

    # å†™äºŒè¿›åˆ¶
    # å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œä¼šç›´æ¥è¦†ç›–, å¯ä»¥ä¼ å…¥'a'ä»¥è¿½åŠ ï¼ˆappendï¼‰æ¨¡å¼å†™å…¥
    f = open('/Users/michael/test.txt', 'w')
    # å¯ä»¥åå¤è°ƒç”¨write()æ¥å†™å…¥æ–‡ä»¶
    f.write('Hello, world!')
    # å†™æ–‡ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¾€å¾€ä¸ä¼šç«‹åˆ»æŠŠæ•°æ®å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯æ”¾åˆ°å†…å­˜ç¼“å­˜èµ·æ¥ï¼Œç©ºé—²çš„æ—¶å€™å†æ…¢æ…¢å†™å…¥ã€‚
    #åªæœ‰è°ƒç”¨close()æ–¹æ³•æ—¶ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¿è¯æŠŠæ²¡æœ‰å†™å…¥çš„æ•°æ®å…¨éƒ¨å†™å…¥ç£ç›˜
    f.close()
    # æ‰€ä»¥ï¼Œè¿˜æ˜¯ç”¨withè¯­å¥æ–¹ä¾¿

    #
    # åœ¨å†…å­˜è¯»å†™ stringIO
    # è¦æŠŠstrå†™å…¥StringIOï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªStringIOï¼Œç„¶åï¼Œåƒæ–‡ä»¶ä¸€æ ·å†™å…¥
    # >>> from io import StringIO
    # >>> f = StringIO() # å¯ä»¥åœ¨è¿™é‡Œç›´æ¥åˆå§‹åŒ–, ç±»æ¯” StringBuffer
    # >>> f.write('hello')
    # 5
    # >>> f.write(' ')
    # 1
    # >>> f.write('world!')
    # 6
    # >>> print(f.getvalue())
    # hello world!


    # # è¦æ“ä½œäºŒè¿›åˆ¶æ•°æ®ï¼Œå°±éœ€è¦ä½¿ç”¨BytesIO
    # >>> from io import BytesIO
    # >>> f = BytesIO()
    # >>> f.write('ä¸­æ–‡'.encode('utf-8'))
    # 6
    # >>> print(f.getvalue())
    # b'\xe4\xb8\xad\xe6\x96\x87'

    # åºåˆ—åŒ–
    #
    # dumps()æ–¹æ³•è¿”å›ä¸€ä¸ªstrï¼Œå†…å®¹å°±æ˜¯æ ‡å‡†çš„JSONã€‚ç±»ä¼¼çš„ï¼Œdump()æ–¹æ³•å¯ä»¥ç›´æ¥æŠŠJSONå†™å…¥ä¸€ä¸ªfile-like Objectã€‚
    # >>> import json
    # >>> d = dict(name='Bob', age=20, score=88)
    # >>> json.dumps(d)
    # '{"age": 20, "score": 88, "name": "Bob"}'


```


## è£…é¥°å™¨ decorator

### è£…é¥°å™¨ä»‹ç»

```py
# æ˜¯ py æä¾›çš„ç¼–å†™é«˜é˜¶å‡½æ•°çš„è¯­æ³•ç³–, å³åº•å±‚å°±æ˜¯ä¸€ä¸ªå‡½æ•°, è¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå‡½æ•°
# å‡½æ•°è£…é¥°å™¨
# ç±»è£…é¥°å™¨
    # __init__, __call__ 

# å¤šä¸ªè£…é¥°å™¨
@dec2(arg)
@dec1
def xx():
    pass
# ç­‰ä»·äº
xx = dec2(arg)(dec1(xx))



# ------------------------- å®šä¹‰ä¸€ä¸ªæ—¥å¿—åŒ…è£…å™¨


import functools
# æœ¬è´¨ä¸Š, decoratorå°±æ˜¯ä¸€ä¸ªè¿”å›å‡½æ•°çš„é«˜é˜¶å‡½æ•°, æ¥å—ä¸€ä¸ªå‡½æ•°, è¿”å›åŒ…è£…åçš„å‡½æ•°
def log(func):
    # # ä½œç”¨æ˜¯ä¿®æ”¹è£…é¥°åçš„å‡½æ•° __name__ å±æ€§å€¼, å¦‚æœä¸åŠ , è£…é¥°å™¨è¿˜æ˜¯å·¥ä½œçš„, ä½†æ˜¯ __name__ ä¼šå˜ä¸º "wrapper", æ˜¾ç„¶ä¸è¡Œ
    @functools.wraps(func) 
    def wrapper(*args, **kw):  # èƒ½æ¥å—ä»»æ„çš„å‚æ•°
        print('call %s(): ' % func.__name__)
        return func(*args, **kw)
    return wrapper

# æŠŠ@logæ”¾åˆ°new()å‡½æ•°çš„å®šä¹‰å¤„ï¼Œç›¸å½“äºæ‰§è¡Œäº† new = log(new)
@log
def new():
    print('111-111-111')
new() # æ‰§è¡Œçš„æ˜¯åŒ…è£…åçš„å‡½æ•°




# ------------------------------------ å¸¦å‚æ•°çš„åŒ…è£…å™¨

# å¦‚æœdecoratoræœ¬èº«éœ€è¦ä¼ å…¥å‚æ•°ï¼Œé‚£å°±éœ€è¦ç¼–å†™ä¸€ä¸ªè¿”å›decoratorçš„é«˜é˜¶å‡½æ•°
def log1(text):
    def decorator(func):
        @functools.wraps(func)
        def wrapper(*args, **kw):
            print('%s %s():' % (text, func.__name__))
            return func(*args, **kw)
        return wrapper
    return decorator
@log1('è‡ªå®šä¹‰execute') # ç›¸å½“äº yyy =  log1('execute')(yyy)
def yyy():
    print('zzz')
yyy()




# --------------------------æ¡ˆä¾‹ ç»Ÿè®¡æ‰§è¡Œæ—¶é—´

def timer(func):
    def wrapper():
        start = time.perf_counter() # æˆ–è€… time.time()
        func()
        end = time.perf_counter()
        elapse = end - start
        print('è€—æ—¶:', elapse)

    return wrapper

@timer
def show():
    print('hehe')
    time.sleep(0.2)

show()


```

### ç±»è£…é¥°å™¨

```python

# å®šä¹‰ç±»è£…é¥°å™¨, 
# å°±æ˜¯ä¸€ä¸ªç±», æœ‰ä¸€ä¸ª __call__æ–¹æ³•
class Entity:
    def __call__(self, cls):
        print('__call__', cls)

        def __repr__(self) -> str:
            return f'{cls.__qualname__}()' # è¿”å›ç±»å, å³ cls.__name__
        cls.__repr__ = __repr__

        def hello(self):
            print('hello')
            
        cls.hello = hello
        
        return cls

# å¿…é¡»åŠ æ‹¬å·
# æ­¤æ—¶, ä¸ç­‰åˆ°å®ä¾‹åŒ– User, Entity.__call__ å°±ä¼šæ‰§è¡Œ, è¿”å›çš„ cls å°±æ˜¯åŒ…è£…åçš„ User ç±»
@Entity() 
class User:
    ...

u = User()
print(u) # User()
u.hello() # hello

```


### æ¡ˆä¾‹: å¤±è´¥é‡è¯•

```python


def retry(ex_type: Exception, try_times=3, delay=1, backoff=2):
    """å¤±è´¥é‡è¯•

    Args:
        ex (Exception): é”™è¯¯ç±»å‹
        try_times (int, optional): é‡è¯•æ¬¡æ•°. Defaults to 3.
        delay (int, optional): å»¶è¿Ÿ. Defaults to 1.
        backoff (int, optional): ç´¯åŠ . Defaults to 2.
    """
    
    def decrator_retry(func):
        @functools.wraps(func)
        def run_with_retry_policy(*args, **kw):
            _try_times, _delay = try_times, delay
            while _try_times > 1:
                try:
                    return func(*args, **kw)
                except ex_type:
                    print(f'operation failed, will retry after {_delay}')
                    _try_times -= 1
                    _delay *= backoff
            # æœ€åä¸€æ¬¡ä¸èµ°å¾ªç¯äº†
            return func(*args, **kw)
        
        return run_with_retry_policy
    
    return decrator_retry

# ä½¿ç”¨
@retry(requests.ConnectionError, try_times=4)
def get_content(url: str) -> str:
    res = requests.get(url)
    return res.text

```

### æ¡ˆä¾‹: ä¾èµ–æ³¨å…¥

```python



from abc import ABC, abstractmethod
from threading import Lock

# key æ˜¯ class, å€¼ä¹Ÿæ˜¯ class
comps: dict = {}

class Component:
    def __call__(self, cls):
        if comps.get(cls) is None:
            comps[cls] = cls
        return comps[cls]

class Inject(ABC):
    def __init__(self, **kw):
        self.kw = kw
    
    def __call__(self, cls):
        cls_init = cls.__init__

        def __init__(_self, *args, **kw):
            cls_init(_self, *args, **kw)
            self.inject_members(_self)
            
        cls.__init__ = __init__

        return cls

    def inject_members(self, obj):
        for name, clazz in self.kw.items():
            ins = self.get_instance(clazz)
            if ins:
                setattr(obj, name, ins)
    
    @abstractmethod
    def get_instance(self, cls):
        ...

class InjectPrototype(Inject):
    def get_instance(self, cls):
        clazz = comps.get(cls)
        if clazz:
            return clazz()
        raise KeyError(f'compsä¸­ä¸å­˜åœ¨ç±»å‹{cls}')

class InjectSingleton(Inject):
    # ç±» å’Œå®ä¾‹çš„æ˜ å°„
    _ins_mapping: dict = {}

    # è¿™ä¸ªé”æ˜¯ç”¨æ¥è·å– class é”çš„
    _lock = Lock()

    # class é”, å³ç±»å’Œé”çš„æ˜ å°„
    _lock_mapping: dict = {}

    def get_instance(self, cls):
        ins = self._ins_mapping.get(cls)
        if not ins:
            class_lock = self._lock_mapping.get(cls)
            if not class_lock:
                with self._lock:
                    class_lock = Lock()
                    self._lock_mapping[cls] = class_lock
            with class_lock:
                ins = self._ins_mapping.get(cls)
                if not ins:
                    clazz = comps.get(cls)
                    ins = clazz()
                    self._ins_mapping[cls] = ins

        return ins


# ä½¿ç”¨
@Component()
class UserService:
    def get_user(self, id) -> str:
        return f'User-{id}'

@Component()
class ProductService:
    def get_prods(self):
        return 'products'

@InjectSingleton(user_service=UserService)
@InjectSingleton(product_service=ProductService)
@Component()
class BizService:
    def print_user(self):
        print(self.user_service.get_user(1))
        print(self.product_service.get_prods())

@InjectSingleton(biz_service=BizService)
class Controller:
    def exec(self):
        self.biz_service.print_user()

c = Controller()
c.exec()

c2 = Controller()
print(id(c.biz_service) == id(c2.biz_service)) # true, è¯´æ˜æ³¨å…¥çš„æ˜¯å•ä¾‹å¯¹è±¡
```



## é¢å‘å¯¹è±¡


### ç±» å¯¹è±¡

```py

class SideBar:
    # ç±»å˜é‡ï¼ˆå¤§å†™ï¼‰
    DIV: str = 'div'
    H1: str = 'h1'
    MORE_PLACEHOLDER: str = 'more'
    MORE_SIZE: int = 3
    SHOULD_COMPRESS_HTML: bool = True

     # ç±»å±æ€§, 
    # é€šè¿‡å®ä¾‹å¯¹è±¡è·å–å±æ€§, ä¼šå…ˆæŸ¥å®ä¾‹å±æ€§, ä¸å­˜åœ¨å†å»æŸ¥ç±»å±æ€§, éƒ½ä¸å­˜åœ¨ åˆ™è¿”å› none
    # å»ºè®®é€šè¿‡ Student.name , æˆ–è€… self.__class__.name è¿™ä¸¤ç§æ–¹å¼è·å–ç±»å±æ€§
    # ä¸è¦ç›´æ¥é€šè¿‡ self.xxx è·å–ç±»å±æ€§
    name__xx = "Student" 
    

    __slots__ = ('name', '__score', '_age', '__name') # ç”¨tupleå®šä¹‰å“ªäº›å±æ€§å¯ä»¥ä½œä¸ºå®ä¾‹å˜é‡, åœ¨ç±»å¤–éƒ¨å°±ä¸èƒ½éšä¾¿ç»‘å®šç±»å˜é‡äº†
    # `__slots__`å®šä¹‰çš„å±æ€§ä»…å¯¹å½“å‰ç±»å®ä¾‹èµ·ä½œç”¨ï¼Œå¯¹ç»§æ‰¿çš„å­ç±»æ˜¯æ— é™åˆ¶çš„ 
    #é™¤éåœ¨å­ç±»ä¸­ä¹Ÿå®šä¹‰**slots**ï¼Œè¿™æ ·ï¼Œå­ç±»å®ä¾‹å…è®¸å®šä¹‰çš„å±æ€§å°±æ˜¯è‡ªèº«çš„**slots**åŠ ä¸Šçˆ¶ç±»çš„**slots**

    # æ„é€ æ–¹æ³•
    # > **init**æœ‰ä¸¤ä¸ªä¸‹åˆ’çº¿
    # > å®šä¹‰å¯¹è±¡æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ selfï¼Œè°ƒç”¨æ—¶ä¸ç”¨ä¼ å…¥ self
    #
    #

    # æ„é€ æ–¹æ³•ï¼Œå®šä¹‰å®ä¾‹å˜é‡
    def __init__(
        self,
        title: str,
        menu_items: list[str],
        more: str = MORE_PLACEHOLDER,
        more_size: int = MORE_SIZE,
        should_compress_html: bool = SHOULD_COMPRESS_HTML
    ) -> None:
        self.title=  title
        self.menu_items=  menu_items
        self.more = more
        self.more_size = more_size
        self.should_compress_html = should_compress_html

        # é€šè¿‡â€˜_â€™ è¡¨ç¤ºéšè—å±æ€§, å®é™…è¿˜æ˜¯èƒ½é€šè¿‡ _someone è·å–å±æ€§
        self._someone = None

        # é€šè¿‡ '__' è¡¨ç¤ºä¸æš´éœ²çš„å±æ€§, Python ç¼–è¯‘å™¨ä¼šå°† __name æ”¹å†™ä¸º _SideBar__name, æ‰€ä»¥é€šè¿‡ __name è·å–å±æ€§ä¼šæŠ¥é”™
        self.__name = 'test'

        pass

    # ---------ç´§è·Ÿç€æ˜¯å…¶ä»–é­”æœ¯æ–¹æ³•------------
    
    def __len__(self):
        return len(self.menu_items)

    def __repr__(self):
        return f'side bar: {len(self)} items'
    
    
    # ----------------------
    
    @property  # # è´Ÿè´£æŠŠä¸€ä¸ªæ–¹æ³•å˜æˆå±æ€§, æš´éœ² æ–°çš„è‡ªå®šä¹‰å±æ€§ â€˜someoneâ€™
    def someone(self):
        return self._someone

    # @score.setter è£…é¥°å™¨æ˜¯ @property åˆåˆ›å»ºçš„å¦ä¸€ä¸ªè£…é¥°å™¨, ç”¨æ¥æŠŠä¸€ä¸ªsetteræ–¹æ³•å˜æˆå±æ€§èµ‹å€¼
    @someone.setter
    def someone(self, someone):
        assert isinstance(someone, int), 'someone has to be a number'
        assert someone > 0, 'someone have to be more than o'
        self._someone  = someone
    
    # del sidebar.someone è¿™è¡Œè¯­å¥ä¼šå‡ºå‘è¿™ä¸ªæ–¹æ³•
    @someone.deleter
    def someone(self):
        self._someone = 0
        

    # ç±»æ–¹æ³•ï¼Œ
    # ç»‘å®šåˆ°ç±»ï¼Œæ¥å— cls ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ å¯ è®¿é—®ç±»å˜é‡
    # å¸¸ç”¨åœ¨å·¥å‚æ–¹æ³•ï¼Œ é€šè¿‡ cls(xxx) è°ƒç”¨æ„é€ å‡½æ•°
    # å¯é€šè¿‡ç±»ï¼Œå®ä¾‹æ¥è°ƒç”¨
    @classmethod
    def _header(cls, title):
        return cls._build_header(cls.H1, title)
    
    # é™æ€æ–¹æ³•
    # ä¸ç»‘å®šåˆ°ç±»æˆ–å®ä¾‹ï¼Œä¸æ¥å— self æˆ– cls ä½œä¸ºå‚æ•°
    # å¯ä»¥é€šè¿‡ç±»åæˆ–ç±»çš„å®ä¾‹è°ƒç”¨
    @staticmethod
    def _build_header(tag_name: str, title: str) -> str:
        return f'<{tag_name}>{title}</{tag_name}>'

    # å®ä¾‹æ–¹æ³•
    def build(self):
         return self._header(self.title)
    
    # `__str__()`: print(obj)å®é™…è°ƒç”¨ obj çš„`__str__()` 
    def __str__(self):  
        return 'Student object (name=%s)' % self.name
    
    # `__repr__()`: ç›´æ¥ obj å°±æ˜¯è°ƒç”¨ obj çš„`__repr__()`,é€šå¸¸å’Œ `__str__()`ä¸€æ ·
    __repr__ = __str__


# åˆ›å»ºå¯¹è±¡
d = SideBar(...)
# è·å–å±æ€§, åªé€‚ç”¨äºå¯¹è±¡, ä¸èƒ½ç”¨äº dict 
getattr(d, 'Mickael', None) # é»˜è®¤å€¼ None å¿…é¡»ç»™, å¦åˆ™å±æ€§ä¸å­˜åœ¨ä¼šæŠ¥é”™

# æ˜¯å¦å­˜åœ¨
hasattr(d, 'xxx')

```

### æè¿°å™¨ 



#### æè¿°å™¨ä»‹ç»

```python
# æè¿°å™¨å°±æ˜¯ç±»,
# åªæ˜¯ç±»åŒ…å«ä¸€ç»„æ–¹æ³• __get__ã€__set__ å’Œ __delete__, ç”¨äºæ§åˆ¶å±æ€§çš„è®¿é—®å’Œä½¿ç”¨
# 
# æ­¤å¤–, è¿˜æœ‰äº›å¯é€‰çš„æ–¹æ³• 
#    __set_name__(self, ins, attr_name)  åœ¨æè¿°å™¨è¢«èµ‹å€¼ç»™æŸä¸ªå±æ€§æ—¶è‡ªåŠ¨è°ƒç”¨, 
# 
# åœºæ™¯:
# å®ç°å±æ€§çš„æƒ°æ€§è®¡ç®—
# æ§åˆ¶å¯¹å±æ€§çš„è®¿é—®æƒé™
# ä¸ºå±æ€§æ·»åŠ éªŒè¯é€»è¾‘
# å®ç°è‡ªå®šä¹‰å±æ€§ç±»å‹


# æ•°æ®æè¿°å™¨: æœ‰  __get__ å’Œ __set__ï¼ˆæˆ– __delete__ï¼‰, ç”¨äºæ§åˆ¶å¯¹å±æ€§å€¼çš„è®¿é—®å’Œä¿®æ”¹
# éæ•°æ®æè¿°å™¨: ä»…å®šä¹‰äº† __get__  , ç”¨äºåœ¨è·å–å±æ€§å€¼æ—¶æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘


# ------------------ å®šä¹‰éæ•°æ®æè¿°å™¨

class DirSize:
    def __get__(self, ins, cls):
        print(ins)  # å®ä¾‹å¯¹è±¡
        print(cls)  # class å¯¹è±¡
        print(isinstance(ins, cls))  # true

        return len(os.listdir(ins.dirname))


class Dir:
    # å°±æ˜¯ç±»å±æ€§, 
    # ä»…ä»…æ˜¯å€ŸåŠ©ç±»å±æ€§, size è¿™ä¸ªå±æ€§æŒ‡å®šæè¿°å™¨
    #  size è‹¥æœ‰åŒåçš„å¯¹è±¡å±æ€§, å€¼ä¼šè¢«åŒåçš„å¯¹è±¡å±æ€§è¦†ç›–
    size = DirSize()

    def __init__(self, dirname):
        self.dirname = dirname


cur_dir = Dir("./")
print(cur_dir.size)  # ä¼šè°ƒç”¨ DirectorySizeçš„ get æ–¹æ³•

# ------------------------



# --------------------- å®šä¹‰ä¸€ä¸ªæ•°æ®æè¿°å™¨

class UppercaseDescriptor:
    # instance æ˜¯æ‹¥æœ‰è¿™ä¸ªæè¿°å™¨çš„å®ä¾‹å¯¹è±¡
    def __get__(self, ins, cls):
        return ins._value.upper() # å¿…é¡»é€šè¿‡ '_' å¼€å¤´çš„æ˜¯æœ‰å˜é‡è·å–å±æ€§, è¿™é‡Œ _value è·å–çš„æ˜¯MyClass çš„ value å±æ€§ 

    def __set__(self, ins, value):
        ins._value = value.upper()

# ä½¿ç”¨
class MyClass:
    # å®é™…æ˜¯é€šè¿‡ _value å­˜å–
    value = UppercaseDescriptor() # è¿™æ„å‘³ç€æ¯æ¬¡è·å–æˆ–è®¾ç½® value å±æ€§æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨æè¿°å™¨çš„æ–¹æ³•ã€‚

mc = MyClass()
mc.value = 'ab'
print(mc.value) # AB
print(vars(mc)) # {'_value': 'AB'}


```


#### å±æ€§çš„æŸ¥è¯¢é“¾è·¯é¡ºåº

```python


# å±æ€§æŸ¥è¯¢è·¯å¾„é¡ºåº:
- æ•°æ®æè¿°å™¨çš„ get
- å¯¹è±¡çš„ dict
- éæ•°æ®æè¿°å™¨çš„ get
- ç±»çš„ dict
- çˆ¶ç±»çš„ dict
- mro çš„é¡ºåºæœç´¢å¯¹åº”ç±»çš„ dict
éƒ½æ‰¾ä¸åˆ°, æŠ›å‡º AttributeError

```


#### æ¡ˆä¾‹: è®°å½•å±æ€§è®¿é—®æ—¥å¿—


```py


# -----------------------


class AttributeAccessLoggingDescriptor:
    
    def __set_name__(self, ins, attr_name):
        self.pri_name = f'_{attr_name}'
        self.pub_name = attr_name
    
    def __get__(self, ins, instype):
        value = getattr(ins, self.pri_name)
        print(f'è®¿é—® {self.pub_name} å±æ€§, è¿”å›å€¼: {value}')
        return value    

    def __set__(self, ins, value):
        print(f'æ›´æ–° {self.pub_name} å±æ€§, å±æ€§å€¼: {value}')
        setattr(ins, self.pri_name, value)


class Product:
    name = AttributeAccessLoggingDescriptor()
    count = AttributeAccessLoggingDescriptor()

    def __init__(self, name, count):
        self.name = name
        self.count = count

p1= Product('a', 1)
p2 = Product('b', 2)


```

#### æ¡ˆä¾‹: å±æ€§æ ¡éªŒ

```py



# ----------------------------- 


class Validator:

    def __set_name__(self, ins, attr):
        self.pri_name = f'_{attr}'
        self.pub_name = attr
    
    def __get__(self, ins, cls):
        return getattr(ins, self.pri_name)

    def __set__(self, ins, val):
        self.validate(val)
        setattr(ins, self.pri_name, val)
    
    # å¾…å®ç°çš„æŠ½è±¡æ–¹æ³•
    def validate(self, val):
        ...
    

class OneOf(Validator):
    def __init__(self, *options):
        self.options = set(options)
    
    
    def validate(self, val):
        if self.options and val not in self.options:
            raise ValueError(f'å±æ€§ {self.pub_name!r} å–å€¼å¿…é¡»åœ¨ {self.options!r} ä¸­')

class Person:
    name = OneOf('a', 'b')
    
    def __init__(self, name):
        self.name = name
        
p = Person('a') # ä¸æŠ¥é”™
p2 =Person('c') # æŠ¥é”™



```

#### æ¡ˆä¾‹: ç®€åŒ–å±æ€§çš„å®šä¹‰

```python


class Life:
    def __init__(self, min: int, max: int, error: str):
        self.min = min
        self.max = max
        self.error = error

    def __set_name__(self, ins, attr):
        self.attr = attr

    def __get__(self, ins, instype):
        return ins.__dict__.get(self.attr)
    
    def __set__(self, ins, val):
        if val < self.min or val > self.max:
            raise ValueError(self.error)
        ins.__dict__[self.attr] = val

# å®šä¹‰ä¸€å¥—æ¸¸æˆæ–¹æ¡ˆ
class Scenario:
    # å®šä¹‰è‹±é›„ç”Ÿå‘½å€¼å±æ€§
    hero_life = Life(0, 10, 'hero life not in the scope')
    # æ•Œäººç”Ÿå‘½å€¼å±æ€§
    enemy_life = Life(0, 100, 'enemy life not in the scope')

    # å¯ä»¥çœ‹åˆ°, å¾ˆç®€ä¾¿, å¦‚æœé€šè¿‡ __init__() æˆ–è€… @property å»å®šä¹‰å±æ€§ä¼šå¾ˆéº»çƒ¦
```


#### æ¡ˆä¾‹: ç®€å•çš„ orm

```py


# ---------------------- 

import sqlite3
conn = sqlite3.connect('/tmp/data.db')

class Field:
    def __set_name__(self, ins, attr):
        self.sql_get_by_id = f'select {attr} from {ins.table} where {ins.key} = ?;'
        self.sql_update_by_id = f'update {ins.table} set {attr} = ? where {ins.key} = ?;'
    
    def __get__(self, ins, instype):
        return conn.execute(self.sql_get_by_id, [ins.key]).fetchone()[0]
    
    def __set__(self, ins, val):
        conn.execute(self.sql_update_by_id, [val, ins.key])
        conn.commit()
    
# ä½¿ç”¨
class User:
    table = 'user'
    key = 'id'
    name = Field()
    age = Field()

    def __init__(self, key):
        self.key = key

name1 = User(1).name
name2 = User(2).name



```


#### æ¡ˆä¾‹: å®ç°å±æ€§æ‡’åŠ è½½

```python

# ------------------------- 
# å½“æè¿°å™¨è¢«å½“ä½œè£…é¥°å™¨ä½¿ç”¨

# åªæœ‰ __get__, è¿™æ˜¯ä¸€ä¸ªéæ•°æ®æè¿°å™¨, ä¸èƒ½æ˜¯æ•°æ®æè¿°å™¨, å› ä¸ºæ•°æ®æè¿°å™¨/éæ•°æ®æè¿°å™¨ å±æ€§è¯»å–çš„é“¾è·¯é¡ºåºä¸åŒ
class LazyProperty:
    def __init__(self, func):
        self.func = func
        self.func_name = func.__name__
    
    def __get__(self, ins, instype):
        val = self.func(ins)
        ins.__dict__[self.func_name] = val
        return val

class Person:
    @LazyProperty
    def heavy_result(self):
        print('some heavy task')
        return 100000

p = Person()  # åˆ›å»ºæ—¶, ä¸ä¼šåˆå§‹åŒ–å±æ€§ heavy_result, æ˜¯ä¸ºæ‡’åŠ è½½
a = p.heavy_result  # å®é™…è¯»å–æ—¶æ‰ä¼šæ‰§è¡Œå®é™…çš„è®¡ç®—é€»è¾‘
b = p.heavy_result  # ç¬¬äºŒæ¬¡è°ƒç”¨, ä¼šä»ç¼“å­˜æ‹¿ 

```

### ç»§æ‰¿ é¸­å­ç±»å‹


```py

 # 
    # ç»§æ‰¿ ä»»ä½•ç±»éƒ½é»˜è®¤ç»§æ‰¿ object
    # å…è®¸å¤šç»§æ‰¿
    #
    class People(object): # è¿™é‡Œæœ‰æ²¡æœ‰ object éƒ½æ˜¯ç­‰æ•ˆçš„
        def say(self):
            print("hello people")
        def run(self):
            print("run people")

    class Student(People):  # ç»§æ‰¿
        def run(self): # é‡å†™
            print("run students")

    stu = Student()
    stu.say() # hello people
    stu.run() # run students

    print(isinstance(stu, People)) # true
    print(isinstance(stu, Student))# true

    print(issubclass(Stuent, People)) #true

    #
    # é¸­å­ç±»å‹
    #
    class Animal(object):
        def eat(self):
            print("animal eat")
        def run(self):
            print("run animal")
    class Bird(object):
        def eat(self):
            print("eat bird")
    print(isinstance(Bird(), Animal))# false
    def demo(p):
        p.run()
    demo(stu)
    demo(People())
    demo(Animal()) # animal æ²¡æœ‰ç»§æ‰¿ People, ä¹Ÿå¯ä½œä¸ºå‚æ•°ä¼ å…¥ demo(), é¸­å­ç±»å‹


# é€šè¿‡ super() è°ƒç”¨çˆ¶ç±»å®ä¾‹æ–¹æ³•


# å­˜åœ¨ç»§æ‰¿çš„ç±»ä¸­, callæ–¹æ³•æ—¶æŸ¥æ‰¾æ–¹æ³•é¡ºåº:
    # å…ˆæœå¯»å½“å‰ç±», åœ¨å¾€ä¸Šæ‰¾, å¤šä¸ªçˆ¶ç±», æŒ‰ç…§å®šä¹‰å½“å‰ç±»æ—¶å£°æ˜çˆ¶ç±»é¡ºåºæŸ¥æ‰¾   (MRO æ–¹æ³•è§£æé¡ºåº)



# æ‰“å°ç»§æ‰¿é“¾

class A:
    pass
class B(A):
    pass

lst = B.mro()
print(lst) # [__main__.B, __main__.A, objject]
```

### åˆ¤æ–­ç±»å‹ä¿¡æ¯


```py
#
    # ç±»å‹ä¿¡æ¯
    #
    #>>> type(123)==type(456)
    # True
    # >>> type(123)==int
    # True
    # >>> type('abc')==type('123')
    # True
    # >>> type('abc')==str
    # True
    # >>> type('abc')==type(123)
    # False

    # # å…¶ä»–ç±»å‹
    # >>> import types
    # >>> def fn():
    # ...     pass
    # ...
    # >>> type(fn)==types.FunctionType
    # True
    # >>> type(abs)==types.BuiltinFunctionType
    # True
    # >>> type(lambda x: x)==types.LambdaType
    # True
    # >>> type((x for x in range(10)))==types.GeneratorType
    # True

    # # isinstance()
    # # åŸºæœ¬ç±»å‹
    # >>> isinstance('a', str)
    # True
    # >>> isinstance(123, int)
    # True
    # >>> isinstance(b'a', bytes)
    # True
    # # ç»§æ‰¿ä½“ç³»
    # >>> isinstance(h, Dog)
    # True
    # >>> isinstance(h, Animal)
    # True
    # >>> isinstance(d, Dog) and isinstance(d, Animal)
    # True
    # # åˆ¤æ–­æ˜¯å‡ ç§ä¸­ä¹‹ä¸€ç§
    # >>> isinstance([1, 2, 3], (list, tuple))
    # True
    # >>> isinstance((1, 2, 3), (list, tuple))
    # True

```

### åŠ¨æ€æ“ä½œ


```py
# 
    # åŠ¨æ€æ“ä½œ object å±æ€§
    #
    # dir(obj)---------è·å– obj çš„æ‰€æœ‰å¯¹è±¡ã€å±æ€§ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸² list  
    # é…åˆ getattr()ã€setattr()ä»¥åŠ hasattr()ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ“ä½œä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€
    #
    # >>> class MyObject(object):
    # ...     def __init__(self):
    # ...         self.x = 9
    # ...     def power(self):
    # ...         return self.x * self.x
    # ...
    # >>> obj = MyObject()
    # >>> hasattr(obj, 'x') # æœ‰å±æ€§'x'å—ï¼Ÿ
    # True
    # >>> obj.x
    # 9
    # >>> hasattr(obj, 'y') # æœ‰å±æ€§'y'å—ï¼Ÿ
    # False
    # >>> setattr(obj, 'y', 19) # è®¾ç½®ä¸€ä¸ªå±æ€§'y'
    # >>> hasattr(obj, 'y') # æœ‰å±æ€§'y'å—ï¼Ÿ
    # True
    # >>> getattr(obj, 'y', 404) # è·å–å±æ€§'y',å¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›é»˜è®¤å€¼404
    # 19
    # >>> obj.y # è·å–å±æ€§'y'
    # 19
    # # è·å–å¯¹è±¡
    # >>> hasattr(obj, 'power') # æœ‰å±æ€§'power'å—ï¼Ÿ
    # True
    # >>> getattr(obj, 'power') # è·å–å±æ€§'power'
    # <bound method MyObject.power of <__main__.MyObject object at 0x10077a6a0>>
    # >>> fn = getattr(obj, 'power') # è·å–å±æ€§'power'å¹¶èµ‹å€¼åˆ°å˜é‡fn
    # >>> fn # fnæŒ‡å‘obj.power
    # <bound method MyObject.power of <__main__.MyObject object at 0x10077a6a0>>
    # >>> fn() # è°ƒç”¨fn()ä¸è°ƒç”¨obj.power()æ˜¯ä¸€æ ·çš„
    # 81



 #
    # åŠ¨æ€åˆ›å»ºç±», å…ƒç±», metaClass
    #
    # åˆ›å»ºclass
    class Hello(object):
        def hello(self, name='world'):
            print('Hello, %s.' % name)

    h = Hello()
    print(type(h))# <class '__main__.Hello'> hçš„ç±»å‹æ˜¯Hello
    print(type(Hello))# <class 'type'> Helloçš„ç±»å‹æ˜¯type

    # åŠ¨æ€åˆ›å»ºclass
    def fn(self, name='world'):
        print('Hello, %s.' % name)
    Hello1 = type('Hello1', (object,), dict(hello=fn))
    h1 = Hello1()
    print(h1) # <__main__.Hello1 object at 0x7faef9cd5c90>
    h1.hello() # Hello, world.

```





### æšä¸¾


```py


 #
# æšä¸¾ç±»
#
#    

from enum import Enum, unique

# simple way to define, é»˜è®¤èµ‹å€¼1ï¼Œ2ï¼Œ3ï¼Œ4...
Month = Enum('Month', ('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'))
print(Month.Jan.value) # 1
print(Month.Jan.name) #Jan
print(Month.Jan)#Month.Jan

print(Month['Jan'])# é€šè¿‡åç§°è·å–æˆå‘˜,  # Month.Jan
print(Month(1))# é€šè¿‡å€¼è·å–æˆå‘˜ # Month.Jan

# æšä¸¾è¿­ä»£
for month in Month:
    print(month)

for month in Month.__members__.items():
    print(month[0], month[1])

for name, value in Month.__members__.items():
    print(name, value)



# customize class,å¯è‡ªå·±èµ‹å€¼
@unique
class Weekday(Enum):
    Sun = 0  # èµ‹å€¼å¯ä»¥æ˜¯æ•°å­—, å½“ç„¶ä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²
    Mon = 1
    Tue = 2
    Wed = 3
    Thu = 4
    Fri = 5
    Sat = 6
for name, value in Weekday.__members__.items():
    print(name, value)


# æšä¸¾æ˜¯å¦ç›¸ç­‰æ¯”è¾ƒ

# æšä¸¾æˆå‘˜å¯è¿›è¡ŒåŒä¸€æ€§æ¯”è¾ƒ  
Color.red is Color.red  
# ã€€ã€€è¾“å‡ºç»“æœæ˜¯ï¼šTrue  
Color.red is not Color.blue  
# ã€€ã€€è¾“å‡ºç»“æœæ˜¯ï¼šTrue  

# æšä¸¾æˆå‘˜å¯è¿›ç­‰å€¼æ¯”è¾ƒ  
Color.blue == Color.red  
# ã€€ã€€è¾“å‡ºç»“æœæ˜¯ï¼šFalse  
Color.blue != Color.red  
# ã€€ã€€è¾“å‡ºç»“æœæ˜¯ï¼šTrue

```

### å¯¹è±¡å…‹éš† æ‹·è´ shadow-copy deep-copy

```python

# å¯¹äºå¯å˜å¯¹è±¡, å¤åˆ¶æ—¶å¿…é¡»è¿›è¡Œæ·±æ‹·è´

# shadw copy (åˆ›å»ºæ–°å¯¹è±¡, å°†åŸæ¥å¯¹è±¡å†…çš„å±æ€§çš„å¼•ç”¨, ä¸€æ¬¡æ’å…¥æ–°å¯¹è±¡)
copy.copy()

# deep copy (åˆ›å»ºæ–°å¯¹è±¡, å°†è¿œå¯¹è±¡å±æ€§çš„å‰¯æœ¬, æ’å…¥æ–°å¯¹è±¡)
copy.deepcopy()


# ç‰¹æ®Šçš„
# å¯¹äº dict, xx_dict.copy() å¯å®ç°å­—å…¸çš„ shadow copy
# å¯¹äº list, xx_list[:] å¯ä»¥å®ç°åˆ—è¡¨çš„ shadow copy
```

### abcæ¨¡å— å®šä¹‰æŠ½è±¡åŸºç±»

```python

# define the abstract class
#   æˆ–è€… class Xxx(abc.ABC) ä¹Ÿå¯ä»¥, æ¨èè¿™ç§
import abc
class Component(metaclass=abc.ABCMeta):
    # the sub class have to implement this method
    @abc.abstractmethod
    def bind_data(self):
        pass

    # the sub class have to implement this method
    @abc.abstractmethod
    def render(self):
        pass


class CompA(Component):
    def bind_data(self):
        return ['a', 'b', 'c']

    def render(self):
        for ele in self.bind_data():
            print(ele)

ca = CompA()
def render(comps: list[CompA]):
    for comp in comps:
        comp.render()

render([ca])

Component.register(int)  # æ³¨å†Œ int ç±»å‹ä¸ºå­ç±»
Component.register(tuple)
Component.register(dict)
```


## æ•°æ®ç±»

### @dataclass åˆ›å»ºå®ä½“ç±»

```python
from dataclasses import dataclass, field, fields
# python 3.7 å¼€å§‹å†…ç½®æä¾›
@dataclass(   # é»˜è®¤è‡ªåŠ¨ç”Ÿæˆ __repr__, __eq__, __init__

    init=True,   # ç”Ÿæˆ __init__, é»˜è®¤ true
    repr=True,
    eq=True,

    order=False,  #default to false  
                # å£°æ˜å®ç° __gt__, __ge__, __lt__, __le__ , æ­¤æ—¶å¯¹è±¡å¯ä»¥æ¯”è¾ƒå¤§å°äº†, é»˜è®¤æ˜¯å°†æ‰€æœ‰å±æ€§è½¬ä¸º tupleæ¯”è¾ƒ, 
                # å¯é€šè¿‡ä¸ºå±æ€§å£°æ˜ field(compare=False) æ¥æ’é™¤å¯¹è¯¥å±æ€§çš„æ¯”è¾ƒ

    frozen=False ,  # å£°æ˜åˆ›å»ºå‡ºçš„å¯¹è±¡æ˜¯å¦å†°å†» ï¼ˆå³å±æ€§ä¸å¯ä¿®æ”¹ï¼Œ ä¼šæŠ›å‡ºFrozenInstanceErrorï¼‰
                # å¯¹äºå†°å†»ç±»çš„å­ç±», å­ç±»å±æ€§å¯ä»¥è‡ªç”±ä¿®æ”¹, ä½†æ˜¯ç»§æ‰¿è‡ªçˆ¶ç±»çš„å±æ€§ä»ç„¶æ˜¯å†°å†»çš„
    
    unsafe_hash=False,  # ä¸ºtrueåˆ™è‡ªåŠ¨ç”Ÿæˆ __hash__æ–¹æ³•


    match_args=True  # é»˜è®¤ä¸ºtrue, ä¸º __match_args__ èµ‹å€¼ä¸€ä¸ªå…ƒç»„, ç”¨äºæŒ‡å®šå“ªäº›å±æ€§å­—æ®µå‚ä¸æ¨¡å¼åŒ¹é…

    kw_only=False   # é»˜è®¤ false, true åˆ™é™åˆ¶å¿…é¡»ä½¿ç”¨ **kw çš„æ–¹å¼åˆå§‹åŒ–å¯¹è±¡, å³é€šè¿‡ å‚æ•°å=å€¼,å‚æ•°å=å€¼ è¿™ç§æ–¹å¼
                    # å¯ä»¥é€šè¿‡å±æ€§çš„ field (xxx) æ’é™¤

    slots=False # é»˜è®¤, è‹¥ä¸º true, åˆ™ä¼šä¼˜åŒ–å±æ€§è®¿é—®é€Ÿåº¦, åŒæ—¶ç¦æ­¢åŠ¨æ€æ·»åŠ é¢å¤–å±æ€§

)
class Person:
    name: str
    age: int
    # å¯é€‰çš„é»˜è®¤å€¼ï¼šå¯ä»¥ä¸ºç±»å±æ€§è®¾ç½®é»˜è®¤å€¼ã€‚
    email: str = field(
        default="", # é»˜è®¤å€¼
        compare=False,  # ä¸å‚ä¸æ¯”è¾ƒ, é»˜è®¤æ˜¯ true
        metadata={"description": "Email Address"}
    )
    # æŒ‡å®šé»˜è®¤å·¥å‚å‡½æ•°ï¼Œ åˆ›å»ºå®ä½“è¿™ä¸ªå­—æ®µå¯ä¸ä¼ 
    bookes: List[str] = field(default_factory=list)

# ä¼šè‡ªåŠ¨ç”Ÿæˆ __init__ æ–¹æ³•ã€‚
person = Person(name="Alice", age=30, email="alice@example.com")
field_list = fields(Person)  # è·å– field åˆ—è¡¨

```

### hashç­–ç•¥

```py


# ---------  unsafe_hash, eq, frozen, å’Œ
# ä¸‰è€…ä¸€èµ·æ§åˆ¶æ•°æ®ç±»çš„ hash ç”Ÿæˆç­–ç•¥

@dataclass(
    frozen=False, # é»˜è®¤
    eq=True,  # default
    unsafe_hash=False  # default
)
class Person:
    name: str
    age: int

    def get_super_hash(self):
        return super().__hash__()

p1 = Person('aa', 11)
# error: æ²¡æœ‰å®ç°è‡ªå·±çš„ __hash__
#  å› ä¸º unsafe_hash=False ä¸ä¼šé‡å†™çˆ¶ç±» __hash__, 
# ä¹Ÿæ²¡æœ‰æ‰‹åŠ¨å®ç°__hash__, 
# åŒæ—¶ eq=trueå®ç°äº† __eq__, ç›¸å½“äºå±è”½äº†çˆ¶ç±»çš„ __hash__ æ–¹æ³•
print('p1 hash', hash(p1))  

# -------------------------------------


@dataclass(
    frozen=False, # é»˜è®¤
    eq=False,
    unsafe_hash=False  # default
)
class Person:
    name: str
    age: int

    def get_super_hash(self):
        return super().__hash__()


p1 = Person('aa', 11)
p2 = Person('aa', 11)
print(p1 == p2)  # false, æ²¡æœ‰é‡å†™__eq__, ç›¸å½“äºæ¯”è¾ƒå†…å­˜åœ°å€,æ‰€ä»¥ä¸ç­‰
print('p1 hash', hash(p1))  # 273110696 , å’Œ super çš„ hash ä¸€è‡´, å› ä¸ºè‡ªå·±æ²¡æœ‰å®ç° __hash__, ä¼šè°ƒçˆ¶ç±»çš„
                    # eq=False , ä¸ä¼šç”Ÿæˆ __eq__, æ‰€ä»¥ä¸ä¼šå±è”½çˆ¶ç±»çš„ __hash__, æ‰€ä»¥è¿™æ¬¡ä¸ä¼šæŠ¥é”™
print('(p1.name, p1.age) hash', hash((p1.name, p1.age)))
print('p1 super hash', p1.get_super_hash())  # 273110696
# ----------------
print('p2 hash', hash(p2))
print('(p2.name, p2.age) hash', hash((p2.name, p2.age)))
print('p2 super hash', p2.get_super_hash())


# -------------------------------------------

```



## å…ƒç±» Metaclass

```python

å…ƒç±»æ˜¯ç±»çš„å·¥å‚ï¼Œç”Ÿäº§ç±»çš„ç±»

#--------------------------------- æ¡ˆä¾‹: ç®€å• orm å®ç°
https://www.bilibili.com/video/BV1Qv4y1976p/?spm_id_from=333.788&vd_source=c2f975abf353677cb814e38e073b6a75



```


## é”™è¯¯å¼‚å¸¸å¤„ç†

### ç³»ç»Ÿå†…ç½®çš„å¼‚å¸¸

```python

  """
    BaseException
    +-- SystemExit
    +-- KeyboardInterrupt
    +-- GeneratorExit
    +-- Exception
        +-- StopIteration
        +-- StopAsyncIteration
        +-- ArithmeticError
        |    +-- FloatingPointError
        |    +-- OverflowError
        |    +-- ZeroDivisionError
        +-- AssertionError
        +-- AttributeError
        +-- BufferError
        +-- EOFError
        +-- ImportError
            +-- ModuleNotFoundError
        +-- LookupError
        |    +-- IndexError
        |    +-- KeyError
        +-- MemoryError
        +-- NameError
        |    +-- UnboundLocalError
        +-- OSError
        |    +-- BlockingIOError
        |    +-- ChildProcessError
        |    +-- ConnectionError
        |    |    +-- BrokenPipeError
        |    |    +-- ConnectionAbortedError
        |    |    +-- ConnectionRefusedError
        |    |    +-- ConnectionResetError
        |    +-- FileExistsError
        |    +-- FileNotFoundError
        |    +-- InterruptedError
        |    +-- IsADirectoryError
        |    +-- NotADirectoryError
        |    +-- PermissionError
        |    +-- ProcessLookupError
        |    +-- TimeoutError
        +-- ReferenceError
        +-- RuntimeError                      #  è‡ªå®šä¹‰æ—¶ä¸€èˆ¬ç»§æ‰¿ä»–
        |    +-- NotImplementedError
        |    +-- RecursionError
        +-- SyntaxError
        |    +-- IndentationError
        |         +-- TabError
        +-- SystemError
        +-- TypeError
        +-- ValueError                          # int() å¯èƒ½å‘ç”Ÿ
        |    +-- UnicodeError
        |         +-- UnicodeDecodeError
        |         +-- UnicodeEncodeError
        |         +-- UnicodeTranslateError
        +-- Warning
            +-- DeprecationWarning
            +-- PendingDeprecationWarning
            +-- RuntimeWarning
            +-- SyntaxWarning
            +-- UserWarning
            +-- FutureWarning
            +-- ImportWarning
            +-- UnicodeWarning
            +-- BytesWarning
            +-- ResourceWarning
    """
```

### å¼‚å¸¸æ•è·æŠ›å‡º

```py

    # é€šè¿‡é…ç½®ï¼Œloggingè¿˜å¯ä»¥æŠŠé”™è¯¯è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶é‡Œï¼Œæ–¹ä¾¿äº‹åæ’æŸ¥
    import logging

    try:
        print('try...')
        r = 10 / int('2')
        print('result:', r)
    except ValueError as e:
        print('ValueError:', e)
        logging.exception(e)
    except ZeroDivisionError as e:
        print('ZeroDivisionError:', e)
    # æ²¡æœ‰é”™è¯¯å‘ç”Ÿå°±æ‰§è¡Œ
    else:
        print('no error!')
    finally:
        print('finally...')
    print('END')


    # æ•è·ç„¶ååŸæ ·æŠ›å‡º
    # raiseè¯­å¥å¦‚æœä¸å¸¦å‚æ•°ï¼Œå°±ä¼šæŠŠå½“å‰é”™è¯¯åŸæ ·æŠ›å‡º
    def foo(s):
        n = int(s)
        if n==0:
            print("can not be 0")
            raise ValueError('invalid value: %s' % s)
        return 10 / n

    def bar():
        try:
            foo('0')
        except ValueError as e:
            print('ValueError!--------------------')
            raise

    try:
        bar()
    except Exception as e:
        print("handling<<<<<<<<<<<<<")

 

```

### è‡ªå®šä¹‰å¼‚å¸¸

```python

# è‡ªå®šä¹‰é”™è¯¯
#
# 
class FooError(ValueError): # æˆ–è€…ç›´æ¥ç»§æ‰¿ Exception
    pass

def foo(s):
    n = int(s)
    if n==0:
        raise FooError('invalid value: %s' % s)
    return 10 / n

# foo('0')
```


## é­”æœ¯æ–¹æ³•

### åˆ›å»º `__new__`

```python
é€šè¿‡ç±»åˆ›å»ºå¯¹è±¡, ç”¨çš„è¾ƒå°‘
def __new__(cls, param1, p2 ...):
    xxx
```

### åˆå§‹åŒ– `__init__` `__post_init__`

```python
init   æœ‰äº†å¯¹è±¡ä¹‹å, å¯¹å±æ€§è¿›è¡Œåˆå§‹åŒ–

post_init åœ¨ init åè·Ÿç€æ‰§è¡Œ

```

### `__del__`

```python
# åœ¨å¯¹è±¡å†…å­˜è¢«é‡Šæ”¾æ—¶è§¦å‘æ‰§è¡Œ
# del xxx  å¹¶ä¸ä¸€å®šå‡ºå‘ __del__, åªæ˜¯å‡å°‘äº†ä¸€ä¸ªå¼•ç”¨
```

### `__exit__` è‡ªåŠ¨å…³é—­å›æ”¶

```python
def __exit(self, *args):
    # åšä¸€äº›å›æ”¶èµ„æºçš„æ“ä½œ, å…¥å…³é—­èµ„æºè¿æ¥
    xxxx

å®ç°äº† exit æ–¹æ³•çš„ç±»å¯ä»¥ with Xxxcls() as o:      , è¶…å‡ºä½œç”¨åŸŸ, è‡ªåŠ¨æ‰§è¡Œ exit æ–¹æ³•
```


### å¯è¿­ä»£ `__iter__`

```python

# `__iter__() & __next__()`:å¦‚æœä¸€ä¸ªç±»æƒ³è¢«ç”¨äº for ... in å¾ªç¯,åˆ™å¿…é¡»å®ç°`__iter__()`ï¼Œè¿”å›ä¸€ä¸ªè¿­ä»£å¯¹è±¡,`__next__()`æ–¹æ³•æ‹¿åˆ°å¾ªç¯çš„ä¸‹ä¸€ä¸ªå€¼
#
# `__getitem__ & __setitem__() & __delitem__()`:å®ç° list æŒ‰ä¸‹æ ‡å–å…ƒç´ çš„åŠŸèƒ½ï¼Œåˆ™å¿…é¡»å®ç°  
# `__len__()`:len(obj)å®é™…è°ƒç”¨ obj çš„`__len__()` 
#

```

### å¯è°ƒç”¨å¯¹è±¡å®ä¾‹ `__call__`

```python

    # `__call__ï¼ˆï¼‰`: ç±»å®ç°æ­¤æ–¹æ³•, åˆ™å®ä¾‹å˜é‡æœ¬èº«å¯ä½œä¸ºæ–¹æ³•è°ƒç”¨, å†™è£…é¥°å™¨å¾ˆæœ‰ç”¨
    # 
    # å¸¦æœ‰`__call__ï¼ˆï¼‰`çš„å¯¹è±¡æ˜¯`Callable`å¯¹è±¡ï¼Œ
    # å¦‚ä½•åˆ¤æ–­ï¼Ÿ  
    # é€šè¿‡ callable(obj)ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ¤æ–­ä¸€ä¸ª obj æ˜¯å¦æ˜¯â€œå¯è°ƒç”¨â€å¯¹è±¡
    #
    class Student(object):
        def __init__(self, name):
            self.name = name

        def __call__(self):
            print('My name is %s.' % self.name)

    s = Student('Michael')
    s() # selfå‚æ•°ä¸è¦ä¼ å…¥
    # My name is Michael.

```


### å±æ€§ç›‘æ§å›è°ƒ `__getattr__` `__getattribute__`

```python
# `__getattr__ï¼ˆself, attrï¼‰`:åŠ¨æ€è¿”å›å±æ€§ (è‹¥è·å–å¯¹è±¡ä¸å­˜åœ¨çš„å±æ€§, ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•å¾—åˆ°è¿”å›å€¼)
        # ä¸€èˆ¬é€šè¿‡è¿™ä¸ªæ–¹æ³•, ç¦æ­¢è·å–ä¸å­˜åœ¨çš„å¯¹è±¡
        def __getattr__(self, attr):
            raise AttributeError(f'Not suported attr: {attr}')

    # è¯¥æ–¹æ³•ä¹Ÿå¯ç”¨åœ¨åŒ…é¡¶çº§ä½œç”¨åŸŸä¸‹, é€šè¿‡åŒ…è·å–æŸä¸ªä¸å­˜åœ¨çš„å±æ€§, å°±ä¼šèµ°è¿™ä¸ªæ–¹æ³•
    #  åˆ©ç”¨è¿™ä¸ªç‰¹æ€§, å¯ä»¥å®ç°åŒ…çš„æ‡’åŠ è½½


#  __getattribute__()   æ— è®ºå±æ€§å­˜åœ¨ä¸å¦, éƒ½å›å…ˆcall è¿™ä¸ªæ–¹æ³•
        # å¯ä»¥ç”¨æ¥åšä¸€äº›æƒé™æ§åˆ¶
        def __getattribute(self, attr):
            if attr == 'price':
                if self.context.has_permission('own'):
                    return super().__getattribute(attr)
                else:
                    raise AttributeError(xxx)
            return super().__attribute__(attr)



# åº”ç”¨ï¼šREST APIçš„é“¾å¼è°ƒç”¨
class Chain(object):

    def __init__(self, path=''):
        self._path = path

    def __getattr__(self, path):
        return Chain('%s/%s' % (self._path, path))

    def __str__(self):
        return self._path

    __repr__ = __str__

# >>> Chain().status.user.timeline.list
# '/status/user/timeline/list'

```

### å¯è¿ç®— æ“ä½œç¬¦é‡è½½

#### åŠ å‡ä¹˜é™¤

```python

# ç­‰æ•ˆ sqart(a**2 + b**2)
def __abs__(self):
    return math.hypot(self.x, self.y)

# ä¸ºäº†ä½¿ç”¨ +
def __add__(self, other):
    x = self.x + other.x
    y = self.y + other.y
    return Vector(x, y)
# for ä¹˜æ³•
def __mul__(self, scalar):
    return Vector(self.x * scalar, self.y * scalar)

```

#### ç›¸ç­‰æ¯”è¾ƒ `==`, `is`, `__eq__`, ` id()`

```py

# '==' æ¯”è¾ƒçš„æ˜¯å†…å®¹ï¼Œ è‹¥ç›¸ç­‰ï¼Œ è¿™è¯æ˜ä¸¤ä¸ªå¯¹è±¡çš„ __eq__() æ–¹æ³•è¿”å›ä¸€æ ·
# is æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€ï¼Œ å³ id() çš„å€¼










a = [1, 2]
b = a
assert a==b  # true
assert a is b # true

# é‡æ–°èµ‹å€¼, å†…å­˜åœ°å€å˜äº†
a = [1,2] 
assert a == b # true
assert not a is b # true


# ç‰¹æ®Šçš„
# ç¼“å­˜æƒ…å†µ
# å¯¹äºæ•´æ•°ï¼Œåœ¨-5~256åŒºé—´çš„åˆå§‹å€¼ï¼ŒPythonä¼šé»˜è®¤åˆ’åˆ†ä¸€ä¸ªç¼“å­˜åŒºæ¥å­˜è´®ï¼Œåªè¦èµ‹å€¼è¿™ä¸ªåŒºé—´çš„å€¼ï¼Œä¸ä¼šå†é‡æ–°åœ¨å †å†…å­˜ä¸­å†åˆ’åˆ†ä¸€ä¸ªæ–°åŒºæ¥å­˜è´®ï¼Œè€Œæ˜¯ç”¨ç¼“å­˜çš„ï¼Œè¿™æ ·å°±ä¼šå¤§å¤§æé«˜æ•ˆç‡ã€‚å¯¹äºå­—ç¬¦ä¸²ï¼Œåœ¨<4097ä¸ªå­—ç¬¦çš„æƒ…å†µä¹Ÿä¸€æ ·ã€‚
a = 257
b = a
a = 257   # è™½ç„¶é‡æ–°åˆ†é…äº†, ä½†æ˜¯æ˜¯ç”¨çš„ç¼“å­˜, æ²¡é‡æ–°åˆ†æ´¾æ–°åœ°å€
assert a is b  # true

```

### æ‰“å°æ ¼å¼åŒ–  `__str__` `__repr__` 

```py

# __repr__ å’Œ __str__: ç”¨äº print(xx) è¢«è°ƒç”¨,
#  è‹¥ __str__å­˜åœ¨, åˆ™ä¼˜å…ˆä½¿ç”¨ __str__, ä¸€èˆ¬ä¼šä»¤ __repr__ = __str__




import math

class Vector:

    def __init__(self, x=0, y=0):
        self.x = x
        self.y = y

    # ä¸ºäº†ä½¿ç”¨ str(xxx)
    def __repr__(self):
        return f'Vector({self.x!r}, {self.y!r})'

    def __eq__(self, other):
        return self.x = other.x and self.y = other.y


#
v = Vector(1, 2)
str(v)  # è°ƒ __str__, ä¸å­˜åœ¨åˆ™è°ƒ __repr__
repr(v) # è°ƒ __repr__ 

v2 = eval(repr(v))  # ç”Ÿæˆæ–°å¯¹è±¡, å†…éƒ¨å±æ€§ç›¸ç­‰
v2 == v   # true
type(v2).__name__ == type(v).__name__ # true ç±»åç›¸åŒ



s = 'a"b'
str(s) # 'a"b'
repr(s) # '\'a"b\''      å­—ç¬¦ä¸²çš„æœºå™¨è¡¨è¾¾, å°†è¿™ç§è¡¨è¾¾é€šè¿‡å­—ç¬¦å½¢å¼å‘ˆç°å‡ºæ¥, å‘Šè¯‰æœºå™¨, sçš„å€¼æ˜¯å­—ç¬¦ä¸²
print(str(s), repr(s))   # a"b 'a"b'
```

### ç±»å‹è½¬æ¢ `__bool__`

```python

# ä¸ºäº†ä½¿ç”¨ bool()
def __bool__(self):
    return bool(abs(self))

```

# æ ‡å‡†åº“


## æ—¥æœŸå¤„ç†

```py
def builtin_module():
    from datetime import datetime, timedelta

    now = datetime.now()
    print(now) # 2019-06-05 23:06:46.171270

    time = datetime(2019, 4, 19, 1, 30)
    print(time) # 2019-04-19 01:30:00

    timestamp = time.timestamp()
    print(timestamp)  # 1555608600.0
    print(datetime.fromtimestamp(timestamp))  # 2019-04-19 01:30:00

    cday = datetime.strptime('2015-6-1 18:19:59', '%Y-%m-%d %H:%M:%S')
    print(cday)  # 2015-06-01 18:19:59

    strftime = now.strftime('%Y-%m-%d %H:%M:%S')
    print(strftime)  # 2019-06-05 23:06:46

    result = now + timedelta(days=1, hours=1)
    print(result)  # 2019-06-07 00:11:36.912231

```



# è®¾è®¡æ¨¡å¼ design pattern

## ä»£ç†æ¨¡å¼ proxy

```python
# ---------æ—¥å¿—è®°å½•ä»£ç†

# better way: é€šè¿‡è£…é¥°å™¨, ç›´æ¥åŒ…è£…éœ€è¦ä»£ç†çš„æ–¹æ³•

#  normal way: åˆ›å»ºä»£ç†ç±»
from abc import ABC, abstractmethod
class Subj(ABC):
    @abstractmethod
    def exec(self):
        pass

class RealSubj(Subj):
    def exec(self):
        print('-- å®é™…å¯¹è±¡çš„æ–¹æ³•')

class Proxy(Subj):
    def __init__(self, real_subj: Subj):
        self._real_subj = real_subj
    
    def _prev(self):
        print('_prev')
    
    def _post(self):
        print('_post')
    
    def exec(self):
        self._prev()
        self._real_subj.exec()
        self._post()

def client():
    proxy = Proxy(RealSubj())
    proxy.exec()

client()





# ------------ç¼“å­˜ä»£ç†
# é€šè¿‡è£…é¥°å™¨, åœ¨è£…é¥°å™¨å†…ç»´æŠ¤äº†ä¸€ä¸ªç¼“å­˜ mapping, åœ¨å®é™…æ–¹æ³•è°ƒç”¨å‰å, åŠ å…¥ç¼“å­˜çš„é€»è¾‘
# æœ‰ç°æˆçš„ -->   from functiontools import lru_cache,ä½œä¸ºè£…é¥°å™¨åŠ åœ¨æ–¹æ³•ä¸Šå³å¯

# --------è®¿é—®æ§åˆ¶


# ----------è™šæ‹Ÿä»£ç†
```

## å·¥å‚æ¨¡å¼ factory

```python



# now we have the following data
# trying to create diffecrrent obj accordng to the 'sex'
data = {
    "arr": [
        {
            "name": "aa",
            "sex": "male",
        },
        {
            "name": "bb",
            "sex": "female",
        },
    ]
}

from abc import ABC, abstractmethod
class Person(ABC):
    def __init__(self, name, sex):
        self.name = name
        self.sex = sex

    @abstractmethod
    def print_gender(self):
        """print gender"""


class Male(Person):
    def print_gender(self):
        print(f"{self.name}'s gender is {self.sex} --from Male class")


class Female(Person):
    def print_gender(self):
        print(f"{self.name}'s gender is {self.sex} --from Female class")


from typing import Callable, Any
# use this map to store the creation logic
# key is the sex, value is the create function
creation_functions: dict[str, Callable[..., Person]] = {}


def register(sex: str, func: Callable[..., Person]) -> None:
    creation_functions[sex] = func


def unregister(sex: str) -> None:
    creation_functions.pop(sex, None) # 'None' is reuqired to avoid raising exception


def create(args: dict[str, Any]) -> Person:
    the_args = args.copy()
    sex = the_args["sex"]
    
    try:
        func = creation_functions[sex]
        return func(**the_args)
    except KeyError:
        raise ValueError('unkonwn gender: ' + sex) from None

register('male', Male)
register('female', Female)

for ele in data['arr']:
    c = create(ele)
    c.print_gender()
```

## å•ä¾‹æ¨¡å¼ singleton

```python
# the following ways are all ok , but the first two is recommended
æ¨¡å—  # æ¨è
è£…é¥°å™¨  # æ¨è
__new__
classmethod
metaclass



# ----------- é€šè¿‡æ¨¡å—

# define a moddule singleton.py
class Config:
    pass

config = Config()

# åœ¨å…¶ä»–æ¨¡å—å°±å¯ä»¥å¯¼å…¥ä½¿ç”¨äº†, è¿™æ ·ä½¿ç”¨çš„å°±éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ (å¤šçº¿ç¨‹ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ)



#  -------------é€šè¿‡è£…é¥°å™¨

def singleton(cls):
    _instance_mapping = {}
    _lock = threading.Lock()
    
    def wrapper(*args, **kwargs):
        if cls not in _instance_mapping: 
            with _lock:
                if cls not in _instance_mapping:
                    _instance_mapping[cls] = cls(*args, **kwargs)
        return _instance_mapping[cls]
    return wrapper
    
@singleton
class Config:
    pass


# ---------------- é€šè¿‡ __new__


class Cofnig:
    _instance = None
    _lock = threading.Lock()

    def __new__(cls, *args, **kwargs):
        if cls._instance is None:
            with cls._lock:
                if cls._instance is None:
                    cls._instance = super(Cofnig, cls).__new__(cls, *args, **kwargs)
            
        return cls._instance


```


# å·¥ç¨‹åŒ–

https://zhuanlan.zhihu.com/p/509167266
https://pythonguidecn.readthedocs.io/zh/latest/writing/structure.html
https://www.qin.news/python/

## ä¾èµ–æ³¨å…¥

https://github.com/ets-labs/python-dependency-injector

## cookiecutter é¡¹ç›®æ¨¡æ¿

https://github.com/cookiecutter/cookiecutter

```sh

pip3 install -U cookiecutter

cookiecutter https://github.com/pyloong/cookiecutter-pythonic-project

```

## Setuptools: ç®¡ç†ä¾èµ–ã€æ„å»ºå’Œå‘å¸ƒ

## è™šæ‹Ÿç¯å¢ƒ virtual environment

```sh
docker åº”ç”¨çº§åˆ«çš„éš”ç¦» (é€‚åˆç”Ÿäº§)

virtualenv / venv 
    ä¼šåœ¨é¡¹ç›®è·¯å¾„ä¸‹æ–°å»ºä¸€ä¸ªvenvç›®å½•ç”¨äºå­˜å‚¨ç‹¬ç«‹çš„pythonè§£é‡Šå™¨åŠå…¶ç¬¬ä¸‰æ–¹ä¾èµ–åº“ï¼Œä½†é¡¹ç›®ä¹‹é—´ä¼šå…±äº«æ“ä½œç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ã€æ–‡ä»¶ç³»ç»Ÿç­‰ã€‚

conda éš”ç¦»èƒ½åŠ›æœ€å¼±ï¼Œæä¾›ç³»ç»Ÿç¯å¢ƒçº§åˆ«çš„éš”ç¦»ã€‚Condaå¯ä»¥åˆ›å»ºå¤šä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œæ¯ä¸ªç¯å¢ƒéƒ½å¯ä»¥ç”±å¤šä¸ªé¡¹ç›®å…±äº«ã€‚(é€‚åˆå¼€å‘)
    å› ä¸ºæ‰‹ä¸Šçš„é¡¹ç›®ä¹‹å‰å½¼æ­¤ä¾èµ–ã€ä¸”åŒæ—¶åœ¨è¿­ä»£å¼€å‘ï¼Œå°†å¤šä¸ªé¡¹ç›®å®‰è£…åœ¨åŒä¸€ç¯å¢ƒä¸­ï¼Œå¯ä»¥å‡å°‘é…ç½®ã€æµ‹è¯•ã€ç¼–è¯‘æ‰€éœ€çš„æ—¶é—´ã€‚
```


æ¨è venv (virtualenv è¿‡æ—¶äº†):

```sh
python -m venv venv_dir  # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒvenv_dirï¼Œ ä¼šè‡ªåŠ¨ç”Ÿæˆvenv_diræ–‡ä»¶å¤¹

# æ¿€æ´»
# æ¿€æ´»ç¯å¢ƒåæ‰€æœ‰çš„æ“ä½œéƒ½åœ¨è¯¥è™šæ‹Ÿç¯å¢ƒä¸­è¿›è¡Œï¼Œä¸ä¼šåˆ°å…¨å±€çš„pythonç¯å¢ƒå’Œå…¶å®ƒpythonè™šæ‹Ÿç¯å¢ƒ
$ cd venv_dir/
$ source ./bin/activate

# éªŒè¯æ˜¯å¦æ¿€æ´»
echo $VIRTUAL_ENV

# é€€å‡ºè™šæ‹Ÿç¯å¢ƒ
deactivate

# åˆ é™¤ç¯å¢ƒ
rm -rf venv_dir


# ä½¿ç”¨anacondaçš„conda
$ conda create -n env_name python=version package_names(é»˜è®¤åœ¨æ­¤ç¯å¢ƒä¸­å®‰è£…çš„pythonåŒ…)
# ä¾‹
$ conda create --name django_venv python=3.8 django

$ conda env list # æŸ¥çœ‹æ‰€æœ‰condaåˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒ

$ conda activate env_name
# ä¾‹
$ conda activate django_venv

$ conda deactivate  # ç›´æ¥æ‰§è¡Œconda deactivateå³å¯é€€å‡ºå½“å‰è™šæ‹Ÿç¯å¢ƒ

$ conda remove -n ven_name --all

```


ä½¿ç”¨ pycharm: https://blog.csdn.net/pfm685757/article/details/108590680

inherit global site-packages:å‹¾é€‰ä¸Šçš„è¯ä»£è¡¨åˆ›å»ºçš„æ–°é¡¹ç›®éœ€è¦copyä¸€ä»½å…¨å±€åŒ…åˆ°è™šæ‹Ÿç¯å¢ƒã€‚

Make available to all projects:å‹¾é€‰ä¸Šï¼Œè¡¨ç¤ºï¼Œå½“åœ¨è™šæ‹Ÿç¯å¢ƒä¸‹å®‰è£…åŒ…çš„æ—¶å€™ï¼Œcopyä¸€ä»½åˆ°å…¨å±€ã€‚


```sh
 pip3 install virtualenv
# è™šæ‹Ÿç¯å¢ƒ
# --no-site-packagesï¼Œå·²ç»å®‰è£…åˆ°ç³»ç»ŸPythonç¯å¢ƒä¸­çš„æ‰€æœ‰ç¬¬ä¸‰æ–¹åŒ…éƒ½ä¸ä¼šå¤åˆ¶è¿‡æ¥ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªä¸å¸¦ä»»ä½•ç¬¬ä¸‰æ–¹åŒ…çš„â€œå¹²å‡€â€çš„Pythonè¿è¡Œç¯å¢ƒã€‚
#               æ›´æ–° , ç‰ˆæœ¬ >=20 å, é»˜è®¤å°±åŠ ä¸Šäº†è¿™ä¸ªé€‰é¡¹, ä¸å¿…æ‰‹åŠ¨æŒ‡å®š
# -p æŒ‡å®šè§£é‡Šå™¨
virtualenv -p python3.6 venv  
# ä½¿ç”¨é»˜è®¤è§£é‡Šå™¨
virtualenv  venv
# æœ‰äº†venvè¿™ä¸ªPythonç¯å¢ƒï¼Œå¯ä»¥ç”¨sourceè¿›å…¥è¯¥ç¯å¢ƒ
source ./venv/bin/activate
# é€€å‡º venv
deactivate

#å¯¹å½“å‰å·²ç»åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒæ›´æ”¹ä¸ºå¯è¿ç§», ç”Ÿæˆå‹ç¼©åŒ…è§£å‹åç›´æ¥ä½¿ç”¨
virtualenv --relocatable ./

# å®‰è£…åº“ä¾èµ– åˆ° venv
pip install -r requirements.txt
# ç”Ÿæˆä¾èµ–æ–‡ä»¶
pip freeze > requirements.txt 
# å½“å‰å®‰è£…ç‰ˆæœ¬
pip freeze





# virtualenvwrapper,æ˜¯å¯¹ virtualenv çš„ä¸€ä¸ªå°è£…ï¼Œç›®çš„æ˜¯ä½¿åè€…æ›´å¥½ç”¨ã€‚


# venv , Python ä»3.3 ç‰ˆæœ¬å¼€å§‹ï¼Œè‡ªå¸¦äº†ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒ venv
# ä»…ä»…æ”¯æŒ python 3.3 å’Œä»¥åç‰ˆæœ¬ã€‚æ‰€ä»¥ï¼Œè¦åœ¨ python2 ä¸Šä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼Œä¾ç„¶è¦åˆ©ç”¨ virtualenv 
python3 -m venv <venv_name> # ä¸€èˆ¬å‘½åä¸º .venv

.venv\Scripts\activate.bat
# or
source .venv/bin/activate



```

ä½¿ç”¨ pycharm çš„ venv

è®¾ç½® interpretor, æ¨è venv è™šæ‹Ÿç¯å¢ƒ

"inherit global site packages" å‹¾é€‰è¡¨ç¤º project å†…æ‰¾ä¸åˆ°éœ€è¦çš„åº“, å°±æ‰©å¤§èŒƒå›´, åˆ°å…¨å±€ base interpretor çš„åº“å»æ‰¾, ä½†æ˜¯å®‰è£…çš„åº“ä¼šä½¿ç”¨ å…¨å±€ pip å®‰è£…, ä¼šå®‰è£…åˆ° base interpretor ä¸­, æ±¡æŸ“å…¨å±€. å»ºè®®ä¸è¦å‹¾é€‰

æ­¤æ—¶ä¼šåœ¨ project root ä¸‹ç”Ÿæˆ venv




## devops æ„å»ºæµæ°´çº¿

```sh

Fabric+Invoke

```

## å‘å¸ƒè‡ªå®šä¹‰åº“

https://github.com/pypa/twine Twine is a utility for publishing Python packages on PyPI.

## é¡¹ç›®ç»“æ„

```sh
Dockerfile
docs
pyproject.toml åŸºäº PEP518 è§„èŒƒçš„é…ç½®æ–‡ä»¶ï¼Œä¿å­˜äº†é¡¹ç›®ä»‹ç»ã€ä½œè€…è”ç³»æ–¹å¼ã€æ‰€ä¾èµ–çš„åŒ…ã€ä½¿ç”¨çš„æ„å»ºå·¥å…·
{project_name} æ”¾å®é™…é¡¹ç›®ä»£ç çš„æ–‡ä»¶å¤¹ ä¹‹æ‰€ä»¥ä¸ç”¨ src æ˜¯å› ä¸ºä½ åœ¨ç¼–å†™æµ‹è¯•ç”¨ä¾‹ã€æˆ–è€…æŠŠå®ƒä½œä¸º python çš„åŒ…ç»™å…¶å®ƒé¡¹ç›®ç”¨æ—¶ä¼šæ›´æ–¹ä¾¿
{project_name}-stubs å­˜æ”¾ mypy ç”Ÿæˆçš„ç±»å‹æè¿°æ–‡ä»¶ã€‚mypy ä¼šè‡ªåŠ¨è¯»å–è¿™ä¸ªé¡¹ç›®ä¸­çš„ç±»å‹æè¿°ï¼Œæ–¹ä¾¿åšç±»å‹åˆ¤æ–­ã€‚
tests
tox.ini tox çš„é…ç½®æ–‡ä»¶ã€‚


```

## æ¨¡å— import

### æ¨¡å—ç®€ä»‹

```py

# ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—
# ä¸€ä¸ªæ–‡ä»¶å¤¹, å†…éƒ¨åŒ…å«ä¸€ä¸ª __init__.py , è¿™ä¸ªæ–‡ä»¶å¤¹ä¹Ÿæ˜¯ä¸€ä¸ªæ¨¡å—
# 
# æ¨¡å—è¢«å¯¼å…¥, åŒ…çº§åˆ«(å³é¡¶çº§)ä½œç”¨åŸŸçš„ä»£ç è‡ªåŠ¨æ‰§è¡Œ, é‡å¤å¯¼å…¥ä¸ä¼šå†æ¬¡æ‰§è¡Œ

# æ¨¡å—åç§°è¦çŸ­ã€ä½¿ç”¨å°å†™ï¼Œå¹¶é¿å…ä½¿ç”¨ç‰¹æ®Šç¬¦å·, å¦‚".", "?", "_"
# (å°± my.spam.py æ¥è¯´ï¼ŒPython è®¤ä¸ºéœ€è¦åœ¨ my æ–‡ä»¶å¤¹ ä¸­æ‰¾åˆ° spam.py æ–‡ä»¶ï¼Œå®é™…å¹¶ä¸æ˜¯è¿™æ ·), å¯ä½¿ç”¨"_" ä½†ä¸æ¨è


# å¦‚æœå¼•ç”¨è‡ªå·±é¡¹ç›®çš„çš„æ¨¡å—æ—¶ï¼Œä½ çš„é¡¹ç›®å« myï¼Œæ¨¡å—å« moduï¼Œé‚£ä¹ˆä¸å»ºè®®ä½¿ç”¨ from my import moduæ¥å¼•ç”¨ï¼Œ
# å¼ºçƒˆæ¨èä½¿ç”¨ from . import moduã€‚




# ---------------- namespace package
# æœ‰æ—¶å¤šä¸ªåŒ…å­˜åœ¨å‘½åå†²çªçš„é£é™©, æˆ–è€…å¸Œæœ›å§å¤šä¸ªåŒ…ç»„ç»‡åœ¨ä¸€èµ·, æ–¹ä¾¿è°ƒç”¨, è¿™æ˜¯å¯ä½¿ç”¨ å‘½åç©ºé—´åŒ…
ns_pkg
â”œâ”€â”€ module1
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ func1.py
â”‚   â””â”€â”€ func2.py
â”œâ”€â”€ module2
    â””â”€â”€ __init__.py
# ns_pkg æ˜¯å‘½åç©ºé—´åŒ…çš„æ ¹ç›®å½•ï¼Œmodule1 å’Œ module2 æ˜¯å…¶å­åŒ…
# å¯¼å…¥
from ns_pkg.module1 import func1
from ns_pkg.module2 import func2

# or
# è¿™ç§æ–¹å¼ å¯ç›´æ¥é€šè¿‡ ns_pkg.func1, ns_pkg.func2 ä½¿ç”¨åŠŸèƒ½
from ns_pkg import *

```

#### æ¨¡å—æœç´¢è·¯å¾„

```py

   python æœ‰è‡ªå·±çš„æ¨¡å—æœç´¢è·¯å¾„, ä½†æ˜¯æ€ä¹ˆå¼•å…¥è‡ªå®šä¹‰çš„æ¨¡å—æœç´¢è·¯å¾„å‘¢?
    # æŸ¥çœ‹é»˜è®¤è·¯å¾„
    # æŸ¥æ‰¾é¡ºåºä¸º:
    # 1. ç¨‹åºæ‰€åœ¨ç›®å½•
    # 2. python å®‰è£…æ ‡å‡†åº“ç›®å½•(lib)
    # 3. ç¬¬ä¸‰æ–¹åº“ç›®å½• (site-package)
    import sys
    print(sys.path)
    # ä¸€æ¬¡æ€§è‡ªå®šä¹‰
    sys.path.append('/Users/michael/my_py_scripts')
    # æ°¸ä¹…
    è®¾ç½®ç¯å¢ƒå˜é‡PYTHONPATHï¼ŒPythonè‡ªèº«æœç´¢è·¯å¾„ä¸å—å½±å“



# import modu è¯­å¥å°†å¯»æ‰¾åˆé€‚çš„æ–‡ä»¶ï¼Œå³è°ƒç”¨ç›®å½•ä¸‹çš„ modu.py æ–‡ä»¶ï¼ˆå¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨ï¼‰ã€‚
#   - å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™ä»½æ–‡ä»¶ï¼ŒPython è§£é‡Šå™¨é€’å½’åœ°åœ¨ "PYTHONPATH" ç¯å¢ƒå˜é‡ä¸­æŸ¥æ‰¾è¯¥æ–‡ä»¶ï¼Œå¦‚æœä»æ²¡ æœ‰æ‰¾åˆ°ï¼Œå°†æŠ›å‡º ImportError å¼‚å¸¸
#   - ä¸€æ—¦æ‰¾åˆ° modu.pyï¼ŒPython è§£é‡Šå™¨å°†åœ¨éš”ç¦»çš„ä½œç”¨åŸŸå†…æ‰§è¡Œè¿™ä¸ªæ¨¡å—ã€‚
#       æ‰€æœ‰é¡¶å±‚è¯­å¥éƒ½ä¼šè¢«æ‰§è¡Œ. æ–¹æ³•ä¸ç±»çš„å®šä¹‰å°†ä¼šå­˜å‚¨åˆ°æ¨¡å—çš„å­—å…¸ä¸­ã€‚
#       ç„¶åè¿™ä¸ª æ¨¡å—çš„å˜é‡ã€æ–¹æ³•å’Œç±»é€šè¿‡ mudu è¿™ä¸ªå‘½åç©ºé—´æš´éœ²ç»™è°ƒç”¨æ–¹ï¼Œ


# æ¨¡å—æœç´¢ä¼˜å…ˆçº§: PYTHONPATHã€ç³»ç»Ÿé»˜è®¤ã€sys.path ä¸­çš„è‡ªå®šä¹‰è·¯å¾„, å¦‚
    ['/Users/xiaoyu/repo/python/quick_start/.venv/bin', 
    '/Users/xiaoyu/.rye/py/cpython@3.12.3/lib/python312.zip', 
    '/Users/xiaoyu/.rye/py/cpython@3.12.3/lib/python3.12/lib-dynload', 
    '/Users/xiaoyu/repo/python/quick_start/.venv/lib/python3.12/site-packages',
    '/Users/xiaoyu/repo/python/quick_start/src', 
    ]

```

#### importåŸç† æ¨¡å—æŸ¥è¯¢é“¾è·¯


```python
ä¾‹å¦‚:
import a.b.c  # a.b æ˜¯package, c æ˜¯å®é™…æ¨¡å—å

Python é¦–å…ˆå°è¯• import a, åˆ° globals() é‡Œæ‰¾æ˜¯å¦å­˜åœ¨ a æ¨¡å—, 
    è‹¥å­˜åœ¨, ç›´æ¥è¿”å›
    è‹¥ä¸åœ¨, ä¾æ¬¡è°ƒç”¨ importer, æ‰¾åˆ° a, æ·»åŠ åˆ° sys.modules é‡Œ, ç„¶åæ³¨å†Œåˆ° globals()
        # æœ‰ä¸‰ç§ importer, æ ¹æ®è°ƒç”¨é¡ºåº:
        - BuildinImporter
        - FrozenImporter
        - PathFinder
        - æˆ‘ä»¬ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ importer : CustomFinder, å¯ä»¥è‡ªå®šä¹‰åœ¨ importer é“¾æ¡ä¸­çš„é¡ºåº

        å‰é¢çš„ importer æ‰¾ä¸åˆ°, å°±è°ƒç”¨åé¢çš„ importer æ‰¾æ¨¡å—, éƒ½æ‰¾ä¸åˆ°å°±æŠ¥é”™

ç„¶åå°è¯• import a.b , é‡å¤ä¸Šé¢æµç¨‹

æœ€åå°è¯• import a.b.c



# ----------------

```

#### è‡ªå®šä¹‰å¯¼å…¥å™¨

```python

from importlib.abc import MetaPathFinder
import sys
class LoggingFinder(MetaPathFinder):
    def find_spec(self, fullname, path, target=None):
        print(f'--> {fullname}, path: {path}, target: {target}')
        # è¿™é‡Œè®¾ç½®ä¸ºæ‰¾ä¸åˆ°ä»»ä½•ä¸œè¥¿, é‚£ä¹ˆä¼šè°ƒç”¨åç»­çš„ importer ç»§ç»­æ‰¾
        return None
        # ç¦æ­¢å¯¼å…¥
        # raise ImportError('ç¦æ­¢å¯¼å…¥')

# æ³¨å†Œå¯¼å…¥å™¨, å¿…é¡»åœ¨ import è¯­å¥ä¹‹å‰æ‰§è¡Œ
sys.meta_path.insert(0, LoggingFinder())

```

### åŒ…å†…èµ„æº `importlib.resources`

```python
# importlib.resources.open_binary(pkg, resource)  ä»¥äºŒè¿›åˆ¶è¯»æ–¹å¼æ‰“å¼€
# importlib.resources.open_text(pkg, resource, encoding)  ä»¥æ–‡æœ¬è¯»æ–¹å¼ç‚¹å¼€


from importlib import resources
sys.path += ['/User/xxx/xxx/resource_pkg'] # å…ˆè®²èµ„æºè·¯å¾„æ·»åŠ åˆ° Python æ‰«æç›®å½•
with resources.open_text('resource_pkg.xxx', 'xxx.txt') as res
    print(res.read())

    # or read csv file
    rows = csv.DictReader(res)
    for row in rows:
        print('col1: ', row['col1'])

```

### å»¶è¿Ÿå¯¼å…¥ lazy import

```python

# ä¸ºäº†èŠ‚çœå†…å­˜, æ¨¡å—çš„å»¶è¿ŸåŠ è½½å¯ä»¥æœ‰ä¸‰ç§å¸¸è§çš„æ–¹å¼ï¼š
# - åœ¨å‡½æ•°æˆ–æ–¹æ³•å†…éƒ¨ä½¿ç”¨import ä¸æ¨è, ä¸åˆ©äºä»£ç é‡æ„, å› ä¸º import è¯­å¥æ•£è½åœ¨å„ä¸ªæ–¹æ³•å†…äº†
# - å€ŸåŠ©åŒ…çš„dunderæ–¹æ³•å®ç°å¯¼èˆªæ–¹å¼çš„åŒ…çº§åˆ«çš„æ¨¡å—å»¶è¿ŸåŠ è½½
#       __getattr__, __dir__
# - å€ŸåŠ©ç»§æ‰¿types.ModuleTypeæ¥è‡ªå®šä¹‰æ‡’åŠ è½½å™¨, å®ç°æ¨¡å—çº§åˆ«çš„å»¶è¿ŸåŠ è½½


# ------------------- å€ŸåŠ© dunder method

# define a folder module
mkdir lazymodule
touch lazymodule/__init__.py
touch lazymodule/prodct.py   # å‡è®¾è¿™ä¸ªå­æ¨¡å—éå¸¸è€—è´¹èµ„æº, éœ€è¦å»¶è¿Ÿå¯¼å…¥

# file __init__.py
import importlib
from types import ModuleType

__all__ = ['prodct'] # å®šä¹‰éœ€è¦æ‡’åŠ è½½çš„å­åŒ…å

def __getattr__(attr: str) -> ModuleType:
    if attr in __all__:
        return importlib.import_module(f'lazymodule.{attr}')
    raise ModuleNotFoundError(f'{attr} not found')

def __dir__(self) -> List[str]:
    return __all__

# è¿™æ ·åœ¨å…¶ä»–åœ°æ–¹å°±èƒ½æ­£å¸¸å¯¼å…¥æ‡’åŠ è½½çš„æ¨¡å—äº†






# ---------------- å€ŸåŠ©ç»§æ‰¿types.ModuleType
from types import ModuleType
import importlib
from typing import List, Mapping
class LazyLoader(ModuleType):
    def __init__(self, local_name: str, parent_module_golbals: Mapping, name: str):
        self._local_name = local_name
        self._parent_module_golbals = parent_module_golbals
        super(LazyLoader, self).__init__(name)
    
    # å¹‚ç­‰çš„, å› ä¸ºimport_module ä¸ä¼šåå¤æ³¨å†Œ
    def _load(self):
        module = importlib.import_module(self.__name__)
        self._parent_module_golbals[self._local_name] = module
        self.__dict__.update(modle.__dict__)

        return module

    def __getattr__(self, attr) -> ModuleType:
        mod = self._load()
        return getattr(mod, attr)
    
    def __dir__(self) -> List[str]:
        mod = self._load()
        return dir(mod)

product_module = LazyLoader('product', globals(), 'lazymodule.prodct')
```


### åŠ¨æ€å¯¼å…¥ å®ç°æ’ä»¶æ¨¡å¼

```python

# importlib.import_module é…åˆ é…ç½®ä¸­å¿ƒå…¥ console , nacos ç­‰ç­‰, å¯å®ç°æ ¹æ®é…ç½®åŠ åœ¨æŒ‡å®šæ¨¡å—
```


### å¯¼å…¥é’©å­ import hook

æ¡ˆä¾‹: å®ç°http è¿œç¨‹å¯¼å…¥

```python
https://www.bilibili.com/video/BV1M24y117aW
```

### path hook

```python
https://www.bilibili.com/video/BV1zM411C7WC/
```

## `__main__` `__name__` `__file__`

```python
# å½“ä¸€ä¸ªmodule è¢«å¯¼å…¥ä½¿ç”¨æ—¶, å…¶ __name__ ä¼šè¢«æŒ‡ä¸ºæ¨¡å—åå­—, å³ åŒ…å, __file__ è¢«ç½®ä¸ºåŒ…ç»å¯¹è·¯å¾„
__name__ == '__main__' å¯ä»¥ç”¨æ¥æ£€æµ‹å½“å‰æ¨¡å—æ˜¯å¦æ˜¯ç¨‹åºçš„æœ€é«˜å±‚çº§ç¯å¢ƒ, å³å¯ç”¨æ¥æ£€æµ‹ç¨‹åºçš„å…¥å£
# ä»€ä¹ˆæ˜¯æœ€é«˜å±‚çº§ç¯å¢ƒ?
# - å³å¯åŠ¨å‘½ä»¤æ‰€åœ¨ç¯å¢ƒ
#    eg:    python xxx.py
#           python -m xxx.py
#           python -c "if __name__ == '__main__': xxx"
#           echo "if __name == '__main__': xxx" | python



__main__py  æ˜¯ Python åŒ…çš„å…¥å£æ–‡ä»¶, å³ç”¨ python -m xxx_modle  ä¼šä»è¿™ä¸ªå…¥å£æ–‡ä»¶å¼€å§‹æ‰§è¡Œ




# ä¼˜é›…çš„å®šä¹‰å…¥å£å‡½æ•°

def main() -> int:
    xxx
    return 0
if __name__ == '__main__':
    sys.exit(main())

```


## type hints ç±»å‹æç¤º



https://www.zhihu.com/question/265003581/answer/461562594
https://zhuanlan.zhihu.com/p/56863684

https://github.com/python/mypy

https://github.com/google/pytype

https://docs.python.org/zh-cn/3/library/typing.html

```py
# è‡ªpython3.5å¼€å§‹ï¼ŒPEP484ä¸ºpythonå¼•å…¥äº†ç±»å‹æ³¨è§£(type hints)
# åœ¨ vscode ä¸­ä½ å¯ä»¥å®‰è£… mypy çš„æ’ä»¶,  Mypy æ˜¯ Python ä¸­çš„é™æ€ç±»å‹æ£€æŸ¥å™¨, 
    #
    # https://www.cnblogs.com/linkenpark/p/11676297.html
    # 
    # int,long,float: æ•´å‹,é•¿æ•´å½¢,æµ®ç‚¹å‹
    # bool,str: å¸ƒå°”å‹ï¼Œå­—ç¬¦ä¸²ç±»å‹
    # 
    # typingæ¨¡å—
    # 
    # List, Tuple, Dict, Set, Mapping:åˆ—è¡¨ï¼Œå…ƒç»„ï¼Œå­—å…¸, é›†åˆ, æ˜ å°„
    # Iterable,Iterator:å¯è¿­ä»£ç±»å‹ï¼Œè¿­ä»£å™¨ç±»å‹
    # Generatorï¼šç”Ÿæˆå™¨ç±»å‹
    #
    # ":" åé¢æ˜¯å‚æ•°ç±»å‹
    # "->" æ˜¯è¿”å›å€¼çš„æ³¨é‡Šï¼Œ-> str æ„æ€å³æ˜¯æé†’å‡½æ•°ä½¿ç”¨è€…è¿”å›å€¼ä¼šæ˜¯ä¸€ä¸ªstrå‹
    def f(ham: "ä¼ ä¸€ä¸ªå­—ç¬¦ä¸²", eggs: str = 'eggs') -> str :
        print("Annotations:", f.__annotations__)
        print("Arguments:", ham, eggs)
        return ham + ' and ' + eggs

    print(f("est", 123))

```





## linter å·¥å…·

```sh


å…³æ³¨è¿™ä¸ªå…¬å¸ https://astral.sh/

    https://github.com/astral-sh/ruff å¯ä»¥æŒ‡å‡ºæ— ç”¨çš„å¼•å…¥, è‡ªåŠ¨ä¿®å¤, æœ‰ vscode æ’ä»¶ (https://github.com/astral-sh/ruff-vscode)

https://www.pylint.org/


```

## ä¾èµ–å®‰å…¨æ€§æ£€æŸ¥

```sh
https://github.com/pyupio/safety
https://github.com/PyCQA/bandit

```

## ä»£ç é£æ ¼ æ ¼å¼åŒ–

```sh

Python å®˜æ–¹åŒæ—¶æ¨å‡ºäº†ä¸€ä¸ªæ£€æŸ¥ä»£ç é£æ ¼æ˜¯å¦ç¬¦åˆ PEP8 çš„å·¥å…·ï¼Œåå­—ä¹Ÿå« pep8ã€‚ä¸æ¨èäº†

æ›´æ¨è
Black è‡ªç§°â€œé›¶å¦¥åä»£ç æ ¼å¼åŒ–å·¥å…·ï¼ˆThe uncompromising code formatterï¼‰â€ã€‚ä¹‹æ‰€ä»¥æˆä¸ºâ€œä¸å¦¥åâ€æ˜¯å› ä¸ºå®ƒæ£€æµ‹åˆ°ä¸ç¬¦åˆè§„èŒƒçš„ä»£ç é£æ ¼ç›´æ¥å°±å¸®ä½ å…¨éƒ¨æ ¼å¼åŒ–å¥½ï¼Œæ ¹æœ¬ä¸éœ€è¦ä½ ç¡®å®šï¼Œç›´æ¥æ›¿ä½ åšå¥½å†³å®š
    é€Ÿåº¦æ›´å¿«
    æ›´å°‘çš„å¯é…ç½®é¡¹


https://pycqa.github.io/isort/ sort imports

https://github.com/asottile/pyupgrade å‡çº§è¯­æ³•

Flake8: ä½¿ç”¨Flake8æ£€æŸ¥ä»£ç æ˜¯å¦å·²æ ¼å¼åŒ–

```

## é…ç½®æ–‡ä»¶ç®¡ç†

```sh
https://github.com/dynaconf/dynaconf Dynaconf åŠ¨æ€é…ç½®ä½“ç³» 


```


## æµ‹è¯•test

### å•å…ƒæµ‹è¯•

```sh
Pytest 
    åœ¨ unittest çš„åŸºç¡€ä¸Š å¢åŠ äº†å¤§é‡è¯­æ³•ç³–ï¼Œè®©æµ‹è¯•æ›´åŠ ç®€ä¾¿å’Œçµæ´»ã€‚å¹¶ä¸”å¸¦æœ‰æ’ä»¶åŠŸèƒ½ï¼Œæ–¹ä¾¿é›†æˆå…¶ä»–åŠŸèƒ½ã€‚
    èƒ½å…¼å®¹å…¶ä»–å¤§å¤šæ•°æµ‹è¯•æ¡†æ¶

tox æ˜¯é€šç”¨çš„è™šæ‹Ÿç¯å¢ƒç®¡ç†å’Œæµ‹è¯•å‘½ä»¤è¡Œå·¥å…·ã€‚tox èƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨åŒä¸€ä¸ª Host ä¸Šè‡ªå®šä¹‰å‡ºå¤šå¥—ç›¸äº’ç‹¬ç«‹ä¸”éš”ç¦»çš„ python ç¯å¢ƒï¼Œå¦‚æœä½ çš„é¡¹ç›®éœ€è¦å…¼å®¹å¤šä¸ª python ç‰ˆæœ¬çš„è¯å¼ºçƒˆæ¨èä½¿ç”¨å®ƒ



https://github.com/pytest-dev/pytest-cov è¦†ç›–ç‡




```

### æ€§èƒ½å‹æµ‹

https://github.com/locustio/locust

### é›†æˆæµ‹è¯• integration test

```sh

Seleniumã€Pytest-Seleniumã€Robot Framework

```

    


## åŒ…ç®¡ç†

https://zhuanlan.zhihu.com/p/683701953 å¯¹æ¯”

```sh

https://github.com/python-poetry/poetry ç±»ä¼¼ Pipevn, åŸºäºè™šæ‹Ÿç¯å¢ƒ, ä¸»è¦æ˜¯ä¸ºäº†éš”ç¦»é¡¹ç›®å¼€å‘ç¯å¢ƒï¼Œä½†å¦‚æœæ¶‰åŠåˆ°è™šæ‹Ÿ ç¯å¢ƒåµŒå¥—è™šæ‹Ÿç¯å¢ƒï¼Œé—®é¢˜å°±éš¾æäº†ï¼Œç»å¸¸ä¼šå‡ºç°é—®é¢˜
    # å®‰è£…æœ€æ–°ç‰ˆ pip
    # -m pip: ä½¿ç”¨Pythonæ¨¡å—çš„æ–¹å¼æ¥è°ƒç”¨pipï¼Œå³é€šè¿‡pipæ¨¡å—æ¥æ‰§è¡Œæ“ä½œã€‚
    # -U: é€‰é¡¹è¡¨ç¤ºè¦æ›´æ–°å·²å®‰è£…çš„åŒ…ã€‚å¦‚æœå·²ç»å®‰è£…äº†pipï¼Œä½¿ç”¨-Ué€‰é¡¹å¯ä»¥å°†å…¶å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚
    python3 -m pip install -U pip
    pip install -U poetry

https://github.com/pdm-project/pdm ä¸éœ€è¦è™šæ‹Ÿç¯å¢ƒ , åƒ pnpm ä¸€æ ·çš„ä¸­å¿ƒåŒ–å®‰è£…ç¼“å­˜ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´
    https://zhuanlan.zhihu.com/p/468445226
    å›½äººä½œè€…https://github.com/frostming - https://frostming.com/2020/02-28/pdm-introduction/

https://github.com/mitsuhiko/rye
    https://github.com/astral-sh/uv ä»£æ›¿ pip, å¯ä»¥é›†æˆè¿›å…¥ rye (uv he ruff éƒ½å±äºä¸€ä¸ªå…¬å¸, ç°åœ¨ rye ä¹Ÿè¢«è¿™ä¸ªå…¬å¸æ¥æ”¶äº†)



```

### rye ä½¿ç”¨

```sh
# ä¸ç”Ÿæˆ src ç›®å½•, ç”¨äºå’Œ Django è¿™æ€»æ¡†æ¶åˆä½œ
rye init --virtual

rye init [--script] <proj name>
# å°†å½“å‰æ–‡ä»¶å¤¹ä½œä¸ºé¡¹ç›®æ ¹ç›®å½•
rye init 

# å…¨å±€å®‰è£…
rye install <lib name>
rye uninstall <xxx>

# å®‰è£…åˆ°å½“å‰é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒä¸­
rye add [-d or --dev] <lib name>
    rye add cowsay
rye remove <xxx>
rye sync
rye run <proj name> # å¦‚ï¼š rye run quick-start (â€˜_â€™ æ›¿æ¢ä¸º â€˜-â€™)
    rye run cowsay --text hellohhhh

rye run <executable name>
# eg. 
rye run black

# list the libs installed in this proj
rye list
# or
# é¡¹ç›®åŸºæœ¬ä¿¡æ¯ (åˆ—å‡ºå®‰è£…çš„ä¾èµ–)
rye show [--installed-deps]



# ä¸‹è½½ æ–°ç‰ˆPython
rye fetch <py version>
# eg
rye fetch 3.10

# æ·»åŠ  Python å‘è¡Œç‰ˆåˆ° rye, å¹¶ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬
rye +3.10

# åˆ—å‡º rye ç®¡ç†çš„æ‰€æœ‰å‘è¡Œç‰ˆ (ä¹Ÿå¯ä»¥åˆ—å‡ºå¯ä¾› ä¸‹è½½çš„ç‰ˆæœ¬)
rye toolchain list [--include-downloadable]
```


### uv





## æ—¥å¿—



```py
def log_handling():
    import logging
    # æœ‰debugï¼Œinfoï¼Œwarningï¼Œerrorç­‰å‡ ä¸ªçº§åˆ«ï¼Œç­‰çº§ç”±ä½åˆ°é«˜
    # è®¾å®šä¸ºæŸä¸ªçº§åˆ«, ä½äºè¿™ä¸ªçº§åˆ«çš„ä¸ä¼šè¾“å‡º
    logging.basicConfig(level=logging.INFO)
    s = '0'
    n = int(s)
    logging.info('n = %d' % n)
    # print(10 / n)

```


## ç”Ÿæˆæ–‡æ¡£

Mkdocs: ä»¥ Markdown é£æ ¼ç¼–å†™æ–‡æ¡£

https://www.mkdocs.org/

https://squidfunk.github.io/mkdocs-material/ ä¸»é¢˜



# å¹¶å‘

## GIL ç®€ä»‹

## å¤šçº¿ç¨‹

```python

def hello(arg):
    print('--hello', arg)

from concurrent.futures import ThreadPoolExecutor
with ThreadPoolExecutor(max_workers=10) as er:
    for i in range(10):
        er.submit(hello, i)
    
```


## å¤šè¿›ç¨‹

https://jeremyxu2010.github.io/2020/09/python%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%AE%9E%E6%88%98/ è‡ªå¸¦æ–¹å¼

gevent


https://stackoverflow.com/questions/42680357/increment-counter-for-every-access-to-a-flask-view é€šè¿‡å…¨å±€å˜é‡åŠ é”, ç»Ÿè®¡ api è°ƒç”¨æ¬¡æ•°

```py
def multi_processing():
    """
    åœ¨Unix/Linuxä¸‹ï¼Œå¯ä»¥ä½¿ç”¨fork()è°ƒç”¨å®ç°å¤šè¿›ç¨‹ã€‚
    è¦å®ç°è·¨å¹³å°çš„å¤šè¿›ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨multiprocessingæ¨¡å—ã€‚
    è¿›ç¨‹é—´é€šä¿¡æ˜¯é€šè¿‡Queueã€Pipesç­‰å®ç°çš„ã€‚
    subprocessæ¨¡å—å¯ä»¥è®©æˆ‘ä»¬éå¸¸æ–¹ä¾¿åœ°å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åæ§åˆ¶å…¶è¾“å…¥å’Œè¾“å‡ºã€‚é€šè¿‡communicate()æ–¹æ³•è¾“å…¥
    
    """

    import os
    print("ä¸»è¿›ç¨‹ pid = ", os.getpid())
    # fork()è°ƒç”¨ä¸€æ¬¡ï¼Œè¿”å›ä¸¤æ¬¡ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿè‡ªåŠ¨æŠŠå½“å‰
    # è¿›ç¨‹ï¼ˆç§°ä¸ºçˆ¶è¿›ç¨‹ï¼‰å¤åˆ¶äº†ä¸€ä»½ï¼ˆç§°ä¸ºå­è¿›ç¨‹ï¼‰ï¼Œç„¶åï¼Œåˆ†åˆ«åœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å†…è¿”å› process id
    # å­è¿›ç¨‹æ°¸è¿œè¿”å›0ï¼Œè€Œçˆ¶è¿›ç¨‹è¿”å›å­è¿›ç¨‹çš„ID
    pid = os.fork()
    if pid ==0:
        print("å­è¿›ç¨‹, id = {}, ppid = {}".format(os.getpid(), os.getppid()))
    else:
        print("çˆ¶è¿›ç¨‹, id = {}, son pid = {}".format(os.getpid(), pid))


def multi_processing_windows():
    """è·¨å¹³å°çš„å¤šè¿›ç¨‹"""
    from multiprocessing import Process
    import os

    # å­è¿›ç¨‹è¦æ‰§è¡Œçš„ä»£ç 
    def run_proc(name):
        print('Run child process %s (%s)...' % (name, os.getpid()))

    print('Parent process %s.' % os.getpid())
    p = Process(target=run_proc, args=('test',))
    p.start()

    p.join() # main process 
    print('Child process end.')

    # è¿›ç¨‹æ± 
    #
    from multiprocessing import Pool
    import os, time, random

    def long_time_task(name):
        print('Run task %s (%s)...' % (name, os.getpid()))
        start = time.time()
        time.sleep(random.random() * 3)
        end = time.time()
        print('Task %s runs %0.2f seconds.' % (name, (end - start)))

    if __name__=='__main__':
        print('Parent process %s.' % os.getpid())
        p = Pool(4) # Poolçš„é»˜è®¤å¤§å°æ˜¯CPUçš„æ ¸æ•°
        for i in range(5):
            p.apply_async(long_time_task, args=(i,))
        print('Waiting for all subprocesses done...')
        p.close()
        p.join()
        print('All subprocesses done.')


def process_comunicate():
    """è¿›ç¨‹é€šä¿¡"""
    from multiprocessing import Process, Queue
    import os, time, random

    # å†™æ•°æ®è¿›ç¨‹æ‰§è¡Œçš„ä»£ç :
    def write(q):
        print('Process to write: %s' % os.getpid())
        for value in ['A', 'B', 'C']:
            print('Put %s to queue...' % value)
            q.put(value)
            time.sleep(random.random())

    # è¯»æ•°æ®è¿›ç¨‹æ‰§è¡Œçš„ä»£ç :
    def read(q):
        print('Process to read: %s' % os.getpid())
        while True:
            value = q.get(True)
            print('Get %s from queue.' % value)

    # çˆ¶è¿›ç¨‹åˆ›å»ºQueueï¼Œå¹¶ä¼ ç»™å„ä¸ªå­è¿›ç¨‹ï¼š
    q = Queue()
    pw = Process(target=write, args=(q,))
    pr = Process(target=read, args=(q,))
    # å¯åŠ¨å­è¿›ç¨‹pwï¼Œå†™å…¥:
    pw.start()
    # å¯åŠ¨å­è¿›ç¨‹prï¼Œè¯»å–:
    pr.start()
    # ç­‰å¾…pwç»“æŸ:
    pw.join()
    # prè¿›ç¨‹é‡Œæ˜¯æ­»å¾ªç¯ï¼Œæ— æ³•ç­‰å¾…å…¶ç»“æŸï¼Œåªèƒ½å¼ºè¡Œç»ˆæ­¢:
    pr.terminate()


def muti_thread():
    """
    lock = threading.Lock() åˆ›å»ºé”
    lock.acquire() è·å–é”
    lock.release() é‡Šæ”¾é”, ä¸€èˆ¬åœ¨ finallyä¸­
    å¤šæ ¸ä»»åŠ¡åªèƒ½ç”¨è¿›ç¨‹, 
    å› ä¸º:Pythonçš„çº¿ç¨‹è™½ç„¶æ˜¯çœŸæ­£çš„çº¿ç¨‹ï¼Œä½†è§£é‡Šå™¨æ‰§è¡Œä»£ç æ—¶ï¼Œæœ‰ä¸€ä¸ªGILé”ï¼šGlobal Interpreter Lockï¼Œ
    ä»»ä½•Pythonçº¿ç¨‹æ‰§è¡Œå‰ï¼Œå¿…é¡»å…ˆè·å¾—GILé”ï¼Œç„¶åï¼Œæ¯æ‰§è¡Œ100æ¡å­—èŠ‚ç ï¼Œè§£é‡Šå™¨å°±è‡ªåŠ¨é‡Šæ”¾GILé”ï¼Œè®©
    åˆ«çš„çº¿ç¨‹æœ‰æœºä¼šæ‰§è¡Œã€‚è¿™ä¸ªGILå…¨å±€é”å®é™…ä¸ŠæŠŠæ‰€æœ‰çº¿ç¨‹çš„æ‰§è¡Œä»£ç éƒ½ç»™ä¸Šäº†é”ï¼Œæ‰€ä»¥ï¼Œå¤šçº¿ç¨‹åœ¨Python
    ä¸­åªèƒ½äº¤æ›¿æ‰§è¡Œï¼Œå³ä½¿100ä¸ªçº¿ç¨‹è·‘åœ¨100æ ¸CPUä¸Šï¼Œä¹Ÿåªèƒ½ç”¨åˆ°1ä¸ªæ ¸
    """

    import time, threading

    def loop():
        print('thread %s is running...' % threading.current_thread().name)
        n = 0
        while n < 5:
            n = n + 1
            print('thread %s >>> %s' % (threading.current_thread().name, n))
            time.sleep(1)
        print('thread %s ended.' % threading.current_thread().name)

    print('thread %s is running...' % threading.current_thread().name)
    # ä¸»çº¿ç¨‹å®ä¾‹çš„åå­—å«MainThreadï¼Œå­çº¿ç¨‹çš„åå­—åœ¨åˆ›å»ºæ—¶æŒ‡å®šï¼Œæˆ‘ä»¬ç”¨LoopThreadå‘½åå­çº¿ç¨‹
    t = threading.Thread(target=loop, name='LoopThread')
    t.start()
    t.join()
    print('thread %s ended.' % threading.current_thread().name)



```


## å¯å˜ ä¸å¯å˜

```python
from concurrent.futures import ProcessPoolExecutor, as_completed
from multiprocessing import Lock, Manager

lock = Lock()


def mut_sum(chunk: list[int], shared) -> None:
    global lock
    lock.acquire()
    shared['total'] += sum(chunk)
    lock.release()


def immut_sum(chunk: list[int]) -> int:
    return sum(chunk)


def make_chunk(max_num: int, chunk_num=1) -> list[list[int]]:
    data = [i for i in range(max_num + 1)]
    block_size = max_num // chunk_num

    def chunk_data():
        while data:
            block = data[:block_size]
            yield block
            del data[:block_size]

    return list(chunk_data())


def mut_calc(max_num: int, max_workers=4):
    manager = Manager()
    shared = manager.dict()
    shared['total'] = 0
    chunks = make_chunk(max_num, max_workers)
    with ProcessPoolExecutor(max_workers=max_workers) as executor:
        futures = (
            executor.submit(mut_sum, chunk, shared) for chunk in chunks
        )
        for fu in as_completed(futures):
            e = fu.exception()
            if e:
                raise Exception(e)
        return shared['total']


def immut_calc(max_num: int, max_workers=4) -> int:
    chunks = make_chunk(max_num, max_workers)
    with ProcessPoolExecutor(max_workers=max_workers) as executor:
        futures = (
            executor.submit(immut_sum, chunk) for chunk in chunks
        )

        def process_result():
            for fu in as_completed(futures):
                e = fu.exception()
                if e:
                    raise Exception(e)
                yield fu.result()

        return sum(process_result())

```


# å¼‚æ­¥ åç¨‹

## yield æ‰‹åŠ¨åˆ‡æ¢

```py

def async_io():
    """
    åç¨‹åŸç†:
    åœ¨ä¸€ä¸ªæ­»å¾ªç¯ä¸­, ä¸»çº¿ç¨‹ä¸æ–­è½®è¯¢å¤„ç†é˜Ÿåˆ—ä¸­çš„äº‹ä»¶, 
    å½“é‡åˆ°IOæ“ä½œæ—¶ï¼Œä»£ç åªè´Ÿè´£å‘å‡ºIOè¯·æ±‚ï¼Œä¸ç­‰å¾…IOç»“æœï¼Œç„¶åç›´æ¥ç»“æŸæœ¬è½®æ¶ˆæ¯å¤„ç†ï¼Œè¿›å…¥ä¸‹ä¸€è½®æ¶ˆæ¯å¤„ç†è¿‡ç¨‹
    å½“io å®Œæˆ, ä¼šäº§ç”Ÿé€šçŸ¥è¿›å…¥é˜Ÿåˆ—, åˆ«çº¿ç¨‹å¤„ç†
    æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯åç¨‹æé«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚å› ä¸ºå­ç¨‹åºåˆ‡æ¢ä¸æ˜¯çº¿ç¨‹åˆ‡æ¢
    ç¬¬äºŒå¤§ä¼˜åŠ¿å°±æ˜¯ä¸éœ€è¦å¤šçº¿ç¨‹çš„é”æœºåˆ¶ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿä¸å­˜åœ¨åŒæ—¶å†™å˜é‡å†²çªï¼Œåœ¨åç¨‹ä¸­æ§åˆ¶å…±äº«èµ„æºä¸åŠ é”ï¼Œåªéœ€è¦åˆ¤æ–­çŠ¶æ€å°±å¥½äº†
    å› ä¸ºåç¨‹æ˜¯ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œé‚£æ€ä¹ˆåˆ©ç”¨å¤šæ ¸CPUå‘¢ï¼Ÿæœ€ç®€å•çš„æ–¹æ³•æ˜¯å¤šè¿›ç¨‹+åç¨‹ï¼Œæ—¢å……åˆ†åˆ©ç”¨å¤šæ ¸ï¼Œåˆå……åˆ†å‘æŒ¥åç¨‹çš„é«˜æ•ˆç‡
    """
    def consumer():
        r = ''
        while True:
            n = yield r # consumeré€šè¿‡yieldæ‹¿åˆ°æ¶ˆæ¯ï¼Œå¤„ç†ï¼Œåˆé€šè¿‡yieldæŠŠç»“æœä¼ å›
            if not n:
                return
            print('[CONSUMER] Consuming %s...' % n)
            r = '200 OK'

    def produce(c):
        c.send(None) # å¯åŠ¨ç”Ÿæˆå™¨
        n = 0
        while n < 5:
            n = n + 1
            print('[PRODUCER] Producing %s...' % n)
            # ä¸€æ—¦ç”Ÿäº§äº†ä¸œè¥¿ï¼Œé€šè¿‡c.send(n)åˆ‡æ¢åˆ°consumeræ‰§è¡Œ
            r = c.send(n)
            print('[PRODUCER] Consumer return: %s' % r)
        # é€šè¿‡c.close()å…³é—­consumerï¼Œæ•´ä¸ªè¿‡ç¨‹ç»“æŸ
        c.close()

    c = consumer()
    produce(c)


    # 
    #
    # å¼‚æ­¥æ“ä½œéœ€è¦åœ¨coroutineä¸­é€šè¿‡yield fromå®Œæˆï¼›
    # 
    # å¤šä¸ªcoroutineå¯ä»¥å°è£…æˆä¸€ç»„Taskç„¶åå¹¶å‘æ‰§è¡Œã€‚
    #
    import asyncio # asyncioæ˜¯Python 3.4ç‰ˆæœ¬å¼•å…¥çš„æ ‡å‡†åº“ï¼Œç›´æ¥å†…ç½®äº†å¯¹å¼‚æ­¥IOçš„æ”¯æŒã€‚
    # https://github.com/dabeaz/curio æ›¿ä»£è€…

    @asyncio.coroutine # æŠŠä¸€ä¸ªgeneratoræ ‡è®°ä¸ºcoroutineç±»å‹
                        # ç„¶ååœ¨coroutineå†…éƒ¨ç”¨yield fromè°ƒç”¨å¦ä¸€ä¸ªcoroutineå®ç°å¼‚æ­¥æ“ä½œ
    def hello():
        print("Hello world!")
        # å¼‚æ­¥è°ƒç”¨asyncio.sleep(1), è™½ç„¶ç¡çœ 1s, ä½†æ˜¯ä¸»çº¿ç¨‹å¹¶æœªç­‰å¾…ï¼Œè€Œæ˜¯å»æ‰§è¡ŒEventLoopä¸­å…¶ä»–å¯ä»¥æ‰§è¡Œçš„coroutineäº†
        # asyncio.sleep()ä¹Ÿæ˜¯ä¸€ä¸ªcoroutine
        r = yield from asyncio.sleep(1)
        print("Hello again!")

    # è·å–EventLoop:
    loop = asyncio.get_event_loop()
    # æ‰§è¡Œcoroutine
    loop.run_until_complete(hello())

    # å°è£…ä¸¤ä¸ªcoroutine
    # ä¸¤ä¸ªcoroutineæ˜¯ç”±åŒä¸€ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„
    tasks = [hello(), hello()]
    loop.run_until_complete(asyncio.wait(tasks))

    loop.close()

    #asyncå’Œawaitæ˜¯é’ˆå¯¹coroutineçš„æ–°è¯­æ³•
    #
    #æŠŠ@asyncio.coroutineæ›¿æ¢ä¸ºasyncï¼›
    #æŠŠyield fromæ›¿æ¢ä¸ºawaitã€‚
    #
    async def hello1():
        print("Hello world!")
        r = await asyncio.sleep(1)
        print("Hello again!")

    # asyncioå¯ä»¥å®ç°å•çº¿ç¨‹å¹¶å‘IOæ“ä½œã€‚å¦‚æœä»…ç”¨åœ¨å®¢æˆ·ç«¯ï¼Œå‘æŒ¥çš„å¨åŠ›ä¸å¤§ã€‚
    # å¦‚æœæŠŠasyncioç”¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œä¾‹å¦‚WebæœåŠ¡å™¨ï¼Œç”±äºHTTPè¿æ¥å°±æ˜¯IOæ“ä½œï¼Œå› æ­¤å¯ä»¥ç”¨å•çº¿ç¨‹+coroutineå®ç°å¤šç”¨æˆ·çš„é«˜å¹¶å‘æ”¯æŒ
    # aiohttpåˆ™æ˜¯åŸºäºasyncioå®ç°çš„HTTPæ¡†æ¶
    #
    # ç¼–å†™ä¸€ä¸ªHTTPæœåŠ¡å™¨:
    #
    # import asyncio

    # from aiohttp import web

    # async def index(request):
    #     await asyncio.sleep(0.5)
    #     return web.Response(body=b'<h1>Index</h1>')

    # async def hello(request):
    #     await asyncio.sleep(0.5)
    #     text = '<h1>hello, %s!</h1>' % request.match_info['name']
    #     return web.Response(body=text.encode('utf-8'))

    # async def init(loop):
    #     app = web.Application(loop=loop)
    #     app.router.add_route('GET', '/', index)
    #     app.router.add_route('GET', '/hello/{name}', hello)
    #     srv = await loop.create_server(app.make_handler(), '127.0.0.1', 8000)
    #     print('Server started at http://127.0.0.1:8000...')
    #     return srv

    # loop = asyncio.get_event_loop()
    # loop.run_until_complete(init(loop))
    # loop.run_forever()

```


## gevent è‡ªåŠ¨åˆ‡æ¢

gevent ç¬¬ä¸‰æ–¹åº“

```python
from gevent import monkey
monkey.patch_all() # gevent æ— æ³•è¯†åˆ«æ™®é€šçš„ time.sleep (å³æ— æ³•è¯†åˆ«æ™®é€šç³»ç»Ÿ io)ï¼Œ éœ€è¦æ‰“è¡¥ä¸ï¼Œ è‹¥æ— è¡¥ä¸ï¼Œ éœ€è¦è°ƒç”¨ sleep çš„åœ°æ–¹è¦ç”¨ gevent.sleep  ä»£æ›¿
import gevent


s1 = gevent.spawn(func_a, func_a_params)
s2 = gevent.spwan(func_b, func_b_params)
gevent.joinall([s1, s2]) # é˜»å¡ç­‰å¾…

```



# ç¼–å†™å‘½ä»¤è¡Œç¨‹åº

https://www.jianshu.com/p/005ecf9cf8aa TODO

## å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨

https://www.cnblogs.com/lgh344902118/p/8521437.html

 TODO


# è°ƒè¯•

## æ–­è¨€

ç±»ä¼¼ print, 

ç¨‹åºä¸­å¦‚æœåˆ°å¤„å……æ–¥ç€assertï¼Œå’Œprint()ç›¸æ¯”ä¹Ÿå¥½ä¸åˆ°å“ªå»ã€‚ä¸è¿‡ï¼Œå¯åŠ¨Pythonè§£é‡Šå™¨æ—¶å¯ä»¥ç”¨-Oå‚æ•°æ¥å…³é—­assert: `python -O err.py`, å…³é—­åï¼Œå¯ä»¥æŠŠæ‰€æœ‰çš„assertè¯­å¥å½“æˆpassæ¥çœ‹

```python
def foo(s):
    n = int(s)
    # åªèƒ½æ–­è¨€ true or false
    # å¦‚æœæ–­è¨€å¤±è´¥ï¼Œassertè¯­å¥æœ¬èº«å°±ä¼šæŠ›å‡ºAssertionError
    assert n != 0, 'n is zero!'
    return 10 / n

def main():
    foo('0')

# è¿è¡Œæ—¶ï¼Œå…³é—­assert
$ python3 -O err.py
Traceback (most recent call last):
  ...
ZeroDivisionError: division by zero
```

## è®¾ç½®æ–­ç‚¹ pdb

å¯åŠ¨Pythonçš„è°ƒè¯•å™¨pdb `python -m pdb err.py`, è¾“å…¥å‘½ä»¤læ¥æŸ¥çœ‹ä»£ç , è¾“å…¥å‘½ä»¤nå¯ä»¥å•æ­¥æ‰§è¡Œä»£ç , ä½•æ—¶å€™éƒ½å¯ä»¥è¾“å…¥å‘½ä»¤p å˜é‡åæ¥æŸ¥çœ‹å˜é‡, è¾“å…¥å‘½ä»¤qç»“æŸè°ƒè¯•ï¼Œé€€å‡ºç¨‹åº

pdb.set_trace() è®¾ç½®æ–­ç‚¹

```python
# err.py
import pdb

s = '0'
n = int(s)
pdb.set_trace() # è¿è¡Œåˆ°è¿™é‡Œä¼šè‡ªåŠ¨æš‚åœ
print(10 / n)

$ python3 err.py
> /Users/michael/Github/learn-python3/samples/debug/err.py(7)<module>()
-> print(10 / n)# æ­¤æ—¶è¿›å…¥è°ƒè¯•æ¨¡å¼
(Pdb) p n # pæŸ¥çœ‹å˜é‡
0
(Pdb) c # c ç»§ç»­è¿è¡Œ
Traceback (most recent call last):
  File "err.py", line 7, in <module>
    print(10 / n)
ZeroDivisionError: division by zero

```



# jinja2 æ¨¡æ¿

æ¸²æŸ“ä½¿ç”¨ï¼š

```py
# FileSystemLoaderï¼šæ–‡ä»¶ç³»ç»ŸåŠ è½½å™¨
# ä¸éœ€è¦æ¨¡æ¿æ–‡ä»¶å­˜åœ¨æŸä¸ªPythonåŒ…ä¸‹ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ç³»ç»Ÿä¸­çš„æ–‡ä»¶

# PackageLoaderï¼šåŒ…åŠ è½½å™¨
from jinja2 import PackageLoader,Environment
# ä¸¤ä¸ªå‚æ•°ä¸ºï¼špythonåŒ…çš„åç§°ï¼Œä»¥åŠæ¨¡æ¿ç›®å½•åç§°
env = Environment(loader=PackageLoader('python_project','templates'))    # åˆ›å»ºä¸€ä¸ªåŒ…åŠ è½½å™¨å¯¹è±¡
template = env.get_template('bast.html')    # è·å–ä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶
template.render(name='daxin',age=18)   # æ¸²æŸ“


```

æ¨¡æ¿è¯­æ³•ï¼š

```py
# ä¸‰ç§è¯­æ³•
# æ§åˆ¶ç»“æ„ {% %}
# å˜é‡å–å€¼{{}}
# æ³¨é‡Š {# #}

# å¾ªç¯
# è¿­ä»£åˆ—è¡¨
<ul>
{% for user in users %}
<li>{{ user.username|title }}</li>
{% endfor %}
</ul>
# è¿­ä»£å­—å…¸
<dl>
{% for key, value in my_dict.iteritems() %}
<dt>{{ key }}</dt>
<dd>{{ value}}</dd>
{% endfor %}
</dl>

# è¿‡æ»¤å™¨ å°±æ˜¯å†…ç½®å‡½æ•°
# safe: æ¸²æŸ“æ—¶å€¼ä¸è½¬ä¹‰
# capitialize: æŠŠå€¼çš„é¦–å­—æ¯è½¬æ¢æˆå¤§å†™ï¼Œå…¶ä»–å­æ¯è½¬æ¢ä¸ºå°å†™
# lower: æŠŠå€¼è½¬æ¢æˆå°å†™å½¢å¼
# upper: æŠŠå€¼è½¬æ¢æˆå¤§å†™å½¢å¼
# title: æŠŠå€¼ä¸­æ¯ä¸ªå•è¯çš„é¦–å­—æ¯éƒ½è½¬æ¢æˆå¤§å†™
# trim: æŠŠå€¼çš„é¦–å°¾ç©ºæ ¼å»æ‰
# striptags: æ¸²æŸ“ä¹‹å‰æŠŠå€¼ä¸­æ‰€æœ‰çš„HTMLæ ‡ç­¾éƒ½åˆ æ‰
# join: æ‹¼æ¥å¤šä¸ªå€¼ä¸ºå­—ç¬¦ä¸²
# replace: æ›¿æ¢å­—ç¬¦ä¸²çš„å€¼
# round: é»˜è®¤å¯¹æ•°å­—è¿›è¡Œå››èˆäº”å…¥ï¼Œä¹Ÿå¯ä»¥ç”¨å‚æ•°è¿›è¡Œæ§åˆ¶
# int: æŠŠå€¼è½¬æ¢æˆæ•´å‹

{{ 'abc' | captialize  }}
# Abc

{{ 'abc' | upper  }}
# ABC

{{ 'hello world' | title  }}
# Hello World

{{ "hello world" | replace('world','daxin') | upper }}
# HELLO DAXIN

{{ 18.18 | round | int }}
# 18


# å®ç±»ä¼¼äºPythonä¸­çš„å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨å®ä¸­å®šä¹‰è¡Œä¸ºï¼Œè¿˜å¯ä»¥è¿›è¡Œä¼ é€’å‚æ•°ï¼Œå°±åƒPythonä¸­çš„å‡½æ•°
# å®šä¹‰
{% macro input(name,age=18) %}   # å‚æ•°ageçš„é»˜è®¤å€¼ä¸º18
 <input type='text' name="{{ name }}" value="{{ age }}" >
{% endmacro %}
# è°ƒç”¨
<p>{{ input('daxin') }} </p>
<p>{{ input('daxin',age=20) }} </p>

# ç»§æ‰¿å’Œsuperå‡½æ•°
# æ¨¡æ¿ç»§æ‰¿ã€‚æ¨¡æ¿ç»§æ‰¿å…è®¸æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºæœ¬(éª¨æ¶)æ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶ä»è¯¥éª¨æ¶æ–‡ä»¶ç»§æ‰¿ï¼Œç„¶åé’ˆå¯¹è‡ªå·±éœ€è¦çš„åœ°æ–¹è¿›è¡Œä¿®æ”¹

# éª¨æ¶
# å®šä¹‰äº†å››å¤„ blockï¼Œå³ï¼šheadï¼Œtitleï¼Œcontentï¼Œfooter
<!DOCTYPE html>
<html lang="en">
<head>
    {% block head %}
    <link rel="stylesheet" href="style.css"/>
    <title>{% block title %}{% endblock %} - My Webpage</title>
    {% endblock %}
</head>
<body>
<div id="content">{% block content %}{% endblock %}</div>
<div id="footer">
    {% block  footer %}
    <script>This is javascript code </script>
    {% endblock %}
</div>
</body>
</html>

# æ–°å»ºæ–‡ä»¶ç»§æ‰¿
{% extend "base.html" %}       # ç»§æ‰¿base.htmlæ–‡ä»¶

{% block title %} Dachenzi {% endblock %}   # å®šåˆ¶titleéƒ¨åˆ†çš„å†…å®¹

{% block head %}
    {{  super()  }}        # ç”¨äºè·å–åŸæœ‰çš„ä¿¡æ¯
    <style type='text/css'>
    .important { color: #FFFFFF }
    </style>
{% endblock %}

# å…¶ä»–ä¸ä¿®æ”¹çš„åŸå°ä¸åŠ¨çš„ç»§æ‰¿

```

# è·¯å¾„é—®é¢˜

## æ–‡ä»¶è·¯å¾„ and ç»ˆç«¯è·¯å¾„

éœ€è¦ç”¨å‘½ä»¤è¡Œæ“ä½œçš„æ—¶å€™ï¼Œä¹Ÿå°±æœ‰å‚æ•° argvçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦æ±‚ç»ˆç«¯è·¯å¾„å’ŒPythonæ–‡ä»¶è·¯å¾„ä¸€è‡´ã€‚å‘½ä»¤è¡Œè¿è¡Œç¨‹åºçš„æ ¼å¼æ˜¯ï¼špython+Pythonæ–‡ä»¶å+å‚æ•°

## è·å–è„šæœ¬ä½ç½®

```py
if __name__ == '__main__':
    import sys
    import os

    # ä¸é€‚ç”¨äº å‘½ä»¤è¡Œç¨‹åº,
    print(sys.argv)    # ['D:/repo/repo_github/shared_already/rest-api-generator/test_jinja.py']
    # è·å¾—çš„æ˜¯å½“å‰æ‰§è¡Œè„šæœ¬çš„ä½ç½®
    # è‹¥åœ¨å‘½ä»¤è¡Œ, æ‰“å°çš„æ˜¯ 'py xxx'å‘½ä»¤ä¸­çš„ xxx
    print(sys.argv[0])    # D:/repo/repo_github/shared_already/rest-api-generator/test_jinja.py

    # python æŸ¥æ‰¾åº“çš„è·¯å¾„, ç¬¬ä¸€ä¸ªæ˜¯å½“å‰é¡¹ç›®è·¯å¾„
    print(sys.path)
    print(sys.path[0])  # D:\repo\repo_github\shared_already\rest-api-generator

    # åˆ¤æ–­ä¸ºè„šæœ¬æ–‡ä»¶è¿˜æ˜¯py2exeç¼–è¯‘åçš„æ–‡ä»¶ï¼Œå¦‚æœæ˜¯è„šæœ¬æ–‡ä»¶ï¼Œ
    # åˆ™è¿”å›çš„æ˜¯è„šæœ¬çš„ç›®å½•ï¼Œå¦‚æœæ˜¯py2exeç¼–è¯‘åçš„æ–‡ä»¶ï¼Œåˆ™è¿”å›çš„æ˜¯ç¼–è¯‘åçš„æ–‡ä»¶è·¯å¾„
    cur_path = sys.path[0]
    if os.path.isdir(cur_path):
        print('current project dir: [{}]'.format(cur_path))
    elif os.path.isfile(cur_path):
        dirname = os.path.dirname(cur_path)
        print('current project dir: [{}]'.format(dirname))

    # å½“å‰å·¥ä½œç›®å½•
    # è‹¥è¦æ”¹å˜å½“å‰å·¥ä½œè·¯å¾„ï¼Œå¯ä»¥ç”¨ï¼šos.chdir(path)
    print(os.getcwd())
    print(os.path.abspath(os.curdir))
    print(os.curdir)  # ç›¸å¯¹è·¯å¾„
    print(os.path.abspath('.'))
    # çˆ¶ç›®å½•
    print(os.path.abspath('..'))


```

# shutil ä½¿ç”¨

TODO

```py
# é€’å½’åˆ é™¤ç›®å½•

import shutil  
shutil.rmtree('è¦æ¸…ç©ºçš„æ–‡ä»¶å¤¹å')  # å…ˆåˆ é™¤
os.mkdir('è¦æ¸…ç©ºçš„æ–‡ä»¶å¤¹å')  # å†é‡å»º

import os
for root, dirs, files in os.walk(top, topdown=False):
    for name in files:
        os.remove(os.path.join(root, name))
    for name in dirs:
        os.rmdir(os.path.join(root, name))

# ç§»åŠ¨æ–‡ä»¶å¤¹
shutil.move('åŸæ–‡ä»¶å¤¹/åŸæ–‡ä»¶å','ç›®æ ‡æ–‡ä»¶å¤¹/ç›®æ ‡æ–‡ä»¶å') 

```


# web å¼€å‘

https://www.zhihu.com/question/20706333/answer/24927602 æœ‰å“ªäº›æ¡†æ¶
https://www.zhihu.com/question/41564604/answer/660256963 å¯¹æ¯”

- Flask: å°è€Œç¾, é€‚åˆå°ç«™ç‚¹, å¼€å‘webæœåŠ¡çš„API, å’Œ nosqlé…åˆè‰¯å¥½

- Django: å¤§è€Œå…¨, è‡ªå¸¦ template, orm, é€‚åˆå¼€å‘ä¼ä¸šçº§ç½‘ç«™, é€‚åˆ sql, æ— æ³•é…åˆnosqlæ•°æ®åº“

- Torando: åŸç”Ÿå¼‚æ­¥éé˜»å¡ï¼Œåœ¨IOå¯†é›†å‹åº”ç”¨å’Œå¤šä»»åŠ¡å¤„ç†ä¸Šå æ®ç»å¯¹æ€§çš„ä¼˜åŠ¿ï¼Œå±äºä¸“æ³¨å‹æ¡†æ¶

    websockets é•¿è¿æ¥;

    å†…åµŒäº†HTTPæœåŠ¡å™¨


## ç”¨Pythonå†™ui

```python


https://github.com/streamlit/streamlit æœ€ç«

https://github.com/gradio-app/gradio

https://github.com/plotly/dash åˆ¶ä½œæ•°æ®å›¾è¡¨,ç»Ÿè®¡è¡¨

https://github.com/kivy/kivy ui æ¡†æ¶

https://github.com/pydantic/FastUI
```

## litestar

https://github.com/litestar-org/litestar  å’Œ fastapi ç±»ä¼¼çš„å®šä½å’ŒåŠŸèƒ½ï¼Œä½†æä¾›æ›´å¤šçš„æ—¥å¸¸å¼€å‘ç»„ä»¶ï¼Œæ›´å¥åº·çš„ç¤¾åŒºè´¡çŒ®æ„æˆï¼Œé•¿æœŸçœ‹å¥½


## fastapi


å¼€å‘ rest api éå¸¸æ–¹ä¾¿ https://juejin.cn/post/6844904051327369224

https://github.com/nsidnev/fastapi-realworld-example-app

## Django

```sh
# å‡çº§ pip åˆ° v21
python -m pip install --upgrade pip

pip install Django

# åˆ›å»ºæ¨¡æ¿ä»£ç 
# æœ«å°¾ . è¡¨ç¤ºå½“å‰ç›®å½•, å¯é€‰
# django_demo ä¸ºé¡¹ç›®å, ä¸€èˆ¬å’Œå½“å‰æ–‡ä»¶å¤¹åä¿æŒä¸€è‡´
django-admin startproject django_demo .

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python manage.py runserver [[0:]8080]

# åˆ›å»º demo app: polls çš„æ¨¡æ¿ä»£ç 
python manage.py startapp polls

# æ£€æŸ¥ INSTALLED_APPS è®¾ç½®ï¼Œä¸ºå…¶ä¸­çš„æ¯ä¸ªåº”ç”¨åˆ›å»ºéœ€è¦çš„æ•°æ®è¡¨/æ›´æ–°è¡¨ç»“æ„
python manage.py migrate

# ä¸ºæŒ‡å®š app åˆ›å»º è¿ç§»æ–‡ä»¶(æ¨¡å‹æ•°æ®, ç”¨äºç”Ÿæˆ SQL), polls æ˜¯è‡ªå®šä¹‰ app name
python manage.py makemigrations polls

#  æŸ¥çœ‹ SQL
python manage.py sqlmigrate polls 0001


# é€šè¿‡æ¨¡å‹ api æ“ä½œæ•°æ®åº“
python manage.py shell
```


## flask


https://github.com/humiaozuzu/awesome-flask

https://github.com/yangyuexiong/Flask_BestPractices ä¸­æ–‡

### flaskè§£å†³è·¨åŸŸé—®é¢˜

https://blog.csdn.net/h18208975507/article/details/102551339

### ä¿æŠ¤ flask api

https://blog.miguelgrinberg.com/post/restful-authentication-with-flask
https://geekflare.com/securing-flask-api-with-jwt/


### å‘½ä»¤è¡Œor idea å¯åŠ¨


```sh
export FLASK_APP=hello.py

# optional, enable debug mode
export FLASK_ENV=development

# default port -> 5000
flask run [--host=0.0.0.0]


```

é€šè¿‡  idea å¯åŠ¨, é»˜è®¤æ˜¯åŸºäº flask æ¡†æ¶å¯åŠ¨ (å³å³é”®è¿è¡Œé»˜è®¤æ˜¯Flaskæ‰§è¡Œé¡¹ç›®), ä¸ä¼šèµ° main æ–¹æ³•

è‹¥å¸Œæœ›èµ° main æ–¹æ³•, éœ€è¦æ‰‹åŠ¨é…ç½® å¯åŠ¨ configuration

### rest api

https://www.jianshu.com/p/a25357f2d930 jsonify ç›¸æ¯”ç›´æ¥è¿”å› dict/json.dump({}) çš„å¥½å¤„


è§£æè¯·æ±‚å‚æ•°
```python
def request_parse(req_data):
	'''è§£æè¯·æ±‚æ•°æ®å¹¶ä»¥jsonå½¢å¼è¿”å›'''
    if req_data.method == 'POST':
        data = req_data.json
    elif req_data.method == 'GET':
        data = req_data.args
    return data
   
@app.route('/', methods = ["GET","POST"])   # GET å’Œ POST éƒ½å¯ä»¥
def get_data():
	data = request_parse(request)
	# å‡è®¾æœ‰å¦‚ä¸‹ URL
    # http://10.8.54.48:5000/index?name=john&age=20
    name = data.get("name")
    age = data.get("age")

```


https://blog.csdn.net/pineapple_C/article/details/113339718 æ‹¦æˆªå™¨

### æ•°æ®åº“äº¤äº’



https://www.jianshu.com/p/f7ba338016b8 orm æ¡†æ¶ SQLAlchemy


https://xieyugui.wordpress.com/2015/04/17/sqlalchemy-%E4%BD%BF%E7%94%A8%E5%8A%A8%E6%80%81model%E5%92%8C%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BA%E8%A1%A8/ ä½¿ç”¨åŠ¨æ€modelå’ŒåŠ¨æ€åˆ›å»ºè¡¨

```py
# åŸç”Ÿsqlè¯­å¥æ“ä½œ
sql = 'select * from user'
result = db.session.execute(sql)

# æŸ¥è¯¢å…¨éƒ¨
User.query.all()
# ä¸»é”®æŸ¥è¯¢
User.query.get(1)

# æ¡ä»¶æŸ¥è¯¢
User.query.filter_by(username='name').all() # or first()
#                                 ><ï¼ˆå¤§äºå’Œå°äºï¼‰æŸ¥è¯¢    and_å’Œor_æŸ¥è¯¢, in_
# filter_by()	ç›´æ¥ç”¨å±æ€§åï¼Œæ¯”è¾ƒç”¨=	ä¸æ”¯æŒ	ä¸æ”¯æŒ
# filter()	ç”¨ç±»å.å±æ€§åï¼Œæ¯”è¾ƒç”¨==	    æ”¯æŒ	æ”¯æŒ

# å¤šæ¡ä»¶æŸ¥è¯¢
from sqlalchemy import and_
User.query.filter_by(and_(User.username =='name',User.password=='passwd'))
# æ¯”è¾ƒæŸ¥è¯¢
User.query.filter(User.id.__lt__(5)) # å°äº5
User.query.filter(User.id.__le__(5)) # å°äºç­‰äº5
User.query.filter(User.id.__gt__(5)) # å¤§äº5
User.query.filter(User.id.__ge__(5)) # å¤§äºç­‰äº5
# inæŸ¥è¯¢
User.query.filter(User.username.in_('A','B','C','D'))
# æ’åº
User.query.order_by('age') # æŒ‰å¹´é¾„æ’åºï¼Œé»˜è®¤å‡åºï¼Œåœ¨å‰é¢åŠ -å·ä¸ºé™åº'-age'
# é™åˆ¶æŸ¥è¯¢
User.query.filter(age=18).offset(2).limit(3)  # è·³è¿‡äºŒæ¡å¼€å§‹æŸ¥è¯¢ï¼Œé™åˆ¶è¾“å‡º3æ¡

https://blog.csdn.net/qq_41856814/article/details/101226416 åˆ†é¡µæŸ¥è¯¢

# å¢åŠ 
use = User(id,username,password)
db.session.add(use)
db.session.commit() 

# åˆ é™¤
User.query.filter_by(User.username='name').delete()

# ä¿®æ”¹
User.query.filter_by(User.username='name').update({'password':'newdata'})


```


https://github.com/miguelgrinberg/Flask-Migrate Flask-Migrate æ•°æ®è¿ç§», æ ¹æ® model åˆ›å»º table
https://blog.csdn.net/feit2417/article/details/86592319

```sh
# db æ˜¯ä»£ç ä¸­çš„ migration command name

# ç”Ÿæˆ migrations æ–‡ä»¶å¤¹
python3 manage.py db init

python3 manage.py db migrate
python3 manage.py db upgrade
# åç»­å¯¹è„šæœ¬æœ‰ä»»ä½•çš„ä¿®æ”¹ï¼Œåªè¦é‡å¤æ‰§è¡Œåä¸¤å¥å°±å¯ä»¥äº†

# å…¶ä»–æŒ‡ä»¤
manage.py db: error: invalid choice: 'migration' (choose from 'init', 'revision', 'migrate', 'edit', 'merge', 'upgrade', 'downgrade', 'show', 'history', 'heads', 'branches', 'current', 'stamp')


```


https://www.jianshu.com/p/a681f6490c3c Flask-script
https://zhuanlan.zhihu.com/p/269820011



https://stackoverflow.com/questions/17972020/how-to-execute-raw-sql-in-flask-sqlalchemy-app?rq=1 æ‰§è¡ŒåŸç”Ÿ SQL



### flask ä¸­çš„æ—¥å¿—

https://www.jianshu.com/p/daf5c9e57c65

```py
app.logger.info('')
# æ‰“å°å †æ ˆ
app.logger.exception('')
app.logger.debug('A value for debugging')
app.logger.warning('A warning occurred (%d apples)', 42)
app.logger.error('An error occurred')

```


æ—¥å¿—åˆ‡åˆ†:

- æŒ‰ç…§å¤§å°


```py
from logging.handlers import RotatingFileHandler 
# backupCount å°±æ˜¯ä¿ç•™çš„æ—¥å¿—ä¸ªæ•°ã€‚ æ¯”å¦‚flask.log å†™æ»¡äº†ï¼Œ å°±ä¼šè¢«é‡å‘½åæˆflask.log.1, ç¨‹åºç»§ç»­å‘flask.logå†™å…¥ã€‚
handler = RotatingFileHandler("flask.log", maxBytes=1024000, backupCount=10)
```



- æŒ‰ç…§æ—¥æœŸ


```py
from logging.handlers import TimedRotatingFileHandler
handler = TimedRotatingFileHandler(
        "flask.log", when="D", # when=Dï¼š è¡¨ç¤ºæŒ‰å¤©è¿›è¡Œåˆ‡åˆ†
        interval=1,  # æ¯å¤©éƒ½åˆ‡åˆ†ã€‚ æ¯”å¦‚interval=2å°±è¡¨ç¤ºä¸¤å¤©åˆ‡åˆ†ä¸€ä¸‹
         backupCount=15 , # ä¿ç•™15å¤©çš„æ—¥å¿—
        encoding="UTF-8", # ä½¿ç”¨UTC+0çš„æ—¶é—´æ¥è®°å½• ï¼ˆä¸€èˆ¬dockeré•œåƒé»˜è®¤ä¹Ÿæ˜¯UTC+0)
        delay=False, utc=True)
```


`# [%(asctime)s][%(filename)s:%(lineno)d][%(levelname)s][%(thread)d] - %(message)s` æ ¼å¼é…ç½®

```py

if __name__ == '__main__':
    formatter = logging.Formatter(
        "[%(asctime)s][%(filename)s:%(lineno)d][%(levelname)s][%(thread)d] - %(message)s")
        # (%(hostname)s)[%(asctime)s][%(filename)s:%(lineno)d][%(levelname)s][%(thread)d] - %(message)s å¢åŠ äº† hostname
    handler = TimedRotatingFileHandler(
        "flask.log", when="D", interval=1, backupCount=15,
        encoding="UTF-8", delay=False, utc=True)
    handler.setFormatter(formatter)
    app.logger.addHandler(handler)
    app.run(host='0.0.0.0', port=5001, debug=True)



# ä¹Ÿå¯é€šè¿‡ è‡ªå®šä¹‰ log filter å®šåˆ¶ æ—¥å¿—
# é¦–å…ˆè‡ªå®šä¹‰ä¸€ä¸ªLogFilter
class ContextFilter(logging.Filter):
    '''Enhances log messages with contextual information'''
    def filter(self, record):
        record.hostname = "my-windows-10"
        return True

# åœ¨mainå‡½æ•°ä¹‹ä¸­ï¼Œ å¢åŠ åŠ è½½è¿™ä¸ªfilterå³å¯
handler.addFilter(ContextFilter())

```



SMTPHandlerè·ŸHTTPHandler å‘é€é‚®ä»¶ æˆ–è€… http


```py

if __name__ == '__main__':
    app.debug = True

    # File and Console handler &amp; formtter
    formatter = logging.Formatter(
        "[%(asctime)s][%(module)s:%(lineno)d][%(levelname)s][%(thread)d] - %(message)s")
    handler = TimedRotatingFileHandler(
        "flask.log", when="D", interval=1, backupCount=15,
        encoding="UTF-8", delay=False, utc=True)
    app.logger.addHandler(handler)
    handler.setFormatter(formatter)

    # Email Handler
    mail_handler = SMTPHandler(
        mailhost='10.64.1.85',
        fromaddr='flask-admin@trendmicro.com',
        toaddrs=['wenjun_yang@trendmicro.com'],
        subject='Flask Application Error'
    )
    mail_handler.setLevel(logging.ERROR)
    mail_handler.setFormatter(logging.Formatter(
        "[%(asctime)s][%(module)s:%(lineno)d][%(levelname)s][%(thread)d] - %(message)s"
    ))
    app.logger.addHandler(mail_handler)

    app.run()
```

### blueprintè“å›¾ æ¨¡å—åŒ–å¼€å‘

https://realpython.com/flask-blueprint/

### ä¸Šä¸‹æ–‡å¯¹è±¡

https://sentry.io/answers/working-outside-of-application-context/ current_app ä½¿ç”¨ (`RuntimeError: working outside of application context`æŠ¥é”™)

https://github.com/tiangolo/fastapi/issues/81 ä½¿ç”¨ app ä¸Šä¸‹æ–‡å­˜å‚¨æ•°æ®


æ¯æ¬¡ è¯·æ±‚éƒ½æ˜¯æ–°çš„(è•¾è¥¿ java çš„ threadlocal), app æ˜¯çœŸä¸ªåº”ç”¨å…¨å±€ç”Ÿå‘½å‘¨æœŸçš„

https://zhuanlan.zhihu.com/p/26097310
https://www.zhihu.com/question/33970027



# db é©±åŠ¨ é—®é¢˜

mac æ— æ³•å®‰è£… postgres é©±åŠ¨

é©±åŠ¨åœ¨è¿™: https://pypi.org/project/psycopg2/, éœ€è¦é¦–å…ˆå®‰è£… postgres  `brew install postgres`, è®¾ç½® path, ç„¶åå®‰è£… ([å‚è€ƒ](https://www.psycopg.org/docs/install.html#install-from-source))

å¦‚æœè¿˜æ˜¯ä¸è¡Œ `pip install psycopg2-binary==2.8.3` ([å‚è€ƒ](https://stackoverflow.com/questions/34304833/failed-building-wheel-for-psycopg2-macosx-using-virtualenv-and-pip))


# çˆ¬è™« spider crawler

https://www.cnblogs.com/dyd168/p/15021673.html xpath è¯­æ³•


# ä»£æ›¿ shell è¿ç»´

https://www.oschina.net/translate/python-scripts-replacement-bash-utility-scripts
https://blog.51cto.com/dashui/2334754
https://www.cnblogs.com/jacktian-it/articles/10222930.html

https://github.com/lalor/python_for_linux_system_administration ä¹¦ç±


## å®ç”¨è„šæœ¬

https://zhuanlan.zhihu.com/p/85728888
TODO

### å‘½ä»¤è¡Œå‚æ•°è§£æ

```py
# $# å–å‚æ•°æ•°é‡
len(sys.argv)

# $0 å–ç¬¬0ä¸ªå‚æ•°
sys.argv[0]



```

### è·¯å¾„

```py
# è·å–è„šæœ¬æ‰€åœ¨è·¯å¾„
import os
script_dir = os.path.split(os.path.realpath(__file__))[0]
os.chdir(script_dir)

# å±•å¼€ç”¨æˆ·è·¯å¾„ï¼Œæ–¹ä¾¿è·¨å¹³å°
print(os.path.expanduser('~/.config'))


# åŒ¹é…æ–‡ä»¶å
import glob
for name in glob.glob('dir/*'):
    print (name)
```

### æ–‡ä»¶æ“ä½œ

æ¨è shutil æ¨¡å—, ä»£æ›¿å¾ˆå¤šshellçš„æ–‡ä»¶æ“ä½œå‘½ä»¤ï¼Œå¯ä»¥é¿å…ç‰¹æ®Šæƒ…å†µå­—ç¬¦è½¬ä¹‰å¸¦æ¥çš„å›°æ‰°

```py
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
os.path.exists(file)

# rm -rf
os.system("rm -rf foo/")
shutil.rmtree("foo", ignore_errors=True)

# æ‰“å¼€æ–‡ä»¶è¯»å‡ºæ¯è¡Œå†…å®¹
with open("./xxx.log") as file_obj:
    xxx_list = file_obj.read().splitlines()

# åˆ—å‡ºç›®å½•ä¸‹æ–‡ä»¶
os.listdir()
['pkgsync', 'hosts', 'pkglist-aur.json', 'apply-pkgsync.sh', 'pkglist.json', 'rootfs', 'private', '.vscode', '.git', 'home', 'stow_all.sh', '.gitignore', 'local_rootfs', 'rime', 'i3', '.gitmodules', 'README.md']

# è‡ªé¡¶å‘ä¸‹ï¼Œéå†æ–‡ä»¶å¤¹ï¼Œpathæ˜¯è·¯å¾„ï¼Œdir_listæ˜¯ç›®å½•åˆ—è¡¨ï¼Œfile_listæ˜¯æ–‡ä»¶åˆ—è¡¨
g = os.walk(script_dir)
for path,dir_list,file_list in g:
    for dir in dir_list:
        print(os.path.join(path, file_name))        
```

### sh å‘½ä»¤æ‰§è¡Œ

```py
# systemå‘½ä»¤åŒæ­¥æ‰§è¡Œå‘½ä»¤ï¼Œè¿”å›å€¼ä¸ºç¨‹åºé€€å‡ºç 
if os.system("echo abc") != 0:
    print("error: execute")
    exit(1)

# subprocessæ‰§è¡Œå‘½ä»¤
import subprocess
res = subprocess.Popen('uptime', shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, close_fds=True)
result = res.stdout.readlines()

# check_call()ä¾‹å­ï¼Œç¼–è¯‘æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œå½“shellæ¥ç”¨ï¼Œcheck_call()ä¼šåœ¨æ‰§è¡Œè¿”å›é”™è¯¯æ—¶æŠ›å‡ºé”™è¯¯
for test in tests:
    os.chdir(os.path.join(script_dir, test))
    output = subprocess.check_call(f"make", shell=True)
    output = subprocess.check_call(f"./test_case", shell=True)

# éœ€è¦è·å–æ‰“å°å‡ºçš„æ•°æ®æ—¶ï¼Œè¿˜å¯ä»¥ç”¨check_output()ï¼Œæ¯”å¦‚è¿™é‡Œè·å–æ–‡ä»¶åˆ—è¡¨
res = subprocess.check_output('find . -maxdepth 2 -name rootfs', shell=True).decode()
rootfs_dirs = res.strip().split('\n')

# todo: ä½¿ç”¨ç¬¬ä¸‰æ–¹shæ¨¡å— http://amoffat.github.io/sh/
```

## ä¼ é€’å‘½ä»¤è¡Œå‚æ•°

é€šè¿‡ sys.stdin, sys.stdout

å‚æ•°å¤„ç†åº“: optparse.OptionParser, argparse, click

```py
if __name__ == "__main__":
    # åˆå§‹åŒ–ä¸€ä¸ªnamesçš„å­—å…¸ï¼Œå†…å®¹ä¸ºç©º
    # å­—å…¸ä¸­ä¸ºnameå’Œå‡ºç°æ•°é‡çš„é”®å€¼å¯¹
    names = {}
    # sys.stdinæ˜¯ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ã€‚ æ‰€æœ‰å¼•ç”¨äºfileå¯¹è±¡çš„æ–¹æ³•ï¼Œ
    # éƒ½å¯ä»¥åº”ç”¨äºsys.stdin.
    for name in sys.stdin.readlines():
            # æ¯ä¸€è¡Œéƒ½æœ‰ä¸€ä¸ªnewlineå­—ç¬¦åšç»“å°¾
            # æˆ‘ä»¬éœ€è¦åˆ é™¤å®ƒ
            name = name.strip()
            if name in names:
                    names[name] += 1
            else:
                    names[name] = 1

    # è¿­ä»£å­—å…¸,
    # è¾“å‡ºåå­—ï¼Œç©ºæ ¼ï¼Œæ¥ç€æ˜¯è¯¥åå­—å‡ºç°çš„æ•°é‡
    for name, count in names.iteritems():
            sys.stdout.write("%d\t%s\n" % (count, name))

```

`cat names.log | python namescount.py | sort -rn`



```python
æˆ–è€…å€ŸåŠ© 
arg = sys.argv[2] if len(sys.argv) >= 2  # ä¸‹æ ‡ä» 0 å¼€å§‹


```

## shell è°ƒç”¨ Python 

### shel è¯»å– Python å‡½æ•°è¿”å›å€¼

```py


```

```sh


```

### ç»Ÿè®¡å‡ºç°æ¬¡æ•°

```py
#!/usr/bin/env python
import sys

if __name__ == "__main__":
    # åˆå§‹åŒ–ä¸€ä¸ªnamesçš„å­—å…¸ï¼Œå†…å®¹ä¸ºç©º
    # å­—å…¸ä¸­ä¸ºnameå’Œå‡ºç°æ•°é‡çš„é”®å€¼å¯¹
    names = {}
    for name in sys.stdin.readlines():
            # æ¯ä¸€è¡Œéƒ½æœ‰ä¸€ä¸ªnewlineå­—ç¬¦åšç»“å°¾
            # æˆ‘ä»¬éœ€è¦åˆ é™¤å®ƒ
            name = name.strip()
            if name in names:
                    names[name] += 1
            else:
                    names[name] = 1

    # è¿­ä»£å­—å…¸,
    # è¾“å‡ºåå­—ï¼Œç©ºæ ¼ï¼Œæ¥ç€æ˜¯è¯¥åå­—å‡ºç°çš„æ•°é‡
    for name, count in names.iteritems():
            sys.stdout.write("%d\t%s\n" % (count, name))
```

`cat names.log | ./xxx.py`


### è¯»å– csv æ–‡ä»¶

è·å–æŒ‡å®šåˆ—

`cat xxx.csv | ./xxx.py 2`

```py
#!/usr/bin/env python
# CSV module that comes with the Python standard library
import csv
import sys


if __name__ == "__main__":
    # CSVæ¨¡å—ä½¿ç”¨ä¸€ä¸ªreaderå¯¹è±¡ä½œä¸ºè¾“å…¥
    # åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°±æ˜¯ sys.stdin.
    csvfile = csv.reader(sys.stdin)

    # è¿™ä¸ªè„šæœ¬å¿…é¡»æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šåˆ—çš„åºå·
    # ä½¿ç”¨sys.argvè·å–å‚æ•°.
    column_number = 0
    if len(sys.argv) > 1:
            column_number = int(sys.argv[1])

    # CSVæ–‡ä»¶çš„æ¯ä¸€è¡Œéƒ½æ˜¯ç”¨é€—å·ä½œä¸ºå­—æ®µçš„åˆ†éš”ç¬¦
    for row in csvfile:
            print row[column_number]

```


## Python è°ƒç”¨ shell


### subprocess 

æ¨è

python 3.0 ä¹‹åä½¿ç”¨ subprocessä»£æ›¿ commands (commands ä»…ä»…é€‚ç”¨äº Linux, python 3.0 ä¹‹åç§»é™¤æ­¤å‘½ä»¤ï¼Œä½¿ç”¨ subprocess ä»£æ›¿)

python 3.x ä½¿ç”¨ subprocess åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹, å…è®¸åˆ›å»ºå¾ˆå¤šå­è¿›ç¨‹ï¼Œåˆ›å»ºçš„æ—¶å€™èƒ½æŒ‡å®šå­è¿›ç¨‹å’Œå­è¿›ç¨‹çš„è¾“å…¥ã€è¾“å‡ºã€é”™è¯¯è¾“å‡ºç®¡é“ï¼Œæ‰§è¡Œåèƒ½è·å–è¾“å‡ºç»“æœå’Œæ‰§è¡ŒçŠ¶æ€ã€‚

```py
#!/usr/bin/python3


subprocess.run()	Python 3.5ä¸­æ–°å¢çš„å‡½æ•°ã€‚æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæˆåè¿”å›ä¸€ä¸ªåŒ…å«æ‰§è¡Œç»“æœçš„CompletedProcessç±»çš„å®ä¾‹ã€‚
subprocess.call()	æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œè¿”å›å‘½ä»¤æ‰§è¡ŒçŠ¶æ€ï¼Œå…¶åŠŸèƒ½ç±»ä¼¼äºos.system(cmd)ã€‚
subprocess.check_call()	Python 2.5ä¸­æ–°å¢çš„å‡½æ•°ã€‚ æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æœæ‰§è¡ŒæˆåŠŸåˆ™è¿”å›çŠ¶æ€ç ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚å…¶åŠŸèƒ½ç­‰ä»·äºsubprocess.run(..., check=True)ã€‚
subprocess.check_output()	Python 2.7ä¸­æ–°å¢çš„çš„å‡½æ•°ã€‚æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æœæ‰§è¡ŒçŠ¶æ€ç ä¸º0åˆ™è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
subprocess.getoutput(cmd)	æ¥æ”¶å­—ç¬¦ä¸²æ ¼å¼çš„å‘½ä»¤ï¼Œæ‰§è¡Œå‘½ä»¤å¹¶è¿”å›æ‰§è¡Œç»“æœï¼Œå…¶åŠŸèƒ½ç±»ä¼¼äºos.popen(cmd).read()å’Œcommands.getoutput(cmd)ã€‚
subprocess.getstatusoutput(cmd)	æ‰§è¡Œcmdå‘½ä»¤ï¼Œè¿”å›ä¸€ä¸ªå…ƒç»„(å‘½ä»¤æ‰§è¡ŒçŠ¶æ€, å‘½ä»¤æ‰§è¡Œç»“æœè¾“å‡º)ï¼Œå…¶åŠŸèƒ½ç±»ä¼¼äºcommands.getstatusoutput()ã€‚




import subprocess as sp


# subprocess.run()ï¼špython3.5ä¸­æ–°å¢çš„å‡½æ•°ï¼Œ æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œ ç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæˆåè¿”å›ä¸€ä¸ªåŒ…å«æ‰§è¡Œç»“æœçš„CompletedProcessç±»çš„å®ä¾‹
# Popen çš„ç®€åŒ–ç‰ˆæœ¬
#æ‰§è¡Œls -l /dev/null å‘½ä»¤
>>> subprocess.run(["ls", "-l", "/dev/null"])
# crw-rw-rw-  1 root  wheel    3,   2  5  4 13:34 /dev/null
# CompletedProcess(args=['ls', '-l', '/dev/null'], returncode=0)


# æ‰§è¡Œ shell å‘½ä»¤, æ‰“å°è¾“å‡ºåˆ° stdout, ç±»ä¼¼ os.system
# shell=Trueæ„æ€æ˜¯shellä¸‹æ‰§è¡Œcommand, å¦‚æœcommandä¸æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œshell=Trueæ˜¯ä¸å¯çœç•¥çš„ã€‚
code = sp.call("ls -al", shell=True)
# <=> sp.call(["ls", "-al"])
print(code) # 0

# å¼‚æ­¥æ‰§è¡Œ, æ‰“å°åˆ° stdout
# 0ï¼Œ1ï¼Œ2ã€‚å…¶ä¸­0ä»£è¡¨æ­£ç¡®æ‰§è¡Œï¼Œ1å’Œ2éƒ½æ˜¯é”™è¯¯æ‰§è¡Œï¼Œ2é€šå¸¸æ˜¯æ²¡æœ‰è¯»å–åˆ°æ–‡ä»¶
result = sp.Popen("ls -al", shell=True) # å¼‚æ­¥æ‰§è¡Œ
print(result.returncode) # None è¿™æ­¥ä¸ä¼šé˜»å¡
print(result.wait()) # 0 é˜»å¡

# è·å–è¾“å‡º
# è®¾ç½®è¾“å‡ºåˆ°ç®¡é“
proc = sp.Popen("ls -al", stdout=sp.PIPE, shell=True)
print(proc.stdout.readline())

proc1 = sp.Popen("ls -al", stdout=sp.PIPE, shell=True)
(stdout, stderr) = proc1.communicate("..")
print(stdout)


# ##############




```

### os.system


```py

# è¿™ä¸ªè°ƒç”¨ç›¸å½“ç›´æ¥ï¼Œä¸”æ˜¯åŒæ­¥è¿›è¡Œçš„ï¼Œç¨‹åºéœ€è¦é˜»å¡å¹¶ç­‰å¾…è¿”å› ( os.system() è¿™ä¸ªæ–¹æ³•æ˜¯é˜»å¡å½“å‰ä¸»è¿›ç¨‹æ‰§è¡Œçš„ï¼Œåªæœ‰è¯¥å‘½ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œä¸»è¿›ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œ)


#!/usr/bin/python3

import os

# output to stdout
# 0è¡¨ç¤ºshellæŒ‡ä»¤æˆåŠŸæ‰§è¡Œï¼Œ256è¡¨ç¤ºæœªæ‰¾åˆ°ï¼Œè¯¥æ–¹æ³•é€‚ç”¨äºshellå‘½ä»¤ä¸éœ€è¦è¾“å‡ºå†…å®¹çš„åœºæ™¯ã€‚
#       æ²¡æœ‰æ‰¾åˆ°æ—¶ï¼Œsh å‘½ä»¤è¿”å›çš„çŠ¶æ€ç æ˜¯1ï¼Œè€Œpythonè°ƒç”¨ï¼Œè¿”å›çš„æ˜¯ï¼š256 , è¿™æ˜¯ä¸€ç‚¹åŒºåˆ«
status = os.system("ls -al")
print(status) # 0 

os.system('ping -c 2 www.baidu.com &>/dev/null')
print("block until ping finished")

ret = os.system('cat hello.sh | grep "ooo"')
print(ret) # 256, 
ret1 = os.system('cat hello.sh | grep "c 1"')
print(ret1) # 0



# æ‰§è¡Œ shell è„šæœ¬
os.system("./hello.sh")

# æ”¹å˜å½“å‰å·¥ä½œç›®å½•åˆ°æŒ‡å®šçš„è·¯å¾„
# <=> cd ..
access = os.chdir("..") # å¦‚æœå…è®¸è®¿é—®è¿”å› True , å¦åˆ™è¿”å›False

# æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½•
retval = os.getcwd()

# æƒé™
# ä¸å¦‚ç›´æ¥ os.system("chmod ...")
# import stat
# os.chmod("./hello.sh", stat.S_IRWXU)

# æ›´æ”¹æ‰€å±ç”¨æˆ·, éœ€è¦ root æƒé™æ‰§è¡Œ
# os.chown()

# æ›´æ”¹å½“å‰è¿›ç¨‹çš„æ ¹ç›®å½•ä¸ºæŒ‡å®šçš„ç›®å½•ï¼Œä½¿ç”¨è¯¥å‡½æ•°éœ€è¦ç®¡ç†å‘˜æƒé™
# os.chroot()

```

### os.popen


```py
# å¼‚æ­¥æ‰§è¡Œå‘½ä»¤, 
# æ‹¿åˆ°å‘½ä»¤æ‰§è¡Œè¾“å‡º
#  os.popen() è¿”å›çš„æ˜¯ file read çš„å¯¹è±¡ï¼Œå¯¹å…¶è¿›è¡Œè¯»å– read() çš„æ“ä½œå¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„è¾“å‡ºã€‚è¿™ä¸ªæ–¹æ³•æ˜¯åå°æ‰§è¡Œï¼Œä¸å½±å“åç»­è„šæœ¬è¿è¡Œ
output = os.popen("ping -c1 www.baidu.com &>/dev/null")
print("popen -- nonblock")
# readlines() ä¹Ÿå¯
print(output.read()) # è·å–ç»ˆç«¯è¾“å‡º
print("popen -- block until output.read() end")

# popenéœ€è¦å…³é—­close().å½“æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œclose()ä¸è¿”å›ä»»ä½•å€¼ï¼Œå¤±è´¥æ—¶ï¼Œclose()è¿”å›ç³»ç»Ÿè¿”å›å€¼
output.close()

```

### system

```py
def cd(dir): system.command('cd {}'.format(dir))

```



### sh

```py
# ä½¿ç”¨ sh åŒ…
```

### paramiko

https://github.com/paramiko/paramiko
https://www.cnblogs.com/xiao-apple36/p/9144092.html

https://www.yisu.com/zixun/12641.html
https://www.cnblogs.com/liangyy09/p/13921693.html

pip3 install paramiko


```py
# paramikoåŒ…å«ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼šSSHClientå’ŒSFTPClientã€‚

å¸¸ç”¨å‚æ•°
hostname è¿æ¥çš„ç›®æ ‡ä¸»æœº
port=SSH_PORT æŒ‡å®šç«¯å£
username=None éªŒè¯çš„ç”¨æˆ·å
password=None éªŒè¯çš„ç”¨æˆ·å¯†ç 
pkey=None ç§é’¥æ–¹å¼ç”¨äºèº«ä»½éªŒè¯
key_filename=None ä¸€ä¸ªæ–‡ä»¶åæˆ–æ–‡ä»¶åˆ—è¡¨ï¼ŒæŒ‡å®šç§é’¥æ–‡ä»¶
timeout=None å¯é€‰çš„tcpè¿æ¥è¶…æ—¶æ—¶é—´
allow_agent=True, æ˜¯å¦å…è®¸è¿æ¥åˆ°sshä»£ç†ï¼Œé»˜è®¤ä¸ºTrue å…è®¸
look_for_keys=True æ˜¯å¦åœ¨~/.sshä¸­æœç´¢ç§é’¥æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºTrue å…è®¸
compress=False, æ˜¯å¦æ‰“å¼€å‹ç¼©


set_missing_host_key_policy()ï¼šè®¾ç½®è¿œç¨‹æœåŠ¡å™¨æ²¡æœ‰åœ¨know_hostsæ–‡ä»¶ä¸­è®°å½•æ—¶ (è¿æ¥çš„è¿œç¨‹ä¸»æœºæ²¡æœ‰æœ¬åœ°ä¸»æœºå¯†é’¥æˆ–HostKeyså¯¹è±¡) çš„åº”å¯¹ç­–ç•¥ã€‚ç›®å‰æ”¯æŒä¸‰ç§ç­–ç•¥ï¼š

    AutoAddPolicy è‡ªåŠ¨æ·»åŠ ä¸»æœºååŠä¸»æœºå¯†é’¥åˆ°æœ¬åœ°HostKeyså¯¹è±¡ï¼Œä¸ä¾èµ–load_system_host_keyçš„é…ç½®ã€‚å³æ–°å»ºç«‹sshè¿æ¥æ—¶ä¸éœ€è¦å†è¾“å…¥yesæˆ–noè¿›è¡Œç¡®è®¤
    WarningPolicy ç”¨äºè®°å½•ä¸€ä¸ªæœªçŸ¥çš„ä¸»æœºå¯†é’¥çš„pythonè­¦å‘Šã€‚å¹¶æ¥å—ï¼ŒåŠŸèƒ½ä¸Šå’ŒAutoAddPolicyç±»ä¼¼ï¼Œä½†æ˜¯ä¼šæç¤ºæ˜¯æ–°è¿æ¥
    RejectPolicy è‡ªåŠ¨æ‹’ç»æœªçŸ¥çš„ä¸»æœºåå’Œå¯†é’¥ï¼Œä¾èµ–load_system_host_keyçš„é…ç½®ã€‚æ­¤ä¸ºé»˜è®¤é€‰é¡¹

exec_command()ï¼šåœ¨è¿œç¨‹æœåŠ¡å™¨æ‰§è¡ŒLinuxå‘½ä»¤çš„æ–¹æ³•ã€‚

# 
# 
# 
# 
# 


# åˆ©ç”¨SSHClientå¯¹è±¡çš„open_sftp()æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªåŸºäºå½“å‰è¿æ¥çš„sftpå¯¹è±¡ï¼Œå¯ä»¥è¿›è¡Œæ–‡ä»¶çš„ä¸Šä¼ ç­‰æ“ä½œ
open_sftp()ï¼šåœ¨å½“å‰sshä¼šè¯çš„åŸºç¡€ä¸Šåˆ›å»ºä¸€ä¸ªsftpä¼šè¯ã€‚è¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªSFTPClientå¯¹è±¡ã€‚
sftp = client.open_sftp()
sftp.put('test.txt','text.txt')

from_transport(cls,t) åˆ›å»ºä¸€ä¸ªå·²è¿é€šçš„SFTPå®¢æˆ·ç«¯é€šé“
put(localpath, remotepath, callback=None, confirm=True) å°†æœ¬åœ°æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ å‚æ•°confirmï¼šæ˜¯å¦è°ƒç”¨stat()æ–¹æ³•æ£€æŸ¥æ–‡ä»¶çŠ¶æ€ï¼Œè¿”å›ls -lçš„ç»“æœ
get(remotepath, localpath, callback=None) ä»æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°
mkdir() åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•
remove() åœ¨æœåŠ¡å™¨ä¸Šåˆ é™¤ç›®å½•
rename() åœ¨æœåŠ¡å™¨ä¸Šé‡å‘½åç›®å½•
stat() æŸ¥çœ‹æœåŠ¡å™¨æ–‡ä»¶çŠ¶æ€
listdir() åˆ—å‡ºæœåŠ¡å™¨ç›®å½•ä¸‹çš„æ–‡ä»¶

# 
# 
# 
# 

import paramiko
 
   # å®ä¾‹åŒ–SSHClient
   client = paramiko.SSHClient()
 
   # è‡ªåŠ¨æ·»åŠ ç­–ç•¥ï¼Œä¿å­˜æœåŠ¡å™¨çš„ä¸»æœºåå’Œå¯†é’¥ä¿¡æ¯ï¼Œå¦‚æœä¸æ·»åŠ ï¼Œé‚£ä¹ˆä¸å†æœ¬åœ°know_hostsæ–‡ä»¶ä¸­è®°å½•çš„ä¸»æœºå°†æ— æ³•è¿æ¥
   client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
 
   # è¿æ¥SSHæœåŠ¡ç«¯ï¼Œä»¥ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œè®¤è¯
   client.connect(hostname='192.168.1.105', port=22, username='root', password='123456')
 
   # æ‰“å¼€ä¸€ä¸ªChannelå¹¶æ‰§è¡Œå‘½ä»¤
   stdin, stdout, stderr = client.exec_command('df -h ')  # stdout ä¸ºæ­£ç¡®è¾“å‡ºï¼Œstderrä¸ºé”™è¯¯è¾“å‡ºï¼ŒåŒæ—¶æ˜¯æœ‰1ä¸ªå˜é‡æœ‰å€¼
 
   # æ‰“å°æ‰§è¡Œç»“æœ
   print(stdout.read().decode('utf-8'))
 
   # å…³é—­SSHClient
   client.close()


# ###########################


# é…ç½®ç§äººå¯†é’¥æ–‡ä»¶ä½ç½®
private = paramiko.RSAKey.from_private_key_file('/Users/ch/.ssh/id_rsa')
 
#å®ä¾‹åŒ–SSHClient
client = paramiko.SSHClient()
 
#è‡ªåŠ¨æ·»åŠ ç­–ç•¥ï¼Œä¿å­˜æœåŠ¡å™¨çš„ä¸»æœºåå’Œå¯†é’¥ä¿¡æ¯ï¼Œå¦‚æœä¸æ·»åŠ ï¼Œé‚£ä¹ˆä¸å†æœ¬åœ°know_hostsæ–‡ä»¶ä¸­è®°å½•çš„ä¸»æœºå°†æ— æ³•è¿æ¥
client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
 
#è¿æ¥SSHæœåŠ¡ç«¯ï¼Œä»¥ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œè®¤è¯
client.connect(hostname='10.0.0.1',port=22,username='root',pkey=private)


#############################

# SSHClient å°è£… Transport
# åˆ›å»ºä¸€ä¸ªé€šé“
   transport = paramiko.Transport(('hostname', 22))
   transport.connect(username='root', password='123')
 
   ssh = paramiko.SSHClient()
   ssh._transport = transport
 
   stdin, stdout, stderr = ssh.exec_command('df -h')
   print(stdout.read().decode('utf-8'))
 
   transport.close()

################################################################

# è·å–Transportå®ä¾‹
tran = paramiko.Transport(('10.0.0.3', 22))
 
# è¿æ¥SSHæœåŠ¡ç«¯ï¼Œä½¿ç”¨password
tran.connect(username="root", password='123456')
# æˆ–ä½¿ç”¨
# é…ç½®ç§äººå¯†é’¥æ–‡ä»¶ä½ç½®
private = paramiko.RSAKey.from_private_key_file('/Users/root/.ssh/id_rsa')
# è¿æ¥SSHæœåŠ¡ç«¯ï¼Œä½¿ç”¨pkeyæŒ‡å®šç§é’¥
tran.connect(username="root", pkey=private)
 
# è·å–SFTPå®ä¾‹
sftp = paramiko.SFTPClient.from_transport(tran)
 
# è®¾ç½®ä¸Šä¼ çš„æœ¬åœ°/è¿œç¨‹æ–‡ä»¶è·¯å¾„
localpath = "/Users/root/Downloads/1.txt"
remotepath = "/tmp/1.txt"
 
# æ‰§è¡Œä¸Šä¼ åŠ¨ä½œ
sftp.put(localpath, remotepath)
# æ‰§è¡Œä¸‹è½½åŠ¨ä½œ
sftp.get(remotepath, localpath)
 
tran.close()
```

## éƒ¨ç½² springboot

```py
#!/usr/bin/python
# -*- coding:utf-8 -*-
import os,sys,time,commands
from sys import argv
 
times = time.strftime('%Yå¹´%mæœˆ%dæ—¥%H:%M:%S')
_jdkpath_ = 'å¡«å†™ä½ çš„JDKè·¯å¾„'
_processpath_ = 'jaråŒ…åå­—'
_fileDir_ = 'jaråŒ…æ‰€åœ¨è·¯å¾„'
_jarpath_ = _fileDir_ + _processpath_
_logpath_ = _fileDir_ + 'æ—¥å¿—è·¯å¾„'
_gclog_   = _fileDir_ + 'gcæ—¥å¿—è·¯å¾„'
_jarvar_ = '-Xms256m -Xmx640m -Xss256K -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m -XX:+UseAdaptiveSizePolicy'
 
def getpid():
    pid = commands.getoutput("ps aux | grep %s | grep -v grep | awk '{print $2}'" % _processpath_)
    return pid
 
def _status_():
    j_pid = getpid()
    if j_pid == '':
        print("%sæ²¡æœ‰è¿è¡Œ" % _processpath_)
    else :
        print("%sè¿›ç¨‹pidå€¼:" % _processpath_ + getpid())
 
def _start_():
    j_pid = getpid()
    if j_pid != '':
        print("%så·²ç»åœ¨è¿è¡Œ..." % _processpath_)
    else :
        print("å¯åŠ¨%s......" % _processpath_)
        time.sleep(4)
        if os.system('%s -jar -XX:+PrintGCDetails -Xloggc:%s %s %s > %s 2>&1 &' % (_jdkpath_,_gclog_,_jarvar_,_jarpath_,_logpath_)) == 0:
            print("å¯åŠ¨%sæˆåŠŸ,è¿›ç¨‹pidå€¼:" % _processpath_ + getpid())
 
def _stop_():
    s_pid = getpid()
    if s_pid == '':
        print("%sæ²¡æœ‰è¿è¡Œ" % _processpath_)
    else :
        print("å…³é—­%s......" % _processpath_)
        os.system('kill -9 ' + s_pid)
	os.system('echo "">%s && echo "">%s' % (_gclog_,_logpath_))
        time.sleep(2)
        if s_pid != '0':
            print("å…³é—­%sæˆåŠŸ" % _processpath_)
        else :
            print("å…³é—­%så¤±è´¥" % _processpath_)
 
def _restart_():
    _stop_()
    time.sleep(2)
    _start_()
 
if argv == "-h" or argv == "--help" or len(argv)==1:
    print "â˜»â˜»â˜»è¯·åˆ«å®³æ€•,è¿™åªæ˜¯ä¸ªç®€å•çš„è„šæœ¬,å¯¹åº”ç”¨å’Œç³»ç»Ÿéƒ½æ˜¯æ— æŸçš„â˜»â˜»â˜»\n%s,æ¸©é¦¨æç¤ºç”¨æ³•:%s {start|stop|restart|status}" % (times,argv[0])
 
elif argv[1] == 'start':
    _start_()
elif argv[1] == 'stop':
    _stop_()
elif argv[1] == 'restart':
    _restart_()
elif argv[1] == 'status':
    _status_()
else: 
    print "â˜»â˜»â˜»è¯·åˆ«å®³æ€•,è¿™åªæ˜¯ä¸ªç®€å•çš„è„šæœ¬,å¯¹åº”ç”¨å’Œç³»ç»Ÿéƒ½æ˜¯æ— æŸçš„â˜»â˜»â˜»\n%s,æ¸©é¦¨æç¤ºç”¨æ³•:%s {start|stop|restart|status}" % (times,argv[0])
```



# å¼€æºåº“

https://www.zhihu.com/question/24590883
TODO

https://pypi.org/


## æ—¥æœŸæ—¶é—´

https://github.com/ariebovenberg/whenever


## çˆ¬è™« crawler

https://github.com/ultrafunkamsterdam/undetected-chromedriver ä¸€ä¸ªç»è¿‡ä¼˜åŒ–çš„ Selenium WebDriver è¡¥ä¸ï¼Œä¸“é—¨ç”¨äºé˜²æ­¢æµè§ˆå™¨è‡ªåŠ¨åŒ–è¿‡ç¨‹ä¸­ï¼Œè§¦å‘åæœºå™¨äººæœºåˆ¶ã€‚å®ƒèƒ½å¤Ÿéšè—æµè§ˆå™¨ç‰¹å¾ï¼ˆæŒ‡çº¹ï¼‰ï¼Œä½¿ç”¨èµ·æ¥ååˆ†æ–¹ä¾¿ï¼Œå°±åƒä¸€ä¸ª Python çš„ç¬¬ä¸‰æ–¹åº“ä¸€æ ·

## å˜å£° è¯­éŸ³åˆæˆ

https://github.com/RVC-Project/Retrieval-based-Voice-Conversion-WebUI

## ç³»ç»Ÿè¿ç»´

```
https://github.com/giampaolo/psutil è·å–ç³»ç»Ÿä¿¡æ¯, ç¡¬ç›˜, å†…å­˜ ...
```

## å£°éŸ³

https://github.com/CorentinJ/Real-Time-Voice-Cloning å…‹éš†å£°éŸ³

## å›¾åƒ

- Matplotlib å¯è§†åŒ–åº“ï¼Œå¯ä»¥ç”¨æ¥ç»˜åˆ¶é«˜è´¨é‡çš„ 2D æŠ˜çº¿å›¾ã€æ•£ç‚¹å›¾ã€æŸ±çŠ¶å›¾ï¼Œæˆ–è€…ç”¨æ¥æ˜¾ç¤ºå›¾åƒ
- pil å›¾åƒå¤„ç†åº“, é€‚ç”¨äº Python2, py3 åˆ™å®‰è£… pillow
- opencv-python `import cv2`
- Removebg æŠ å›¾

## æ•°æ®æ¨¡å‹å®šä¹‰

https://github.com/samuelcolvin/pydantic/ ä½¿å¾—å®ä¾‹åŒ–æ•°æ® model å¯¹è±¡æ›´æ–¹ä¾¿

https://blog.csdn.net/codename_cys/article/details/107675748
https://blog.csdn.net/swinfans/article/details/89629641

> valideeråº“ã€marshmallowåº“ã€trafaretåº“ä»¥åŠcerberusåº“ç­‰éƒ½å¯ä»¥å®Œæˆç›¸ä¼¼çš„åŠŸèƒ½ï¼Œä½†æ˜¯ç›¸è¾ƒä¹‹ä¸‹ï¼Œpydanticåº“çš„æ‰§è¡Œæ•ˆç‡ä¼šæ›´åŠ ä¼˜ç§€ä¸€äº›


https://www.kevin7.net/post_detail/pydantic-with-flask
https://github.com/bauerji/flask_pydantic æ ¡éªŒè¯·æ±‚å‚æ•°
https://medium.com/swlh/parsing-rest-api-payload-and-query-parameters-with-flask-better-than-marshmallow-aa79c889e3ca


## åºåˆ—åŒ–ååºåˆ—åŒ–

pickle

https://github.com/ICRAR/ijson é«˜æ€§èƒ½è§£æ json

## åš web å¼€å‘

https://github.com/pydantic/FastUI ç”Ÿæˆ åŸºäº react çš„é¡µé¢

Django å¤§ä¸€ç»Ÿè§£å†³æ–¹æ¡ˆ

flask  rest api

https://github.com/pynecone-io/pynecone çº¯ py å®ç° web

https://streamlit.io/       ä¸ºè„šæœ¬åˆ¶ä½œ ui ç•Œé¢

# è°ƒJava

## jpype

https://github.com/jpype-project/jpype

## jython

ç›¸äº’è°ƒç”¨

https://www.py4j.org/getting_started.html run java lib in py


run py script in java

```xml
<dependency>
            <groupId>org.python</groupId>
            <artifactId>jython</artifactId>
            <version>2.7.2</version>
        </dependency>

```

```java
public class App {

    /**
     * åˆå§‹åŒ–
     */
    static void initInterpreter() {
        Properties props = new Properties();
        props.put("python.home", pyPath() + "py_lib");
        props.put("python.console.encoding", "UTF-8");
        props.put("python.security.respectJavaAccessibility", "false");
        props.put("python.import.site", "false");

        Properties preprops = System.getProperties();
        PythonInterpreter.initialize(preprops, props, new String[0]);

    }

    static String pyPath() {
        return Thread.currentThread().getContextClassLoader().getResource(".").getPath();
    }



    public static void main(String[] args) throws FileNotFoundException {
        initInterpreter();
        final PythonInterpreter interpreter = new PythonInterpreter();

        interpreter.execfile(new FileInputStream(pyPath() + "test.py"));
        final PyFunction addFunc = interpreter.get("add", PyFunction.class);
        int a = 1;
        int b = 2;
        final PyObject result = addFunc.__call__(new PyInteger(a), new PyInteger(b));
        System.out.println(result);


//        interpreter.execfile(new FileInputStream(pyPath() + "face_recog.py"));
//        final PyFunction face_verification = interpreter.get("face_verification", PyFunction.class);
//        final PyObject pyObject = face_verification.__call__();
//        System.out.println(pyObject);
    }
}

```


# è°ƒç”¨ rust 

https://www.v2ex.com/t/757216

https://blog.csdn.net/m0_37696990/article/details/96876692

https://blog.csdn.net/muzico425/article/details/103331676


# cffi ç»‘å®š

https://github.com/yifeikong/curl_cffi ä¾‹å­

# webåº”ç”¨éƒ¨ç½²

https://www.zhihu.com/question/21888077

## ç”Ÿæˆä¾èµ–æ¸…å•

```sh
# ç”Ÿæˆä¾èµ–æ–‡ä»¶
# https://blog.csdn.net/guolindonggld/article/details/87786032
pip3 freeze > requirements.txt

pip install -r requirements.txt

```

## gunicorn

gunicornæ˜¯ä¸€ä¸ªwsgi http server

ç”¨ celery å’Œ gunicorn æ³¨å†Œæˆå®ˆæŠ¤è¿›ç¨‹æ¥è·‘

ä¸è¿‡åœ¨productionç¯å¢ƒï¼Œèµ·åœå’ŒçŠ¶æ€çš„ç›‘æ§æœ€å¥½ç”¨supervisiorä¹‹ç±»çš„ç›‘æ§å·¥å…·ï¼Œç„¶ååœ¨gunicornçš„å‰ç«¯æ”¾ç½®ä¸€ä¸ªhttp proxy server, è­¬å¦‚nginx

https://www.jianshu.com/p/69e75fc3e08e

flask_app.py

```py
from flask import Flask

app = Flask(__name__)


@app.route('/demo', methods=['GET'])
def demo():
    return "gunicorn and flask demo."
```

gunicorn.conf.py 

```py
# coding:utf-8
import multiprocessing

bind = "0.0.0.0:5000"   #ç»‘å®šçš„ipä¸ç«¯å£
workers = multiprocessing.cpu_count() * 2 + 1    #è¿›ç¨‹æ•°
errorlog = './log/gunicorn.error.log' #å‘ç”Ÿé”™è¯¯æ—¶logçš„è·¯å¾„
accesslog = './log/gunicorn.access.log' #æ­£å¸¸æ—¶çš„logè·¯å¾„
backlog = 512                #ç›‘å¬é˜Ÿåˆ—
proc_name = 'gunicorn_pre_project'   #è¿›ç¨‹å
timeout = 30      # è®¾ç½®è¶…æ—¶æ—¶é—´120sï¼Œé»˜è®¤ä¸º30sã€‚æŒ‰è‡ªå·±çš„éœ€æ±‚è¿›è¡Œè®¾ç½®timeout = 120
worker_class = 'gevent' #ä½¿ç”¨geventæ¨¡å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨sync æ¨¡å¼ï¼Œé»˜è®¤çš„æ˜¯syncæ¨¡å¼

threads = 3  #æŒ‡å®šæ¯ä¸ªè¿›ç¨‹å¼€å¯çš„çº¿ç¨‹æ•°
loglevel = 'info' #æ—¥å¿—çº§åˆ«ï¼Œè¿™ä¸ªæ—¥å¿—çº§åˆ«æŒ‡çš„æ˜¯é”™è¯¯æ—¥å¿—çš„çº§åˆ«ï¼Œè€Œè®¿é—®æ—¥å¿—çš„çº§åˆ«æ— æ³•è®¾ç½®

#è®¾ç½®gunicornè®¿é—®æ—¥å¿—æ ¼å¼ï¼Œé”™è¯¯æ—¥å¿—æ— æ³•è®¾ç½®
access_log_format = '%(t)s %(p)s %(h)s "%(r)s" %(s)s %(L)s %(b)s %(f)s" "%(a)s"'

```


```sh
# å¯åŠ¨å‘½ä»¤
# 
# flask_app æ¥è‡ªflask_app.py
# app æ¥è‡ª app = Flask(__name__)
# -c æŒ‡å®š é…ç½®æ–‡ä»¶
gunicorn flask_app:app -c gunicorn.conf.py 

# ä¸ä½¿ç”¨é…ç½®æ–‡ä»¶
gunicorn -w 4 -b 0.0.0.0:5000 -D  flask_app:app


# æ‰¾åˆ° çˆ¶è¿›ç¨‹çš„ pid (masterpid)
pstree -ap | grep gunicorn 

# æˆ–è€… æ‰¾åˆ°æ‰€æœ‰è¿›ç¨‹ pid, ç„¶å kill -9 æ‰€æœ‰ç›¸å…³è¿›ç¨‹
pgrep gunicorn

# åœæ­¢
kill -9 <çˆ¶è¿›ç¨‹pid>
# é‡å¯
kill -HUP <parent pid>
```

## supervisord ç®¡ç† daemon

supervisord.org

## pm2

æ˜¯ nodejs çš„éƒ¨ç½²ç®¡ç†å·¥å…·, ä½†æ˜¯åªè¦æ˜¯å‘½ä»¤è¡Œç¨‹åº, éƒ½èƒ½ç”¨å®ƒ

# setup.py

# wheel

python å¯ä»¥ç”¨ wheel æ‰“åŒ…æˆ whl, ç„¶åä½¿ç”¨ ssh æ‰§è¡Œ pip install package.whl, ç„¶åé‡å¯ä¸€ä¸‹ python å°±å¥½äº†


# è‡ªåŠ¨æŠ¢è´­è„šæœ¬

å¯¹äºè‡ªåŠ¨æŠ¢è´­æ¥è¯´ï¼Œ
å¯¹äºç½‘é¡µï¼Œselenium å’Œ puppeteer æ¯”è¾ƒé€‚åˆï¼ŒåŸºæœ¬æµç¨‹å°±æ˜¯åŠ è½½ä¸€ä¸ª webdriverï¼Œè®¿é—®ä¸€ä¸ªé“¾æ¥ï¼Œç­‰å¾… javascript åŠ è½½å®Œï¼Œé€‰æ‹©ä¸€ä¸ªå…ƒç´ ï¼Œæ‰§è¡Œæ“ä½œã€‚
