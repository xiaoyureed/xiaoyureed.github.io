---
title: ReactğŸŒˆ
tags:
    - react
date: 2018-06-28 20:26:11
toc_min_heading_level: 2
toc_max_heading_level: 5
---



<div align="center">
Next.js 12
TypeScript
Zustand
Axios
React Query
classnames
Tailwindcss
Styled Components
BackEnd: Nest.js
PostgreSQL

https://github.com/7kms/react-illustration-series å›¾è§£

https://www.v2ex.com/t/850921#reply80 2022 ç”Ÿæ€

https://github.com/airbnb/react-sketchapp æ¸²æŸ“ react ç»„ä»¶åˆ° sketch

https://github.com/typescript-cheatsheets/react

https://github.com/chakra-ui/chakra-ui ç»„ä»¶åº“

https://github.com/react-hook-form/react-hook-form

https://github.com/brick-design/react-visual-editor è¡¨å•è®¾è®¡ https://brick-design.github.io/react-visual-editor/
https://react-hook-form.com/zh/form-builder/

react-dnd, react-draggable, react-resizable, react-drag-select, react-rnd, react-grid-layout, react-resizable-box å¼€æºæ‹–æ‹½ç»„ä»¶

https://github.com/react-icons/react-icons å›¾æ ‡åº“ (ç»¼åˆå„ç§æ¡†æ¶çš„å›¾æ ‡)

https://zhuanlan.zhihu.com/p/78051039 èµ„æº

https://github.com/alibaba/hooks è‡ªå®šä¹‰ hooks åº“

https://www.zhihu.com/question/59073695/answer/1071631250 ç±»åº“æ¨è

https://reactjs.org/
è‹¥ä»¥ MVC æ¡†æ¶æ¥çœ‹ï¼ŒReact å±äºview

https://github.com/dypsilon/frontend-dev-bookmarks å‰ç«¯é›†åˆ

https://www.zhihu.com/question/39943474/answer/156412178,

https://www.zhihu.com/question/29848048/answer/45793588,

https://github.com/petehunt/react-howto/blob/master/README-zh.md,

https://github.com/bailicangdu/react-pxq

[æ•ˆç‡ä¼˜åŒ–](https://zhuanlan.zhihu.com/p/37148975)

[react tutorial](https://reacttraining.com/)

https://www.zhihu.com/question/59073695/answer/1071631250 æ¨èçš„ react åº“

https://www.npmjs.com/
https://ant.design/components/overview-cn/

https://www.zhihu.com/question/336664883/answer/790855896 ä¸ºä»€ä¹ˆè¦æ‹†åˆ†åŒ…? ReactDomåªåšå’Œæµè§ˆå™¨æˆ–DOMç›¸å…³çš„æ“ä½œï¼Œä¾‹å¦‚ReactDOM.render()å’ŒReactDOM.findDOMNode()ã€‚å¦‚æœæ˜¯æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œå¯ä»¥ReactDOM.renderToString()

http://huziketang.mangojuice.top/books/react/ å®æˆ˜

https://github.com/helloqingfeng/Awsome-Front-End-learning-resource å¤§å‰ç«¯
https://github.com/qiu-deqing/FE-interview , https://github.com/markyun/My-blog/tree/master/Front-end-Developer-Questions é¢è¯•é¢˜

</div>

<!--more-->

- [1. é¢è¯•é¢˜](#1-é¢è¯•é¢˜)
- [2. æ­å»ºå†…éƒ¨çš„ç»„ä»¶åº“](#2-æ­å»ºå†…éƒ¨çš„ç»„ä»¶åº“)
- [3. å¼€å‘ Chrome æ’ä»¶](#3-å¼€å‘-chrome-æ’ä»¶)
- [4. why react](#4-why-react)
- [5. jsx](#5-jsx)
  - [5.1. åŸºæœ¬è¯­æ³•](#51-åŸºæœ¬è¯­æ³•)
  - [5.2. ä½¿ç”¨ jsx éœ€è¦çš„ç¯å¢ƒé…ç½®](#52-ä½¿ç”¨-jsx-éœ€è¦çš„ç¯å¢ƒé…ç½®)
- [6. å¼€å‘ç¯å¢ƒæ­å»º](#6-å¼€å‘ç¯å¢ƒæ­å»º)
  - [6.1. è€é¡¹ç›®æ¥å…¥](#61-è€é¡¹ç›®æ¥å…¥)
  - [6.2. create-react-app ä½¿ç”¨](#62-create-react-app-ä½¿ç”¨)
  - [6.3. vscode ç¯å¢ƒ](#63-vscode-ç¯å¢ƒ)
  - [6.4. webpack ç¯å¢ƒæ­å»º](#64-webpack-ç¯å¢ƒæ­å»º)
- [7. airbnb æ¨èçš„è§„èŒƒ](#7-airbnb-æ¨èçš„è§„èŒƒ)
- [8. ç»„ä»¶åŒ–](#8-ç»„ä»¶åŒ–)
  - [8.1. ç¤¾åŒºå¼€æºç»„ä»¶](#81-ç¤¾åŒºå¼€æºç»„ä»¶)
  - [8.2. Web Components](#82-web-components)
  - [8.3. ç»„ä»¶è®¾è®¡åŸåˆ™](#83-ç»„ä»¶è®¾è®¡åŸåˆ™)
  - [8.4. å¸¦çŠ¶æ€ç»„ä»¶ çº¯å‡½æ•°ç»„ä»¶](#84-å¸¦çŠ¶æ€ç»„ä»¶-çº¯å‡½æ•°ç»„ä»¶)
  - [8.5. å‡½æ•°ç»‘å®šæ–¹å¼](#85-å‡½æ•°ç»‘å®šæ–¹å¼)
  - [8.6. hooks](#86-hooks)
    - [8.6.1. create react app é…åˆ eslint-plugin-react-hooks](#861-create-react-app-é…åˆ-eslint-plugin-react-hooks)
    - [8.6.2. hooks åŸç†](#862-hooks-åŸç†)
    - [8.6.3. æœ€ä½³å®è·µ](#863-æœ€ä½³å®è·µ)
    - [8.6.4. ä¸ºä»€ä¹ˆéœ€è¦ hooks](#864-ä¸ºä»€ä¹ˆéœ€è¦-hooks)
    - [8.6.5. useRef](#865-useref)
    - [8.6.6. useMemo and memo and useCallback](#866-usememo-and-memo-and-usecallback)
    - [8.6.7. useState](#867-usestate)
      - [8.6.7.1. state ç‰¹æ€§](#8671-state-ç‰¹æ€§)
      - [8.6.7.2. ä¼ ç»Ÿå†™æ³•](#8672-ä¼ ç»Ÿå†™æ³•)
      - [8.6.7.3. ä½¿ç”¨ functional ç»„ä»¶çš„å†™æ³•](#8673-ä½¿ç”¨-functional-ç»„ä»¶çš„å†™æ³•)
      - [8.6.7.4. å»¶è¿Ÿåˆå§‹åŒ–](#8674-å»¶è¿Ÿåˆå§‹åŒ–)
      - [8.6.7.5. æ–°æ—§ state æœ‰å…³è”](#8675-æ–°æ—§-state-æœ‰å…³è”)
    - [8.6.8. useContext](#868-usecontext)
    - [8.6.9. useReducer](#869-usereducer)
    - [8.6.10. useEffect](#8610-useeffect)
      - [8.6.10.1. effect ç†è§£](#86101-effect-ç†è§£)
      - [8.6.10.2. effect åŸºæœ¬ä½¿ç”¨](#86102-effect-åŸºæœ¬ä½¿ç”¨)
      - [8.6.10.3. ç¼“å­˜ä¸Šæ¬¡å€¼](#86103-ç¼“å­˜ä¸Šæ¬¡å€¼)
      - [8.6.10.4. è®¾ç½®é”€æ¯å›è°ƒå‡½æ•°ä¾‹å­](#86104-è®¾ç½®é”€æ¯å›è°ƒå‡½æ•°ä¾‹å­)
      - [8.6.10.5. å‘é€å¼‚æ­¥è¯·æ±‚](#86105-å‘é€å¼‚æ­¥è¯·æ±‚)
      - [8.6.10.6. ä½¿ç”¨ fetch api](#86106-ä½¿ç”¨-fetch-api)
    - [8.6.11. è‡ªå®šä¹‰ hook](#8611-è‡ªå®šä¹‰-hook)
      - [8.6.11.1. å¸¦æœ‰è‡ªå¢æ•ˆæœçš„ state hook](#86111-å¸¦æœ‰è‡ªå¢æ•ˆæœçš„-state-hook)
      - [8.6.11.2. ä» usehooks æ”¹é€  responseComponent](#86112-ä»-usehooks-æ”¹é€ -responsecomponent)
      - [8.6.11.3. å®šæ—¶å™¨ and è‡ªåŠ¨é”€æ¯](#86113-å®šæ—¶å™¨-and-è‡ªåŠ¨é”€æ¯)
    - [8.6.12. ç»¼åˆä¾‹å­](#8612-ç»¼åˆä¾‹å­)
      - [8.6.12.1. ç‚¹èµæŒ‰é’®](#86121-ç‚¹èµæŒ‰é’®)
  - [8.7. é«˜é˜¶ç»„ä»¶ and å‡½æ•°ä½œä¸ºå­ç»„ä»¶](#87-é«˜é˜¶ç»„ä»¶-and-å‡½æ•°ä½œä¸ºå­ç»„ä»¶)
  - [8.8. Fragment](#88-fragment)
  - [8.9. StrictMode](#89-strictmode)
  - [8.10. ç¤ºä¾‹](#810-ç¤ºä¾‹)
    - [8.10.1. ä½¿ç”¨ props](#8101-ä½¿ç”¨-props)
    - [8.10.2. éå†å­å…ƒç´ ](#8102-éå†å­å…ƒç´ )
    - [8.10.3. æ‰¾åˆ°çœŸå®çš„ dom(this.ref.xxx)](#8103-æ‰¾åˆ°çœŸå®çš„-domthisrefxxx)
    - [8.10.4. ä½¿ç”¨ state(this.state)](#8104-ä½¿ç”¨-statethisstate)
    - [8.10.5. ä¸€ä¸ªè¡¨å•ç¤ºä¾‹](#8105-ä¸€ä¸ªè¡¨å•ç¤ºä¾‹)
    - [8.10.6. ç™»å½•ç•Œé¢](#8106-ç™»å½•ç•Œé¢)
    - [8.10.7. todo list app](#8107-todo-list-app)
- [9. ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ](#9-ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ)
  - [9.1. ç”Ÿå‘½å‘¨æœŸä»‹ç»](#91-ç”Ÿå‘½å‘¨æœŸä»‹ç»)
  - [9.2. ç»„ä»¶è¢«æŒ‚è½½](#92-ç»„ä»¶è¢«æŒ‚è½½)
  - [9.3. ç»„ä»¶è¢«å¸è½½](#93-ç»„ä»¶è¢«å¸è½½)
  - [9.4. ç»„ä»¶è¢«æ›´æ–°](#94-ç»„ä»¶è¢«æ›´æ–°)
  - [9.5. ç”Ÿå‘½å‘¨æœŸå‡½æ•° demo](#95-ç”Ÿå‘½å‘¨æœŸå‡½æ•°-demo)
- [10. virtual dom å’Œ diff ç®—æ³•](#10-virtual-dom-å’Œ-diff-ç®—æ³•)
  - [10.1. virtual dom](#101-virtual-dom)
  - [10.2. react çš„ diff ç®—æ³•æ³•](#102-react-çš„-diff-ç®—æ³•æ³•)
  - [10.3. key å±æ€§æœ‰ä»€ä¹ˆä½œç”¨](#103-key-å±æ€§æœ‰ä»€ä¹ˆä½œç”¨)
  - [10.4. è®¾ç½®ç»„ä»¶æ—¶æ€ä¹ˆæé«˜æ€§èƒ½](#104-è®¾ç½®ç»„ä»¶æ—¶æ€ä¹ˆæé«˜æ€§èƒ½)
- [11. context-api ä½¿ç”¨](#11-context-api-ä½¿ç”¨)
- [12. state çŠ¶æ€](#12-state-çŠ¶æ€)
  - [12.1. state ä»‹ç»](#121-state-ä»‹ç»)
  - [12.2. state å’Œç»„ä»¶çš„æ™®é€šå±æ€§åŒºåˆ«](#122-state-å’Œç»„ä»¶çš„æ™®é€šå±æ€§åŒºåˆ«)
  - [12.3. å¦‚ä½•æ›´æ–° state](#123-å¦‚ä½•æ›´æ–°-state)
  - [12.4. setState æ˜¯ä¸æ˜¯å¼‚æ­¥çš„](#124-setstate-æ˜¯ä¸æ˜¯å¼‚æ­¥çš„)
  - [12.5. setState æ›´æ–°æ˜¯ä¸€ä¸ªåˆå¹¶è¿‡ç¨‹](#125-setstate-æ›´æ–°æ˜¯ä¸€ä¸ªåˆå¹¶è¿‡ç¨‹)
  - [12.6. replaceState æ›´æ–°æ˜¯ä¸€ä¸ªæ›¿æ¢è¿‡ç¨‹](#126-replacestate-æ›´æ–°æ˜¯ä¸€ä¸ªæ›¿æ¢è¿‡ç¨‹)
- [13. props å±æ€§](#13-props-å±æ€§)
  - [13.1. åœ¨ jsx ä¸­éå† props](#131-åœ¨-jsx-ä¸­éå†-props)
  - [13.2. PropTypes ç±»å‹æ£€æŸ¥](#132-proptypes-ç±»å‹æ£€æŸ¥)
  - [13.3. å¼•å…¥ç±»å‹æ£€æŸ¥çš„å…¶ä»–æ–¹æ³•](#133-å¼•å…¥ç±»å‹æ£€æŸ¥çš„å…¶ä»–æ–¹æ³•)
    - [13.3.1. å¼•å…¥ TypeScript](#1331-å¼•å…¥-typescript)
    - [13.3.2. flow ç±»å‹æ£€æŸ¥](#1332-flow-ç±»å‹æ£€æŸ¥)
  - [13.4. è®¾å®š props çš„é»˜è®¤å€¼](#134-è®¾å®š-props-çš„é»˜è®¤å€¼)
  - [13.5. æœ‰å“ªäº›å±æ€§](#135-æœ‰å“ªäº›å±æ€§)
- [14. refs](#14-refs)
- [15. åˆæˆäº‹ä»¶](#15-åˆæˆäº‹ä»¶)
- [16. çŠ¶æ€ç®¡ç†](#16-çŠ¶æ€ç®¡ç†)
  - [16.1. flux æ¶æ„çš„æ€æƒ³](#161-flux-æ¶æ„çš„æ€æƒ³)
  - [16.2. Flux å®˜æ–¹å®ç°](#162-flux-å®˜æ–¹å®ç°)
  - [16.3. Redux](#163-redux)
    - [16.3.1. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ redux](#1631-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-redux)
    - [16.3.2. åŸºæœ¬æ¦‚å¿µ](#1632-åŸºæœ¬æ¦‚å¿µ)
    - [16.3.3. åŸºæœ¬ api](#1633-åŸºæœ¬-api)
      - [16.3.3.1. store](#16331-store)
      - [16.3.3.2. reducer](#16332-reducer)
      - [16.3.3.3. applyMiddleware](#16333-applymiddleware)
      - [16.3.3.4. bindActionCreators](#16334-bindactioncreators)
    - [16.3.4. çº¯ redux çš„ api ç¤ºä¾‹(åŒæ­¥ç‰ˆæœ¬çš„ api)](#1634-çº¯-redux-çš„-api-ç¤ºä¾‹åŒæ­¥ç‰ˆæœ¬çš„-api)
    - [16.3.5. react-redux](#1635-react-redux)
    - [16.3.6. å¼‚æ­¥ Action](#1636-å¼‚æ­¥-action)
    - [16.3.7. thunk, saga](#1637-thunk-saga)
    - [16.3.8. è°ƒè¯•å·¥å…·](#1638-è°ƒè¯•å·¥å…·)
    - [16.3.9. demo(ä¸€ä¸ª todo-app)](#1639-demoä¸€ä¸ª-todo-app)
  - [16.4. Redux å’Œ Flux çš„ä¸€äº›å·®å¼‚](#164-redux-å’Œ-flux-çš„ä¸€äº›å·®å¼‚)
  - [16.5. ImmutableJS](#165-immutablejs)
- [17. è·¯ç”± react-router](#17-è·¯ç”±-react-router)
  - [17.1. è·¯ç”±æ ‡ç­¾çš„ä½¿ç”¨](#171-è·¯ç”±æ ‡ç­¾çš„ä½¿ç”¨)
    - [17.1.1. Router-è·¯ç”±å®¹å™¨](#1711-router-è·¯ç”±å®¹å™¨)
    - [17.1.2. Route-è·¯ç”±ç»„ä»¶æ˜ å°„](#1712-route-è·¯ç”±ç»„ä»¶æ˜ å°„)
      - [17.1.2.1. å±æ€§](#17121-å±æ€§)
      - [17.1.2.2. é€šè¿‡ url ä¼ é€’å‚æ•°ç»™ Route](#17122-é€šè¿‡-url-ä¼ é€’å‚æ•°ç»™-route)
      - [17.1.2.3. åµŒå¥—è·¯ç”±](#17123-åµŒå¥—è·¯ç”±)
      - [17.1.2.4. Route ä¸‰ç§æ¸²æŸ“æ–¹å¼](#17124-route-ä¸‰ç§æ¸²æŸ“æ–¹å¼)
    - [17.1.3. Switch-è§£å†³å¤šåŒ¹é…é—®é¢˜](#1713-switch-è§£å†³å¤šåŒ¹é…é—®é¢˜)
    - [17.1.4. Redirect-é‡å®šå‘å½“å‰é¡µé¢](#1714-redirect-é‡å®šå‘å½“å‰é¡µé¢)
    - [17.1.5. Link-è¶…é“¾æ¥](#1715-link-è¶…é“¾æ¥)
    - [17.1.6. NavLink: å¸¦æ ·å¼çš„ Link](#1716-navlink-å¸¦æ ·å¼çš„-link)
    - [17.1.7. Prompt-æç¤º](#1717-prompt-æç¤º)
  - [17.2. history](#172-history)
  - [17.3. location](#173-location)
  - [17.4. match](#174-match)
- [18. è°ƒè¯•å’Œæµ‹è¯•](#18-è°ƒè¯•å’Œæµ‹è¯•)
- [19. GraphQL å’Œ Relay](#19-graphql-å’Œ-relay)
- [20. CSS-Module æ¨¡å—åŒ–](#20-css-module-æ¨¡å—åŒ–)
- [21. css-in-js](#21-css-in-js)
- [22. æœ€ä½³å®è·µ best practice](#22-æœ€ä½³å®è·µ-best-practice)
- [23. æœåŠ¡ç«¯æ¸²æŸ“](#23-æœåŠ¡ç«¯æ¸²æŸ“)
  - [23.1. ä»€ä¹ˆæ˜¯ ssr](#231-ä»€ä¹ˆæ˜¯-ssr)
  - [23.2. ssr çš„å¥½å¤„](#232-ssr-çš„å¥½å¤„)
  - [23.3. è§£å†³æ–¹æ¡ˆ](#233-è§£å†³æ–¹æ¡ˆ)
    - [23.3.1. æ‹–è¿‡ vite](#2331-æ‹–è¿‡-vite)
    - [23.3.2. é…åˆ koa2 å®ç° ssr](#2332-é…åˆ-koa2-å®ç°-ssr)
    - [23.3.3. egg å®ç° ssr](#2333-egg-å®ç°-ssr)
- [24. æ€§èƒ½ä¼˜åŒ–](#24-æ€§èƒ½ä¼˜åŒ–)
  - [24.1. å¸¸è§çš„æ€§èƒ½é—®é¢˜åœºæ™¯](#241-å¸¸è§çš„æ€§èƒ½é—®é¢˜åœºæ™¯)
  - [24.2. ä½¿ç”¨å·¥å…·å®šä½æ€§èƒ½é—®é¢˜](#242-ä½¿ç”¨å·¥å…·å®šä½æ€§èƒ½é—®é¢˜)
  - [24.3. ç½‘ç»œæ€§èƒ½ä¼˜åŒ–-è‡ªåŠ¨æŒ‰éœ€åŠ è½½](#243-ç½‘ç»œæ€§èƒ½ä¼˜åŒ–-è‡ªåŠ¨æŒ‰éœ€åŠ è½½)
  - [24.4. ä½¿ç”¨ Reselect é¿å…é‡å¤è®¡ç®—](#244-ä½¿ç”¨-reselect-é¿å…é‡å¤è®¡ç®—)
- [25. react åŠ¨ç”»](#25-react-åŠ¨ç”»)
- [26. react native](#26-react-native)
- [27. å¼€å‘å°ç¨‹åº](#27-å¼€å‘å°ç¨‹åº)
- [28. å°é¡¹ç›®](#28-å°é¡¹ç›®)
  - [28.1. å®ç° route](#281-å®ç°-route)
  - [28.2. è¡¨å•è®¾è®¡å™¨](#282-è¡¨å•è®¾è®¡å™¨)
  - [28.3. cms ç³»ç»Ÿ](#283-cms-ç³»ç»Ÿ)
- [29. éƒ¨ç½²åˆ° github ä¸Š](#29-éƒ¨ç½²åˆ°-github-ä¸Š)
- [30. å’Œ springboot æ‰“åŒ…å•ä½“åº”ç”¨](#30-å’Œ-springboot-æ‰“åŒ…å•ä½“åº”ç”¨)
- [31. å’Œ typescript ä¸€èµ·ä½¿ç”¨](#31-å’Œ-typescript-ä¸€èµ·ä½¿ç”¨)
  - [31.1. é›†æˆ ts ç¯å¢ƒ](#311-é›†æˆ-ts-ç¯å¢ƒ)
  - [31.2. ts åŸºæœ¬ä½¿ç”¨](#312-ts-åŸºæœ¬ä½¿ç”¨)
    - [31.2.1. åŸºæœ¬æ•°æ®ç±»å‹](#3121-åŸºæœ¬æ•°æ®ç±»å‹)
    - [31.2.2. interface](#3122-interface)
      - [31.2.2.1. ä½¿ç”¨ interface å®šä¹‰å¯¹è±¡ç±»å‹](#31221-ä½¿ç”¨-interface-å®šä¹‰å¯¹è±¡ç±»å‹)
      - [31.2.2.2. interface å®šä¹‰å‡½æ•°ç±»å‹](#31222-interface-å®šä¹‰å‡½æ•°ç±»å‹)
      - [31.2.2.3. interface å®šä¹‰å¯ç´¢å¼•ç±»å‹](#31223-interface-å®šä¹‰å¯ç´¢å¼•ç±»å‹)
      - [31.2.2.4. interface å®šä¹‰ class ç±»](#31224-interface-å®šä¹‰-class-ç±»)
      - [31.2.2.5. interface ç»§æ‰¿](#31225-interface-ç»§æ‰¿)
    - [31.2.3. interface å’Œ type åŒºåˆ«](#3123-interface-å’Œ-type-åŒºåˆ«)
    - [31.2.4. class ä½¿ç”¨](#3124-class-ä½¿ç”¨)
    - [31.2.5. æ³›å‹ä½¿ç”¨](#3125-æ³›å‹ä½¿ç”¨)
    - [31.2.6. äº¤å‰ç±»å‹](#3126-äº¤å‰ç±»å‹)
    - [31.2.7. è”åˆç±»å‹](#3127-è”åˆç±»å‹)
    - [31.2.8. ç±»å‹ä¿æŠ¤](#3128-ç±»å‹ä¿æŠ¤)
    - [31.2.9. ç±»å‹åˆ«å](#3129-ç±»å‹åˆ«å)
    - [31.2.10. ç©ºç±»å‹](#31210-ç©ºç±»å‹)
  - [31.3. ä¸ºæ ·å¼æ–‡ä»¶ç¼–å†™ types](#313-ä¸ºæ ·å¼æ–‡ä»¶ç¼–å†™-types)
  - [31.4. é…ç½® css è·³è½¬](#314-é…ç½®-css-è·³è½¬)
- [32. å¼€æºåº“](#32-å¼€æºåº“)
  - [32.1. ç»„ä»¶åº“](#321-ç»„ä»¶åº“)
  - [32.2. åŠ¨ç”»](#322-åŠ¨ç”»)
  - [32.3. css æ¡†æ¶](#323-css-æ¡†æ¶)
- [33. ionic å¼‚å¸¸ è´¨é‡App](#33-ionic-å¼‚å¸¸-è´¨é‡app)


# 1. é¢è¯•é¢˜

```

- Reactè§£å†³äº†ä»€ä¹ˆé—®é¢˜ - å‡å°‘äº†é¡µé¢æ¸²æŸ“èŒƒå›´, ç¼“è§£æµè§ˆå™¨ç»˜åˆ¶å‹åŠ›
- ç»„ä»¶çš„Renderå‡½æ•°åœ¨ä½•æ—¶è¢«è°ƒç”¨ï¼Ÿ -  state å‘ç”Ÿæ”¹å˜çš„æ—¶å€™
  - è°ƒç”¨æ—¶DOMå°±ä¸€å®šä¼šè¢«æ›´æ–°å—, -  ä¸ä¸€å®š, ä¼šå¯¹æ¯”æ›´æ–°åçš„ virtual dom å’Œ real dom , æ‰¾å‡ºéœ€è¦æ›´æ–°çš„æœ€å°æ­¥éª¤ï¼Œæ­¤æ—¶Real DOMæ‰å¯èƒ½å‘ç”Ÿä¿®æ”¹ã€‚
- ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæœ‰å“ªäº›ï¼Ÿ

    ç»„ä»¶çš„åˆå§‹åŒ–é˜¶æ®µçš„å£°æ˜å‘¨æœŸå‡½æ•°ä»¥åŠé‡ç‚¹ç”¨æ³•å¦‚ä¸‹ï¼š

    constructor(): ç”¨äºç»‘å®šäº‹ä»¶ä»¥åŠåˆå§‹åŒ–stateï¼ˆå¯ä»¥é€šè¿‡"fork"propsçš„æ–¹å¼ç»™stateèµ‹å€¼ï¼‰
    componentWillMount(): åªä¼šåœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶è¢«è°ƒç”¨ï¼Œä½ å¯ä»¥åœ¨è¿™é‡ŒåŒæ­¥æ“ä½œstate
    render(): è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥æ¸²æŸ“DOMæ²¡æœ‰é”™ã€‚ä½†å®ƒåªèƒ½ç”¨æ¥æ¸²æŸ“DOMï¼Œè¯·ä¿è¯å®ƒçš„çº¯ç²¹æ€§ã€‚å¦‚æœæœ‰æ“ä½œDOMæˆ–è€…å’Œæµè§ˆå™¨æ‰“äº¤é“çš„ä¸€ç³»åˆ—æ“ä½œï¼Œè¯·åœ¨ä¸‹ä¸€æ­¥éª¤componentDidMountä¸­è¿›è¡Œ
    componentDidMount(): å¦‚æœä½ æœ‰ç¬¬ä¸‰æ–¹æ“ä½œDOMçš„ç±»åº“éœ€è¦åˆå§‹åŒ–ï¼ˆç±»ä¼¼äºjQueryï¼ŒBootstrapçš„ä¸€äº›ç»„ä»¶ï¼‰æ“ä½œDOMã€æˆ–è€…è¯·æ±‚å¼‚æ­¥æ•°æ®ï¼Œéƒ½åº”è¯¥æ”¾åœ¨è¿™ä¸ªæ­¥éª¤ä¸­åš

    ç»„ä»¶æ›´æ–°é˜¶æ®µï¼š

    componentWillReceiveProps(nextProps): åœ¨è¿™é‡Œä½ å¯ä»¥æ‹¿åˆ°å³å°†æ”¹å˜çš„çŠ¶æ€ï¼Œå¯ä»¥åœ¨è¿™ä¸€æ­¥ä¸­é€šè¿‡setStateæ–¹æ³•è®¾ç½®state
    shouldComponentUpdate(nextProps, nextState): è¿™ä¸€æ­¥éª¤éå¸¸é‡è¦ï¼Œå®ƒçš„è¿”å›å€¼å†³å®šäº†æ¥ä¸‹æ¥çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ˜¯å¦ä¼šè¢«è°ƒç”¨ï¼Œé»˜è®¤è¿”å›trueï¼Œå³éƒ½ä¼šè¢«è°ƒç”¨ï¼›ä½ ä¹Ÿå¯ä»¥é‡å†™è¿™ä¸ªå‡½æ•°ä½¿å®ƒè¿”å›falseã€‚
    componentWillUpdate(): æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ä¸ªå£°æ˜å‘¨æœŸå‡½æ•°çš„æ„ä¹‰åœ¨å“ªé‡Œï¼Œåœ¨è¿™ä¸ªå‡½æ•°å†…ä½ ä¸èƒ½è°ƒç”¨setStateæ”¹å˜ç»„ä»¶çŠ¶æ€
    render()
    componentDidUpdate(): å’ŒcomponentDidMountç±»ä¼¼ï¼Œåœ¨è¿™é‡Œæ‰§è¡ŒDOMæ“ä½œä»¥åŠå‘èµ·ç½‘ç»œè¯·æ±‚
    
    ç»„ä»¶ææ„é˜¶æ®µï¼š

    componentWillUnmount(): ä¸»è¦ç”¨äºæ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚å–æ¶ˆç½‘ç»œè¯·æ±‚ï¼Œæ¸…æ¥šå¤šä½™çš„DOMå…ƒç´ ç­‰



  - å½“æŸäº›ç¬¬ä¸‰æ–¹ç±»åº“æƒ³å¯¹DOMåˆå§‹åŒ–ï¼Œæˆ–è€…è¿›è¡Œè¿œç¨‹æ•°æ®åŠ è½½æ—¶ï¼Œåº”è¯¥åœ¨å“ªä¸ªå‘¨æœŸä¸­å®Œæˆ
  - åœ¨å“ªäº›å£°æ˜å‘¨æœŸä¸­å¯ä»¥ä¿®æ”¹ç»„ä»¶çš„stateï¼Ÿ
- ä¸åŒçˆ¶èŠ‚ç‚¹çš„ç»„ä»¶éœ€è¦å¯¹å½¼æ­¤çš„çŠ¶æ€è¿›è¡Œæ”¹å˜æ—¶åº”è¯¥å®ç°ï¼Ÿ
  - å¦‚ä½•è®¾è®¡å‡ºä¸€ä¸ªå¥½çš„Fluxæ¶æ„
  - å¦‚ä½•è®¾è®¡å‡ºä¸€ä¸ªå¥½çš„Reactç»„ä»¶
- å¦‚ä½•è¿›è¡Œä¼˜åŒ–ï¼Ÿ
  - ç»„ä»¶ä¸­çš„keyå±æ€§æœ‰ä»€ä¹ˆç”¨ï¼Ÿ
- Component ä¸ Element ä¸ Instance çš„åŒºåˆ«
- Webpackå¦‚ä½•æ‰“åŒ…è¾“å‡ºå¤šä¸ªæ–‡ä»¶ï¼Ÿ
  - webpackæ‰“åŒ…æ—¶å¦‚ä½•å·¥ä½œçš„ï¼Ÿ
  - å¦‚ä½•è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜
  - åœ¨ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦æ‰“åŒ…è¾“å‡ºå¤šä¸ªæ–‡ä»¶ï¼Ÿ
  - loaderå’Œpluginçš„å·®åˆ«
  - ä½ è§‰å¾—ä½¿ç”¨è¿‡ä»€ä¹ˆé«˜çº§æŠ€å·§å—ï¼Ÿ
- (å¼€æ”¾é—®é¢˜ï¼‰Reactçš„ç”Ÿæ€ä½ ä½¿ç”¨è¿‡å“ªäº›ç±»åº“

```

# 2. æ­å»ºå†…éƒ¨çš„ç»„ä»¶åº“

åŸºäº Markdown çš„æ–¹å¼æ¯”è¾ƒç®€å•

React https://mdxjs.com/ https://www.docz.site/
Vue https://vuepress.vuejs.org/
é€šç”¨ https://storybook.js.org/

# 3. å¼€å‘ Chrome æ’ä»¶

https://github.com/lxieyang/chrome-extension-boilerplate-react

# 4. why react

ReactJS: ui å±•ç¤ºæ¡†æ¶, åªè´Ÿè´£ view æ¸²æŸ“çš„éƒ¨åˆ†, åŒ…æ‹¬ npm åº“ `react`(æ ¸å¿ƒ), `react-dom`(ä¸“é—¨å¤„ç† dom)

reactjs æ¥è‡ª facebook, èµ·åˆè¢«åˆ›é€ æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜: é¡µé¢ä¸Šçš„ä¸€ä¸ªå›¾æ ‡éœ€è¦å®æ—¶æ˜¾ç¤ºä¸€ä¸ªæ•°å­—, è¡¨ç¤ºæœ‰å¤šå°‘æ¶ˆæ¯æœªè¯», ä½†æ˜¯å§‹ç»ˆåšä¸åˆ°å®æ—¶å˜åŒ–. äº§ç”Ÿçš„åŸå› æ˜¯,

-   ä¼ ç»Ÿçš„ dom api éœ€è¦æ“ä½œå¤ªå¤šç»†èŠ‚ (æ¯”å¦‚å…¸å‹çš„ jQuery, api å·¨å¤šæ— æ¯”). react å®ç°äº†æ•´ä½“åˆ·æ–°, ui æ¸²æŸ“å’Œæ•°æ®ç»‘å®š, ui éšæ•°æ®å®æ—¶å˜åŒ–

-   è¿˜æœ‰ä¸€ä¸ªåŸå› , ä¼ ç»Ÿçš„ app çš„çŠ¶æ€åˆ†æ•£ä¸åŒçš„åœ°æ–¹

so why react?

-   ä¼ ç»Ÿå¼€å‘æ¨¡å¼å¦‚ jQuery ç›´æ¥æ“ä½œ dom æ ‘, æ€§èƒ½æ¶ˆè€—å¤§, react ä½¿ç”¨ virtual dom å–è€Œä»£ä¹‹
-   ä¼ ç»Ÿå¼€å‘ç›´æ¥æ“çºµ dom, éœ€è¦å…³æ³¨å¤ªå¤š api ç»†èŠ‚ (çœ‹çœ‹ jQuery æœ‰å¤šå°‘ api å°±çŸ¥é“äº†), react å®ç°äº† ui æ¸²æŸ“ å’Œ æ•°æ®ç»‘å®š, ä¸ç”¨æ‰‹åŠ¨æ“ä½œæ¸²æŸ“
-   ä¼ ç»Ÿå¼€å‘ ä»£ç éš¾ä»¥å¤ç”¨, react æä¾›ç»„ä»¶åŒ–çš„å¼€å‘æ–¹å¼

å‰ç«¯å·¥ç¨‹ and æ¨¡å—åŒ– -> js-proj-history.md


# 5. jsx 

## 5.1. åŸºæœ¬è¯­æ³•

JSX: è¯­æ³•ç³–, ç±»ä¼¼ xml, ä½†æ˜¯è¿›è¡Œäº†æ‹“å±•, åŠ å…¥ js è¯­æ³•, å°† HTML ç›´æ¥åµŒå…¥äº† JS ä»£ç é‡Œé¢, æœ€ç»ˆéœ€è¦â€œç¼–è¯‘â€è¾“å‡º JS ä»£ç æ‰èƒ½ä½¿ç”¨;

ä½¿ç”¨ React å¹¶éå¿…é¡»ä½¿ç”¨ JSX, JSX åªæ˜¯ä¸€ç§ç›´è§‚çš„åˆ›å»º React nodes çš„æ–¹æ³•ï¼Œå®ƒæ˜¯å¯¹ `React.createElement()`æ–¹æ³•çš„å°è£…

é€šè¿‡ Babelï¼ŒJSX è¯­å¥ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ

çœ‹çœ‹ demo------- [ğŸšª](https://github.com/xiaoyureed/react-note/blob/master/demo/demo.js)

```js
// è¯­ä¹‰åŒ–ä¸”æ˜“æ‡‚çš„æ ‡ç­¾
if(this.state.liked) {
  return (<BlueLike />);
} else {
  return (<GrayLike />);
}

// jsx å¦‚ä½•è½¬åŒ–ä¸º js:
React.createElement(
  string/ReactClass, // è¡¨ç¤º HTML å…ƒç´ æˆ–æ˜¯ React Component
  [object props], // å±æ€§å€¼ object
  [children] // æ¥ä¸‹æ¥å‚æ•°çš†ä¸ºå…ƒç´ å­å…ƒç´ 
)


// ä½¿ç”¨æ ‡ç­¾çš„å†™æ³•, ä»£ç æ›´åŠ ç®€æ´
<a href="https://facebook.github.io/react/">Hello!</a>/* å¯ä»¥ç›´æ¥åœ¨jsxä¸­ä½¿ç”¨ */
// React.createElement(ç»„ä»¶/HTMLæ ‡ç­¾, ç»„ä»¶å±æ€§, å­å…ƒç´ )
React.createElement('a', {href: 'https://facebook.github.io/react/'}, 'Hello!')



// ç»“åˆjså†™æ³•

// è§£ææ—¶å€™, "{" å¼€å§‹, è¿›å…¥js, "<" å¼€å§‹, è¿›å…¥html
var text = 'Hello React';
// jsx æœ¬èº«ä¹Ÿæ˜¯è¡¨è¾¾å¼
const element = <h1>{text}</h1>;
// ä¼šæ›¿æ¢ä¸º:
var text = 'Hello React';
React.createElement("h1", null, text);

// åœ¨ html æ ‡ç­¾å±æ€§ ä¸­ä½¿ç”¨ jsx
<h1 foo={1 + 2} />


// ä½¿ç”¨æ•°ç»„
/* jsxä¸­ä½¿ç”¨js, jsxä¸­ä½¿ç”¨æ•°ç»„, <!-- æœ€å¥½æœ‰ä½¿ç”¨index, ä¸ç„¶ä¼šæŠ¥è­¦å‘Š, å®é™…ä¸Šæ˜¯å› ä¸ºæœ‰æŸæ€§èƒ½ --> */
var names = ['aaa', 'bbb', 'ccc'];
ReactDOM.render(
    <div>
        {
            names.map(function (name, index) {
                return <div key={index}>hello, {name}</div>
            })
        }
    </div>
    ,
    document.getElementById("array")
);

// -------------------------------------------

// /* è¿™é‡Œä¼šå°†æ•°ç»„æ•°æ®è¿èµ·æ¥, è¿™é‡Œæ²¡æœ‰index, ä¼šè­¦å‘Š, ä¸è¿‡ä¸å½±å“è¿è¡Œ */
var namesHtml = [<h1>h1...</h1>, <h2>h2...</h2>];
ReactDOM.render(
    <div>
        {namesHtml}
    </div>,
    document.getElementById("htmlArray")
);


// ----------------------

jsx ä¸­çš„å…³é”®å­—å˜åŒ–

class å’Œ for ç”±äºä¸º JavaScript ä¿ç•™å…³é”®å­—ç”¨æ³•ï¼Œå› æ­¤åœ¨ JSX ä¸­ä½¿ç”¨ className å’Œ htmlFor æ›¿ä»£

Boolean å±æ€§: åœ¨ JSX ä¸­é¢„è®¾åªæœ‰å±æ€§åç§°ä½†æ²¡æœ‰(æ— éœ€)è®¾å€¼ä¸º true

// ---------------------

è‡ªå®šä¹‰å±æ€§ data-xxx
<HelloMessage data-attr="xd" />

//--------------

ä½¿ç”¨ "..."éå† props å±æ€§

var props = {
    style: "width:20px",// æŠ¥é”™, å­˜ç–‘; å¯èƒ½styleéœ€è¦å•ç‹¬ä¸€ä¸ªå¯¹è±¡, æˆ–è€… <HelloMessage style={{ color: '#FFFFFF', fontSize: '30px'}} />
    className: "main",
    value: "yo",  // ä¼šè¢«æ›¿æ¢
}

<HelloMessage  {...props} value="yo" />

// ç­‰äºä»¥ä¸‹
React.createElement("h1", React._spread({}, props, {value: "yo"}), "Hello React!");

// ==========================


ç›´æ¥æ˜¾ç¤ºåŸå§‹ HTML
<div>{{ _html: "<h1>Hello World!!</h1>" }}</div>


//================

Inline Style
// åœ¨ React Component ä¸­ CSS ä½¿ç”¨ Inline Style å†™æ³•ï¼Œå…¨éƒ½å°è£…åœ¨ JavaScript å½“ä¸­
const divStyle = {
    color: "red",
    backgroundImage: "url(" + imgUrl + ")"
};

ReactDOM.render(
    <div style={divStyle}>Hello World!</div>,
    document.getElementById("app")
);


```

## 5.2. ä½¿ç”¨ jsx éœ€è¦çš„ç¯å¢ƒé…ç½®

jsx è¢«æµè§ˆå™¨è¯†åˆ«éœ€è¦å…ˆç¼–è¯‘, è¿™é‡Œæœ‰ 2 ä¸ªæ–¹æ³•:

ä¸€ç§æ˜¯ä½¿ç”¨ browserify æˆ– webpack ç­‰ CommonJS bundler å¹¶æ•´åˆ babel é¢„å¤„ç†, äºæµè§ˆå™¨ç«¯åšè§£æ, ç›¸è¾ƒäº server ç«¯è§£æè€—è´¹æ—¶é—´, ä½†æ˜¯é€‚åˆæ•´åˆè€é¡¹ç›®

```html
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react-dom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
<!-- babel.jsä¸browser.jsçš„å…³ç³»: babelçš„æµè§ˆå™¨ç‰ˆæœ¬ä¸ºbrowser.js -->
```

ç¬¬äºŒç§æ˜¯ç»“åˆ webpack, babel é¢„å…ˆç¼–è¯‘å†éƒ¨ç½², ä½¿ç”¨ babel.js, `babel src --out-dir build`



==================== ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ä½¿ç”¨ jsx, å¦‚ä½•å¼•å…¥ jsx

ç›´æ¥å†…åµŒ

```js
/* text/babelè¡¨ç¤ºä¸ºjsxè¯­æ³•ï¼Œ å’Œjsä¸å…¼å®¹ */
<script type="text/babel">
    ReactDOM.render(
    <h1>Hello, world!</h1>, document.getElementById('example') );
</script>
```

ä»å¤–éƒ¨å¼•å…¥

```js
<script type="text/jsx" src="main.jsx" />
```




# 6. å¼€å‘ç¯å¢ƒæ­å»º

## 6.1. è€é¡¹ç›®æ¥å…¥

CDN-based(ç›´æ¥å¼•å…¥ script çš„æ–¹å¼, é€‚åˆè€é¡¹ç›®, è§ä¸‹èŠ‚ demo)ã€ webpack([ref](https://github.com/carlleton/reactjs101/blob/zh-CN/Ch02/webpack-dev-enviroment.md)), TypeScript çš„å¼€å‘æ–¹å¼, browserify æ­é… Gulp çš„æ–¹æ³•([ref](https://github.com/carlleton/reactjs101/blob/zh-CN/Ch02/browserify-gulp-dev-enviroment.md))

## 6.2. create-react-app ä½¿ç”¨

ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ create-react-app å®˜æ–¹è„šæ‰‹æ¶

```sh
# å…¨å±€å®‰è£…
npm i -g create-react-app
# åˆ›å»ºä¸€ä¸ªapp
create-react-app demo-app

# ä¹Ÿå¯ä»¥ä¸€æ­¥åˆ°ä½
npx create-react-app demo-app

```

å¯ä»¥é…åˆ vscode çš„ chrome debugger æ’ä»¶:

éœ€è¦ä¿®æ”¹ url ä¸ºè‡ªå·±çš„ï¼Œreact å·¥ç¨‹é»˜è®¤æ˜¯http://localhost:3000


æ¨èå…ˆ `npm start` å¯åŠ¨ app, ç„¶å F5 å¯åŠ¨è°ƒè¯•æœåŠ¡å™¨, æ­¤æ—¶ä¼šæ–°å¼€ä¸€ä¸ª chrome, è®¿é—®é…ç½®çš„ url

## 6.3. vscode ç¯å¢ƒ

eslint, prettier æ’ä»¶, å’Œå¯¹åº”çš„ module

ç”Ÿæˆ .eslintrc.js æ—¶å€™ï¼ˆeslint â€”initï¼‰çš„ç¬¬ä¸€æ­¥é€‰æ‹©ï¼Œå³"How would you like to use ESlint"ï¼Œä¸è¦é€‰æ‹©"enforce code style"ï¼Œå› ä¸ºæˆ‘ä»¬è¦äº¤ç»™ Prettier å»è´Ÿè´£æ ¼å¼åŒ–ä»£ç ï¼Œå¦åˆ™ä¼šæœ‰å†²çª

ä½†å¦‚æœæˆ‘ä»¬é€‰æ‹©äº†"enforce code style"ï¼Œé‚£ä¹ˆä¼šå¤šå‡ºä¸€æ­¥"Which style guide do you want to follow? (Use arrow keys)"è®©ä½ é€‰ï¼Œæ­¤æ—¶å¯ä»¥é€‰æ‹©ä¸‰ç§ä»£ç é£æ ¼ï¼šå³ Airbnbã€Standardã€Googleã€‚

[vscode å…³é—­ eslint](https://blog.csdn.net/lishuan182/article/details/89575678)

[eslint + airbnb è§„èŒƒ](https://segmentfault.com/a/1190000020379876)

[eslint + prettier é…åˆä½¿ç”¨, å†²çªè§£å†³, ä½¿ç”¨ git hooks åœ¨æ¯æ¬¡æäº¤ commit æ—¶ (pre-commit)æ ¼å¼åŒ–](https://thomlom.dev/setup-eslint-prettier-react/)

## 6.4. webpack ç¯å¢ƒæ­å»º

```sh
yarn add webpack webpack-cli webpack-dev-server
touch webpack.config.js


```

```json
"scripts": {
        "dev": "webpack-dev-server --mode development",
        "build": "webpack --mode production",
 },
# yarn dev å»å¯åŠ¨æœ¬åœ°server
# yarn build å»ç”Ÿæˆç”Ÿäº§ä»£ç 



```

https://juejin.im/post/5d7a7e7e518825345a05c518

https://juejin.im/post/5cfb8c0051882541b24c3ed3 //todo


# 7. airbnb æ¨èçš„è§„èŒƒ

https://github.com/airbnb/javascript

# 8. ç»„ä»¶åŒ–

## 8.1. ç¤¾åŒºå¼€æºç»„ä»¶

- react-hook-form è¡¨å• - https://github.com/react-hook-form/react-hook-form
- react-beautiful-dnd æ‹–æ‹½
- https://github.com/vercel/swr è¿œç¨‹æ•°æ®è·å– remote data fetching

## 8.2. Web Components

http://www.ruanyifeng.com/blog/2019/08/web_components.html

TODO


## 8.3. ç»„ä»¶è®¾è®¡åŸåˆ™

props (å¤–éƒ¨ä¼ å…¥) + state (å†…éƒ¨ç»´æŠ¤) = View

Ract ç»„ä»¶ä¸€èˆ¬ä¸æä¾›æ–¹æ³•, ä¸åŒçš„ props å’Œ state ä¼šäº§ç”Ÿ ä¸åŒçš„ view, ç›¸å½“äºä¸€ä¸ª pure function.

åˆ›ä¸€ä¸ªç»„ä»¶è€ƒè™‘ä¸‰ç‚¹:

-   é™æ€ ui
-   çŠ¶æ€ç»„æˆ, å†…éƒ¨ç»´æŠ¤
-   ç”±å“ªäº›äº¤äº’æ–¹å¼

éµå¾ªçš„åŸåˆ™:

-   è‡ªå®šä¹‰ç»„ä»¶åå¤§å†™å­—æ¯å¼€å¤´ (react é»˜è®¤ å¤§å†™ä¸ºè‡ªå®šä¹‰, å°å†™ä¸ºåŸç”Ÿ dom èŠ‚ç‚¹å¦‚ div), å¦å¤– jsx æ”¯æŒåç§°çš„å±æ€§è¯­æ³•, å¦‚ `<menu.Item />`

-   ç»„ä»¶åº”è¯¥è¶³å¤Ÿå°, åªåšä¸€ä»¶äº‹ (è¿™æ˜¯ä¸ºäº†æ€§èƒ½è€ƒè™‘, æ‹†åˆ†æˆå°ç»„ä»¶å, å„ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±çš„ state, å˜åŒ–æ—¶åªä¼šè‡ªå·±åˆ·æ–°, ä¸ä¼šä½¿å¾—æ•´ä¸ªæ‹¼æˆçš„å¤§ç»„ä»¶åˆ·æ–°)

-   state èƒ½ä¸è¦å°±ä¸è¦, èƒ½é€šè¿‡è®¡ç®—å¾—åˆ°çš„çŠ¶æ€å°±ä¸è¦ç‰¹åœ°å­˜å‚¨åˆ° state, å°½é‡æ‰€æœ‰æ•°æ®éƒ½é€šè¿‡ props è·å–, ä¹Ÿå°±æ˜¯ functional component ä¼˜äº state component (æ€§èƒ½å¥½, æ˜“äºé‡ç”¨)

## 8.4. å¸¦çŠ¶æ€ç»„ä»¶ çº¯å‡½æ•°ç»„ä»¶ 

ä¸¤ç§å†™æ³• âœ:

ES6 è¯­æ³•(å¯ä»¥è¿›è¡Œæ¯”è¾ƒå¤æ‚çš„æ“ä½œå’Œç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ§åˆ¶ï¼Œç›¸å¯¹äº Functional components è€—è´¹èµ„æº)

```js
//  æ³¨æ„ç»„ä»¶å¼€å¤´ç¬¬ä¸€ä¸ªå­—æ¯éƒ½è¦å¤§å†™
class MyComponent extends React.Component {

    // ES6 Class ä¸­ render() æ˜¯å”¯ä¸€å¿…è¦çš„æ–¹æ³•ï¼ˆä½†è¦æ³¨æ„çš„æ˜¯è¯·ä¿æŒ render() çš„çº¯ç²¹ï¼Œä¸è¦åœ¨é‡Œé¢è¿›è¡Œ state ä¿®æ”¹æˆ–æ˜¯ä½¿ç”¨éåŒæ­¥æ–¹æ³•å’Œæµè§ˆå™¨äº’åŠ¨ï¼Œè‹¥éœ€éåŒæ­¥äº’åŠ¨è¯·äº componentDidMount() æ“ä½œï¼‰
    render() {
        return <div>Hello, World!</div>;
    }
}

// å°† <MyComponent /> ç»„ä»¶æ’å…¥ id ä¸º app çš„ DOM å…ƒç´ ä¸­
ReactDOM.render(<MyComponent />, document.getElementById("app"));
```

ä½¿ç”¨ Functional Component å†™æ³•ï¼ˆå•çº¯åœ° render UI çš„ stateless componentsï¼Œæ²¡æœ‰å†…éƒ¨çŠ¶æ€ã€æ²¡æœ‰ refï¼Œæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚è‹¥ééœ€è¦æ§åˆ¶ç”Ÿå‘½å‘¨æœŸçš„è¯å»ºè®®å¤šä½¿ç”¨ stateless components è·å¾—æ¯”è¾ƒå¥½çš„æ€§èƒ½ï¼‰

```js
// ä½¿ç”¨ arrow function æ¥è®¾è®¡ Functional Component è®© UI è®¾è®¡æ›´å•çº¯ï¼ˆf(D) => UIï¼‰ï¼Œå‡å°‘å‰¯ä½œç”¨ï¼ˆside effectï¼‰
const MyComponent = props => <div>Hello, World!</div>;

// å°† <MyComponent /> ç»„ä»¶æ’å…¥ id ä¸º app çš„ DOM å…ƒç´ ä¸­
ReactDOM.render(<MyComponent />, document.getElementById("app"));
```

## 8.5. å‡½æ•°ç»‘å®šæ–¹å¼

react ä¸­ç”±äºç±»çš„æ–¹æ³•é»˜è®¤ä¸ä¼šç»‘å®šthisï¼Œå› æ­¤åœ¨è°ƒç”¨çš„æ—¶å€™å¦‚æœå¿˜è®°ç»‘å®šï¼Œthisçš„å€¼å°†ä¼šæ˜¯undefined

```jsx
// çº¯å‡½æ•°ç»„ä»¶

const Edit = props => {
    const onFinish = (values) => {
        console.log('Received values of form: ', values);
    };

    return (
        <Form
            onFinish={onFinish}
        />
    );
}
```

```jsx
// class ç»„ä»¶

// æ¨è
import React, { Component } from 'react';
class App extends Component {
  handleSubmit (e, args) {
    console.log(e, args)
  }

  render () {
      // æˆ–è€…åœ¨æ„é€ å‡½æ•°ä¸­ bind
      // å¦‚ this.handleClick = this.handleClick.bind(this);
    return (
      <div onClick={this.handleSubmit.bind(this, 'test')}>test</div>
    )
  }
}

// or

class App extends Component {
  handleSubmit = (e) => {
     console.log(e);
  }

  render () {
    return (
      <div onClick={this.handleSubmit}>test</div>
    )
  }
}

//or

class App extends Component {
  handleSubmit (e) {
     console.log(e);
  }
  render () {
    return (
      <div onClick={ () => this.handleSubmit }>test</div>
    )
  }
}
```

## 8.6. hooks

https://reactjs.org/docs/hooks-reference.html

https://www.ruanyifeng.com/blog/2019/09/react-hooks.html

https://juejin.cn/post/6844903854174109703 å¾ªåºæ¸è¿›ä»‹ç» hooks, è§£å†³ä»€ä¹ˆé—®é¢˜

### 8.6.1. create react app é…åˆ eslint-plugin-react-hooks

https://blog.csdn.net/zqd666/article/details/102961701
https://www.npmjs.com/package/eslint-plugin-react-hooks?ref=hackernoon.com

### 8.6.2. hooks åŸç†

https://github.com/brickspert/blog/issues/26

### 8.6.3. æœ€ä½³å®è·µ

https://zhuanlan.zhihu.com/p/98554943
https://www.zhihu.com/search?type=content&q=react%20hooks%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5

### 8.6.4. ä¸ºä»€ä¹ˆéœ€è¦ hooks

https://www.javascriptc.com/2530.html

çº¯å‡½æ•°ï¼Œä¸èƒ½åŒ…å«çŠ¶æ€ï¼Œä¹Ÿä¸æ”¯æŒç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå› æ­¤æ— æ³•å–ä»£ç±»çš„å†™æ³•, React Hooks çš„è®¾è®¡ç›®çš„ï¼Œå°±æ˜¯åŠ å¼ºç‰ˆå‡½æ•°ç»„ä»¶ï¼Œå®Œå…¨ä¸ä½¿ç”¨"ç±»"ï¼Œå°±èƒ½å†™å‡ºä¸€ä¸ªå…¨åŠŸèƒ½çš„ç»„ä»¶

React Hooks çš„æ„æ€æ˜¯ï¼Œç»„ä»¶å°½é‡å†™æˆçº¯å‡½æ•°ï¼Œå¤–éƒ¨åŠŸèƒ½å’Œå‰¯ä½œç”¨æ”¾åœ¨é’©å­ä¸­ã€‚ React Hooks å°±æ˜¯é‚£äº›é’©å­.éœ€è¦ä»€ä¹ˆåŠŸèƒ½ï¼Œå°±ä½¿ç”¨ä»€ä¹ˆé’©å­ã€‚React é»˜è®¤æä¾›äº†ä¸€äº›å¸¸ç”¨é’©å­. é’©å­ä¸€å¾‹ä½¿ç”¨useå‰ç¼€å‘½åï¼Œä¾¿äºè¯†åˆ«

hooks è§£å†³äº†å‡ ä¸ªé—®é¢˜:

- å®¹æ˜“å¯¹ state æ“ä½œé€»è¾‘è¿›è¡Œå¤ç”¨
- ä»¥å‰åˆ†å¸ƒåœ¨å‘¨æœŸå‡½æ•°ä¸­çš„æ“ä½œé›†ä¸­åˆ°äº†ä¸€ä¸ªåœ°æ–¹ (useEffect ä¸­)
- å±è”½äº† this

```js
å››ä¸ªæœ€å¸¸ç”¨é’©å­:

useState()
ä¸ºå‡½æ•°ç»„ä»¶å¼•å…¥çŠ¶æ€ï¼ˆstateï¼‰

useContext() åœ¨ç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€, ä¸å¿…ä¸ºäº†å‚æ•°ä¼ é€’è¿›è¡Œå¤æ‚åµŒå¥—, å‡å°‘ç»„ä»¶å±‚çº§

useReducer() ä¸ºå‡½æ•°ç»„ä»¶å¼•å…¥ action

useEffect() å¼•å…¥å…·æœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼Œæœ€å¸¸è§çš„å°±æ˜¯å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®

useLayoutEffect() åŒæ­¥æ‰§è¡Œå‰¯ä½œç”¨

useCallback() è®°å¿†å‡½æ•°
useMemo() è®°å¿†ç»„ä»¶
å¯ä»¥å®Œå…¨æ›¿ä»£ useCallback çš„åŠŸèƒ½ 
useCallback(fn, inputs) is equivalent to useMemo(() => fn, inputs).


useImperativeHandle() ç»„ä»¶å¯ä»¥è·å¾—å­ç»„ä»¶çš„ input çš„ DOM èŠ‚ç‚¹

```

ç”±äº Hooks å¯ä»¥æä¾›å…±äº«çŠ¶æ€å’Œ Reducer å‡½æ•°ï¼Œæ‰€ä»¥å®ƒåœ¨è¿™äº›æ–¹é¢å¯ä»¥å–ä»£ Reduxã€‚ä½†æ˜¯ï¼Œå®ƒæ²¡æ³•æä¾›ä¸­é—´ä»¶ï¼ˆmiddlewareï¼‰å’Œæ—¶é—´æ—…è¡Œï¼ˆtime travelï¼‰ï¼Œå¦‚æœä½ éœ€è¦è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œè¿˜æ˜¯è¦ç”¨ Redux

### 8.6.5. useRef

use to create a reference to refer to some object else;

useRef ä»…èƒ½ç”¨åœ¨ FunctionComponentï¼Œ(æ˜¾ç„¶çš„ï¼Œå› ä¸º Hooks ä¸èƒ½ç”¨åœ¨ ClassComponent), somehow equal to â€œthisâ€; é¿å…åœ¨ Render å‡½æ•°ä¸­ç›´æ¥ä¿®æ”¹ Ref, æœ€å¥½æ”¾åœ¨æŸä¸ªå‡½æ•°ä¸­ä¿®æ”¹

createRef ä»…èƒ½ç”¨åœ¨ ClassComponentã€‚(cuz: createRef å¹¶æ²¡æœ‰ Hooks çš„æ•ˆæœï¼Œå…¶å€¼ä¼šéšç€ FunctionComponent é‡å¤æ‰§è¡Œè€Œä¸æ–­è¢«åˆå§‹åŒ–ï¼š)  createRef æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¼•ç”¨ï¼Œè€Œ useRef æ¯æ¬¡éƒ½ä¼šè¿”å›ç›¸åŒçš„å¼•ç”¨

```js
//ä½œä¸ºå®¹å™¨
export default () => {
  const refInput = useRef();
  return (
    <div>
      <input ref={refInput} />
      <button
        onClick={() => {
          refInput.current.focus();
        }}
      >
        focus
      </button>
    </div>
  );
};
```

cache prev value: (can be inproved by useEffect, see blow)

```js
export default () => {
  const [count, setCount] = useState(0);
  // åœ¨ä¸¤æ¬¡ä¸åŒçš„æ¸²æŸ“é—´ä¼ é€’å€¼
  // ç›¸å½“äº ç±»å±æ€§å˜é‡
  const prev = useRef(null);
  return (
    <div>
      <p>current: {count}</p>
      <p>prev: {prev.current}</p>
      <button
        onClick={() => {
          prev.current = count;
          setCount(count + 1);
        }}
      >
        +
      </button>
      <button
        onClick={() => {
          prev.current = count;
          setCount(count - 1);
        }}
      >
        -
      </button>
    </div>
  );
};
```


### 8.6.6. useMemo and memo and useCallback

https://github.com/puxiao/react-hook-tutorial

éƒ½æ˜¯ç”¨æ¥æå‡æ€§èƒ½. å¯ä»¥é˜²æ­¢ç»´æŠ¤çš„å¯¹è±¡é‡å¤åˆ›å»º



- memo() å†³å®šä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“æ˜¯å¦é‡å¤æ‰§è¡Œ `memo(XxxComponent [, isPropsUpdate()])`

  - ç”¨æ¥åŒ…è£…ä¸€ä¸ªç»„ä»¶; euqals to å‡½æ•°å¼ç»„ä»¶ä¸­çš„  , PureComponentç¬¬äºŒä¸ªå‚æ•°å¯é€‰ä¼ é€’ä¸€ä¸ªæ¯”è¾ƒå‡½æ•° `(prevProps, nextProps) => {...return false/true}` (å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸ä¼ é€’ï¼Œåˆ™é»˜è®¤åªä¼šè¿›è¡Œ props çš„æµ…æ¯”è¾ƒã€‚)

    PureComponent: é€šè¿‡æµ…å±‚æ¯”è¾ƒ props, å†³å®šæ˜¯å¦é‡æ–°æ¸²æŸ“; ä¹Ÿå°±æ˜¯è¯´, ä¼˜åŒ–åªå¯¹äº æµ…å±‚å±æ€§å˜åŒ–æœ‰æ•ˆ; ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ shouldComponentUpdate() è¿›è¡Œæ·±å±‚æ¯”è¾ƒ

- useMemo  æ§åˆ¶ä¸€æ®µå‡½æ•°é€»è¾‘æ˜¯å¦é‡å¤æ‰§è¡Œ;`usememo(func, [deps])` æ¥å—ä¸€ä¸ªå‡½æ•°, å’Œä¸€ä¸ªæ•°ç»„(ä¾èµ–)ï¼Œæ¯æ¬¡ rerender, ä¾èµ–æ˜¯å¦å˜åŒ–å†³å®šäº†å‡½æ•°é€»è¾‘æ˜¯å¦é‡å¤æ‰§è¡Œ, è‹¥ä¸ºç©ºæ•°ç»„åˆ™ä»…ä»…æ‰§è¡Œä¸€æ¬¡

  - å‡½æ•°ä»ç„¶å¯ä»¥è¿”å› ç»„ä»¶, å°±æ˜¯è¯´ç›¸æ¯” memo() ä¼˜åŒ–ç²’åº¦æ›´ç»† (memo åªèƒ½åŒ…è£…æ•´ä¸ªç»„ä»¶, useMemo å¯ä»¥åªåŒ…è£…ç»„ä»¶ä¸­çš„æŸæ®µå‡½æ•°é€»è¾‘)

  - useMemo ç±»ä¼¼ useEffect, åŒºåˆ«æ˜¯ effect æ˜¯ render åæ‰§è¡Œï¼Œ useMemo æ˜¯ render å‰/æœŸé—´æ‰§è¡Œ, ä¹‹åæ˜¯å¦é‡å¤æ‰§è¡Œ, çœ‹ä¾èµ–æ˜¯å¦å˜åŒ–

  - usememo æœ¬èº«ä¹Ÿæœ‰å¼€é”€, æ‰€ä»¥ä½¿ç”¨ useMemo è€ƒè™‘: ä¼ é€’ç»™ useMemo çš„å‡½æ•°å¼€é”€å¤§ä¸å¤§? å¦‚æœå¤§æ‰ç”¨, 

  - æ¨èä½¿ç”¨ React.useMemo è€Œä¸æ˜¯ React.memoï¼Œå› ä¸ºåœ¨ç»„ä»¶é€šä¿¡æ—¶å­˜åœ¨ React.useContext çš„ç”¨æ³•ï¼Œè¿™ç§ç”¨æ³•ä¼šä½¿æ‰€æœ‰ç”¨åˆ°çš„ç»„ä»¶é‡æ¸²æŸ“ï¼Œåªæœ‰ React.useMemo èƒ½å¤„ç†è¿™ç§åœºæ™¯çš„æŒ‰éœ€æ¸²æŸ“ã€‚

- useCallback ç”¨æ¥åŒ…è£…ä¸€ä¸ªå‡½æ•°, æ¯æ¬¡é‡æ¸²æŸ“éƒ½æ–°åˆ›å»ºè¿™ä¸ªå‡½æ•°çš„å®ä¾‹

  - è‹¥ useMemo å†…çš„å‡½æ•°è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œ é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ useCallbackç›´æ¥ä¼ å…¥è¿™ä¸ªå‡½æ•° å³ useMemo(() => fn) ç­‰ä»· useCallback(fn)

  - æ‰€æœ‰ Function Component å†…å‡½æ•°å¿…é¡»ç”¨ React.useCallback åŒ…è£¹ï¼Œä»¥ä¿è¯å‡†ç¡®æ€§ä¸æ€§èƒ½ (å¸¸ç”¨æ¥ å°† å‡½æ•°ä» useEffect ä¸­æŠ½ç¦»åˆ°å¤–éƒ¨, ä¾¿äºäººçœ¼ç»´æŠ¤, è‹¥å¸Œæœ›è¿›ä¸€æ­¥å°†å‡½æ•°æŠ½åˆ°ç»„ä»¶å¤–éƒ¨, éœ€è¦çµæ´»è¿ç”¨è‡ªå®šä¹‰ Hooks å®ç°)

```js
const Demo = memo((props) => {
  console.log("demo render");
  return (
    <div>
      {props.name}, {props.person.age}
    </div>
  );
});

export default () => {
  const [count, setCount] = useState(0);
  const [person, setPerson] = useState({
    age: 11
  });
  return (
    <div>
      <span
        onClick={() => {
          setCount(count + 1);// å¦‚æœä»…ä»…æ˜¯ count æ”¹å˜, Demo ä¸ä¼šrerender
          setPerson({// å¦‚æœpersonä¹Ÿæ”¹å˜, demo ä¼šrerender
            ...person,
            age: person.age + 1
          });
        }}
      >
        {count}
      </span>
      <Demo name="demo" person={person} />
    </div>
  );
};

```


```js
/**
 * 
 */
export default () => {
  const [count, setCount] = useState(0);
  const memorizedText = useMemo(() => {
    console.log(`run memo func`);
    return `memo: ${Date.now()}`;
  }, [Math.floor(count / 10)]); // æ¯ç‚¹å‡» 10 æ¬¡å˜åŒ–ä¸€æ¬¡

  return (
    <div>
      {memorizedText}
      <p>count: {count}</p>
      <button
        onClick={() => {
          setCount(count + 1);
        }}
      >
        +
      </button>
      <button
        onClick={() => {
          setCount(count - 1);
        }}
      >
        -
      </button>
    </div>
  );
};

```


### 8.6.7. useState

#### 8.6.7.1. state ç‰¹æ€§

æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Props å’Œ State
æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°
å½“ç‚¹å‡»æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼Œå‡½æ•°ç»„ä»¶éƒ½ä¼šé‡æ–°è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆæ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå–åˆ°çš„å€¼ä¸ä¼šå—åé¢æ“ä½œçš„å½±å“

Hook å†…éƒ¨ä½¿ç”¨ Object.is æ¥æ¯”è¾ƒæ–°æ—§ state æ˜¯å¦ç›¸ç­‰
ä¸ class ç»„ä»¶ä¸­çš„ setState æ–¹æ³•ä¸åŒï¼Œå¦‚æœä½ ä¿®æ”¹çŠ¶æ€çš„æ—¶å€™ï¼Œä¼ çš„çŠ¶æ€å€¼æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸é‡æ–°æ¸²æŸ“;
useState ä¸ä¼šè‡ªåŠ¨åˆå¹¶æ›´æ–°å¯¹è±¡, äºŒæ˜¯æ›¿æ¢

#### 8.6.7.2. ä¼ ç»Ÿå†™æ³•

(ç”±äºå¸¦æœ‰ çŠ¶æ€, æ‰€ä»¥å¿…é¡»ä½¿ç”¨ ç±» çš„å†™æ³•)


```js
class Button extends React.Component {
  constructor() {
    super();
    this.state = {
      content: "click me"
    };
    this.handleClick = this.handleClick.bind(this);
  }

  handleClick() {
    this.setState({
      content: "hello btn ~~"
    });
  }

  render() {
    return <button onClick={this.handleClick}>{this.state.content}</button>;
  }
}
```

#### 8.6.7.3. ä½¿ç”¨ functional ç»„ä»¶çš„å†™æ³•

```js
import React, { useState } from "react";

const ButtonHooks = () => {
  // è¯­æ³•:
  // å‚æ•°ä¸º æŸä¸ª state å±æ€§åˆå§‹å€¼
  // è¿”å›å€¼ä¸ºæ•°ç»„, 
  //[0] ä¸º å±æ€§å˜é‡, 
  //[1] ä¸ºå¯¹åº”çš„ setter æ–¹æ³•, çº¦å®šæ˜¯setå‰ç¼€åŠ ä¸ŠçŠ¶æ€çš„å˜é‡å; è‹¥ new state å’Œ old stateæœ‰å…³è”, æ¨è setXXX((old) => {return new})
  // æ¯ç”¨ä¸€æ¬¡ useState , å°±å¯ä»¥ä¸ºä¸€ä¸ª state å±æ€§ åˆ›å»º getter, setter, é¡ºåºå¾ˆé‡è¦, ä¸å¯æ”¹å˜(å³æ— æ³•æ”¾åœ¨æ¡ä»¶åˆ¤æ–­å†…)
  const [content, setContent] = useState("click me");

  const handleClick = () => {
    return setContent("hello hah~~");
  };
  return <button onClick={handleClick}>{content}</button>;
};

export default ButtonHooks;

```

#### 8.6.7.4. å»¶è¿Ÿåˆå§‹åŒ–

initialState å‚æ•°åªä¼šåœ¨ç»„ä»¶çš„åˆå§‹åŒ–æ¸²æŸ“ä¸­èµ·ä½œç”¨ï¼Œåç»­æ¸²æŸ“æ—¶ä¼šè¢«å¿½ç•¥, ä¼ å…¥æœ‰ä¸ªå‡½æ•°, åªä¼šåœ¨åˆå§‹æ¸²æŸ“æ—¶æ‰§è¡Œä¸€æ¬¡, åç»­ä¸å†æ‰§è¡Œ

```js
export default (props) => {
  const [count, setCount] = useState(0);

  const [age, setAge] = useState(() => {
    console.log("å»¶è¿Ÿåˆå§‹åŒ–, åˆå§‹åŒ–æ—¶, å³ä½¿ç”¨çš„æ—¶å€™æ‰æ‰§è¡Œè®¡ç®—ï¼Œ åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œ æé«˜æ•ˆç‡");
    return props.defaultAge || 0;
  });

  return (
    <div className="App">
      count: {count}, age: {age}
      <button onClick={() => setCount((count) => count + 1)}>Add</button>
    </div>
  );
};


```

#### 8.6.7.5. æ–°æ—§ state æœ‰å…³è”

å¦‚æœæ–°çš„ state éœ€è¦é€šè¿‡ä½¿ç”¨å…ˆå‰çš„ state è®¡ç®—å¾—å‡ºï¼Œé‚£ä¹ˆå¯ä»¥å°†å›è°ƒå‡½æ•°å½“åšå‚æ•°ä¼ é€’ç»™ setStateã€‚è¯¥å›è°ƒå‡½æ•°å°†æ¥æ”¶å…ˆå‰çš„ stateï¼Œå¹¶è¿”å›ä¸€ä¸ªæ›´æ–°åçš„å€¼


### 8.6.8. useContext

ç±»ä¼¼ redux ä½œç”¨, ä½†æ˜¯ redux æ›´å¼ºå¤§, 

useReducerå’ŒuseContextçš„ç»“åˆå¯ä»¥å–ä»£Reduxä¹ˆï¼Ÿ

- useContextçš„é—®é¢˜æ˜¯å¦‚æœæ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ•´ä¸ªå­æ ‘éƒ½ä¼šé‡æ–°æ¸²æŸ“ï¼Œæ€§èƒ½å¯èƒ½ä¼šæœ‰é—®é¢˜
- ä½¿ç”¨useContextä½ åªèƒ½åœ¨ç»„ä»¶å±‚å†™æ›´æ”¹çŠ¶æ€çš„é€»è¾‘ï¼Œä½†æ˜¯æœ‰çš„é€»è¾‘æ˜¯å…¨å±€çš„ï¼Œåº”è¯¥å†™åˆ°ä¸€ä¸ªå•ç‹¬çš„jsæ–‡ä»¶è€Œä¸æ˜¯ç»„ä»¶æ–‡ä»¶é‡Œï¼Œè€Œè¦å¯¼å‡ºçš„è¯å°±å¿…é¡»è‡ªå·±å°è£…ï¼Œè¿˜ä¸å¦‚ç”¨Redux
- Reduxæœ‰thunkå’Œsagaä¹‹ç±»çš„ä¸­é—´ä»¶æ”¯æŒasync actionï¼Œè€ŒuseReduceræ²¡æœ‰ï¼Œè¿˜å¾—ç”¨å…¶ä»–åº“ã€‚

```js
import React, { useContext } from "react";
import ReactDOM from "react-dom";
import "./styles.css";

const AppContext = React.createContext({});
// React.createContext<AuthContextI>(null!) ä¹Ÿå¯ä»¥ä½¿ç”¨ null! , å°±ä¸éœ€è¦åˆå§‹åŒ–å€¼äº†

// è¯­æ³•:
    // å‚æ•°ä¸º react.context å˜é‡
    // è¿”å› context ä¸­å­˜å‚¨çš„å†…å®¹, æœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥æŒ‡å®šå­˜å‚¨çš„å†…å®¹
    // - AppContext = React.createContext({}) // åˆå§‹åŒ–
    // - <AppContext.Provider value={{}} ... // æŒ‡å®šå…·ä½“å€¼
function App() {
  return (
    //   AppContext.Provideræä¾›äº†ä¸€ä¸ª Context å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥è¢«å­ç»„ä»¶å…±äº«
    <AppContext.Provider value={{
      username: 'superawesome'
    }}>
      <div className="App">
        <Navbar />
        <Messages />
      </div>
    </AppContext.Provider>
  );
}

const Navbar = () => {
  const { username } = useContext(AppContext)

  return (
    <div className="navbar">
      <p>AwesomeSite</p>
      <p>{username}</p>
    </div>
  )
}

const Messages = () => {
  const { username } = useContext(AppContext)

  return (
    <div className="messages">
      <h1>Messages</h1>
      <p>1 message for {username}</p>
      <p className="message">useContext is awesome!</p>
    </div>
  )
}

const rootElement = document.getElementById("root");
ReactDOM.render(<App />, rootElement);


```

æ”¹å˜é¢œè‰²ä¸»é¢˜ demo:

```js
const themes = {
  light: {
    fore: "#000000",
    back: "#eeeeee"
  },
  dark: {
    fore: "#ffffff",
    back: "#222222"
  }
};

const ThemeContext = createContext({
  theme: themes.light,
  toggle: () => {}
});

export default () => {
  const [theme, setTheme] = useState(themes.light);
  return (
    // å¤šä¸ª context åµŒå¥—å³å¯ï¼Œ é¡ºåºä¸é‡è¦
    <ThemeContext.Provider
      value={{
        theme,
        toggle: () => {
          setTheme((theme) => {
            setTheme(theme === theme.light ? themes.dark : themes.light);
          });
        }
      }}
    >
      <ToolBar />
    </ThemeContext.Provider>
  );
};

const ToolBar = () => {
  return <ThemedButton />;
};

const ThemedButton = () => {
  const context = useContext(ThemeContext);
  return (
    <button
      style={{
        color: context.theme.fore,
        backgroundColor: context.theme.back
      }}
      onClick={() => {
        context.toggle();
      }}
    >
      click
    </button>
  );
};
```

### 8.6.9. useReducer

ç”¨äºç®¡ç†å¤æ‚çš„ state å˜åŒ–, å½“ state å¤šåˆ° useState éš¾ä»¥åº”ä»˜, å°±å¯ä»¥ä½¿ç”¨ useReducer

å±€éƒ¨çŠ¶æ€ä¸æ¨èä½¿ç”¨ useReducer ï¼Œä¼šå¯¼è‡´å‡½æ•°å†…éƒ¨çŠ¶æ€è¿‡äºå¤æ‚ï¼Œéš¾ä»¥é˜…è¯»ã€‚ useReducer å»ºè®®åœ¨å¤šç»„ä»¶é—´é€šä¿¡æ—¶ï¼Œç»“åˆ useContext ä¸€èµ·ä½¿ç”¨

```js
import React, { useReducer } from "react";

// reducer è´Ÿè´£æ ¹æ® state å’Œ action è®¡ç®—å‡ºæ–°çš„ state
const btnReducer = (state, action) => {
  let result;

  switch (action.type) {
    case "countUp":
      result = {
        ...state,
        count: state.count + 1
      };
      break;

    default:
      // result = state;
      // break;
      throw new Error("xxx")
  }
  return result;
};

const ActionDemo = () => {
    // å‚æ•° 1: reducer
    // å‚æ•° 2: initState 
    // å‚æ•° 3: init, å¯é€‰, å¯¹ initState åšåŠ å·¥åä¼ å…¥ useReducer
    // è¿”å›å€¼: [å½“å‰çŠ¶æ€, dispatch å‡½æ•°], åè€…æ˜¯å‡½æ•°,ä¿è¯ä¸å¯å˜
  const [state, dispatch] = useReducer(btnReducer, {
    count: 0
  });
  return (
    <div>
      <button
        style={{
          padding: "5px 20px",
          marginTop: "10px",
          marginBottom: "10px",
          color: "#fff",
          backgroundColor: "#0066cc",
          borderRadius: "15px",
          border: "1px solid #fff"
        }}
        // dispatcher è´Ÿè´£å‘å‡º action, 
        onClick={() => dispatch({ type: "countUp" })}
      >
        up
      </button>
      <p>count: {state.count}</p>
    </div>
  );
};

export default ActionDemo;


```

### 8.6.10. useEffect

#### 8.6.10.1. effect ç†è§£

effectï¼ˆå‰¯ä½œç”¨ï¼‰ï¼šæŒ‡é‚£äº›æ²¡æœ‰å‘ç”Ÿåœ¨æ•°æ®å‘è§†å›¾è½¬æ¢è¿‡ç¨‹ä¸­çš„é€»è¾‘ï¼Œå¦‚ ajax è¯·æ±‚ã€è®¿é—®åŸç”Ÿdom å…ƒç´ ã€æœ¬åœ°æŒä¹…åŒ–ç¼“å­˜ã€ç»‘å®š/è§£ç»‘äº‹ä»¶ã€æ·»åŠ è®¢é˜…ã€è®¾ç½®å®šæ—¶å™¨ã€è®°å½•æ—¥å¿—ç­‰ã€‚

å‰¯ä½œç”¨æ“ä½œå¯ä»¥åˆ†ä¸¤ç±»ï¼šéœ€è¦æ¸…é™¤çš„å’Œä¸éœ€è¦æ¸…é™¤çš„

useEffect æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨ç»„ä»¶æ¸²æŸ“åˆ°å±å¹•ä¹‹åæ‰æ‰§è¡Œï¼Œè¯¥å‡½æ•°æœ‰è¦æ±‚ï¼šè¦ä¹ˆè¿”å›ä¸€ä¸ªèƒ½æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¦ä¹ˆå°±ä¸è¿”å›ä»»ä½•å†…å®¹; å®ƒè·Ÿ class ç»„ä»¶ä¸­çš„ componentDidMountã€  componentDidUpdate å’Œ componentWillUnmount å…·æœ‰ç›¸åŒçš„ç”¨é€”ï¼Œåªä¸è¿‡è¢«åˆå¹¶æˆäº†ä¸€ä¸ª API

ä¸ componentDidMount æˆ– componentDidUpdate ä¸åŒï¼Œä½¿ç”¨ useEffect è°ƒåº¦çš„ effect ä¸ä¼šé˜»å¡æµè§ˆå™¨æ›´æ–°å±å¹•ï¼Œè¿™è®©ä½ çš„åº”ç”¨çœ‹èµ·æ¥å“åº”æ›´å¿«ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œeffect ä¸éœ€è¦åŒæ­¥åœ°æ‰§è¡Œã€‚åœ¨ä¸ªåˆ«æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚æµ‹é‡å¸ƒå±€ï¼‰ï¼Œæœ‰å•ç‹¬çš„ useLayoutEffect Hook ä¾›ä½ ä½¿ç”¨ï¼Œå…¶ API ä¸ useEffect ç›¸åŒ
  

#### 8.6.10.2. effect åŸºæœ¬ä½¿ç”¨

```js
export default function App() {
  const [count, setCount] = useState(0);

  useEffect(() => {// ç›¸å½“äº componentDidMount
    console.log(`count: ${count}`);
  }, [count]);// ä¾èµ– count æ˜¯å¦å˜åŒ–, [] åˆ™æ²¡æœ‰ä¾èµ–, åªåœ¨ render åæ‰§è¡Œä¸€æ¬¡; ä¸å¸¦è¿™ä¸ªå‚æ•°, åˆ™æ¯æ¬¡ render åéƒ½æ‰§è¡Œ

  return (
    <div className="App">
      count: {count}
      <button onClick={() => setCount((count) => count + 1)}>Add</button>
    </div>
  );
}
```

#### 8.6.10.3. ç¼“å­˜ä¸Šæ¬¡å€¼

useEffect åœ¨ Render å®Œæ¯•åæ‰æ‰§è¡Œ

```js
// å°è£…äº†ä¸€ä¸ªç®€å•çš„ Hooks æ‹¿åˆ°ä¸Šä¸€æ¬¡çš„å€¼
function usePrevious(value) {
  const ref = useRef();
  useEffect(() => {
    ref.current = value;//useEffect åœ¨ Render å®Œæ¯•åæ‰æ‰§è¡Œ, therefore ref çš„å€¼åœ¨å½“å‰ Render ä¸­æ°¸è¿œæ˜¯ä¸Šä¸€æ¬¡ Render æ—¶å€™çš„
  });
  return ref.current;
}


```

#### 8.6.10.4. è®¾ç½®é”€æ¯å›è°ƒå‡½æ•°ä¾‹å­

åªæœ‰ä¸€ä¸ªå‚æ•°çš„ä¾‹å­:

```js
import React, { useState, useEffect } from "react";
let timer = null;
function App() {
  const [count, setCount] = useState(0);
  //ä¸€æ—¦ count å€¼å‘ç”Ÿæ”¹å˜ï¼Œåˆ™ä¿®æ”¹ documen.title å€¼
  useEffect(() => {
    document.title = "componentDidMount" + count;
  },[count]);

//æ•°ç»„æ²¡æœ‰ä¼ å€¼ï¼Œä»£è¡¨ä¸ç›‘å¬ä»»ä½•å‚æ•°å˜åŒ–ï¼Œå³åªæœ‰åœ¨ç»„ä»¶åˆå§‹åŒ–æˆ–é”€æ¯çš„æ—¶å€™æ‰ä¼šè§¦å‘ï¼Œç”¨æ¥ä»£æ›¿ componentDidMount å’Œ componentWillUnmount
  useEffect(() => {
    timer = setInterval(() => {
      setCount(prevCount => prevCount + 1);
    }, 1000);
    // è¿”å›å€¼(å¦‚æœæœ‰)åˆ™åœ¨ç»„ä»¶é”€æ¯å‰è°ƒç”¨, è‹¥ä¾èµ–æ•°ç»„ä¸­å­˜åœ¨ä¾èµ–, åˆ™è¿”å›çš„å›è°ƒå‡½æ•°åœ¨ ä¸Šæ¬¡ useEffect å¤„ç†å®Œå æ—¶æ‰§è¡Œ
    return () => {
      document.title = "componentWillUnmount";
      clearInterval(timer);
    };
  }, []);
  
  return (
    <div>
      Count: {count}
      <button onClick={() => clearInterval(timer)}>clear</button>
    </div>
  );
}

```

#### 8.6.10.5. å‘é€å¼‚æ­¥è¯·æ±‚

```js
export default () => {
  const personList = usePerson();
  if (personList === null) {
    return <div>pending...</div>;
  }
  return (
    <div>
      {personList.map((person) => (
        <li key={person}>{person}</li>
      ))}
    </div>
  );
};

async function getPersonList() {
  await new Promise((resolve) => {
    setTimeout(() => {
      resolve();
    }, 200);
  });
  return ["aa", "bb", "cc"];
}

const usePerson = () => {
  const [personList, setPersonList] = useState(null);
  
  //useEffect æ¥æ”¶çš„å‡½æ•°ï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ªèƒ½æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¦ä¹ˆå°±ä¸è¿”å›ä»»ä½•å†…å®¹ã€‚è€Œ async è¿”å›çš„æ˜¯ promiseã€‚
  useEffect(() => {
    async function req() {
      const personList = await getPersonList();
      setPersonList(personList);
    }
    req();
  }, []);
  return personList;
};

```

#### 8.6.10.6. ä½¿ç”¨ fetch api

```js
å¦‚ä½•åœ¨ Hooks ä¸­ä¼˜é›…çš„ Fetch Data
function App() {
  const [data, setData] = useState({ hits: [] });
  useEffect(() => {
    // æ›´ä¼˜é›…çš„æ–¹å¼
    const fetchData = async () => {
      const result = await axios(
        'https://api.github.com/api/v3/search?query=redux',
      );
      setData(result.data);
    };
    fetchData();
  }, []);
  return (
    <ul>
      {data.hits.map(item => (
        <li key={item.id}>
          <a href={item.url}>{item.title}</a>
        </li>
      ))}
    </ul>
  );
}


```

### 8.6.11. è‡ªå®šä¹‰ hook

è‡ªå®šä¹‰ Hookï¼Œåªè¦å‡½æ•°åéµå¾ªä»¥ use å¼€å¤´ï¼Œä¸”è¿”å›é JSX å…ƒç´ ï¼Œå°±æ˜¯è‡ªå®šä¹‰ Hooks 

#### 8.6.11.1. å¸¦æœ‰è‡ªå¢æ•ˆæœçš„ state hook

```js
export default () => {
  const [count, addCount] = useCountAdd(0);

  return (
    <div>
      count: {count}
      <button onClick={() => addCount()}>Add</button>
    </div>
  );
};

const useCountAdd = (init) => {
  const [count, setCount] = useState(init);
  return [
    count,
    () => {
      setCount((count) => count + 1);
    }
  ];
};
```

#### 8.6.11.2. ä» usehooks æ”¹é€  responseComponent

å®æ—¶æ›´æ–°çš„ response component:


```js
import React, { useState, useEffect } from "react";

const Response = ({param}) => {
    // æ ‡è¯†è¯·æ±‚æ˜¯å¦å®Œæˆ
  const [ok, setOk] = useState(false);
  // http çš„å“åº”
  const [response, setResponse] = useState({});

  // å‚æ•° 1: æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¼‚æ­¥æ“ä½œçš„ä»£ç æ”¾åœ¨é‡Œé¢
  // å‚æ•° 2: æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºç»™å‡º Effect çš„ä¾èµ–é¡¹ï¼Œåªè¦è¿™ä¸ªæ•°ç»„å‘ç”Ÿå˜åŒ–ï¼ŒuseEffect()å°±ä¼šæ‰§è¡Œã€‚
  //ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥çœç•¥ï¼Œè¿™æ—¶æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œå°±ä¼šæ‰§è¡ŒuseEffect()ã€‚
  useEffect(() => {
    fetch(`http://www.httpbin.org/anything/${param}`)
      .then(resp => resp.json())
      .then(data => {
        setResponse(data);
        setOk(true);
      });
  }, [param]);

  if (!ok) {
    return <p>Nothing...</p>;
  }

  return (
    <div>
      <p>your IP: {response.origin}</p>
      <p>request url: {response.url}</p>
    </div>
  );
};

const EffectDemo = () => {
  const [param, setParam] = useState("one");

  return (
    <div>
      <Response param={param} />
      <p>
        you can choose:
        <button onClick={() => setParam("one")}>one</button>
        <button onClick={() => setParam("two")}>two</button>
        <button onClick={() => setParam("three")}>three</button>
      </p>
    </div>
  );
};

export default EffectDemo;


```

æ”¹é€ å:

```js
import React, {useState, useEffect } from "react";

const useResponse = param => {
  const [ok, setOk] = useState(false);
  const [response, setResponse] = useState({});

  useEffect(() => {
    setOk(false);
    fetch(`http://www.httpbin.org/anything/${param}`)
      .then(resp => resp.json())
      .then(data => {
        setResponse(data);
        setOk(true);
      });
  }, [param]);
  
  return [ok, response];
};

const Response = ({param}) => {
  const [ok, response] = useResponse(param);
  if (!ok) {
    return (
      <p>Nothing...</p>
    );
  }
  return (
    <div>
      <p>your IP: {response.origin}</p>
      <p>request url: {response.url}</p>
    </div>
  );
};


```

#### 8.6.11.3. å®šæ—¶å™¨ and è‡ªåŠ¨é”€æ¯

å®šæ—¶å™¨ (éœ€è¦è®¾ç½®é”€æ¯å‡½æ•°)

```js
const useCountAdd = (init) => {
  const [count, setCount] = useState(init);
  return [
    count,
    () => {
      setCount((count) => count + 1);
    }
  ];
};

const useInterval = (callback, interval) => {
  useEffect(() => {
    const I = setInterval(callback, interval);
    return () => { // ç›¸å½“äº componentWillunmount
      clearInterval(I);
    };
  }, []);
};

export default () => {
  const [count, addCount] = useCountAdd(0);

  useInterval(() => {
    addCount();
  }, 1000);

  return (
    <div>
      count: {count}
      <button onClick={addCount}>add</button>
    </div>
  );
};
```

å®šæ—¶è‡ªåŠ¨é”€æ¯

```js
const useTimerCount = (initCount) => {
  const [count, setCount] = useState(initCount);

  const ref = useRef();
  useEffect(() => {
    ref.current = setInterval(() => {
      setCount((count) => count + 1);
    }, 1000);
  }, []);
  useEffect(() => {
    if (count > 6) {
      clearInterval(ref.current);
    }
  });

  return [count, setCount];
};

const useCounter = (count) => {
  return <div>timer count: {count}</div>;
};

export default () => {
  const [count, setCount] = useTimerCount(0);
  return useCounter(count);
};
```

### 8.6.12. ç»¼åˆä¾‹å­

#### 8.6.12.1. ç‚¹èµæŒ‰é’®

```js
import React, { useReducer, useState } from "react";
import "./styles.css";

const initState = {
  likes: 100,
  dislikes: 5
};

const appReducer = (state, action) => {
  switch (action.type) {
    case "click_like":
      return {
        ...state,
        likes: state.likes + action.payload
      };
    case "click_dislike":
      return {
        ...state,
        dislikes: state.dislikes + action.payload
      };
    default:
      return state;
  }
};

export default function App() {
  const [state, dispatch] = useReducer(appReducer, initState);
  const { likes, dislikes } = state;
  const [status, setStatus] = useState(null);

  const handleLike = () => {
    if (status === "like") {
      setStatus(null);
      dispatch({
        type: "click_like",
        payload: -1
      });
    } else if (status === null) {
      setStatus("like");
      dispatch({
        type: "click_like",
        payload: 1
      });
    } else {
      setStatus("like");
      dispatch({
        type: "click_dislike",
        payload: -1
      });
      dispatch({
        type: "click_like",
        payload: 1
      });
    }
  };

  const handleDisLike = () => {
    if (status === "dislike") {
      setStatus(null);
      dispatch({
        type: "click_dislike",
        payload: -1
      });
    } else {
      if (status === "like") {
        dispatch({
          type: "click_like",
          payload: -1
        });
      }

      setStatus("dislike");
      dispatch({
        type: "click_dislike",
        payload: 1
      });
    }
  };

  return (
    <div className="App">
      <button
        className={status === "like" ? "btn active" : "btn"}
        onClick={handleLike}
      >
        èµ<span>{likes}</span>
      </button>
      <button
        className={status === "dislike" ? "btn active" : "btn"}
        onClick={handleDisLike}
      >
        è¸©<span>{dislikes}</span>
      </button>
    </div>
  );
}
```

```css
.App {
  display: flex;
  height: 100vh;
  align-items: center;
  justify-content: center;
}

.btn {
  cursor: pointer;
  border: none;
  font-size: 18px;
  line-height: 30px;
  background-color: transparent;
  color: #747777;
  outline: none;
  padding: 0 20px;
}

.btn:first-of-type {
  border-right: 2px solid #747777;
}

.btn:hover {
  color: #282a2e;
}

.active,
.active:hover {
  color: #1b81f5;
}

span {
  margin-left: 6px;
}
```

## 8.7. é«˜é˜¶ç»„ä»¶ and å‡½æ•°ä½œä¸ºå­ç»„ä»¶

é«˜é˜¶ç»„ä»¶ (HOC) æ¥å—ç»„ä»¶ä½œä¸ºå‚æ•°, è¿”å›æ–°çš„ç»„ä»¶, ä¸€èˆ¬ä»¥å‡½æ•°çš„å½¢å¼å‘ˆç°

```jsx
export default function withTimer(WrappedComponent) {
    return class extends React.Component {
        state = { time: new Date() };
        componentDidMount() {
            this.timerID = setInterval(() => this.tick(), 1000);
        }

        componentWillUnmount() {
            clearInterval(this.timerID);
        }

        tick() {
            this.setState({
                time: new Date()
            });
        }
        render() {
            // props åŸå°æœªåŠ¨
            // å¢åŠ äº†ä¸€ä¸ª time å±æ€§
            return <WrappedComponent time={this.state.time} {...this.props} />;
        }
    };
}

// ä½¿ç”¨çš„æ—¶å€™å¯ä»¥è¿™æ ·ä½¿ç”¨:
export class TabSelectorSample extends PureComponent {
    state = {
        color: null
    };
    render() {
        return (
            <div>
                Select color:{" "}
                <TabSelector
                    options={options}
                    value={this.state.color}
                    onChange={c => this.setState({ color: c })}
                />
                {/* time å±æ€§æ˜¯é€šè¿‡åŒ…è£…æ·»åŠ è¿›æ¥çš„ */}
                <p>{this.props.time.toLocaleTimeString()}</p>
            </div>
        );
    }
}

export default withTimer(TabSelectorSample);
```

å‡½æ•°ä½œä¸ºå­ç»„ä»¶:

```jsx
const FunctionAsSonComponent = props => {
    return (
        <MyComponent>
        {/* ä¼ å…¥ä¸€ä¸ªå‡½æ•° */}
            {name => {
                return <div>{name}</div>;
            }}
        </MyComponent>
    );
};

// ä½¿ç”¨: 

const MyComponent = props => {
    // è°ƒç”¨ä¼ å…¥çš„å‡½æ•°, hello å°±æ˜¯å‡½æ•°çš„å‚æ•°
    return <div>{props.children("hello")}</div>;
};
```

## 8.8. Fragment

Fragments çœ‹èµ·æ¥åƒç©ºçš„ JSX æ ‡ç­¾, å¯ä»¥å°†å¤šä¸ªå…ƒç´ ä½œä¸ºè¿”å›å€¼

```js
class Table extends React.Component {
  render() {
    return (
      <table>
        <tr>
          <Columns />
        </tr>
      </table>
    );
  }
}

class Columns extends React.Component {
  render() {
    return (
        // è¿™é‡Œå°±æ˜¯ä¸€ä¸ª Fragment, jsx è§„å®šæ— æ³•ç›´æ¥è¿”å›å¤šä¸ªå…ƒç´ , é€šè¿‡ Fragment å¯è§„é¿è¿™ä¸ªé™åˆ¶
        // å…¶å®å°±æ˜¯ <React.Fragment/> çš„è¯­æ³•ç³–
        // ä½†æ˜¯ <></> è¯­æ³•ä¸èƒ½æ¥å—é”®å€¼æˆ–å±æ€§, åªæœ‰  <React.Fragment/> å¯æ¥å—
      <>
        <td>Hello</td>
        <td>World</td>
      </>
    );
  }
}

```

æ¥å— key å±æ€§çš„ demo:

```js
function Glossary(props) {
  return (
    <dl>
      {props.items.map(item => (
        // æ²¡æœ‰`key`ï¼Œå°†ä¼šè§¦å‘ä¸€ä¸ªkeyè­¦å‘Š
        // key æ˜¯å”¯ä¸€å¯ä»¥ä¼ é€’ç»™ Fragment çš„å±æ€§
        <React.Fragment key={item.id}>
          <dt>{item.term}</dt>
          <dd>{item.description}</dd>
        </React.Fragment>
      ))}
    </dl>
  );
}

```



## 8.9. StrictMode

ä¸ Fragment ç±»ä¼¼ï¼ŒStrictMode ä¸å‘ˆç°ä»»ä½•å¯è§ UIã€‚å®ƒä¸ºå®ƒçš„åä»£å¯åŠ¨é¢å¤–çš„æ£€æŸ¥å’Œè­¦å‘Šã€‚(ä¸¥æ ¼æ¨¡å¼æ£€æŸ¥ä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹è¿è¡Œï¼›å®ƒä»¬ä¸ä¼šå½±å“ç”Ÿäº§æ„å»ºã€‚

)

```js
import React from 'react';

function ExampleApplication() {
  return (
    <div>
      <Header />
      <React.StrictMode>
        <div>
          <ComponentOne />
          <ComponentTwo />
        </div>
      </React.StrictMode>
      <Footer />
    </div>
  );
}

```

## 8.10. ç¤ºä¾‹ 

æ¯ä¸ª demo éƒ½æä¾› 3 ç§å†™æ³•, ä¾›å¯¹æ¯”.

### 8.10.1. ä½¿ç”¨ props

```js
// ç»„ä»¶ç±»çš„ç¬¬ä¸€ä¸ªå­—æ¯å¿…é¡»å¤§å†™ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚HelloMessageä¸èƒ½å†™æˆhelloMessageã€‚å¦å¤–ï¼Œç»„ä»¶ç±»åªèƒ½åŒ…å«ä¸€ä¸ªé¡¶å±‚æ ‡ç­¾ï¼Œå¦åˆ™ä¹Ÿä¼šæŠ¥é”™ã€‚

/*************************
      demo1: ä½¿ç”¨props
***************************/

// react api å†™æ³•

var HelloMsg = React.createClass({
    render: function() {
        return <h1>Hello, {this.props.name}</h1>;
    }
});

// state component å†™æ³•

class HelloMsg extends React.Component {
    constructor(props) {
        super(props);
        this.state = {};
    }
    render() {
        return <h1>Hello, {this.props.name}</h1>;
    }
}

// Functional component , å•çº¯çš„ui, æ²¡æœ‰ state, æ²¡æœ‰ref, ä»…ä»…ä¸€ä¸ªæ„é€ å‡½æ•°

const HelloMsg = props => (
    // æ³¨æ„è¿™è¾¹ props æ˜¯ä¼ å…¥å‡½å¼çš„å‚æ•°ï¼Œå› æ­¤å–ç”¨ props ä¸ç”¨åŠ  this
    <h1>Hello, {props.name}</h1>
);

ReactDOM.render(
    <HelloMsg name="xiaoyu"></HelloMsg>,
    document.getElementById("component")
);
```

### 8.10.2. éå†å­å…ƒç´ 

```js
// ------------------------------------------------------

/******************************
        demo2: éå†å­å…ƒç´ 
*******************************************/

/* éå†å­å…ƒç´ , this.props.childrenè·å–åˆ°æ‰€æœ‰å­å…ƒç´ , React.Children.mapéå† */

/* this.props.childrenå¯èƒ½æœ‰3ç§å¯èƒ½å€¼ undefined: æ²¡æœ‰å­node, object: ä»…ä»…ä¸€ä¸ªå­node, array: å¤šä¸ªå­node */

var ChildNode = React.createClass({
    render: function() {
        return (
            <ol>
                {// React.Children å·¥å…·ç±», è¿˜æœ‰å¾ˆå¤šå·¥å…·æ–¹æ³•, å‚è§æ–‡æ¡£
                React.Children.map(this.props.children, function(child) {
                    return <li>{child}</li>;
                })}
            </ol>
        );
    }
});

class ChildNode extends React.Component {
    // è¿™é‡Œä¸ºäº†æ–¹ä¾¿, æ²¡æœ‰ constructor, å› ä¸ºæ²¡æœ‰è®¾ç½®props

    render() {
        return (
            <ol>
                {// React.Children å·¥å…·ç±», è¿˜æœ‰å¾ˆå¤šå·¥å…·æ–¹æ³•, å‚è§æ–‡æ¡£
                React.Children.map(this.props.children, function(child) {
                    return <li>{child}</li>;
                })}
            </ol>
        );
    }
}

const ChildNode = props => (
    <ol>
        {// React.Children å·¥å…·ç±», è¿˜æœ‰å¾ˆå¤šå·¥å…·æ–¹æ³•, å‚è§æ–‡æ¡£
        React.Children.map(props.children, function(child) {
            return <li>{child}</li>;
        })}
    </ol>
);
ReactDOM.render(
    <ChildNode>
        <div>test childNode div1</div>
        <div>test childNode div2</div>
    </ChildNode>,
    document.getElementById("childNode")
);

// ---------------------------------------------------------
```

### 8.10.3. æ‰¾åˆ°çœŸå®çš„ dom(this.ref.xxx)

```js
/**********************************
        demo3: find a DOM node æ‰¾åˆ°çœŸå®çš„dom
*************************************/

/* find a DOM node æ‰¾åˆ°çœŸå®çš„dom */

var TrueDom = React.createClass({
    render: function() {
        return (
            <div>
                <input type="text" ref="textInput" />
                <input
                    type="button"
                    value="click to focus"
                    onClick={this.handleClick}
                />
            </div>
        );
    },
    handleClick: function() {
        // onclick äº‹ä»¶ä¿è¯äº†åªæœ‰è™šæ‹Ÿdomæ’å…¥documentåæ‰ä¼šä½¿ç”¨this.refså±æ€§, å°±åƒæ”¾å…¥åˆ°äº† lifeCycleæ–¹æ³•componentDidMountä¸­ä¸€æ ·
        this.refs.textInput.focus();
    }
});

class TrueDom extends React.Component {
    constructor(props) {
        super(props);
        this.state = {};
        // ä¸ ES5 React.createClass({}) ä¸åŒçš„æ˜¯ component å†…è‡ªå®šä¹‰çš„æ–¹æ³•éœ€è¦è‡ªè¡Œç»‘å®šåˆ° this context, å¦‚æœå»æ‰, ä¼šæ‰¾ä¸åˆ°ç›¸åº”çš„refs
        this.handleClick = this.handleClick.bind(this);
    }
    render() {
        return (
            <div>
                <input type="text" ref="textInput" />
                <input
                    type="button"
                    value="click to focus"
                    onClick={this.handleClick}
                />
            </div>
        );
    }
    handleClick() {
        this.refs.textInput.focus();
    }
}
ReactDOM.render(<TrueDom></TrueDom>, document.getElementById("trueDom"));

// -------------------------------------------------------------------
```

### 8.10.4. ä½¿ç”¨ state(this.state)

```js
/*************************************
        demo4: çŠ¶æ€ this.state
***************************************/

/* çŠ¶æ€ this.state */

var MyState = React.createClass({
    getInitialState: function() {
        // å®šä¹‰åˆå§‹çŠ¶æ€çš„state, getInitialState æ–¹æ³•ç”¨äºå®šä¹‰åˆå§‹çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥é€šè¿‡ this.state å±æ€§è¯»å–
        return {
            liked: false
        };
    },
    render: function() {
        var text = this.state.liked ? "like" : "è¿˜æ²¡æœ‰å¼€å§‹å–œæ¬¢";
        // æ ·å¼: ç¬¬ä¸€é‡å¤§æ‹¬å·è¡¨ç¤ºè¿™æ˜¯ JavaScript è¯­æ³•ï¼Œç¬¬äºŒé‡å¤§æ‹¬å·è¡¨ç¤ºæ ·å¼å¯¹è±¡
        return (
            <p onClick={this.handleClick}>
                ä½ <span style={{ color: "red" }}>{text}</span>è¿™é‡Œ(ç‚¹å‡»åˆ‡æ¢)
            </p>
        );
    },
    handleClick: function() {
        // æ”¹å˜state
        this.setState({
            liked: !this.state.liked
        });
    }
});

class MyState extends React.Component {
    constructor(props) {
        super(props);
        this.handleClick = this.handleClick.bind(this);
        this.state = {
            liked: false
        };
    }
    render() {
        var text = this.state.liked ? "like" : "è¿˜æ²¡æœ‰å¼€å§‹å–œæ¬¢";
        // æ ·å¼: ç¬¬ä¸€é‡å¤§æ‹¬å·è¡¨ç¤ºè¿™æ˜¯ JavaScript è¯­æ³•ï¼Œç¬¬äºŒé‡å¤§æ‹¬å·è¡¨ç¤ºæ ·å¼å¯¹è±¡
        return (
            <p onClick={this.handleClick}>
                ä½ <span style={{ color: "red" }}>{text}</span>è¿™é‡Œ(ç‚¹å‡»åˆ‡æ¢)
            </p>
        );
    }
    handleClick() {
        this.setState({
            liked: !this.state.liked
        });
    }
}
ReactDOM.render(<MyState></MyState>, document.getElementById("myState"));
```

### 8.10.5. ä¸€ä¸ªè¡¨å•ç¤ºä¾‹

```js
/* è¡¨å• */

var Form = React.createClass({
    getInitialState: function() {
        return {
            value: "hello"
        };
    },
    handleChange: function(event) {
        // å¤„ç†å˜åŒ–äº‹ä»¶, æ³¨æ„æœ‰æ–¹æ³•å‚æ•°: event, event.target.value è¯»å–ç”¨æˆ·è¾“å…¥çš„å€¼
        this.setState({
            value: event.target.value
        });
    },
    render: function() {
        // this.props è¡¨ç¤ºé‚£äº›ä¸€æ—¦å®šä¹‰ï¼Œå°±ä¸å†æ”¹å˜çš„ç‰¹æ€§ï¼Œè€Œ this.state æ˜¯ä¼šéšç€ç”¨æˆ·äº’åŠ¨è€Œäº§ç”Ÿå˜åŒ–çš„ç‰¹æ€§ã€‚
        var value = this.state.value;
        return (
            <div>
                <input type="text" value={value} onChange={this.handleChange} />
                <p>{value}</p>
            </div>
        );
    }
});

class Form extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            value: "hello"
        };
        this.handleChange = this.handleChange.bind(this);
    }
    handleChange(event) {
        // æœ‰eventå‚æ•°, å¦åˆ™æŠ¥é”™: ... is changing a controlled input of type text to be uncontrolled
        this.setState({
            value: event.target.value
        });
    }
    render() {
        // this.props è¡¨ç¤ºé‚£äº›ä¸€æ—¦å®šä¹‰ï¼Œå°±ä¸å†æ”¹å˜çš„ç‰¹æ€§ï¼Œè€Œ this.state æ˜¯ä¼šéšç€ç”¨æˆ·äº’åŠ¨è€Œäº§ç”Ÿå˜åŒ–çš„ç‰¹æ€§ã€‚
        var value = this.state.value;
        return (
            <div>
                <input type="text" value={value} onChange={this.handleChange} />
                <p>{value}</p>
            </div>
        );
    }
}
ReactDOM.render(<Form></Form>, document.getElementById("form"));
```

### 8.10.6. ç™»å½•ç•Œé¢

https://www.jianshu.com/p/efc080e6ecd9 //todo

### 8.10.7. todo list app

https://www.jianshu.com/p/523eb1fc1504 //todo

# 9. ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ

## 9.1. ç”Ÿå‘½å‘¨æœŸä»‹ç»

http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/ ----- äº¤äº’å¼çš„æ¼”ç¤º



Component å°±åƒä¸ªçŠ¶æ€æœºï¼ˆState Machineï¼‰ï¼Œæ ¹æ®ä¸åŒçš„ stateï¼ˆå¯é€šè¿‡`setState()` ä¿®æ”¹ï¼‰å’Œ propsï¼ˆç”±çˆ¶å…ƒç´ ä¼ å…¥ï¼‰ï¼ŒComponent ä¼šå‡ºç°å¯¹åº”çš„æ˜¾ç¤ºç»“æœã€‚

å°±åƒæ˜¯ è®¾è®¡æ¨¡å¼ä¸­çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼, react æä¾›ç»™æˆ‘ä»¬ä¸€ç³»åˆ— æ¨¡æ¿æ–¹æ³•, è¿™äº›æ¨¡æ¿æ–¹æ³•ä¸­çš„å†…å®¹ ä¼šåœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­çš„æŸä¸ªé˜¶æ®µè¢«è°ƒç”¨


ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¤§è‡´å¯åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ:

-   render é˜¶æ®µ: çº¯å‡€æ— å‰¯ä½œç”¨, æ¸²æŸ“çš„æ˜¯ virtual dom
-   pre-commit é˜¶æ®µ: å°† state è½¬æ¢ä¸º dom æ“ä½œ, è¿™æ—¶è¿˜æ²¡æœ‰æ‰§è¡Œ dom æ“ä½œ, çœŸå® dom ä¸­çš„èŠ‚ç‚¹è¿˜æ˜¯æ¥è‡ªä¸Šä¸€ç‰ˆ state/props 
-   commit é˜¶æ®µ: æ‰§è¡Œ dom æ“ä½œ, å°† virtual dom çœŸå®åæ˜ åˆ°çœŸå® dom ä¸Š (è¿™æ—¶ å¯ä»¥ä½¿ç”¨æ›´æ–°åçš„ dom èŠ‚ç‚¹æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰æ“ä½œ)



å¯¹äºä¸€ä¸ªç»„ä»¶, å¯èƒ½æ¥æ”¶ä¸‰ç§æ“ä½œ, å› æ­¤ api ä¹Ÿå¯ä»¥åˆ†ä¸ºä¸‰ç±»:

-   è¢«æŒ‚è½½
-   è¢«æ›´æ–°
-   è¢«å¸è½½




## 9.2. ç»„ä»¶è¢«æŒ‚è½½

ä¾æ¬¡æ‰§è¡Œè¿™äº›æ–¹æ³•

1. constructor(props)  ä¼šåœ¨åˆ›å»º ç»„ä»¶æ—¶ (è¢«æŒ‚è½½ä¹‹å‰) è°ƒç”¨, ç”¨äºåˆå§‹åŒ– state, è¿˜æœ‰ç»„ä»¶æ–¹æ³•çš„ binding

    - å¦‚æœç»„ä»¶æœ‰çˆ¶ç±», é¦–å…ˆéœ€è¦ `super(props)`

    - å¦‚æœ ç»„ä»¶æ˜¯ functional component, åˆ™ä¸éœ€è¦ æ„é€ å‡½æ•° (å› ä¸ºæ²¡æœ‰å†…çŠ¶æ€)

    - å”¯ä¸€å¯ä»¥ç›´æ¥ä¿®æ”¹ state å¯¹è±¡çš„åœ°æ–¹ (é€šè¿‡ `this.state`), å…¶ä»–åœ°æ–¹æƒ³è¦ä¿®æ”¹ state éœ€è¦é€šè¿‡ `setState()`.

    - è¦é¿å…åœ¨æ„é€ å‡½æ•°ä¸­å¼•å…¥ä»»ä½•å‰¯ä½œç”¨(å¦‚ è·å–å¤–éƒ¨æ•°æ®), `componentDidMount` æ‰æ˜¯åº”è¯¥å¹²è¿™äº›äº‹çš„åœ°æ–¹

    - é¿å…å°† props çš„æŸä¸ªå€¼å¤åˆ¶ç»™ state, å› ä¸ºæ›´æ–° props çš„å€¼å¹¶ä¸ä¼šå°†è¿™ä¸ªå€¼åŒæ­¥æ›´è¡Œåˆ° state ä¸­. å¯ä»¥ç›´æ¥ä½¿ç”¨ this.props.xxx

1. (ä¸å¸¸ç”¨ )static getDerivedStateFromProps(props, state) æ¯æ¬¡ render() å‰éƒ½ä¼šè§¦å‘ ; è¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–° state ,å¦‚æœè¿”å› null åˆ™ä¸æ›´æ–°ä»»ä½•å†…å®¹ ; ([ref](https://zh-hans.reactjs.org/docs/react-component.html#static-getderivedstatefromprops))//todo

    - å¦‚: state éœ€è¦ä» props è®¡ç®—å¾—å‡ºæ—¶, å¯ä»¥ä½¿ç”¨ ;

        æ¯”å¦‚: è¡¨å•æ§ä»¶è·å–é»˜è®¤åˆå§‹å€¼ (æ­¤æ—¶ state ä¸­çš„è¡¨å•é¡¹é»˜è®¤å€¼æ˜¯é€šè¿‡ props ä¼ å…¥çš„)

    - ä¸æ¨èä½¿ç”¨ ( å› ä¸º æ‰‹åŠ¨ç»´æŠ¤ state å’Œ props çš„å¯¹åº”å…³ç³»å¢åŠ äº†å¤æ‚æ€§ )

1. render() æ¸²æŸ“ ui, å”¯ä¸€å¿…é¡»å®ç°çš„æ–¹æ³•; æ¯æ¬¡ state å˜åŒ–, éƒ½ä¼šè§¦å‘

    - è¿”å›å€¼åªæœ‰å››ç§:

        react å…ƒç´ . (åŸç”Ÿè¿˜æ˜¯é€šè¿‡ jsx è‡ªå®šä¹‰å‡å¯)

        æ•°ç»„ or [fragments](https://zh-hans.reactjs.org/docs/fragments.html) //todo

        [Portals](https://zh-hans.reactjs.org/docs/portals.html) //todo

        å­—ç¬¦ä¸² or æ•°å­— (åœ¨çœŸå® dom ä¸­ä¼šè¢«æ¸²æŸ“æˆæ–‡æœ¬èŠ‚ç‚¹)

        boolean ç±»å‹ or null (ç”¨äºæ”¯æŒè¿”å› test &&  `<Child />` çš„æ¨¡å¼)

    - åº”è¯¥ä¸º pure function, ä¿è¯æ¸²æŸ“ç»“æœä»…ä»…å’Œ state æœ‰å…³   

    - è‹¥ shouldComponentUpdate() è¿”å› falseï¼Œåˆ™ä¸ä¼šè°ƒç”¨ render()

1. React æ›´æ–° çœŸå® Â­DÂ­OÂ­M å’Œ refs

1. componentDidMount() è¿›è¡Œä¾èµ–äº dom èŠ‚ç‚¹ çš„åˆå§‹åŒ–æ“ä½œ; ä¼šåœ¨ç»„ä»¶æŒ‚è½½å (è¢«æ’å…¥ dom æ ‘ä¸­) è°ƒç”¨

    - å¦‚: é€šè¿‡ ajax è·å–æ•°æ®; æ·»åŠ è®¢é˜… (ä¸è¦å¿˜è®°åœ¨ componentWillUnmount() é‡Œå–æ¶ˆè®¢é˜…)

    - å¯ä»¥ç›´æ¥è°ƒç”¨ setState() è§¦å‘æ¸²æŸ“, ä½†æ­¤æ¸²æŸ“ä¼šå‘ç”Ÿåœ¨æµè§ˆå™¨æ›´æ–°å±å¹•ä¹‹å‰ (å› æ­¤ç”¨æˆ·ä¸ä¼šæ„ŸçŸ¥åˆ°ä¸¤æ¬¡æ¸²æŸ“)

    - æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåªæ‰§è¡Œä¸€æ¬¡

```js
constructor(props) {
    super(props);
    // ä¸è¦åœ¨è¿™é‡Œè°ƒç”¨ this.setState()
    this.state = { counter: 0 };
    this.handleClick = this.handleClick.bind(this);
}
```



## 9.3. ç»„ä»¶è¢«å¸è½½

1. componentWillUnMount() ä¼šåœ¨ç»„ä»¶å¸è½½ä¹‹å‰è°ƒç”¨; å¯ä»¥ æ­¤æ–¹æ³•ä¸­æ‰§è¡Œå¿…è¦çš„æ¸…ç†æ“ä½œ, ç”¨äºèµ„æºé‡Šæ”¾

    - ä¾‹å¦‚ï¼Œæ¸…é™¤ timerï¼Œå–æ¶ˆç½‘ç»œè¯·æ±‚æˆ–æ¸…é™¤åœ¨ componentDidMount() ä¸­åˆ›å»ºçš„è®¢é˜…

    - ä¸åº”è°ƒç”¨ setState()ï¼Œå› ä¸ºè¯¥ç»„ä»¶å³å°†è¢«å¸è½½, å°†æ°¸è¿œä¸ä¼šé‡æ–°æ¸²æŸ“


## 9.4. ç»„ä»¶è¢«æ›´æ–°

1. static getDerivedStateFromProps(props, state)

2. (ä¸å¸¸ç”¨) shouldComponentUpdate(nextProps, nextState) åœ¨ state/props å‘ç”Ÿå˜åŒ–å, render() å‰è§¦å‘; ç”¨æ¥è‡ªå®šä¹‰åˆ¤æ–­ç»„ä»¶æ˜¯å¦éœ€è¦é‡æ–°æ¸²æŸ“

    - é»˜è®¤è¿”å›å€¼ä¸º true, ä¹Ÿå°±æ˜¯ state æ¯æ¬¡å‘ç”Ÿå˜åŒ–ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“, å¤§å¤šæ•°æ—¶å€™é»˜è®¤å³å¯

    - é¦–æ¬¡æ¸²æŸ“æˆ– or ç”¨ forceUpdate() æ—¶ä¸ä¼šè°ƒç”¨è¯¥æ–¹æ³•, è¡¨ç¤ºä¸€å¾‹æ¸²æŸ“

    - [æ€§èƒ½è°ƒä¼˜](https://zh-hans.reactjs.org/docs/react-component.html#shouldcomponentupdate)

        å¯ä»¥ä½¿ç”¨ Pure Component, é»˜è®¤å®ç°äº†è¿™ä¸ªæ–¹æ³•, åªå¯¹ props/state è¿›è¡Œæµ…å±‚æ¯”è¾ƒ, é€‚ç”¨äº props/state æ•°æ®ç»“æ„ç®€å•çš„æƒ…å†µ

        æ‰‹åŠ¨ç¼–å†™æ­¤å‡½æ•°: æ¯”å¯¹å‰åçš„ state/props, è¿”å› falseä»¥å‘ŠçŸ¥ React å¯ä»¥è·³è¿‡æ›´æ–°, è¿”å› false å¹¶ä¸ä¼šé˜»æ­¢å­ç»„ä»¶åœ¨ state æ›´æ”¹æ—¶é‡æ–°æ¸²æŸ“ã€‚react ä¸æ¨è è¿›è¡Œæ·±å±‚æ¯”è¾ƒ,ä¼šæŸå®³æ€§èƒ½ã€‚

        è‹¥é‡‡ç”¨ immutable å¯ä»¥ä½¿ç”¨ nextProps === this.props æ¯”å¯¹æ˜¯å¦æœ‰å˜åŠ¨ï¼š

1. render()

1. (ä¸å¸¸ç”¨) getSnapshotBeforeUpdate(prevProps, prevState) åœ¨ render() å, åœ¨æ¸²æŸ“è¾“å‡ºåˆ°çœŸå® dom å‰è§¦å‘; ç”¨äºåœ¨ç»„ä»¶å‘ç”Ÿæ›´æ”¹ä¹‹å‰ä» DOM ä¸­æ•è·ä¸€äº›ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œæ»šåŠ¨ä½ç½®ï¼‰

    - æ­¤æ—¶ state å·²ç»æ›´æ–°äº†

    - è¿”å›å€¼å°†ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ä¼ é€’ç»™ componentDidUpdate(prevProps, prevState, [snapshot])ã€‚åº”è¿”å› snapshot çš„å€¼ï¼ˆæˆ– nullï¼‰

    - ä¸€èˆ¬å‡ºç°åœ¨uiå¤„ç†ä¸­

1. React æ›´æ–° çœŸå® Â­DÂ­OÂ­M å’Œ refs

1. componentDidUpdate(prevProps, prevState, [snapshot]) åœ¨æ¸²æŸ“è¾“å‡ºåˆ°çœŸå®domåè§¦å‘, é¦–æ¬¡æ¸²æŸ“ä¸ä¼šæ‰§è¡Œæ­¤æ–¹æ³•; ç”¨æ¥å¯¹æ›´æ–°åçš„ dom è¿›è¡Œæ“ä½œ

    - åœºæ™¯: é¡µé¢éœ€è¦æ ¹æ® props å˜åŒ–æ¥é‡æ–°è·å–æ•°æ® (å¦‚å½“ props æœªå‘ç”Ÿå˜åŒ–æ—¶ï¼Œåˆ™ä¸æ‰§è¡Œç½‘ç»œè¯·æ±‚)

    - åœ°ä½ç±»ä¼¼ ç»„ä»¶è¢«æŒ‚è½½æ—¶çš„ componentDidMount()

    - å¯ä»¥ç›´æ¥è°ƒç”¨ setState()ï¼Œä½†å®ƒå¿…é¡»è¢«åŒ…è£¹åœ¨ä¸€ä¸ªæ¡ä»¶è¯­å¥ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ­»å¾ªç¯

    - ç¬¬ä¸‰ä¸ªå‚æ•° æ˜¯ getSnapshotBeforeUpdate() çš„è¿”å›å€¼, å¯èƒ½ä¸º undefined

    - å¦‚æœ shouldComponentUpdate() è¿”å›å€¼ä¸º falseï¼Œåˆ™ä¸ä¼šè°ƒç”¨ componentDidUpdate()


```js
class ScrollingList extends React.Component {
  constructor(props) {
    super(props);
    this.listRef = React.createRef();
  }

  getSnapshotBeforeUpdate(prevProps, prevState) {
    // æˆ‘ä»¬æ˜¯å¦åœ¨ list ä¸­æ·»åŠ æ–°çš„ items ï¼Ÿ
    // æ•è·æ»šåŠ¨â€‹â€‹ä½ç½®ä»¥ä¾¿æˆ‘ä»¬ç¨åè°ƒæ•´æ»šåŠ¨ä½ç½®ã€‚
    if (prevProps.list.length < this.props.list.length) {
      const list = this.listRef.current;
      return list.scrollHeight - list.scrollTop;
    }
    return null;
  }

  componentDidUpdate(prevProps, prevState, snapshot) {
    // å¦‚æœæˆ‘ä»¬ snapshot æœ‰å€¼ï¼Œè¯´æ˜æˆ‘ä»¬åˆšåˆšæ·»åŠ äº†æ–°çš„ itemsï¼Œ
    // è°ƒæ•´æ»šåŠ¨ä½ç½®ä½¿å¾—è¿™äº›æ–° items ä¸ä¼šå°†æ—§çš„ items æ¨å‡ºè§†å›¾ã€‚
    //ï¼ˆè¿™é‡Œçš„ snapshot æ˜¯ getSnapshotBeforeUpdate çš„è¿”å›å€¼ï¼‰
    if (snapshot !== null) {
      const list = this.listRef.current;
      list.scrollTop = list.scrollHeight - snapshot;
    }

    // å…¸å‹ç”¨æ³•ï¼ˆä¸è¦å¿˜è®°æ¯”è¾ƒ propsï¼‰ï¼š
    if (this.props.userID !== prevProps.userID) {
        this.fetchData(this.props.userID);
    }

  }

  render() {
    return (
      <div ref={this.listRef}>{/* ...contents... */}</div>
    );
  }
}
```



## 9.5. ç”Ÿå‘½å‘¨æœŸå‡½æ•° demo

demo1: ä¸€ä¸ªå®šæ—¶æµ®ç°éšè—çš„å›¾æ ‡

```js
var Hello = React.createClass({
    getInitialState: function() {
        return {
            opacity: 1.0
        };
    },

    componentDidMount: function() {
        // è®¾å®š å®šæ—¶å™¨
        this.timer = setInterval(
            function() {
                var opacity = this.state.opacity;
                opacity -= 0.05;
                if (opacity < 0.1) {
                    opacity = 1.0;
                }
                this.setState({
                    opacity: opacity
                });
            }.bind(this),
            100
        ); // æ¯éš”100ms, å°±é‡æ–°è®¾ç½®ç»„ä»¶çš„é€æ˜åº¦ï¼Œä»è€Œå¼•å‘é‡æ–°æ¸²æŸ“
        // å›è°ƒå‡½æ•°ä¸€å®šè¦åŠ .bind(this)æ–¹æ³•ï¼ŒåŸå› æ˜¯ï¼šåœ¨setInterval()ä¸­å®šä¹‰çš„å›è°ƒå‡½æ•°ï¼Œæ˜¯åœ¨åŒæ­¥ä»£ç æ‰§è¡Œå®Œåï¼Œéšç€äº‹ä»¶è§¦å‘æ¥å¼‚æ­¥æ‰§è¡Œçš„ï¼Œ
        // æ­¤æ—¶å‡½æ•°çš„ä¸Šä¸‹æ–‡Contextå·²ç»ç”±å®šä¹‰è¯¥å‡½æ•°çš„Scriptæ–‡ä»¶å˜ä¸ºå…¨å±€å˜é‡ï¼Œ
        // å¦‚æœä¸é€šè¿‡bind(this)æ¥æŒ‡å®šç”±ç»„ä»¶å®ä¾‹ä½œä¸ºä¸Šä¸‹æ–‡çš„è¯ï¼Œå›è°ƒå‡½æ•°ä¸­çš„thisä¼šæŒ‡å‘å…¨å±€å˜é‡ä¸­çš„Windowå˜é‡ï¼Œæ˜¾ç„¶ä¸å¯¹
    },

    render: function() {
        // æ ·å¼: å†™æˆ style="opacity:{this.state.opacity};" æ˜¯é”™è¯¯çš„
        return (
            <div>
                Hello {this.props.name}{" "}
                <span style={{ opacity: this.state.opacity }}>ğŸ‘ˆ</span>
            </div>
        );
    }
});
class Hello extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            opacity: 1.0
        };
        this.intervalCallback = this.intervalCallback.bind(this); // éœ€è¦bindåˆ°å½“å‰ç»„ä»¶(é»˜è®¤æ˜¯ç»‘å®šåˆ°å…¨å±€window), å¦åˆ™æŠ¥é”™: Cannot read property 'opacity' of undefined
    }
    render() {
        return (
            <div>
                Hello {this.props.name}{" "}
                <span style={{ opacity: this.state.opacity }}>ğŸ‘ˆ</span>
            </div>
        );
    }
    componentDidMount() {
        this.timer = setInterval(this.intervalCallback, 100);
    }
    intervalCallback() {
        var opacity = this.state.opacity;
        opacity -= 0.05;
        if (opacity < 0.1) {
            opacity = 1.0;
        }
        this.setState({
            opacity: opacity
        });
    }
}

ReactDOM.render(<Hello name="world" />, document.getElementById("lifeCycle"));
```

# 10. virtual dom å’Œ diff ç®—æ³•

## 10.1. virtual dom

å¦‚æœæœ‰å¤§é¢ç§¯çš„æ“ä½œ DOMï¼Œæ€§èƒ½ä¼šæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œæ‰€ä»¥ React å®ç°äº†ä¸€ä¸ª*Virtual DOM*ï¼Œå……å½“æµè§ˆå™¨çœŸå® dom å’Œ react ä¹‹é—´çš„ä¸­é—´å±‚

è¿™ä¸ª Virtual DOM æ˜¯ä¸€ä¸ªçº¯ç²¹çš„ JS æ•°æ®ç»“æ„ï¼Œåœ¨è¿™ä¸ªç»“æ„ä¸Š, å®ç°äº† diff ç®—æ³•



## 10.2. react çš„ diff ç®—æ³•æ³•
 
å¤æ‚åº¦ O(n)

æ‹¿åˆ°å‰åä¸¤ä¸ªçŠ¶æ€çš„ virtual dom æ ‘å, ä¼šä¸€å±‚ä¸€å±‚å¯¹æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒ; 

å¹¶ä¸”åªä¼šå¯¹æ¯”åŒä¸€å±‚çš„èŠ‚ç‚¹. å¯¹äºè·¨å±‚çº§çš„å·®å¼‚, ä¼šé‡‡ç”¨ æ–°å»º + åˆ é™¤ æ“ä½œ, ä¸ä¼šéå†æ¯”è¾ƒå­èŠ‚ç‚¹

-   å¦‚æœæŸä¸€å±‚, å¯¹æ¯”å‰åçŠ¶æ€å‘ç°, åªæ˜¯èŠ‚ç‚¹é¡ºåºå˜åŒ–, åˆ™æ“ä½œçœŸå® dom, äº¤æ¢èŠ‚ç‚¹é¡ºåº,

-   å¦‚æœæŸä¸€å±‚, å‰åçŠ¶æ€ æŸèŠ‚ç‚¹æ¶ˆå¤±ä¸è§ or æ–°å¢, åˆ™åœ¨çœŸå® dom ä¸Š, ç›´æ¥åˆ é™¤/æ–°å¢è¯¥èŠ‚ç‚¹åŠæ‰€æœ‰å­èŠ‚ç‚¹. è¿™æ ·å‡å°‘äº†å¾ˆå¤šä¸å¿…è¦çš„éå†.

-   å¦‚æœæŸä¸€å±‚, å‘ç”ŸèŠ‚ç‚¹è·¨å±‚ç§»åŠ¨, æ¯”å¦‚: å‰åçŠ¶æ€,å‘ç° å­èŠ‚ç‚¹ node1 ç§»åŠ¨åˆ° å…„å¼ŸèŠ‚ç‚¹ node2 ä¸‹äº†, é‚£ä¹ˆ diff ç®—æ³•ä¼šåœ¨ node2 ä¸‹åˆ›å»º node1 åŠå…¶å­ç»“ç‚¹, åˆ›å»ºæˆåŠŸå, ç„¶åç›´æ¥åˆ é™¤ node1 (æ–°å»º + åˆ é™¤)


===================å¯¹äºæ‹¥æœ‰ä¸åŒ class çš„2ä¸ªç»„ä»¶

react æ ¹æœ¬ä¸ä¼šèµ°åˆ° diff æ¯”è¾ƒ virtual dom è¿™ä¸€æ­¥:

- æ‹¥æœ‰ä¸åŒç±»çš„ä¸¤ä¸ªç»„ä»¶æœ‰ç‰¹æ®Šè§„åˆ™: å‰åä¸¤ä¸ªç»„ä»¶å°†ä¼šç”Ÿæˆä¸åŒçš„ dom æ ‘ç»“æ„ï¼Œå½“ react åˆ¤æ–­ç»„ä»¶ä¸º dirty componentï¼Œä»è€Œæ›¿æ¢æ•´ä¸ªç»„ä»¶ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹

    å¦‚: åœ¨å¼€å‘ä¸­æˆ‘ä»¬éœ€è¦å°† A ç»„ä»¶æ¢æˆ B ç»„ä»¶ï¼ŒA ä¸ B ä¸æ˜¯åŒç±»ç»„ä»¶æ—¶ï¼Œreact ä¼šæ¯«ä¸çŠ¹è±«çš„åˆ é™¤ Aï¼Œæ–°å»º B åŠå…¶å­èŠ‚ç‚¹ã€‚ä¸ç®¡ A ä¸ B æ˜¯å¦æœ‰ç›¸åŒçš„ç»“æ„

    å¸¦æ¥çš„é—®é¢˜: å‡å¦‚ä¸åŒçš„ç±»ï¼Œä½†æ˜¯ç»“æ„ç›¸ä¼¼çš„ç»„ä»¶ç›¸äº’æ›¿æ¢ï¼Œå°†ä¼šå¤§å¤§å½±å“ react æ€§èƒ½ã€‚

    å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢, é€šè¿‡ shouldComponentUpdate()æ¥æ‰‹åŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ç»„ä»¶



## 10.3. key å±æ€§æœ‰ä»€ä¹ˆä½œç”¨

keyå±æ€§ ç”¨æ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªç»„ä»¶, è‹¥æ¸²æŸ“å‰åç»„ä»¶å…·æœ‰ç›¸åŒçš„key åˆ™ reactè®¤ä¸ºæ˜¯åŒä¸€ä¸ªç»„ä»¶

- å¦‚æœæ¸²æŸ“å‰åæŸä¸ªå…ƒç´ å…·æœ‰ç›¸åŒkey, è‹¥å…ƒç´ å±æ€§æœ‰æ‰€å˜åŒ–ï¼Œåˆ™Reactåªæ›´æ–°è¯¥ç»„ä»¶å¯¹åº”çš„å±æ€§, ä¸æ¶‰åŠç»„ä»¶çš„æŒ‚è½½å¸è½½ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæ€§èƒ½å¼€é”€ä¼šç›¸å¯¹è¾ƒå°

- å¦‚æœå…ƒç´ å‰åæœ‰ä¸åŒçš„key, é‚£ä¹ˆåœ¨å‰åä¸¤æ¬¡æ¸²æŸ“ä¸­å°±ä¼šè¢«è®¤ä¸ºæ˜¯ä¸åŒçš„å…ƒç´ ï¼Œè¿™æ—¶å€™æ—§çš„é‚£ä¸ªå…ƒç´ ä¼šè¢«unmountï¼Œæ–°çš„å…ƒç´ ä¼šè¢«mount

æ‰€ä»¥ä¸ºå…ƒç´ æ·»åŠ  keyå±æ€§, æœ‰åŠ©äºæå‡æ€§èƒ½; ä¸” key éœ€è¦æ»¡è¶³ å”¯ä¸€, ç¨³å®šä¸å˜

ä¸æ¨èä½¿ç”¨æ•°ç»„/é›†åˆçš„indexæ¥åškeyå€¼, å› ä¸ºæ•°ç»„åœ¨æ‰§è¡Œæ’å…¥ã€æ’åºç­‰æ“ä½œä¹‹åï¼Œindexå¹¶ä¸å†å¯¹åº”åˆ°åŸå…ˆçš„å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªkeyå°±å¤±å»äº†æœ¬èº«çš„æ„ä¹‰

ä¸æ¨èä½¿ç”¨ éšæœºç”Ÿæˆå€¼ æ¥åš key

## 10.4. è®¾ç½®ç»„ä»¶æ—¶æ€ä¹ˆæé«˜æ€§èƒ½


å› æ­¤ diff ç®—æ³•é«˜æ•ˆ æœ‰ä¸¤ä¸ªå‰æ:

-   ç»„ä»¶çš„ dom ç»“æ„ç›¸å¯¹ç¨³å®š (å¾ˆå°‘å‘ç”Ÿè·¨å±‚ç§»åŠ¨, å¢åŠ /åˆ é™¤)

-   åŒç±»å‹çš„å…„å¼ŸèŠ‚ç‚¹å¯ä»¥è¢«å”¯ä¸€æ ‡è¯† (é€šè¿‡ key å±æ€§)

æ‰€ä»¥è®¾è®¡ç»„ä»¶, åº”è¯¥éµå®ˆè¿™æ ·çš„åŸåˆ™:

-   ui ä¸­çš„å…ƒç´ å°½é‡åªå‘ç”Ÿç§»åŠ¨, å±æ€§å˜åŒ–, å°‘å‘ç”Ÿ å¢åŠ , åˆ é™¤, å°‘å‘ç”Ÿè·¨å±‚ç§»åŠ¨

    æ¯”å¦‚, å¯¹äºå¢åŠ /åˆ é™¤èŠ‚ç‚¹, å¯ä»¥ä½¿ç”¨æ ·å¼æ§åˆ¶èŠ‚ç‚¹çš„ display å®ç°

-   ä¸åŒç±»çš„ç»„ä»¶ä¸è¦å­˜åœ¨ç›¸ä¼¼ DOM

    å¦‚: å¯¹äºä¸¤ä¸ªç»„ä»¶å…·æœ‰ç›¸ä¼¼çš„ dom ç»“æ„, åº”è¯¥è®¾è®¡ä¸ºåŒä¸€ä¸ª ç»„ä»¶ç±»

# 11. context-api ä½¿ç”¨


# 12. state çŠ¶æ€

## 12.1. state ä»‹ç»

state æ˜¯ç»„ä»¶å†…éƒ¨ç»´æŠ¤çš„çŠ¶æ€, props æ˜¯å¤–éƒ¨ä¼ å…¥çš„å±æ€§; state ä¸€èˆ¬æ˜¯çœŸæ­£çš„ä¸šåŠ¡æ•°æ®, props ä¸€èˆ¬æ˜¯ç»„ä»¶çš„é…ç½®, ä»çˆ¶ç»„ä»¶ä¼ å…¥, å®šä¹‰åä¸€èˆ¬ä¸å˜åŒ–

å½“ç»„ä»¶çŠ¶æ€ state æœ‰æ›´æ”¹çš„æ—¶å€™(é€šè¿‡ `setState()`æ›´æ”¹, ç›´æ¥ä¿®æ”¹çš„è¯, ç»„ä»¶ä¸ä¼šé‡ç»˜)ï¼ŒReact ä¼šè‡ªåŠ¨è°ƒç”¨ç»„ä»¶çš„ render æ–¹æ³•é‡æ–°æ¸²æŸ“ (é‡ç»˜ redraw) æ•´ä¸ªç»„ä»¶çš„ UI

React Component å¯ä»¥ç®¡ç†è‡ªå·±çš„å†…éƒ¨ state, åœ¨ constructor(props) æ„é€ å‡½æ•° ä¸­åˆå§‹åŒ– state, å¹¶ç”¨ `this.state`æ¥è·å– stateã€‚é€šè¿‡ `setState(newState)` æ–¹æ³•æ›´æ–° state, æ›´æ–°åå°†é‡æ–°è°ƒç”¨ render() æ–¹æ³•ï¼Œé‡æ–°ç»˜åˆ¶ component å†…å®¹

```js
class Timer extends React.Component {
    constructor(props) {
        super(props);
        // ä¸ ES5 React.createClass({}) ä¸åŒçš„æ˜¯ component å†…è‡ªå®šä¹‰çš„æ–¹æ³•éœ€è¦è‡ªè¡Œç»‘å®š this contextï¼Œæˆ–æ˜¯ä½¿ç”¨ arrow function
        this.tick = this.tick.bind(this);
        // åˆå§‹ stateï¼Œç­‰äº ES5 ä¸­çš„ getInitialState
        this.state = {
            secondsElapsed: 0
        };
    }
    // ç´¯åŠ å™¨æ–¹æ³•ï¼Œæ¯ä¸€ç§’è¢«å‘¼å«åå°±ä¼šä½¿ç”¨ setState() æ›´æ–°å†…éƒ¨ stateï¼Œè®© Component é‡æ–° render
    tick() {
        this.setState({ secondsElapsed: this.state.secondsElapsed + 1 });
    }
    // componentDidMount ä¸º component ç”Ÿå‘½å‘¨æœŸä¸­é˜¶æ®µ component å·²æ’å…¥èŠ‚ç‚¹çš„é˜¶æ®µï¼Œé€šå¸¸ä¸€äº›éåŒæ­¥æ“ä½œéƒ½ä¼šæ”¾ç½®åœ¨è¿™ä¸ªé˜¶æ®µã€‚è¿™ä¾¿æ˜¯æ¯1ç§’é’Ÿä¼šå»å‘¼å« tick æ–¹æ³•
    componentDidMount() {
        this.interval = setInterval(this.tick, 1000);
    }
    // componentWillUnmount ä¸º component ç”Ÿå‘½å‘¨æœŸä¸­ component å³å°†ç§»å‡ºæ’å…¥çš„èŠ‚ç‚¹çš„é˜¶æ®µã€‚è¿™è¾¹ç§»é™¤äº† setInterval æ•ˆåŠ›
    componentWillUnmount() {
        clearInterval(this.interval);
    }
    // render ä¸º class Component ä¸­å”¯ä¸€éœ€è¦å®šä¹‰çš„æ–¹æ³•ï¼Œå…¶å›ä¼  component æ¬²æ˜¾ç¤ºçš„å†…å®¹
    render() {
        return <div>Seconds Elapsed: {this.state.secondsElapsed}</div>;
    }
}

ReactDOM.render(<Timer />, document.getElementById("app"));
```

## 12.2. state å’Œç»„ä»¶çš„æ™®é€šå±æ€§åŒºåˆ«

åœ¨ state ä¸­çš„å˜é‡æ˜¯å’Œ ui æ¸²æŸ“ç›¸å…³çš„, æ€»æ˜¯ä¼šåœ¨ render() ä¸­ä½¿ç”¨åˆ°

ç»„ä»¶çš„æ™®é€šå±æ€§å’Œ state ä¸€æ ·ä¼šåœ¨ç»„ä»¶å†…éƒ¨ç”¨åˆ°, ä½†æ˜¯ä¸æ˜¯åœ¨ render() ä¸­ä½¿ç”¨, å’Œ ui æ¸²æŸ“æ— å…³. å¦‚: ç»„ä»¶ä¸­ç”¨åˆ°çš„å®šæ—¶å™¨

```js
// åˆå§‹åŒ–
  constructor(props) {
    super(props);
    this.state = {}; // state å˜é‡
    this.timer = 0; // æ™®é€šå±æ€§
  }
```

## 12.3. å¦‚ä½•æ›´æ–° state 

é€šè¿‡ setState æ–¹æ³•, æœ‰ä¸¤ç§ä½¿ç”¨æ–¹æ³•

- setState(newState)

- setState((preState, props) => newState)

  å¯ä»¥åŒæ—¶ä¼ é€’ä¸€ä¸ª callback å›è°ƒå‡½æ•°, setState((preState, props) => newState, callback)




å½“Stateä¸­çš„æŸä¸ªçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬åº”è¯¥é‡æ–°åˆ›å»ºè¿™ä¸ªçŠ¶æ€å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹åŸæ¥çš„çŠ¶æ€. ä¸ºä»€ä¹ˆå‘¢

- æœ‰åˆ©äºæ€§èƒ½æå‡.

    å¦‚æœ æ•´ä¸ª state æ˜¯å¯å˜å¯¹è±¡, é‚£ä¹ˆè¯´ä¸å®šåœ¨å“ªä¸ªåœ°æ–¹å°±æ”¹å˜äº† state, é€ æˆç»„ä»¶ä¸å¿…è¦çš„ é‡ç»˜

    å½“å¯¹è±¡ç»„ä»¶çŠ¶æ€éƒ½æ˜¯ä¸å¯å˜å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬åœ¨ç»„ä»¶çš„shouldComponentUpdateæ–¹æ³•ä¸­ï¼Œä»…éœ€è¦æ¯”è¾ƒçŠ¶æ€çš„å¼•ç”¨å°±å¯ä»¥åˆ¤æ–­çŠ¶æ€æ˜¯å¦çœŸçš„æ”¹å˜ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„renderè°ƒç”¨ã€‚

    æˆ‘ä»¬ä½¿ç”¨React æä¾›çš„PureComponentæ—¶ï¼Œæ›´æ˜¯è¦ä¿è¯ç»„ä»¶çŠ¶æ€æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œå¦åˆ™åœ¨ç»„ä»¶çš„shouldComponentUpdateæ–¹æ³•ä¸­ï¼ŒçŠ¶æ€æ¯”è¾ƒå°±å¯èƒ½å‡ºç°é”™è¯¯ï¼Œå› ä¸ºPureComponentæ‰§è¡Œçš„æ˜¯æµ…æ¯”è¾ƒï¼ˆæ¯”è¾ƒå¯¹è±¡çš„å¼•ç”¨ï¼‰ã€‚

- ä¸å¯å˜å¯¹è±¡æ–¹ä¾¿ç®¡ç†å’Œè°ƒè¯•

æ‰€ä»¥ state åº”è¯¥æ˜¯ Immutable çš„, ç›®å‰æ˜¯æˆ‘ä»¬è‡ªå·±ä¿è¯å®ƒæ˜¯ä¸å¯å˜çš„, åé¢å¯ä»¥è€ƒè™‘ä½¿ç”¨ Immutable.js

```js
// å½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¦‚ä½•åˆ›å»ºæ–°çš„çŠ¶æ€å‘¢ï¼Ÿæ ¹æ®çŠ¶æ€çš„ç±»å‹ï¼Œå¯ä»¥åˆ†æˆä¸‰ç§æƒ…å†µï¼š

// 1. çŠ¶æ€çš„ç±»å‹æ˜¯ä¸å¯å˜ç±»å‹ï¼ˆæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”å€¼ï¼Œnullï¼Œ undefinedï¼‰

// æœ€ç®€å•, ç›´æ¥ç»™è¦ä¿®æ”¹çš„çŠ¶æ€èµ‹ä¸€ä¸ªæ–°å€¼å³å¯
this.setState({
  count: 1,
  title: 'Redux',
  success: true
})

////////////////////////////////////////////////////////////

// 2. çŠ¶æ€çš„ç±»å‹æ˜¯æ•°ç»„
//æ³¨æ„ä¸è¦ä½¿ç”¨pushã€popã€shiftã€unshiftã€spliceç­‰æ–¹æ³•ä¿®æ”¹æ•°ç»„ç±»å‹çš„çŠ¶æ€ï¼Œå› ä¸ºè¿™äº›æ–¹æ³•éƒ½æ˜¯åœ¨åŸæ•°ç»„çš„åŸºç¡€ä¸Šä¿®æ”¹ï¼Œè€Œconcatã€sliceã€filterä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚


// å¦‚æœ‰ä¸€ä¸ªæ•°ç»„ç±»å‹çš„çŠ¶æ€booksï¼Œå½“å‘booksä¸­å¢åŠ ä¸€æœ¬ä¹¦æ—¶ï¼Œä½¿ç”¨æ•°ç»„çš„concatæ–¹æ³•æˆ–ES6çš„æ•°ç»„æ‰©å±•è¯­æ³•ï¼ˆspread syntaxï¼‰ï¼š

// æ–¹æ³•ä¸€ï¼šå°†stateå…ˆèµ‹å€¼ç»™å¦å¤–çš„å˜é‡ï¼Œç„¶åä½¿ç”¨concatåˆ›å»ºæ–°æ•°ç»„
var books = this.state.books; 
this.setState({
  books: books.concat(['React Guide']);
})
// æ–¹æ³•äºŒï¼šä½¿ç”¨preStateã€concatåˆ›å»ºæ–°æ•°ç»„
this.setState(preState => ({
  books: preState.books.concat(['React Guide']);
}))
// æ–¹æ³•ä¸‰ï¼šES6 spread syntax
this.setState(preState => ({
  books: [...preState.books, 'React Guide'];
}))


// å½“ä»booksä¸­æˆªå–éƒ¨åˆ†å…ƒç´ ä½œä¸ºæ–°çŠ¶æ€æ—¶ï¼Œä½¿ç”¨æ•°ç»„çš„sliceæ–¹æ³•ï¼š

// æ–¹æ³•ä¸€ï¼šå°†stateå…ˆèµ‹å€¼ç»™å¦å¤–çš„å˜é‡ï¼Œç„¶åä½¿ç”¨sliceåˆ›å»ºæ–°æ•°ç»„
var books = this.state.books; 
this.setState({
  books: books.slice(1,3);
})
// æ–¹æ³•äºŒï¼šä½¿ç”¨preStateã€sliceåˆ›å»ºæ–°æ•°ç»„
this.setState(preState => ({
  books: preState.books.slice(1,3);
}))


//å½“ä»booksä¸­è¿‡æ»¤éƒ¨åˆ†å…ƒç´ åï¼Œä½œä¸ºæ–°çŠ¶æ€æ—¶ï¼Œä½¿ç”¨æ•°ç»„çš„filteræ–¹æ³•ï¼š

// æ–¹æ³•ä¸€ï¼šå°†stateå…ˆèµ‹å€¼ç»™å¦å¤–çš„å˜é‡ï¼Œç„¶åä½¿ç”¨filteråˆ›å»ºæ–°æ•°ç»„
var books = this.state.books; 
this.setState({
  books: books.filter(item => {
    return item != 'React'; 
  });
})
// æ–¹æ³•äºŒï¼šä½¿ç”¨preStateã€filteråˆ›å»ºæ–°æ•°ç»„
this.setState(preState => ({
  books: preState.books.filter(item => {
    return item != 'React'; 
  });
}))

////////////////////////////////////////////////////////////



// 3. çŠ¶æ€çš„ç±»å‹æ˜¯æ™®é€šå¯¹è±¡ï¼ˆä¸åŒ…å«å­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰



//ä½¿ç”¨ES6 çš„Object.assginæ–¹æ³•

// æ–¹æ³•ä¸€ï¼šå°†stateå…ˆèµ‹å€¼ç»™å¦å¤–çš„å˜é‡ï¼Œç„¶åä½¿ç”¨Object.assignåˆ›å»ºæ–°å¯¹è±¡
var owner = this.state.owner;
this.setState({
  owner: Object.assign({}, owner, {name: 'Jason'});
})
// æ–¹æ³•äºŒï¼šä½¿ç”¨preStateã€Object.assignåˆ›å»ºæ–°å¯¹è±¡
this.setState(preState => ({
  owner: Object.assign({}, preState.owner, {name: 'Jason'});
}))


// ä½¿ç”¨å¯¹è±¡æ‰©å±•è¯­æ³•ï¼ˆobject spread propertiesï¼‰

// æ–¹æ³•ä¸€ï¼šå°†stateå…ˆèµ‹å€¼ç»™å¦å¤–çš„å˜é‡ï¼Œç„¶åä½¿ç”¨å¯¹è±¡æ‰©å±•è¯­æ³•åˆ›å»ºæ–°å¯¹è±¡
var owner = this.state.owner;
this.setState({
  owner: {...owner, name: 'Jason'};
})
// æ–¹æ³•äºŒï¼šä½¿ç”¨preStateã€å¯¹è±¡æ‰©å±•è¯­æ³•åˆ›å»ºæ–°å¯¹è±¡
this.setState(preState => ({
  owner: {...preState.owner, name: 'Jason'};
}))

```


## 12.4. setState æ˜¯ä¸æ˜¯å¼‚æ­¥çš„


ç»å…¸ä¾‹å­:

```js
// demo.js
class Demo extends PureComponent {
  state={
    count: 0,
  }
  // é’©å­å‡½æ•° (åœ¨è¿™é‡Œæ˜¯å¼‚æ­¥çš„)
  componentDidMount() {
    console.log('pre state', this.state.count);
    this.setState({
      count: this.state.count + 1
    });
    console.log('next state', this.state.count);//å‰åæ²¡å˜åŒ–

    //æµ‹è¯•setTimeout (è¿™é‡Œæ˜¯åŒæ­¥çš„)
    setTimeout(() => {
      console.log('setTimeout pre state', this.state.count);
      this.setState({
        count: this.state.count + 1
      });
      console.log('setTimeout next state', this.state.count);// å‰åæœ‰å˜åŒ–
    }, 0);
  }

  onClick = (event) => {
    // æµ‹è¯•åˆæˆå‡½æ•° (åˆæˆäº‹ä»¶è§¦å‘çš„å‡½æ•°) ä¸­setState (è¿™é‡Œæ˜¯å¼‚æ­¥çš„)
    console.log(`${event.type} pre state`, this.state.count);
    this.setState({
      count: this.state.count + 1
    });
    console.log(`${event.type} next state`, this.state.count);// å‰åæ²¡å˜åŒ–
  }

  render() {
    return <button onClick={this.onClick}>count+1</button>
  }
}
```

è°ƒç”¨setStateï¼Œç»„ä»¶çš„stateå¹¶ä¸ä¼šç«‹å³æ”¹å˜ï¼ŒsetStateåªæ˜¯æŠŠè¦ä¿®æ”¹çš„çŠ¶æ€æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼ŒReactä¼šä¼˜åŒ–çœŸæ­£çš„æ‰§è¡Œæ—¶æœºï¼Œå¹¶ä¸” React ä¼šå°†å¤šæ¬¡setStateçš„çŠ¶æ€ä¿®æ”¹åˆå¹¶æˆä¸€æ¬¡çŠ¶æ€ä¿®æ”¹. 

>æ‰€ä»¥ä¸è¦ä¾èµ–å½“å‰çš„Stateï¼Œè®¡ç®—ä¸‹ä¸ªState; å‰åä¸¤ä¸ª state åº”è¯¥æ²¡æœ‰ä»»ä½•è”ç³»; åŒæ ·ä¸èƒ½ä¾èµ–å½“å‰çš„Propsè®¡ç®—ä¸‹ä¸ª stateï¼Œå› ä¸ºPropsä¸€èˆ¬ä¹Ÿæ˜¯ä»çˆ¶ç»„ä»¶çš„Stateä¸­è·å–ï¼Œä¾ç„¶æ— æ³•ç¡®å®šè·å–çš„å½“å‰ props å°±æ˜¯æœ€æ–°çš„

==================çœŸçš„æ˜¯å¼‚æ­¥çš„å—

setStateæœ¬èº«çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯åŒæ­¥çš„

ä½†æ˜¯åœ¨reactçš„`åˆæˆå‡½æ•° (è‡ªå®šä¹‰å‡½æ•°)`ä¸`é’©å­å‡½æ•° (ç”Ÿå‘½å‘¨æœŸå‡½æ•°)`ä¸­çš„ setState() ä¸ä¼šç«‹é©¬æ›´æ–° stateï¼Œæ‰€ä»¥ä¸èƒ½ç«‹å³æ‹¿åˆ°æ›´æ–°åçš„ stateï¼Œå½¢æˆäº†æ‰€è°“çš„å¼‚æ­¥ï¼›


==================ä¸ºä»€ä¹ˆéœ€è¦æœ‰å¼‚æ­¥å‘¢ //todo

- ä¿æŒ å’Œ props çš„ä¸€è‡´æ€§

    å°±ç®—è®© state åŒæ­¥æ›´æ–°ï¼Œprops ä¹Ÿä¸è¡Œï¼Œå› ä¸ºå½“çˆ¶ç»„ä»¶é‡æ¸²æŸ“ï¼ˆre-render ï¼‰äº†ä½ æ‰çŸ¥é“ propsã€‚

- æ€§èƒ½ä¼˜åŒ–

    React ä¼šç»™ä¸åŒçš„ setState() è°ƒç”¨åˆ†é…ä¸åŒçš„ä¼˜å…ˆçº§, è€Œä¸æ˜¯ç«‹é©¬æ›´æ–° state, é˜²æ­¢å¹¶å‘çš„åŠ¨ä½œé˜»å¡çº¿ç¨‹

- å¯ä»¥å®ç° æ›´æ–° state, åœ¨å¹•åæ¸²æŸ“æ–°çš„é¡µé¢, è¿˜ä¿æŒæ—§çš„é¡µé¢å¯ä»¥äº¤äº’



=======================å¯ä»¥æ˜¯åŒæ­¥çš„å—

å¯ä»¥ 

- åœ¨åŸç”Ÿäº‹ä»¶è§¦å‘çš„å‡½æ•°, setTimeout, asyncå‡½æ•°ä¸­æ˜¯åŒæ­¥çš„

- ç”Ÿå‘½å‘¨æœŸå‡½æ•°å’Œåˆæˆå‡½æ•°ä¸­éƒ½æ˜¯å¼‚æ­¥æ›´æ–°


## 12.5. setState æ›´æ–°æ˜¯ä¸€ä¸ªåˆå¹¶è¿‡ç¨‹

State çš„æ›´æ–°æ˜¯ä¸€ä¸ªæµ…åˆå¹¶ï¼ˆShallow Mergeï¼‰çš„è¿‡ç¨‹, æ‰€ä»¥ å½“è°ƒç”¨setStateä¿®æ”¹ç»„ä»¶çŠ¶æ€æ—¶ï¼Œåªéœ€è¦ä¼ å…¥å‘ç”Ÿæ”¹å˜çš„Stateï¼Œè€Œä¸æ˜¯ç»„ä»¶å®Œæ•´çš„State

```js
// setState ç­‰ä»·äº
Object.assign(preState, newState)



// ä¾‹å¦‚
// åˆå§‹åŒ– state
this.state = {
  title : 'React',
  content : 'React is an wonderful JS library!'
}
// æ›´æ–° state
this.setState({title: 'Reactjs'});
// æœ€ç»ˆåˆå¹¶åçš„ state æ˜¯è¿™æ ·çš„:
{
  title : 'Reactjs',
  content : 'React is an wonderful JS library!'
}


```

## 12.6. replaceState æ›´æ–°æ˜¯ä¸€ä¸ªæ›¿æ¢è¿‡ç¨‹

replaceState()æ–¹æ³•ä¸setState()ç±»ä¼¼ï¼Œä½†æ˜¯æ–¹æ³•åªä¼šä¿ç•™nextStateä¸­çŠ¶æ€ï¼ŒåŸstateä¸åœ¨nextStateä¸­çš„çŠ¶æ€éƒ½ä¼šè¢«åˆ é™¤

```js
//ä½¿ç”¨è¯­æ³•ï¼š
replaceState(object nextState[, function callback])

// nextStateï¼Œå°†è¦è®¾ç½®çš„æ–°çŠ¶æ€ï¼Œè¯¥çŠ¶æ€ä¼šæ•´ä¸ªæ›¿æ¢å½“å‰çš„stateã€‚
// callbackï¼Œå¯é€‰å‚æ•°ï¼Œå›è°ƒå‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šåœ¨replaceStateè®¾ç½®æˆåŠŸï¼Œä¸”ç»„ä»¶é‡æ–°æ¸²æŸ“åè°ƒç”¨ã€‚
```


# 13. props å±æ€§

## 13.1. åœ¨ jsx ä¸­éå† props

ä½¿ç”¨ "..." éå† props

```js
var props = {
    style: "width:20px",// æŠ¥é”™, å­˜ç–‘; å¯èƒ½styleéœ€è¦å•ç‹¬ä¸€ä¸ªå¯¹è±¡, æˆ–è€… <HelloMessage style={{ color: '#FFFFFF', fontSize: '30px'}} />
    className: "main",
    value: "yo",  // ä¼šè¢«æ›¿æ¢
}

<HelloMessage  {...props} value="yo" />

// ç­‰äºä»¥ä¸‹
React.createElement("h1", React._spread({}, props, {value: "yo"}), "Hello React!");
```

## 13.2. PropTypes ç±»å‹æ£€æŸ¥

```js
import PropTypes from 'prop-types';

class Greeting extends React.Component {
  render() {
    return (
      <h1>Hello, {this.props.name}</h1>
    );
  }
}

Greeting.propTypes = {
  name: PropTypes.string

  // é™åˆ¶æŸä¸ªpropsä¸ºjs"åŸç”Ÿç±»å‹"
  optionalArray: PropTypes.array,
  optionalBool: PropTypes.bool,
  optionalFunc: PropTypes.func,
  optionalNumber: PropTypes.number,
  optionalObject: PropTypes.object,// ä¸æ¨è
  optionalString: PropTypes.string,
  optionalSymbol: PropTypes.symbol,// ç±»ä¼¼äºå­—ç¬¦å‹çš„æ•°æ®ç±»å‹, ç‹¬ä¸€æ— äºŒçš„å€¼, ç»™objectæ–°å¢å±æ€§åç§° let s = Symbol();let s1 = Symbol('s1');(ref:https://www.jianshu.com/p/174f88d189c6)

  // ä»»ä½•å¯è¢«æ¸²æŸ“çš„å…ƒç´ ï¼ˆåŒ…æ‹¬æ•°å­—ã€å­—ç¬¦ä¸²ã€å­å…ƒç´ æˆ–æ•°ç»„ï¼‰ã€‚
  optionalNode: PropTypes.node,//  numbers, strings, elements or an array

  // ä¸€ä¸ª React å…ƒç´ 
  optionalElement: PropTypes.element,// A React element.

  optionalMessage: PropTypes.instanceOf(Message),// æŸä¸ªç±»çš„å®ä¾‹

  optionalEnum: PropTypes.oneOf(['News', 'Photos']),// [æŸä¸ªç³»åˆ—]ä¸­çš„ä¸€ä¸ª, ç±»ä¼¼æšä¸¾ç±»å‹
  optionalUnion: PropTypes.oneOfType([// å‡ ç§ç±»å‹ä¸­çš„ä¸€ä¸ª
    PropTypes.string,
    PropTypes.number,
    PropTypes.instanceOf(Message)
  ]),

  optionalArrayOf: PropTypes.arrayOf(PropTypes.number),// æŸç§ç±»å‹çš„æ•°ç»„

  // ä¸€ä¸ªæŒ‡å®šç±»å‹çš„å¯¹è±¡
  optionalObjectOf: PropTypes.objectOf(PropTypes.number),// å¯¹è±¡, æ‰€æœ‰å±æ€§éƒ½æ˜¯æŸä¸€ç‰¹å®šç±»å‹
  // ä¸€ä¸ªæŒ‡å®šå±æ€§åŠå…¶ç±»å‹çš„å¯¹è±¡
  optionalObjectWithShape: PropTypes.shape({// å¯¹è±¡, è§„å®šå„ä¸ªå±æ€§ä¸åŒçš„ç±»å‹
    color: PropTypes.string,
    fontSize: PropTypes.number
  }),

  // å¿…é¡»ï¼Œ è¿™æ ·å¦‚æœè¿™ä¸ªå±æ€§çˆ¶ç»„ä»¶æ²¡æœ‰æä¾›æ—¶ï¼Œä¼šæ‰“å°è­¦å‘Šä¿¡æ¯
  requiredFunc: PropTypes.func.isRequired,
  requiredAny: PropTypes.any.isRequired,// anyä¸æ¨è

   // ä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰éªŒè¯å™¨ã€‚å®ƒåº”è¯¥åœ¨éªŒè¯å¤±è´¥æ—¶è¿”å›
  // ä¸€ä¸ª Error å¯¹è±¡è€Œä¸æ˜¯ `console.warn` æˆ–æŠ›å‡ºå¼‚å¸¸ã€‚
  // ä¸è¿‡åœ¨ `oneOfType` ä¸­å®ƒä¸èµ·ä½œç”¨ã€‚
  customProp: function(props, propName, componentName) {// è‡ªå®šä¹‰ validator
    if (!/matchme/.test(props[propName])) {
      return new Error(
        'Invalid prop `' + propName + '` supplied to' +
        ' `' + componentName + '`. Validation failed.'
      );
    }
  },
  // è‡ªå®šä¹‰ validator to `arrayOf` and `objectOf`.
  // The validator  will be called for each key in the array or object.
  // The first two arguments of the validator are the array or object itself, and the current item's key.
  customArrayProp: PropTypes.arrayOf(function(propValue, key, componentName, location, propFullName) {
    if (!/matchme/.test(propValue[key])) {
      return new Error(
        'Invalid prop `' + propFullName + '` supplied to' +
        ' `' + componentName + '`. Validation failed.'
      );
    }
  })
};
```

for example:

```js
//  æ³¨æ„ç»„ä»¶å¼€å¤´ç¬¬ä¸€ä¸ªå­—æ¯éƒ½è¦å¤§å†™
class MyComponent extends React.Component {
    // render æ˜¯ Class based ç»„ä»¶å”¯ä¸€å¿…é¡»çš„æ–¹æ³•ï¼ˆmethodï¼‰
    render() {
        return <div>Hello, World!</div>;
    }
}

// PropTypes éªŒè¯ï¼Œè‹¥ä¼ å…¥çš„ props type ä¸ç¬¦åˆå°†ä¼šæ˜¾ç¤ºé”™è¯¯
MyComponent.propTypes = {
    todo: React.PropTypes.object,
    name: React.PropTypes.string
};

// Prop é¢„è®¾å€¼ï¼Œè‹¥å¯¹åº” props æ²¡ä¼ å…¥å€¼å°†ä¼šä½¿ç”¨ default å€¼
MyComponent.defaultProps = {
    todo: {},
    name: ""
};
```

## 13.3. å¼•å…¥ç±»å‹æ£€æŸ¥çš„å…¶ä»–æ–¹æ³•

### 13.3.1. å¼•å…¥ TypeScript

JavaScript çš„è¶…é›†

https://react-typescript-cheatsheet.netlify.app/docs/basic/setup
https://www.typescriptlang.org/docs/handbook/interfaces.html

```sh
npx create-react-app hook-ts-demo --template typescript

```


### 13.3.2. flow ç±»å‹æ£€æŸ¥

Facebook è‡ªå·±çš„å·¥å…·

## 13.4. è®¾å®š props çš„é»˜è®¤å€¼

```js
class Greeting extends React.Component {
    render() {
        return <h1>Hello, {this.props.name}</h1>;
    }
}

// Specifies the default values for props:
Greeting.defaultProps = {
    name: "Stranger"
};
```

or

```js
class Greeting extends React.Component {
    static defaultProps = {
        name: "stranger"
    };

    render() {
        return <div>Hello, {this.props.name}</div>;
    }
}
```

## 13.5. æœ‰å“ªäº›å±æ€§

å’Œ react-router åˆä½œæ—¶å€™, å°† react-router çš„ history,location,match ä¸‰ä¸ªå¯¹è±¡ç»‘å®šåˆ° props, æ‰“å° props :



# 14. refs 

è¡¨å•å¤„ç†ä¸ç¬¬ä¸‰æ–¹ lib é›†æˆ

ref ä»‹ç»å‚è§æ–‡æ¡£: https://react-cn.github.io/react/docs/more-about-refs.html

ref åœ¨ redux ä¸­ä½¿ç”¨: https://segmentfault.com/a/1190000015172005

å’Œç¬¬ä¸‰æ–¹ js lib é›†ä¹Ÿä¼šç”¨åˆ° Refs

```js
class MarkdownEditor extends React.Component {
    constructor(props) {
        super(props);
        this.handleChange = this.handleChange.bind(this);
        this.rawMarkup = this.rawMarkup.bind(this);
        this.state = {
            value: "Type some *markdown* here!"
        };
    }
    // å¦ä¸€ç§å¤„ç†æ–¹æ³•æ˜¯: å€ŸåŠ© onChange(event), é€šè¿‡ event.target.value æ‹¿åˆ°å®çš„å€¼d
    handleChange() {
        this.setState({ value: this.refs.textarea.value });
    }
    // å°†ä½¿ç”¨è€…è¾“å…¥çš„ Markdown è¯­æ³• parse æˆ HTML æ”¾å…¥ DOM ä¸­ï¼ŒReact é€šå¸¸ä½¿ç”¨ virtual DOM ä½œä¸ºå’Œ DOM æ²Ÿé€šçš„ä¸­ä»‹ï¼Œä¸å»ºè®®ç›´æ¥æ“ä½œ DOMã€‚æ•…ä½¿ç”¨æ—¶çš„å±æ€§ä¸º dangerouslySetInnerHTML
    rawMarkup() {
        const md = new Remarkable();
        return { __html: md.render(this.state.value) };
    }
    render() {
        return (
            <div className="MarkdownEditor">
                <h3>Input</h3>
                <textarea
                    onChange={this.handleChange}
                    // ref å¯ä»¥æ˜¯ä¸€ä¸ªid, ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°
                    ref="textarea"
                    defaultValue={this.state.value}
                />
                <h3>Output</h3>
                <div
                    className="content"
                    dangerouslySetInnerHTML={this.rawMarkup()}
                />
            </div>
        );
    }
}

ReactDOM.render(<MarkdownEditor />, document.getElementById("app"));
```


# 15. åˆæˆäº‹ä»¶

reactä¸ºäº†è§£å†³è·¨å¹³å°ï¼Œå…¼å®¹æ€§é—®é¢˜ï¼Œè‡ªå·±å°è£…äº†ä¸€å¥—äº‹ä»¶æœºåˆ¶ï¼Œä»£ç†äº†åŸç”Ÿçš„äº‹ä»¶ï¼Œåƒåœ¨jsxä¸­å¸¸è§çš„onClickã€onChangeè¿™äº›éƒ½æ˜¯åˆæˆäº‹ä»¶

demo: TodoList app

```js
// TodoApp ç»„ä»¶ä¸­åŒ…å«äº†æ˜¾ç¤º Todo çš„ TodoList ç»„ä»¶ï¼ŒTodo çš„å†…å®¹é€è¿‡ props ä¼ å…¥ TodoList ä¸­ã€‚ç”±äº TodoList ä»…å•çº¯ Render UI ä¸æ¶‰åŠå†…éƒ¨ state æ“ä½œæ˜¯ stateless componentï¼Œæ‰€ä»¥ä½¿ç”¨ Functional Component å†™æ³•ã€‚

// éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ç”¨ map function æ¥è¿­ä»£ Todosï¼Œéœ€è¦ç•™æ„çš„æ˜¯æ¯ä¸ªè¿­ä»£çš„å…ƒç´ å¿…é¡»è¦æœ‰ unique key ä¸ç„¶ä¼šå‘ç”Ÿé”™è¯¯ï¼ˆå¯ä»¥ç”¨è‡ªå®šä¹‰ idï¼Œæˆ–æ˜¯ä½¿ç”¨ map function çš„ç¬¬äºŒä¸ªå‚æ•° indexï¼‰

const TodoList = props => (
    <ul>
        {props.items.map(item => (
            <li key={item.id}>{item.text}</li>
        ))}
    </ul>
);

// æ•´ä¸ª App çš„ä¸»è¦ç»„ä»¶

// æ€ä¹ˆè·å–inputè¡¨å•é¡¹çš„value, æœ‰å¤šç§æ–¹æ³•, è¿™æ˜¯ç¬¬ä¸€ç§: å€ŸåŠ© onchangeäº‹ä»¶å’Œstate

class TodoApp extends React.Component {
    constructor(props) {
        super(props);
        this.onChange = this.onChange.bind(this);
        this.handleSubmit = this.handleSubmit.bind(this);
        this.state = {
            items: [],
            text: ""
        };
    }
    onChange(e) {
        this.setState({ text: e.target.value });
    }
    handleSubmit(e) {
        e.preventDefault();
        const nextItems = this.state.items.concat([
            { text: this.state.text, id: Date.now() }
        ]);
        const nextText = "";
        this.setState({ items: nextItems, text: nextText });
    }
    render() {
        return (
            <div>
                <h3>TODO</h3>
                <TodoList items={this.state.items} />
                <form onSubmit={this.handleSubmit}>
                    <input onChange={this.onChange} value={this.state.text} />
                    <button>{"Add #" + (this.state.items.length + 1)}</button>
                </form>
            </div>
        );
    }
}

// ç¬¬äºŒç§è·å–inputå€¼çš„æ–¹æ³•: å€ŸåŠ© submitäº‹ä»¶

class MyOwnListApp extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            items: []
        };
        this.onSubmit = this.onSubmit.bind(this);
    }
    render() {
        return (
            <div>
                <h3>MyOwnListApp</h3>
                <MyOwnList items={this.state.items}></MyOwnList>
                <form onSubmit={this.onSubmit}>
                    <input type="text" />
                    <button>submit</button>
                </form>
            </div>
        );
    }
    onSubmit(event) {
        event.preventDefault();
        /* this.state.items.push([{// è¿™æ ·å­uiä¸ä¼šè‡ªåŠ¨redraw
            id: Date.now(),
            value: event.target[0].value
        }]); */
        this.setState({
            // ç°åœ¨æ‰ä¼šauto redraw
            items: this.state.items.concat([
                {
                    id: Date.now(),
                    value: event.target[0].value
                }
            ])
        });
        event.target[0].value = ""; // æ¸…ç©º
    }
}

ReactDOM.render(<TodoApp />, document.getElementById("app"));
```

ä¹Ÿå¯ä»¥è‡ªå·±ç»‘å®šåŸç”Ÿäº‹ä»¶:

```js
//æ‰‹åŠ¨ç»‘å®šmousedownäº‹ä»¶
    ReactDom.findDOMNode(this).addEventListener(
      "mousedown",
      this.onClick.bind(this)
    );
```


# 16. çŠ¶æ€ç®¡ç†

Data Flow å’Œ Flux/Redux

Flux æ¶æ„: ä¸€ç§æ–¹ä¾¿åº”ç”¨çŠ¶æ€ç®¡ç†çš„æ¶æ„ -- â€œå•å‘æ•°æ®æµâ€, æ˜¯ React æ¨å´‡çš„ä¸€ç§åº”ç”¨æ¶æ„çš„æ–¹å¼, app è¶³å¤Ÿå¤æ‚æ‰èƒ½ä½“ç°æ–¹ä¾¿ (React æœ¬èº«åªæ¶‰åŠ UI å±‚ï¼Œå¦‚æœæ­å»ºå¤§å‹åº”ç”¨ï¼Œapp çš„ state, ç»„ä»¶ä¹‹é—´çš„é€šä¿¡ ä¼šå˜å¾—æ— æ¯”å¤æ‚, è¿™æ—¶ Flux æ¶æ„å°±æœ‰äº†ç”¨æ­¦ä¹‹åœ°).

æ ¸å¿ƒæ€æƒ³: å½“ view ä¸Šç”¨æˆ·å‘ç”Ÿäº†æ“ä½œ, app ä¼šé€šè¿‡ "Action Creator" åˆ›å»ºä¸€ä¸ª "Action", é€šè¿‡ "Dispatcher" åˆ†å‘å‡ºå», ç”± "Store" è¿›è¡Œå¤„ç†. "Store" å’Œ "View" æ˜¯ç»‘å®šçš„,Store äº§ç”Ÿå˜åŒ–,View ä¹Ÿä¼šåŒæ­¥å˜åŒ–

Redux: æ˜¯ flux æ¶æ„çš„ä¸€ä¸ªå…·ä½“å®ç°ï¼Œ å°† Flux æ¶æ„ ä¸å‡½æ•°å¼ç¼–ç¨‹ç»“åˆä¸€èµ·

åŒç±»: mobx ,Reflux,Flummoxã€‚

åŒæ—¶, å¦‚æœ app æ¯”è¾ƒç®€å•, æ˜¯ä¸éœ€è¦çš„ redux æ¥ç®¡ç† state çš„, redux åªé€‚ç”¨äº"å¤šäº¤äº’ã€å¤šæ•°æ®æº"çš„æƒ…å†µ

## 16.1. flux æ¶æ„çš„æ€æƒ³

https://www.zhihu.com/question/33864532/answer/57667838

```
  â•”â•â•â•â•â•â•â•â•â•â•—       â•”â•â•â•â•â•â•â•â•â•—       â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘ Actions â•‘â”€â”€â”€â”€â”€â”€>â•‘ Stores â•‘â”€â”€â”€â”€â”€â”€>â•‘ View Components â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•       â•šâ•â•â•â•â•â•â•â•â•       â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ^                                      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å°†å„ä¸ªç»„ä»¶çš„ state é›†ä¸­åˆ° Store, ç»Ÿä¸€ç®¡ç†, å„ä¸ªç»„ä»¶å’Œ Store äº¤äº’, ç®€åŒ–ç»„ä»¶ä¹‹é—´çš„é€šä¿¡

View å±‚ä¸èƒ½ç›´æ¥å¯¹ state è¿›è¡Œæ“ä½œï¼Œè€Œéœ€è¦ä¾èµ– Actions æ´¾å‘æŒ‡ä»¤æ¥å‘ŠçŸ¥ Store ä¿®æ”¹çŠ¶æ€ï¼ŒStore æ¥æ”¶ Actions æŒ‡ä»¤åå‘ç”Ÿç›¸åº”çš„æ”¹å˜ï¼ŒView å±‚åŒæ—¶è·Ÿç€ Store çš„å˜åŒ–è€Œå˜åŒ–

ä¸¾ä¸ªä¾‹å­ï¼šA ç»„ä»¶è¦ä½¿ B ç»„ä»¶å‘ç”Ÿå˜åŒ–ã€‚é¦–å…ˆï¼ŒA ç»„ä»¶éœ€è¦å°†è¿™ä¸ªæ„å›¾å°è£…ä¸ºä¸€ä¸ª action æ‰§è¡Œï¼Œå‘ŠçŸ¥ç»‘å®š B ç»„ä»¶çš„ Store å‘ç”Ÿå˜åŒ–ï¼ŒStore æ¥æ”¶åˆ°æ´¾å‘çš„æŒ‡ä»¤åæ”¹å˜ï¼Œé‚£ç›¸åº”çš„ B ç»„ä»¶çš„è§†å›¾ä¹Ÿå°±å‘ç”Ÿäº†æ”¹å˜ã€‚å‡å¦‚ Cï¼ŒDï¼ŒEï¼ŒF ç»„ä»¶ç»‘å®šäº†å’Œ B ç»„ä»¶ç›¸åŒçš„ Storeï¼Œé‚£ä¹ˆ Cï¼ŒDï¼ŒEï¼ŒF ä¹Ÿä¼šè·Ÿç€å˜åŒ–ã€‚

## 16.2. Flux å®˜æ–¹å®ç°

Advantages:

-   è®©å¼€å‘è€…å¯ä»¥å¿«é€Ÿäº†è§£æ•´ä¸ª App ä¸­çš„è¡Œä¸º(åœ¨ store ä¸­çœ‹å°±è¡Œäº†)

-   æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ç»Ÿä¸€å­˜æ”¾å¥½ç®¡ç†

-   è®© View å•çº¯åŒ–åªè´Ÿè´£ UI çš„æ’ç‰ˆä¸éœ€è´Ÿè´£ state ç®¡ç†

Disadvantages:

-   ä»£ç å¿’å¤æ‚äº†, å†™ âœ å°åº”ç”¨ä¸åˆç®—

æœ‰å“ªäº›æ¦‚å¿µ?

-   actions ï¼šä¸€äº›åˆ—åŠ¨ä½œ(å°±æ˜¯å‡½æ•°), è´Ÿè´£å®šä¹‰æ‰€æœ‰æ”¹å˜ stateï¼ˆçŠ¶æ€ï¼‰çš„è¡Œä¸ºï¼Œå¯ä»¥è®©å¼€å‘è€…å¿«é€Ÿäº†è§£ App çš„å„ç§åŠŸèƒ½ï¼Œè‹¥ä½ æƒ³æ”¹å˜ state ä½ åªèƒ½å‘ actionã€‚æ³¨æ„ action å¯ä»¥æ˜¯åŒæ­¥æˆ–æ˜¯éåŒæ­¥

-   Dispatcher : æ˜¯ Flux æ¶æ„çš„æ ¸å¿ƒï¼Œæ¯ä¸ª App åªæœ‰ä¸€ä¸ª Dispatcherï¼Œå¹¶è´Ÿè´£å‘æ‰€æœ‰ store å‘é€ action äº‹ä»¶(store.dispatch())

-   Store: ä¸€ä¸ª App é€šå¸¸ä¼šæœ‰å¤šä¸ª store è´Ÿè´£å­˜æ”¾ä¸šåŠ¡é€»è¾‘ï¼Œæ ¹æ®ä¸åŒä¸šåŠ¡ä¼šæœ‰ä¸åŒ store; store è´Ÿè´£æ“ä½œå’Œå‚¨å­˜æ•°æ®(state);

    -   å€¼å¾—æ³¨æ„çš„æ˜¯ store åªæä¾› getter API è¯»å–èµ„æ–™ï¼Œè‹¥æƒ³æ”¹å˜ state ä¸€å¾‹å‘é€ action;

    -   æä¾› API è®© store å¯ä»¥æ³¨å†Œ callback function(å°±æ˜¯æ³¨å†Œ listener, æŒ‡å®š state æ”¹å˜çš„å›è°ƒå‡½æ•°(ä¸€èˆ¬æ˜¯ setState()è§¦å‘ redraw), EventEmitter.on(actionType, callbackFn))ã€‚

    -   éœ€è¦åœ¨ store é‡Œ, é€šè¿‡ AppDispatcher.register(fn) æ³¨å†Œå¤„ç† action çš„å‡½æ•°(å› ä¸º store æ¨¡å—è¿™é‡Œæ‰èƒ½ç›´æ¥è®¿é—® store å†…éƒ¨çš„ state), å¤„ç†å®Œæ¯•, é€šè¿‡ EventEmitter.emit(actionType) è§¦å‘ listener

-   View: è¿™éƒ¨ä»½æ˜¯ React è´Ÿè´£çš„èŒƒç•´ï¼Œè´Ÿè´£æä¾›ç›‘å¬äº‹ä»¶çš„ callback functionï¼Œå½“äº‹ä»¶å‘ç”Ÿæ—¶é‡æ–°å–å¾—æ•°æ®å¹¶é‡ç»˜ View

## 16.3. Redux

### 16.3.1. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ redux

ä¸‹å›¾å±•ç¤ºäº†ä½¿ç”¨ redux å’Œä¸ä½¿ç”¨ redux æ—¶, state å’Œç»„ä»¶é—´çš„äº¤äº’å…³ç³»:



-   æ•´åˆäº† react-redux åï¼Œæˆ‘ä»¬çš„ React App å°±å¯ä»¥è§£å†³ä¼ ç»Ÿè·¨ Component ä¹‹é—´ä¼ é€’ state çš„é—®é¢˜å’Œå›°éš¾ã€‚åªè¦é€šè¿‡ Provider å°±å¯ä»¥è®©æ¯ä¸ª React App ä¸­çš„ Component å–ç”¨ store ä¸­çš„ stateï¼Œéå¸¸æ–¹ä¾¿
-   æ•°æ®å’Œä¸šåŠ¡é€»è¾‘æ”¾åˆ°äº†ä¸€ä¸ªåœ°æ–¹, ä¸€ç›®äº†ç„¶

### 16.3.2. åŸºæœ¬æ¦‚å¿µ

http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html

-   State: Store å¯¹è±¡å¯ä»¥åŒ…å«å¤šä¸ª èŠ‚ç‚¹ ã€‚å¦‚æœæƒ³å¾—åˆ°æŸä¸ªæ—¶åˆ»çš„æ•°æ®ï¼Œå°±è¦å¯¹ Store ç”Ÿæˆå¿«ç…§ã€‚è¿™ç§æ—¶é—´åˆ‡ç‰‡çš„æ•°æ®é›†åˆï¼Œå°±å«åš State;

    -   å…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ª js å¯¹è±¡, `const state = store.getState();` å¯ä»¥å¾—åˆ°å½“å‰æ—¶åˆ»çš„ state

        ```js
        {
          counter: 0,
          todos: [] // å¾…åŠé¡¹
        }
        ```

    -   ä¸€ä¸ª State å¯¹åº”ä¸€ä¸ª Viewã€‚åªè¦ State ç›¸åŒï¼ŒView å°±ç›¸åŒ.

    -   è‹¥è¦æ”¹å˜ stateï¼Œå¿…é¡» dispatch ä¸€ä¸ª action

-   Action: å°±æ˜¯ View å‘å‡ºçš„é€šçŸ¥ï¼Œè¡¨ç¤º State åº”è¯¥è¦å‘ç”Ÿå˜åŒ–äº†

    -   æœ¬è´¨å°±æ˜¯ä¸€ä¸ª js å¯¹è±¡, ä½†æ˜¯ä¸€å®šè¦åŒ…å«"type "å±æ€§, å…¶ä»–æ²¡æœ‰è¦æ±‚, ä½†æ˜¯ä¹Ÿæœ‰è§„èŒƒ

        ```js
        {
          type: 'ADD_TODO',
          payload: {
            id: 1,
            content: 'å¾…åŠäº‹é¡¹1',
            completed: false
          }
        }
        ```

        å¦‚æœéœ€è¦æ–°å¢ä¸€ä¸ª todo é¡¹ï¼Œå®é™…ä¸Šå°±æ˜¯å°† payload å†™å…¥åˆ° state.todos æ•°ç»„ä¸­

-   Action Creator: å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥ç”Ÿæˆ Action

    -   ç¤ºä¾‹:

        ```js
        var id = 1;
        function addTodo(content) {
            return {
                type: "ADD_TODO",
                payload: {
                    id: id++,
                    content: content, // å¾…åŠäº‹é¡¹å†…å®¹
                    completed: false // æ˜¯å¦å®Œæˆçš„æ ‡è¯†
                }
            };
        }
        ```

    -   Action Creator å¯ä»¥æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥çš„

-   Reducer: Store æ”¶åˆ° Action ä»¥åï¼Œå¿…é¡»ç»™å‡ºä¸€ä¸ªæ–°çš„ Stateï¼Œè¿™æ · View æ‰ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™ç§ State çš„è®¡ç®—è¿‡ç¨‹å°±å«åš Reducerã€‚

    -   Reducer å¿…é¡»æ˜¯åŒæ­¥çš„çº¯å‡½æ•°ï¼Œå®ƒæ¥å— Action å’Œå½“å‰ State ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ State(Reducer å‡½æ•°é‡Œé¢ä¸èƒ½æ”¹å˜ Stateï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡)ã€‚

    -   store.dispatch(action)ä¹‹å, ä¼šè§¦å‘ reducer æ‰§è¡Œ(åˆ›å»º store æ—¶å€™, å°† reducer ä¼ å…¥äº†)

    -   æœ€å¥½æŠŠ State å¯¹è±¡è®¾æˆåªè¯»ã€‚ä½ æ²¡æ³•æ”¹å˜å®ƒï¼Œè¦å¾—åˆ°æ–°çš„ Stateï¼Œå”¯ä¸€åŠæ³•å°±æ˜¯ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œä»»ä½•æ—¶å€™ï¼Œä¸æŸä¸ª View å¯¹åº”çš„ State æ€»æ˜¯ä¸€ä¸ªä¸å˜çš„å¯¹è±¡

        -   (å¯ä»¥å€ŸåŠ© ImutableJs åº“)

        -   å¯ä»¥ä½¿ç”¨ lodash çš„ cloneDeep

        -   ä¹Ÿå¯ä»¥ä½¿ç”¨ Object.assign / map / filter/ ... ç­‰è¿”å›å‰¯æœ¬çš„å‡½æ•°

    -   ç¤ºä¾‹:

        ```js
        var initState = {
            counter: 0,
            todos: []
        };

        function reducer(state, action) {
            // â€» åº”ç”¨çš„åˆå§‹çŠ¶æ€æ˜¯åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œ reducer æ—¶è®¾ç½®çš„ â€»
            if (!state) state = initState;

            switch (action.type) {
                case "ADD_TODO":
                    var nextState = _.cloneDeep(state); // ç”¨åˆ°äº† lodash çš„æ·±å…‹éš†
                    nextState.todos.push(action.payload);
                    return nextState;

                default:
                    // ç”±äº nextState ä¼šæŠŠåŸ state æ•´ä¸ªæ›¿æ¢æ‰
                    // è‹¥æ— ä¿®æ”¹ï¼Œå¿…é¡»è¿”å›åŸ stateï¼ˆå¦åˆ™å°±æ˜¯ undefinedï¼‰
                    return state;
            }
        }
        ```



> Redux æ•°æ®æµçš„æ¨¡å‹å¤§è‡´ä¸Šå¯ä»¥ç®€åŒ–æˆï¼šé¦–å…ˆï¼Œç”¨æˆ·å’Œ view äº¤äº’å‘å‡º Action (åŒ…å« type, data è¿™ä¸¤ä¸ªåŸºæœ¬å±æ€§): `store.dispatch(action);`ç„¶åï¼ŒStore è‡ªåŠ¨è°ƒç”¨ Reducer (å³å¤„ç† action çš„å‡½æ•°)ï¼Œå¹¶ä¸”ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼šå½“å‰ State å’Œæ”¶åˆ°çš„ Actionã€‚ Reducer ä¼šè¿”å›æ–°çš„ State : `let nextState = todoApp(previousState, action);` State ä¸€æ—¦æœ‰å˜åŒ–ï¼ŒStore å°±ä¼šè°ƒç”¨ç›‘å¬å‡½æ•°, ä¹Ÿå°±æ˜¯ `store.subscribe(listener);` ä¸­çš„ listener, listener å¯ä»¥é€šè¿‡`store.getState()`å¾—åˆ°å½“å‰çŠ¶æ€ç„¶å set å›å», å¦‚æœä½¿ç”¨çš„æ˜¯ Reactï¼Œè¿™æ—¶å¯ä»¥è§¦å‘é‡æ–°æ¸²æŸ“ Viewã€‚

-   Web åº”ç”¨æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œè§†å›¾ä¸çŠ¶æ€æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚
-   æ‰€æœ‰çš„çŠ¶æ€ï¼Œä¿å­˜åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œé¢ (Store)ã€‚
-   æ­¤å¤–, redux æœ‰ synchronousï¼ˆåŒæ­¥ï¼‰çš„æƒ…å½¢ï¼Œasynchronousï¼ˆéåŒæ­¥ï¼‰æƒ…å½¢

### 16.3.3. åŸºæœ¬ api

https://github.com/kenberkeley/redux-simple-tutorial/blob/master/redux-advanced-tutorial.md

#### 16.3.3.1. store

`const store = createStore(reducer)`

-   getState()
-   dispatch(action)
-   subscribe(listener)

ä¸‹é¢çœ‹çœ‹è¯¦ç»†è§£é‡Š:

Store: Redux åªæœ‰ä¸€ä¸ª Store è´Ÿè´£å­˜æ”¾æ•´ä¸ª App çš„ State, ä¸€ä¸ª Store å¯ä»¥åŒ…å«å¤šä¸ª state èŠ‚ç‚¹, ä¸€ä¸ª state èŠ‚ç‚¹ å¯¹åº”ä¸€ä¸ª reducer; å”¯ä¸€èƒ½æ”¹å˜ State çš„æ–¹æ³•åªæœ‰é€šè¿‡ store å‘é€ actionã€‚

æ€ä¹ˆåˆ›å»º?

createStore(reducer, [preloadedState], [enhancer]) ç”Ÿæˆ store, å¸¸ç”¨ `const store = createStore(reducer);` createStore å‡½æ•°æ¥å—å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿”å›æ–°ç”Ÿæˆçš„ Store å¯¹è±¡

-   ç¬¬ä¸€ä¸ªå‚æ•°æ”¾å…¥æˆ‘ä»¬çš„ reducer æˆ–æ˜¯æœ‰å¤šä¸ª reducers combineï¼ˆä½¿ç”¨ combineReducers()ï¼‰åœ¨ä¸€èµ·çš„ rootReducersã€‚

-   ç¬¬äºŒä¸ªå‚æ•°æˆ‘ä»¬ä¼šæ”¾å…¥å¸Œæœ›é¢„å…ˆè½½å…¥çš„ state ä¾‹å¦‚ï¼šuser session ç­‰ã€‚(å¦‚æœæä¾›äº†è¿™ä¸ªå‚æ•°ï¼Œå®ƒä¼šè¦†ç›– Reducer å‡½æ•°çš„é»˜è®¤åˆå§‹å€¼ã€‚) ä¸»è¦ç”¨äºå‰åç«¯åŒæ„æ—¶çš„æ•°æ®åŒæ­¥

-   ç¬¬ä¸‰ä¸ªå‚æ•°é€šå¸¸ä¼šæ”¾å…¥æˆ‘ä»¬æƒ³è¦ä½¿ç”¨ç”¨æ¥å¢å¼º Redux åŠŸèƒ½çš„ middlewaresï¼Œè‹¥æœ‰å¤šä¸ª middlewares çš„è¯ï¼Œé€šå¸¸ä¼šä½¿ç”¨ applyMiddleware æ¥æ•´åˆã€‚

çœ‹çœ‹ç¤ºä¾‹:

```js
import { createStore } from 'redux'
...
const store = createStore(reducer, initialState) // initialState ä¸»è¦ç”¨äºå‰åç«¯åŒæ„çš„æ•°æ®åŒæ­¥ï¼ˆè¯¦æƒ…è¯·å…³æ³¨ React æœåŠ¡ç«¯æ¸²æŸ“ï¼‰
```

å±äº Store çš„å››ä¸ªæ–¹æ³•:

-   getState() è·å–å½“å‰æ—¶åˆ»çš„ state

-   dispatch(action) View å‘å‡º Action çš„å”¯ä¸€æ–¹æ³•

    -   å†…éƒ¨ä¼šè§¦å‘ Reducer çš„æ‰§è¡Œ, ä¸ºæ­¤, Store éœ€è¦çŸ¥é“ Reducer å‡½æ•°, åšæ³•å°±æ˜¯åœ¨ç”Ÿæˆ Store çš„æ—¶å€™, å°† Reducer ä¼ å…¥ createStore æ–¹æ³•.

-   subscribe(listener) è®¾ç½®ç›‘å¬å‡½æ•°ï¼Œä¸€æ—¦ State å‘ç”Ÿå˜åŒ–ï¼Œå°±è‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªå‡½æ•°

    -   åªè¦æŠŠ View çš„æ›´æ–°å‡½æ•°ï¼ˆå¯¹äº React é¡¹ç›®ï¼Œå°±æ˜¯ç»„ä»¶çš„ render æ–¹æ³•æˆ– setState æ–¹æ³•ï¼‰æ”¾å…¥ listenï¼Œå°±ä¼šå®ç° View çš„è‡ªåŠ¨æ¸²æŸ“ã€‚

    -   store.subscribe æ–¹æ³•è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°å°±å¯ä»¥è§£é™¤ç›‘å¬ã€‚

-   replaceReducer(nextReducer) ä¸€èˆ¬åœ¨ Webpack Code-Splitting æŒ‰éœ€åŠ è½½çš„æ—¶å€™ç”¨

#### 16.3.3.2. reducer

reducer å°±æ˜¯ä¸€ä¸ªå‡½æ•°, æ¥æ”¶ old state å’Œ action, ç”Ÿæˆ new state;

combineReducersï¼šcombineReducers(reducers) , combineReducers å¯ä»¥å°†å¤šä¸ª reducers è¿›è¡Œæ•´åˆå¹¶å›ä¼ ä¸€ä¸ª

```js
import { combineReducers } from 'redux';

// è¿™ç§å†™æ³•æœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯ State çš„å±æ€§åå¿…é¡»ä¸å­ Reducer åŒå
const chatReducer = combineReducers({
  chatLog,
  statusMessage,
  userName
})

// å¦‚æœä¸åŒåï¼Œå°±è¦é‡‡ç”¨ä¸‹é¢çš„å†™æ³•
// æ ¹æ® State çš„ key å»æ‰§è¡Œç›¸åº”çš„å­ Reducerï¼Œå¹¶å°†è¿”å›ç»“æœåˆå¹¶æˆä¸€ä¸ªå¤§çš„ State å¯¹è±¡ã€‚
const reducer = combineReducers({
  a: doSomethingWithA,
  b: processB,`
  c: c
})
// ç­‰åŒäº
function reducer(state = {}, action) {
  return {
    a: doSomethingWithA(state.a, action),
    b: processB(state.b, action),
    c: c(state.c, action)
  }
}

export default todoApp;
```

#### 16.3.3.3. applyMiddleware

redux æä¾›çš„å·¥å…·å‡½æ•°

applyMiddleware(...middlewares) è®©å¼€å‘è€…å¯ä»¥åœ¨ req å’Œ res ä¹‹é—´è¿›è¡Œä¸€äº›æ“ä½œã€‚åœ¨ Redux ä¸­ Middleware åˆ™æ˜¯æ‰®æ¼” action åˆ°è¾¾ reducer å‰çš„ç¬¬ä¸‰æ–¹æ‰©å……ã€‚è€Œ applyMiddleware å¯ä»¥å°†å¤šä¸ª middlewares æ•´åˆå¹¶å›ä¼ ä¸€ä¸ª Functionï¼Œä¾¿äºä½¿ç”¨ã€‚

#### 16.3.3.4. bindActionCreators

å·¥å…·å‡½æ•°

bindActionCreators(actionCreators, dispatch) bindActionCreators å¯ä»¥å°† actionCreators å’Œ dispatch ç»‘å®šï¼Œå¹¶å›ä¼ ä¸€ä¸ª Function ã€‚ä½†è‹¥æ˜¯ä½¿ç”¨ react-redux å¯ä»¥ç”¨ connect è®© dispatch è¡Œä¸ºæ›´å®¹æ˜“ç®¡ç†

-   compose(...functions) å°† function ç”±å³åˆ°å·¦åˆå¹¶å¹¶å›ä¼ ä¸€ä¸ª Function

    ```js
    const store = createStore(
        reducer,
        compose(applyMiddleware(thunk), DevTools.instrument())
    );
    ```

### 16.3.4. çº¯ redux çš„ api ç¤ºä¾‹(åŒæ­¥ç‰ˆæœ¬çš„ api)

```js
import React from "react";
import { createStore, combineReducers, bindActionCreators } from "redux";

function run() {
    // Store initial state
    const initialState = { count: 0 };

    // reducer
    // ä»£è¡¨ state çš„å¤„ç†é€»è¾‘
    const counter = (state = initialState, action) => {
        switch (action.type) {
            case "PLUS_ONE":
                return { count: state.count + 1 };
            case "MINUS_ONE":
                return { count: state.count - 1 };
            case "CUSTOM_COUNT":
                return {
                    count: state.count + action.payload.count
                };
            default:
                break;
        }
        return state;
    };

    const todos = (state = {}) => state; // å¾…æ·»åŠ åˆ° Store ä¸­çš„æ–°èŠ‚ç‚¹

    // Create store
    const store = createStore(
        // combineReducers å¯ä»¥å¸®åŠ©ç»´æŠ¤å¤šä¸ª state è¿› store ä¸­
        //è¿™æ · Store ä¸­å°±æœ‰ ä¸¤ä¸ªèŠ‚ç‚¹äº†
        combineReducers({
            todos,
            counter
        })
    );

    // Action creator
    function plusOne() {
        // action
        return { type: "PLUS_ONE" };
    }

    function minusOne() {
        return { type: "MINUS_ONE" };
    }

    function customCount(count) {
        return { type: "CUSTOM_COUNT", payload: { count } };
    }

    // bindActionCreators æ˜¯ redux æä¾›çš„å·¥å…·å‡½æ•°, å°† dispatcher ç»‘å®šåˆ° action å†…éƒ¨
    // çœæ‰äº†æ‰‹åŠ¨ dispatch è¿™ç›´æ¥è°ƒç”¨action å³å¯
    plusOne = bindActionCreators(plusOne, store.dispatch);

    store.subscribe(() => console.log(store.getState()));
    // store.dispatch(plusOne());
    plusOne();
    store.dispatch(minusOne());
    store.dispatch(customCount(5));
}
export default () => (
    <div>
        <button onClick={run}>Run</button>
        <p>* è¯·æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹è¿è¡Œç»“æœ</p>
    </div>
);
```

### 16.3.5. react-redux

react-redux æä¾› ä¸€ä¸ªå‡½æ•° `connect`, é€šè¿‡é«˜é˜¶ç»„ä»¶çš„æ–¹å¼, å°† redux ä¸­çš„ store å’Œ react ä¸­çš„ component é“¾æ¥èµ·æ¥

```jsx
import React from "react";
import { bindActionCreators, createStore } from "redux";
import { Provider, connect } from "react-redux";

// Store initial state
const initialState = { count: 0 };

// reducer
const counter = (state = initialState, action) => {
    switch (action.type) {
        case "PLUS_ONE":
            return { count: state.count + 1 };
        case "MINUS_ONE":
            return { count: state.count - 1 };
        case "CUSTOM_COUNT":
            return { count: state.count + action.payload.count };
        default:
            break;
    }
    return state;
};

// Create store
const store = createStore(counter);

// Action creator
function plusOne() {
    // action
    return { type: "PLUS_ONE" };
}

function minusOne() {
    return { type: "MINUS_ONE" };
}

export class Counter extends React.Component {
    render() {
        // åœ¨è¿™é‡Œé€šè¿‡ props å¯ä»¥æ‹¿åˆ° state ä¸­æˆ‘ä»¬å…³å¿ƒçš„æ•°æ® å’Œ actions
        const { count, plusOne, minusOne } = this.props;
        return (
            <div className="counter">
                <button onClick={minusOne}>-</button>
                <span style={{ display: "inline-block", margin: "0 10px" }}>
                    {count}
                </span>
                <button onClick={plusOne}>+</button>
            </div>
        );
    }
}

/**
 * bind state data of which wo take care to props
 * ç»‘å®šstateä¸­æˆ‘ä»¬å…³å¿ƒçš„æ•°æ®åˆ° props (ä¸èƒ½æ•´ä¸ª store ç»‘å®šåˆ° props, å› ä¸º state ä¸­å’Œå½“å‰ç»„ä»¶æ— å…³çš„æ•°æ®æ›´æ–°æ— éœ€å‡ºå‘ç»„ä»¶é‡ç»˜
 * @param state store.getState()
 */
function mapStateToProps(state) {
    return {
        count: state.count
    };
}

/**
 * ç»‘å®š action åˆ° props
 * @param dispatch
 */
function mapDispatchToProps(dispatch) {
    return bindActionCreators({ plusOne, minusOne }, dispatch);
}

// è¿æ¥
const ConnectedCounter = connect(mapStateToProps, mapDispatchToProps)(Counter);

export default class CounterSample extends React.Component {
    render() {
        return (
            // æ ¹èŠ‚ç‚¹é€šè¿‡ Provider æä¾› store, å­ç»„ä»¶å°±å¯ä»¥éšæ—¶è®¿é—® store ä¸­çš„æ•°æ®
            <Provider store={store}>
                <ConnectedCounter />
            </Provider>
        );
    }
}
```

### 16.3.6. å¼‚æ­¥ Action

è¦ä½¿ç”¨ asynchronousï¼ˆéåŒæ­¥ï¼‰çš„è¡Œä¸ºçš„è¯éœ€è¦ä½¿ç”¨å…¶ä¸­ä¸€ç§ middlewareï¼š redux-thunkã€redux-promise æˆ– redux-promise-middleware ï¼Œè¿™æ ·å¯ä»¥è®©ä½ åœ¨ actions ä¸­ dispatch Promises è€Œé functionã€‚



è¿‡ç¨‹æ˜¯è¿™æ ·çš„: ç”¨æˆ·åœ¨ view è§¦å‘ä¸€ä¸ª action (å°±æ˜¯æ™®é€š action å¹¶æ²¡æœ‰æ‰€è°“çš„ å¼‚æ­¥ action), å¹¶æ²¡æœ‰è¢« dispatch ç»™ reducer, è€Œæ˜¯è¢« Middlewares æ‹¦æˆª, å†…éƒ¨å¤„ç†å, ç”Ÿæˆæ–°çš„æ ‡å‡†çš„ action ,ç»™ reducer;

æ‰€è°“çš„ å¼‚æ­¥ action, å¹¶ä¸æ˜¯ç‰¹æ®Šçš„ action, è€Œæ˜¯å¤šä¸ª action çš„ç»„åˆä½¿ç”¨

Middleware åœ¨ dispatcher ä¸­å¯¹ action è¿›è¡Œæ‹¦æˆªè¿›è¡Œç‰¹æ®Šå¤„ç†

### 16.3.7. thunk, saga

todo

### 16.3.8. è°ƒè¯•å·¥å…·

Redux å¼€å‘è°ƒè¯•å·¥å…·ï¼šredux-devtools
React åº”ç”¨æ— åˆ·æ–°ä¿å­˜å·¥å…·ï¼šreact-transform

### 16.3.9. demo(ä¸€ä¸ª todo-app)



æ•´ä¸ª React Redux App çš„èµ„æ–™æµç¨‹å›¾ï¼ˆä½¿ç”¨è€…ä¸ View äº’åŠ¨ => dispatch å‡º Action => Reducers ä¾æ® action tyoe åˆ†é…åˆ°å¯¹åº”å¤„ç†æ–¹å¼ï¼Œå›ä¼ æ–°çš„ state => é€è¿‡ React Redux ä¼ é€ç»™ Reactï¼ŒReact é‡æ–°ç»˜åˆ¶ Viewï¼‰ï¼š

react-redux æ•´åˆ react å’Œ redux,



## 16.4. Redux å’Œ Flux çš„ä¸€äº›å·®å¼‚



-   åªä½¿ç”¨ä¸€ä¸ª store å°†æ•´ä¸ªåº”ç”¨ç¨‹å¼çš„çŠ¶æ€ (state) ç”¨ç‰©ä»¶æ ‘ (object tree) çš„æ–¹å¼å‚¨å­˜èµ·æ¥; åŸç”Ÿçš„ Flux ä¼šæœ‰è®¸å¤šåˆ†æ•£çš„ store å‚¨å­˜å„ä¸ªä¸åŒçš„çŠ¶æ€

    ```js
    //åŸç”Ÿ Flux çš„ store
    const userStore = {
        name: ""
    };
    const todoStore = {
        text: ""
    };

    // Redux çš„å•ä¸€ store
    const state = {
        userState: {
            name: ""
        },
        todoState: {
            text: ""
        }
    };
    ```

-   Redux å¹¶æ²¡æœ‰åƒ Flux è®¾è®¡æœ‰ Dispatcher(å”¯ä¸€å¯ä»¥æ”¹å˜ state çš„æ–¹æ³•å°±æ˜¯å‘é€ actionï¼Œè¿™éƒ¨ä»½å’Œ Flux ç±»ä¼¼, action éƒ½æ˜¯ä¸€ä¸ªåŒ…å« type å’Œ payload çš„å¯¹è±¡); Redux æ‹¥æœ‰ Flux æ‰€æ²¡æœ‰çš„ Reducerã€‚Reducer æ ¹æ® action çš„ type å»æ‰§è¡Œå¯¹åº”çš„ state åšå˜åŒ–çš„å‡½å¼å«åš Reducerã€‚ä½ å¯ä»¥ä½¿ç”¨ switch æˆ–æ˜¯ä½¿ç”¨å‡½å¼ mapping çš„æ–¹å¼å»å¯¹åº”å¤„ç†çš„æ–¹å¼

-   Redux æ‹¥æœ‰è®¸å¤šæ–¹ä¾¿å¥½ç”¨çš„è¾…åŠ©æµ‹è¯•å·¥å…·ï¼ˆä¾‹å¦‚ï¼šredux-devtoolsã€react-transform-boilerplateï¼‰ï¼Œæ–¹ä¾¿æµ‹è¯•å’Œä½¿ç”¨ Hot Module Reloadã€‚

## 16.5. ImmutableJS

https://www.youtube.com/watch?v=I7IdS-PbEgI
http://react-immutable-proptypes/ (é€‚ç”¨äº imutable çš„ proptypes éªŒè¯)

ä¸ºä»€ä¹ˆéœ€è¦ ä¸å¯å˜æ•°æ®?

-   ä¼˜åŒ–æ€§èƒ½ (react åˆ¤æ–­ç»„ä»¶æ˜¯å¦è¦åˆ·æ–°æ˜¯æ ¹æ® state æ˜¯å¦æœ‰å˜åŒ–æ¥å†³å®šçš„, é‡‡ç”¨ä¸å¯å˜æ•°æ®é‚£ä¹ˆ state ä¸€æ—¦, react å¯ä»¥æ¯”è¾ƒ æ–°æ—§ ä¸¤ä¸ª state æ˜¯å¦æ˜¯ä¸€ä¸ªå¯¹è±¡æ¥å†³å®šæ˜¯å¦åˆ·æ–°ç»„ä»¶, è€Œä¸å¿…è¿›å…¥ state å†…éƒ¨å»æ¯”è¾ƒå±æ€§æ˜¯å¦æœ‰å˜åŒ–)
-   å®¹æ˜“è°ƒè¯•è·Ÿè¸ª (éšæ—¶å¯ä»¥çœ‹åˆ° æ–°æ—§ stat çš„å…·ä½“å€¼, å¯ä»¥æ–¹ä¾¿çš„å¯¹æ¯”)

redux è¿è¡Œçš„åŸºç¡€éœ€è¦ä¿ state æ˜¯ä¸å¯å˜æ•°æ®

es6 åŸç”Ÿæä¾› api ä¸å¯å˜æ•°æ®ä¿®æ”¹:

```js
const state = {
    filter: "completed",
    todos: ["a"]
};
// å†™æ³•1:
const newState = {
    ...state,
    todos: [...state.todos, "b"]
};
// å†™æ³•2
const newState2 = Object.assign({}, state, { todos: [...state.todos, "b"] });
```

ImmutableJs æä¾›äº†ä¿®æ”¹å·¥å…·ç±»:

```js
import update from 'immutability-helper';

...
```

immer ä¹Ÿæœ‰ç›¸å…³å·¥å…·ç±»:

```js
import produce from 'immer';

...
```

ImmutableJS å°è£…äº†è‡ªå·±çš„æ•°æ®ç»“æ„: 7 ç§ä¸å¯ä¿®æ”¹çš„ç±»å‹ï¼šListã€Mapã€Stackã€OrderedMapã€Setã€OrderedSetã€Recordã€‚

```js
import Immutable from "immutable";

var map1 = Immutable.Map({ a: 1, b: 3 });
var map2 = map1.set("a", 2); // è¿”å›ä¸€ä¸ªæ–°çš„map

map1.get("a"); // 1
map2.get("a"); // 2
```

```js
const Map= Immutable.Map;

// 1. Map å¤§å°
const map1 = Map({ a: 1 });
map1.size
// => 1

// 2. æ–°å¢æˆ–å–ä»£ Map å…ƒç´ 
// set(key: K, value: V)
const map2 = map1.set('a', 7);
// => Map { "a": 7 }

// 3. åˆ é™¤å…ƒç´ 
// delete(key: K)
const map3 = map1.delete('a');
// => Map {}

// 4. æ¸…é™¤ Map å†…å®¹
const map4 = map1.clear();
// => Map {}

// 5. æ›´æ–° Map å…ƒç´ 
// update(updater: (value: Map<K, V>) => Map<K, V>)
// update(key: K, updater: (value: V) => V)
// update(key: K, notSetValue: V, updater: (value: V) => V)
const map5 = map1.update('a', () => (7))
// => Map { "a": 7 }

// 6. åˆå¹¶ Map
const map6 = Map({ b: 3 });
map1.merge(map6);
// => Map { "a": 1, "b": 3 }
--------------------------
const List= Immutable.List;

// 1. å–å¾— List é•¿åº¦
const arr1 = List([1, 2, 3]);
arr1.size
// => 3

// 2. æ–°å¢æˆ–å–ä»£ List å…ƒç´ å†…å®¹
// set(index: number, value: T)
// å°† index ä½ç½®çš„å…ƒç´ æ›¿æ¢
const arr2 = arr1.set(-1, 7);
// => [1, 2, 7]
const arr3 = arr1.set(4, 0);
// => [1, 2, 3, undefined, 0]

// 3. åˆ é™¤ List å…ƒç´ 
// delete(index: number)
// åˆ é™¤ index ä½ç½®çš„å…ƒç´ 
const arr4 = arr1.delete(1);
// => [1, 3]

// 4. æ’å…¥å…ƒç´ åˆ° List
// insert(index: number, value: T)
// åœ¨ index ä½ç½®æ’å…¥ value
const arr5 = arr1.insert(1, 2);
// => [1, 2, 2, 3]

// 5. æ¸…ç©º List
// clear()
const arr6 = arr1.clear();
// => []
------------------------
const Set= Immutable.Set;

// 1. å»ºç«‹ Set
const set1 = Set([1, 2, 3]);
// => Set { 1, 2, 3 }

// 2. æ–°å¢å…ƒç´ 
const set2 = set1.add(1).add(5);
// => Set { 1, 2, 3, 5 }
// ç”±äº Set ä¸ºä¸èƒ½é‡å¤é›†åˆï¼Œæ•… 1 åªèƒ½å‡ºç°ä¸€æ¬¡

// 3. åˆ é™¤å…ƒç´ 
const set3 = set1.delete(3);
// => Set { 1, 2 }

// 4. å–è”é›†
const set4 = Set([2, 3, 4, 5, 6]);
set1.union(set4);
// => Set { 1, 2, 3, 4, 5, 6 }

// 5. å–äº¤é›†
set1.intersect(set4);
// => Set { 2, 3 }

// 6. å–å·®é›†
set1.subtract(set4);
// => Set { 1 }
```

# 17. è·¯ç”± react-router

è·¯ç”±(routing)åº“, é€šè¿‡ URL çš„å˜åŒ–æ¥ç®¡ç†å¯¹åº”çš„çŠ¶æ€å’Œç»„ä»¶.

ä¼ ç»Ÿçš„ Web å¼€å‘ä¸»è¦æ˜¯ç”±æœåŠ¡å™¨ç®¡ç† URL Routing å’Œæ¸²æŸ“ HTML é¡µé¢ï¼Œè¿‡å¾€æ¯æ¬¡ URL ä¸€æ¢, å°±éœ€è¦é‡æ–° server ç«¯é‡æ–°è½½å…¥é¡µé¢ã€‚ç°åœ¨è¿›åŒ–åˆ°ç”±å‰ç«¯è´Ÿè´£ URL çš„ routing ç®¡ç†. åœ¨ React å¼€å‘ä¸–ç•Œä¸­ä¸»æµæ˜¯ä½¿ç”¨ react-router

æœ€æ–°ç‰ˆ: React Router4(https://github.com/ReactTraining/react-router), 2.x æœ¬ç‰ˆæ˜¯ static route, 4.x ç‰ˆæœ¬æ˜¯ dynamic route

React Router è¢«æ‹†åˆ†æˆä¸‰ä¸ªåŒ…ï¼šreact-router(æœ€å°æ ¸å¿ƒ, åŒ…å«è¿›åé¢ä¸¤ä¸ªäº†),react-router-dom(web)å’Œ react-router-native(app)ã€‚react-router æä¾›æ ¸å¿ƒçš„è·¯ç”±ç»„ä»¶ä¸å‡½æ•°ã€‚å…¶ä½™ä¸¤ä¸ªåˆ™æä¾›è¿è¡Œç¯å¢ƒï¼ˆå³æµè§ˆå™¨ä¸ react-nativeï¼‰æ‰€éœ€çš„ç‰¹å®šç»„ä»¶

## 17.1. è·¯ç”±æ ‡ç­¾çš„ä½¿ç”¨

### 17.1.1. Router-è·¯ç”±å®¹å™¨

æœ‰å‡ ä¸ªå®ç°:

```

-   <BrowserRouter>ï¼šä½¿ç”¨ HTML5 æä¾›çš„ history API æ¥ä¿æŒ UI å’Œ URL çš„åŒæ­¥ï¼›éœ€è¦ server ç«¯çš„é…åˆ

-   <HashRouter>ï¼šä½¿ç”¨ URL çš„ hash, å¸¦æœ‰ "#"çš„ url (ä¾‹å¦‚ï¼šwindow.location.hash); ç”¨äºæ”¯æŒä½ç‰ˆæœ¬çš„æµè§ˆå™¨

-   <MemoryRouter>ï¼šèƒ½åœ¨å†…å­˜ä¿å­˜ä½  â€œURLâ€ çš„å†å²çºªå½•(å¹¶æ²¡æœ‰å¯¹åœ°å€æ è¯»å†™)ï¼›é¡µé¢å˜åŠ¨ä¸ä¼šåæ˜ åˆ°æµè§ˆå™¨åœ°å€æ 

-   <NativeRouter>ï¼šä¸ºä½¿ç”¨ React Native æä¾›è·¯ç”±æ”¯æŒï¼›

-   <StaticRouter>ï¼šä»ä¸ä¼šæ”¹å˜åœ°å€ï¼›
```

### 17.1.2. Route-è·¯ç”±ç»„ä»¶æ˜ å°„

è´Ÿè´£ URL å’Œå¯¹åº”çš„ç»„ä»¶æ˜ å°„ï¼Œå¯ä»¥æœ‰å¤šä¸ª Route è§„åˆ™ä¹Ÿå¯ä»¥æœ‰åµŒå¥—ï¼ˆnestedï¼‰Routing

#### 17.1.2.1. å±æ€§

-   pathï¼ˆstringï¼‰: è·¯ç”±åŒ¹é…è·¯å¾„, æ”¯æŒ regex(path="/order/:direction(asc|desc)")ã€‚

    -   æ²¡æœ‰ path å±æ€§çš„ Route æ€»æ˜¯ä¼š åŒ¹é…(æ¸²æŸ“)ï¼‰ï¼›

    -   æœ‰å¤šä¸ª path åŒ¹é…å½“å‰ url, åˆ™å¯¹åº”çš„å¤šä¸ª component éƒ½ä¼šæ˜¾ç¤º ("å¤šåŒ¹é…")

-   component (è¡¨è¾¾å¼): å¯¹åº”çš„ç»„ä»¶

- render: å‡½æ•°, æ¥å—ä¸€ä¸ª props, è¿”å› component

-   exactï¼ˆboolï¼‰ï¼šå‡ºç°æ—¶ï¼Œåˆ™è¦æ±‚è·¯å¾„ä¸ location.pathname å¿…é¡»å®Œå…¨åŒ¹é…, å¯¹åº”ç»„ä»¶æ‰ä¼šæ˜¾ç¤º

-   strictï¼ˆboolï¼‰ï¼štrue çš„æ—¶å€™ï¼Œæœ‰ç»“å°¾æ–œçº¿çš„ path è·¯å¾„åªèƒ½åŒ¹é…æœ‰æ–œçº¿çš„ location.pathnameï¼›

-   location: object `<Route>`å…ƒç´ å°è¯•å°†å…¶è·¯å¾„ä¸å½“å‰ history locationï¼ˆé€šå¸¸æ˜¯å½“å‰æµè§ˆå™¨ URLï¼‰ç›¸åŒ¹é…ã€‚ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥äººä¸ºæŒ‡å®šç‰¹å®šçš„ location è¿›è¡ŒåŒ¹é…

    > Switch ä¸­çš„ location ä¼šè¦†ç›– Route ä¸­çš„ location

-   sensitive: bool è·¯å¾„å¤§å°å†™æ•æ„Ÿ

#### 17.1.2.2. é€šè¿‡ url ä¼ é€’å‚æ•°ç»™ Route

ä¼ é€’: `<Route path="/topic/:id"></Route>`

è·å–: `this.props.match.params`

èƒ½å¤Ÿæ”¾å…¥ url å‚æ•°ä¸­çš„ state ä¿¡æ¯å°½é‡æ”¾ url å‚æ•°ä¸­

```js
import React from "react";
import { BrowserRouter as Router, Route, Link } from "react-router-dom";

const Topic = ({ match }) => <h1>Topic {match.params.id}</h1>;

export default class RouterParams extends React.PureComponent {
    render() {
        return (
            <Router>
                <div>
                    <ul id="menu">
                        <li>
                            <Link to="/topic/1">Topic 1</Link>
                        </li>
                        <li>
                            <Link to="/topic/2">Topic 2</Link>
                        </li>
                        <li>
                            <Link to="/topic/3">Topic 3</Link>
                        </li>
                    </ul>

                    <div id="page-container">
                        <Route path="/topic/:id" component={Topic} />
                    </div>
                </div>
            </Router>
        );
    }
}
```

#### 17.1.2.3. åµŒå¥—è·¯ç”±

```js
import React from "react";
import { BrowserRouter as Router, Route, Link } from "react-router-dom";

const SonCategory = ({ match }) => <h1>Sub Category {match.params.subId}</h1>;

const SubCategory = ({ match }) => (
    <div>
        <h1>Category {match.params.id}</h1>

        <ul id="menu">
            <li>
                <Link to={`/category/${match.params.id}/sub/1`}>
                    Sub Category 1
                </Link>
            </li>
            <li>
                <Link to={`/category/${match.params.id}/sub/2`}>
                    Sub Category 2
                </Link>
            </li>
            <li>
                <Link to={`/category/${match.params.id}/sub/3`}>
                    Sub Category 3
                </Link>
            </li>
        </ul>
        <div id="page-container-2">
            <Route path="/category/:id/sub/:subId" component={SonCategory} />
        </div>
    </div>
);

export default class NestedRoute extends React.PureComponent {
    render() {
        return (
            <Router>
                <div>
                    <ul id="menu">
                        <li>
                            <Link to="/category/1">Category 1</Link>
                        </li>
                        <li>
                            <Link to="/category/2">Category 2</Link>
                        </li>
                        <li>
                            <Link to="/category/3">Category 3</Link>
                        </li>
                    </ul>

                    <div id="page-container">
                        <Route path="/category/:id" component={SubCategory} />
                    </div>
                </div>
            </Router>
        );
    }
}
```

#### 17.1.2.4. Route ä¸‰ç§æ¸²æŸ“æ–¹å¼

Route ä¸‰ç§æ¸²æŸ“å†…å®¹çš„æ–¹æ³•, ä¸å¯åŒæ—¶ä½¿ç”¨, å‡ä¼šè®¾ç½® match, location, history åœ¨ props ä¸­

-   `<Route component=xxxç±»>`ï¼šå½“ location åŒ¹é…åˆ° path æ—¶å€™, ä¼š renderï¼Œroute props ä¹Ÿä¼šéšç€ä¸€èµ·è¢«æ¸²æŸ“ï¼›

    > ä¸è¦æä¾› inline function, å› ä¸ºå¦‚æœè¿™æ ·, æ¯æ¬¡ render, éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ component(the router uses React.createElement to create a new React element from the given component. That means if you provide an inline function to the component prop, you would create a new component every render.)

-   `<Route render=xxxå‡½æ•°>`ï¼šè¿™ç§æ–¹å¼å¯¹äºå†…è”æ¸²æŸ“å’ŒåŒ…è£… Route å´ä¸å¼•èµ·æ„æ–™ä¹‹å¤–çš„é‡æ–°æŒ‚è½½ç‰¹åˆ«æ–¹ä¾¿ï¼›

    > Route component çš„ä¼˜å…ˆçº§è¦æ¯” Route render é«˜

-   `<Route children=xxxå‡½æ•°>`ï¼šä¸ render å±æ€§çš„å·¥ä½œæ–¹å¼åŸºæœ¬ä¸€æ ·ï¼Œé™¤äº† `å®ƒæ˜¯ä¸ç®¡åœ°å€åŒ¹é…ä¸å¦éƒ½ä¼šè¢«è°ƒç”¨`ï¼›

    å½“æ²¡æœ‰åŒ¹é…ä¸Š, match ä¸º null, å¯ä»¥å€ŸåŠ©è¿™ä¸€ç‰¹æ€§, æ›´å…·æ˜¯å¦åŒ¹é…ä¸Šäº†è®¾ç½®åŠ¨æ€çš„æ ·å¼

### 17.1.3. Switch-è§£å†³å¤šåŒ¹é…é—®é¢˜

å†…éƒ¨åŒ…å«çš„ Router/Redirect åŒ¹é…ç¬¬ä¸€ä¸ªå°±ä¸å†ç»§ç»­å¾€ä¸‹åŒ¹é…äº†

-   location: object å¯ä»¥è®¤ä¸ºçš„æŒ‡å®š location æ¥å†³å®šå“ªä¸ª child è¢« render, ä¸€èˆ¬ä¸æŒ‡å®š, æ ¹æ®æµè§ˆå™¨ location å†³å®šæ˜¯å“ªä¸ª child è¢« render

    > è¿™é‡Œçš„ location ä¼šè¦†ç›– Route ä¸­çš„ location

### 17.1.4. Redirect-é‡å®šå‘å½“å‰é¡µé¢

å…¸å‹åœºæ™¯: ç™»é™†åˆ¤æ–­

-   to é‡å®šå‘è·¯å¾„

### 17.1.5. Link-è¶…é“¾æ¥

ä¸ä¼šè§¦æµè§ˆå™¨åˆ·æ–°

-   toï¼ˆstring/objectï¼‰ï¼šè¦è·³è½¬çš„è·¯å¾„æˆ–åœ°å€ï¼›

-   replaceï¼ˆboolï¼‰ï¼šä¸º true æ—¶ï¼Œç‚¹å‡»é“¾æ¥åå°†ä½¿ç”¨æ–°åœ°å€æ›¿æ¢æ‰è®¿é—®å†å²è®°å½•é‡Œé¢çš„åŸåœ°å€ï¼›ä¸º false(é»˜è®¤) æ—¶ï¼Œç‚¹å‡»é“¾æ¥åå°†åœ¨åŸæœ‰è®¿é—®å†å²è®°å½•çš„åŸºç¡€ä¸Šæ·»åŠ ä¸€ä¸ªæ–°çš„çºªå½•

### 17.1.6. NavLink: å¸¦æ ·å¼çš„ Link

ä¼šæ·»åŠ é€‰ä¸­çŠ¶æ€çš„æ ·å¼

-   activeClassName: string æ¿€æ´»æ—¶å€™çš„ className, é»˜è®¤å€¼ active(å¤–éƒ¨å¼•å…¥ css æ–‡ä»¶çš„æ—¶å€™è²Œä¼¼ä¸å¥½ä½¿, å­˜ç–‘)

-   activeStyle: object é€šè¿‡ inline æ–¹å¼å¼•å…¥æ ·å¼

-   exact: bool ç²¾ç¡®åŒ¹é…æ¨¡å¼, strict: bool url æœ«å°¾éœ€è¦"/", æ¯”å¦‚ to="/events/"

-   isActive: func(match, location) è‡ªå®šä¹‰å‡½æ•°åˆ¤æ–­æ˜¯å¦æ¿€æ´»çŠ¶æ€

-   location: object å¯ä»¥è®¾å®šä¸€ä¸ª location å¯¹è±¡

### 17.1.7. Prompt-æç¤º

æ»¡è¶³æ¡ä»¶æ—¶ä¼šæç¤ºç”¨æˆ·æ˜¯å¦ç¦»å¼€å½“å‰é¡µé¢

-   when æ¡ä»¶é€»è¾‘
-   message æç¤ºä¿¡æ¯

## 17.2. history

history is mutableï¼Œ å› æ­¤æ¨èè¿™æ ·è·å– location: this.props.location

```js
class Comp extends React.Component {
    componentWillReceiveProps(nextProps) {
        // will be true
        const locationChanged = nextProps.location !== this.props.location;

        // INCORRECT, will *always* be false because history is mutable.
        const locationChanged =
            nextProps.history.location !== this.props.history.location;
    }
}
```

## 17.3. location

location é•¿è¿™æ ·

```js
{
  key: 'ac3df4', // not with HashHistory!
  pathname: '/somewhere'
  search: '?some=search-string',
  hash: '#howdy',
  state: {
    xxx: xxx
  }
}
```

router å°†åœ¨è¿™äº›åœ°æ–¹æä¾› location å¯¹è±¡:

-   `Route component` as `this.props.location`

-   `Route render` as `({ location }) => ()`

-   `Route children` as `({ location }) => ()`

-   `withRouter` as `this.props.location`

A location object is never mutated , æ‰€ä»¥å¯ä»¥é€šè¿‡å®ƒåœ¨ lifecycle hooks ä¸­æ¥å†³å®šä½•æ—¶æ€ä¹ˆå¯¼èˆª(è·å–æ•°æ®å’ŒåŠ¨ç”»è¿‡æ¸¡ç‰¹åˆ«æœ‰ç”¨)

```js
componentWillReceiveProps(nextProps) {
  if (nextProps.location !== this.props.location) {
    // navigated!
  }
}
```

è¿™äº›åœ°æ–¹å¯ä»¥è®¾ç½® location å¯¹è±¡æ¥ä»£æ›¿ string å½¢å¼çš„ url patern:

-   Web `Link to`
-   Native Link to
-   `Redirect to`
-   history.push
-   history.replace

```js
const location = {
    pathname: "/somewhere",
    state: { fromDashboard: true }
};
```

## 17.4. match

# 18. è°ƒè¯•å’Œæµ‹è¯•

chrome è°ƒè¯•æ’ä»¶: React DevTool, Redux DevTool

æ ¼å¼åŒ–: Prettier (å¯ä»¥è‡ªåŠ¨ä¿®æ­£)

ä»£ç é£æ ¼çº¦æŸ: ESLint

æµ‹è¯•: Jest (https://www.v2ex.com/t/854074#reply41), Enzyme

mock å‡æ•°æ®, æ¨¡æ‹Ÿå‡çš„ api: json-serveré…åˆfaker.js

# 19. GraphQL å’Œ Relay

GraphQL æ˜¯ä¸€ç§æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼ˆData Query Languageï¼‰, ä¸»è¦æ˜¯æƒ³è§£å†³ä¼ ç»Ÿ RESTful API æ‰€é‡åˆ°çš„ä¸€äº›é—®é¢˜

Relay æ˜¯æ­é… GraphQL ç”¨äº React çš„ä¸€ä¸ªå®£å‘Šå¼æ•°æ®æ¡†æ¶ï¼Œå¯ä»¥é™ä½ Ajax çš„è¯·æ±‚æ•°é‡

å¥½å¤„ä¸»è¦æ˜¯å¯ä»¥çœæµé‡ï¼Œçœ http è¯·æ±‚æ¬¡æ•°ï¼Œåå¤„å…¶å®æŒºå¤šçš„ï¼Œæ¯”å¦‚é‰´æƒï¼Œé™æµï¼Œç¼“å­˜ï¼Œæ€§èƒ½æµªè´¹ (https://www.pupboss.com/post/2021/experience-sharing-of-graphql-backend/)


# 20. CSS-Module æ¨¡å—åŒ–

è§£å†³äº† css ç±»åçš„å†²çªé—®é¢˜, https://zhuanlan.zhihu.com/p/20495964

ä¸šç•Œå¦ä¸€ç§æ–¹æ¡ˆæ˜¯ BEM ç±»å‘½åæ–¹æ³• ([bem å‘½å](https://www.ibm.com/developerworks/cn/web/1512_chengfu_bem/index.html))

å¦‚æœä½¿ç”¨ webpack, css-loader éœ€è¦å¦‚æ­¤é…ç½®: `'css-loader?modules&localIdentName=[name]__[local]-[hash:base64:5]'`

å¯ä»¥å’Œ `react-css-modules` é…åˆä½¿ç”¨ ([ref](https://segmentfault.com/a/1190000004530909))

https://github.com/camsong/blog/issues/5

http://www.alloyteam.com/2017/03/getting-started-with-css-modules-and-react-in-practice/

css æ¨¡å—åŒ–è¿›åŒ–ï¼šã€æœç´¢ â€œcss modules styled-components åŒºåˆ«â€ã€‘ [1](https://www.zcfy.cc/article/css-evolution-from-css-sass-bem-css-modules-to-styled-components)ï¼Œ[2](http://hkongm.github.io/2018/07/25/ReactStyleTypes/)ï¼Œ[3](http://www.alloyteam.com/2017/05/guide-styled-components/)

åœ¨ create-react-app ä¸­å¦‚ä½•ä½¿ç”¨? -- css æ–‡ä»¶å‘½åä¸º `<componentName>.module.css` å³å¯ä½¿ç”¨ css modules ç‰¹æ€§

# 21. css-in-js

[emotion å’Œ styled-components ä¸¤ç§è§£å†³æ–¹æ¡ˆ](https://zhuanlan.zhihu.com/p/91498498)

å¥½å¤„æ˜¯èƒ½é€šè¿‡ js åŠ¨æ€ç”Ÿæˆ css

æ¨è emotion, emotion åŒæ—¶æ”¯æŒ css props å†™æ³•å’Œ styled å†™æ³•, styled-components åªæœ‰ styled å†™æ³•

æ€»ä½“ä¸å¦‚ css-module, å› ä¸º css å’Œ js è€¦åˆ, å°†æ¥å¦‚æœè¿ç§», ä¸æ–¹ä¾¿

å¦ä¸€ç§ css è§£å†³æ–¹æ¡ˆ: https://tailwindcss.com/

[react + emotion çš„ styled å†™æ³•](https://codedaily.io/tutorials/62/Create-a-Hoverable-Display-Card-with-React-and-Emotion)

# 22. æœ€ä½³å®è·µ best practice

https://github.com/camsong/blog
https://github.com/camsong/blog/issues/6

æŠ€æœ¯ç¯å¢ƒï¼š

æ‰“åŒ… es6 + Webpack + less
ä½¿ç”¨äº† HapiJs ä½œä¸ºæ¨¡æ‹Ÿ serverï¼Œå‰ç«¯å¼€å‘å’Œåç«¯å½»åº•åˆ†ç¦»ï¼ŒåæœŸé›†æˆæ—¶ï¼Œä½¿ç”¨è‡ªå·±å¼€å‘çš„ä»£ç†æœåŠ¡å™¨è°ƒç”¨çœŸæ­£çš„ API
è¿è¡Œåº“ React + Flux + React-router+ material-ui + ImmutableJS + è‡ªå·±ç ”å‘çš„æ§ä»¶
å•æµ‹ç¯å¢ƒ Karma+mocha+chai+Istanbul
å¸ƒå±€å®Œå…¨ç”¨ flex

ä½¿ç”¨ Flex å¸ƒå±€ä¼šå¤§å¤§é™ä½ CSS çš„éš¾åº¦
ä½¿ç”¨ Flux å¯ä»¥å¾ˆå¥½çš„éš”ç¦»ä¸šåŠ¡ï¼ˆæˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘éƒ½åœ¨ Store é‡Œï¼‰,å¤§å¤§é™ä½äº†å•å…ƒæµ‹è¯•çš„éš¾åº¦
åŸºäº React çš„æ§ä»¶ï¼ˆè¿™é‡Œè¯´çš„æ˜¯åŸºæœ¬æ§ä»¶ï¼‰æ˜¯å¯¹ React ç†è§£çš„ä¸€ä¸ªä½“ç°
å°½é‡æŠŠ React ç»„ä»¶ï¼ˆComponentï¼‰åšåˆ°å°ï¼Œåšåˆ°ç»†ï¼Œä¹Ÿå°±æ˜¯å°½é‡æ‹†åˆ† React ç»„ä»¶
åŸºäºæ•°æ®é©±åŠ¨çš„æ–¹å¼ï¼ˆData-Drivenï¼‰å¼€å‘ï¼Œç†è§£åˆ°è¿™ä¸€ç‚¹å°±ä¼šå‘ç° React å¾ˆç¥å¥‡ï¼Œå¯èƒ½è¿™ä¹Ÿæ˜¯æœ€ä¸å¥½ç†è§£çš„åœ°æ–¹
ImmutableJS å¸¦æ¥äº†å¤§é‡çš„å¥½å¤„ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½ä½¿ç”¨äº† ShouldComponentUpdate æ¥ä¼˜åŒ–
å®ç°äº† I18N çš„åŠ¨æ€åŠ è½½
ä½¿ç”¨äº† Url æ¥ä¿å­˜ Router ä¿¡æ¯ï¼Œæ²¡æœ‰ä½¿ç”¨ Hashï¼Œæ„Ÿè§‰å¾ˆç®€æ´

# 23. æœåŠ¡ç«¯æ¸²æŸ“

## 23.1. ä»€ä¹ˆæ˜¯ ssr

ä»¥å‰çš„å¤šé¡µé¢ç«™ç‚¹æ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„ï¼Œè¾“å‡ºåˆ°æµè§ˆå™¨æ—¶å·²ç»æœ‰äº†å®Œæ•´çš„éª¨æ¶ï¼ˆ html ï¼‰ï¼Œè¿™æ ·çˆ¬è™«æŠ“åˆ°æ—¶å¯ä»¥åˆ†æé¡µé¢æ ‡é¢˜ï¼Œå†…å®¹ç­‰ç­‰ï¼Œåš seo å®¹æ˜“ï¼Œé‚£æ—¶çš„æŠ€æœ¯æ ˆæ˜¯ jspï¼Œphp ç­‰ç­‰ã€‚

ç°åœ¨æµè¡Œçš„å‰ç«¯æ¡†æ¶åœ¨è¿™æ–¹é¢æ˜¯å¼€äº†å€’è½¦ï¼Œä¸€ä¸ªç©ºçš„éª¨æ¶ï¼Œä¸€ä¸ªå¾ˆå¤§çš„ jsï¼ŒæŠ“åˆ°æµè§ˆå™¨ä»¥åæ‰å¼€å§‹æ¸²æŸ“å®Œæ•´çš„é¡µé¢ï¼Œçˆ¬è™«å°±å¾ˆä¸ºéš¾äº†ï¼Œå› ä¸ºå®ƒæ²¡æ³•æ‰§è¡Œ js å•Šï¼Œæ­¤å¤–ï¼Œç™½å±æ—¶é—´ä¹Ÿæ˜¯ç”±äºå‰ç«¯æ¸²æŸ“å¸¦æ¥çš„é—®é¢˜ã€‚äºæ˜¯åˆæœ‰äº†æœåŠ¡ç«¯æ¸²æŸ“ï¼Œè®©æ¸²æŸ“è¿™ä¸€æ­¥å†å›åˆ°æœåŠ¡ç«¯ï¼Œåœ¨æœåŠ¡ç«¯æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼Œç»™ react å’Œ vue ç­‰æ¡†æ¶ä¸€ä¸ªå¯æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ï¼Œå°±æ˜¯ä¸ºäº†æå‰å¾—åˆ°å®Œæ•´çš„ html, è¿™å°±æ˜¯ server side  render

Isomorphic JavaScript : æŒ‡å‰åç«¯ï¼ˆClient/Serverï¼‰å…±ç”¨ç›¸åŒéƒ¨åˆ†çš„ js ä»£ç , è®© JavaScript åº”ç”¨å¯ä»¥åŒæ—¶æ‰§è¡Œåœ¨æµè§ˆå™¨ç«¯å’Œ server ç«¯ï¼Œåœ¨ React ä¸­å¯ä»¥ä½¿ç”¨ server ç«¯æ¸²æŸ“ï¼ˆserver side renderingï¼‰é™æ€ HTML çš„æ–¹å¼è¾¾åˆ° Isomorphic JavaScript æ•ˆæœï¼Œè®© SEO å’Œæ‰§è¡Œæ•ˆç‡æ›´åŠ æå‡å¹¶è®©å‰åç«¯å…±ç”¨ä»£ç 

## 23.2. ssr çš„å¥½å¤„

- seo å‹å¥½
- åŒæ—¶æœ‰åŠ©äºæ”¹å–„é¦–å±åŠ è½½ä½“éªŒ


## 23.3. è§£å†³æ–¹æ¡ˆ

æœ€æ–°çš„æ–¹æ¡ˆ: https://github.com/rendora/rendora    (https://segmentfault.com/a/1190000017361781?utm_source=tag-newest)

https://www.zhihu.com/question/51949678 æƒ³è¦ seo çš„é¡µé¢è¦é™æ€åˆ†å¼€éƒ¨ç½², ä¸è¦ä½¿ç”¨ react
https://blog.coding.net/blog/React-Server-Side-Rendering-for-SPA-SEO,
https://blog.bluedgeusa.com/how-to-build-an-seo-friendly-website-with-react-ef42bb52c563#.ge090p9pu //todo ,
https://github.com/carlleton/reactjs101/blob/zh-CN/Ch10/react-redux-server-rendering-isomorphic-javascript.md
https://www.jianshu.com/p/56ca46c90ee2 ä½¿ç”¨ç±»åº“


å…¶å®, å¯¹äºçœŸæ­£é€‚åˆåšæˆ SPA çš„åº”ç”¨ï¼ŒSEO åè€Œé€šå¸¸ä¸æ˜¯é—®é¢˜ã€‚é’ˆå¯¹ marketing çš„é¡µé¢åº”è¯¥æ˜¯é™æ€åˆ†å¼€éƒ¨ç½²çš„ï¼Œapp æœ¬èº«åˆ™è¦ç™»é™†æ‰èƒ½ç”¨ï¼ŒSEO æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚å¯¹äºå°‘æ•°åŒæ—¶éœ€è¦ seo, è€Œä¸”åŒæ—¶éœ€è¦å¼ºäº¤äº’æ€§ spa çš„åœºæ™¯, æœ‰å¦‚ä¸‹å‡ ç§è§£å†³æ–¹æ¡ˆ:

-   React ä½¿ç”¨ Next.js ä½œæœåŠ¡å™¨ç«¯æ¸²æŸ“ https://nextjs.org/

  https://github.com/unicodeveloper/awesome-nextjs#videos

-   ä½¿ç”¨ Node.js ä½œä¸ºå‰åç«¯çš„ä¸­é—´å±‚è¿›è¡Œä¸­é—´å±‚æ¸²æŸ“ ï¼Œä½†å¯èƒ½å¯¹é¡¹ç›®æ”¹åŠ¨æœ‰ç‚¹å¤§ (http://www.alloyteam.com/2015/10/8783/), å‚è€ƒ https://juejin.im/post/6844903693033144333

    React æä¾›äº†ä¿©ä¸ªç¥å¥‡çš„æ–¹æ³•ï¼ŒrenderToString å’Œ renderToStaticMarkup:

    renderToString æ–¹æ³•ï¼Œåªåº”ç”¨åœ¨æœåŠ¡å™¨ç«¯ï¼ŒæŠŠä¸€ä¸ª React Component æ¸²æŸ“æˆ HTMl ,å¯ä»¥å°†å®ƒé€šè¿‡ response å‘é€åˆ°æµè§ˆå™¨ç«¯ï¼Œè¾¾åˆ° SEO çš„ç›®çš„ã€‚

    renderToStaticMarkup æ–¹æ³•ï¼Œå’Œ renderToString ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒç”Ÿæˆçš„ HTML Dom ä¸åŒ…å«ç±»ä¼¼ data-react-id è¿™æ ·çš„é¢å¤–å±æ€§ï¼Œå¯ä»¥ç”¨äºç”Ÿæˆç®€å•çš„é™æ€é¡µé¢ï¼ŒèŠ‚çœå¤§é‡å­—ç¬¦ä¸²ã€‚

- https://github.com/rendora/rendora ä½¿ç”¨ headless Chrome

- https://github.com/jaredpalmer/razzle

### 23.3.1. æ‹–è¿‡ vite

https://cn.vitejs.dev/guide/ssr.html

### 23.3.2. é…åˆ koa2 å®ç° ssr

https://github.com/yangfan0095/react-koa2-ssr


### 23.3.3. egg å®ç° ssr 

https://github.com/zhangyuang/ssr
https://github.com/zhangyuang/egg-react-ssr


# 24. æ€§èƒ½ä¼˜åŒ–

https://zhuanlan.zhihu.com/p/37148975

## 24.1. å¸¸è§çš„æ€§èƒ½é—®é¢˜åœºæ™¯

é”®ç›˜è¾“å…¥å¡é¡¿

é¼ æ ‡ç§»åŠ¨/æ»šåŠ¨å¡é¡¿ (è°ƒæ•´å°ºå¯¸ resize)

ç»„ä»¶æ‹†åˆ†çš„è¦è¶³å¤Ÿå°, å‡å°‘ virtual dom çš„ diff æ“ä½œè´Ÿæ‹…

## 24.2. ä½¿ç”¨å·¥å…·å®šä½æ€§èƒ½é—®é¢˜

react devtools (highlight update åŠŸèƒ½)
chrome devtools

## 24.3. ç½‘ç»œæ€§èƒ½ä¼˜åŒ–-è‡ªåŠ¨æŒ‰éœ€åŠ è½½

å¯ä»¥é€šè¿‡ react-loadable ç»„ä»¶ + webpack import api æ¥å®ç° react å¼‚æ­¥åŠ è½½

```js
import loadable from "react-loadable";

const TargetComponent = loadable({
    loader: () => import("./TargetComponent"),
    // ç­‰å¾…é¡µé¢
    loading: () => <div>Loading....</div>
});
```

## 24.4. ä½¿ç”¨ Reselect é¿å…é‡å¤è®¡ç®—

reselect åº“ç”¨æ¥åˆ›å»ºè‡ªåŠ¨ç¼“å­˜çš„æ•°æ®çš„å¤„ç†å‡½æ•°

# 25. react åŠ¨ç”»

https://mp.weixin.qq.com/s/Ey24FrWN2SiLK2LAmPv7hA

https://github.com/pmndrs/react-spring
https://github.com/chenglou/react-motion

TODO

# 26. react native

https://reactnative.dev/docs/getting-started å®˜ç½‘
https://github.com/reactnativecn/react-native-guide ä¸­æ–‡èµ„æº
https://github.com/jondot/awesome-react-native

ç¾å›¢å¤–å–çš„å®è·µ: https://tech.meituan.com/2019/12/19/meituan-mrn-practice.html

æ›´æ¨è flutter

https://guoshuyu.cn/home/wx/
http://laomengit.com/guide/introduction/cross-platform.html

https://xiaozhuanlan.com/topic/8924513706 è·¨å¹³å°å¼€å‘åŸç†
https://exp.newsmth.net/topic/article/51b2b5d2371fc166e46ef0ff881b8506 flutter å¯¹æ¯”
https://zhuanlan.zhihu.com/p/43957699


https://github.com/henter/ReactNativeRubyChina å®ä¾‹
https://github.com/soliury/noder-react-native

https://segmentfault.com/a/1190000040047178 å¯¹æ¯” flutter
https://www.infoq.cn/article/8zslqg9iys5wyrezgrxr

# 27. å¼€å‘å°ç¨‹åº

remax, taro, anujs, æ¨è Taro + typescript


https://zhuanlan.zhihu.com/p/24946190 ç”³è¯·æ­¥éª¤

https://github.com/didi/chameleon


# 28. å°é¡¹ç›®

## 28.1. å®ç° route

https://www.cnblogs.com/huyue/p/9463328.html
https://www.jianshu.com/p/014fd226352b


## 28.2. è¡¨å•è®¾è®¡å™¨


https://github.com/alibaba/form-render
https://github.com/rjsf-team/react-jsonschema-form json æ¸²æŸ“è¡¨å•

## 28.3. cms ç³»ç»Ÿ 

(é…åˆ antd)

```sh
npx create-react-app cms-article

# æ ·å¼ ä¸»é¢˜ æ”¯æŒ less 
# è‡ªå®šä¹‰é…ç½®
npm i -S antd craco-less @craco/craco

# è·¯ç”±
npm i -S react-router-dom

# ajax
npm i -S axios

# redux
npm i -S redux react-redux
```

# 29. éƒ¨ç½²åˆ° github ä¸Š

```sh
# åœ¨package.jsoné…ç½®æ–‡ä»¶ä¸­åŠ ä¸€å¥, å¤„ç†è·¨åŸŸé—®é¢˜
#â€œhomepageâ€: â€œhttps://fyxwanan.github.io/testâ€ 

# or

# "proxy": {
#     "/api": {
#       "target": "http://localhost:8080",
#       "ws": true
#     }
#   }

# ç”Ÿæˆä¸€ä¸ªbuildæ–‡ä»¶å¤¹
npm run build

# æäº¤ master ä»£ç 
git push origin master

# buildæ–‡ä»¶å¤¹ä¸Šä¼ åˆ°å¦ä¸€ä¸ªåˆ†æ”¯
git subtree push --prefix=build origin gh-pages

# æœ€ååˆ° github é…ç½® github pages

```

# 30. å’Œ springboot æ‰“åŒ…å•ä½“åº”ç”¨

https://cloud.tencent.com/developer/news/603125

https://medium.com/@itzgeoff/including-react-in-your-spring-boot-maven-build-ae3b8f8826e
frontend-maven-plugin

https://blog.csdn.net/andy_zhang2007/article/details/89393005 å’Œ webjars

# 31. å’Œ typescript ä¸€èµ·ä½¿ç”¨

## 31.1. é›†æˆ ts ç¯å¢ƒ

https://create-react-app.dev/docs/adding-typescript/

```sh
npx create-react-app my-app --template typescript

# default use yarn to manage package, specify use npm
npx create-react-app my-app --use-npm


```

å…¨å±€å£°æ˜æ–‡ä»¶  `react-app-env.d.ts`, ts é…ç½® `tsconfig.js` è§ https://blog.csdn.net/qq_41831345/article/details/106843875

## 31.2. ts åŸºæœ¬ä½¿ç”¨

https://github.com/xcatliu/typescript-tutorial
https://rmolinamir.github.io/typescript-cheatsheet/
https://typescript.bootcss.com/

`npm install -g typescript` , https://www.typescriptlang.org/play/

### 31.2.1. åŸºæœ¬æ•°æ®ç±»å‹

```ts
// any & unknown
// unknown æ˜¯ä¸¥æ ¼ç‰ˆçš„ any, å°½é‡ç”¨ å‰è€…ä»£æ›¿åè€…
// unknown ç±»å‹å€¼æ— æ³•èµ‹å€¼ç»™ä»»ä½•å…¶ä»–å˜é‡
// unknown ç±»å‹å€¼æ— æ³•è¯»å–ä»»ä½•æ–¹æ³•

// æšä¸¾
const enum Color {Red = 1, Green, Blue}
let colorName: string = Color[2];
console.log(colorName);  // æ˜¾ç¤º'Green'å› ä¸ºä¸Šé¢ä»£ç é‡Œå®ƒçš„å€¼æ˜¯2

// æšä¸¾ç›¸å½“äºä¸€ä¸ªå¯¹è±¡
// obj: { X: number }

// æšä¸¾ä½œä¸ºç±»å‹:
enum ShapeKind {
    Circle,
    Square,
}
interface Circle {
    kind: ShapeKind.Circle;
    radius: number;
}
interface Square {
    kind: ShapeKind.Square;
    sideLength: number;
}
let c: Circle = {
    kind: ShapeKind.Square,
    //    ~~~~~~~~~~~~~~~~ Error!
    radius: 100,
}

```

### 31.2.2. interface

#### 31.2.2.1. ä½¿ç”¨ interface å®šä¹‰å¯¹è±¡ç±»å‹

```js

// similar to bean in java
interface SquareConfig {
  // optional properties, 
  color?: string;
  width?: number;
  readonly xxx: number;// readonly property, 
  //æœ€ç®€å•åˆ¤æ–­è¯¥ç”¨readonlyè¿˜æ˜¯constçš„æ–¹æ³•æ˜¯çœ‹è¦æŠŠå®ƒåšä¸ºå˜é‡ä½¿ç”¨è¿˜æ˜¯åšä¸ºä¸€ä¸ªå±æ€§ã€‚ åšä¸ºå˜é‡ä½¿ç”¨çš„è¯ç”¨ constï¼Œè‹¥åšä¸ºå±æ€§åˆ™ä½¿ç”¨readonly
}

//ReadonlyArray<T>ç±»å‹ï¼Œå®ƒä¸Array<T>ç›¸ä¼¼ï¼Œåªæ˜¯æŠŠæ‰€æœ‰å¯å˜æ–¹æ³•å»æ‰äº†ï¼Œå› æ­¤å¯ä»¥ç¡®ä¿æ•°ç»„åˆ›å»ºåå†ä¹Ÿä¸èƒ½è¢«ä¿®æ”¹ï¼š
let ro: ReadonlyArray<number> = a;
const a = [];
a = ro; // error!
a = ro as number[];//ok



// é¢å¤–çš„å±æ€§æ£€æŸ¥
interface SquareConfig {
    color?: string;
    width?: number;
}
function createSquare(config: SquareConfig) {
}
let mySquare = createSquare({ colour: "red", width: 100 });//error, å‚æ•° interface ä¸­æ²¡æœ‰ colour, å³ä½¿ color æ˜¯ å¯é€‰å‚æ•°ä¹Ÿä¸è¡Œ
let mySquare = createSquare({  width: 100 });// ok
let mySquare1 = createSquare({ width: 100, opacity: 0.5 } );//error
let mySquare = createSquare({ width: 100, opacity: 0.5 } as SquareConfig);//ok 
// è‹¥å¸Œæœ›å‚æ•°ä¸­å¸¦æœ‰å…¶ä»–å±æ€§, æœ€å¥½çš„è§£å†³æ–¹å¼:
interface SquareConfig {
    color?: string;
    width?: number;
    [propName: string]: any;//å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„å±æ€§ï¼Œå¹¶ä¸”åªè¦å®ƒä»¬ä¸æ˜¯colorå’Œwidthï¼Œé‚£ä¹ˆå°±æ— æ‰€è°“å®ƒä»¬çš„ç±»å‹æ˜¯ä»€ä¹ˆ
}

//è¿˜æœ‰ä¸€ç§æ–¹æ³•: å°†å¯èƒ½æœ‰é”™çš„å‚æ•°å¯¹è±¡èµ‹å€¼ç»™ä¸€ä¸ªå¦ä¸€ä¸ªå˜é‡, ç„¶åä¼ å…¥æ–¹æ³•ä¸­
let squareOptions = { colour: "red", width: 100 };
let mySquare = createSquare(squareOptions);

```

#### 31.2.2.2. interface å®šä¹‰å‡½æ•°ç±»å‹

```js
interface SearchFunc {
  (source: string, subString?: string): boolean;// å¯é€‰å‚æ•°å¿…é¡»åœ¨æœ€å
  // å¯ä»¥ä¸æ­¢æœ‰ä¸€ä¸ªå‡½æ•°ç­¾å
  
}
let mySearch: SearchFunc;
mySearch = function(src, sub) {// è¿”å›å€¼ç±»å‹, å‚æ•°ç±»å‹å¯çœç•¥
    let result = src.search(sub);
    return result > -1;
}


// æ··åˆç±»å‹
//ä¸€ä¸ªå¯¹è±¡å¯ä»¥åŒæ—¶åšä¸ºå‡½æ•°å’Œå¯¹è±¡ä½¿ç”¨ï¼Œå¹¶å¸¦æœ‰é¢å¤–çš„å±æ€§
interface Counter {
    (start: number): string;
    interval: number;
    reset(): void;
}
function getCounter(): Counter {
    let counter = <Counter>function (start: number) { };
    counter.interval = 123;
    counter.reset = function () { };
    return counter;
}
let c = getCounter();
c(10);
c.reset();
c.interval = 5.0;
```

#### 31.2.2.3. interface å®šä¹‰å¯ç´¢å¼•ç±»å‹

ç±»ä¼¼æ•°ç»„, map...

```js
interface StringArray {
  [index: number]: string;// ç´¢å¼•æ”¯æŒå­—ç¬¦ä¸²å’Œæ•°å­—ã€‚å¯ä»¥åŒæ—¶ä½¿ç”¨, ä½†æ˜¯æ•°å­—ç´¢å¼•çš„è¿”å›å¿…é¡»æ˜¯å­—ç¬¦ä¸²ç´¢å¼•çš„è¿”å›å€¼çš„å­ç±»å‹
}


  // åº•å±‚å®é™…åªæ”¯æŒ å­—ç¬¦ä¸²ä½œä¸ºç´¢å¼•, è‹¥æ˜¯æ•°å­—ä½œä¸ºç´¢å¼•, å®é™…è¿˜æ˜¯å…ˆè½¬ä¸ºå­—ç¬¦ä¸², ç„¶åå»æŸ¥æ‰¾, æ‰€ä»¥ä¸ºäº†èƒ½å¤ŸæŸ¥åˆ°, number å¯¹åº”çš„è¿”å›ç±»å‹å¿…é¡»å’Œ string å¯¹åº”çš„è¿”å›å€¼ç±»å‹ç›¸åŒ or ä¸ºå­ç±»å‹
//
class Animal {
    name: string;
}
class Dog extends Animal {
    breed: string;
}
// é”™è¯¯ï¼šä½¿ç”¨æ•°å€¼å‹çš„å­—ç¬¦ä¸²ç´¢å¼•ï¼Œæœ‰æ—¶ä¼šå¾—åˆ°å®Œå…¨ä¸åŒçš„Animal!
interface NotOkay {
    [x: number]: Animal;
    [x: string]: Dog;
}


// ä¸€æ—¦æŒ‡å®šäº†ç´¢å¼•ç±»å‹, å½“å‰å¯¹è±¡çš„å…¶ä»–ç´¢æ€§è¿”å›ç±»å‹å¿…é¡»ç¬¦åˆè¿™ä¸ªç´¢å¼•ç±»å‹
interface NumberDictionary {
  [index: string]: number;
  length: number;    // å¯ä»¥ï¼Œlengthæ˜¯numberç±»å‹
  name: string       // é”™è¯¯ï¼Œ`name`çš„ç±»å‹ä¸ç´¢å¼•ç±»å‹è¿”å›å€¼çš„ç±»å‹ä¸åŒ¹é…
}

//å¯ä»¥å°†ç´¢å¼•ç­¾åè®¾ç½®ä¸ºåªè¯»ï¼Œè¿™æ ·å°±é˜²æ­¢äº†ç»™ç´¢å¼•èµ‹å€¼, ä¹Ÿå°±é˜»æ­¢äº†æ•°ç»„æ‰©å±•
interface ReadonlyStringArray {
    readonly [index: number]: string;
}
let myArray: ReadonlyStringArray = ["Alice", "Bob"];
myArray[2] = "Mallory"; // error! ä¸èƒ½è®¾ç½®myArray[2]ï¼Œå› ä¸ºç´¢å¼•ç­¾åæ˜¯åªè¯»çš„
```

#### 31.2.2.4. interface å®šä¹‰ class ç±»

```js
interface ClockInterface {
    currentTime: Date;// å°†ä½œä¸ºå­ç±»æˆå‘˜å˜é‡, å­ç±»å¿…é¡»æœ‰
    setTime(d: Date);
}

class Clock implements ClockInterface {
    currentTime: Date;
    setTime(d: Date) {
        this.currentTime = d;
    }
    constructor(h: number, m: number) { }
}
```

#### 31.2.2.5. interface ç»§æ‰¿

interface å¯ä»¥ç»§æ‰¿ å¤šä¸ªå…¶ä»– interface, é€—å·åˆ†ç¦»

äº¦å¯ç»§æ‰¿å…¶ä»– class: (interface è‡ªåŠ¨æ‹¥æœ‰ class çš„å±æ€§, å³ä½¿æ˜¯ private)

```js
class Control {
    private state: any;
}

interface SelectableControl extends Control {// æ‹¥æœ‰äº† state 
    select(): void;
}

// å¯ä»¥å®ç° interface, å› ä¸º button æ‹¥æœ‰ state 
class Button extends Control implements SelectableControl {
    select() { }
}
// ok
class TextBox extends Control {
    select() { }
}

// é”™è¯¯ï¼šâ€œImageâ€ç±»å‹ç¼ºå°‘â€œstateâ€å±æ€§ã€‚
class Image implements SelectableControl {
    select() { }
}


```

### 31.2.3. interface å’Œ type åŒºåˆ«

https://www.jb51.net/article/163299.htm

### 31.2.4. class ä½¿ç”¨

```js
class Greeter {
  // æ¯”è¾ƒä¸¤ä¸ª object æ˜¯å¦ç›¸ç­‰, 
  //åªæœ‰å®ä¾‹çš„æˆå‘˜ä¼šè¢«æ¯”è¾ƒã€‚ é™æ€æˆå‘˜å’Œæ„é€ å‡½æ•°ä¸åœ¨æ¯”è¾ƒçš„èŒƒå›´å†…ã€‚
  // å¦‚æœå±æ€§ä¸å¸¦ä¿®é¥°ç¬¦, åªéœ€è¦å„ä¸ªå±æ€§ç±»å‹éƒ½å…¼å®¹ç›¸ç­‰, åˆ™ object ç›¸ç­‰
  // è‹¥å±æ€§å¸¦æœ‰ä¿®é¥°ç¬¦(privateæˆ– protected), åˆ™ä¸¤ä¸ª object ä¸­çš„ field å¿…é¡»éƒ½æœ‰ç›¸åŒçš„ä¿®é¥°ç¬¦, ä¸”ä¸¤ä¸ª field å£°æ˜è‡ªåŒä¸€ä¸ªåœ°æ–¹(æ¯”å¦‚é€šè¿‡ç»§æ‰¿å¾—åˆ°çš„ field)

  public name: string;
         greeting: string;  //// é»˜è®¤ public
  protected name: string;//protectedæˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­ä»ç„¶å¯ä»¥è®¿é—®; æ„é€ å‡½æ•°ä¹Ÿå¯ä»¥è¢«æ ‡è®°æˆ protectedã€‚ è¿™æ„å‘³ç€è¿™ä¸ªç±»ä¸èƒ½åœ¨åŒ…å«å®ƒçš„ç±»å¤–è¢«å®ä¾‹åŒ–ï¼Œä½†æ˜¯èƒ½è¢«ç»§æ‰¿, å¯ä»¥åœ¨å­ç±»ä¸­è°ƒç”¨ super()
  private name: string; //æ— æ³•åœ¨ç±»å¤–éƒ¨è®¿é—®
  readonly xiaoyu: string = '';// åªè¯»å±æ€§å¿…é¡»åœ¨å£°æ˜æ—¶æˆ–æ„é€ å‡½æ•°é‡Œè¢«åˆå§‹åŒ–
      
  static origin = {x: 0, y: 0};// é™æ€å±æ€§, é€šè¿‡ç±»åè®¿é—® 


  // å‚æ•°å±æ€§: é€šè¿‡ç»™æ„é€ å‡½æ•°å‚æ•°å‰é¢æ·»åŠ ä¸€ä¸ªè®¿é—®é™å®šç¬¦æ¥å£°æ˜ã€‚ ä½¿ç”¨ privateé™å®šä¸€ä¸ªå‚æ•°å±æ€§ä¼šå£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ªç§æœ‰æˆå‘˜ï¼›å¯¹äº publicå’Œ protectedæ¥è¯´ä¹Ÿæ˜¯ä¸€æ ·
  constructor(message: string, readonly xiaoyu: string = 'XIAOYU') {// è¿™é‡Œæ˜¯ä¸ºåŒåå‚æ•° xiaoyu åˆå§‹åŒ–, å¯ä»¥çœæ‰ä¸€äº›ä»£ç  
    // è‹¥æœ‰ç»§æ‰¿, åœ¨æ„é€ å‡½æ•°é‡Œè®¿é—® thisçš„å±æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬ ä¸€å®šè¦è°ƒç”¨ super()
      this.greeting = message;
  }

  // getter, setter
  private _fullName: string;

  get fullName(): string {
      return this._fullName;
  }

  set fullName(newName: string) {
      if (passcode && passcode == "secret passcode") {  
          this._fullName = newName;
      }
      else {
          console.log("Error: Unauthorized update of employee!");
      }
  }
}

// ä½¿ç”¨ getter, setter
let employee = new Employee();
employee.fullName = "Bob Smith";//setter
if (employee.fullName) {//getter
    alert(employee.fullName);
}
```

### 31.2.5. æ³›å‹ä½¿ç”¨

```js
function identity<T>(arg: T): T {
    return arg;
}
let myIdentity: <U>(arg: U) => U = identity;
let myIdentity: {<T>(arg: T): T} = identity;// ç›¸å½“äºå®šä¹‰äº†ä¸€ä¸ªåŒ¿å interface/object æ¥å®šä¹‰å‡½æ•°ç±»å‹


let output = identity<string>("myString");
let output = identity("myString");// ç®€å†™


//æ³›å‹çº¦æŸ
function create<T>(c: {new(): T; }): T {
    return new c();
}
function createInstance<A extends Animal>(c: new () => A): A {
    return new c();
}
```

### 31.2.6. äº¤å‰ç±»å‹

```js
// é€šè¿‡æ³›å‹å®šä¹‰æ··åˆé¢ç±»å‹
function extend<T, U>(first: T, second: U): T & U {
    let result = <T & U>{};
    for (let id in first) {
        (<any>result)[id] = (<any>first)[id];
    }
    for (let id in second) {
        if (!result.hasOwnProperty(id)) {
            (<any>result)[id] = (<any>second)[id];
        }
    }
    return result;
}

class Person {
    constructor(public name: string) { }
}
interface Loggable {
    log(): void;
}
class ConsoleLogger implements Loggable {
    log() {
        // ...
    }
}
var jim = extend(new Person("Jim"), new ConsoleLogger());
var n = jim.name;
jim.log();
```

### 31.2.7. è”åˆç±»å‹

```ts
function padLeft(value: string, padding: string | number) {// padding can be string | number type
    // ...
}
let indentedString = padLeft("Hello world", true); // errors during compilation


//å¦‚æœä¸€ä¸ªå€¼æ˜¯è”åˆç±»å‹ï¼Œåªèƒ½è®¿é—®è”åˆç±»å‹é‡Œçš„å…¬å…±éƒ¨åˆ†
interface Bird {
    fly();
    layEggs();
}
interface Fish {
    swim();
    layEggs();
}
function getSmallPet(): Fish | Bird {
    // ...
}
let pet = getSmallPet();
pet.layEggs(); // okay
pet.swim();    // errors

////////////////////////////////////////
// ç±»å‹æ–­è¨€
let pet = getSmallPet();
if ((<Fish>pet).swim) { // æ˜¾å¼æŒ‡å®šä¸€ä¸ªç±»å‹
    (<Fish>pet).swim();
} else {
    (<Bird>pet).fly();
}

// ç®€åŒ–:
// å°†æ–­è¨€æŠ½å‡ºæ¥æˆä¸ºå‡½æ•°
function isFish(pet: Fish | Bird): pet is Fish {// è¿”å›å€¼ä¸ºç±»å‹è°“è¯, è¯­æ³•ä¸º param is Type
    return (<Fish>pet).swim !== undefined;
}
if (isFish(pet)) {
    pet.swim();
}
else {
    pet.fly();
}


// æ„Ÿå¹å· (!): æ‰‹åŠ¨å»é™¤nullæˆ– undefinedçš„è”åˆç±»å‹
function fixed(name: string | null): string {
  function postfix(epithet: string) {
    return name!.charAt(0) + '.  the ' + epithet; // ok, é€šè¿‡ ! å»æ‰äº† null ç±»å‹
  }
  name = name || "Bob";
  return postfix("great");
}


// å¯è¾¨è¯†è”åˆ
interface Square {
    kind: "square";
    size: number;
}
interface Rectangle {
    kind: "rectangle";
    width: number;
    height: number;
}
interface Circle {
    kind: "circle";
    radius: number;
}
type Shape = Square | Rectangle | Circle;
function area(s: Shape) {
    switch (s.kind) {
        case "square": return s.size * s.size;
        case "rectangle": return s.height * s.width;
        case "circle": return Math.PI * s.radius ** 2;
    }
}
```

### 31.2.8. ç±»å‹ä¿æŠ¤

```js
// å¯¹äºç±»å‹
function padLeft(value: string, padding: string | number) {
    if (typeof padding === "number") {//å¿…é¡»æ˜¯ "number"ï¼Œ "string"ï¼Œ "boolean"æˆ– "symbol"
        return Array(padding + 1).join(" ") + value;
    }
    if (typeof padding === "string") {
        return padding + value;
    }
    throw new Error(`Expected string or number, got '${padding}'.`);
}

// å¯¹äºå®ä¾‹
// ç±»å‹ä¸ºSpaceRepeatingPadder | StringPadder
let padder: Padder = getRandomPadder();
if (padder instanceof SpaceRepeatingPadder) { // å³ä¾§å¿…é¡»ä¸ºæ„é€ å‡½æ•°
    padder; // ç±»å‹ç»†åŒ–ä¸º'SpaceRepeatingPadder'
}
if (padder instanceof StringPadder) {
    padder; // ç±»å‹ç»†åŒ–ä¸º'StringPadder'
}
```

### 31.2.9. ç±»å‹åˆ«å

```ts
type Name = string;
type NameResolver = () => string;
type NameOrResolver = Name | NameResolver;
type Tree<T> = {
    value: T;
    left: Tree<T>;
    right: Tree<T>;
}

type LinkedList<T> = T & { next: LinkedList<T> };
interface Person {
    name: string;
}
var people: LinkedList<Person>;
var s = people.name;
var s = people.next.name;
var s = people.next.next.name;
var s = people.next.next.next.name;


// å’Œæ¥å£çš„åŒºåˆ«
type Alias = { num: number }//ç±»å‹åˆ«åå¹¶ä¸åˆ›å»ºæ–°åå­—
interface Interface {
    num: number;
}
declare function aliased(arg: Alias): Alias;//å°†é¼ æ ‡æ‚¬åœåœ¨ interfacedä¸Šï¼Œæ˜¾ç¤ºå®ƒè¿”å›çš„æ˜¯ Interfaceï¼Œä½†æ‚¬åœåœ¨ aliasedä¸Šæ—¶ï¼Œæ˜¾ç¤ºçš„å´æ˜¯å¯¹è±¡å­—é¢é‡ç±»å‹
declare function interfaced(arg: Interface): Interface;

//ç±»å‹åˆ«åä¸èƒ½è¢« extendså’Œ implements
```

### 31.2.10. ç©ºç±»å‹

--strictNullChecksæ ‡è®° æ•ˆæœ:

```ts
let s = "foo";
s = null; // é”™è¯¯, 'null'ä¸èƒ½èµ‹å€¼ç»™'string', è‹¥æœæ˜¯ js è§„åˆ™/ts ä¸åŠ  strict æ ‡è®°, åˆ™å¯ä»¥

// TypeScriptä¼šæŠŠ nullå’Œ undefinedåŒºåˆ«å¯¹å¾…ã€‚ string | nullï¼Œ string | undefinedå’Œ string | undefined | nullæ˜¯ä¸åŒçš„ç±»å‹
let sn: string | null = "bar";
sn = null; // å¯ä»¥

sn = undefined; // error, 'undefined'ä¸èƒ½èµ‹å€¼ç»™'string | null'



//å¯é€‰å‚æ•°ä¼šè¢«è‡ªåŠ¨åœ°åŠ ä¸Š | undefined
function f(x: number, y?: number) {
    return x + (y || 0);
}
f(1, 2);
f(1);
f(1, undefined);
f(1, null); // error, 'null' is not assignable to 'number | undefined'
```

## 31.3. ä¸ºæ ·å¼æ–‡ä»¶ç¼–å†™ types

https://blog.csdn.net/Dilomen/article/details/100837293
https://segmentfault.com/q/1010000017979602/a-1020000017980147

https://www.typescriptlang.org/dt/search?search= æœç´¢ç±»å‹å£°æ˜æ–‡ä»¶

typeRoots æ˜¯ tsconfig ä¸­ compilerOptions çš„ä¸€ä¸ªé…ç½®é¡¹ï¼ŒtypeRoots ä¸‹é¢çš„åŒ…ä¼šè¢« ts ç¼–è¯‘å™¨è‡ªåŠ¨åŒ…å«è¿›æ¥ï¼ŒtypeRoots é»˜è®¤æŒ‡å‘ node_modules/@types

types å’Œ typeRoots ä¸€æ ·ä¹Ÿæ˜¯ compilerOptions çš„é…ç½®ï¼ŒæŒ‡å®š types åï¼ŒtypeRoots ä¸‹åªæœ‰è¢«æŒ‡å®šçš„åŒ…æ‰ä¼šè¢«å¼•å…¥

https://www.zhihu.com/question/350961609 å£°æ˜å…¨å±€ç±»å‹ æ— éœ€å¯¼å…¥

## 31.4. é…ç½® css è·³è½¬

https://www.jianshu.com/p/641bcac7754b


# 32. å¼€æºåº“

## 32.1. ç»„ä»¶åº“

https://github.com/palantir/blueprint

https://github.com/ant-design/ant-design/

## 32.2. åŠ¨ç”»

```
react framer motion



```

## 32.3. css æ¡†æ¶

```

Bootstrap ä½¿ç”¨æœ€å¹¿æ³›çš„, ä¸å®šåˆ¶çš„è¯ ç½‘ç«™å¤–è§‚åƒç¯‡ä¸€å¾‹

Bulma åèµ·ä¹‹ç§€

Pure.css è½»é‡çº§, å¯ä»¥ä½¿ç”¨å…¶æ …æ ¼è®¾è®¡å’Œèœå•åˆ›å»ºé«˜åº¦å“åº”å¼çš„é¡µé¢å¸ƒå±€

Animate.css ä¸°å¯Œçš„åŠ¨ç”»æ•ˆæœ

Tailwind é«˜åº¦å¯å®šåˆ¶

NES.css åƒç´ é£æ ¼

Paper Css æ‰‹å†™é£æ ¼

```

# 33. ionic å¼‚å¸¸ è´¨é‡App

https://www.jianshu.com/p/9c00358bcc44
https://www.jianshu.com/p/433be4cd3d66/


ionic node_modules/@types/node/assert.d.ts '{' or ';' expected.
https://www.google.com/search?q=ionic+node_modules%2F%40types%2Fnode%2Fassert.d.ts+%27%7B%27+or+%27%3B%27+expected.&newwindow=1&biw=1440&bih=764&sxsrf=ALeKk00VqSi6Swt2f9xmCkyc_h83_6mxOw%3A1628752166911&ei=JskUYYPyNsGd-gTywZbgAg&oq=ionic+node_modules%2F%40types%2Fnode%2Fassert.d.ts+%27%7B%27+or+%27%3B%27+expected.&gs_lcp=Cgdnd3Mtd2l6EANKBAhBGAFQtyhY0TpgzUVoAXAAeAKAAekFiAGzLZIBCTMtNC4yLjUuMZgBAKABAcABAQ&sclient=gws-wiz&ved=0ahUKEwiDndfS9qryAhXBjp4KHfKgBSw4ChDh1QMIDg&uact=5
https://forum.ionicframework.com/t/typescript-node-modules-types-node-index-d-ts-line-194/140019/5


ionic node_modules/@ionic/app-scripts/dist/util/interfaces.d.ts Cannot find name 'Buffer'.
https://www.google.com/search?q=ionic+node_modules%2F%40ionic%2Fapp-scripts%2Fdist%2Futil%2Finterfaces.d.ts+Cannot+find+name+%27Buffer%27.&newwindow=1&biw=1440&bih=764&sxsrf=ALeKk031J4LQAbHQXWludLzrTHuppsuyjw%3A1628781932004&ei=az0VYa_ePI_c-gT0tKLgAg&oq=ionic+node_modules%2F%40ionic%2Fapp-scripts%2Fdist%2Futil%2Finterfaces.d.ts+Cannot+find+name+%27Buffer%27.&gs_lcp=Cgdnd3Mtd2l6EAM6BwgAELADEB5KBAhBGAFQi4cfWOWJH2DFkh9oAXAAeACAAb4EiAGvC5IBBzMtMS4wLjKYAQCgAQKgAQHIAQHAAQE&sclient=gws-wiz&ved=0ahUKEwjvv-TD5avyAhUPrp4KHXSaCCwQ4dUDCA4&uact=5
https://github.com/ionic-team/starters/issues/88
https://stackoverflow.com/questions/38875401/getting-error-ts2304-cannot-find-name-buffer


'Cordova/CDVUserAgentUtil.h' file not found on cordova-ios@6
https://github.com/apache/cordova-plugin-inappbrowser/issues/709
https://github.com/apache/cordova-plugin-inappbrowser/pull/635
https://github.com/apache/cordova-plugin-inappbrowser/issues/818


https://github.com/ionic-team/ionic-framework/issues?page=2&q=css+ios
https://prabhashibuddhima.medium.com/ionic-ios-simulator-device-not-compiling-scss-but-working-in-android-and-web-a5c35f90ffe9
https://forum.ionicframework.com/t/scss-file-is-not-working/182729

```
ionic cordova rm ios  
ionic cordova add ios
ionic cordova build ios

open the generated proj use xcode




```