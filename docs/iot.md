---
title: Iot 物联网平台
tags: [iot]
date: 2020-06-06
toc_min_heading_level: 2
toc_max_heading_level: 5
---

<<图解物联网>>

https://github.com/IoT-Technology/IoT-Technical-Guide

https://github.com/microsoft/IoT-For-Beginners
https://iot-book.github.io/1_%E7%89%A9%E8%81%94%E7%BD%91%E6%A6%82%E8%BF%B0/
https://pdf.dfcfw.com/pdf/H3_AP202202071545436398_1.pdf 2022 行业报告

https://github.com/imKeYan/IoTPlatform 国内外物联网平台列表

2、熟悉视频编解码及图像处理原理，了解RTPRTCP、rtmp、rtsp等协议
3、熟悉TCP/IP，HTTP/HTTPS、MQTT，WebSocket，CoAP等一种或多种网络协议；
4、熟悉嵌入式操作系统、IoT相关协议(mqtt/opc-da/opc-ua/modbus等)
5、有基于开源 IoT平台相关二次开发使用经验;
6、有边缘-云互通编程开发经验，熟悉AWS greengrass、Service mesh 等开发框架;
7、有openTSDB 和influxDB等时序数据库实际开发经验;


熟悉消费级物联网的技术生态， 能独立完成物联网系统的设备选型、方案设计、硬件调试和控制软件开发。
精通主流的物联通讯协议 WiFi/BlueTooth/NFC/RS485/……， 熟练使用 Java/C#/C++ 等语言进行开发集成。
具备芯片级集成开发经验 STM32/ESP8266/HX711/ATGM336H/74HC595/……

- [iot brief intro](#iot-brief-intro)
    - [定义](#定义)
    - [场景-行业-厂商](#场景-行业-厂商)
    - [基本概念](#基本概念)
    - [雾计算\&边缘计算](#雾计算边缘计算)
- [设备网关选型](#设备网关选型)
- [设备网络传输协议选型](#设备网络传输协议选型)
    - [HTTPS](#https)
    - [CoAP](#coap)
    - [mqtt](#mqtt)
        - [mqtt broker 服务端选型](#mqtt-broker-服务端选型)
- [设备网络接入选型](#设备网络接入选型)
- [基于 Java 生态的物联网中台](#基于-java-生态的物联网中台)
    - [产品架构](#产品架构)
    - [项目初始化](#项目初始化)
        - [集成mqtt](#集成mqtt)
- [八卦谈资](#八卦谈资)



https://github.com/Amazingwujun/mqttx

<!-- truncate -->

- [iot brief intro](#iot-brief-intro)
    - [定义](#定义)
    - [场景-行业-厂商](#场景-行业-厂商)
    - [基本概念](#基本概念)
    - [雾计算\&边缘计算](#雾计算边缘计算)
- [设备网关选型](#设备网关选型)
- [设备网络传输协议选型](#设备网络传输协议选型)
    - [HTTPS](#https)
    - [CoAP](#coap)
    - [mqtt](#mqtt)
        - [mqtt broker 服务端选型](#mqtt-broker-服务端选型)
- [设备网络接入选型](#设备网络接入选型)
- [基于 Java 生态的物联网中台](#基于-java-生态的物联网中台)
    - [产品架构](#产品架构)
    - [项目初始化](#项目初始化)
        - [集成mqtt](#集成mqtt)
- [八卦谈资](#八卦谈资)



## iot brief intro

### 定义


```sh



IoT: 各种传感器设备联网组成的网络, 各种数据汇聚上传到云端

物联网(IoT)平台/中台/云平台: 是连接设备、传感器、网络和软件应用程序的基础设施，以便收集、存储、分析和交换数据
    - 设备接入、
    - 设备管理、
    - 数据安全通信、
    - 消息订阅、消息转发
    - 数据服务 (收集、存储、分析和交换数据)

    向下支持连接海量设备，采集设备数据上云；向上提供云端API，服务端可通过云端SDK调用云端API将指令下发至设备端，实现远程控制。



物联网应用: 基于 iot 平台, 可以构建各种应用，不限于家居、矿山、电力、智慧城市、环境、交通等。






边缘计算：边缘计算是一种分布式计算范式，将数据处理和分析从云端移到设备附近的边缘节点。这可以减少数据传输延迟，提高实时性能，降低带宽成本，并增强数据安全性。边缘计算正在成为物联网领域的重要趋势。

低功耗广域网络（ LPWAN ）：LPWAN 技术（如 LoRaWAN 、Sigfox 和 NB-IoT ）为物联网设备提供了低功耗、长距离和低成本的无线连接。这使得大量分布式设备能够在广泛的地理范围内进行通信，从而推动了智能城市、智能农业和远程监控等领域的发展。

5G 技术：5G 是下一代无线通信技术，具有更高的数据速率、更低的延迟和更高的连接密度。5G 技术将为物联网应用带来更快的数据传输、更好的实时性能和更广泛的覆盖范围，从而推动自动驾驶汽车、远程医疗和智能工厂等领域的创新。

人工智能（ AI ）和机器学习：AI 和机器学习技术正在与物联网平台紧密结合，以实现更智能的数据分析和决策。通过使用 AI 算法，物联网设备可以自动识别模式、预测故障、优化资源利用和提高能效。

区块链技术：区块链技术为物联网提供了一种去中心化、安全和可靠的数据存储和交换机制。通过使用区块链，物联网设备可以实现安全的设备身份认证、数据完整性保护和智能合约自动执行等功能。

数字孪生技术：数字孪生是一种将物理设备和虚拟模型相互关联的技术。通过使用数字孪生，物联网平台可以实时监控设备状态、预测设备性能、优化设备维护和提高设备寿命。

无人机和自主机器人：无人机和自主机器人正在与物联网技术相结合，以实现自动巡检、远程监控、物流配送和灾害救援等应用。这些自主设备可以与物联网平台进行实时通信，以实现智能调度和协同作业

```

### 场景-行业-厂商

```sh

工业物联网

    https://www.neuseer.com/ 寄云科技

智慧物流
    京东物流, 菜鸟网络, G7, 易流科技

能源
    国家电网, 远景能源

地产/物业
    云智易, 德立云

社区/园区
    特斯联

智能家居
    涂鸦智能, 小米AIot平台

车联网

智慧零售

智慧医疗

农业养殖
    极飞科技, 托普云农

    自动灌溉, ai自动培育草莓

安全
    奇虎科技, 青莲云, 梆梆安全,
```

### 基本概念

refer to https://help.aliyun.com/zh/iot/product-overview/terms

```sh

产品 设备的集合，通常指一组具有相同功能的设备。物联网平台为每个产品颁发全局唯一的ProductKey。
    - ProductSecret 通常与ProductKey成对出现，可用于一型一密的认证方案。
    - 可以根据产品批量管理设备，如定义物模型、自定义Topic, 配置联网方式, 定义数据格式, 设备认证方式等

设备 归属于某个产品下的具体设备。物联网平台为设备颁发产品内唯一的证书DeviceName。设备可以直接连接物联网平台，也可以作为子设备通过网关连接物联网平台。

分组 物联网平台支持建立设备分组，分组中可包含不同产品下的设备。通过设备组来进行跨产品管理设备。

网关 能够直接连接物联网平台的设备，且具有子设备管理功能，能够代理子设备连接云端。

子设备 本质上也是设备。子设备不能直接连接物联网平台，只能通过网关连接。

设备证书 指ProductKey (为产品颁发的全局唯一标识)、DeviceName (为设备颁发的标识, 具备产品维度内的唯一性)、DeviceSecret(和DeviceName成对出现)的组合

设备X.509证书 支持设备使用X.509数字证书进行身份验证。您创建认证方式为X.509证书的设备后，物联网平台为设备颁发对应的X.509证书，证书信息包括：X.509数字证书（Certificate）、X.509证书ID（CertSN）和X.509证书密钥（PrivateKey）。

Topic Topic是UTF-8字符串，是发布（Pub）/订阅（Sub）消息的传输中介。可以向Topic发布或者订阅消息。

Topic类 同一产品下不同设备的Topic集合，用${productkey}和${deviceName}通配一个唯一的设备，一个Topic类对一个ProductKey下所有设备通用。

标签 标签分为产品标签、设备标签和分组标签。

    产品标签：描述同一个产品下，所有设备所具有的共性信息。

    设备标签：通常根据设备的特性为设备添加的特有标记，您可以自定义标签内容。

    分组标签：描述同一个分组下，所有设备所具有的共性信息。

物模型 即一类物理世界的实物（如传感器）在平台的数字化模型, 就是该实体能对外提供什么信息以及能对它做什么，包括设备的属性、服务和事件。物联网平台通过定义一种物的描述语言来描述物模型，称之为TSL（即 Thing Specification Language），采用JSON格式，您可以根据TSL组装上报设备的数据。
    - 属性 设备的功能模型之一，一般用于描述设备运行时的状态，如环境监测设备所读取的当前环境温度等。属性支持GET和SET请求方式。应用系统可发起对属性的读取和设置请求。
    - 服务 设备的功能模型之一，设备可被外部调用的能力或方法，可设置输入参数和输出参数。相比于属性，服务可通过一条指令实现更复杂的业务逻辑，如执行某项特定的任务。
    - 事件 设备的功能模型之一，设备运行时的事件。事件一般包含需要被外部感知和处理的通知信息，可包含多个输出参数。例如，某项任务完成的信息，或者设备发生故障或告警时的温度等，事件可以被订阅和推送。

设备影子 是一个JSON文档，用于缓存设备上报的状态数据和应用程序下发的指令信息, 解耦应用和终端设备。每个设备都会在云端有唯一的设备影子。设备可以通过MQTT获取和设置设备影子来同步状态，用于存储设备上报状态、应用程序期望下发的配置。一般用于网络不稳定、设备无法实时通信、一个设备在同一时间被反复请求等场景。
    - 设备在线时，可以直接获取物联网平台指令；设备离线后，再次上线可以主动拉取物联网平台指令
    - 设备可以通过MQTT获取和设置设备影子来同步状态，该同步可以是影子同步给设备，也可以是设备同步给影子。
https://help.aliyun.com/zh/iot/user-guide/json-format-of-device-shadows

数据解析脚本 针对采用透传格式/自定义数据格式的设备，需要在云端编写数据解析脚本，将设备上报的二进制数据或自定义的JSON数据，转换为物联网平台支持的Alink JSON数据格式；将平台下发的Alink JSON格式数据，转换为设备支持的格式。




一机一密 每个设备烧录其唯一的设备证书（ProductKey、DeviceName和DeviceSecret）

一型一密 同一产品下所有设备可以烧录相同产品证书（即ProductKey和ProductSecret）
```

### 雾计算&边缘计算

随着各种硬件设备产生更多的数据, 对网络和云资源提出更多要求，传统的服务器及云计算架构开始出现两个主要问题:

- 带宽是有限的，传输大量的数据很昂贵
- 请求/响应时间延迟会导致对时间敏感的操作的决策速度变慢，甚至出现更糟糕的情况(如自动驾驶)。

解决方案是将一些计算能力转移到系统的边缘，也就是靠近资产设备端, 这样就出现了雾计算(Fog Computing)与边缘计算(Edge Computing)的概念。

```sh

雾计算, 雾计算是思科发明的技术，这是对基于网关概念的一个扩展，在这里网关增加了大量本地存储和计算功能, 由性能较弱、更为分散的各种功能计算机组成，渗入电器、工厂、汽车、街灯及人们生活中的各种物品。相对于云计算它离产生数据的地方更近，数据、数据相关的处理和应用程序都集中于网络边缘的设备中，而不是几乎全部保存在云端。这里因“云”而“雾”的命名源自“雾是更贴近地面的云”这句话。

边缘计算, 它进一步推进了雾计算中“局域网处理能力”的理念，也就是说离资产硬件更近一些。边缘计算将边缘网关或设备的智能、处理能力和通信操作直接驱动到设备本身

场景案例: 在公共运营类车辆有视频监控需求，其中一项是司机行为监控(Driver State Monitoring DSM)，包含疲劳驾驶、分神驾驶、抽烟、接打电话、驾驶人异常等监控和报警等功能。

    边缘计算可以安装摄像头、微处理器及报警器等设备解决对司机的实时监控和报警，在有违规的情况下及时提醒司机纠正，保证车内乘客安全。

    雾计算可以在公路构建微型服务站，收到车辆中司机行为监控报警后，会向周边车辆发出报警信息，提醒周边车辆司机注意驾驶安全。报警车辆同时及时上传照片及视频信息，留取现场证据。

    边缘端和雾端根据需求分别向云端上报信息，在云端储存监控事件，并使用大数据技术挖掘和分析路段安全、车辆安全、司机绩效等有价值的信息。
```

## 设备网关选型

若每个传感器都配置4G/5G或WIFI功能，成本会相对较高。为了降低成本，在特定项目中，可能会选择有线连接或采用LORA、Zigbee等无线技术, 搭配网关来实现设备入网

物联网网关类似我们常见的路由器，具有网络接入能力, 一般只是做数据透传使用，将物联网的数据转发到服务器上

目前的物联网中，在逐步尝试将原本在云平台上的计算任务，放到靠近数据原产地的设备上完成。这个过程称为将计算能力下沉到边缘设备，也称为边缘计算。但是，很大物联网设备由于计算能力、能耗等的限制，是无法承担这些任务的，因此一个最轻量的解决方案就是在物联网网关中完成这些计算任务, 也叫雾计算

```sh
数据透传网关，简称DTU，仅支持数据透传功能，有一路或两路串口，可以直接应用于大部分的物联网场景，不过数据采集和自动控制都在服务器上实现，对服务器压力较大，适合单一或小型项目，并发量上不去

数据采集网关，自带协议库，支持常见工业设备主要应用在工业互联网场景，可以采集PLC，DCS等设备
    如果设备比较多，并发量大，那么我们就需要有数据解析功能的网关

边缘计算网关，CPU和内存比较大，使用Linux操作系统，支持二次开发
    如果需要在现场做实时的自动控制，或者实现更高级的功能，那么我们就只能使用边缘计算网关

```

## 设备网络传输协议选型


ModbusTcp，PLC，TCP/ip, opcServer

M2M协议、工业协议

熟悉无线传感网络、以太网、现场总线等通讯技术，了解RFID、ZigBee、Wi-Fi、等技术，掌握主流传感器应用方案

### HTTPS

### CoAP

### mqtt

MQTT 3.1.1/5.0

MQTT（Message Queuing Telemetry Transport，消息队列遥测传输协议），是一种基于发布/订阅（publish/subscribe）模式的“轻量级”即时通讯协议，该协议构建于TCP/IP协议上

低开销、低带宽占用等优点, 特别适合用来当做物联网的通信协议

场景:

-（1）消息推送： 如PC端的推送公告，比如安卓的推送服务，还有一些即时通信软件如微信、易信等也是采用的推送技术。
-（2）智能点餐： 通过MQTT消息队列产品，消费者可在餐桌上扫码点餐，并与商家后端系统连接实现自助下单、支付。
-（3）信息更新： 实现商场超市等场所的电子标签、公共场所的多媒体屏幕的显示更新管理。
-（4）扫码出站： 最常见的停车场扫码缴费，自动起竿；地铁闸口扫码进出站。


```sh

MQTT Client

MQTT Broker

MQTT Connection
    参数:
    - ClientId
    - Clean Session
    - Username/Password
    - Will Message
    - KeepAlive
    - QOS 此数字表示消息的服务质量 (QoS)。有三个级别：0、1 和 2
        QoS 0（最多一次）：消息发布完全依赖底层 TCP/IP 网络。会发生消息丢失或重复。这个级别可用于如下情况，环境传感器数据，丢失一次数据无所谓，因为不久后还会有第二次发送。
        QoS 1（至少一次）：确保消息到达，但消息重复可能会发生。
        QoS 2（只有一次）：确保消息到达一次。这个级别可用于如下情况，在计费系统中，消息重复或丢失会导致不正确的结果。
    - Payload 每条消息的实际内容。MQTT 是数据无关性的。可以发送任何文本、图像、加密数据以及二进制数据。
    - timeout：MQTT会尝试接收数据，直到timeout时间到后才会退出。

```

#### mqtt broker 服务端选型

https://blog.csdn.net/emqx_broker/article/details/120017095

```sh

https://www.emqx.com/zh emqx

https://learnku.com/articles/46174 rabbitmq

```

桌面客户端 https://github.com/emqx/MQTTX


## 设备网络接入选型

```sh

- 运营商网络：(适用于室外移动场景)
NB-IoT：电信布网最好，但是强制走电信云平台；联通下一线城市布网率还行，其他基本够呛。适用非快速移动设备的数据上报场景，下发较麻烦。
2G：成熟稳定，但退网是必然趋势
4G：价高功耗高
eMTC：起步阶段


- 通过局域网网关接入广域网：(适用于室内场景)
WiFi：这个不解释，很常见, 一般室内家用才会选择
LoRa：低功耗上报场景为主，需自组网，NB-IoT 的直接竞争者 (LoRaWAN 类似于 Wi-Fi，可以自己组网需要搭建物联网关)
BLE：一般智能家居场景
Zigbee：一般智能家居
网关/蓝牙: 适用于室内商用如商场 ( WIFI 扛不住那么多节点接入)


```

## 基于 Java 生态的物联网中台

### 产品架构

```sh
设备层
    - 设备
        - RFID射频识别标签
        - 传感器
    - 网络协议
        - 网络通讯协议
            - mqtt 协议 是一个基于客户端-服务器的消息发布/订阅传输协议，可保持长连接，实现多对多异步通信；
                是TCP/IP技术的一种扩展，具有较小的体积，特别适合硬件性能或网络传输速度受限的设备, 是物联网协议事实上的标准
            - CoAP 协议 是一种客户端-服务器单对单的协议，具备轻量低功耗的特点。
        - 设备接入互联网(设备入网) / 网络传输协议
            - 有线通讯
                - 以太网/光纤
                - 串口通讯：按位（bit）发送和接收字节，如USB/RS485/RS232等    
            - 无线短距离局域网
                - ZigBee(紫蜂)
                    - 低速, 短距(百米范围), 功耗低
                    - 工作频段在4GHz
                    - 通过节点+网关的方式，可以搭建万级节点拓扑的私有网络 (适用于需要接入大量设备的工/农业领域)
                - Wifi
                    - 高速, 短距(百米范围), 功耗高(一般只用于有源设备)
                    - 工作频段在2.4GHz和5GHz
                - Bluetooth（蓝牙）4.0
                    - 中速, 短距(十米范围), 功耗高, 成本高
                    - 工作频段在4GHz
                    - 连接设备的数量不多
            - 无线长距离广域网
                - Lora（Long Range Radio）
                    - 低速, 远距(2~15km的范围), 功耗低
                    - 在中国使用的是470-510MHz免授权频段
                    - 通过节点+网关的方式搭建网络 (适用于智慧工地等需要远距离通信的场景)
                - NB-IoT（Narrow Band Internet of Things，窄带物联网）：一种新兴的低功耗远距通信技术.
                    - 高速, 远距(10km级别), 低功耗 (低功耗休眠机制，会导致无法实时通信)
                    - 属于授权频段，只需要180kHz的带宽便可部署至运营商网络上
                - 4G
                    - 高速, 远距, 功耗大
                    - 工作频段为824~960 MHz，1710~2690 MHz
        - 其他行业协议, 例如，车联网的JT/T808 , 电表的 DL/T645 和 GB3761 和 IEC104, 视频GB/T 28181, 环保行业的 HJ212, 水文监测的 SL651

平台层
    产品管理
        - 产品信息管理: 硬件产品的功能描述、性能参数、发布状态等信息管理
        - 物模型管理
        - 组网拓扑管理: 对于设备/网关, 由于通讯方式不同，产品的组网拓扑便不同。此处描述各类产品入网的拓扑关系；
        - 版本/固件管理: 对产品的版本信息及固件进行管理；
    设备管理
        - 设备全生命周期管理: 对设备的物理状态、健康状态、资产归属、调试日志进行记录，记录设备从入库到报废的全生命周期，便于问题追溯分析。
        - 多协议支持 (如：MQTT 、HTTP 、TCP 、Modbus 、GB28181 视频协议、萤石云视频协议等)
        - 设备资产管理: 控制用户对设备的操作权限
        - 虚拟设备: 根据物模型构建虚拟设备，用于用户体验、真实设备受限时的模拟调试验证、批量压测验证平台性能等场景。
        - 设备影子
        - 设备接入
            - 协议接入: 使用MQTT协议接入数据，并根据场景定义不同topic进行消息发布订阅
            - 设备鉴权认证: 以网关为单位，对接入数据topic做发布订阅鉴权认证，实现topic级别的权限隔离
            - 数据解析转换: 对接入的异构数据进行格式统一，根据物模型对接入数据进行解析。
            - 接入配置: 把接入到平台的数据与具体的实体对象进行握手，以便于在应用中能够区分不同实体对象的数据
            - 消息通信: 当完成设备接入配置后，用户便能实现对设备的交互，包括数据上报、命令下发等。
    数据管理
        - 时序数据库存储
        - 展示基础监测数据, 数据可视化
        - 数据分析, 报表
    规则引擎 (用户可以在物联网平台上可以配置某些规则，在判断条件满足规则后，平台会执行相应的动作来满足用户需求)
        如 设备健康状况预警, 设备联动
        触发条件:
        - 触发对象：可以是某个设备，某个测点，也可以是某个时刻，或某个事件；
        - 触发条件：可以是简单的上下限判断，也可以是一个复杂的函数/算法判断；
        - 触发时间：即时效性，可以是一直有效，或者规定时间内有效；
        - 沉淀机制：避免设备上传相同数据导致重复触发规则。
        执行动作:
        - 指令下发：即对制定设备发送指令；
        - 发送通知：如短信、邮件、小程序、APP推送等；
        - 产生报警：在运维报警监控界面产生一条报警记录；
        - 执行时间：立即、或延时；
        - 执行规则：执行某条规则；
        - 规则状态开关：开启或关闭某条规则。
        日志: 每条状态为开启的规则，每次执行都要留有日志，存储触发时间、判断依据、执行动作记录等
    运维服务
        - 运维监控
        - 通知功能：短信、邮件、电话、webhook 多种通知方式
        - 设备调试
        - ota升级: 上传新的升级包，并将OTA升级消息推送给设备，设备即可在线升级；
        - 日志 (IP 访问路径、设备操作记录)
        - 工单
    多租户 (超级管理员, 租户公司账户, 租户用户账户)

应用层 (客户端app/小程序/web)
    智慧交通/智慧工地/家具/制造/能源/医疗/零售/农业/物流/安防...


```

### 项目初始化

#### 集成mqtt

https://developer.aliyun.com/article/1150694
https://blog.csdn.net/beibei3321/article/details/124187758

```xml

<dependency>
  <groupId>org.springframework.integration</groupId>
  <artifactId>spring-integration-mqtt</artifactId>
</dependency>

```


## 八卦谈资

```sh

"智慧园区，智慧城市，各种智慧，其实技术上不会有很大难度，重要的是有资源不是，先得有渠道有人采购再做才对，哪个细分领域基本都没有空白市场了，偏传统的行业并不在意差异化和创新，拼的还是人脉资源"

"既然是小城市，就做好地头蛇, 比如细分行业细分场景, 地方产业地方特色, 小地方人脉和客户群比做什么做怎样更重要"

"独一无二的硬件 + 基于硬件构建的全家桶解决方案"

"物联网最大的问题是找不到合适的应用场景，目前在用的物联网场景，大多不是刚需, 大多数也就是个监测，整个数据大屏看看曲线而已，但是这些监测数据 99%都是垃圾，没有人关心, 所以物联网做到最后，基本上就变成了 toG 的生意，甲方主要是 zf 和国企，他们才有预算去做这些面子工程"

做平价智能家居然后协议兼容米家和 homekit 

```