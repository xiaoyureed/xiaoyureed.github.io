<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-kubernetes-k8s">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">kubernetes-k8s ☁️ | Xiaoyureed&#x27;s 网络 Wiki </title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xiaoyureed.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://xiaoyureed.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://xiaoyureed.github.io/docs/kubernetes-k8s"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="kubernetes-k8s ☁️ | Xiaoyureed&#x27;s 网络 Wiki "><meta data-rh="true" name="description" content="https://dockone.io/article/2434304"><meta data-rh="true" property="og:description" content="https://dockone.io/article/2434304"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xiaoyureed.github.io/docs/kubernetes-k8s"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/en/docs/kubernetes-k8s" hreflang="en"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/kubernetes-k8s" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/kubernetes-k8s" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Xiaoyureed&#39;s 网络 Wiki  RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Xiaoyureed&#39;s 网络 Wiki  Atom Feed"><link rel="stylesheet" href="/assets/css/styles.c6a654bf.css">
<link rel="preload" href="/assets/js/runtime~main.6d396791.js" as="script">
<link rel="preload" href="/assets/js/main.f6c8ad5f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="xiaoyureed Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="xiaoyureed Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Xiaoyureed</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/xiaoyureed" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/FreeMarker-note">FreeMarker Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/SpringBoot-note">Spring Boot 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/agile-development-user-story-scrum">敏捷开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/android">Android 开发</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/autohotkey">Autohotkey 脚本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/blockchain">blockchain区块链</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/c-sharp-and-dot-net">C# &amp; .NET</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/chatgpt">Chatgpt Usage Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cloud-native-platform">云服务平台</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cpp">CPP and C 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cross-gfw">Cross The GFW</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cs-note">Computer Science Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/css-pre-processor">几种CSS预处理器比较选型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/data-structure-and-algorithm">Data Structure and Algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/design-pattern-note">Design Pattern 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-resources">开发者资源</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/devops">DevOps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/distributed-system">Distributed System 分布式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docker-note-virtual-dev-env">Docker Note &amp; Other Virtual Develop Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/effective-java-reading-note">Effective Java 阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/elk-elastic-log">Distributed log collection分布式日志收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/english-note">英语学习🔥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extjs-note">Extjs 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/flutter">flutter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/games-development-introduce">游戏开发</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/git-note">Git 备忘 🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/github-starts">Github 星标⭐️</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/golang-note">Golang 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gps-gis-tracing">基于地理位置开发技术</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gradle">gradle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/greasy-monkey">油猴插件&amp;编写脚本🐒</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/groovy-note">groovy note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/health">Health 关爱程序员健康🏥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/how-to-test-java-app">How to Test Java App</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/html-note">HTML 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/idea-note">InteliJ idea tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/interview-system-design">经典的系统设计思路</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/iot">Iot 物联网</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-code-clean">Java Clean Code Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-concurrent">Java Concurrent🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-memory-model-jmm-jvm">JMM and GC🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-note">Java Core 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/jquery-note">JQuery notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/js-tutorial">JavaScript tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/kotlin">kotlin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/kubernetes-k8s">kubernetes-k8s ☁️</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux-note">鸟哥的 Linux 私房菜阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mac">Mac 开发环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/machine-learning-ml">machine-learning-ml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/maven-note">Maven Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/message-queue">Message Queue🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/money">Investment Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mongodb-note">MongoDB Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/monitor-system-grafana-prometheus-influxdb-hbase">monitor-system-grafana-prometheus监控🖥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mvc-mvvm">MVC to MVVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mybatis-note">MyBatis Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/netty-note">netty</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nlp-natural-language-processing">nlp-natural-language-processing👄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nodejs-yarn-npm">Nodejs, Yarn, Npm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/oracle">Oracle 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-audio-video">Audio and Video development Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-big-data-introduce">大数据开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-cache">Cache 缓存🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-computational-ad">计算广告 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-crawler-spider">网络爬虫 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-db-design-note">关系型数据库表设计🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-desktop-develop">桌面应用开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-http">HTTP protocol Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-reactive-programming">响应式编程 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-rest-api">RESTful api 及 其他webService技术</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-rpc">RPC Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-rule-engine-note">规则引擎 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/php-note">PHP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/play-framework">Play框架</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/postgres-note">Postgres note🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/process-workflow-bpm-engine">工作流引擎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/protect-your-app-authentication-oauth2-jwt-https">Protect Your App 安全保护认证鉴权🔑</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/python-note">Python🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quant-money">量化交易</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quarkus">Quarkus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/react-note">React🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/real-time-communication-protocol">实时通信 Real-time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/redis-note">Redis🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/regex">Regular Expression 正则🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/rust-note">Rust 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/saas-paas-iaas-as-a-service">SaaS Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/serverless">Serverless</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/service-mesh">service mesh 服务网格</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/servlet">Servlet Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/shell-bash-note">shell-bash脚本收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/spring-note">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springcloud-note">Spring Cloud 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springmvc-note">Spring MVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/task-schedule-note">Task Schedule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tcp-ip-note">TCP IP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tomcat-jetty-nginx">Tomcat Jetty Nginx 等 web 容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/vertx">Vertx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/video-creator">拍摄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webassembly">webassembly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webpack-esbuild-vite-rollup">前端打包构建工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/windows-sub-system-on-linux">WSL 使用</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">kubernetes-k8s ☁️</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>kubernetes-k8s ☁️</h1></header><p><a href="https://dockone.io/article/2434304" target="_blank" rel="noopener noreferrer">https://dockone.io/article/2434304</a></p><p>熟练掌握 k8s ，自己搭个集群，之后学习 Kubernetes 的二次开发，CRD 与 operator </p><p><a href="https://github.com/fanux/sealos" target="_blank" rel="noopener noreferrer">https://github.com/fanux/sealos</a> 一键安装</p><p><a href="https://github.com/eip-work/kuboard-press" target="_blank" rel="noopener noreferrer">https://github.com/eip-work/kuboard-press</a> 面板, 教程</p><p><a href="https://github.com/derailed/k9s" target="_blank" rel="noopener noreferrer">https://github.com/derailed/k9s</a> 管理 k8s 的命令行工具</p><p><a href="https://github.com/caicloud/kube-ladder" target="_blank" rel="noopener noreferrer">https://github.com/caicloud/kube-ladder</a> 入门指南
<a href="https://github.com/jpetazzo/container.training" target="_blank" rel="noopener noreferrer">https://github.com/jpetazzo/container.training</a></p><p><a href="https://github.com/kubernetes/kubernetes" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/kubernetes</a>
<a href="https://juejin.im/post/5db8c2b46fb9a020256692dc" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5db8c2b46fb9a020256692dc</a></p><p><a href="https://www.katacoda.com/courses/kubernetes/playground" target="_blank" rel="noopener noreferrer">https://www.katacoda.com/courses/kubernetes/playground</a> k8s web playground
<a href="https://www.katacoda.com/courses/kubernetes" target="_blank" rel="noopener noreferrer">https://www.katacoda.com/courses/kubernetes</a></p><p><a href="https://blog.csdn.net/qq_19734597/article/details/108337499" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/qq_19734597/article/details/108337499</a> 命令行简写</p><ul><li><a href="#1-%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98">.1. 面试问题</a></li><li><a href="#2-what-and-why">.2. what and why</a><ul><li><a href="#21-k8s-%E6%98%AF%E5%81%9A%E4%BB%80%E4%B9%88%E7%9A%84">.2.1. k8s 是做什么的</a></li><li><a href="#22-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8">.2.2. 为什么使用:</a></li></ul></li><li><a href="#3-%E9%9B%86%E7%BE%A4%E7%BB%93%E6%9E%84">.3. 集群结构</a><ul><li><a href="#31-%E4%B8%80%E4%B8%AA-master-%E8%8A%82%E7%82%B9">.3.1. 一个 master 节点</a></li><li><a href="#32-%E4%B8%80%E7%BE%A4worker%E8%8A%82%E7%82%B9">.3.2. 一群worker节点</a></li></ul></li><li><a href="#4-%E9%80%BB%E8%BE%91%E7%BB%93%E6%9E%84">.4. 逻辑结构</a><ul><li><a href="#41-pod">.4.1. pod</a></li><li><a href="#42-volume">.4.2. volume</a></li><li><a href="#43-controllers">.4.3. controllers</a></li><li><a href="#44-service">.4.4. service</a></li><li><a href="#45-flannel">.4.5. flannel</a></li><li><a href="#46-ingress">.4.6. ingress</a></li><li><a href="#47-name-namespace">.4.7. name namespace</a></li></ul></li><li><a href="#5-%E8%B5%84%E6%BA%90%E6%8F%8F%E8%BF%B0%E6%96%87%E4%BB%B6">.5. 资源描述文件</a><ul><li><a href="#51-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E7%94%9F%E6%88%90-yml">.5.1. 通过命令生成 yml</a></li><li><a href="#52-pod-%E7%9A%84--yaml-%E6%8F%8F%E8%BF%B0%E6%96%87%E4%BB%B6">.5.2. pod 的  yaml 描述文件</a></li><li><a href="#53-deployment-%E7%9A%84%E6%8F%8F%E8%BF%B0%E6%96%87%E4%BB%B6">.5.3. deployment 的描述文件</a></li><li><a href="#54-service">.5.4. service</a></li></ul></li><li><a href="#6-%E6%A0%87%E7%AD%BE">.6. 标签</a></li><li><a href="#7-%E6%B3%A8%E8%A7%A3">.7. 注解</a></li><li><a href="#8-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4">.8. 命名空间</a></li><li><a href="#9-pod-%E7%AE%A1%E7%90%86">.9. pod 管理</a><ul><li><a href="#91-%E6%8E%A2%E6%B5%8B-pod-%E6%98%AF%E5%90%A6%E5%81%A5%E5%BA%B7">.9.1. 探测 pod 是否健康</a></li><li><a href="#92-pod-%E5%89%AF%E6%9C%AC">.9.2. pod 副本</a></li><li><a href="#93-%E8%BF%90%E8%A1%8C%E5%8D%95%E4%B8%AA%E4%BB%BB%E5%8A%A1-job">.9.3. 运行单个任务 Job</a></li><li><a href="#94-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1-cronjob">.9.4. 定时任务 CronJob</a></li></ul></li><li><a href="#10-pod-%E9%80%9A%E4%BF%A1">.10. pod 通信</a><ul><li><a href="#101-proxy">.10.1. proxy</a></li><li><a href="#102-service">.10.2. Service</a></li><li><a href="#103-pod-%E9%97%B4%E9%80%9A%E4%BF%A1">.10.3. pod 间通信</a></li><li><a href="#104-%E9%80%9A%E8%BF%87-service-%E8%BF%9E%E6%8E%A5%E5%A4%96%E9%83%A8%E6%9C%8D%E5%8A%A1">.10.4. 通过 Service 连接外部服务</a><ul><li><a href="#1041-%E9%80%9A%E8%BF%87%E6%89%8B%E5%8A%A8%E7%94%9F%E6%88%90-endpoint">.10.4.1. 通过手动生成 endpoint</a></li><li><a href="#1042-%E9%80%9A%E8%BF%87-externalname-%E7%B1%BB%E5%9E%8B%E7%9A%84-service">.10.4.2. 通过 externalName 类型的 Service</a></li></ul></li><li><a href="#105-%E5%B0%86%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2%E7%BB%99%E5%A4%96%E9%83%A8">.10.5. 将服务暴露给外部</a><ul><li><a href="#1051-%E5%B0%86%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%B1%BB%E5%9E%8B%E8%AE%BE%E7%BD%AE%E6%88%90-nodeport">.10.5.1. 将服务的类型设置成 NodePort</a></li><li><a href="#1052-%E5%B0%86%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%B1%BB%E5%9E%8B%E8%AE%BE%E7%BD%AE%E6%88%90loadbalance">.10.5.2. 将服务的类型设置成LoadBalance</a></li><li><a href="#1053-%E5%88%9B%E5%BB%BA%E4%B8%80-%E4%B8%AAingress%E8%B5%84%E6%BA%90">.10.5.3. 创建一 个Ingress资源</a></li></ul></li></ul></li><li><a href="#11-%E5%91%BD%E4%BB%A4">.11. 命令</a><ul><li><a href="#111-%E5%AE%89%E8%A3%85">.11.1. 安装</a></li><li><a href="#112-kind">.11.2. kind</a></li><li><a href="#113-minikube">.11.3. minikube</a></li><li><a href="#114-%E4%BD%BF%E7%94%A8-kubectl">.11.4. 使用 kubectl</a><ul><li><a href="#1141-%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF">.11.4.1. 基本信息</a></li><li><a href="#1142-%E5%88%9B%E5%BB%BA-create-expose">.11.4.2. 创建 create expose</a></li><li><a href="#1143-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E5%88%B0%E5%AE%B9%E5%99%A8-exec">.11.4.3. 执行命令到容器 exec</a></li><li><a href="#1144-%E4%BF%AE%E6%94%B9">.11.4.4. 修改</a></li><li><a href="#1145-%E8%B5%84%E6%BA%90%E5%88%97%E8%A1%A8-get">.11.4.5. 资源列表 get</a></li><li><a href="#1146-%E6%9F%A5%E8%AF%A2%E8%AF%A6%E7%BB%86%E6%8F%8F%E8%BF%B0-describe">.11.4.6. 查询详细描述 describe</a></li><li><a href="#1147-%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97-logs">.11.4.7. 查询日志 logs</a></li><li><a href="#1148-%E5%88%A0%E9%99%A4-delete">.11.4.8. 删除 delete</a></li></ul></li><li><a href="#115-kubeadmin">.11.5. kubeadmin</a></li></ul></li><li><a href="#12-%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2">.12. 可视化界面</a></li><li><a href="#13-vagrant-%E6%90%AD%E5%BB%BA-k8s-%E7%8E%AF%E5%A2%83">.13. vagrant 搭建 k8s 环境</a></li><li><a href="#14-cka-%E8%AF%81%E4%B9%A6">.14. cka 证书</a></li><li><a href="#15-k3s">.15. k3s</a></li><li><a href="#16-k0s">.16. k0s</a></li><li><a href="#17-rancher">.17. rancher</a></li><li><a href="#18-harbor">.18. Harbor</a></li><li><a href="#19-helm-chart">.19. helm chart</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="面试问题">面试问题<a href="#面试问题" class="hash-link" aria-label="面试问题的直接链接" title="面试问题的直接链接">​</a></h2><p>为什么需要 pod? 为什么不能简单地把所有进程都放在一个单独的容器中?</p><ul><li>如果在单个容器中运行多个不相关的进程， 那么保持所有进程运行(如失败重启)、 管理它们的日志会困难(日志会混在一起)。</li></ul><p>为什么要将一个 app 的 前端服务器 和 后端服务器 分为 两个 pod 部署?</p><ul><li><p>造成计算资源浪费: 如果部署到同一个 pod, 那么对于 双节点 k8s, 将总是只能利用一个节点</p></li><li><p>扩缩容不便: k8s 扩容基本单位就是 pod, 前后端若部署到同个 pod, 会造成扩缩容粒度太大. 而且对于 数据库服务器, 扩缩容无法这样简单处理</p></li></ul><p>如何决定是否将多个 container 划分到一个 pod?</p><ul><li>扩缩容是否能够一起进行</li><li>是否可以在同个主机运行</li></ul><p>11年运维工作经验，现从事腾讯工业互联网运维工作；
DevOps运维工程师，开源爱好者；
3年+Kubernetes平台经验，对Kubernetes生态有自己的认识；
掌握Jenkins+Gitlab+Helm持续集成/持续交付工具链；
对消息队列，缓存等中间件，软件架构体系有一定的了解；
熟练掌握shell编程，熟悉Python,Go语言；
TODO</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-and-why">what and why<a href="#what-and-why" class="hash-link" aria-label="what and why的直接链接" title="what and why的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="k8s-是做什么的">k8s 是做什么的<a href="#k8s-是做什么的" class="hash-link" aria-label="k8s 是做什么的的直接链接" title="k8s 是做什么的的直接链接">​</a></h3><p>抽象了数据中心的硬件基础设施，对外暴露统一的接口，具体包括</p><ul><li>调度:  k8s 自动决定组件部署到具体的哪一台 服务器节点。</li><li>自动修复: 自动检查节点的健康状态, 吧程序迁移到健康的节点上</li><li>水平伸缩:  自动检测业务的负载情况, 如果 CPU 负载太高, 或者相应时间太长, 会自动进行扩容</li></ul><p>只需要告诉 k8s 要做什么 (比如保持某个 pod 有三个副本), 而不必告诉它怎么做, 就像 sql 只告诉 数据库要查询那些数据, 而没有告诉数据库怎么查数据</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="为什么使用">为什么使用:<a href="#为什么使用" class="hash-link" aria-label="为什么使用:的直接链接" title="为什么使用:的直接链接">​</a></h3><p>当 container 太多, 需要管理, 单机情况下, 还能依靠 docker-compose 这些工具, 当有很多机器时, 就必须通过 k8s 来将 容器合理地分配到这些机器中去 </p><ul><li>服务发现和负载均衡</li><li>自动部署 and 回滚</li><li>替换失败容器 (自我修复)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="集群结构">集群结构<a href="#集群结构" class="hash-link" aria-label="集群结构的直接链接" title="集群结构的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="一个-master-节点">一个 master 节点<a href="#一个-master-节点" class="hash-link" aria-label="一个 master 节点的直接链接" title="一个 master 节点的直接链接">​</a></h3><p>master 节点：控制 and 管理整个集群</p><p>通常会有多个master node 高可用 , 故障转移</p><p>包含这些组件</p><ul><li><p>etcd: 分布式数据存储. 用来存储主节点的数据 (键值数据库)</p></li><li><p>api server：网关, 和外界交互, 供客户端调用</p></li><li><p>scheduler：调度， 决定哪个 pod 部署到哪个节点; 监视那些新创建的未指定运行节点的 Pod，并选择节点让 Pod 在上面运行</p></li><li><p>controller manager：整个集群的管家，用来管理资源对象;如 复制节点， 持续跟踪工作节点</p><ul><li>node controller 在节点出现故障时进行通知和响应</li><li>Replication Controller 维护正确数量的 Pod</li><li>Endpoints Controller填充端点(Endpoints)对象(即加入 Service 与 Pod)</li></ul></li></ul><p>Minikube 管理的是单节点 k8s， master node， 和 worker node 都在一台物理主机上</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="一群worker节点">一群worker节点<a href="#一群worker节点" class="hash-link" aria-label="一群worker节点的直接链接" title="一群worker节点的直接链接">​</a></h3><p>worker 节点：运行实际部署的 容器</p><p>可以只有一个 worker node</p><p>包含这些组件    </p><ul><li><p>kubelet: 和 master 节点的 api server 通信 and 管理所在的 节点/机器上的 pod (创建、修改、监控、删除)</p><p>  相当于节点的代理, 和 master 节点交互</p></li><li><p>kube-proxy: 负责 pod 间的负载均衡 网络代理</p></li><li><p>Fluentd，主要负责日志收集、存储与查询</p></li><li><p>container runtime (docker) 创建容器</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="逻辑结构">逻辑结构<a href="#逻辑结构" class="hash-link" aria-label="逻辑结构的直接链接" title="逻辑结构的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pod">pod<a href="#pod" class="hash-link" aria-label="pod的直接链接" title="pod的直接链接">​</a></h3><p>pod: 由 一个或多个相互关联的 container 组成, 是 k8s 管理的基本单位, 代表着集群中的一个虚拟主机</p><p>一个pod 只可能存在于一个 worker node 机器上, 不可跨节点</p><p>一个 pod 内的所有容器共享相同的 Linux network 命名空间. 这样每个 pod 就像一台独立的 主机, 有自己的 ip (集群内部地址), 主机名, 端口 (pod 中的 containers 共享 该 ip 以及 端口空间, 具有相同的 loopback 网络接口,可使用 localhost相互通信). </p><p>可以和 docker-compose 启动的多个 container 类比</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="volume">volume<a href="#volume" class="hash-link" aria-label="volume的直接链接" title="volume的直接链接">​</a></h3><p>在 pod 中可访问的文件目录</p><p>可被挂载到 pod 中的一个/多个 container 的指定路径 下</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="controllers">controllers<a href="#controllers" class="hash-link" aria-label="controllers的直接链接" title="controllers的直接链接">​</a></h3><p>pod 控制器, 部署/管理 pods</p><ul><li><p>replicaSet 创建/复制  pod 实例, 确保 pod 副本数量, 用来代替 replication Controller , 但是不能直接使用Replica Sets设置，而是要使用Deployments。Deployments包装了Replica Sets，在应用程序中设置并添加回滚更新升级功能</p></li><li><p>Deployment 无状态应用部署, 指定一组 pod 的副本数量, 版本; 一次 deployment 会产生多个 pods</p><p>  管理 ReplicaSet, 支持滚动更新</p></li><li><p>StatefulSet 有状态应用部署 (如 MySQL)</p></li><li><p>daemonset 确保每个 node  都运行一个指定 pod</p></li><li><p>job 一次性任务</p></li><li><p>cronjob 定时任务</p></li><li><p>replication Controller: 用于创建/复制  pod 实例. 确保 pod 实例数符合要求</p><p>  <code>kubectl run ...</code> 会创建一个 rc， 然后 rc 创建 pod （所以删除这样的 pod， 需要先删除 rc）</p><p>  工作流程：寻找 符合 label selector 的pod， 比较找到的 pod 和期望数量， 少了就从当前模板创建新的 pod 副本 ， 多了， 就删除多的 pod</p><p>  三个部分：</p><ul><li><p>label selector： 用于确定ReplicationController作用域中有哪些 pod</p></li><li><p>replica count (副本个数）， 指定应运行的pod 数量</p></li><li><p>pod template (pod模板）， 用于创建新的pod 副本</p><p>在新版的 K8s 中，建议使用 ReplicaSet 作为副本控制器，ReplicationController 不再使用了</p></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="service">service<a href="#service" class="hash-link" aria-label="service的直接链接" title="service的直接链接">​</a></h3><p>暴露 集群内部的一组 pods 的外部访问接口, 供外部访问, 以负载均衡. 有自己的静态 ip</p><p>类似 网关的角色, 通过某个 service, 可访问一组提供相同服务的 pods</p><p>另一个方法是： 端口转发 <code>kubectl port-forward</code>, 用于临时调试</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="flannel">flannel<a href="#flannel" class="hash-link" aria-label="flannel的直接链接" title="flannel的直接链接">​</a></h3><p>是CoreOS团队针对Kubernetes设计的一个网络规划服务，简单来说，它的功能是让集群中的不同节点主机创建的Docker容器都具有全集群唯一的虚拟IP地址, 让属于不同节点上的容器能够直接通过内网IP通信</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ingress">ingress<a href="#ingress" class="hash-link" aria-label="ingress的直接链接" title="ingress的直接链接">​</a></h3><p><a href="https://mritd.com/2017/03/04/how-to-use-nginx-ingress/" target="_blank" rel="noopener noreferrer">https://mritd.com/2017/03/04/how-to-use-nginx-ingress/</a></p><p>用来路由多个 service, 相当于 nginx, 常用的实现是 ingress-nginx</p><p>原理: Ingress Contronler 通过与 Kubernetes API 交互，动态的去感知集群中 Ingress 规则变化，然后读取它，按照自定义的规则，规则就是写明了哪个域名对应哪个service，生成一段 Nginx 配置，再写到 Nginx-ingress-control的 Pod 里，这个 Ingress Contronler 的pod里面运行着一个nginx服务，控制器会把生成的nginx配置写入/etc/nginx.conf文件中，然后 reload 一下 使用配置生效。以此来达到域名分配置及动态更新的问题。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="name-namespace">name namespace<a href="#name-namespace" class="hash-link" aria-label="name namespace的直接链接" title="name namespace的直接链接">​</a></h3><p>k8s resources name , every resouece have its own name, kind, metadata, spec, status...</p><p>namespace: isolate all all kinds of resources. resources of the same kind cannot have the same name in the same namespace</p><p>default init namespece: default, kube-system</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="资源描述文件">资源描述文件<a href="#资源描述文件" class="hash-link" aria-label="资源描述文件的直接链接" title="资源描述文件的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="通过命令生成-yml">通过命令生成 yml<a href="#通过命令生成-yml" class="hash-link" aria-label="通过命令生成 yml的直接链接" title="通过命令生成 yml的直接链接">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create deployment tomcat6 --image=tomcat:6.0.53-jre8 --dry-run -o yaml &gt; tomcat6.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f xxx.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pod-的--yaml-描述文件">pod 的  yaml 描述文件<a href="#pod-的--yaml-描述文件" class="hash-link" aria-label="pod 的  yaml 描述文件的直接链接" title="pod 的  yaml 描述文件的直接链接">​</a></h3><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1 </span><span class="token comment" style="color:#999988;font-style:italic">#(k8s api server version)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Deployment、Job、Ingress、Service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod </span><span class="token comment" style="color:#999988;font-style:italic">#(对象类型)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#包括名称、命名空间、标签和关于该容器的其他信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">manual</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># optional, default ns: default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">xxx_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">yyy_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yyy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 包括一些container，storage，volume, 探针...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 容器会监听的端口, 仅仅是展示, 没有 指定作用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">protocal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 存活探针， 用于 pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 在生产中 运行的pod, 一定 要定义 一 个存 活探针</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">livenessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">httpGet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 如果没有设置初始延迟，探针将在启动时立即开始探测容器， 这通常会导致探测失败， 因为应用程序还没准备好开始接收请求。 如果失败次数超过阅值，在应用程序能正确响应请求之前， 容器就会重启。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 在第一次探测前， 等待 15s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">delay</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 示在容器启动后立即开始探测。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 容器必须在1秒内进行响应， 不然这次探测记作失败</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">period</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 每10秒探测一次容器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">failure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 探测连续三次失败(#fa辽ure= 3)后重启容器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#包含运行中的 po 的当前信息，例如 po 所处的条件 每个容器的描述和状态，以及内部 IP 和其他基本信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-的描述文件">deployment 的描述文件<a href="#deployment-的描述文件" class="hash-link" aria-label="deployment 的描述文件的直接链接" title="deployment 的描述文件的直接链接">​</a></h3><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nodeSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">gpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#使用 标签选择器使得 pod 只被调度到符合要求的 worker node </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># select pods that will be affected by this deployment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># have to match labels that specified in template.metadata.labels</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># tells deployment to run 2 pods matching the template</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># define pods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-1">service<a href="#service-1" class="hash-link" aria-label="service的直接链接" title="service的直接链接">​</a></h3><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LoadBalancer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="标签">标签<a href="#标签" class="hash-link" aria-label="标签的直接链接" title="标签的直接链接">​</a></h2><p>标签 (label)：标签是可以附加到资源 (pod, node ...) 的任意键值对. 用来对 资源进行 分类管理</p><p>标签选择器：可以选出符合要求的 pod 子集</p><ul><li>包含/不包含 特定 key 的 资源</li><li>包含特定 key， value 的 资源</li><li>包含 特定 key， 且 value 和指定的不同的资源</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="注解">注解<a href="#注解" class="hash-link" aria-label="注解的直接链接" title="注解的直接链接">​</a></h2><p>注解: TODO</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="命名空间">命名空间<a href="#命名空间" class="hash-link" aria-label="命名空间的直接链接" title="命名空间的直接链接">​</a></h2><p>K8S namespace: 为 对象资源提供了一个作用域, 在不同的 作用域中可以使用相同的资源名， 但这相同的资源名代表了不同的资源。 类比 java package</p><ul><li><p>通过 label 对 pod 进行分组, 每个 组 可能有 pod 重叠, 通过 k8s namespace 分组可以完全避免重叠</p></li><li><p>ns 只隔离资源， 不隔离运行的对象 （资源实例）， 如 不同ns 中的 pod 仍然可通信</p></li><li><p>适用于多用户 使用 k8s， 限制某个用户的资源使用量</p></li></ul><p>从 ymal 文件创建 ns：</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> custome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ns</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>kubectl create -f custom-ns.yaml</code></p><p>通过命令创建ns： <code>kubectl create namespace custom-namespace</code></p><p>切换 ns： <code>kubectl config set-context $(kubectl config current-context) --namespace &lt;other ns&gt;</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pod-管理">pod 管理<a href="#pod-管理" class="hash-link" aria-label="pod 管理的直接链接" title="pod 管理的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="探测-pod-是否健康">探测 pod 是否健康<a href="#探测-pod-是否健康" class="hash-link" aria-label="探测 pod 是否健康的直接链接" title="探测 pod 是否健康的直接链接">​</a></h3><p>k8s 会保持 pod 始终正常运行， 如果容器的主进程崩溃， Kubelet 将重启容器。 当容器被强行终止时，会创建一个全新的容器—-而不是重启原来的容器</p><p>但是 进程没有崩溃， 有时应用程序也会停止正常工作。 例如， 具有内存泄漏的 Java 应用程序将开始抛出 OutOfMemoryErrors, 但 JVM 进程会一直运行</p><ul><li><p>方法1: 从 app 内部自己检测, 可以在应用中捕获这类错误， 并在错误发生时退出该进程。</p><p>  存在问题: 应用因为无限循环或死锁而停止响应, 这个方法就无效了</p></li><li><p>方法2: 须从外部检查应用程序的运行状况</p><ul><li><p>存活探针 (liveness probe) - 检查容器是否还在运行</p><ul><li><p>HTTP GET 探针, 返回 2xx, 3xx 则代表正常, 不重启</p></li><li><p>TCP套接字探针, 和 pod 正常建立 链接, 正常, 不重启</p></li><li><p>Exec探针 , 进入 pod 某个 container, 执行任意命令, 并检查命令的退出状态码。如果状态码是 0, 则探测成功</p></li></ul></li></ul></li></ul><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> custome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">livenessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">httpGet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pod-副本">pod 副本<a href="#pod-副本" class="hash-link" aria-label="pod 副本的直接链接" title="pod 副本的直接链接">​</a></h3><p>ReplicationController 是一种Kubernetes资源，负责创建和管理 pod 副本</p><p>被 ReplicationController 创建的 pod 为 “托管 pod”， 直接创建的 pod 为 “非托管 pod”。托管 pod 异常退出 （如 worker node 崩溃， 或 该 pod 崩溃）后， ReplicationController 会 创建新的 pod 代替</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Replicationcontroller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 定义ReplicationController时不要指定 选择器，让Kubemetes从pod模板中提取它。这样YAML更简短。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># rc 创建后， label selector 不会再更改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 一般创建后会更改 template</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 创建新 pod 所用的 模板</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 这里的 标签必须和 前面的 标签选择器 匹配， 否则将无休止地创建新的容器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> luksa/kubia</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>kubectl create -f kubia-rc.yaml</p><p>rc 创建后，由于没有任何pod有app=kubia标签， ReplicationController会根据pod模板启动三个新的pod</p><p>由ReplicationController创建的pod并不是绑定到ReplicationController。 在任何时刻， ReplicationController管理与标签选择器匹配的pod。 通 过更改pod的标签， 可以将它 从ReplicationController的作用域中添加或删除 </p><p>尽管一个 pod 没有绑定到一个 ReplicationController ，但 pod 在 metadata.ownerReferences 中引用它 以轻松使用它 来找到一 pod 的 Replication controller</p><p>升级 pod 可以这么做：编辑 rc 的template 后， 删除 所有要升级的 pod， rc 会自动创建升级后的 pod</p><p>================水平缩扩容：</p><p>方法1：<code>kubectl scale re kubia --replicas=3 </code> </p><p>方法2：<code>kubectl edit re kubia</code> 更新 <code>spec.replicas</code> 值</p><p>======================新的替代者 ReplicaSet</p><p>ReplicaSet：ReplicaSet 的行为与ReplicationController 完全相同， 但标签选择器的表达能力更强。</p><ul><li>单个 rc 无法将 pod 与 （ label env=prod 和 env=dev ） 同时匹配，它只能匹配带有 env=devel 标签的 pod 或带有env=dev 标签的 pod</li><li>rs 可以仅仅根据 是否有 label key 存在 来匹配</li></ul><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1beta2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ReplicaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 指定了多个表达式，则所有这些表达式都必须为true才能使选择器与</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># pod匹配。如果同时指定matchLabels和matchExpressions, 则所有标签都</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 必须匹配，并且所有表达式必须计算为true以使该pod与选择器匹配</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">hah</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hoo</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">matchExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hah </span><span class="token comment" style="color:#999988;font-style:italic"># 要求 pod 包含 key 为 hah 的 label</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic"># 要求 label 值为 hoo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic"># operator 可选 In (label 值需要匹配 value 中的一个), NotIn （label 值需要不在 values 中），Exists （label 必须有指定 key，不指定 values）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic"># DoesNotExist （pod不得包含有指定名称的标签。values属性不得指定）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> hoo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 创建新 pod 所用的 模板</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 这里的 标签必须和 前面的 标签选择器 匹配， 否则将无休止地创建新的容器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">hah</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hoo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> luksa/kubia</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>================ DaemonSet 在每个 worker node 上部署一个 pod </p><p>用来运行系统服务，如 kube-proxy</p><p>DaemonSet 管理下的 pod 不是随机分布在 worker node 上， 而是保证 每个 node 只存在一个 pod。 </p><p>若 node 下线， DaemonSet 不会在其他地方创建新的 pod， 但是当某个 node  的 pod 被意外删除，会重新创建新的 pod 代替</p><p>但是 当新的 node 添加进 集群， DaemonSet 会立即部署一个新 pod 到这个 node。</p><p>通过 <code>spec.nodeSelector</code> (节点选择器，原理是给 node 打标签) 只在特定 node 部署 pod</p><p>======================= Deployment ======= 更加方便的管理 Replica Set</p><p>Deployment 额外的特性：</p><ul><li><p>事件，状态查看：可以查看Deployment的升级详细进度和状态</p></li><li><p>回滚：当升级pod镜像或者相关参数的时候发现问题，可以使用回滚操作回滚到上一个稳定的版本或者指定的版本</p></li><li><p>版本记录: 每一次对Deployment的操作，都能保存下来，给予后续可能的回滚使用</p></li><li><p>暂停和启动：对于每一次升级，都能够随时暂停和启动</p></li><li><p>多种升级方案：</p><p>  Recreate：删除所有已存在的pod,重新创建新的; </p><p>  RollingUpdate：滚动升级，逐步替换的策略，同时滚动升级时，支持更多的附加参数，例如设置最大不可用pod数量，最小升级间隔时间等等。</p></li></ul><p>================= HPA 弹性伸缩 根据资源的使用情况自动缩扩容</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="运行单个任务-job">运行单个任务 Job<a href="#运行单个任务-job" class="hash-link" aria-label="运行单个任务 Job的直接链接" title="运行单个任务 Job的直接链接">​</a></h3><p>到目前为止， 我们只谈论了需要持续运行的 pod， 这些 pod 由 rc， rs， ds 管理。 你会遇到只想运行完成工作后就终止任务的清况， 这种 pod 由 Job 管理</p><p>该 pod 在内部进程成功结束时， 不重启容器。一旦任务完成， pod 就被认为处千完成状态</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> batch/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ba七ch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">completions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 顺序运行 5 个 pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">parallelism</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 最多可以 2 个 pod 并行运行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">activeDeadlineSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">120</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># job 超时时间，若 pod 超时还没结束，系统将终止 pod， 标记 job 为失败</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">backOffLimit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># job 标记为失败前的重试次数， 默认 6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Job 的 pod 选择器 将自动根据这里的 labels 创建</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> batch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 重启策略， 指定 容器中进程结束后， k8s 做什么</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 不能是 默认的 Always</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 这里 Never 亦可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">restartPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OnFailure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> luksa/batch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="定时任务-cronjob">定时任务 CronJob<a href="#定时任务-cronjob" class="hash-link" aria-label="定时任务 CronJob的直接链接" title="定时任务 CronJob的直接链接">​</a></h3><p>TODO</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pod-通信">pod 通信<a href="#pod-通信" class="hash-link" aria-label="pod 通信的直接链接" title="pod 通信的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="proxy">proxy<a href="#proxy" class="hash-link" aria-label="proxy的直接链接" title="proxy的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-2">Service<a href="#service-2" class="hash-link" aria-label="Service的直接链接" title="Service的直接链接">​</a></h3><p>pods 有自己的内部地址, 但是无法从 cluster 外部访问, 通过 service 可以暴露到 cluster 外部</p><p>service 是一个逻辑结构, 定义一系列 pods, 以及他们的访问策略(通过类型指定)</p><ul><li>ClusterIP (default): 只能在 cluster 内部访问到 service</li><li>NodePort: 外部可以使用 <code>&lt;NodeIP&gt;:&lt;NodePort&gt;</code> 访问 service</li><li>LoadBalancer: 给 service 分配一个静态 ip, 可以负载均衡多个 pods</li><li>ExternalName: 通过随机名字访问 service (可通过 externalName 在配置中指定). This type requires v1.7 or higher of kube-dns.</li></ul><p>a default service named kubernetes will be created with type ClusterIP</p><p>可以定义配置文件, 指定标签选择器, 选择包含哪些 pods</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pod-间通信">pod 间通信<a href="#pod-间通信" class="hash-link" aria-label="pod 间通信的直接链接" title="pod 间通信的直接链接">​</a></h3><p>Service</p><p>作用：</p><ul><li>服务的主要目标就是使集群内部的其他pod可以访问当前这组pod</li><li>对外暴露服务</li></ul><p>如何创建？</p><p>方式1：<code>kubectl expose rc kubia --type=LoadBalancer --name kubia-http</code></p><p>方式2：通过 <code>kubectl create -f xxx-service.yml</code></p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 配置会话亲和性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 特定客户端产生的所有请求每次都指向同 一个 pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 还可选 None， 默认值。不支持 cookie</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">sessionAffinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClientIP</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># service 的可用端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 可以引用 Pod 中 的 port name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># service将链接转发到 容器的端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 不是必须， 多端口映射必须</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xxx</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>多端口映射</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 配置会话亲和性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 特定客户端产生的所有请求每次都指向同 一个 pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 还可选 None， 默认值。不支持 cookie</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">sessionAffinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClientIP</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># service 的可用端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># service将链接转发到 容器的端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yyy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如何发现 service</p><ul><li><p>通过环境变量发现服务</p><p>  每个 pod 内会有环境变量表示 Service ip （<code>&lt;pod name&gt;_SERVICE_HOST</code>）， port (<code>&lt;pod name&gt;_SERVICE_PORT</code>)</p></li><li><p>通过  dns</p><p>  kube-system ns 中有个 pod 为 kube-dns，就是 dns server。在集群 中的其他 pod 都被配置成使用其作为 dns ( Kubemetes 通过修改容器的 /etc/resolv.conf 实现）。运行在 pod 上的进程 DNS 查询都会被 Kubemetes 自身的 DNS 务器响应</p><p>  pod 是否使用内部的 DNS 服务器是根据 pod 的 spec.dnsPolicy 属性来决定的</p></li><li><p>通过 FQDN （全限定域名） 连接服务</p><p>  <code>curl http://kubia.default.svc.cluster.local </code></p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="通过-service-连接外部服务">通过 Service 连接外部服务<a href="#通过-service-连接外部服务" class="hash-link" aria-label="通过 Service 连接外部服务的直接链接" title="通过 Service 连接外部服务的直接链接">​</a></h3><p>pod  如何访问 k8s 外部 服务？</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="通过手动生成-endpoint">通过手动生成 endpoint<a href="#通过手动生成-endpoint" class="hash-link" aria-label="通过手动生成 endpoint的直接链接" title="通过手动生成 endpoint的直接链接">​</a></h4><p>Service 和 pod 中间不是直接相连， 而是插着 Endpoint，就是一个 ip:port 列表，在创建 Service 时 根据 该服务的 label selector 产生</p><p>如果 Service 没有指定 pod selector， 就不会自动生成 endpoints，需要手动生成，这时可以指定地址为任意 外部的 ip：</p><p>demo-service.yml:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> demo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 没有配置 selector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 将接收端口80上的传入连接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>demo-service-endpoints.yml</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Endpoint的名称必须和 service 的名称相同</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> demo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">subsets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Service将把请求重定向到 下面的 地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">addresses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 11. 11. 11. 11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 22.22.22.22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果稍后决定将 外部服务迁移到Kubemetes 中运行的pod, 可以为服务添加选择器，从而对Endpoint进行自动管理</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="通过-externalname-类型的-service">通过 externalName 类型的 Service<a href="#通过-externalname-类型的-service" class="hash-link" aria-label="通过 externalName 类型的 Service的直接链接" title="通过 externalName 类型的 Service的直接链接">​</a></h4><p>另外的方式来访问外部服务：创建ExtemalName类型的 Service</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> external</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 默认为 ClusterIP，只能 pod 间通信</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 还有很多种 type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ExternalName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">externalName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> someapi.somecompany.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后在 pod 中通过 <code>external-service[.default.svc.cluster.local]</code> 访问  someapi.somecompany.com</p><p>在以后如果将其指向不同的服务，只需简单地修改 externalName 属性，或者将类型重新变回 ClusterIP 并为服务创建 Endpoint</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="将服务暴露给外部">将服务暴露给外部<a href="#将服务暴露给外部" class="hash-link" aria-label="将服务暴露给外部的直接链接" title="将服务暴露给外部的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="将服务的类型设置成-nodeport">将服务的类型设置成 NodePort<a href="#将服务的类型设置成-nodeport" class="hash-link" aria-label="将服务的类型设置成 NodePort的直接链接" title="将服务的类型设置成 NodePort的直接链接">​</a></h4><p>每个集群节点都会在节点上打开一个端口(端口号相同)。并将传入的连接转发给 pod</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nodeport</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 通过 集群任意节点的 30123 端口可以访问 这个 service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 如果不指定，Kubernetes将选择一个随机端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">nodePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>worker node ip 如何获取：<code>kubectl get nodes -o jsonpath=&#x27;...&#x27;</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="将服务的类型设置成loadbalance">将服务的类型设置成LoadBalance<a href="#将服务的类型设置成loadbalance" class="hash-link" aria-label="将服务的类型设置成LoadBalance的直接链接" title="将服务的类型设置成LoadBalance的直接链接">​</a></h4><p>NodePort类型的一 种扩展, 在 client 和 worker node 间 放了一个 LoadBalancer， 防止节点单点故障</p><p>负载均衡器拥有自己独一无二的可公开访问的 IP 地址， 并将所有连接重定向到服务。可以通过负载均衡器的 IP 地址访问服务</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">me七adata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">loadbalancer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LoadBalancer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 仅将外部通信重定向到接收连接的节点上运行的pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 如果没有本地pod存在， 则连接将挂起。因此， 需要确保负载平衡器将连接转发给至少具有一个pod的节点。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 可避免额外的网络跳转。但是可能会导致跨节点的 pod 的负载分布不均衡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token key atrule" style="color:#00a4db">externalTrafficPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Local </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">portS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="创建一-个ingress资源">创建一 个Ingress资源<a href="#创建一-个ingress资源" class="hash-link" aria-label="创建一 个Ingress资源的直接链接" title="创建一 个Ingress资源的直接链接">​</a></h4><p>通过一 个IP地址公开多个服务，它运行在 HTTP 层（网络协议第7 层）上， 因此可以提供比工作在第4层的服务更多的功能</p><p>为什么需要 Ingress：每个 LoadBalancer 服务都需要自己的负载均衡器，每个 loadbalancer 都需要自己的 ip， 而 Ingress 只需要一个公网 IP 就能为许多服务提供访问</p><p>当客户端向 Ingress 发送 HTTP 请求时， Ingress 会根据请求的主机名和路径决定请求转发到的服务。</p><p>Ingress 工作在 应用层 基于 cookie 的会话亲和性 (session affinity)</p><p>已经确认集群中正在运行 Ingress 控制器， 因此现在可以创建一个 Ingress 资源：</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> extensions/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Ingress 将这个域名映射到你的 service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia . example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">http</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic"># 将请求发送到  kubia-nodeport 服务的 80 端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubia</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nodeport</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token key atrule" style="color:#00a4db">servicePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>kubectl get ingresses </code> 获取 Ingress 控制器 内网ip，配置到 dns server </p><p>为 ingress 创建 tls 认证 TODO</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="命令">命令<a href="#命令" class="hash-link" aria-label="命令的直接链接" title="命令的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="安装">安装<a href="#安装" class="hash-link" aria-label="安装的直接链接" title="安装的直接链接">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kind">kind<a href="#kind" class="hash-link" aria-label="kind的直接链接" title="kind的直接链接">​</a></h3><p><a href="https://github.com/kubernetes-sigs/kind/" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes-sigs/kind/</a></p><p>在 docker 中运行 k8s, 更快更方便</p><p><a href="https://www.cnblogs.com/laochiji/p/13813743.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/laochiji/p/13813743.html</a> 多节点</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># install golang &amp;&amp; install docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull kindest/node:v1.19.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --name: specify a name for the cluster. default name : kind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  --wait 30s: wait until the cluster reaches a ready status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --wait 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --kubeconfig: specify cluster config file; default location : ${HOME}/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind create cluster [--name kind] [--wait]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 构建镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker build -t my-custom-image:unique-tag ./my-image-dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加载到 kind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind load docker-image my-custom-image:unique-tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f my-manifest-using-my-image:unique-tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># context name 规则: &lt;kind&gt;-&lt;cluster_name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 仅仅一个 cluster 时, 可省略 context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl cluster-info [--context kind-kind]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 默认删除 kind 名字的 cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind delete cluster [--name kind]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加载 images 到 cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 默认 将 镜像加载到 kind 名字的 cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind load docker-image &lt;img_name&gt; [--name cluster_name]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 进入 kind 启动的 docker 内部, 执行 crictl images, 可以看</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 到用来模拟 k8s 的一系列镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it kind-control-plane crictl images</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="minikube">minikube<a href="#minikube" class="hash-link" aria-label="minikube的直接链接" title="minikube的直接链接">​</a></h3><p>create single node k8s cluster for dev, 原理是 创建虚拟机, </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">minikube version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">minikube start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">minikube dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 可用的扩展/插件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">minikube addons list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 开启插件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">minikube addons enable metrics-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 关闭插件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">minikube addons disable metrics-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">minikube stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">minikube delete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 当前 node ip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">minikube ip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用-kubectl">使用 kubectl<a href="#使用-kubectl" class="hash-link" aria-label="使用 kubectl的直接链接" title="使用 kubectl的直接链接">​</a></h3><p><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="基本信息">基本信息<a href="#基本信息" class="hash-link" aria-label="基本信息的直接链接" title="基本信息的直接链接">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl cluster-info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 获取kube-scheduler和kube-controller-manager组件状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get cs # 健康状况</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="创建-create-expose">创建 create expose<a href="#创建-create-expose" class="hash-link" aria-label="创建 create expose的直接链接" title="创建 create expose的直接链接">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create depend on a spec file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f xxx.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; deployment, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># dep-name 不能随便设置, 必须符合域名命名规范.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 自动创建的 ReplicaSet 名字为 dep_name + random uuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 自动创建 pod 名字为 ReplicaSet-name + random uuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 镜像地址 include the full repository url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 自动创建 label -&gt; run={dep name}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># auto  create selector -&gt; run={dep name}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create deployment &lt;dep name&gt; --image=k8s.gcr.io/echoserver:1.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create deployment tomcat6 --image=tomcat:6.0.53-jre8 # 不指定 url 前缀, 默认从 docker hub 拉取</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  pods 默认仅仅能被 同个集群的 pods, service  访问</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建临时的 代理, 可以将外部命令转发到 cluster 内部的 pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Ctrl +c 关闭</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查 版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl http://localhost:8001/version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 访问指定 pod 的服务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl http://localhost:8001/api/v1/namespaces/default/pods/$POD_NAME/proxy/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl run &lt;pod name&gt; --image=nginx --restart=Never --port=80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --generator=run/vl  表示同时创建 rc 管理 pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl run &lt;pod name&gt; --image=luksa/kubia --port=8080 --generator=run/vl </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 从描述文件创建 资源， 可以 pod， rc。。。， 可指定 ns， 默认 default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f kubia-manual.yaml [-n xxx_ns]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建 service, 名字同 deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># The LoadBalancer type makes the Service accessible through the minikube service command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Port 8080 is specified in image code, so cannot be other port here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --port : service 暴露在 cluster ip 下的端口, 通过这个端口,  可以在 cluster 内部访问到多个 pod. 通过这个 service 负载均衡了 多个 pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --targetPort 容器的端口, 默认=== port, 与制作镜像时暴露的端口一致, 不能随便指定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --type: service 类型, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       NodePort: 创建一个 service 并暴露到 cluster 外部, service 的端口还是 --port 指定, 同时 service 有自己的 cluster url, node 会指定一个随机端口映射到 service 的 端口, 若指定了 --nodePort, 就用指定端口映射到 service 端口; 如 type=NodePort，而且配置 nodePort=30001, 那么外部机器 可以 scheme://nodeIP:30001访问到该服务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       LoadBalancer: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl expose deployment &lt;dep name&gt; --type=LoadBalancer --port=8080 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查找暴露的随机端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe service mywebservice | grep NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># service port 80 will mapping to random node port ,and this service can be visited by someone outside cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 若扩容, 则在各个有 pod 运行的节点都能通过 node 端口访问  这个 service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl expose deploy tomcat6 --port=80 --target-port=8080 --type=NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建一个负载均衡服务 service 对象. 可以从外部访问 pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># rc 为 replicationController 缩写</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl expose rc &lt;po name&gt; --type=LoadBalancer --name kubia-http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; label</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 语法: kubectl label &lt;obj_type, eg: pod, service&gt; &lt;obj_name&gt; &lt;label, eg: app=v1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl label pod $POD_NAME app=v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; 命名空间 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config set-context Kubernetes --namespace=beta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 验证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config view | grep namespace command</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="执行命令到容器-exec">执行命令到容器 exec<a href="#执行命令到容器-exec" class="hash-link" aria-label="执行命令到容器 exec的直接链接" title="执行命令到容器 exec的直接链接">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 仅有 一个容器在 pod, 无需指定容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec [-c container_name] $POD_NAME env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 进入 容器内部</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec -ti $POD_NAME bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="修改">修改<a href="#修改" class="hash-link" aria-label="修改的直接链接" title="修改的直接链接">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; 扩容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指定 replicas 可以缩扩容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl scale deployments/&lt;dep_name&gt; --replicas=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl scale deployment.apps/tomcat6 --replicas=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl scale deployment tomcat6 --replicas=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; 滚动更新</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 更新 image version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl set image deployments/&lt;dep_name&gt; &lt;dep_name&gt;=jocatalin/kubernetes-bootcamp:v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 验证更新是否成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl rollout status deployments/kubernetes-bootcamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; 回滚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 取消之前的部署，这将执行反向操作，将负载移动至之前版本的容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl rollout undo deployments/kubernetes-bootcamp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="资源列表-get">资源列表 get<a href="#资源列表-get" class="hash-link" aria-label="资源列表 get的直接链接" title="资源列表 get的直接链接">​</a></h4><p>单复数均可</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 所有</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get deployments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --show-labels 同时显示所有标签。 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># -A 查看所有 pods, 包括 kube-system 命名空间 下的 pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --all-namespaces 所有空间的 pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods [--show-labels]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># -o 输出格式; wide 表示输出文本信息, 列出 ip , 节点 name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># -o yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -o wide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 通过标签过滤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -l &lt;label&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 获取 pod 完整 yaml/json 文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 缩写 po</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po &lt;pod name&gt; -o yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po &lt;pod name&gt; -o json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 根据模板获取 信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export POD_NAME=$(kubectl get pods -o go-template --template &#x27;{{range .items}}{{.metadata.name}}{{&quot;\n&quot;}}{{end}}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export NODE_PORT=$(kubectl get services/kubernetes-bootcamp -o go-template=&#x27;{{(index .spec.ports 0).nodePort}}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看 service  的 endpoint 列表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get endpoints &lt;service name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看所有 svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 缩写 svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; ReplicaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 端口转发， 将会运行一个端口转发代理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将 local port 8888 转发到 pod 的 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward &lt;pod name&gt; 8888:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 标签</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 列出 pods 的所有标签</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --show-labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 只列出感兴趣的标签， 标签按照列展示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po -L creation_method,env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 添加</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl label po &lt;pod name&gt; creation_method=manual</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 修改</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl label po &lt;pod name&gt; creation_method=manual --override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 标签选择器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po -1 creation_method=manual</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po -1 creation_method!=manual</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po -1 env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 列出没有 env 的pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po -1 &#x27;!env&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 选择带有env标签且值为prod或devel的pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po -1 env in (prod, devel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po -1 env notin (prod, devel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 使用 label 分类 worker node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl label node &lt;node name&gt; gpu=true # 每个 node 都有一个默认 label， kubernetes.io/hostname:主机名 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes -l gpu=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 命名空间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看所有 ns, 有 default， kube-public， kube-system，默认我们使用的是 default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get ns </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 列出只属于该命名空间的 pod, 可使用 -n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po --namespace kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 编辑 rc 的 yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 一般仅仅编辑 rc 的 template， 不动 label selector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 用来升级 pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl edit rc kubia</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 增加 副本数， 水平扩容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl scale rc kubia --replicas=3 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 等同 parallelism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl scale job xxx_job --replicas 3 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 远程在 pod 中某个 container 执行命令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># “--” 表示 kubectl 命令结束， 后面的是在 pod 内执行的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec &lt;pod name&gt; -- curl -s http://10.23... </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 列出环境变量，如 Service 的 ip， 端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec kubia-3inly env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 在 pod 中执行 shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec -it kubi-3inly bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; 配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config view</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; 事件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 通过 describe 也能得到 object 相关的事件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="查询详细描述-describe">查询详细描述 describe<a href="#查询详细描述-describe" class="hash-link" aria-label="查询详细描述 describe的直接链接" title="查询详细描述 describe的直接链接">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看资源描述， 附加信息， 作为 kubectl get xxx xxx 补充, 可用于排查问题</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如 pod 是否正在运行， 重启原因， 退出码 137，143 表示 pod 被迫终止</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe pods [pod_name]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe services/&lt;srv name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl describe deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="查询日志-logs">查询日志 logs<a href="#查询日志-logs" class="hash-link" aria-label="查询日志 logs的直接链接" title="查询日志 logs的直接链接">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查指定 pod 下的 container 日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 若pod 只有一个 container, 无需指定 container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs $POD_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -f POD-NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 需要 ssh 到 pod 所在的 worker node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker logs &lt;container_id&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 无需 ssh, 可指定某个 container， 可指定看重启前的版本的日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs &lt;pod name&gt; [-c container_name] [--previous]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看 k8s 资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl explain pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl explain pod.spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="删除-delete">删除 delete<a href="#删除-delete" class="hash-link" aria-label="删除 delete的直接链接" title="删除 delete的直接链接">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># delete by spec file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -f flask.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除 pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 无法直接删除, 只要 replicaSet 没有删除, 删了 po, 还会重现创建 po</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 可直接 通过删除 deployment 删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete po kubia-gpu [pod2 [pod3]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除当前 ns 下 all pod， 保留 ns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete po --all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 按照标签删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete po -1 creation_method=manual</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete service hello-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete deployment hello-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  删除 ns, 同时会删除 ns 下的所有 pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete ns custom-namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除所有资源， 包括 rc， pod， service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete all --all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除 rc， rc 管理的 pods 也会删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete rc &lt;rc name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除 rc， 但是保留 pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete rc &lt;rc name&gt; --cascade=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl dele七e rs kubia </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kubeadmin">kubeadmin<a href="#kubeadmin" class="hash-link" aria-label="kubeadmin的直接链接" title="kubeadmin的直接链接">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm init # create a master node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm join &lt;master_id:port&gt; # add a node to cluster</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="可视化界面">可视化界面<a href="#可视化界面" class="hash-link" aria-label="可视化界面的直接链接" title="可视化界面的直接链接">​</a></h2><p>kubernetes-dashboard</p><p>更推荐 kubesphere, 打通 devops 全套流水线, 对 cluster 要求高  <a href="https://github.com/kubesphere/kubesphere" target="_blank" rel="noopener noreferrer">https://github.com/kubesphere/kubesphere</a></p><p>(kuboard 也行, 对 cluster 要求不高)</p><p><a href="https://www.zhihu.com/question/348609092" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/348609092</a> rancher 和 kubesphere对比</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="vagrant-搭建-k8s-环境">vagrant 搭建 k8s 环境<a href="#vagrant-搭建-k8s-环境" class="hash-link" aria-label="vagrant 搭建 k8s 环境的直接链接" title="vagrant 搭建 k8s 环境的直接链接">​</a></h2><p>一个 master node: docker, kubeadm, kubelet, kubectl
两个 worker node: </p><p>Vagrantfile:</p><div class="language-vagrantfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vagrantfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vagrant.configure(&quot;2&quot;) do |config|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   (1..3).each do |i| </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        config.vm.define &quot;k8s-node#{i}&quot; do |node|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # 设置虚拟机的Box </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node.vm.box = &quot;centos7&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # 设置虚拟机的主机名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node.vm.hostname=&quot;k8s-node#{i}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # 设置虚拟机的IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # 192.168.56.xxx 需要在 virtualbox 先创建 host only network 192.168.56.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node.vm.network &quot;private_network&quot;, ip: &quot;192.168.56.#{99+i}/24&quot;, netmask: &quot;255.255.255.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # 设置主机与虚拟机的共享目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # node.vm.synced_folder &quot;~/Documents/vagrant/share&quot;, &quot;/home/vagrant/share&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # VirtaulBox相关配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node.vm.provider &quot;virtualbox&quot; do |v| </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # 设置虚拟机的名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                v.name = &quot;k8s-node#{i}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # 设置虚拟机的内存大小</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                v.memory = 4096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # 设置虚拟机的CPU个数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                v.cpus = 4 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            end </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   end </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>虚拟机准备</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 登录 machine sshd, 保证可以通过账号密码登录 (默认仅仅 ssh 登录)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 若使用 tmux + ssh config 则无需无需这一步, 直接通过 ssh 登录即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vagrant ssh k8s-node1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo su</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vi /etc/ssh/sshd_config # 修改 为 PasswordAuthentication yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service sshd restart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 设置默认网卡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># show default SoftEther</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># We can find that the default soft ether is eth0, the three machine have the same eth0 ip.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># This is because eth0 default to 网络地址转发(nat) 类型. in order  to make the machines can </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># access to each other, etho should be type: Natnetwork</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip route show</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 操作 virtualbox 图形界面, 全局新建 natnetwork 网络. 为每个 machine 默认网卡1 即 eth0 指定 这个类型, 刷新高级设置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 里的 网卡mac 地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 然后在各个 machine 内 互相 ping 是否通</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># close firewall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop firewalld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl disable firewalld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># disable selinux (永久)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &#x27;s/enforcing/disabled/&#x27; /etc/selinux/config # 替换了 enforcing 为 disable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 当前会话关闭 selinux (临时)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setenforce 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 关闭 swap 永久</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab # 其实就是注释掉一行   #/swapfile none swap defaults 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 关闭 swap (内存交换) 临时</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">swapoff -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 添加 主机名 and ip 映射</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># hostname 会显示 主机名 k8s-node1/2/3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 若 hostname 显示不正常可以修改: hostnamectl set-hostname &lt;new hostname&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vi /etc/hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># eth0 网卡就是 默认网卡, 用来machine 互联的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &lt;node1 eth0 ip&gt; k8s-node1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &lt;node2 eth0 ip&gt; k8s-node2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &lt;node3 eth0 ip&gt; k8s-node3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.2.15 k8s-node1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.2.4 k8s-node2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.2.5 k8s-node3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将桥接的 ipv4 的流量传递到 iptables 的链</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net.bridge.bridge-nf-call-ip6tables = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net.bridge.bridge-nf-call-iptables = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 验证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sysctl --system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 同步三台机器的时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum install ntpdate -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ntpdate time.windows.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将只读文件系统 改为 读写</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mount -o remount rw /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>安装 docker 等</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># docker参照官网即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装 k8s 需要 aliyun 镜像 推荐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[kubernetes]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name=Kubernetes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enabled=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpgcheck=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">repo_gpgcheck=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ustc 的镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt; /etc/apt/sources.list.d/kubernetes.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># centos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl enable kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &gt;&gt;&gt; 在 master node 上</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 需要拉去 k8s 相关的镜像, 默认仓库 k8s.gcr.io 背墙, 这里重新指定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># service-cidr 是 service 间通信的网段/子网</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># pod network-cidr 是 pod 间通信网段/子网</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm init --apiserver-advertise-address=&lt;master node eth0 ip&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--image-repository registry.cn-hangzhou.aliyuncs.com/google_containers \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--kubernetes-version v1.19.4 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--service-cidr=10.96.0.0/16 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--pod-network-cidr=10.244.0.0/16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 按照 输出提示, 如下步骤需要做:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p $HOME/.kube</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># master 生成的 命令, 在 worker node 执行即可加入 cluster.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2h 内有效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm join 10.0.2.15:6443 --token 0tpws3.y1uhbzg0rgal4okz \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --discovery-token-ca-cert-hash sha256:0a25a082e0babbc18d1646ebfa9954d82838fa86ec66ee3d88c0d57fc9c0f35e </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 过期之后, 如下生成永久的 token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm token create --print-join-command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm token create --ttl 0 --print-join-command # 复制生成的 token 到上面命令即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建网络</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 这里选定 flannel 提供的网络扩展插件 (addons)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 具体有哪些可用的插件: https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -L https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml -o flannel_network.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 上传到 master node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp ~/flanel.yml root@xxx/root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 子节点加入到 cluster 后, master 会同步 flanel 相关的 pod 到 子节点上, 可以监控, 等待一段时间再查看 nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f flannel.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看 flanel 相关 的 pods 是否启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po --all-namespaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果是 失败的, 那么小替换 flanel.yml 中 image 相关地址, 到 docker hub 上找, 如 https://hub.docker.com/r/easzlab/flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除 , 重新创建</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -f flannel.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 此时可以在子节点上执行添加 node 命令了   &gt;&gt;&gt; 在 worker node 上</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 监控 所有节点上的 指定ns 的 pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 等待 所有节点 上 flanel 相关的 pod 都正常启动后再在 master 上查看 nodes 状态, 保证所有 node 状态为 ready 则 cluster 搭建成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">watch kubectl get po -n kube-system -o wide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装 ingress controller, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 有多重实现, 选择一种即可 https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 这里选择 ingress-nginx https://kubernetes.io/docs/concepts/services-networking/ingress/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ref: https://www.cnblogs.com/minseo/p/12455320.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cka-证书">cka 证书<a href="#cka-证书" class="hash-link" aria-label="cka 证书的直接链接" title="cka 证书的直接链接">​</a></h2><p><a href="https://training.linuxfoundation.cn/certificate/details/1" target="_blank" rel="noopener noreferrer">https://training.linuxfoundation.cn/certificate/details/1</a> 中国区</p><p><a href="https://zhuanlan.zhihu.com/p/138796893" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/138796893</a>
<a href="https://www.jianshu.com/p/629525af31c4" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/629525af31c4</a>
<a href="https://www.kubernetes.org.cn/peixun" target="_blank" rel="noopener noreferrer">https://www.kubernetes.org.cn/peixun</a> 考试要点
<a href="https://zhuanlan.zhihu.com/p/138796893" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/138796893</a> , <a href="https://www.zhihu.com/zvideo/1302356091591372800" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/zvideo/1302356091591372800</a> 真题</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="k3s">k3s<a href="#k3s" class="hash-link" aria-label="k3s的直接链接" title="k3s的直接链接">​</a></h2><p><a href="https://github.com/k3s-io/k3s" target="_blank" rel="noopener noreferrer">https://github.com/k3s-io/k3s</a></p><p><a href="https://oldj.net/article/2022/04/17/install-k3s-and-rancher/" target="_blank" rel="noopener noreferrer">https://oldj.net/article/2022/04/17/install-k3s-and-rancher/</a></p><p>轻量级的 k8s, 内核机制还是和 K8s 一样，但是剔除了很多外部依赖以及 K8s 的 alpha、beta 特性</p><p>将其应用于 IoT 设备（比如树莓派）</p><p><a href="https://rancher.com/docs/k3s/latest/en/" target="_blank" rel="noopener noreferrer">https://rancher.com/docs/k3s/latest/en/</a> 官网</p><p><a href="https://www.rancher.cn/k3s/" target="_blank" rel="noopener noreferrer">https://www.rancher.cn/k3s/</a> 中文官网</p><p><a href="https://zhuanlan.zhihu.com/p/269556628" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/269556628</a> 简介</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="k0s">k0s<a href="#k0s" class="hash-link" aria-label="k0s的直接链接" title="k0s的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rancher">rancher<a href="#rancher" class="hash-link" aria-label="rancher的直接链接" title="rancher的直接链接">​</a></h2><p>部署 k8s 集群 </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="harbor">Harbor<a href="#harbor" class="hash-link" aria-label="Harbor的直接链接" title="Harbor的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="helm-chart">helm chart<a href="#helm-chart" class="hash-link" aria-label="helm chart的直接链接" title="helm chart的直接链接">​</a></h2><p>使用 helm chart 一键拉起整套环境, 可以使用 helm chart 应用商店</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/k-8-s">k8s</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/xiaoyureed/xiaoyureed.github.io/tree/main/docs/kubernetes-k8s.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/kotlin"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">kotlin</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/linux-note"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">鸟哥的 Linux 私房菜阅读笔记</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#面试问题" class="table-of-contents__link toc-highlight">面试问题</a></li><li><a href="#what-and-why" class="table-of-contents__link toc-highlight">what and why</a><ul><li><a href="#k8s-是做什么的" class="table-of-contents__link toc-highlight">k8s 是做什么的</a></li><li><a href="#为什么使用" class="table-of-contents__link toc-highlight">为什么使用:</a></li></ul></li><li><a href="#集群结构" class="table-of-contents__link toc-highlight">集群结构</a><ul><li><a href="#一个-master-节点" class="table-of-contents__link toc-highlight">一个 master 节点</a></li><li><a href="#一群worker节点" class="table-of-contents__link toc-highlight">一群worker节点</a></li></ul></li><li><a href="#逻辑结构" class="table-of-contents__link toc-highlight">逻辑结构</a><ul><li><a href="#pod" class="table-of-contents__link toc-highlight">pod</a></li><li><a href="#volume" class="table-of-contents__link toc-highlight">volume</a></li><li><a href="#controllers" class="table-of-contents__link toc-highlight">controllers</a></li><li><a href="#service" class="table-of-contents__link toc-highlight">service</a></li><li><a href="#flannel" class="table-of-contents__link toc-highlight">flannel</a></li><li><a href="#ingress" class="table-of-contents__link toc-highlight">ingress</a></li><li><a href="#name-namespace" class="table-of-contents__link toc-highlight">name namespace</a></li></ul></li><li><a href="#资源描述文件" class="table-of-contents__link toc-highlight">资源描述文件</a><ul><li><a href="#通过命令生成-yml" class="table-of-contents__link toc-highlight">通过命令生成 yml</a></li><li><a href="#pod-的--yaml-描述文件" class="table-of-contents__link toc-highlight">pod 的  yaml 描述文件</a></li><li><a href="#deployment-的描述文件" class="table-of-contents__link toc-highlight">deployment 的描述文件</a></li><li><a href="#service-1" class="table-of-contents__link toc-highlight">service</a></li></ul></li><li><a href="#标签" class="table-of-contents__link toc-highlight">标签</a></li><li><a href="#注解" class="table-of-contents__link toc-highlight">注解</a></li><li><a href="#命名空间" class="table-of-contents__link toc-highlight">命名空间</a></li><li><a href="#pod-管理" class="table-of-contents__link toc-highlight">pod 管理</a><ul><li><a href="#探测-pod-是否健康" class="table-of-contents__link toc-highlight">探测 pod 是否健康</a></li><li><a href="#pod-副本" class="table-of-contents__link toc-highlight">pod 副本</a></li><li><a href="#运行单个任务-job" class="table-of-contents__link toc-highlight">运行单个任务 Job</a></li><li><a href="#定时任务-cronjob" class="table-of-contents__link toc-highlight">定时任务 CronJob</a></li></ul></li><li><a href="#pod-通信" class="table-of-contents__link toc-highlight">pod 通信</a><ul><li><a href="#proxy" class="table-of-contents__link toc-highlight">proxy</a></li><li><a href="#service-2" class="table-of-contents__link toc-highlight">Service</a></li><li><a href="#pod-间通信" class="table-of-contents__link toc-highlight">pod 间通信</a></li><li><a href="#通过-service-连接外部服务" class="table-of-contents__link toc-highlight">通过 Service 连接外部服务</a><ul><li><a href="#通过手动生成-endpoint" class="table-of-contents__link toc-highlight">通过手动生成 endpoint</a></li><li><a href="#通过-externalname-类型的-service" class="table-of-contents__link toc-highlight">通过 externalName 类型的 Service</a></li></ul></li><li><a href="#将服务暴露给外部" class="table-of-contents__link toc-highlight">将服务暴露给外部</a><ul><li><a href="#将服务的类型设置成-nodeport" class="table-of-contents__link toc-highlight">将服务的类型设置成 NodePort</a></li><li><a href="#将服务的类型设置成loadbalance" class="table-of-contents__link toc-highlight">将服务的类型设置成LoadBalance</a></li><li><a href="#创建一-个ingress资源" class="table-of-contents__link toc-highlight">创建一 个Ingress资源</a></li></ul></li></ul></li><li><a href="#命令" class="table-of-contents__link toc-highlight">命令</a><ul><li><a href="#安装" class="table-of-contents__link toc-highlight">安装</a></li><li><a href="#kind" class="table-of-contents__link toc-highlight">kind</a></li><li><a href="#minikube" class="table-of-contents__link toc-highlight">minikube</a></li><li><a href="#使用-kubectl" class="table-of-contents__link toc-highlight">使用 kubectl</a><ul><li><a href="#基本信息" class="table-of-contents__link toc-highlight">基本信息</a></li><li><a href="#创建-create-expose" class="table-of-contents__link toc-highlight">创建 create expose</a></li><li><a href="#执行命令到容器-exec" class="table-of-contents__link toc-highlight">执行命令到容器 exec</a></li><li><a href="#修改" class="table-of-contents__link toc-highlight">修改</a></li><li><a href="#资源列表-get" class="table-of-contents__link toc-highlight">资源列表 get</a></li><li><a href="#查询详细描述-describe" class="table-of-contents__link toc-highlight">查询详细描述 describe</a></li><li><a href="#查询日志-logs" class="table-of-contents__link toc-highlight">查询日志 logs</a></li><li><a href="#删除-delete" class="table-of-contents__link toc-highlight">删除 delete</a></li></ul></li><li><a href="#kubeadmin" class="table-of-contents__link toc-highlight">kubeadmin</a></li></ul></li><li><a href="#可视化界面" class="table-of-contents__link toc-highlight">可视化界面</a></li><li><a href="#vagrant-搭建-k8s-环境" class="table-of-contents__link toc-highlight">vagrant 搭建 k8s 环境</a></li><li><a href="#cka-证书" class="table-of-contents__link toc-highlight">cka 证书</a></li><li><a href="#k3s" class="table-of-contents__link toc-highlight">k3s</a></li><li><a href="#k0s" class="table-of-contents__link toc-highlight">k0s</a></li><li><a href="#rancher" class="table-of-contents__link toc-highlight">rancher</a></li><li><a href="#harbor" class="table-of-contents__link toc-highlight">Harbor</a></li><li><a href="#helm-chart" class="table-of-contents__link toc-highlight">helm chart</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.6d396791.js"></script>
<script src="/assets/js/main.f6c8ad5f.js"></script>
</body>
</html>