<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-redis-note">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Redis🌈 - Xiaoyureed 的网络 Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xiaoyureed.github.io/img/logo.webp"><meta data-rh="true" name="twitter:image" content="https://xiaoyureed.github.io/img/logo.webp"><meta data-rh="true" property="og:url" content="https://xiaoyureed.github.io/docs/redis-note"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="keywords" content="xiaoyureed"><meta data-rh="true" name="keywords" content="blog, java, spring, microservice, python, rust, typescript, react, web"><meta data-rh="true" name="keywords" content=" 半路转行的编程爱好者, 写过 Python, Rust, 现在主攻 Java 分布式系统"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Redis🌈 - Xiaoyureed 的网络 Wiki"><meta data-rh="true" name="description" content="reference: redis基础, redis集群原理及搭建与使用"><meta data-rh="true" property="og:description" content="reference: redis基础, redis集群原理及搭建与使用"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xiaoyureed.github.io/docs/redis-note"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/en/docs/redis-note" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/redis-note" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/redis-note" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://5SAMPKXTP9-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Xiaoyureed 的网络 Wiki" href="/opensearch.xml">


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f6da56a47f5085d1e0fedae39b8de00a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="xiaoyureed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="xiaoyureed Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="xiaoyureed JSON Feed">

<link rel="icon" href="/img/logo.webp">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)">
<meta name="description" content="Xiaoyureed 的个人博客"><link rel="stylesheet" href="/assets/css/styles.261d8673.css">
<link rel="preload" href="/assets/js/runtime~main.f9c95488.js" as="script">
<link rel="preload" href="/assets/js/main.2a982140.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><a href="/docs/rust-note" target="_blank">Rust 指北, 欢迎查看...</a></div><button type="button" aria-label="关闭" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">菜单</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/archive">博客</a></li><li><a class="dropdown__link" href="/docs/intro">教程</a></li><li><a class="dropdown__link" href="/resource">导航</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--dark_i4oU"><b></b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/SpringBoot-note">Spring Boot 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/autohotkey">Autohotkey 脚本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/blockchain">blockchain区块链</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/c-sharp-and-dot-net">C# &amp; .NET</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/chatgpt">Chatgpt Usage Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cpp">CPP and C 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cross-gfw">Cross The GFW</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cs-note">Computer Science Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/css-pre-processor">几种CSS预处理器比较选型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/data-structure-and-algorithm">Data Structure and Algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/design-pattern-note">Design Pattern 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-resources">开发者资源</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/distributed-system">Distributed System 分布式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docker-note-virtual-dev-env">Docker Note &amp; Other Virtual Develop Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/effective-java-reading-note">Effective Java 阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/elk-elastic-log">Distributed log collection分布式日志收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/english-note">英语学习🔥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extjs-note">Extjs 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/git-note">Git 备忘 🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/golang-note">Golang 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gps-gis-tracing">基于地理位置开发技术</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gradle">Gradle note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/greasy-monkey">油猴插件&amp;编写脚本🐒</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/groovy-note">groovy note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/health">Health 关爱程序员健康🏥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/how-to-test-java-app">How to Test Java App</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/interview-system-design">系统设计 System design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/iot">Iot 物联网</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-code-clean">Java Clean Code Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-concurrent">Java Concurrent🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-memory-model-jmm-jvm">JMM and GC🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-note">Java Core 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/js-tutorial">JavaScript tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/kotlin">kotlin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/kubernetes-k8s">kubernetes-k8s ☁️</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux-note">鸟哥的 Linux 私房菜阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/low-code-platform">关于低代码平台的调研</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mac">Mac 开发环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/machine-learning-ml">machine-learning-ml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/marketing-seo">Marketing SEO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/maven-note">Maven Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/message-queue">Message Queue🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/money">Investment Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mongodb-note">MongoDB Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/monitor-system-grafana-prometheus-influxdb-hbase-time-serials-database">monitor-system-grafana-prometheus监控🖥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mvc-mvvm">MVC to MVVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mybatis-note">MyBatis Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/netty-note">netty</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nlp-natural-language-processing">nlp-natural-language-processing👄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nodejs-yarn-npm">Nodejs, Yarn, Npm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/oracle">Oracle 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-audio-video">Audio and Video development Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-big-data-introduce">大数据开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-cache">Cache 缓存🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-computational-ad">计算广告 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-crawler-spider">网络爬虫 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-db-design-note">关系型数据库表设计🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-desktop-develop">桌面应用开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-http-restful">HTTP protocol Intro &amp; RESTful</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-reactive-programming">响应式编程 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-rpc">RPC Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-rule-engine-note">规则引擎 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/php-note">PHP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/postgres-note">Postgres note🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/process-workflow-bpm-engine">工作流引擎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/protect-your-app-authentication-oauth2-jwt-https">Protect Your App 安全保护认证鉴权🔑</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/psychology">psychology</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/python-note">Python🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quant-money">量化交易</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quarkus">Quarkus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/react-note">React🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/real-time-communication-protocol">实时通信 Real-time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/redis-note">Redis🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/regex">Regular Expression 正则🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/rust-note">Rust 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/scala-akka-play-framework">Scala 语言</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/serverless">Serverless</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/service-mesh">service mesh 服务网格</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/servlet">Servlet Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/shell-bash-note">shell-bash脚本收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/spring-note">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springcloud-note">Spring Cloud 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springmvc-note">Spring MVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/task-schedule-note">Task Schedule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tcp-ip-note-p2p">TCP IP, p2p</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tomcat-jetty-nginx">Tomcat Jetty Nginx 等 web 容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/vertx">Vertx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/video-creator">拍摄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/vue">Vue Brief Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webassembly">webassembly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webpack-esbuild-vite-rollup">前端打包构建工具</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Redis🌈</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Redis🌈</h1></header><div align="center">reference: [redis基础](https://juejin.im/post/5ad6e4066fb9a028d82c4b66), [redis集群原理及搭建与使用](https://juejin.im/post/5ad54d76f265da23970759d3) 《redis开发和运维》</div><ul><li><a href="#1-redis%E4%BB%8B%E7%BB%8D">1. redis介绍</a><ul><li><a href="#11-redis-%E7%89%B9%E6%80%A7">1.1. redis 特性</a></li><li><a href="#12-install">1.2. install</a></li><li><a href="#13-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">1.3. 使用场景</a></li></ul></li><li><a href="#2-redis%E5%91%BD%E4%BB%A4">2. redis命令</a><ul><li><a href="#21-%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4">2.1. 系统管理命令</a></li><li><a href="#22-%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4">2.2. 数据操作命令</a></li><li><a href="#23-%E9%94%AE%E7%AE%A1%E7%90%86">2.3. 键管理</a></li></ul></li><li><a href="#3-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">3. 数据类型</a><ul><li><a href="#31-streaming-%E7%B1%BB%E5%9E%8B">3.1. streaming 类型</a></li><li><a href="#32-string-%E5%AD%97%E7%AC%A6%E4%B8%B2">3.2. String-字符串</a></li><li><a href="#33-list-%E5%88%97%E8%A1%A8">3.3. List-列表</a></li><li><a href="#34-set-%E9%9B%86%E5%90%88">3.4. Set-集合</a></li><li><a href="#35-hash-%E5%93%88%E5%B8%8C">3.5. Hash-哈希</a></li><li><a href="#36-zset-%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88">3.6. ZSet-有序集合</a></li></ul></li><li><a href="#4-lua%E8%84%9A%E6%9C%AC">4. lua脚本</a></li><li><a href="#5-%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%9E%B6%E6%9E%84-lua%E5%AE%9E%E7%8E%B0%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C">5. 单线程架构 lua实现原子操作</a></li><li><a href="#6-%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E6%9C%BA%E5%88%B6">6. 内存淘汰机制</a><ul><li><a href="#61-%E4%B8%89%E9%81%93%E4%BF%9D%E9%99%A9%E4%BF%9D%E8%AF%81-key-%E8%BF%87%E6%9C%9F%E5%A4%84%E7%90%86">6.1. 三道保险保证 key 过期处理</a></li><li><a href="#62-%E6%9C%89%E5%93%AA%E4%BA%9B%E6%B7%98%E6%B1%B0%E6%9C%BA%E5%88%B6">6.2. 有哪些淘汰机制</a></li><li><a href="#63-%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95">6.3. 内存回收算法</a></li><li><a href="#64-%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5">6.4. 如何配置淘汰策略</a><ul><li><a href="#641-%E9%80%9A%E8%BF%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">6.4.1. 通过配置文件</a></li><li><a href="#642-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%BF%90%E8%A1%8C%E6%97%B6%E4%BF%AE%E6%94%B9">6.4.2. 通过命令运行时修改</a></li></ul></li></ul></li><li><a href="#7-%E6%8C%81%E4%B9%85%E5%8C%96">7. 持久化</a><ul><li><a href="#71-%E5%A4%87%E4%BB%BD%E9%80%89%E5%9E%8B">7.1. 备份选型</a></li><li><a href="#72-rdb-%E5%BF%AB%E7%85%A7%E6%8C%81%E4%B9%85%E5%8C%96">7.2. RDB-快照持久化</a><ul><li><a href="#721-rdb%E6%8C%81%E4%B9%85%E5%8C%96%E6%A6%82%E5%BF%B5">7.2.1. RDB持久化概念</a></li><li><a href="#722-%E8%A7%A6%E5%8F%91%E6%9C%BA%E5%88%B6-%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AF">7.2.2. 触发机制-如何开启</a></li><li><a href="#723-rdb%E6%96%87%E4%BB%B6">7.2.3. RDB文件</a></li></ul></li><li><a href="#73-aof-%E6%97%A5%E5%BF%97%E6%8C%81%E4%B9%85%E5%8C%96">7.3. AOF-日志持久化</a><ul><li><a href="#731-aof%E6%A6%82%E5%BF%B5">7.3.1. aof概念</a></li><li><a href="#732-%E5%86%99%E5%85%A5%E5%8E%9F%E7%90%86">7.3.2. 写入原理</a></li><li><a href="#733-%E6%96%87%E4%BB%B6%E5%90%8C%E6%AD%A5">7.3.3. 文件同步</a></li><li><a href="#734-%E9%87%8D%E5%86%99%E6%9C%BA%E5%88%B6">7.3.4. 重写机制</a></li><li><a href="#735-aof-%E6%8D%9F%E5%9D%8F">7.3.5. aof 损坏</a></li></ul></li></ul></li><li><a href="#8-%E5%8F%91%E5%B8%83%E4%B8%8E%E8%AE%A2%E9%98%85">8. 发布与订阅</a></li><li><a href="#9-%E4%BA%8B%E5%8A%A1">9. 事务</a></li><li><a href="#10-%E4%BA%8B%E4%BB%B6">10. 事件</a><ul><li><a href="#101-%E6%96%87%E4%BB%B6%E4%BA%8B%E4%BB%B6">10.1. 文件事件</a></li><li><a href="#102-%E6%97%B6%E9%97%B4%E4%BA%8B%E4%BB%B6">10.2. 时间事件</a></li><li><a href="#103-%E4%BA%8B%E4%BB%B6%E7%9A%84%E8%B0%83%E5%BA%A6%E6%89%A7%E8%A1%8C">10.3. 事件的调度&amp;执行</a></li></ul></li><li><a href="#11-redis%E9%9B%86%E7%BE%A4">11. redis集群</a><ul><li><a href="#111-%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B">11.1. 连接过程</a></li><li><a href="#112-%E4%B8%BB%E4%BB%8E%E9%93%BE">11.2. 主从链</a></li></ul></li><li><a href="#12-%E5%93%A8%E5%85%B5-sentinel">12. 哨兵 Sentinel</a></li><li><a href="#13-%E5%88%86%E7%89%87">13. 分片</a></li><li><a href="#14-%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%AE%BA%E5%9D%9B%E7%B3%BB%E7%BB%9F">14. 一个简单的论坛系统</a><ul><li><a href="#141-%E6%96%87%E7%AB%A0%E4%BF%A1%E6%81%AF">14.1. 文章信息</a></li><li><a href="#142-%E7%82%B9%E8%B5%9E%E5%8A%9F%E8%83%BD">14.2. 点赞功能</a></li><li><a href="#143-%E5%AF%B9%E6%96%87%E7%AB%A0%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F">14.3. 对文章进行排序</a></li></ul></li><li><a href="#15-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C">15. 一致性哈希</a></li><li><a href="#16-%E6%95%B4%E5%90%88-spring-boot2">16. 整合 spring boot2</a><ul><li><a href="#161-jedis">16.1. jedis</a></li><li><a href="#162-lettuce">16.2. lettuce</a></li><li><a href="#163-%E5%AE%9A%E4%B9%89%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8">16.3. 定义序列化器</a></li></ul></li><li><a href="#17-%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98">17. 面试问题</a></li><li><a href="#18-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">18. 分布式锁</a><ul><li><a href="#181-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">18.1. 实现原理</a><ul><li><a href="#1811-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E9%9C%80%E8%A6%81%E6%BB%A1%E8%B6%B3%E7%9A%84%E8%A6%81%E6%B1%82">18.1.1. 分布式锁需要满足的要求</a></li><li><a href="#1812-%E5%8A%A0%E9%94%81%E6%9C%BA%E5%88%B6">18.1.2. 加锁机制</a></li><li><a href="#1813-watch-dog-%E8%87%AA%E5%8A%A8%E5%BB%B6%E6%97%B6%E6%9C%BA%E5%88%B6">18.1.3. watch dog 自动延时机制</a></li><li><a href="#1814-redisson-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81">18.1.4. redisson 如何实现可重入锁</a></li></ul></li><li><a href="#182-redis-%E5%AE%9E%E7%8E%B0-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">18.2. redis 实现 分布式锁</a></li><li><a href="#183-redisson-%E5%AE%9E%E7%8E%B0">18.3. redisson 实现</a></li></ul></li></ul><h1>redis介绍</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis-特性">redis 特性<a href="#redis-特性" class="hash-link" aria-label="redis 特性的直接链接" title="redis 特性的直接链接">​</a></h2><p>全称: remote dictionary server</p><ul><li><p>速度快</p><ul><li>因为是在内存中运行</li><li>c 实现</li><li>单线程架构, 没有资源竞争. - 存储的键很多的redis, 不要执行 <code>keys*</code> 操作</li></ul></li><li><p>基本数据结构是键值对, 但是 值可以支持多种数据类型</p><ul><li>string, 在 string 基础上演变出 bitmaps(位图), HyperLogLog</li><li>hash</li><li>集合</li><li>有序集合</li><li>列表</li></ul></li><li><p>提供多种功能</p><ul><li>键可以设置过期时间 - 可以用来实现缓存</li><li>发布订阅功能 - 可以实现消息队列</li><li>支持 lua 脚本 - 可以利用 lua 创建新的 redis 命令</li><li>简单的事务支持</li><li>提供了 pipeline (流水线) 功能 - 这样客户端能够将一批命令一次性传到 redis, 减少了网络开销</li></ul></li><li><p>持久化支持</p><ul><li>RDB</li><li>AOF</li></ul></li><li><p>主从复制 - 是分布式 redis 的基础</p></li><li><p>高可用and分布式</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="install">install<a href="#install" class="hash-link" aria-label="install的直接链接" title="install的直接链接">​</a></h2><p>Windows</p><p>cmd启动server端: <code>redis-server.exe redis.windows.conf </code>, redis.windows.conf不是必须, 如果省略则使用默认配置</p><p>cmd启动client端: <code>redis-cli.exe -h 127.0.0.1 -p 6379 </code>, 然后即可在这个端口进行后续操作.</p><p>ubuntu下卸载</p><p>rm -rf var/lib/redis/</p><p>rm -rf /var/log/redis</p><p>rm -rf /etc/redis/</p><p>rm -rf /usr/bin/redis-*</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">apt-get remove redis # 删除</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt-get remove --purge redis # 同时删除配置文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">find / -name redis # 找到残余文件 删除之</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ubuntu下安装</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$sudo apt-get update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$sudo apt-get install redis-server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ redis-server # 启动server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ redis-cli # 启动client(redis 127.0.0.1:6379)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 检测redis server是否启动</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">127.0.0.1:6379&gt; ping</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PONG</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过源码安装</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">wget http://download.redis.io/releases/redis-5.0.2.tar.gz # 下载 redis </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tar -zxv -f xxx.tar.gz # 解压</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ln -s redis-x.x.x &lt;link_name&gt; # 建立快捷软链接 # 最佳实践， 利于未来版本升级</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cd redis</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">make # 编译</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">make install # 安装 # 安装到了 /usr/local/bin, 这样就可以在任何目录下使用redis 命令了</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用场景">使用场景<a href="#使用场景" class="hash-link" aria-label="使用场景的直接链接" title="使用场景的直接链接">​</a></h2><ul><li><p>计数器</p><ul><li>可以对 String 进行自增自减运算，从而实现计数器功能</li><li>例如对于网站访问量，如果使用 MySQL 数据库进行存储，那么每访问一次网站就要对磁盘进行读写操作。而对 Redis 这种内存型数据库的读写性能非常高，很适合存储这种频繁读写的计数量。</li></ul></li><li><p>缓存</p><p>将热点数据放到内存中，设置内存的最大使用量以及淘汰策略来保证缓存的命中率。</p></li><li><p>分布式 session</p><p>在分布式场景下具有多个应用服务器，可以使用 Redis 来统一存储这些应用服务器的会话信息，使得某个应用服务器宕机时不会丢失会话信息，从而保证高可用。</p></li><li><p>分布式锁实现:  SETNX 命令, 还可以使用官方提供的 RedLock 分布式锁实现</p><p>在分布式场景下，无法使用单机环境下的锁实现。当多个节点上的进程都需要获取同一个锁时，就需要使用分布式锁来进行同步。</p><p>setnx key value，当key不存在时，将 key 的值设为 value ，返回1。若给定的 key 已经存在，则setnx不做任何动作，返回0。当setnx返回1时，表示获取锁，做完操作以后del key，表示释放锁，如果setnx返回0表示获取锁失败</p></li><li><p>分布式id生成</p><p>因为 redis 单线程的排他性, 保证的生成id 的唯一, 每次先+1再获取</p><p>改进: 每次先+1000再获取, 拿到本地后, 0~1000 慢慢用, 用完了再获取 1001~2000, 一个用户服务宕机了，也顶多一小段userId没有用到</p></li><li><p>消息队列</p><p>List 是一个双向链表，可以通过 lpop 和 lpush 写入和读取消息。</p><p>不过不规建使用, 最好使用 Kafka、RabbitMQ 等消息中间件。专业的人做专业的事</p></li><li><p>feed 流</p><p>使用的是 list 类型(有序性)</p></li><li><p>点赞/like功能</p><p>利用 zet 的去重</p></li><li><p>共同好友/共同关注</p><p>Set 可以实现交集、并集等操作</p></li><li><p>排行榜</p><p>ZSet 可以实现更具score 排名, 而且天然去重</p></li></ul><h1>redis命令</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="系统管理命令">系统管理命令<a href="#系统管理命令" class="hash-link" aria-label="系统管理命令的直接链接" title="系统管理命令的直接链接">​</a></h2><p>位于 <code>/usr/local/bin</code></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">#         启动</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">redis-server # 默认方式启动</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">redis-server --port 6379 [...] # 指定配置项启动</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">redis-server &lt;path_to_redis.conf&gt; # 指定配置文件启动， 一般存到 /opt/redis/redis.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#         连接 停止</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">redis-cli -h &lt;host&gt; -p &lt;port&gt; # 默认 127.0.0.1：6379</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">redis-cli shutdown [nosave|save] # 关闭， 是否持久化</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>配置文件类似如下：</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">bind 127.0.0.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">port 6379</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">logfile xxx # 日志文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dir xxx # redis 工作目录， 存放持久化文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">daemonize xxx # 是否以守护进程方式启动</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据操作命令">数据操作命令<a href="#数据操作命令" class="hash-link" aria-label="数据操作命令的直接链接" title="数据操作命令的直接链接">​</a></h2><p>命令查询: <a href="http://redisdoc.com" target="_blank" rel="noopener noreferrer">http://redisdoc.com</a></p><p>记忆方式: <a href="https://my.oschina.net/u/3025423/blog/793649" target="_blank" rel="noopener noreferrer">https://my.oschina.net/u/3025423/blog/793649</a></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">#        全局</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">keys * # 所有键， 耗时</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dbsize # 键总数， 不耗时</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">exist &lt;key&gt; # 是否存在</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">del key [key ...] # 删除</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">expire &lt;key&gt; &lt;seconds&gt; # 键过期删除</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ttl &lt;key&gt; # 剩余过期时间， 0， -1， -2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">type &lt;key&gt; # 值的类型</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">//删除当前数据库中的所有Key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">flushdb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">//删除所有数据库中的key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">flushall</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="键管理">键管理<a href="#键管理" class="hash-link" aria-label="键管理的直接链接" title="键管理的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 键重命名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># rename key newKey 键重命名, 如果 newkey 已经存在, 会被覆盖</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 为了防止被覆盖, renamenx 命令 : 表示如果 newKey 不存在才可rename 成功</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 随机挑选一个 键 randomkey</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 键的过期时间</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 对于散列表这种容器，只能为整个键设置过期时间（整个散列表），而不能为键里面的单个元素设置过期时间。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 通过 set 在初始化时设置过期时间 or 通过 setex</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set key value [ex seconds] [px milliseconds] [nx|xx]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># expire key seconds 秒级别过期; key 不存在, 返回0; 设置过期为负值, 等同于 del (立即删除)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># expireat key timestamp 秒级别时间戳后过期</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># pexpire key milliseconds 毫秒级别过期</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># pexpireat key milliseconds-timestamp 毫秒时间戳 ----- 最终底层都是调用这个命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ttl key 观察剩余时间; pttl 更精确(毫秒级别)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># persist key 取消过期时间</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 键的迁移 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 将部分数据从一个redis迁移到另一个 redis</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 方法有三: move; dump+restore; migrate</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># `move key db` </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># `dump key`在源redis上将数据序列化成 RDB格式 + `restore key ttl value`在目标redis上将数据复原, ttl 表示过期时间, tto=0表示没有过期时间</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># migrate host port key|&quot;&quot; target-db timeout [copy] [replace] [key key...]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 遍历键</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># `keys pattern` 支持glob通配符 - 耗时</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 渐进式遍历 `scan cursor [match pattern] [count number]` </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 多数据库管理</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># `select dbIndex` 切换数据库, 从0开始</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># flushdb/flushall 清除/清除全部</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>数据类型</h1><p><a href="https://www.cnblogs.com/javazhiyin/p/11063944.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/javazhiyin/p/11063944.html</a></p><p>键的类型只能为字符串，值支持的 <code>五种数据类型</code>为：字符串(string)、列表(list)、集合(set)、有序集合(zset)、散列表(hash)。</p><p>每种数据类型在redis 内部有自己的编码实现, 内部的编码实现有改进不会对外部有什么影响, 多种内部编码实现可以对应不同应用场景</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="streaming-类型">streaming 类型<a href="#streaming-类型" class="hash-link" aria-label="streaming 类型的直接链接" title="streaming 类型的直接链接">​</a></h2><p><a href="https://lolico.me/2020/06/28/Using-stream-to-implement-message-queue-in-springboot/" target="_blank" rel="noopener noreferrer">https://lolico.me/2020/06/28/Using-stream-to-implement-message-queue-in-springboot/</a>
TODO</p><p>Redis5新增了一个Stream的数据类型，这个类型作为消息队列来使用时弥补了List和Pub/Sub的不足并且提供了更强大的功能，比如ack机制以及消费者组等概念</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="string-字符串">String-字符串<a href="#string-字符串" class="hash-link" aria-label="String-字符串的直接链接" title="String-字符串的直接链接">​</a></h2><p>String数据结构是简单的key-value类型，value其实不仅可以是String，也可以是数字。 常规key-value缓存应用； 常规计数：微博数，粉丝数等。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 常用命令: set,get,decr,incr,mget 等</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## 设置值 , 过期时间</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## `set key value [ex seconds] [px milliseconds] [nx|xx]`</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## 设置秒/毫秒级别过期时间, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## 键必须存在/不存在 才能设置成功, 用于添加/更新 (等价 setnx setxx)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## setnx 实现 分布式锁 (原理: redis的单线程模型, setnx 只有一个client 会设置成功)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; set hello world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## 获取值</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## getset key value 设置获取原值</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; get hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&quot;world&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 批量设置, 获取</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">127.0.0.1:6379&gt; mset a 1 b 2 c 3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">127.0.0.1:6379&gt; mget a b c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1) &quot;1&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2) &quot;2&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3) &quot;3&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## 计数 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## 自增 `incr key`, 值不是整数, 返回错误, 值是整数则返回自增后的结果, 值不存在视作0,自增后返回1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## 自减 `decr key`</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## incrby 和 decrby 自增自减指定数字</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 删除</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; del hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; get hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(null)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">###########################################</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 不常用的命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## 追加 `append key value` 向 string 尾部追加字符串</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## 长度 `strlen key` 每个英文字符 1 byte, 中文 3 byte</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## 设置 指定位置的 字符 `setrange key offset value` 偏移量从0开始</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## 获得 部分字符串 `getrange key start end`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>命令的时间复杂度</p><p>场景:</p><ul><li>缓存 - 业务对象(如: User) 需要序列化</li><li>计数 - 统计播放量 (真实的计数系统需要考虑: 防作弊, 数据持久化)</li><li>共享session - 分布式应用</li><li>限流 - 例如每分钟不能访问超过10次, 同一个ip地址不能在1秒内访问超过n次</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="list-列表">List-列表<a href="#list-列表" class="hash-link" aria-label="List-列表的直接链接" title="List-列表的直接链接">​</a></h2><p>允许重复;</p><p>Redis list的实现为一个双向链表，即可以支持反向查找和遍历;</p><p>场景:</p><ul><li><p>消息队列; lpush 和 brpop 结合可实现阻塞队列</p></li><li><p>文章列表</p><p>每篇文章使用 hash 类型存储; 用户文章列表使用 list 类型存储</p></li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 常用命令: lpush,rpush,lpop,rpop,lrange等</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">######## 添加 lpush rpush linsert ##########</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># rpush r即right, 在List中从右向左插入元素 (一旦使用该命令，List就代表是一个列表而不是一个变量，对其使用get方法会报错)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; rpush list-key item</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; rpush list-key item2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; rpush list-key item # 允许重复元素</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">127.0.0.1:6379&gt; rpush list c b a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">127.0.0.1:6379&gt; lrange list 0 -1 # 遍历</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1) &quot;c&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2) &quot;b&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3) &quot;a&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># linsert key before|after pivot value 在 pivot 前/后 插入 value</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">############# 查找 lrange lindex llen ###########################</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># lrange key start end 左右闭区间</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 索引从左到右 0 ~ (N-1) ; 从右到左 -1 ~ -N</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; lrange list-key 0 -1     # index从 0 开始, -1 表示直到末尾</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1) &quot;item&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2) &quot;item2&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3) &quot;item&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># lindex key index 获取 index 处的元素</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">127.0.0.1:6379&gt; lindex list -1 # 最后一个元素</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&quot;a&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># llen key 列表长度</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">########## 删除 lpop rpop lrem ltrim ################</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># lpop l表示left, 返回并删除keyList中的第一个value值 (删除左边第一个)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># rpop key 从右边弹出一个</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; lpop list-key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&quot;item&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># lrem key count value 删除值为 value 的 元素</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># count &gt; 0, 从左到有删除最多 count个; count &lt; 0, 从右到左删除最多 |count| 个; count = 0, 删除所有.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ltrim key start end 取子列表</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">###############修改 lset##################</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># lset key index value 修改index 处的元素</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">################## 阻塞式弹出 blpop brpop ###################</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># blpop key [key...] timeout 等待直到有元素返回, 单位 s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 列表为 nil, 等待 timeout秒后返回, 如果timeout=0, 一直等待下去; 如果在此期间有新的元素添加, 立即返回这个新元素</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 列表不为nil, 立即返回结果</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="set-集合">Set-集合<a href="#set-集合" class="hash-link" aria-label="Set-集合的直接链接" title="Set-集合的直接链接">​</a></h2><p>无序不可重复</p><p>set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的</p><p>取交集, 并集</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 添加 sadd key element [element...]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># sadd s即为Set，Set add value的意思, 给keySet插入value，Set集合是无序的，没有头部和尾部</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; sadd set-key item</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; sadd set-key item2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; sadd set-key item3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; sadd set-key item         # 重复, 不可插入</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># smembers key 集合中的所有元素</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># s=Set，members即在Set集合中的所有元素,  返回keyset中所有的value值</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; smembers set-key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1) &quot;item&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2) &quot;item2&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3) &quot;item3&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 判断是否存在 sismember key element</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># s=Set，ismember即某个元素是否在Set集合的内存中</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; sismember set-key item4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 0     # 不存在</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; sismember set-key item</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 1     # 存在</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># srandmember key [count] 随机返回count个数的元素, 默认返回1个</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 移除 srem key element [element...]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># srem 即Set remove, 删除keySet中指定的value值</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; srem set-key item2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; srem set-key item2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; smembers set-key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1) &quot;item&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2) &quot;item3&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 元素个数 scard key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># spop key [count] 随机弹出一个元素</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">############ 集合间的操作 #############################</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 交集 sinter key [key...]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 并集 sunion key [key...]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 差集 sdiff key [key...]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>场景:</p><ul><li><p>标签 - sadd</p><p>给用户添加标签 ; 给标签添加用户</p><p>添加过程应该在同个事务中完成, 至于如何实现, 可通过 redis 事务, or 通过 lua 脚本</p></li><li><p>生成随机数, 如抽奖 - spop/srandmember</p></li><li><p>社交需求 - sadd + sinter</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="hash-哈希">Hash-哈希<a href="#hash-哈希" class="hash-link" aria-label="Hash-哈希的直接链接" title="Hash-哈希的直接链接">​</a></h2><p>适合用于存储对象; 举个例子🌰： 一个电商网站项目的首页就使用了redis的hash数据结构进行缓存</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 常用命令： hget,hset,hgetall 等。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># HSET key field value 将哈希表 key 中的域 field 的值设为 value</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; hset hash-key sub-key1 value1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; hset hash-key sub-key2 value2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; hset hash-key sub-key1 value1     # 如果域 field 已经存在于哈希表中，旧值将被覆盖</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># hgetall 即 hash get all, 根据hash的key, 获取 field和field_value, 返回list, 长度为hash的2倍</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; hgetall hash-key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1) &quot;sub-key1&quot;     # field</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2) &quot;value1&quot;       # filed value</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3) &quot;sub-key2&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">4) &quot;value2&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 删除</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; hdel hash-key sub-key2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 1 # 返回结果为 成功删除的 field 个数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; hdel hash-key sub-key2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># hget 获取指定filed的值</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; hget hash-key sub-key1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&quot;value1&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; hgetall hash-key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1) &quot;sub-key1&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2) &quot;value1&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># hlen key 计算field 个数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 批量设置 批量获取 field value</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># hmget key field [field...]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># hmset key field value [field value]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># hexists key field 判断field是否存在</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># hkeys key 返回所有 field</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># hvals key 返回所有 value</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># hgetall key 返回 所有 field-value</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># hstrlen key field  计算 field 长度</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>hash 这种类型和结构化数据库的表最类似, key 记录为 id, value就是一行数据. 也有不同之处: hash 每个 key 可以有不同的 field. 而关系型数据库一旦添加新的 &quot;列&quot;, 每行数据都要赋值, 即使是 null; 关系型数据库方便进行关系查询, 而 redis 中的 hash 模拟 复杂查询就很麻烦</p><p>场景: 缓存. 相对于直接使用String 类型使业务对象系列化构建缓存, 使用 hash 构造缓存更直观, 更新操作更便捷</p><p>至此, 对于 缓存场景, 有 3种方案:</p><ul><li><p>使用 string 类型, 每个 key-value 就是一个属性 eg: <code>set usre:1:name xy</code>, <code>set user:1:age 18</code> ...</p><p>这种最简单, 内存占用最大, 因为 key 的冗余内容较多</p></li><li><p>使用 string 类型, 将一个业务对象序列化然后用一个 键值对保存</p><p>内存占用不多, 但是序列化反序列化有时间开销, 尤其 更新 操作的时候, 很麻烦</p></li><li><p>使用 hash 类型, 每个 键值对保存一个业务对象,  属性 通过 field-value 对保存</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="zset-有序集合">ZSet-有序集合<a href="#zset-有序集合" class="hash-link" aria-label="ZSet-有序集合的直接链接" title="ZSet-有序集合的直接链接">​</a></h2><p>类似 set , <code>元素不可重复</code> (分数可以重复); 此外, sorted set增加了一个权重参数score，使得集合中的元素能够按score进行 <code>有序排列</code></p><p>场景: 在直播系统中，实时排行信息包含直播间在线用户列表，各种礼物排行榜</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 添加 zadd key score member [score member ...]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 四个选项: nx: member必须不存在才可成功, 用于 添加; xx: member必须存在才可成功, 用于 修改; ch: 元素发生变化的个数 ; incr: 对 score 自增</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 728 是分数, score 值可以是整数值或双精度浮点数(如果某个 member 已经是有序集的成员，那么更新这个 member 的 score 值)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; zadd zset-key 728 member1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; zadd zset-key 982 member0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; zadd zset-key 982 member0     # member一样, score也一样, 无法插入, 无法更新score</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 元素个数 zcard key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 计算某个元素的分数 zscore key member </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 计算某个成员排名 zrank/zrevrank key member 正数/倒数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># zrem key member [member...]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 增加分数 zincrby key increment member 分数增加increment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 获取指定排名范围的元素 zrange/zrevrange key start end [withscores] 从低到高/从高到低</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; zrange zset-key 0 -1 withscores # 全范围</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1) &quot;member1&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2) &quot;728&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3) &quot;member0&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">4) &quot;982&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 获取指定分数范围的元素 zrangbyscore/zrevrangebyscore key min max [withscores] [limit offset count]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># min max 支持 开闭区间 (小括号, 中括号), 正负无穷 (+-inf)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; zrangebyscore zset-key 0 800 withscores</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1) &quot;member1&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2) &quot;728&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 删除 zrem key member</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 删除指定排名范围内的所有元素 (升序) zremrangebyrank key start end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 删除指定分数范围内的元素 (升序) zremrangebyscore key min max</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; zrem zset-key member1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; zrem zset-key member1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(integer) 0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 返回指定分数范围元素个数 zcount key min max</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">############## 集合间操作 ################################</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#交集 zinterstore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#并集 zunionstore</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>lua脚本</h1><h1>单线程架构 lua实现原子操作</h1><p>不存在并发执行命令</p><ul><li>纯内存访问</li><li>非阻塞io - epoll 实现io多路复用</li><li>单线程没有上下文切换</li></ul><p>Redis只用一个线程来处理客户端的请求。所以在执行lua脚本的时候，没有其他客户端的请求在处理。所以在lua脚本中的对redis数据的修改操作就是原子的。</p><h1>内存淘汰机制</h1><p>可以设置内存最大使用量，当内存使用量超过时施行淘汰策略，具体有 6 种淘汰策略。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="三道保险保证-key-过期处理">三道保险保证 key 过期处理<a href="#三道保险保证-key-过期处理" class="hash-link" aria-label="三道保险保证 key 过期处理的直接链接" title="三道保险保证 key 过期处理的直接链接">​</a></h2><p>定期删除+惰性删除</p><p>定期删除: redis是每隔100ms随机抽取一些key来检查和删除</p><p>惰性删除: 获取某个key的时候，redis会检查一下 ，这个key如果设置了过期时间那么是否过期了？如果过期了此时就会删除</p><p>通过上述两种手段结合起来，保证过期的key一定会被干掉</p><p>但是实际上这还是有问题的，如果定期删除漏掉了很多过期key，然后你也没及时去查，也就没走惰性删除; 此时会走内存淘汰机制</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="有哪些淘汰机制">有哪些淘汰机制<a href="#有哪些淘汰机制" class="hash-link" aria-label="有哪些淘汰机制的直接链接" title="有哪些淘汰机制的直接链接">​</a></h2><ul><li>noeviction(默认策略)：内存满了, 对于写请求不再提供服务，直接返回错误, 没人用</li><li>allkeys-lru：从所有key中使用LRU算法进行淘汰 (常用)</li><li>allkeys-random：从所有key中随机淘汰数据 (没人用)</li><li>volatile-lru：从设置了过期时间的key中使用LRU算法进行淘汰</li><li>volatile-random：从设置了过期时间的key中随机淘汰</li><li>volatile-ttl：在设置了过期时间的key中，根据key的过期时间进行淘汰，有更早过期时间的key优先移除</li></ul><p>volatile-xx 的一般不用</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="内存回收算法">内存回收算法<a href="#内存回收算法" class="hash-link" aria-label="内存回收算法的直接链接" title="内存回收算法的直接链接">​</a></h2><p>Redis中采用两种算法进行内存回收，引用计数算法以及LRU算法;</p><p>如果使用 Redis 来缓存数据时，要保证所有数据都是热点数据，可以将内存最大使用量设置为热点数据占用的内存量，然后启用 allkeys-lru 淘汰策略，将最近最少使用的数据淘汰。</p><p>作为内存数据库，出于对性能和内存消耗的考虑，Redis 的淘汰算法（LRU、TTL）实际实现上并非针对所有 key，而是抽样一小部分 key 从中选出被淘汰 key.</p><p>LRU(Least Recently Used)，即最近最少使用, 根据key的最近被访问的频率进行淘汰，很少被访问的优先被淘汰，被访问的多的则被留下来。 <a href="https://www.cnblogs.com/lzrabbit/p/3734850.html" target="_blank" rel="noopener noreferrer">Java 提供的 LinkedHashMap 可以实现</a> //todo</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="如何配置淘汰策略">如何配置淘汰策略<a href="#如何配置淘汰策略" class="hash-link" aria-label="如何配置淘汰策略的直接链接" title="如何配置淘汰策略的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="通过配置文件">通过配置文件<a href="#通过配置文件" class="hash-link" aria-label="通过配置文件的直接链接" title="通过配置文件的直接链接">​</a></h3><p>通过在Redis安装目录下面的redis.conf</p><p>redis的配置文件不一定使用的是安装目录下面的redis.conf文件，启动redis服务的时候是可以传一个参数指定redis的配置文件的</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">//设置Redis最大占用内存大小为100M</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">maxmemory 100mb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 淘汰策略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">maxmemory</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">policy allkeys</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">lru</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Redis使用的是近似LRU算法，它跟常规的LRU算法还不太一样。近似LRU算法通过随机采样法淘汰数据，每次随机出5（默认）个key，从里面淘汰掉最近最少使用的key。</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">// 修改采样数量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">maxmemory</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">samples </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="通过命令运行时修改">通过命令运行时修改<a href="#通过命令运行时修改" class="hash-link" aria-label="通过命令运行时修改的直接链接" title="通过命令运行时修改的直接链接">​</a></h3><p>Redis支持运行时通过命令动态修改内存大小</p><p>果不设置最大内存大小或者设置最大内存大小为0，在64位操作系统下不限制内存大小</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">//设置Redis最大占用内存大小为100M</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">6379</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> config </span><span class="token keyword" style="color:rgb(0, 0, 255)">set</span><span class="token plain"> maxmemory 100mb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">//获取设置的Redis能使用的最大内存大小</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">6379</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> config </span><span class="token keyword" style="color:rgb(0, 0, 255)">get</span><span class="token plain"> maxmemory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">config </span><span class="token keyword" style="color:rgb(0, 0, 255)">get</span><span class="token plain"> maxmemory</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">policy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">config </span><span class="token keyword" style="color:rgb(0, 0, 255)">set</span><span class="token plain"> maxmemory</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">policy allkeys</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">lru</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>持久化</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="备份选型">备份选型<a href="#备份选型" class="hash-link" aria-label="备份选型的直接链接" title="备份选型的直接链接">​</a></h2><p>Redis 的持久化机制有两种，第一种是快照（RDB），第二种是 AOF 日志。</p><p>快照是一次全量备份，AOF 日志是连续的增量备份。快照是内存数据的二进制序列化形式，在存储上非常紧凑，而 AOF 日志记录的是数据修改的指令文本, 有冗余。</p><p>RDB是通过Redis主进程fork子进程，让子进程执行磁盘 IO 操作来进行 RDB 持久化，AOF 日志存储的是 Redis 服务器的顺序指令序列，AOF 日志只记录对内存进行修改的指令记录。即RDB记录的是数据，AOF记录的是指令</p><p>不要仅仅使用 RDB，因为那样会导致你丢失很多数据，因为RDB是隔一段时间来备份数据</p><p>也不要仅仅使用 AOF，因为那样有两个问题，第一，速度慢; 第二，aof日志文件出bug 的几率大于 rdb快照的二进制文件</p><p>用RDB恢复内存状态会丢失很多数据，重放AOP日志又很慢。Redis4.0推出了混合持久化来解决这个问题。将 rdb 文件的内容和增量的 AOF 日志文件存在一起。这里的 AOF 日志不再是全量的日志，而是自持久化开始到持久化结束的这段时间发生的增量 AOF 日志，通常这部分 AOF 日志很小。于是在 Redis 重启的时候，可以先加载 rdb 的内容，然后再重放增量 AOF 日志就可以完全替代之前的 AOF 全量文件重放</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rdb-快照持久化">RDB-快照持久化<a href="#rdb-快照持久化" class="hash-link" aria-label="RDB-快照持久化的直接链接" title="RDB-快照持久化的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rdb持久化概念">RDB持久化概念<a href="#rdb持久化概念" class="hash-link" aria-label="RDB持久化概念的直接链接" title="RDB持久化概念的直接链接">​</a></h3><p>写操作到达一定密度, 触发快照, 频率可配置</p><p>优:</p><ul><li>rdb文件是经过压缩的二进制文件, 体积小</li><li>redis加载 rdb文件速度快于 aof 的方式</li></ul><p>缺点:</p><ul><li><p>rdb 持久化无法做到实时持久化</p><p>利用快照进行备份。如果系统发生故障，将会丢失最后一次创建快照之后的数据</p></li><li><p>rdb 文件格式在不同版本redis中有不同, 兼容性不好</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="触发机制-如何开启">触发机制-如何开启<a href="#触发机制-如何开启" class="hash-link" aria-label="触发机制-如何开启的直接链接" title="触发机制-如何开启的直接链接">​</a></h3><p>自动触发, 手动触发</p><p>对于手动触发: <code>save</code> 阻塞 redis 直到 rdb 过程完成, 一般不用;  <code>bgsave</code> 使得redis进程创建新的进程执行 rdb过程, 基本没有阻塞</p><p>对于自动触发: 📌 <code>save m n</code> 在 m 秒内, 数据集有了 n 次修改, 自动触发 bgsave; 📌 <code>debug reload</code> 重新加载 redis; 📌 <code>shutdown</code></p><p>bgsave 流程示意图:</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rdb文件">RDB文件<a href="#rdb文件" class="hash-link" aria-label="RDB文件的直接链接" title="RDB文件的直接链接">​</a></h3><p>rdb文件存储在 dir 配置指定的目录下,文件名通过 dbfilename 配置指定</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aof-日志持久化">AOF-日志持久化<a href="#aof-日志持久化" class="hash-link" aria-label="AOF-日志持久化的直接链接" title="AOF-日志持久化的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aof概念">aof概念<a href="#aof概念" class="hash-link" aria-label="aof概念的直接链接" title="aof概念的直接链接">​</a></h3><p>redis的每个写操作都会被追加到一个日志文件中</p><p>将写命令添加到 AOF 文件（Append Only File）的末尾。 --------- 以独立日志文件的方式记录每次写命令, 解决了 RDB方式不能实时持久化的问题</p><p>rdb, aof同时存在时, redis重启时优先载入 aof 文件来恢复数据 (aof 比 rdb 记录的数据更全)</p><p>通过 <code>appendonly yes</code> 配置 开启 aof, aof文件名通过 appendfilename 配置设置, 默认为 appendonly.aof, 保存路径同rdb中的dir配置</p><p>编辑 /etc/redis/redis.conf,</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">appendonly yes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="写入原理">写入原理<a href="#写入原理" class="hash-link" aria-label="写入原理的直接链接" title="写入原理的直接链接">​</a></h3><p>以 <code>文本方式</code>写入 <code>aof缓存区</code> , 然后由操作系统决定什么时候将该内容同步到硬盘，用户可以调用 file.flush() 方法请求操作系统尽快将缓冲区存储的数据同步到硬盘。可以看出 <code>写入文件的数据不会立即同步到硬盘</code>上，在将写命令添加到 AOF 文件时，要根据需求来保证何时同步到硬盘上。</p><ul><li>为什么使用文本格式? 📌 文本格式具有很好的兼容性; 📌 文本格式很容易处理追加操作; 📌 可读性, 直接修改处理;</li><li>为什么命令写入需要先加入&quot;aof缓存区&quot;? 📌 redis是单线程执行命令, 如果不使用&quot;缓存区&quot;, 而是直接写入到硬盘, 则硬盘读写速度会成为瓶颈; 📌 redis 可使用多种不通过的 缓存区-硬盘 同步策略, 在性能和安全中做出平衡.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="文件同步">文件同步<a href="#文件同步" class="hash-link" aria-label="文件同步的直接链接" title="文件同步的直接链接">​</a></h3><p>有三个同步选项:</p><ul><li>always 每个写命令都同步 (always 选项会严重减低服务器的性能)</li><li>everysec 每秒同步一次 (everysec 选项比较合适，可以保证系统奔溃时只会丢失一秒左右的数据，并且 Redis 每秒执行一次同步对服务器性能几乎没有任何影响)</li><li>no 让操作系统来决定何时同步 (no 选项并不能给服务器性能带来多大的提升，而且也会增加系统奔溃时数据丢失的数量)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="重写机制">重写机制<a href="#重写机制" class="hash-link" aria-label="重写机制的直接链接" title="重写机制的直接链接">​</a></h3><p>随着服务器写请求的增多，AOF 文件会越来越大。Redis 提供了一种将 AOF 重写的特性，能够去除 AOF 文件中的冗余写命令。压缩文件体积.</p><p>重写的意义:</p><ul><li>进程内超时命令不会再写入</li><li>无效命令不再写入, 只写入生成最终数据的命令</li><li>多条写命令可以合并</li></ul><p>如何触发重写:</p><ul><li>手动触发: <code>bgrewriteaof</code></li><li>自动触发:</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aof-损坏">aof 损坏<a href="#aof-损坏" class="hash-link" aria-label="aof 损坏的直接链接" title="aof 损坏的直接链接">​</a></h3><p>加载损坏的aof 文件会启动失败; 这是可以先备份这个文件然后尝试通过 <code>redis-check-aof-fix</code> 修复</p><h1>发布与订阅</h1><p>订阅者订阅了频道之后，发布者向频道发送字符串消息会被所有订阅者接收到 (某个客户端使用 SUBSCRIBE 订阅一个频道，其它客户端可以使用 PUBLISH 向这个频道发送消息。)</p><p>发布与订阅模式和观察者模式有以下不同:</p><ul><li>观察者模式中，观察者和主题都知道对方的存在；而在发布与订阅模式中，发布者与订阅者不知道对方的存在，它们之间通过频道进行通信。</li><li>观察者模式是同步的，当事件触发时，主题会去调用观察者的方法，然后等待方法返回；而发布与订阅模式是异步的，发布者向频道发送一个消息之后，就不需要关心订阅者何时去订阅这个消息。</li></ul><h1>事务</h1><p>Redis 最简单的事务实现方式是使用 MULTI 和 EXEC 命令将事务操作包围起来。</p><p>redis事务在执行的中途遇到错误，不会回滚而是继续执行后续命令；（违反原子性） .那么redis为什么还要事务呢? - 事务中的多个命令被一次性发送给服务器，而不是一条一条发送，这种方式被称为流水线，它可以减少客户端与服务器之间的网络通信次数从而提升性能。</p><p>redis事务中的命令在执行exec命令前会被放入队列, 并不会实际执行, 也就不存在隔离级别的概念</p><p>watch key1 key2... : 类似于乐观锁, 如果某个事务提交时, 有其他client 改变了任意一个 key, 则使用 exec 执行事务时, 事务队列不会被执行;</p><h1>事件</h1><p>Redis 服务器是一个事件驱动程序。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="文件事件">文件事件<a href="#文件事件" class="hash-link" aria-label="文件事件的直接链接" title="文件事件的直接链接">​</a></h2><p>服务器通过套接字与客户端或者其它服务器进行通信，文件事件就是对套接字操作的抽象。</p><p>Redis 基于 Reactor 模式开发了自己的网络事件处理器，使用 I/O 多路复用程序来同时监听多个套接字，并将到达的事件传送给文件事件分派器，分派器会根据套接字产生的事件类型调用相应的事件处理器。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="时间事件">时间事件<a href="#时间事件" class="hash-link" aria-label="时间事件的直接链接" title="时间事件的直接链接">​</a></h2><p>服务器有一些操作需要在给定的时间点执行，时间事件是对这类定时操作的抽象。</p><p>时间事件又分为：定时事件, 周期事件</p><p>Redis 将所有时间事件都放在一个无序链表中，通过遍历整个链表查找出已到达的时间事件，并调用相应的事件处理器。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="事件的调度执行">事件的调度&amp;执行<a href="#事件的调度执行" class="hash-link" aria-label="事件的调度&amp;执行的直接链接" title="事件的调度&amp;执行的直接链接">​</a></h2><h1>redis集群</h1><p>通过使用 slaveof host port 命令来让一个服务器成为另一个服务器的从服务器。</p><p>一个从服务器只能有一个主服务器，并且不支持主主复制。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="连接过程">连接过程<a href="#连接过程" class="hash-link" aria-label="连接过程的直接链接" title="连接过程的直接链接">​</a></h2><ol><li>主服务器创建快照文件，发送给从服务器，并在发送期间使用缓冲区记录执行的写命令。快照文件发送完毕之后，开始向从服务器发送存储在缓冲区中的写命令；</li><li>从服务器丢弃所有旧数据，载入主服务器发来的快照文件，之后从服务器开始接受主服务器发来的写命令；</li><li>主服务器每执行一次写命令，就向从服务器发送相同的写命令。</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="主从链">主从链<a href="#主从链" class="hash-link" aria-label="主从链的直接链接" title="主从链的直接链接">​</a></h2><p>随着负载不断上升，主服务器可能无法很快地更新所有从服务器，或者重新连接和重新同步从服务器将导致系统超载。为了解决这个问题，可以创建一个中间层来分担主服务器的复制工作。中间层的服务器是最上层服务器的从服务器，又是最下层服务器的主服务器。</p><h1>哨兵 Sentinel</h1><p>下线推举</p><p>Sentinel（哨兵）可以监听主服务器，并在主服务器进入下线状态时，自动从从服务器中选举出新的主服务器。</p><p><a href="https://blog.csdn.net/m0_37635053/article/details/114196390" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/m0_37635053/article/details/114196390</a></p><p><a href="http://c.biancheng.net/view/4567.html" target="_blank" rel="noopener noreferrer">http://c.biancheng.net/view/4567.html</a></p><p><a href="https://juejin.cn/post/6995794821805768718" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6995794821805768718</a></p><h1>分片</h1><p>分片是将数据划分为多个部分的方法，可以将数据存储到多台机器里面，也可以从多台机器里面获取数据，</p><blockquote><p>假设有 4 个 Reids 实例 R0，R1，R2，R3，还有很多表示用户的键 user:1，user:2，... 等等，有不同的方式来选择一个指定的键存储在哪个实例中。最简单的方式是范围分片，例如用户 id 从 0~1000 的存储到实例 R0 中，用户 id 从 1001~2000 的存储到实例 R1 中，等等。但是这样需要维护一张映射范围表，维护操作代价很高。还有一种方式是哈希分片，使用 CRC32 哈希函数将键转换为一个数字，再对实例数量求模就能知道应该存储的实例。</p></blockquote><p>根据执行分片的位置，可以分为三种分片方式：</p><ul><li>客户端分片：客户端使用 <a href="#%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C">#一致性哈希</a> 等算法决定键应当分布到哪个节点。</li><li>代理分片：将客户端请求发送到代理上，由代理转发请求到正确的节点上。</li><li>服务器分片：Redis Cluster。</li></ul><h1>一个简单的论坛系统</h1><p>该论坛系统功能如下:</p><ul><li>可以发布文章；</li><li>可以对文章进行点赞；</li><li>在首页可以按文章的发布时间或者文章的点赞数进行排序显示。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="文章信息">文章信息<a href="#文章信息" class="hash-link" aria-label="文章信息的直接链接" title="文章信息的直接链接">​</a></h2><p>文章包括标题、作者、赞数等信息，在关系型数据库中很容易构建一张表来存储这些信息，在 Redis 中可以使用 HASH 来存储每种信息以及其对应的值的映射。</p><p>Redis 没有关系型数据库中的表这一概念来将同种类型的数据存放在一起，而是使用命名空间的方式来实现这一功能。键名的前面部分存储命名空间，后面部分的内容存储 ID，通常使用 : 来进行分隔。例如下面的 HASH 的键名为 article:92617，其中 article 为命名空间，ID 为 92617。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="点赞功能">点赞功能<a href="#点赞功能" class="hash-link" aria-label="点赞功能的直接链接" title="点赞功能的直接链接">​</a></h2><p>点赞、取消点赞是高频次的操作，若每次都读写数据库，大量的操作会影响数据库性能，所以需要做缓存</p><p>定时从 redis 中取出点赞数据持久化存入 db, 比如 2h</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="对文章进行排序">对文章进行排序<a href="#对文章进行排序" class="hash-link" aria-label="对文章进行排序的直接链接" title="对文章进行排序的直接链接">​</a></h2><h1>一致性哈希</h1><p>//todo</p><h1>整合 spring boot2</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="jedis">jedis<a href="#jedis" class="hash-link" aria-label="jedis的直接链接" title="jedis的直接链接">​</a></h2><p>项目地址: <a href="https://github.com/xetorthio/jedis" target="_blank" rel="noopener noreferrer">https://github.com/xetorthio/jedis</a></p><p>Jedis 实例是线程不安全的, 为什么?</p><ul><li>Jedis类中有RedisInputStream和RedisOutputStream两个属性，而发送命令和获取返回值都是使用这两个成员变量，显然，这很容易引发多线程问题。</li></ul><p>可以通过JedisPool连接池去管理实例，在多线程情况下让每个线程有自己独立的jedis实例 来实现线程安全</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="lettuce">lettuce<a href="#lettuce" class="hash-link" aria-label="lettuce的直接链接" title="lettuce的直接链接">​</a></h2><p><a href="https://www.cnblogs.com/throwable/p/11601538.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/throwable/p/11601538.html</a> - 使用</p><p>spring boot2 默认使用</p><p>Lettuce 基于 netty, 线程安全, 大吞吐量,</p><p>需要添加依赖 <code>common-pool2</code>, 用于提供连接池, <a href="https://blog.csdn.net/qq447995687/article/details/80233621" target="_blank" rel="noopener noreferrer">自定义对象连接池</a> //todo</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">spring</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> redis</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">cache</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">redis</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 单独为不同的缓存可以配置不同的超时时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">time-to-live</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20000</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#默认缓存超时时间, ms</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">cache-null-values</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#是否缓存空值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">redis</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">lettuce</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">pool</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">max-active</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">max-wait</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">-1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">max-idle</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">min-idle</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10000</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">#redis 连接超时时间ms</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">database</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但是有个bug, 导致在高并发下,  netty 产生堆外内存溢出 OutOfDirectMemoryError; 这个 bug 是: 若不指定 netty堆外内存用量, 默认会采用 -Xmx 的值, 这个值是一定的, 但是堆外内存不会及时释放, 所以不管 -Xmx 设置多大, 总是会用完, OutOfDirectMemoryError, 推荐 jedis 替代 (<a href="https://github.com/seata/seata/issues/2164" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata/issues/2164</a>)</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">spring-boot-starter-data-redis</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">exclusions</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">exclusion</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">io.lettuce</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">lettuce-core</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">exclusion</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">exclusions</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">redis.clients</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">jedis</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="定义序列化器">定义序列化器<a href="#定义序列化器" class="hash-link" aria-label="定义序列化器的直接链接" title="定义序列化器的直接链接">​</a></h2><p><a href="https://blog.csdn.net/bai_bug/article/details/81222519" target="_blank" rel="noopener noreferrer">GenericJackson2JsonRedisSerializer Jackson2JsonRedisSerializer 区别</a> - 前者可以直接从redis 反序列化成对象, 但是占用内存高 (使用GenericJackson2JsonRedisSerializer序列化时，会保存序列化的对象的包名和类名，反序列化时以这个作为标示就可以反序列化成指定的对象)</p><h1>面试问题</h1><p><a href="https://blog.csdn.net/varyall/article/details/81205183" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/varyall/article/details/81205183</a> //todo</p><h1>分布式锁</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="实现原理">实现原理<a href="#实现原理" class="hash-link" aria-label="实现原理的直接链接" title="实现原理的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="分布式锁需要满足的要求">分布式锁需要满足的要求<a href="#分布式锁需要满足的要求" class="hash-link" aria-label="分布式锁需要满足的要求的直接链接" title="分布式锁需要满足的要求的直接链接">​</a></h3><ul><li><p>互斥</p><p>同一时刻只能有一个线程获得锁</p></li><li><p>防止死锁 (即要能够设置锁有效时间)</p><p>比如有个线程获得锁的同时，还没有来得及去释放锁，就因为系统故障或者其它原因使它无法执行释放锁的命令,导致其它线程都无法获得锁</p></li><li><p>锁最好满足可重入</p><p>同一个线程可以重复拿到同一个资源的锁。重入锁非常有利于资源的高效利用</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="加锁机制">加锁机制<a href="#加锁机制" class="hash-link" aria-label="加锁机制的直接链接" title="加锁机制的直接链接">​</a></h3><p>线程去获取锁，获取成功: 执行lua脚本，保存数据到redis数据库。保存成功则表示获取锁成功</p><p>线程去获取锁，获取失败: 一直通过while循环尝试获取锁，获取成功后，执行lua脚本，保存数据到redis数据库。</p><p>为什么使用 lua:
如果你的业务逻辑复杂的话，通过封装在lua脚本中发送给redis，而且redis是单线程的，这样就保证这段复杂业务逻辑执行的原子性</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="watch-dog-自动延时机制">watch dog 自动延时机制<a href="#watch-dog-自动延时机制" class="hash-link" aria-label="watch dog 自动延时机制的直接链接" title="watch dog 自动延时机制的直接链接">​</a></h3><p>&quot;看门狗&quot; 用于这样的场景: 线程1 获得锁, 过了段时间, 业务还没有执行完，锁的过期时间就到了，线程1 还想持有锁的话，就会启动一个watch dog后台线程，不断的延长锁key的生存时间</p><p>默认这个看门狗线程是不启动的，还有就是这个看门狗启动后对整体性能也会有一定影响，所以不建议开启看门狗。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redisson-如何实现可重入锁">redisson 如何实现可重入锁<a href="#redisson-如何实现可重入锁" class="hash-link" aria-label="redisson 如何实现可重入锁的直接链接" title="redisson 如何实现可重入锁的直接链接">​</a></h3><p>Redis存储锁的数据类型是 Hash类型, Hash数据类型的 item 值包含了当前线程信息</p><p><code>key: {item1: value1, item2: value2}</code>, key 为固定值 &quot;redisson&quot;, item 构成为 uuid + &quot;:&quot; + current thread id, value1 为 当前锁获取次数</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis-实现-分布式锁">redis 实现 分布式锁<a href="#redis-实现-分布式锁" class="hash-link" aria-label="redis 实现 分布式锁的直接链接" title="redis 实现 分布式锁的直接链接">​</a></h2><p>要求:</p><ul><li>set ex 300 nx ... 设置过期时间和占位要是原子操作</li><li>执行完业务要删除锁</li><li>要删除自己的锁, 而不要删除别人的锁 (值存为 uuid or thread id)</li></ul><p>伪代码</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token class-name" style="color:rgb(38, 127, 153)">Resp</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">withRedisLock</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    uuid </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">uuid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">tostring</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sucess </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> redis</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">setNx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;lock&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> uuid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">success</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> biz</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">exec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">withRedisLock</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token comment" style="color:rgb(0, 128, 0)">// 自旋</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">// 查找, 删除必须是原子操作, 一下不符合, 必须用 lua 脚本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">// lockValue = redis.get(&quot;lock&quot;);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">// if (lockValue == uuid) {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">//     redis.delete(&quot;lock&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">// }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        deleteScript </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        redis</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">exec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">deleteScript</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redisson-实现">redisson 实现<a href="#redisson-实现" class="hash-link" aria-label="redisson 实现的直接链接" title="redisson 实现的直接链接">​</a></h2><p><a href="https://github.com/redisson/redisson" target="_blank" rel="noopener noreferrer">https://github.com/redisson/redisson</a></p><p>redis 分布式锁的官方推荐</p><p>watch dog (key 自动续期, 防止业务超时锁被删除了)</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">spring-boot-starter-data-redis</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- 推荐使用 redisson starter --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">org.redisson</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">redisson</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">version</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">3.8.2</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">version</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">optional</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">optional</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>springboot 中配置</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(4, 81, 165)">@Bean</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">destroyMethod </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;shutdown&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">RedissonClient</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">redisson</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token annotation punctuation" style="color:rgb(4, 81, 165)">@Value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;classpath:/redisson-config.yml&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Resource</span><span class="token plain"> configFile</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name" style="color:rgb(38, 127, 153)">Config</span><span class="token plain"> config </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">fromYAML</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">configFile</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">getInputStream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Redisson</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">create</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/redis">redis</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/nosql">nosql</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/real-time-communication-protocol"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">实时通信 Real-time</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/regex"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Regular Expression 正则🌈</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#redis-特性" class="table-of-contents__link toc-highlight">redis 特性</a></li><li><a href="#install" class="table-of-contents__link toc-highlight">install</a></li><li><a href="#使用场景" class="table-of-contents__link toc-highlight">使用场景</a></li><li><a href="#系统管理命令" class="table-of-contents__link toc-highlight">系统管理命令</a></li><li><a href="#数据操作命令" class="table-of-contents__link toc-highlight">数据操作命令</a></li><li><a href="#键管理" class="table-of-contents__link toc-highlight">键管理</a></li><li><a href="#streaming-类型" class="table-of-contents__link toc-highlight">streaming 类型</a></li><li><a href="#string-字符串" class="table-of-contents__link toc-highlight">String-字符串</a></li><li><a href="#list-列表" class="table-of-contents__link toc-highlight">List-列表</a></li><li><a href="#set-集合" class="table-of-contents__link toc-highlight">Set-集合</a></li><li><a href="#hash-哈希" class="table-of-contents__link toc-highlight">Hash-哈希</a></li><li><a href="#zset-有序集合" class="table-of-contents__link toc-highlight">ZSet-有序集合</a></li><li><a href="#三道保险保证-key-过期处理" class="table-of-contents__link toc-highlight">三道保险保证 key 过期处理</a></li><li><a href="#有哪些淘汰机制" class="table-of-contents__link toc-highlight">有哪些淘汰机制</a></li><li><a href="#内存回收算法" class="table-of-contents__link toc-highlight">内存回收算法</a></li><li><a href="#如何配置淘汰策略" class="table-of-contents__link toc-highlight">如何配置淘汰策略</a><ul><li><a href="#通过配置文件" class="table-of-contents__link toc-highlight">通过配置文件</a></li><li><a href="#通过命令运行时修改" class="table-of-contents__link toc-highlight">通过命令运行时修改</a></li></ul></li><li><a href="#备份选型" class="table-of-contents__link toc-highlight">备份选型</a></li><li><a href="#rdb-快照持久化" class="table-of-contents__link toc-highlight">RDB-快照持久化</a><ul><li><a href="#rdb持久化概念" class="table-of-contents__link toc-highlight">RDB持久化概念</a></li><li><a href="#触发机制-如何开启" class="table-of-contents__link toc-highlight">触发机制-如何开启</a></li><li><a href="#rdb文件" class="table-of-contents__link toc-highlight">RDB文件</a></li></ul></li><li><a href="#aof-日志持久化" class="table-of-contents__link toc-highlight">AOF-日志持久化</a><ul><li><a href="#aof概念" class="table-of-contents__link toc-highlight">aof概念</a></li><li><a href="#写入原理" class="table-of-contents__link toc-highlight">写入原理</a></li><li><a href="#文件同步" class="table-of-contents__link toc-highlight">文件同步</a></li><li><a href="#重写机制" class="table-of-contents__link toc-highlight">重写机制</a></li><li><a href="#aof-损坏" class="table-of-contents__link toc-highlight">aof 损坏</a></li></ul></li><li><a href="#文件事件" class="table-of-contents__link toc-highlight">文件事件</a></li><li><a href="#时间事件" class="table-of-contents__link toc-highlight">时间事件</a></li><li><a href="#事件的调度执行" class="table-of-contents__link toc-highlight">事件的调度&amp;执行</a></li><li><a href="#连接过程" class="table-of-contents__link toc-highlight">连接过程</a></li><li><a href="#主从链" class="table-of-contents__link toc-highlight">主从链</a></li><li><a href="#文章信息" class="table-of-contents__link toc-highlight">文章信息</a></li><li><a href="#点赞功能" class="table-of-contents__link toc-highlight">点赞功能</a></li><li><a href="#对文章进行排序" class="table-of-contents__link toc-highlight">对文章进行排序</a></li><li><a href="#jedis" class="table-of-contents__link toc-highlight">jedis</a></li><li><a href="#lettuce" class="table-of-contents__link toc-highlight">lettuce</a></li><li><a href="#定义序列化器" class="table-of-contents__link toc-highlight">定义序列化器</a></li><li><a href="#实现原理" class="table-of-contents__link toc-highlight">实现原理</a><ul><li><a href="#分布式锁需要满足的要求" class="table-of-contents__link toc-highlight">分布式锁需要满足的要求</a></li><li><a href="#加锁机制" class="table-of-contents__link toc-highlight">加锁机制</a></li><li><a href="#watch-dog-自动延时机制" class="table-of-contents__link toc-highlight">watch dog 自动延时机制</a></li><li><a href="#redisson-如何实现可重入锁" class="table-of-contents__link toc-highlight">redisson 如何实现可重入锁</a></li></ul></li><li><a href="#redis-实现-分布式锁" class="table-of-contents__link toc-highlight">redis 实现 分布式锁</a></li><li><a href="#redisson-实现" class="table-of-contents__link toc-highlight">redisson 实现</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">历史</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tags">标签</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">归档</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/xiaoyureed" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/xiaoyuhfq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/3fPgwd3naN" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/friends">友链</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/resource">导航</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Xiaoyureed, Inc. Built with ❤️ by xiaoyu.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f9c95488.js"></script>
<script src="/assets/js/main.2a982140.js"></script>
</body>
</html>