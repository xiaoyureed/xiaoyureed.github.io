<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-interview-system-design">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">系统设计 System design - Xiaoyureed 的网络 Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xiaoyureed.github.io/img/logo.webp"><meta data-rh="true" name="twitter:image" content="https://xiaoyureed.github.io/img/logo.webp"><meta data-rh="true" property="og:url" content="https://xiaoyureed.github.io/docs/interview-system-design"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="keywords" content="xiaoyureed"><meta data-rh="true" name="keywords" content="blog, java, spring, microservice, python, rust, typescript, react, web"><meta data-rh="true" name="keywords" content=" 半路转行的编程爱好者, 写过 Python, Rust, 现在主攻 Java 分布式系统"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="系统设计 System design - Xiaoyureed 的网络 Wiki"><meta data-rh="true" name="description" content="https://www.bilibili.com/video/BV1s54y1L7VU?p=2 高并发优化"><meta data-rh="true" property="og:description" content="https://www.bilibili.com/video/BV1s54y1L7VU?p=2 高并发优化"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xiaoyureed.github.io/docs/interview-system-design"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/en/docs/interview-system-design" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/interview-system-design" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/interview-system-design" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://5SAMPKXTP9-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Xiaoyureed 的网络 Wiki" href="/opensearch.xml">


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f6da56a47f5085d1e0fedae39b8de00a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="xiaoyureed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="xiaoyureed Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="xiaoyureed JSON Feed">

<link rel="icon" href="/img/logo.webp">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)">
<meta name="description" content="Xiaoyureed 的个人博客"><link rel="stylesheet" href="/assets/css/styles.261d8673.css">
<link rel="preload" href="/assets/js/runtime~main.eba7f1e0.js" as="script">
<link rel="preload" href="/assets/js/main.6680882d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><a href="/docs/rust-note" target="_blank">Rust 指北, 欢迎查看...</a></div><button type="button" aria-label="关闭" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">菜单</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/archive">博客</a></li><li><a class="dropdown__link" href="/docs/intro">教程</a></li><li><a class="dropdown__link" href="/resource">导航</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--dark_i4oU"><b></b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/SpringBoot-note">Spring Boot 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/autohotkey">Autohotkey 脚本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/blockchain">blockchain区块链</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/c-sharp-and-dot-net">C# &amp; .NET</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/chatgpt">Chatgpt Usage Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cpp">CPP and C 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cross-gfw">Cross The GFW</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cs-note">Computer Science Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/css-pre-processor">几种CSS预处理器比较选型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/data-structure-and-algorithm">Data Structure and Algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/design-pattern-note">Design Pattern 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-resources">开发者资源</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/distributed-system">Distributed System 分布式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docker-note-virtual-dev-env">Docker Note &amp; Other Virtual Develop Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/effective-java-reading-note">Effective Java 阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/elk-elastic-log">Distributed log collection分布式日志收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/english-note">英语学习🔥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extjs-note">Extjs 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/git-note">Git 备忘 🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/golang-note">Golang 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gps-gis-tracing">基于地理位置开发技术</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gradle">Gradle note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/greasy-monkey">油猴插件&amp;编写脚本🐒</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/groovy-note">groovy note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/health">Health 关爱程序员健康🏥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/how-to-test-java-app">How to Test Java App</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/interview-system-design">系统设计 System design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/iot">Iot 物联网</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-code-clean">Java Clean Code Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-concurrent">Java Concurrent🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-memory-model-jmm-jvm">JMM and GC🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-note">Java Core 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/js-tutorial">JavaScript tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/kotlin">kotlin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/kubernetes-k8s">kubernetes-k8s ☁️</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux-note">鸟哥的 Linux 私房菜阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/low-code-platform">关于低代码平台的调研</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mac">Mac 开发环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/machine-learning-ml">machine-learning-ml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/marketing-seo">Marketing SEO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/maven-note">Maven Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/message-queue">Message Queue🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/money">Investment Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mongodb-note">MongoDB Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/monitor-system-grafana-prometheus-influxdb-hbase-time-serials-database">monitor-system-grafana-prometheus监控🖥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mvc-mvvm">MVC to MVVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mybatis-note">MyBatis Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/netty-note">netty</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nlp-natural-language-processing">nlp-natural-language-processing👄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nodejs-yarn-npm">Nodejs, Yarn, Npm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/oracle">Oracle 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-audio-video">Audio and Video development Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-big-data-introduce">大数据开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-cache">Cache 缓存🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-computational-ad">计算广告 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-crawler-spider">网络爬虫 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-db-design-note">关系型数据库表设计🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-desktop-develop">桌面应用开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-http-restful">HTTP protocol Intro &amp; RESTful</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-reactive-programming">响应式编程 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-rpc">RPC Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-rule-engine-note">规则引擎 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/php-note">PHP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/postgres-note">Postgres note🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/process-workflow-bpm-engine">工作流引擎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/protect-your-app-authentication-oauth2-jwt-https">Protect Your App 安全保护认证鉴权🔑</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/python-note">Python🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quant-money">量化交易</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quarkus">Quarkus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/react-note">React🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/real-time-communication-protocol">实时通信 Real-time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/redis-note">Redis🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/regex">Regular Expression 正则🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/rust-note">Rust 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/scala-akka-play-framework">Scala 语言</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/serverless">Serverless</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/service-mesh">service mesh 服务网格</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/servlet">Servlet Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/shell-bash-note">shell-bash脚本收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/spring-note">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springcloud-note">Spring Cloud 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springmvc-note">Spring MVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/task-schedule-note">Task Schedule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tcp-ip-note-p2p">TCP IP, p2p</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tomcat-jetty-nginx">Tomcat Jetty Nginx 等 web 容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/vertx">Vertx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/video-creator">拍摄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/vue">Vue Brief Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webassembly">webassembly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webpack-esbuild-vite-rollup">前端打包构建工具</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">系统设计 System design</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>系统设计 System design</h1></header><p><a href="https://www.bilibili.com/video/BV1s54y1L7VU?p=2" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1s54y1L7VU?p=2</a> 高并发优化</p><p><a href="https://soulmachine.gitbooks.io/system-design/content/cn/distributed-id-generator.html" target="_blank" rel="noopener noreferrer">https://soulmachine.gitbooks.io/system-design/content/cn/distributed-id-generator.html</a></p><p><a href="https://github.com/xingshaocheng/architect-awesome" target="_blank" rel="noopener noreferrer">https://github.com/xingshaocheng/architect-awesome</a></p><p><a href="https://github.com/baiyutang/meetup" target="_blank" rel="noopener noreferrer">https://github.com/baiyutang/meetup</a> 技术会议 ppt</p><p><a href="https://github.com/davideuler/architecture.of.internet-product" target="_blank" rel="noopener noreferrer">https://github.com/davideuler/architecture.of.internet-product</a> 互联网项目架构</p><p><a href="https://acecodeinterview.com/kafka/" target="_blank" rel="noopener noreferrer">https://acecodeinterview.com/kafka/</a></p><p><a href="https://blog.csdn.net/Brad_PiTt7/article/details/90717429" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/Brad_PiTt7/article/details/90717429</a>
TODO</p><p><a href="https://github.com/0voice/interview_internal_reference" target="_blank" rel="noopener noreferrer">https://github.com/0voice/interview_internal_reference</a> 大厂面试题库</p><p><a href="https://github.com/donnemartin/system-design-primer" target="_blank" rel="noopener noreferrer">https://github.com/donnemartin/system-design-primer</a>
<a href="https://github.com/imarvinle/system-design-primer/blob/master/README-zh-Hans.md" target="_blank" rel="noopener noreferrer">https://github.com/imarvinle/system-design-primer/blob/master/README-zh-Hans.md</a></p><p><a href="https://github.com/0voice" target="_blank" rel="noopener noreferrer">https://github.com/0voice</a></p><ul><li><a href="#1-%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E5%A5%97%E8%B7%AF">1. 系统设计套路</a><ul><li><a href="#11-%E6%B7%B7%E6%B2%8C%E5%B7%A5%E7%A8%8B-chaos-engineering">1.1. 混沌工程 chaos engineering</a></li><li><a href="#12-%E5%AE%9E%E7%8E%B0%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">1.2. 实现性能优化</a><ul><li><a href="#121-%E9%AB%98%E5%8F%AF%E7%94%A8">1.2.1. 高可用</a></li><li><a href="#122-%E9%AB%98%E5%B9%B6%E5%8F%91%E9%AB%98%E5%90%9E%E5%90%90%E9%87%8F">1.2.2. 高并发/高吞吐量</a><ul><li><a href="#1221-%E6%9E%B6%E6%9E%84%E5%B1%82%E9%9D%A2">1.2.2.1. 架构层面</a></li><li><a href="#1222-%E8%AF%AD%E8%A8%80%E5%B1%82%E9%9D%A2%E7%9A%84%E4%BC%98%E5%8C%96">1.2.2.2. 语言层面的优化</a></li></ul></li></ul></li></ul></li><li><a href="#2-%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F-%E8%B4%A6%E6%88%B7%E7%B3%BB%E7%BB%9F">2. 用户系统 账户系统</a></li><li><a href="#3-%E7%94%A8%E6%88%B7%E6%B5%81%E5%A4%B1%E5%8F%AC%E5%9B%9E">3. 用户流失召回</a></li><li><a href="#4-%E7%BD%91%E7%BA%A6%E8%BD%A6">4. 网约车</a><ul><li><a href="#41-%E6%B4%BE%E5%8D%95">4.1. 派单</a></li><li><a href="#42-%E6%94%AF%E4%BB%98%E6%B5%81%E7%A8%8B">4.2. 支付流程</a></li><li><a href="#43-%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0">4.3. 开放平台</a></li><li><a href="#44-%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1">4.4. 数据一致性(分布式锁, 分布式事务)</a></li></ul></li><li><a href="#5-%E7%9F%AD%E7%BD%91%E5%9D%80-%E7%9F%AD%E9%93%BE%E6%8E%A5">5. 短网址 短链接</a></li><li><a href="#6-%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB-%E5%90%8C%E6%AD%A5%E5%8F%8C%E5%86%99%E6%96%B9%E6%A1%88">6. 数据迁移 同步双写方案</a></li><li><a href="#7-%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95">7. 第三方登录</a></li><li><a href="#8-%E7%9B%B4%E6%92%AD%E5%BC%B9%E5%B9%95%E7%B3%BB%E7%BB%9F">8. 直播弹幕系统</a></li><li><a href="#9-%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F">9. 秒杀系统</a><ul><li><a href="#91-%E7%A7%92%E6%9D%80%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">9.1. 秒杀解决方案</a></li></ul></li><li><a href="#10-%E7%A7%AF%E5%88%86%E7%B3%BB%E7%BB%9F">10. 积分系统</a></li><li><a href="#11-%E7%94%B5%E5%95%86%E8%B4%A6%E6%88%B7%E7%B3%BB%E7%BB%9F">11. 电商账户系统</a></li><li><a href="#12-%E8%AE%A2%E5%8D%95%E7%B3%BB%E7%BB%9F">12. 订单系统</a><ul><li><a href="#121-%E8%AE%A2%E5%8D%95%E5%8F%B7%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5">12.1. 订单号生成策略</a></li><li><a href="#122-%E8%AE%A2%E5%8D%95%E5%88%9B%E5%BB%BA">12.2. 订单创建</a><ul><li><a href="#1221-%E6%89%A3%E5%87%8F%E5%BA%93%E5%AD%98">12.2.1. 扣减库存</a><ul><li><a href="#12211-%E4%B8%8B%E5%8D%95%E5%87%8F%E5%BA%93%E5%AD%98">12.2.1.1. 下单减库存</a></li><li><a href="#12212-%E4%BB%98%E6%AC%BE%E5%87%8F%E5%BA%93%E5%AD%98">12.2.1.2. 付款减库存</a></li></ul></li></ul></li></ul></li><li><a href="#13-%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F">13. 支付系统</a><ul><li><a href="#131-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D">13.1. 入门介绍</a></li><li><a href="#132-%E5%8D%95%E5%85%83%E5%8C%96">13.2. 单元化</a></li></ul></li><li><a href="#14-feed-%E6%B5%81%E7%B3%BB%E7%BB%9F">14. feed 流系统</a></li><li><a href="#15-%E7%82%B9%E8%B5%9E%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1">15. 点赞模块设计</a><ul><li><a href="#151-%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF">15.1. 设计思路</a></li><li><a href="#152-%E4%BC%98%E7%BC%BA%E7%82%B9">15.2. 优缺点</a></li><li><a href="#153-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1">15.3. 数据结构设计</a></li></ul></li><li><a href="#16-%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95">16. 扫码登录</a><ul><li><a href="#161-%E6%89%AB%E7%A0%81%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF">16.1. 扫码设计思路</a></li></ul></li><li><a href="#17-excel-%E8%A1%A8%E5%AF%BC%E5%85%A5%E4%BC%98%E5%8C%96">17. Excel 表导入优化</a></li><li><a href="#18-java-%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1">18. java 监控系统设计</a><ul><li><a href="#181-%E6%A3%80%E6%B5%8B%E5%93%AA%E4%BA%9B%E5%86%85%E5%AE%B9">18.1. 检测哪些内容</a></li><li><a href="#182-%E5%A6%82%E4%BD%95%E7%9B%91%E6%8E%A7">18.2. 如何监控</a><ul><li><a href="#1821-%E7%A8%8B%E5%BA%8F%E5%86%85%E7%BD%AE%E7%9B%91%E6%B5%8B">18.2.1. 程序内置监测</a></li><li><a href="#1822-jdk-%E8%87%AA%E5%B8%A6%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7">18.2.2. jdk 自带可视化工具</a></li><li><a href="#1823-jdk-%E8%87%AA%E5%B8%A6%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7">18.2.3. jdk 自带命令行工具</a></li><li><a href="#1824-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%B7%A5%E5%85%B7">18.2.4. 第三方工具</a></li></ul></li><li><a href="#183-%E6%A1%88%E4%BE%8B-%E7%94%9F%E9%B2%9C%E7%94%B5%E5%95%86%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0">18.3. 案例 生鲜电商监控平台</a></li></ul></li><li><a href="#19-%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E7%B3%BB%E7%BB%9F-im-%E7%B3%BB%E7%BB%9F">19. 消息推送系统 IM 系统</a></li><li><a href="#20-%E6%B5%81%E7%A8%8B%E5%BC%95%E6%93%8E%E7%B3%BB%E7%BB%9F">20. 流程引擎系统</a></li><li><a href="#21-%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F">21. 权限系统</a></li><li><a href="#22-%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F">22. 日志采集系统</a></li><li><a href="#23-%E5%BC%80%E6%94%BE-api-%E5%B9%B3%E5%8F%B0">23. 开放 api 平台</a></li><li><a href="#24-saas-%E5%B9%B3%E5%8F%B0">24. SaaS 平台</a><ul><li><a href="#241-%E6%A6%82%E5%BF%B5">24.1. 概念</a><ul><li><a href="#2411-pros-and-cons">24.1.1. Pros and Cons</a></li><li><a href="#2412-related-roles">24.1.2. related roles</a></li><li><a href="#2413-compare-with-paas-iaas">24.1.3. compare with PaaS IaaS</a></li></ul></li><li><a href="#242-%E5%A6%82%E4%BD%95%E5%81%9A%E6%95%B0%E6%8D%AE%E9%9A%94%E7%A6%BB">24.2. 如何做数据隔离</a></li><li><a href="#243-%E7%A7%9F%E6%88%B7%E8%AF%86%E5%88%AB-%E8%B7%AF%E7%94%B1">24.3. 租户识别 (路由)</a></li><li><a href="#244-%E7%A7%9F%E6%88%B7%E8%AE%A1%E8%B4%B9">24.4. 租户计费</a></li><li><a href="#245-%E7%81%B0%E5%BA%A6%E5%8D%87%E7%BA%A7">24.5. 灰度升级</a></li></ul></li><li><a href="#25-%E4%BC%98%E6%83%A0%E5%88%B8%E7%B3%BB%E7%BB%9F">25. 优惠券系统</a></li><li><a href="#26-%E6%92%AE%E5%90%88%E7%B3%BB%E7%BB%9F">26. 撮合系统</a><ul><li><a href="#261-%E6%92%AE%E5%90%88%E4%BA%A4%E6%98%93%E5%BC%95%E6%93%8E">26.1. 撮合交易引擎</a></li><li><a href="#262-hazelcast">26.2. Hazelcast</a></li><li><a href="#263-disruptor">26.3. disruptor</a></li></ul></li></ul><h1>1. 系统设计套路</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11-混沌工程-chaos-engineering">1.1. 混沌工程 chaos engineering<a href="#11-混沌工程-chaos-engineering" class="hash-link" aria-label="1.1. 混沌工程 chaos engineering的直接链接" title="1.1. 混沌工程 chaos engineering的直接链接">​</a></h2><p>核心思想: if something hurt do it more often (在可控的条件下)</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12-实现性能优化">1.2. 实现性能优化<a href="#12-实现性能优化" class="hash-link" aria-label="1.2. 实现性能优化的直接链接" title="1.2. 实现性能优化的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="121-高可用">1.2.1. 高可用<a href="#121-高可用" class="hash-link" aria-label="1.2.1. 高可用的直接链接" title="1.2.1. 高可用的直接链接">​</a></h3><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 服务降级</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 使用断路器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 隔离</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 线程隔离 （thread  pool）</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 如 hystrix </span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 其他还有 servlet3 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 进程隔离（系统拆分）比如拆分微服务</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 动静态资源隔离（cdn存放静态资源）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">限流</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">区别： 令牌桶输出速率可以变化 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 令牌以恒定速率颁发</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">可以以任意速度消耗；漏桶输出速率恒定 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">溢出的请求则拒绝或丢弃</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    令牌桶算法 </span><span class="token maybe-class-name">Token</span><span class="token plain"> </span><span class="token maybe-class-name">Bucket</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        原理： 系统会以一个恒定的速度往桶里放入令牌，而如果请求需要被处理，则需要先从桶里获取一个令牌，当桶里没有令牌可取时，则拒绝服务。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> 大小固定的令牌桶可自行以恒定的速率源源不断地产生令牌。如果令牌不被消耗，或者被消耗的速度小于产生的速度，令牌就会不断地增多，直到把桶填满。后面再产生的令牌就会从桶中溢出。最后桶中可以保存的最大令牌数永远不会超过桶的大小。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> 传送到令牌桶的数据包需要消耗令牌。不同大小的数据包，消耗的令牌数量不一样。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> 令牌桶这种控制机制基于令牌桶中是否存在令牌来指示什么时候可以发送流量。令牌桶中的每一个令牌都代表一个字节。如果令牌桶中存在令牌，则允许发送流量；而如果令牌桶中不存在令牌，则不允许发送流量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token maybe-class-name">Guava</span><span class="token plain"> 的 </span><span class="token maybe-class-name">RateLimiter</span><span class="token plain"> 使用了 这个算法</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        作用过程：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        假如用户配置的平均发送速率为r，则每隔</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">r秒一个令牌被加入到桶中；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        假设桶最多可以存发b个令牌。如果令牌到达时令牌桶已经满了，那么这个令牌会被丢弃；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        当一个n个字节的数据包到达时，就从令牌桶中删除n个令牌，并且数据包被发送到网络；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        如果令牌桶中少于n个令牌，那么不会删除令牌，并且认为这个数据包在流量限制之外；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        算法允许最长b个字节的突发，但从长期运行结果看，数据包的速率被限制成常量r</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        如何实现：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        一种解法是，开启一个定时任务，由定时任务持续生成令牌。这样的问题在于会极大的消耗系统资源，如，某接口需要分别对每个用户做访问频率限制，假设系统中存在6W用户，则至多需要开启6W个定时任务来维持每个桶中的令牌数，这样的开销是巨大的。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        另一种解法则是延迟计算，如上resync函数。该函数会在每次获取令牌之前调用，其实现思路为，若当前时间晚于nextFreeTicketMicros，则计算该段时间内可以生成多少令牌，将生成的令牌加入令牌桶中并更新数据。这样一来，只需要在获取令牌时计算一次即可</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    漏桶算法 </span><span class="token maybe-class-name">Leaky</span><span class="token plain"> </span><span class="token maybe-class-name">Bucket</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        就是一个队列， 强制一个常量的输出速率而不管输入数据流的突发性。当输入空闲时，该算法不执行任何动作；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;冗余设计&quot;</span><span class="token plain"> 负载均衡</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 在 nginx 中切换故障的应用层</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> dns 切换机房入口</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 可回滚</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    事物回滚， 代码版本回滚， 部署版本回滚， 数据库回滚</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 为阻塞操作设置超时</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 防止无休止等待</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 健康检查</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="122-高并发高吞吐量">1.2.2. 高并发/高吞吐量<a href="#122-高并发高吞吐量" class="hash-link" aria-label="1.2.2. 高并发/高吞吐量的直接链接" title="1.2.2. 高并发/高吞吐量的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1221-架构层面">1.2.2.1. 架构层面<a href="#1221-架构层面" class="hash-link" aria-label="1.2.2.1. 架构层面的直接链接" title="1.2.2.1. 架构层面的直接链接">​</a></h4><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 无状态</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    方便水平拓展</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 达到高吞吐量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 拆分</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 系统解耦， 拆分成多个子系统， 可分别独立水平拓展</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 读写分离</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 消息队列</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    解耦（一对多消费）， 削峰， 异步</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    对于一对多消费， 可以惊醒镜像复制</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 缓存</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 浏览器缓存</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        响应头 </span><span class="token maybe-class-name">Expires，</span><span class="token plain"> </span><span class="token maybe-class-name">Cache</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">control</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 静态资源进行 cdn 缓存</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 接入层缓存， 如搭建 nginx 作为接入层</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 应用层缓存</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        在 应用所在 server 上部署 redis， 多机间使用 redis 主从同步</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 分布式缓存</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        分片规则：一致性哈希</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 服务化</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    单点远程服务调用 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> 服务集群化 </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> nginx 负载均衡 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    调用方更多后， 考虑使用服务自动注册</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">发现</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    考虑服务隔离，防止级联故障</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    考虑服务限流， 连接超时时间</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">重试， 服务路由， 降级</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1222-语言层面的优化">1.2.2.2. 语言层面的优化<a href="#1222-语言层面的优化" class="hash-link" aria-label="1.2.2.2. 语言层面的优化的直接链接" title="1.2.2.2. 语言层面的优化的直接链接">​</a></h4><p>以 java 为例</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 线程池</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> threadLocal</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> synchronized</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">JMM</span><span class="token plain"> 模型</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> cas</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> juc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 原子类</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 容器类</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> aqs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>2. 用户系统 账户系统</h1><p>考虑:</p><ul><li>基本的 profile, 就是基本的用户信息</li><li>可能需要支持第三方登录 (Oauth2 类型的, apiKey/apiSecret 类型的)</li><li>用户可能有分类 根据业务不通, 区分个人用户/企业用户</li><li>如果涉及到实人认证, 那还需要引入区别于用户系统的客户概念, 客户对应于真实世界中的人(个人/公司), 一个客户可以拥有多个用户</li></ul><h1>3. 用户流失召回</h1><p>定期循环下面几个步骤</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 发现问题</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  统计现在的用户流失情况</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 我们</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">在后台</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 每个用户会绑定一个数据</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">就是上次在线时间</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 然后会有一个</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">单独的进程</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 对这个时间进行统计</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">一般会认为超过一个月没上线就是</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">有流失倾向 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">会形成报表</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 比如有 总流失数</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">每月新增和流失比</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 如果这些数据</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">超过某个阈值</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 那么就要报警</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 给管理人员</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">看是不是需要用户召回来干预了</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 制定目标</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  我们一般会拿到自然回流数据</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  根据这个数据进行目标制定</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  自然回流就是说没有任何干预</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  用户自己回归的数据</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  对不同的 用户会有标签</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 比如</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  有收藏行为的用户</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 会员用户</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  等等</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">然后还有其他行为的用户</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  比如会员用户回流的概率会</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  明显高于其他用户</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 那</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  会把这类用户目标定的高一点</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  就是那对不同类型的用户</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 会指定</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  不同级别的目标</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 制定策略</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  这一步是给后面实际操作做准备的</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  在实施过程中</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 会有很多变量</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 根据这些变量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  可以组合出很多种策略</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  比如说</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 我们会给每个用户分级</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 根据他的</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  消费金额</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 还有使用频率</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 分成高中低三个等级</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  这是一个变量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  然后是触达工具</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 比如我们可以使用 push 消息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  发送营销信息</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 或者是 短信</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 或者是</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  app 里面的活动页</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  然后还可以分 短信文案</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 礼物类型</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  然后从组合出的策略中选中几条灰度执行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  工厂模式</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">策略模式</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 测试分析</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  分析每种方案的成本</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 回流率</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">然后不断迭代这个过程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">直到找到最优的策略</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>4. 网约车</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41-派单">4.1. 派单<a href="#41-派单" class="hash-link" aria-label="4.1. 派单的直接链接" title="4.1. 派单的直接链接">​</a></h2><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42-支付流程">4.2. 支付流程<a href="#42-支付流程" class="hash-link" aria-label="4.2. 支付流程的直接链接" title="4.2. 支付流程的直接链接">​</a></h2><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43-开放平台">4.3. 开放平台<a href="#43-开放平台" class="hash-link" aria-label="4.3. 开放平台的直接链接" title="4.3. 开放平台的直接链接">​</a></h2><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="44-数据一致性分布式锁-分布式事务">4.4. 数据一致性(分布式锁, 分布式事务)<a href="#44-数据一致性分布式锁-分布式事务" class="hash-link" aria-label="4.4. 数据一致性(分布式锁, 分布式事务)的直接链接" title="4.4. 数据一致性(分布式锁, 分布式事务)的直接链接">​</a></h2><h1>5. 短网址 短链接</h1><p><a href="https://www.zhihu.com/question/29270034" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/29270034</a></p><p><a href="https://www.zhihu.com/question/19852154" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/19852154</a></p><p><a href="https://soulmachine.gitbooks.io/system-design/content/cn/tinyurl.html" target="_blank" rel="noopener noreferrer">https://soulmachine.gitbooks.io/system-design/content/cn/tinyurl.html</a></p><p><a href="https://segmentfault.com/a/1190000012088345" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000012088345</a></p><p><a href="https://juejin.cn/post/6844904090602848270" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6844904090602848270</a></p><h1>6. 数据迁移 同步双写方案</h1><h1>7. 第三方登录</h1><p><a href="https://mp.weixin.qq.com/s/3wHFNFQPtj86AocLhUQahw" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/3wHFNFQPtj86AocLhUQahw</a></p><h1>8. 直播弹幕系统</h1><p><a href="https://mp.weixin.qq.com/s/QTslEl7FRupsckfeq7fSLg" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/QTslEl7FRupsckfeq7fSLg</a>
TODO</p><h1>9. 秒杀系统</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="91-秒杀解决方案">9.1. 秒杀解决方案<a href="#91-秒杀解决方案" class="hash-link" aria-label="9.1. 秒杀解决方案的直接链接" title="9.1. 秒杀解决方案的直接链接">​</a></h2><p><a href="https://github.com/qiurunze123/miaosha" target="_blank" rel="noopener noreferrer">https://github.com/qiurunze123/miaosha</a>
<a href="https://github.com/qqxx6661/miaosha" target="_blank" rel="noopener noreferrer">https://github.com/qqxx6661/miaosha</a></p><ul><li><p>分布式 session , 为了抗并发, app 可能水平拓展, 各个 node 的 session 需要统一</p><p>使用 Redis 存储 session</p></li><li><p>加缓存缓解数据库读取压力</p><p>“分层校验”, 过滤尽量多的请求, 这时不做一致性校验, 比如可以直接从缓存读, 直到写库，才对库存做一致性检查</p><p>允许读场景下一定的脏数据，这样只会导致少量原本无库存的下单请求被误认为是有库存的，等到真正写数据时再保证最终一致性，由此做到高可用和一致性之间的平衡。</p></li><li><p>页面静态化</p></li><li><p>异步下单</p><p>使用消息队列</p></li><li><p>限流降级</p></li><li><p>应用层优化</p><ul><li><p>裁剪日志异常堆栈, 减少日志打印量</p></li><li><p>去组件框架, 比如去掉传统的 MVC 框架，直接使用 Servlet 处理请求</p></li><li><p>如何扣减库存</p><ul><li><p>下单减库存</p><p>用户体验好, 但是可能面临恶意下单, 造成最后货物剩余</p></li><li><p>付款减库存</p><p>会出现 用户付款却没货了. 出现超卖, 用户体验较差</p></li><li><p>预扣库存 (买家下单后，库存为其保留一定的时间（如 15 分钟），超过这段时间，库存自动释放)</p><p>提高了恶意下单的成本, 体验还可以</p><p>一般采用这种</p></li></ul></li></ul></li></ul><h1>10. 积分系统</h1><p><a href="https://mp.weixin.qq.com/s/S8-P8h3_mhFWiEscEOi4ug" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/S8-P8h3_mhFWiEscEOi4ug</a></p><h1>11. 电商账户系统</h1><p><a href="https://mp.weixin.qq.com/s/4M3iLsw35GZi94aBZ9VL2w" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/4M3iLsw35GZi94aBZ9VL2w</a></p><p><a href="https://www.cnblogs.com/wangiqngpei557/p/13169705.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/wangiqngpei557/p/13169705.html</a></p><h1>12. 订单系统</h1><p>功能: 订单列表、订单详情、在线下单</p><p>业务流程: 订单创建、订单支付、订单确认、订单完成、取消订单等订单流程</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="121-订单号生成策略">12.1. 订单号生成策略<a href="#121-订单号生成策略" class="hash-link" aria-label="12.1. 订单号生成策略的直接链接" title="12.1. 订单号生成策略的直接链接">​</a></h2><p><a href="https://www.v2ex.com/t/770751#reply16" target="_blank" rel="noopener noreferrer">https://www.v2ex.com/t/770751#reply16</a>
TODO</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="122-订单创建">12.2. 订单创建<a href="#122-订单创建" class="hash-link" aria-label="12.2. 订单创建的直接链接" title="12.2. 订单创建的直接链接">​</a></h2><p>先获取下单中涉及的商品信息，然后获取该商品所涉及到的优惠信息</p><p>增减库存:</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1221-扣减库存">12.2.1. 扣减库存<a href="#1221-扣减库存" class="hash-link" aria-label="12.2.1. 扣减库存的直接链接" title="12.2.1. 扣减库存的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12211-下单减库存">12.2.1.1. 下单减库存<a href="#12211-下单减库存" class="hash-link" aria-label="12.2.1.1. 下单减库存的直接链接" title="12.2.1.1. 下单减库存的直接链接">​</a></h4><p>——即用户下单成功时减少库存数量</p><p>优势：用户体验友好，系统逻辑简洁；
缺点：会导致恶意下单或下单后却不买，使得真正有需求的用户无法购买，影响真实销量</p><p>解决办法：
设置订单有效时间，若订单创建成功N分钟不付款，则订单取消，库存回滚；
限购，用各种条件来限制买家的购买件数，比如一个账号、一个ip，只能买一件；
风控，从技术角度进行判断，屏蔽恶意账号，禁止恶意账号购买</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12212-付款减库存">12.2.1.2. 付款减库存<a href="#12212-付款减库存" class="hash-link" aria-label="12.2.1.2. 付款减库存的直接链接" title="12.2.1.2. 付款减库存的直接链接">​</a></h4><p>优势：减少无效订单带来的资源损耗；
缺点：因第三方支付返回结果存在时差，同一时间多个用户同时付款成功，会导致下单数目超过库存，商家库存不足容易引发断货和投诉，成本增加</p><p>解决办法：
付款前再次校验库存，如确认订单要付款时再验证一次，并友好提示用户库存不足；
增加提示信息：在商品详情页，订单步骤页面提示不及时付款，不能保证有库存等</p><h1>13. 支付系统</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="131-入门介绍">13.1. 入门介绍<a href="#131-入门介绍" class="hash-link" aria-label="13.1. 入门介绍的直接链接" title="13.1. 入门介绍的直接链接">​</a></h2><p><a href="https://github.com/jigsaw-projects/jigsaw-payment" target="_blank" rel="noopener noreferrer">https://github.com/jigsaw-projects/jigsaw-payment</a>
<a href="http://doc.cocolian.cn/" target="_blank" rel="noopener noreferrer">http://doc.cocolian.cn/</a> 凤凰牌老熊</p><p><a href="https://github.com/jeequan/jeepay" target="_blank" rel="noopener noreferrer">https://github.com/jeequan/jeepay</a></p><p><a href="https://github.com/roncoo/roncoo-pay" target="_blank" rel="noopener noreferrer">https://github.com/roncoo/roncoo-pay</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="132-单元化">13.2. 单元化<a href="#132-单元化" class="hash-link" aria-label="13.2. 单元化的直接链接" title="13.2. 单元化的直接链接">​</a></h2><p><a href="https://help.aliyun.com/document_detail/159741.html" target="_blank" rel="noopener noreferrer">https://help.aliyun.com/document_detail/159741.html</a></p><p><a href="https://blog.51cto.com/u_6478076/5109051" target="_blank" rel="noopener noreferrer">https://blog.51cto.com/u_6478076/5109051</a></p><p><a href="https://thurstonzk2008.com/2019/09/24/%E5%8D%95%E5%85%83%E5%8C%96%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%BB%E7%BB%93/" target="_blank" rel="noopener noreferrer">https://thurstonzk2008.com/2019/09/24/%E5%8D%95%E5%85%83%E5%8C%96%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%BB%E7%BB%93/</a></p><p><a href="https://github.com/csy512889371/learnDoc/blob/master/javadoc/%E6%9E%B6%E6%9E%84/%E8%9A%81%E9%87%91%E6%9C%8D%E6%94%AF%E4%BB%98%E5%AE%9D%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8D%95%E5%85%83%E5%8C%96.md" target="_blank" rel="noopener noreferrer">https://github.com/csy512889371/learnDoc/blob/master/javadoc/%E6%9E%B6%E6%9E%84/%E8%9A%81%E9%87%91%E6%9C%8D%E6%94%AF%E4%BB%98%E5%AE%9D%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8D%95%E5%85%83%E5%8C%96.md</a></p><h1>14. feed 流系统</h1><p><a href="https://mp.weixin.qq.com/s/q4w6DdjznVZBXh28MzHdgA" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/q4w6DdjznVZBXh28MzHdgA</a>
TODO</p><h1>15. 点赞模块设计</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="151-设计思路">15.1. 设计思路<a href="#151-设计思路" class="hash-link" aria-label="15.1. 设计思路的直接链接" title="15.1. 设计思路的直接链接">​</a></h2><p>点赞、取消点赞是高频次的操作，若每次都读写数据库，大量的操作会影响数据库性能，所以需要做缓存。将点赞数据扔到 redis 中, 然后离线刷回 MySQL</p><p>多久从 redis 中刷出一次数据到 MySQL 呢, 暂定为 2h</p><p>文章热度计算:文章获得点赞数越高，文章的热度就越高，那么怎么判断呢？不就直接记录点赞数就行啦，但是对于最新的文章怎么办？例如有一篇文章一年前发布的，获得 50 个赞，有篇最新文章获得 49 个赞，但是按照上面所说的一年前的文章热度还比最新的高，这就不合理了. ------------- 解决办法: 为每个文章加入一个 时间戳字段</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="152-优缺点">15.2. 优缺点<a href="#152-优缺点" class="hash-link" aria-label="15.2. 优缺点的直接链接" title="15.2. 优缺点的直接链接">​</a></h2><ul><li><p>缓解了数据库写操作的压力</p></li><li><p>没法保证数据安全性</p><p>比如 redis 挂了会丢失数据</p><p>比如 点赞数据刷回 MySQL 不及时, 可能 redis 会在执行内存淘汰策略时淘汰这些数据 (不过 点赞数据也不是什么关键数据, 丢失一点问题也不大)</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="153-数据结构设计">15.3. 数据结构设计<a href="#153-数据结构设计" class="hash-link" aria-label="15.3. 数据结构设计的直接链接" title="15.3. 数据结构设计的直接链接">​</a></h2><p>MySQL:</p><ul><li>user (id, name)</li><li>like_info (id, tweet_id, user, status)</li><li>tweet(id, content, user, like_count, hate_count)</li></ul><p>redis:</p><p>每有一条点赞数据, 就存一条数据 tweet_id::user_id status, 点赞 status = 1, 取消点赞 status = 0</p><p>一个 hash(tweet_id, set(user_id, ...)) 结构存储某个人所有文章的点赞人情况, tweet_id:(user_id1, user_id2...)</p><h1>16. 扫码登录</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="161-扫码设计思路">16.1. 扫码设计思路<a href="#161-扫码设计思路" class="hash-link" aria-label="16.1. 扫码设计思路的直接链接" title="16.1. 扫码设计思路的直接链接">​</a></h2><p>web 端 和 服务器的配合:</p><ol><li>user 访问登录页, server 随机生成 uuid, 作为键存入 redis, 值暂时为空, 同时设置过期时间, 根据 UUID + 验证字符串, 生成二维码 , 和 UUID 一起, 返回给 浏览器</li><li>browser 拿到 UUID 和 二维码, 之后每隔一秒向服务器发送一个请求, 看是否已经登录成功, 请求携带 UUID</li><li>server 根据 UUID 从 redis 获取 userID, 生成登录成功的 token, 浏览器登录成功</li></ol><p>手机端 和 服务器配合:</p><ol><li>手机扫描二维码, 得到 UUID, 向 手机端服务器发送请求, 携带 UUID + 验证字符串 + user token (穿 token 而不是 直接 userId 是为了安全, token 是经过加密的)</li><li>手机端服务器收到请求, 首先对比参数中的验证信息，确定是否为用户登录请求接口, 如果是，返回一个确认信息给手机端。</li><li>手机端收到返回后，将登录确认框显示给用户, 用户确认, 手机再次发送请求, 携带 UUID, token</li><li>服务器拿到 uuId 和 token 解析的 userId 后，将用户的 userid 作为 value 值存入 redis 中以 uuid 作为 key 的键值对中。</li></ol><h1>17. Excel 表导入优化</h1><p>缴费记录导入, 用户 将别的系统的数据填入我们系统中的 Excel 模板，应用将文件内容读取、校对、转换之后产生欠费数据、票据、票据详情并存储到数据库中; 校验包括:</p><ul><li>字段长度, 字段内容正则校验, 都在内存中没有外部数据交互, 性能影响小</li><li>数据正确性, 重复性校验, 如票据号是否和系统已存在的票据号重复, 房屋是否存在</li></ul><p>在我接手之前数据量还不大, 接手后数据量增加到 10w 级别, 对应到数据库就是 30w 级别, 经过优化后可以在 100s 内完成 (测试服务器 4g 内存不仅放了数据库 MySQL5.7，还放了很多微服务应用。处理能力不太行)</p><ol><li>poi 读取 Excel 成 list</li><li>遍历 list, 检验字段长度, 一些查询数据库的校验，比如校验当前行欠费对应的房屋是否在系统中存在, 写入当前行数据</li><li>返回执行结果，如果出错 / 校验不合格。则返回提示信息并回滚数据 (涉及到三个表)</li></ol><p>优化:</p><ul><li><p>缓存: 将参加校验的数据全部缓存到 HashMap 中。直接到 HashMap 去命中</p><p>校验行中的房屋是否存在，原本是要用 区域 + 楼宇 + 单元 + 房号 去查询房屋表匹配房屋 ID，查到则校验通过，生成的欠单中存储房屋 ID.因此我采用一条 SQL，将该小区下所有的房屋以 区域/楼宇/单元/房号 作为 key，以 房屋 ID 作为 value，存储到 HashMap 中</p></li><li><p>批量插入: MySQL insert 语句支持使用 values (),(),() 的方式一次插入多行数据，通过 mybatis foreach 结合 java 集合可以实现批量插入</p></li><li><p>EasyExcel 代替 poi, 注解方式读写 Excel</p></li><li><p>优化插入速度</p><p>我使用了 values 批量插入代替逐行插入。每 30000 行拼接一个长 SQL、顺序插入。整个导入方法这块耗时最多。后来我将每次拼接的行数减少到 10000、5000、3000、1000、500 发现执行最快的是 1000</p></li><li><p>日志, info 日志 对比不打日志, 不打印日志耗时仅仅是打印日志耗时的 1/10</p></li></ul><ul><li>并行流, 榨干数据库的 CPU，利用网络 IO 的等待时间</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">InsertConsumer</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">/**</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">     * 每个长 SQL 插入的行数，可以根据数据库性能调整</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">final</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> SIZE </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">/**</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">     * 如果需要调整并发数目，修改下面方法的第二个参数即可</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">setProperty</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;java.util.concurrent.ForkJoinPool.common.parallelism&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;4&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">/**</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">     * 插入方法</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">     *</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">     * @param list     插入数据集合</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">     * @param consumer 消费型方法，直接使用 mapper::method 方法引用的方式</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">     * @param &lt;T&gt;      插入的数据类型</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token generics class-name" style="color:rgb(38, 127, 153)">T</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">insertData</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">List</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token generics class-name" style="color:rgb(38, 127, 153)">T</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> list</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Consumer</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token generics class-name" style="color:rgb(38, 127, 153)">List</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token generics class-name" style="color:rgb(38, 127, 153)">T</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> consumer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">list </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">||</span><span class="token plain"> list</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name" style="color:rgb(38, 127, 153)">List</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token generics class-name" style="color:rgb(38, 127, 153)">List</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token generics class-name" style="color:rgb(38, 127, 153)">T</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> streamList </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">ArrayList</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> list</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> SIZE</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> j </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">min</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> SIZE</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> list</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token class-name" style="color:rgb(38, 127, 153)">List</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token generics class-name" style="color:rgb(38, 127, 153)">T</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> subList </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> list</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">subList</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            streamList</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">subList</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">// 并行流使用的并发数是 CPU 核心数，不能局部更改。全局更改影响较大，斟酌</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        streamList</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">parallelStream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">forEach</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">consumer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>18. java 监控系统设计</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="181-检测哪些内容">18.1. 检测哪些内容<a href="#181-检测哪些内容" class="hash-link" aria-label="18.1. 检测哪些内容的直接链接" title="18.1. 检测哪些内容的直接链接">​</a></h2><ul><li>当 java 运行一个应用，就会生成一个 JVM 的实例，而 java 应用则运行于此 JVM 实例中，当应用退出，JVM 实例也会关闭。启动多个 java 应用，也会启动多个 JVM 实例，它们不会相互影响</li><li>虚拟机主要有三大模块，<ul><li>一个类加载子系统（Class Loader Subsystem,负责加载类），</li><li>一个执行引擎（Execution Engine,负责执行类的方法指令和垃圾回收），</li><li>一个运行时数据区（Runtime Data Areas,负责存放程序运行时的数据）<ul><li>方法区（存储如类信息，方法信息，引用，常量池等），</li><li>堆（存储类实例对象和数组），</li><li>java 栈（以栈方式存放以帧为单位保存线程的运行状态帧），</li><li>程序计数器（每一个线程都有它自己的程序计数器，表示下一条将被执行指令的“地址”）</li></ul></li></ul></li></ul><p>java 应用启动流程就是通过类加载子系统加载相关的类，然后把相关数据如类信息，方法等存到方法区中，实例化相关的类存储在堆中，程序运行位置则是每个线程使用计数器来指定。方法区和堆是线程共享的，程序计数器及 Java 栈是线程私有的。</p><p>运行时数据区是 java 应用运行时的监测区域，其中各个区域的内存情况，特别是堆的内存使用情况，是重点区域。堆还会分年轻代、年老代及 Metaspace，垃圾回收器会进行分代回收。通过它的回收情况监测，可以检测到是否存在内存泄漏，而 java 栈则与线程有关，线程的运行状态又与 CPU 相关，因此 java 栈的监测可以知道 CPU 占用过大的问题，同时方法区和 java 栈的占用内存大小也是一个监测的指标</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="182-如何监控">18.2. 如何监控<a href="#182-如何监控" class="hash-link" aria-label="18.2. 如何监控的直接链接" title="18.2. 如何监控的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1821-程序内置监测">18.2.1. 程序内置监测<a href="#1821-程序内置监测" class="hash-link" aria-label="18.2.1. 程序内置监测的直接链接" title="18.2.1. 程序内置监测的直接链接">​</a></h3><p>打印日志</p><p>另一方面可以输出系统属性 System.getProperties()及 System.getProperty()</p><p>对于 Spring Boot 应用，还可以使用 actuator 来监测程序运行情况</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1822-jdk-自带可视化工具">18.2.2. jdk 自带可视化工具<a href="#1822-jdk-自带可视化工具" class="hash-link" aria-label="18.2.2. jdk 自带可视化工具的直接链接" title="18.2.2. jdk 自带可视化工具的直接链接">​</a></h3><p>在 windows 平台下，jdk 还提供了可视化监测工具，以更直观，更方便的方式对 java 应用运行状况进行监测。这两款工具分别是 jconsole 和 jvisualvm，在 jdk 下的 bin 目录下可以找到。它们均可监测本地及远程的 java 应用，包括堆使用情况，线程使用，cpu 使用，类加载情况，gc 情况，jvisualvm 还可以生成相应的堆和线程快照，同时还可以使用相应的插件，以便于进一步分析。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1823-jdk-自带命令行工具">18.2.3. jdk 自带命令行工具<a href="#1823-jdk-自带命令行工具" class="hash-link" aria-label="18.2.3. jdk 自带命令行工具的直接链接" title="18.2.3. jdk 自带命令行工具的直接链接">​</a></h3><ul><li>jps 查看 java 进程 ID</li><li>jinfo 查看及调整虚拟机参数</li><li>jmap 查看堆(heap)使用情况及生成堆快照</li><li>jstack 查看线程运行状态及生成线程快照</li><li>jstat 显示进程中的类装载、内存、垃圾收集等运行数据。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1824-第三方工具">18.2.4. 第三方工具<a href="#1824-第三方工具" class="hash-link" aria-label="18.2.4. 第三方工具的直接链接" title="18.2.4. 第三方工具的直接链接">​</a></h3><ul><li>MAT 是 eclipse 的内存分析插件，通过 MAT 可以对 dump 出来的堆快照进行分析，并且辅助分析内存泄露原因，快速的计算出在内存中对象的占用大小，垃圾收集器的回收工作情况，并可以通过报表直观的查看到可能造成这种结果的对象。</li><li>BTrace 是是 sun 推出的一款 Java 动态、安全追踪（监控）工具，可以在不停机的情况下监控系统运行情况，并且做到最少的侵入，占用最少的系统资源。特别适用在生产环境下对 java 应用进行监测，问题排查。</li><li>Arthas 是阿里开源的在线 Java 诊断工具，同样可以在不停机情况监控系统，包括内存情况，线程情况，GC 情况，运行时数据，也可以监测方法参数、返回值，异常返回等数据，堪称神器，在生产环境下使用非常方便。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="183-案例-生鲜电商监控平台">18.3. 案例 生鲜电商监控平台<a href="#183-案例-生鲜电商监控平台" class="hash-link" aria-label="18.3. 案例 生鲜电商监控平台的直接链接" title="18.3. 案例 生鲜电商监控平台的直接链接">​</a></h2><p><a href="https://mp.weixin.qq.com/s/9E6tdnPXHEtAeI2DO1KTdw" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/9E6tdnPXHEtAeI2DO1KTdw</a></p><h1>19. 消息推送系统 IM 系统</h1><p>im系统常用相关协议，如：xmpp，mqtt，pb等</p><p>mosquito</p><p><a href="https://zhuanlan.zhihu.com/p/37993013" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/37993013</a>
TODO</p><h1>20. 流程引擎系统</h1><p><a href="https://blog.csdn.net/herriman/article/details/51815925" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/herriman/article/details/51815925</a>
<a href="https://blog.csdn.net/WSRspirit/article/details/81412344" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/WSRspirit/article/details/81412344</a></p><h1>21. 权限系统</h1><ul><li>集中式认证服务, 认证中心提供一个认证凭据, 各个子系统可以通过这个凭据生成自己子系统的凭据</li><li>基于角色的权限模型 RBAC(Role-Based Access Control), 角色是权限的集合, 权限是操作的集合</li></ul><h1>22. 日志采集系统</h1><p><a href="https://mp.weixin.qq.com/s/n2LsrWWsP1ALeLtOYl68XQ" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/n2LsrWWsP1ALeLtOYl68XQ</a>
TODO</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">我们的实时日志量还是比较大的</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">在高峰时期</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">因为 根据经济作物的周期</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 无人机作业有一定的季节性 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> 每天的日志量会达到百万级</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">然后要保证延迟控制在分钟级别</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">也就是最多过去一分钟</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 我就能够在系统查到刚刚的日志</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">还要支持水平拓展</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">日志收集系统是作我们公司的基础服务来提供</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 后面可能不止是给农田管家一条业务线使用</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">当然目前是只有这一条业务线</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 我们计划是能支持多业务线的</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 只需要堆机器就行了</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">我们选型</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">也就是在找技术方案</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> 的时候</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 首先当然是看到了很出名的 elk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 在线上 server 上放 logstash agent 采集日志</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 保存到 es</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 建立倒排索引</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 通过 kibana 作为es 的客户端界面搜索展示</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">但是和我们的实际情况以对比</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 发现有一些问题</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">首先是我们希望 logstash 能够支持监控</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 实时能够知道 agent 的状态</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 工作的怎么样 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> elk 没有提供这样的选项</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">现在不知道支持了监控没有</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 我好久没用了</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> 他是一套很重也很成熟的解决方案</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 但是另外一方面来说定制开发比较麻烦</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 而我们有一些定制化的需求</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">另一个问题是</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">也不能说问题</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 就是不能很好的匹配我们要求</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 那就是每增加一个业务线</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">新的机器</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 需要运维人员去手动修改配置</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 做不到自动化</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">基于前面的原因</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token literal-property property">我们最终选定的方案是这样</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">我们自己参照 logstash 实现定制了 log agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 部署到服务所在的节点</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 实时读取日志</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 发送到 kafka</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 然后有一个程序我们成为 transfer 从 kafka 读取日志</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 存储到 </span><span class="token function" style="color:rgb(0, 0, 255)">es</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> 这里我们留了接口</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 后续业务量进一步增长</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 会准备上 storm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">hadoop做流处理还有日志分析</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 然后通过 kibana 展示查看</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 使用 etcd 来管理配置</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 可以实时通知 log agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 做到类似热加载的效果</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://www.bilibili.com/video/BV1Df4y1C7o5?p=5" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1Df4y1C7o5?p=5</a></p><p>存在的问题:</p><ul><li>麻烦, 运维成本很高, 每增加一个业务线或者增加一个日志收集项, 都要手动修改配置</li><li>logstash 没有监控, 没法知道准确的状态, 崩了也不知道</li><li>开源对定制开发和维护不友好</li></ul><p>新的选型架构:</p><p>log agent -&gt; kafka -&gt; transfer -&gt; es (storm/Hadoop) -&gt; kibana -&gt; browser</p><p>(使用  etcd 管理配置)</p><h1>23. 开放 api 平台</h1><p>open api</p><p><a href="http://www.woshipm.com/pd/1930150.html" target="_blank" rel="noopener noreferrer">http://www.woshipm.com/pd/1930150.html</a></p><p><a href="https://timyang.net/sns/open-api-practice/" target="_blank" rel="noopener noreferrer">https://timyang.net/sns/open-api-practice/</a></p><p><a href="https://easydoc.net/posts/api-safe/" target="_blank" rel="noopener noreferrer">https://easydoc.net/posts/api-safe/</a></p><p><a href="https://antonioshen.gitbooks.io/openapi/content/" target="_blank" rel="noopener noreferrer">https://antonioshen.gitbooks.io/openapi/content/</a></p><p><a href="https://segmentfault.com/a/1190000015904390" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000015904390</a></p><p><a href="https://v2ex.com/t/609802" target="_blank" rel="noopener noreferrer">https://v2ex.com/t/609802</a></p><h1>24. SaaS 平台</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="241-概念">24.1. 概念<a href="#241-概念" class="hash-link" aria-label="24.1. 概念的直接链接" title="24.1. 概念的直接链接">​</a></h2><p>software as a service, 是一种软件交付方式</p><blockquote><p>通过 Internet 提供软件的模式，厂商将应用软件统一部署在自己的服务器上，客户可以根据自己实际需求，通过互联网向厂商定购所需的应用软件服务，按定购的服务多少和时间长短向厂商支付费用</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2411-pros-and-cons">24.1.1. Pros and Cons<a href="#2411-pros-and-cons" class="hash-link" aria-label="24.1.1. Pros and Cons的直接链接" title="24.1.1. Pros and Cons的直接链接">​</a></h3><p>优点:</p><ul><li><p>交付方便, 租户端无需下载任何的升级包或者修复补丁</p></li><li><p>付费机制灵活</p></li></ul><p>缺点:</p><ul><li>租户没有软件控制权</li><li>数据不在租户自己手中</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2412-related-roles">24.1.2. related roles<a href="#2412-related-roles" class="hash-link" aria-label="24.1.2. related roles的直接链接" title="24.1.2. related roles的直接链接">​</a></h3><ul><li>saas service provider</li><li>tenant: the company that have purchased the service, 每个租户的数据隔离, 系统独立</li><li>user: employee of tenant</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2413-compare-with-paas-iaas">24.1.3. compare with PaaS IaaS<a href="#2413-compare-with-paas-iaas" class="hash-link" aria-label="24.1.3. compare with PaaS IaaS的直接链接" title="24.1.3. compare with PaaS IaaS的直接链接">​</a></h3><p>IaaS: 基础设施即服务：如CPU、Network、Disk和Memory等</p><p>PaaS: 平台即服务：如阿里云服务器和云数据库等</p><p>Saas: 软件即服务：阿里短信、阿里邮箱等, Office365, JaaS, slack</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="242-如何做数据隔离">24.2. 如何做数据隔离<a href="#242-如何做数据隔离" class="hash-link" aria-label="24.2. 如何做数据隔离的直接链接" title="24.2. 如何做数据隔离的直接链接">​</a></h2><ul><li><p>共享程序实例, 但是每个 tenant 有自己的 db 实例</p><p>安全性最好, 数据恢复最容易，但成本较高</p></li><li><p>共享程序实例, 共享 db, 但每个 tenant 一个 schema,</p><p>数据恢复比较困难，因为恢复数据库将牵涉到其他租户的数据 如果需要跨租户统计数据，存在一定困难</p></li><li><p>租户共享程序实例, 共享一个数据库、同一个 Schema, 只是表中增加 TenantID 多租户的数据字段;</p><p>维护和购置成本最低, 数据备份和恢复最困难，需要逐表逐条备份和还原</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="243-租户识别-路由">24.3. 租户识别 (路由)<a href="#243-租户识别-路由" class="hash-link" aria-label="24.3. 租户识别 (路由)的直接链接" title="24.3. 租户识别 (路由)的直接链接">​</a></h2><p>通过url识别租户</p><blockquote><p>系统是给租户生成一个三级域名, 代码里面可以根据过来的域名，判断是那个租户然后初始化TenantContext.</p></blockquote><blockquote><p>Nginx中rewrite实现二级域名、三级域名</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="244-租户计费">24.4. 租户计费<a href="#244-租户计费" class="hash-link" aria-label="24.4. 租户计费的直接链接" title="24.4. 租户计费的直接链接">​</a></h2><p>比如那个租户购买了那些模块，一个月多少钱。租户可以创建最多的用户数。计费到期邮件提醒等功能。</p><p>计费方式一般有两种，周期性计费，类似月租方案，和使用量计费,用多少付多少。周期性计费比较简单</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="245-灰度升级">24.5. 灰度升级<a href="#245-灰度升级" class="hash-link" aria-label="24.5. 灰度升级的直接链接" title="24.5. 灰度升级的直接链接">​</a></h2><p>SAAS付费企业客户对系统问题都特别敏感。为了减少升级可能出现问题的影响范围，一般都采用灰度升级策略</p><p>可以配置nginx 来根据域名做分发，</p><blockquote><p>比如租户A（<a href="http://aaa.com%EF%BC%89%E5%88%B0%E5%AE%9E%E4%BE%8B1%EF%BC%88%E7%89%88%E6%9C%AC1.0%EF%BC%89%EF%BC%8C%E7%A7%9F%E6%88%B7B(http://bbb.com)%E5%88%B0%E5%AE%9E%E4%BE%8B2(%E7%89%88%E6%9C%AC2.0)" target="_blank" rel="noopener noreferrer">http://aaa.com）到实例1（版本1.0），租户B(http://bbb.com)到实例2(版本2.0)</a>. 当需要域名配置非常多的时候，nginx配置文档会乱。这块时候可以考虑使用nignx_lua来写一些扩展模块。</p></blockquote><h1>25. 优惠券系统</h1><p><a href="https://zhuanlan.zhihu.com/p/78790372" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/78790372</a>
<a href="http://www.woshipm.com/pd/1056437.html" target="_blank" rel="noopener noreferrer">http://www.woshipm.com/pd/1056437.html</a></p><p><a href="https://segmentfault.com/a/1190000005784383" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000005784383</a></p><p><a href="https://www.cnblogs.com/vivotech/p/15117264.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/vivotech/p/15117264.html</a></p><h1>26. 撮合系统</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="261-撮合交易引擎">26.1. 撮合交易引擎<a href="#261-撮合交易引擎" class="hash-link" aria-label="26.1. 撮合交易引擎的直接链接" title="26.1. 撮合交易引擎的直接链接">​</a></h2><p><a href="https://juejin.cn/post/6844904013909983240" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6844904013909983240</a></p><p><a href="https://www.youtube.com/watch?v=-KSWPG8PAL4&amp;list=PLW0LFiZNv2iKPn5V2Ajk6l9vGsJpGUW7H" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=-KSWPG8PAL4&amp;list=PLW0LFiZNv2iKPn5V2Ajk6l9vGsJpGUW7H</a></p><p><a href="https://www.liaoxuefeng.com/article/1452011784503329" target="_blank" rel="noopener noreferrer">https://www.liaoxuefeng.com/article/1452011784503329</a></p><p><a href="https://www.cnblogs.com/zdz8207/p/qkl-CoinExchange-market.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/zdz8207/p/qkl-CoinExchange-market.html</a></p><p><a href="https://xueqiu.com/8121449782/139412894" target="_blank" rel="noopener noreferrer">https://xueqiu.com/8121449782/139412894</a></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">工作职责：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">、参与撮合的开发，撮合系统是通过分析用户行为，建立用户之间的关系，撮合他们进行交易的系统。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">、分析用户行为，建立他们之间的关系，并研究用户推荐的算法；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">、开发后台程序，实现撮合系统的服务器端逻辑；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">、架构设计、模块开发、数据挖掘、算法研究都可能涉及到，根据个人的能力和兴趣安排具体的工作。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">职位要求：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">、本科</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">年工作经验，硕士以上</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">年工作经验；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token literal-property property">、具有至少以下一种编程语言熟练编写的经验</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(0, 0, 255)">JavaScript</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">js</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">，Python，</span><span class="token constant" style="color:rgb(129, 31, 63)">C</span><span class="token plain">，</span><span class="token constant" style="color:rgb(129, 31, 63)">C</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"> 等；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">、有Hadoop、Hive数据挖掘经验者优先；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">、有大规模互联网后台服务开发经验者优先；</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="262-hazelcast">26.2. Hazelcast<a href="#262-hazelcast" class="hash-link" aria-label="26.2. Hazelcast的直接链接" title="26.2. Hazelcast的直接链接">​</a></h2><p><a href="https://www.modb.pro/db/323266" target="_blank" rel="noopener noreferrer">https://www.modb.pro/db/323266</a> 和 redis 区别</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="263-disruptor">26.3. disruptor<a href="#263-disruptor" class="hash-link" aria-label="26.3. disruptor的直接链接" title="26.3. disruptor的直接链接">​</a></h2></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/interview">interview</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/系统设计">系统设计</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/how-to-test-java-app"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">How to Test Java App</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/iot"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Iot 物联网</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#11-混沌工程-chaos-engineering" class="table-of-contents__link toc-highlight">1.1. 混沌工程 chaos engineering</a></li><li><a href="#12-实现性能优化" class="table-of-contents__link toc-highlight">1.2. 实现性能优化</a><ul><li><a href="#121-高可用" class="table-of-contents__link toc-highlight">1.2.1. 高可用</a></li><li><a href="#122-高并发高吞吐量" class="table-of-contents__link toc-highlight">1.2.2. 高并发/高吞吐量</a><ul><li><a href="#1221-架构层面" class="table-of-contents__link toc-highlight">1.2.2.1. 架构层面</a></li><li><a href="#1222-语言层面的优化" class="table-of-contents__link toc-highlight">1.2.2.2. 语言层面的优化</a></li></ul></li></ul></li><li><a href="#41-派单" class="table-of-contents__link toc-highlight">4.1. 派单</a></li><li><a href="#42-支付流程" class="table-of-contents__link toc-highlight">4.2. 支付流程</a></li><li><a href="#43-开放平台" class="table-of-contents__link toc-highlight">4.3. 开放平台</a></li><li><a href="#44-数据一致性分布式锁-分布式事务" class="table-of-contents__link toc-highlight">4.4. 数据一致性(分布式锁, 分布式事务)</a></li><li><a href="#91-秒杀解决方案" class="table-of-contents__link toc-highlight">9.1. 秒杀解决方案</a></li><li><a href="#121-订单号生成策略" class="table-of-contents__link toc-highlight">12.1. 订单号生成策略</a></li><li><a href="#122-订单创建" class="table-of-contents__link toc-highlight">12.2. 订单创建</a><ul><li><a href="#1221-扣减库存" class="table-of-contents__link toc-highlight">12.2.1. 扣减库存</a><ul><li><a href="#12211-下单减库存" class="table-of-contents__link toc-highlight">12.2.1.1. 下单减库存</a></li><li><a href="#12212-付款减库存" class="table-of-contents__link toc-highlight">12.2.1.2. 付款减库存</a></li></ul></li></ul></li><li><a href="#131-入门介绍" class="table-of-contents__link toc-highlight">13.1. 入门介绍</a></li><li><a href="#132-单元化" class="table-of-contents__link toc-highlight">13.2. 单元化</a></li><li><a href="#151-设计思路" class="table-of-contents__link toc-highlight">15.1. 设计思路</a></li><li><a href="#152-优缺点" class="table-of-contents__link toc-highlight">15.2. 优缺点</a></li><li><a href="#153-数据结构设计" class="table-of-contents__link toc-highlight">15.3. 数据结构设计</a></li><li><a href="#161-扫码设计思路" class="table-of-contents__link toc-highlight">16.1. 扫码设计思路</a></li><li><a href="#181-检测哪些内容" class="table-of-contents__link toc-highlight">18.1. 检测哪些内容</a></li><li><a href="#182-如何监控" class="table-of-contents__link toc-highlight">18.2. 如何监控</a><ul><li><a href="#1821-程序内置监测" class="table-of-contents__link toc-highlight">18.2.1. 程序内置监测</a></li><li><a href="#1822-jdk-自带可视化工具" class="table-of-contents__link toc-highlight">18.2.2. jdk 自带可视化工具</a></li><li><a href="#1823-jdk-自带命令行工具" class="table-of-contents__link toc-highlight">18.2.3. jdk 自带命令行工具</a></li><li><a href="#1824-第三方工具" class="table-of-contents__link toc-highlight">18.2.4. 第三方工具</a></li></ul></li><li><a href="#183-案例-生鲜电商监控平台" class="table-of-contents__link toc-highlight">18.3. 案例 生鲜电商监控平台</a></li><li><a href="#241-概念" class="table-of-contents__link toc-highlight">24.1. 概念</a><ul><li><a href="#2411-pros-and-cons" class="table-of-contents__link toc-highlight">24.1.1. Pros and Cons</a></li><li><a href="#2412-related-roles" class="table-of-contents__link toc-highlight">24.1.2. related roles</a></li><li><a href="#2413-compare-with-paas-iaas" class="table-of-contents__link toc-highlight">24.1.3. compare with PaaS IaaS</a></li></ul></li><li><a href="#242-如何做数据隔离" class="table-of-contents__link toc-highlight">24.2. 如何做数据隔离</a></li><li><a href="#243-租户识别-路由" class="table-of-contents__link toc-highlight">24.3. 租户识别 (路由)</a></li><li><a href="#244-租户计费" class="table-of-contents__link toc-highlight">24.4. 租户计费</a></li><li><a href="#245-灰度升级" class="table-of-contents__link toc-highlight">24.5. 灰度升级</a></li><li><a href="#261-撮合交易引擎" class="table-of-contents__link toc-highlight">26.1. 撮合交易引擎</a></li><li><a href="#262-hazelcast" class="table-of-contents__link toc-highlight">26.2. Hazelcast</a></li><li><a href="#263-disruptor" class="table-of-contents__link toc-highlight">26.3. disruptor</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">历史</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tags">标签</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">归档</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/xiaoyureed" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/xiaoyuhfq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/3fPgwd3naN" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/friends">友链</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/resource">导航</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Xiaoyureed, Inc. Built with ❤️ by xiaoyu.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.eba7f1e0.js"></script>
<script src="/assets/js/main.6680882d.js"></script>
</body>
</html>