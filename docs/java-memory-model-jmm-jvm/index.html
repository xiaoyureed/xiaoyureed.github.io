<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-java-memory-model-jmm-jvm">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">JMM and GC🌈 - Xiaoyureed 的网络 Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xiaoyureed.github.io/img/logo.webp"><meta data-rh="true" name="twitter:image" content="https://xiaoyureed.github.io/img/logo.webp"><meta data-rh="true" property="og:url" content="https://xiaoyureed.github.io/docs/java-memory-model-jmm-jvm"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="keywords" content="xiaoyureed"><meta data-rh="true" name="keywords" content="blog, java, spring, microservice, python, rust, typescript, react, web"><meta data-rh="true" name="keywords" content=" 半路转行的编程爱好者, 写过 Python, Rust, 现在主攻 Java 分布式系统"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="JMM and GC🌈 - Xiaoyureed 的网络 Wiki"><meta data-rh="true" name="description" content="Java Memory Model."><meta data-rh="true" property="og:description" content="Java Memory Model."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xiaoyureed.github.io/docs/java-memory-model-jmm-jvm"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/en/docs/java-memory-model-jmm-jvm" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/java-memory-model-jmm-jvm" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/java-memory-model-jmm-jvm" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://5SAMPKXTP9-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Xiaoyureed 的网络 Wiki" href="/opensearch.xml">


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f6da56a47f5085d1e0fedae39b8de00a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="xiaoyureed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="xiaoyureed Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="xiaoyureed JSON Feed">

<link rel="icon" href="/img/logo.webp">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)">
<meta name="description" content="Xiaoyureed 的个人博客"><link rel="stylesheet" href="/assets/css/styles.d08d09a2.css">
<link rel="preload" href="/assets/js/runtime~main.ad5a3358.js" as="script">
<link rel="preload" href="/assets/js/main.bd2fa472.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><a href="/docs/rust-note" target="_blank">Rust 指北, 欢迎查看...</a></div><button type="button" aria-label="关闭" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">菜单</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/archive">博客</a></li><li><a class="dropdown__link" href="/docs/intro">教程</a></li><li><a class="dropdown__link" href="/resource">导航</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--dark_i4oU"><b></b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/SpringBoot-note">Spring Boot 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/autohotkey">Autohotkey 脚本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/blockchain">blockchain区块链</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/c-sharp-and-dot-net">C# &amp; .NET</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/chatgpt">Chatgpt Usage Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cpp">CPP and C 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cross-gfw">Cross The GFW</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cs-note">Computer Science Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/css-pre-processor">几种CSS预处理器比较选型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/data-structure-and-algorithm">Data Structure and Algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/design-pattern-note">Design Pattern 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-resources">开发者资源</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/distributed-system">Distributed System 分布式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docker-note-virtual-dev-env">Docker Note &amp; Other Virtual Develop Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/effective-java-reading-note">Effective Java 阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/elk-elastic-log">Distributed log collection分布式日志收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/english-note">英语学习🔥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extjs-note">Extjs 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/git-note">Git 备忘 🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/golang-note">Golang 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gps-gis-tracing">基于地理位置开发技术</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gradle">Gradle note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/greasy-monkey">油猴插件&amp;编写脚本🐒</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/groovy-note">groovy note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/health">Health 关爱程序员健康🏥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/how-to-test-java-app">How to Test Java App</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/interview-system-design">系统设计 System design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/iot">Iot 物联网</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-code-clean">Java Clean Code Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-concurrent">Java Concurrent🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/java-memory-model-jmm-jvm">JMM and GC🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-note">Java Core 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/js-tutorial">JavaScript tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/kotlin">kotlin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/kubernetes-k8s">kubernetes-k8s ☁️</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux-note">鸟哥的 Linux 私房菜阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/low-code-platform">Low code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mac">Mac 开发环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/machine-learning-ml">machine-learning-ml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/marketing-seo">Marketing SEO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/maven-note">Maven Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/message-queue">Message Queue🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/money">Investment Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mongodb-note">MongoDB Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/monitor-system-grafana-prometheus-influxdb-hbase">monitor-system-grafana-prometheus监控🖥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mvc-mvvm">MVC to MVVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mybatis-note">MyBatis Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/netty-note">netty</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nlp-natural-language-processing">nlp-natural-language-processing👄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nodejs-yarn-npm">Nodejs, Yarn, Npm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/oracle">Oracle 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-audio-video">Audio and Video development Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-big-data-introduce">大数据开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-cache">Cache 缓存🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-computational-ad">计算广告 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-crawler-spider">网络爬虫 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-db-design-note">关系型数据库表设计🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-desktop-develop">桌面应用开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-http-restful">HTTP protocol Intro &amp; RESTful</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-reactive-programming">响应式编程 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-rpc">RPC Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-rule-engine-note">规则引擎 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/php-note">PHP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/play-framework">Play框架</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/postgres-note">Postgres note🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/process-workflow-bpm-engine">工作流引擎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/protect-your-app-authentication-oauth2-jwt-https">Protect Your App 安全保护认证鉴权🔑</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/python-note">Python🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quant-money">量化交易</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quarkus">Quarkus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/react-note">React🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/real-time-communication-protocol">实时通信 Real-time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/redis-note">Redis🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/regex">Regular Expression 正则🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/rust-note">Rust 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/serverless">Serverless</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/service-mesh">service mesh 服务网格</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/servlet">Servlet Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/shell-bash-note">shell-bash脚本收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/spring-note">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springcloud-note">Spring Cloud 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springmvc-note">Spring MVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/task-schedule-note">Task Schedule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tcp-ip-note-p2p">TCP IP, p2p</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tomcat-jetty-nginx">Tomcat Jetty Nginx 等 web 容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/vertx">Vertx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/video-creator">拍摄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webassembly">webassembly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webpack-esbuild-vite-rollup">前端打包构建工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/windows-sub-system-on-linux">WSL 使用</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">JMM and GC🌈</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>JMM and GC🌈</h1></header><div align="center">Java Memory Model. references: [1](https://zhuanlan.zhihu.com/p/34461147) Java 内存模型: https://zhuanlan.zhihu.com/p/42546444 https://openjdk.java.net/projects/panama/ - 和cpp交互, native 方法</div><h1>1. 为什么要有jmm</h1><ul><li><a href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%9C%89jmm">1. 为什么要有jmm</a></li><li><a href="#2-jvm%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E6%A8%A1%E5%9E%8B">2. jvm内存区域模型</a><ul><li><a href="#21-method-area">2.1. Method Area</a></li><li><a href="#22-heap">2.2. Heap</a></li><li><a href="#23-jvm-stack">2.3. JVM Stack</a></li><li><a href="#24-native-method-stack">2.4. Native Method Stack</a></li><li><a href="#25-pc-register%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8">2.5. PC Register(程序计数器)</a></li></ul></li><li><a href="#3-gc-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6">3. gc 垃圾回收</a><ul><li><a href="#31-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8">3.1. 垃圾收集器</a></li><li><a href="#32-%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E5%BA%94%E8%AF%A5%E5%9B%9E%E6%94%B6">3.2. 如何判断对象是否应该回收</a><ul><li><a href="#321-%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E6%B3%95-reference-counting">3.2.1. 引用计数法 reference counting</a></li><li><a href="#322-%E5%8F%AF%E8%BE%BE%E6%80%A7%E5%88%86%E6%9E%90%E7%AE%97%E6%B3%95-reachability-analysis">3.2.2. 可达性分析算法 reachability analysis</a></li><li><a href="#323-reference-%E5%88%86%E7%B1%BB">3.2.3. reference 分类</a></li></ul></li><li><a href="#33-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95">3.3. 垃圾回收算法</a><ul><li><a href="#331-%E6%A0%87%E8%AE%B0-%E6%B8%85%E9%99%A4-%E7%AE%97%E6%B3%95">3.3.1. 标记-清除 算法</a></li><li><a href="#332-%E5%A4%8D%E5%88%B6%E7%AE%97%E6%B3%95">3.3.2. 复制算法</a></li><li><a href="#333-%E6%A0%87%E8%AE%B0-%E6%95%B4%E7%90%86-%E7%AE%97%E6%B3%95">3.3.3. 标记-整理 算法</a></li><li><a href="#334-%E5%88%86%E4%BB%A3%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95">3.3.4. 分代收集算法</a></li></ul></li></ul></li><li><a href="#4-java%E7%9A%84%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6">4. Java的代码执行机制</a><ul><li><a href="#41-%E7%B1%BB%E7%BC%96%E8%AF%91">4.1. 类编译</a></li><li><a href="#42-%E7%B1%BB%E5%8A%A0%E8%BD%BD">4.2. 类加载</a><ul><li><a href="#421-classloader%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8">4.2.1. classloader类加载器</a></li><li><a href="#422-%E8%A3%85%E8%BD%BDload">4.2.2. 装载(load)</a></li><li><a href="#423-%E9%93%BE%E6%8E%A5link">4.2.3. 链接(Link)</a></li><li><a href="#424-%E5%88%9D%E5%A7%8B%E5%8C%96initialize">4.2.4. 初始化(Initialize)</a></li></ul></li><li><a href="#43-%E7%B1%BB%E6%89%A7%E8%A1%8C">4.3. 类执行</a><ul><li><a href="#431-%E5%AD%97%E8%8A%82%E7%A0%81%E8%A7%A3%E9%87%8A%E6%89%A7%E8%A1%8Cand%E7%BC%96%E8%AF%91%E6%89%A7%E8%A1%8C%E5%B9%B6%E5%AD%98%E5%A6%82%E4%BD%95%E5%88%86%E7%95%8C">4.3.1. 字节码解释执行and编译执行并存如何分界</a></li><li><a href="#432-%E5%AD%97%E8%8A%82%E7%A0%81%E8%A7%A3%E9%87%8A%E6%89%A7%E8%A1%8C">4.3.2. 字节码解释执行</a><ul><li><a href="#4321-%E6%96%B9%E6%B3%95%E7%9B%B8%E5%85%B3%E7%9A%84jvm%E6%8C%87%E4%BB%A4">4.3.2.1. 方法相关的jvm指令</a></li><li><a href="#4322-jvm%E6%8C%87%E4%BB%A4%E6%80%8E%E4%B9%88%E8%A7%A3%E9%87%8A%E6%89%A7%E8%A1%8C">4.3.2.2. jvm指令怎么解释执行</a></li></ul></li><li><a href="#433-%E5%AD%97%E8%8A%82%E7%A0%81%E7%BC%96%E8%AF%91%E6%89%A7%E8%A1%8C">4.3.3. 字节码编译执行</a><ul><li><a href="#4331-client-compiler">4.3.3.1. client compiler</a></li><li><a href="#4332-server-compiler">4.3.3.2. server compiler</a></li></ul></li><li><a href="#434-%E5%8F%8D%E5%B0%84%E6%89%A7%E8%A1%8C">4.3.4. 反射执行</a></li></ul></li></ul></li><li><a href="#5-java%E4%B8%AD%E7%9A%84%E5%85%B3%E9%94%AE%E5%AD%97%E5%92%8C%E5%86%85%E5%AD%98%E7%9A%84%E5%85%B3%E7%B3%BB">5. java中的关键字和内存的关系</a><ul><li><a href="#51-final">5.1. final</a></li><li><a href="#52-volatile">5.2. volatile</a></li><li><a href="#53-synchronized">5.3. synchronized</a></li><li><a href="#54-static">5.4. static</a></li></ul></li><li><a href="#6-java%E7%9A%84%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2">6. java的内存泄露</a><ul><li><a href="#61-%E4%BC%9A%E9%80%A0%E6%88%90%E5%93%AA%E4%BA%9B%E6%BA%A2%E5%87%BA">6.1. 会造成哪些溢出</a></li><li><a href="#62-java%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E5%BC%95%E8%B5%B7%E5%8E%9F%E5%9B%A0">6.2. Java内存泄露引起原因</a></li></ul></li><li><a href="#7-jvm-%E4%B8%AD%E7%9A%84-object">7. jvm 中的 object</a><ul><li><a href="#71-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B%E5%86%85%E5%AD%98%E6%80%8E%E4%B9%88%E5%88%86%E9%85%8D">7.1. 对象的创建过程(内存怎么分配)</a></li><li><a href="#72-%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%AE%BF%E9%97%AE">7.2. 对象的访问</a><ul><li><a href="#721-%E5%AF%B9%E8%B1%A1%E7%9A%842%E7%A7%8D%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F">7.2.1. 对象的2种访问方式</a></li><li><a href="#722-thread%E5%85%B7%E4%BD%93%E6%80%8E%E4%B9%88%E8%AE%BF%E9%97%AE%E5%AF%B9%E8%B1%A1%E4%B8%AD%E7%9A%84%E5%80%BC%E5%91%A2%E4%BB%A5%E5%8F%8Avolatile%E5%85%B3%E9%94%AE%E5%AD%97">7.2.2. thread具体怎么访问对象中的值呢以及volatile关键字</a></li></ul></li><li><a href="#73-%E5%AF%B9%E8%B1%A1%E5%9B%9E%E6%94%B6%E5%86%85%E5%AD%98%E6%80%8E%E4%B9%88%E9%87%8A%E6%94%BE">7.3. 对象回收(内存怎么释放)</a></li></ul></li><li><a href="#8-%E6%9C%89%E5%93%AA%E4%BA%9B%E8%99%9A%E6%8B%9F%E6%9C%BA">8. 有哪些虚拟机</a></li><li><a href="#9-java%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E8%AF%8A%E6%96%AD%E6%8E%92%E6%9F%A5">9. java线上问题诊断排查</a><ul><li><a href="#91-%E6%97%A5%E5%BF%97%E6%A3%80%E7%B4%A2">9.1. 日志检索</a></li><li><a href="#92-%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5">9.2. 查看数据库连接</a></li><li><a href="#93-%E6%9F%A5%E7%9C%8Bcpu-%E8%B4%9F%E8%BD%BD">9.3. 查看CPU 负载</a><ul><li><a href="#931-cpu-user%E9%AB%98-and--cpu-load-%E9%AB%98">9.3.1. CPU User高 and  CPU Load 高</a><ul><li><a href="#9311-%E4%BB%A3%E7%A0%81%E4%B8%AD%E5%AD%98%E5%9C%A8%E9%9D%9E%E5%B8%B8%E6%B6%88%E8%80%97-cpu-%E7%9A%84%E6%93%8D%E4%BD%9C">9.3.1.1. 代码中存在非常消耗 CPU 的操作</a></li><li><a href="#9312-%E9%A2%91%E7%B9%81gc">9.3.1.2. 频繁gc</a></li></ul></li><li><a href="#932-cpu-system-%E9%AB%98-and-cpu-load-%E9%AB%98">9.3.2. CPU System 高 and CPU Load 高</a></li><li><a href="#933-cpu-wait%E9%AB%98-and-cpu-load%E9%AB%98-and-cpu%E5%88%A9%E7%94%A8%E7%8E%87%E4%BD%8E">9.3.3. CPU Wait高 and CPU Load高 and CPU利用率低</a></li></ul></li><li><a href="#94-%E6%9F%A5%E5%86%85%E5%AD%98">9.4. 查内存</a></li><li><a href="#95-%E6%8E%92%E6%9F%A5%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E9%97%AE%E9%A2%98">9.5. 排查垃圾回收问题</a></li><li><a href="#96-%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98">9.6. 网络问题</a></li></ul></li><li><a href="#10-jdk-%E8%87%AA%E5%B8%A6%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7">10. jdk 自带命令行工具</a><ul><li><a href="#101-java-%E5%90%AF%E5%8A%A8-javac-%E7%BC%96%E8%AF%91-javap-%E5%8F%8D%E7%BC%96%E8%AF%91">10.1. java 启动 javac 编译 javap 反编译</a></li><li><a href="#102-jstack">10.2. jstack</a></li><li><a href="#103-jcmd">10.3. jcmd</a></li><li><a href="#104-jps">10.4. jps</a></li><li><a href="#105-jstat">10.5. jstat</a></li><li><a href="#106-jvisualvm">10.6. jvisualvm</a></li><li><a href="#107-jconsole">10.7. jconsole</a></li><li><a href="#108-jhat">10.8. jhat</a></li><li><a href="#109-jmap">10.9. jmap</a></li><li><a href="#1010-jrunscript">10.10. jrunscript</a></li><li><a href="#1011-jinfo">10.11. jinfo</a></li><li><a href="#1012-jprofile">10.12. jprofile</a></li></ul></li><li><a href="#11-%E9%98%BF%E9%87%8C-arthas">11. 阿里 arthas</a></li><li><a href="#12-jvm-%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98-and-%E5%AE%9E%E7%94%A8%E5%8F%82%E6%95%B0">12. jvm 性能调优 and 实用参数</a><ul><li><a href="#121-%E6%9C%89%E5%93%AA%E4%BA%9B%E5%8F%82%E6%95%B0">12.1. 有哪些参数</a></li><li><a href="#122-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F">12.2. 配置方式</a></li></ul></li></ul><p>JMM可以屏蔽掉各种硬件和操作系统的内存访问差异，以实现让java程序在各种平台下都能达到一致的内存访问效果。</p><p>对于串行执行的程序, 天然就是正确的, 但是对于并行程序就需要 jmm 来保证多个 thread 协同工作</p><h1>2. jvm内存区域模型</h1><ul><li><p>线程共享内存区</p><ul><li><p>method area (方法区)</p><p>  保存 类 信息 (如 class name, 方法定义, 字段信息)</p><p>  对于频繁创建类的系统 (如存在大量反射, 动态代理的系统), 方法区要设置大一点</p><p>  -XX:MetaspaceSize 永久代初始分配空间，默认值是21m
-XX:MaxMetaspaceSize来设定永久代最大可分配空间，值为-1, 没有上限</p></li><li><p>heap (堆)</p><p>  保存对象实例, 数组</p><p>  gc 主要是在这里</p><p>  空间不足会抛出 java.lang.OutOfMemoryError</p><p>  空间远大于 jvm stack</p><p>  常量池: </p><p>  -Xms512m 堆初始内存
-Xmx1g 堆最大可用内存</p></li></ul></li></ul><ul><li><p>线程私有内存区</p><ul><li><p>register (程序计数器)</p><p>  用于在 thread 上下文切换时记录当前执行到字节码的哪一步 </p></li><li><p>jvm stack (栈)</p><p>  保存方法调用栈, 对象引用, 局部变量</p><p>  空间不足会抛出 Stack Overflow</p><p>  -Xss1m (栈)内存大小, 每个线程都会产生一个栈, 减小这个值能生成更多的线程。如果这个值太小会影响方法调用的深度</p></li><li><p><del>native method stack</del> (sun jdk 实现中并入 jvm stack)</p></li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21-method-area">2.1. Method Area<a href="#21-method-area" class="hash-link" aria-label="2.1. Method Area的直接链接" title="2.1. Method Area的直接链接">​</a></h2><p>示意图:</p><p>这里 &quot;对象类型数据&quot; 即 类信息</p><p>虽然对象实例有多个, 但是方法定义只有一份, 存储于 method area</p><p>用于存储已被虚拟机加载的<code>类信息</code>(类名, 类修饰符), <code>静态变量</code> (所以又叫 &quot;静态存储区&quot;), <code>final常量</code>, <code>方法定义</code>, <code>field</code> ; 当通过 class 对象的 getName, isInstaceOf 方法获取信息时, 数据来自此区域</p><p>Sun jdk 中对应 <code>持久代 (Permanent Genaration)</code>, 默认最小值为16MB，最大值为64MB，可以通过-XX:PermSize 和 -XX:MaxPermSize 参数限制方法区的大小, 容量不够时抛出 OutOfMemory错误</p><p>相对而言，垃圾收集行为在这个区域是比较少出现的, 但并非数据进入方法区后就“永久存在”了。</p><p>运行时常量池 (runtime constant pool) - JDK1.7及之后版本的 JVM 已经将运行时常量池从方法区中移了出来，在 Java 堆（Heap）中开辟了一块区域存放运行时常量池。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22-heap">2.2. Heap<a href="#22-heap" class="hash-link" aria-label="2.2. Heap的直接链接" title="2.2. Heap的直接链接">​</a></h2><p>唯一目的就是存放<code>对象实例</code>及<code>数组</code>; 也就是 通过 &quot;new&quot; 创建的对象</p><p>是所有区域中最大的一块, 垃圾回收主要是回收这一块 (所以又叫 &quot;GC堆&quot;)</p><p>为了便于垃圾回收，Java堆空间有更细致的划分: 见 gc 一节 (<code>进一步细分的目的: 加快内存回收分配的速度</code>)</p><ul><li>New Generation (新生代) - 一般新建对象都存放在这里;
</li><li>Old Generation 或叫作 Tenured(年老) Generation， - 存放经过多个 GC 仍然存活的 对象 (如 缓存对象), 新建的对象也可能直接存在这里 (通过 -XX:PretenureSizeThreshold=1024, 单位字节, 默认0, 来设置当前对象超过多少size, 就直接分配到 old generation)</li></ul><p>可以通过用JVM的命令行选项 -Xms, -Xmx, -Xmn来调整Java堆空间的大小。不要忘了在大小后面加上”M”或者”G”来表示单位。</p><p><code>-Xmx256M</code> 最大堆内存 为 256M. 默认为物理内存的1/4但小于1G. 默认当空余堆内存小于40%时，JVM会增大Heap到-Xmx指定的大小，可通过 <code>-XX:MinHeapFreeRation=</code>来指定这个比列</p><p><code>-Xms256M</code> 最小堆为 256M (为避免在运行时频繁调整Heap的大小，通常-Xms与-Xmx的值设成一样), 如果不设置, 默认为操作系统物理内存的1/64但小于1G. 当空余堆内存大于70%时，JVM会减小heap的大小到-Xms指定的大小，可通过<code>XX:MaxHeapFreeRation=</code>来指定这个比列</p><p><code>-Xmn</code> 指定默认大小</p><p>可以用JConsole或者 Runtime.maxMemory(), Runtime.totalMemory(), Runtime.freeMemory()来实时查看Java中堆内存的大小</p><p>当遇到java.lang.outOfMemoryError时，有时候仅仅增加堆空间就可以了，但如果经常出现的话，就要看看Java程序中是不是存在内存泄露了;</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="23-jvm-stack">2.3. JVM Stack<a href="#23-jvm-stack" class="hash-link" aria-label="2.3. JVM Stack的直接链接" title="2.3. JVM Stack的直接链接">​</a></h2><p>JVM stack 记录了线程的 &quot;<code>方法调用</code>&quot; and <code>局部变量</code>; </p><p>java虚拟机栈是由一个个栈帧组成，而每个栈帧中都拥有：<code>局部变量表</code>、<code>操作数栈</code>、<code>动态链接</code>、<code>方法出口信息</code>。(每个方法被调用到执行完的过程，就对应着一个栈帧在jvm stack中从入栈到出栈的过程。) 局部变量表存放了编译器可知的各种基本数据类型(boolean、byte、char、short、int、float、long、double)、对象引用(引用指针，并非对象本身)</p><p>Java 虚拟机栈会出现两种异常：StackOverFlowError 和 OutOfMemoryError。</p><ul><li><p>StackOverFlowError： 若Java虚拟机栈的内存大小不允许动态扩展，那么当线程请求栈的深度超过当前Java虚拟机栈的最大深度的时候，就抛出StackOverFlowError异常 -------- &quot;栈溢出&quot;, 可通过 -Xss 修改大小 (例如 -Xss1K, 设置大小为 1K)</p></li><li><p>OutOfMemoryError： 若 Java 虚拟机栈的内存大小允许动态扩展，且当线程请求栈时内存用完了，无法再动态扩展了，此时抛出OutOfMemoryError异常。-------- &quot;内存用光了&quot;</p></li></ul><p><code>-Xss </code> 控制栈容量</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="24-native-method-stack">2.4. Native Method Stack<a href="#24-native-method-stack" class="hash-link" aria-label="2.4. Native Method Stack的直接链接" title="2.4. Native Method Stack的直接链接">​</a></h2><p><code> 在 HotSpot 虚拟机(也就是 sun jdk实现)中和 Java 虚拟机栈合二为一</code>。性质类似</p><p>用于支持 native 方法的执行, 存储每个 native 方法的调用状态;</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="25-pc-register程序计数器">2.5. PC Register(程序计数器)<a href="#25-pc-register程序计数器" class="hash-link" aria-label="2.5. PC Register(程序计数器)的直接链接" title="2.5. PC Register(程序计数器)的直接链接">​</a></h2><p>是最小的一块内存区域，它的作用是当前线程所执行的字节码的行号指示器; </p><p>字节码解释器工作时通过改变这个计数器的值来选取下一条需要执行的字节码指令，分支、循环、跳转、异常处理、线程恢复等功能都需要依赖这个计数器来完。</p><p>每个 thread 都有一个独立的 &quot;pc-register&quot; ---------- 这样才能保证 线程切换后能找到正确的执行位置</p><h1>3. gc 垃圾回收</h1><p>gc 主要发生在堆内存。所以对内存又称为 gc 堆</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31-垃圾收集器">3.1. 垃圾收集器<a href="#31-垃圾收集器" class="hash-link" aria-label="3.1. 垃圾收集器的直接链接" title="3.1. 垃圾收集器的直接链接">​</a></h2><ul><li><p>serial 收集器</p><p>  用于新生代, 单线程, 有 stop the world</p><p>  简单高效, 用于 client 模式下的 jvm  (也就是桌面应用, 停顿时间 100 ms内, 完全可以接受) 的新生代收集器</p></li><li><p>ParNew 收集器</p><p>  新生代, 多线程 (就是 Serial 的多线程版本 ), 有 stop the world</p><p>  只有它能够配合老年代的 CMS (concurrent mark sweep)收集器</p><p>  用于 Server 模式运行的jvm的新生代收集器</p></li><li><p>Parallel Scavenge 收集器</p><p>  新生代, 多线程</p><p>  吞吐量可控, 可以通过jvm参数设置 (吞吐量 = cpu运行代码的时间 / (cpu运行代码时间 + cpu 运行垃圾回收时间))</p><p>  自适应调节 , 即可以指定一个 jvm 参数, 由jvm自动设置 新生代大小, Eden和Survivor比例, 晋升老年代年龄阈值</p></li><li><p>Serial Old 收集器</p><p>  单线程, 老年代 (Serial 收集器的老年代版本), 有stop the world</p><p>  用在 client 模式 下的 jvm</p></li><li><p>Parallel Old 收集器</p><p>  老年代 (Parallel Scavenge 的老年代版本), 多线程</p><p>  吞吐量可控</p><p>  jvm 自适应调节</p></li><li><p>CMS (concurrent mark sweep) 收集器</p><p>  多线程, 老年代 (标记-清除算法, 有内存碎片, 不利于大Object的内存分配)</p><p>  低停顿 (尽量缩短了 stop the world 停顿时间)</p><p>  更耗cpu资源 (因为并发收集嘛)</p><p>  无法处理浮动垃圾 (即并发清理阶段, 用户线程产生的垃圾, 只能下次 GC 清除)</p><p>  用于 网站, b/s 架构系统, 注重服务的响应速度</p></li><li><p>G1 收集器</p><p>  多线程, 统领 新生代, 老年代 (通过 Region)</p><p>  标记-整理, and 复制</p><p>  可预测的停顿</p><p>  用于 server 模式的jvm</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32-如何判断对象是否应该回收">3.2. 如何判断对象是否应该回收<a href="#32-如何判断对象是否应该回收" class="hash-link" aria-label="3.2. 如何判断对象是否应该回收的直接链接" title="3.2. 如何判断对象是否应该回收的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="321-引用计数法-reference-counting">3.2.1. 引用计数法 reference counting<a href="#321-引用计数法-reference-counting" class="hash-link" aria-label="3.2.1. 引用计数法 reference counting的直接链接" title="3.2.1. 引用计数法 reference counting的直接链接">​</a></h3><p>就是给 object 加上一个计数器, 记录 object 有多少个引用, 为 0 时证明没有引用, 可以回收</p><p>无法解决对象间循环引用的问题</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="322-可达性分析算法-reachability-analysis">3.2.2. 可达性分析算法 reachability analysis<a href="#322-可达性分析算法-reachability-analysis" class="hash-link" aria-label="3.2.2. 可达性分析算法 reachability analysis的直接链接" title="3.2.2. 可达性分析算法 reachability analysis的直接链接">​</a></h3><p>就是看 gc roots 到 object 是否有 reference chain, 如果没有, 证明可以回收</p><p>哪些对象可作为 GC roots Object?</p><ul><li>jvm stack 中的 对象引用</li><li>method area 中类静态属性引用的Object 比如 类变量</li><li>method area 中常量引用的Object</li></ul><p>不可达对象一定会被回收吗?</p><ul><li><p>object 只有经历 <code>二次标记</code> 才会被回收</p><ul><li><p>第一次标记  - 经过 reachability analysis 当前Object没有发现到 gc roots 的 reference chain, 不一定就被回收, 这时会第一次标记</p></li><li><p>第二次标记 - 如果 当前 Object 覆盖了 finalize(), 将当前Object 和 reference chain 上任意Object建立连接(如 将this赋值给静态成员变量) 就可以逃避回收, 如果没有建立链接, 会被第二次标记, 真正回收</p></li></ul></li><li><p>obj.finalize() 对象被回收前会执行这个方法</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="323-reference-分类">3.2.3. reference 分类<a href="#323-reference-分类" class="hash-link" aria-label="3.2.3. reference 分类的直接链接" title="3.2.3. reference 分类的直接链接">​</a></h3><ul><li>strong reference</li><li>soft reference</li><li>weak reference</li><li>phantom reference</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="33-垃圾回收算法">3.3. 垃圾回收算法<a href="#33-垃圾回收算法" class="hash-link" aria-label="3.3. 垃圾回收算法的直接链接" title="3.3. 垃圾回收算法的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="331-标记-清除-算法">3.3.1. 标记-清除 算法<a href="#331-标记-清除-算法" class="hash-link" aria-label="3.3.1. 标记-清除 算法的直接链接" title="3.3.1. 标记-清除 算法的直接链接">​</a></h3><p>首先可达性分析, 两次标记过程后, 清除被标记的内存块</p><p>会造成内存碎片 (因为回收的对象不是内存连续的), 给新Object分配内存时找不到足够的连续空间, 导致提前触发GC</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="332-复制算法">3.3.2. 复制算法<a href="#332-复制算法" class="hash-link" aria-label="3.3.2. 复制算法的直接链接" title="3.3.2. 复制算法的直接链接">​</a></h3><p>将堆空间一分为二, 内存分配只在某一块空间, 当空间不够时候, 将仍然会存活的对象复制到空闲的另一块空间, 然后清除满了的空间</p><ul><li>解决了内存碎片化的问题</li><li>对于大对象, 复制是个耗时耗力的操作</li><li>会浪费一半的空间</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="333-标记-整理-算法">3.3.3. 标记-整理 算法<a href="#333-标记-整理-算法" class="hash-link" aria-label="3.3.3. 标记-整理 算法的直接链接" title="3.3.3. 标记-整理 算法的直接链接">​</a></h3><p>标记待回收的对象, 将标记的Object向内存一端移动, 然后清理掉标记的Object所在的内存</p><ul><li>没有复制操作, 省时省力</li><li>没有空间浪费</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="334-分代收集算法">3.3.4. 分代收集算法<a href="#334-分代收集算法" class="hash-link" aria-label="3.3.4. 分代收集算法的直接链接" title="3.3.4. 分代收集算法的直接链接">​</a></h3><p>为了提高回收效率, 根据Object存活周期不同, 存到不同的内存块, 这些内存块采用不同的收集算法:</p><ul><li><p>new generation (新生代。) - 采用复制算法, 分为三块, eden: survivor1: survivor2 = 8:1:1, 始终保证有一个 survivor 空闲, 也就是说会浪费 10% 空间</p><p>  新创建的 object 放在 Eden, 空间不够发起 minor gc (大量对象分配在这里, 所以 minor gc 发生的很频繁, 但是很快)</p><p>  对象经历 15 次 minor gc 后, 会进入到 老年代, 这个阈值通过 <code>-XX:MaxTenuringThreshold</code> 设定</p><p>  大对象 (长字符串, 数组 这样的需要连续空间的对象) 直接分配进入老年代, 这个尺寸阈值 通过 <code>-XX:PretenureSizeThreshold</code> 设定. (为什么要设置这条策略? 一是避免提前触发 major gc, 明明Eden还有空间, 但是容不下这个 大对象了. 二是新生代 gc 采用复制算法, 而复制大对象是非常耗时的)</p><p>  内存分配担保机制: minor gc 时候, 若 survivor2 空间也不够, 则存活对象直接进入 old generation (如果 old generation 也满了, 则只能触发 full/major gc 了)</p></li><li><p>old generation (老年代。) - 标记-整理 算法</p><p>  这里的对象生命周期长, 如果继续使用 复制算法, 需要大块的分配担保内存, 不划算</p></li><li><p>永久代</p></li></ul><p>minor gc : 新生代发起的 gc 叫做 minor gc.  eden 和 survivor1 中存活的对象被复制进入空闲的 survivor2，清空eden 和 survivor1. </p><p>major gc: 发生在 老年代 的 gc . 非常慢</p><p>为什么需要 survivor？加入 survivor，存活对象有了一个缓冲区域， 不会直接进入老年代，减少了 full gc</p><p>为什么需要2块 survivor？类似 复制收集算法， 是为了利用复制操作, 避免内存碎片化的问题</p><p>什么时候出发 minor gc: 当年轻代满时就会触发Minor GC，这里的年轻代满指的是Eden代满，Survivor满不会引发GC</p><p>什么时候出发 full gc: </p><ul><li>堆内存的老年代满了</li><li>方法区满了</li></ul><p>内存分配担保机制详细过程:</p><ol><li><p>jvm 先检查 老年代空闲连续空间是否大于 新生代所有Object总大小, 若 TRUE, Minor GC 可以确保安全, 若 FALSE, 下一步</p></li><li><p>jvm 查看是否配置了 <code>-XX:-HandlePromotionFailure</code> (一般会打开, 避免 Full GC 频繁), 若 FALSE, 不允许冒担保失败的风险, 老年代直接进行 Full GC, 若 TRUE, 那么允许冒担保失败的风险, 下一步</p></li><li><p>继续检查老年代连续空闲空间是否大于 历史上晋升到老年代的Object的平均大小, 若TRUE, 尝试进行 Minor GC (冒着风险), 若 FALSE, 进行 Full GC</p></li></ol><h1>4. Java的代码执行机制</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41-类编译">4.1. 类编译<a href="#41-类编译" class="hash-link" aria-label="4.1. 类编译的直接链接" title="4.1. 类编译的直接链接">​</a></h2><p>jvm 规定了 class 规范， 但是怎么从 java 文件到 class 文件并没有规定， 厂商有很多实现， javac， ecj （eclipse compiler for Java）， jikes</p><p><code>javac -g Foo.java</code> 编译 （-g 生成 所有调试信息）， 然后 通过 <code>javap -c -s -l -verbose Foo</code> 查看 class 文件</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">/**</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"> * Foo</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Foo</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">final</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> MAX_COUNT </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> count </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">bar</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain">count </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> MAX_COUNT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            count </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">throw</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Exception</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;count overflow.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> count</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token maybe-class-name">Classfile</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token constant" style="color:rgb(129, 31, 63)">C</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token maybe-class-name">Users</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">xiaoyu</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token maybe-class-name">Desktop</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token maybe-class-name">Foo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">class</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token class-name" style="color:rgb(38, 127, 153)">Last</span><span class="token plain"> modified </span><span class="token number" style="color:rgb(9, 134, 88)">2018</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> size </span><span class="token number" style="color:rgb(9, 134, 88)">607</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token constant" style="color:rgb(129, 31, 63)">MD5</span><span class="token plain"> checksum f76c99d05a7c762ddacdbd5c4c2d1650</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token maybe-class-name">Compiled</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Foo.java&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Foo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  minor version</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  major version</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">52</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// -- jdk 版本号, 50 -&gt; jdk 6, 51 -&gt; jdk7, 52 -&gt; jdk8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token literal-property property">flags</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">ACC_PUBLIC</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">ACC_SUPER</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token maybe-class-name">Constant</span><span class="token plain"> pool</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//-- 常量池, 存放 field name, method name, type name, 常量值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   #</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Methodref</span><span class="token plain">          #</span><span class="token number" style="color:rgb(9, 134, 88)">7.</span><span class="token plain">#</span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">         </span><span class="token comment" style="color:rgb(0, 128, 0)">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   #</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Fieldref</span><span class="token plain">           #</span><span class="token number" style="color:rgb(9, 134, 88)">3.</span><span class="token plain">#</span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">         </span><span class="token comment" style="color:rgb(0, 128, 0)">// Foo.count:I</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   #</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Class</span><span class="token plain">              #</span><span class="token number" style="color:rgb(9, 134, 88)">29</span><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)">// Foo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   #</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Class</span><span class="token plain">              #</span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)">// java/lang/Exception</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   #</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">String</span><span class="token plain">             #</span><span class="token number" style="color:rgb(9, 134, 88)">31</span><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)">// count overflow.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   #</span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Methodref</span><span class="token plain">          #</span><span class="token number" style="color:rgb(9, 134, 88)">4.</span><span class="token plain">#</span><span class="token number" style="color:rgb(9, 134, 88)">32</span><span class="token plain">         </span><span class="token comment" style="color:rgb(0, 128, 0)">// java/lang/Exception.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;)V</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   #</span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Class</span><span class="token plain">              #</span><span class="token number" style="color:rgb(9, 134, 88)">33</span><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)">// java/lang/Object</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   #</span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token constant" style="color:rgb(129, 31, 63)">MAX_COUNT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   #</span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token constant" style="color:rgb(129, 31, 63)">I</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token maybe-class-name">ConstantValue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Integer</span><span class="token plain">            </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               count</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">init</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(0, 0, 255)">Utf8</span><span class="token plain">               </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token constant" style="color:rgb(129, 31, 63)">V</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token maybe-class-name">Code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token maybe-class-name">LineNumberTable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token maybe-class-name">LocalVariableTable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token keyword" style="color:rgb(0, 0, 255)">this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">19</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token maybe-class-name">LFoo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               bar</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(0, 0, 255)">Utf8</span><span class="token plain">               </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token constant" style="color:rgb(129, 31, 63)">I</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token maybe-class-name">StackMapTable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token maybe-class-name">Exceptions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">clinit</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token maybe-class-name">SourceFile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">26</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token maybe-class-name">Foo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">NameAndType</span><span class="token plain">        #</span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain">#</span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">// &quot;&lt;init&gt;&quot;:()V</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">NameAndType</span><span class="token plain">        #</span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain">#</span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">         </span><span class="token comment" style="color:rgb(0, 128, 0)">// count:I</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">29</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               </span><span class="token maybe-class-name">Foo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               java</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">lang</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token maybe-class-name">Exception</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">31</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               count overflow</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">32</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">NameAndType</span><span class="token plain">        #</span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain">#</span><span class="token number" style="color:rgb(9, 134, 88)">34</span><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">// &quot;&lt;init&gt;&quot;:(Ljava/lang/String;)V</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">33</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Utf8</span><span class="token plain">               java</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">lang</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  #</span><span class="token number" style="color:rgb(9, 134, 88)">34</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(0, 0, 255)">Utf8</span><span class="token plain">               </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">Ljava</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">lang</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">String</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token constant" style="color:rgb(129, 31, 63)">V</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(0, 0, 255)">Foo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// -- 生成的默认构造器方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">descriptor</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token constant" style="color:rgb(129, 31, 63)">V</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">flags</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">ACC_PUBLIC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">Code</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      stack</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> locals</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> args_size</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> aload_0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> invokespecial #</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(0, 128, 0)">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V //-- jvm提供的四个方法指令之一</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token literal-property property">LineNumberTable</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        line </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token literal-property property">LocalVariableTable</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token maybe-class-name">Start</span><span class="token plain">  </span><span class="token maybe-class-name">Length</span><span class="token plain">  </span><span class="token maybe-class-name">Slot</span><span class="token plain">  </span><span class="token maybe-class-name">Name</span><span class="token plain">   </span><span class="token maybe-class-name">Signature</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">       </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">this</span><span class="token plain">   </span><span class="token maybe-class-name">LFoo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> int </span><span class="token function" style="color:rgb(0, 0, 255)">bar</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> throws java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">lang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">Exception</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//-- bar 方法的元数据信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">descriptor</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token constant" style="color:rgb(129, 31, 63)">I</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">flags</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">ACC_PUBLIC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">Code</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      stack</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> locals</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> args_size</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> getstatic     #</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(0, 128, 0)">// Field count:I</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> iconst_1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> iadd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> dup</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> putstatic     #</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(0, 128, 0)">// Field count:I</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> bipush        </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> if_icmplt     </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> iconst_0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> putstatic     #</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(0, 128, 0)">// Field count:I</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain">           #</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(0, 128, 0)">// class java/lang/Exception</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> dup</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> ldc           #</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(0, 128, 0)">// String count overflow.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> invokespecial #</span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(0, 128, 0)">// Method java/lang/Exception.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;)V</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> athrow</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> getstatic     #</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(0, 128, 0)">// Field count:I</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">31</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> ireturn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token literal-property property">LineNumberTable</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// -- 对应了源码的行号, 查找问题很方便</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        line </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        line </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        line </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        line </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token literal-property property">LocalVariableTable</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// -- 局部变量信息, 如果没有这行信息, 我们无法知道局部变量名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token maybe-class-name">Start</span><span class="token plain">  </span><span class="token maybe-class-name">Length</span><span class="token plain">  </span><span class="token maybe-class-name">Slot</span><span class="token plain">  </span><span class="token maybe-class-name">Name</span><span class="token plain">   </span><span class="token maybe-class-name">Signature</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">32</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">this</span><span class="token plain">   </span><span class="token maybe-class-name">LFoo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token literal-property property">StackMapTable</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> number_of_entries </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//--记录有分支的情况</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        frame_type </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">/* same */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">Exceptions</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//-- 异常处理器表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      throws java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">lang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">Exception</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">descriptor</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token constant" style="color:rgb(129, 31, 63)">V</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">flags</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">ACC_STATIC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">Code</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      stack</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> locals</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> args_size</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">//-- 方法对应的字节码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> iconst_0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> putstatic     #</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(0, 128, 0)">// Field count:I</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token literal-property property">LineNumberTable</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        line </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token literal-property property">SourceFile</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Foo.java&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42-类加载">4.2. 类加载<a href="#42-类加载" class="hash-link" aria-label="4.2. 类加载的直接链接" title="4.2. 类加载的直接链接">​</a></h2><p>将 class 文件 加载到 jvm , 并形成 Class 对象 的过程;</p><ul><li>装载</li><li>链接 (此时已经加载完毕, 形成 Class 对象)</li><li>初始化 (使用对象前必须初始化, 为静态变量赋值)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="421-classloader类加载器">4.2.1. classloader类加载器<a href="#421-classloader类加载器" class="hash-link" aria-label="4.2.1. classloader类加载器的直接链接" title="4.2.1. classloader类加载器的直接链接">​</a></h3><p>check java-note#classloader类加载器</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="422-装载load">4.2.2. 装载(load)<a href="#422-装载load" class="hash-link" aria-label="4.2.2. 装载(load)的直接链接" title="4.2.2. 装载(load)的直接链接">​</a></h3><p>找到 class 文件 并加载到 jvm, jvm 通过  <code>ClassLoader 实例</code> 和 类的<code> full qualified name</code> 加载, 同样也通过这两个元素标识被加载了的 类</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token annotation punctuation" style="color:rgb(4, 81, 165)">@Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">testClassLoad</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 对于 数组类型的类，类名 “[” + &quot;基本类型or L&quot; + 引用类型类名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">byte</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> bytes </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">byte</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1024</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> objArr </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&gt;&gt;&gt; bytes name: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">toString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&gt;&gt;&gt; objArr name: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> objArr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">toString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// result:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">//&gt;&gt;&gt; bytes name: [B@11028347</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">//&gt;&gt;&gt; objArr name: [Ljava.lang.Object;@14899482</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="423-链接link">4.2.3. 链接(Link)<a href="#423-链接link" class="hash-link" aria-label="4.2.3. 链接(Link)的直接链接" title="4.2.3. 链接(Link)的直接链接">​</a></h3><p>也就是常见class对象；具体包括：</p><ul><li><p>对class文件的格式校验, 如果class格式不符合, 抛出 error, 校验中如果碰到其他类, 也加载, 若加载失败, 抛出 NoClassdeffoundError</p></li><li><p>校验完后, 初始化 静态变量</p></li><li><p>最后校验 属性, 方法. 确保属性,方法存在. 可能抛出 NosuchmethodError, NosuchfieldError</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="424-初始化initialize">4.2.4. 初始化(Initialize)<a href="#424-初始化initialize" class="hash-link" aria-label="4.2.4. 初始化(Initialize)的直接链接" title="4.2.4. 初始化(Initialize)的直接链接">​</a></h3><p>执行类中的 <code>静态初始化代码</code>, <code>构造器代码</code>, <code>静态属性初始化</code></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43-类执行">4.3. 类执行<a href="#43-类执行" class="hash-link" aria-label="4.3. 类执行的直接链接" title="4.3. 类执行的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="431-字节码解释执行and编译执行并存如何分界">4.3.1. 字节码解释执行and编译执行并存如何分界<a href="#431-字节码解释执行and编译执行并存如何分界" class="hash-link" aria-label="4.3.1. 字节码解释执行and编译执行并存如何分界的直接链接" title="4.3.1. 字节码解释执行and编译执行并存如何分界的直接链接">​</a></h3><p>根据方法上的2个计数器是否超过阈值决定是否由 解释执行升级为编译执行</p><ul><li>调用计数器 - 方法被调用的次数</li><li>回边计数器 - 方法内部循环代码的循环次数</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="432-字节码解释执行">4.3.2. 字节码解释执行<a href="#432-字节码解释执行" class="hash-link" aria-label="4.3.2. 字节码解释执行的直接链接" title="4.3.2. 字节码解释执行的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4321-方法相关的jvm指令">4.3.2.1. 方法相关的jvm指令<a href="#4321-方法相关的jvm指令" class="hash-link" aria-label="4.3.2.1. 方法相关的jvm指令的直接链接" title="4.3.2.1. 方法相关的jvm指令的直接链接">​</a></h4><p>class 二进制文件中, jvm提供一套指令来执行不同的方法调用</p><ul><li>invokestatic - 调用 static 方法</li><li>invokevirtual  - 调用对象实例的方法</li><li>invokeinterface - 调用接口的方法</li><li>invokespecial - 调用 private 的方法 和 调用 编译后生成的 <code>&lt;init&gt;</code> 方法 (即对象实例化时的初始化方法)</li></ul><p>通过 javap -c xxx 可以以文本形式查看 class二进制文件</p><p>jvm 以 <code>基于 栈的结构</code> 来执行 字节码, 好处时体积小, 代码紧凑</p><p>一个 thread 在创建后会产生 </p><ul><li><code>程序计数器</code> (pc register) - 存放下一条待执行的指令在方法内的偏移量</li><li><code>栈</code> - 存放 &quot;栈帧&quot; (stack frame), 每个方法每次调用都会产生栈帧</li></ul><p>示意图:</p><p>局部变量区  : 存放局部变量和参数</p><p>操作数栈: 存放方法执行过程中产生的中间结果</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4322-jvm指令怎么解释执行">4.3.2.2. jvm指令怎么解释执行<a href="#4322-jvm指令怎么解释执行" class="hash-link" aria-label="4.3.2.2. jvm指令怎么解释执行的直接链接" title="4.3.2.2. jvm指令怎么解释执行的直接链接">​</a></h4><p>冯-诺伊曼 体系 中的 fdx 循环, 思路如下:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">// 实现 fdx 循环有多种方式, switch-threading, token-threading, inline-threading...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// switch-threading 实现循环</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">while</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// // 获取下一条指令, 分派, 执行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> code </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">fetchNextCode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">code</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> IADD</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)">// do int add</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)">// do sth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// token-threading 实现循环, sun jdk 默认采用这种循环方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 较之 前一种方式, 冗余了 fetch 和 dispatch, 去除了 switch; 所以性能好些, 但是内存占用更多</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">while</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    IADD</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">// do int add</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token function" style="color:rgb(0, 0, 255)">fetchNextCode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token function" style="color:rgb(0, 0, 255)">dispatch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ICONST_0</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token function" style="color:rgb(0, 0, 255)">push</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token function" style="color:rgb(0, 0, 255)">fetchNextCode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token function" style="color:rgb(0, 0, 255)">dispatch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="433-字节码编译执行">4.3.3. 字节码编译执行<a href="#433-字节码编译执行" class="hash-link" aria-label="4.3.3. 字节码编译执行的直接链接" title="4.3.3. 字节码编译执行的直接链接">​</a></h3><p>字节码解释执行的效率不够好, 新的执行方式出现: 将 字节码 编译为 机器码, 在运行时进行 ------- <code>JIT编译器</code> (just-in-time compiler 即时编译器)</p><p>sun jdk 对字节码中执行频率较高的部分代码编译为机器码, 频率不够高的部分二字节码仍旧解释执行 -------- 因此 sun jdk 又称为 Hotspot VM, 取 &quot;热点&quot;之意</p><p>sun jdk 提供两种编译模式 : client compiler, server compiler</p><p>sun jdk 根据 机器配置决定使用什么模式, 也可以强制指定以哪种模式启动jvm</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4331-client-compiler">4.3.3.1. client compiler<a href="#4331-client-compiler" class="hash-link" aria-label="4.3.3.1. client compiler的直接链接" title="4.3.3.1. client compiler的直接链接">​</a></h4><p>又名 <code>C1 编译</code>, 轻量级, 占用内存少, 适合桌面交互式应用</p><p>主要优化手段:</p><ul><li>方法内联 - 当前方法内部调用另一个方法, JIT 编译后, 另外的方法代码直接被编入当前方法中</li><li>去除虚拟化 - class字节码被 load 后, 会分析其类层次结构, 如果一个接口只有一个实现类, 而这个接口在某个地方被使用了, JIT 会在 调用处进行 <code>方法内联</code>优化</li><li>冗余削除, 在编译时, 根据代码运行情况进行代码的削除, 如果某个条件分支的代码没有执行到, C1编译 会在编译后直接去掉这段不会被执行到的代码</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 优化 - 方法内联</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">bar</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">foo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">foo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// foo method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;foo method&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 优化后:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">bar</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// foo method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;foo method&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">////////////////////////////////////////////</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 优化 - 去除虚拟化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">IFoo</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">bar</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Foo</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">IFoo</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token comment" style="color:rgb(0, 128, 0)">// IFoo 只有这一个实现</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">bar</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     </span><span class="token comment" style="color:rgb(0, 128, 0)">// bar method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Demo</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">exec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">IFoo</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        foo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">bar</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 优化后:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 当 jvm 发现 只有 Foo 实现了 IFoo, 会如下优化: 直接把 bar() 的实现代码移到 exec() 中去</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">exec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">IFoo</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// bar method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">////////////////////////////////////////////////////</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 优化 - 冗余削除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">final</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Log</span><span class="token plain"> log </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">final</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">boolean</span><span class="token plain"> isDebug </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> log</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">isDebugEnable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">exec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">isDebug</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        log</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">debug</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;...&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// do sth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 优化后:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// isDebug 为 false 才会优化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">exec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// do sth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 这类优化也是为什么有的代码编写规范规定: 不要直接使用 log.debug(), 而要先判断 debug 是否开启; </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 这样可以提高代码性能</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4332-server-compiler">4.3.3.2. server compiler<a href="#4332-server-compiler" class="hash-link" aria-label="4.3.3.2. server compiler的直接链接" title="4.3.3.2. server compiler的直接链接">​</a></h4><p>又称为 <code>C2编译</code>, 重量级, 内存占用较多, 适合服务器端应用</p><p>和 c1编译 主要的不同在于: 寄存器分配策略and优化范围不同</p><p><code>逃逸分析</code>是C2编译优化的基础, 基于 逃逸分析, 有这些优化手段: (逃逸分析: <a href="http://www.importnew.com/23150.html" target="_blank" rel="noopener noreferrer">http://www.importnew.com/23150.html</a>) ------ 逃逸分析的基本行为就是分析对象动态作用域：当一个对象在方法中被定义后，它可能被外部方法所引用，例如作为调用参数传递到其他地方中，称为方法逃逸</p><ul><li>标量替换 (聚合量替换为标量) - 将 <code>对象</code> 代码替换为 <code>属性</code> 代码的形式; 好处: 由于逃逸变量被其内部属性替换, 可节省内存; 而且代码执行时无需去找逃逸对象的引用, 会更快一点</li><li>栈上分配 - 如果 变量 没有逃逸, C2 会直接在 栈上创建这个变量代表的对象 好处: 访问更加快速; 随着方法执行结束, 对象也自动销毁了, 减轻了垃圾回收的压力</li><li>同步削除 (这里的 &quot;同步&quot; 是名词) - 如果发现同步的对象没有逃逸, 也就没有同步的必要了, C2编译时会直接去掉同步</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 标量替换</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token class-name" style="color:rgb(38, 127, 153)">Point</span><span class="token plain"> point </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Point</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token class-name" style="color:rgb(38, 127, 153)">Sysout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;point的x坐标为: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> point</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;, point 的y坐标为: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> point</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 优化后: (point 在代码中没有被直接使用, 只是使用了内部的属性)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token class-name" style="color:rgb(38, 127, 153)">Sysout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;point的x坐标为: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;, point 的y坐标为: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 同步削除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 就是 去掉 代码同步 synchronized</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="434-反射执行">4.3.4. 反射执行<a href="#434-反射执行" class="hash-link" aria-label="4.3.4. 反射执行的直接链接" title="4.3.4. 反射执行的直接链接">​</a></h3><p>典型如 mvc 框架</p><p>反射代码中， <code>getMethod()</code> 比较消耗性能(背后需要进行方法权限校验, 所有方法的扫描, Method 对象的复制), 所以 得到的 Method 对象最好缓存</p><h1>5. java中的关键字和内存的关系</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51-final">5.1. final<a href="#51-final" class="hash-link" aria-label="5.1. final的直接链接" title="5.1. final的直接链接">​</a></h2><p><a href="https://blog.csdn.net/Ditto_zhou/article/details/78738197" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/Ditto_zhou/article/details/78738197</a></p><p>final如果用来表示数据变量的话，通常是指该变量被赋值一次，就不能改变；如果这个final变量是复杂类型， 变量内部数据仍然可变</p><p>写final变量时的重排序特性：如果一个类中定义了final变量， 那么针对这个变量的write操作<code>不会被重排序到构造函数之外</code> ------相反的, 普通变量可能被重排序到构造函数之外</p><p>结论就是: 在一个对象的引用对一个线程可见前，能保证final变量被正确初始化，而普通域不具有这个特性，因为普通域的写入可能会重排序到构造函数外.也就是在多线程环境下，拿到一个对象的引用后，可能会出现它的普通属性的变量还没有被正确初始化的情况.</p><p>读取final变量时的重排序: 读取一个包含final变量的对象的引用和随后读取这个final变量，不能重排序</p><p>另外, 如果匿名内部类访问了外部数据:</p><ul><li>如果访问的是局部变量(方法内部的变量), 数据存在于线程栈上, 变量无法进行共享, 匿名内部类无法获得这个变量, 只能通过值传递(拷贝)的方式传递到匿名内部类中 ---- 匿名内部类和外部类中的数据无法自动同步；类似js中的闭包， 但是js中的闭包可以自动同步内外变量；</li><li>如果这个外部数据是成员变量, 对应的在虚拟机里是在堆的位置, 变量可以共享, 因此在创建匿名内部类的对象时无需拷贝, 直接通过 this.xxx 即可获取；</li></ul><p>因此可以得出结论：匿名内部类来自外部闭包环境的自由变量必须是final的，除非自由变量来自类的成员变量。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52-volatile">5.2. volatile<a href="#52-volatile" class="hash-link" aria-label="5.2. volatile的直接链接" title="5.2. volatile的直接链接">​</a></h2><p>一条thread每次对变量进行修改都会立即刷新到堆内存中被其他thread看到;</p><p>其他所有 thread 暂存的该变量都失效, 需要到堆内存重新获取</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="53-synchronized">5.3. synchronized<a href="#53-synchronized" class="hash-link" aria-label="5.3. synchronized的直接链接" title="5.3. synchronized的直接链接">​</a></h2><p>一条thread进入synchronized代码块, 会获取目标对象的锁</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="54-static">5.4. static<a href="#54-static" class="hash-link" aria-label="5.4. static的直接链接" title="5.4. static的直接链接">​</a></h2><h1>6. java的内存泄露</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="61-会造成哪些溢出">6.1. 会造成哪些溢出<a href="#61-会造成哪些溢出" class="hash-link" aria-label="6.1. 会造成哪些溢出的直接链接" title="6.1. 会造成哪些溢出的直接链接">​</a></h2><p>内存泄露会造成 &quot;溢出&quot;, 堆溢出, 栈溢出, 方法区溢出</p><p>堆溢出: 典型如不断往一个集合中添加对象, 直到堆溢出, 但是由于 GC,现在不成问题了</p><p>方法区溢出: 运行时动态生成大量类 (反射, cglib), 方法区不够用了</p><p>栈溢出: 方法递归调用,没有退出条件; or 内存对象明明已经不需要的时候，还仍然保留着这块内存和它的访问方式（引用）, 造成无法 GC, 比如弹栈时没有将栈中的元素赋值为null;</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Heap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">String</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name" style="color:rgb(38, 127, 153)">ArrayList</span><span class="token plain"> list</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">ArrayList</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">while</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            list</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Heap</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">////////////////////////</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Stack</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">String</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token comment" style="color:rgb(0, 128, 0)">//java.lang.StackOverflowError</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Stack</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">test</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">test</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token function" style="color:rgb(0, 0, 255)">test</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="62-java内存泄露引起原因">6.2. Java内存泄露引起原因<a href="#62-java内存泄露引起原因" class="hash-link" aria-label="6.2. Java内存泄露引起原因的直接链接" title="6.2. Java内存泄露引起原因的直接链接">​</a></h2><p>静态集合类引起内存泄露 (静态变量的生命周期和应用程序一致，他们所引用的所有的对象Object也不能被释放)</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token class-name" style="color:rgb(38, 127, 153)">Static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Vector</span><span class="token plain"> v </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Vector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token plain"> o </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    v</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">o</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    o </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 释放无效</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当集合里面的对象属性被修改后，再调用remove（）方法时不起作用</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">String</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token class-name" style="color:rgb(38, 127, 153)">Set</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token generics class-name" style="color:rgb(38, 127, 153)">Person</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> set </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">HashSet</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token generics class-name" style="color:rgb(38, 127, 153)">Person</span><span class="token generics punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token class-name" style="color:rgb(38, 127, 153)">Person</span><span class="token plain"> p1 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Person</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;唐僧&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;pwd1&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token class-name" style="color:rgb(38, 127, 153)">Person</span><span class="token plain"> p2 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Person</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;孙悟空&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;pwd2&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token number" style="color:rgb(9, 134, 88)">26</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token class-name" style="color:rgb(38, 127, 153)">Person</span><span class="token plain"> p3 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Person</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;猪八戒&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;pwd3&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">p1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">p2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">p3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;总共有:&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token string" style="color:rgb(163, 21, 21)">&quot; 个元素!&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//结果：总共有:3 个元素!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">p3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">setAge</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//修改p3的年龄,此时p3元素对应的hashcode值发生改变</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">remove</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">p3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//此时remove不掉，造成内存泄漏</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">p3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//重新添加，居然添加成功</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;总共有:&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token string" style="color:rgb(163, 21, 21)">&quot; 个元素!&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//结果：总共有:4 个元素!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">Person</span><span class="token plain"> person </span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">person</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>各种连接: 比如数据库连接（dataSourse.getConnection()），网络连接(socket)和io连接，除非其显式的调用了其close（）方法将其连接关闭，否则是不会自动被GC 回收的。对于Resultset 和Statement 对象可以不进行显式回收，但Connection 一定要显式回收，因为Connection 在任何时候都无法自动回收，而Connection一旦回收，Resultset 和Statement 对象就会立即为NULL。但是如果使用连接池，情况就不一样了，除了要显式地关闭连接，还必须显式地关闭Resultset Statement 对象</p><p>单例模式: 若单例对象持有外部对象的引用，那么这个外部对象将不能被jvm正常回收，导致内存泄露</p><h1>7. jvm 中的 object</h1><p>HotSpot 虚拟机在 Java 堆中对象创建、布局和访问的全过程。reference: <a href="https://juejin.im/post/5b7d69e4e51d4538ca5730cb" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5b7d69e4e51d4538ca5730cb</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="71-对象的创建过程内存怎么分配">7.1. 对象的创建过程(内存怎么分配)<a href="#71-对象的创建过程内存怎么分配" class="hash-link" aria-label="7.1. 对象的创建过程(内存怎么分配)的直接链接" title="7.1. 对象的创建过程(内存怎么分配)的直接链接">​</a></h2><ul><li>类加载检查 - 检查类是否已经加载过, 如果没有需要先加载类</li><li>分配内存 - 为新建对象分配内存 (即将一块确定大小的内存块从 Heap 中划分出来, 对象耗费内存大小在类加载后可以得知); 分配方式: &quot;指针碰撞&quot;, &quot;空闲散列&quot; . 选择那种分配方式由<code> Java 堆是否规整</code>(是否有内存碎片)决定，而Java堆是否规整又由<code>所采用的垃圾收集器是否带有压缩整理功能</code>决定。</li><li>初始化0值 - 给对象实例的属性赋零值</li><li>设置对象头 - 虚拟机要对对象进行必要的设置, 保证对象和类能够联系起来，例如这个<code>对象是那个类的实例</code>、<code>如何才能找到类的元数据信息</code>、对象的哈希吗、对象的 GC 分代年龄等信息。 这些信息存放在对象头中。 另外，根据虚拟机当前运行状态的不同，如是否启用偏向锁等，对象头会有不同的设置方式。</li><li>执行官init方法 - 把对象按照程序员的意愿进行初始化</li></ul><p>给新建对象分配内存的两种方式:</p><ul><li>指针碰撞 - 用过的内存和空白内存分开, 中间有分界指针, 分配时, 指针向空白内存方向移动&quot;新建对象&quot;大小的位置即可</li><li>空闲列表 - 虚拟机维护一个列表, 记录哪些空白内存, 分配时, 从中找到一块合适的内存分给对象实例, 同时更新这个列表 </li></ul><p><code>内存分配怎么防止并发问题</code>: TLAB (thread local allocation buffer) -&gt; 为每一个线程预先在new generation 区域的 Eden区分配的一块儿内存 (可通过 jvm 参数指定)，JVM在给线程中的对象分配内存时，首先在TLAB分配，当对象大于TLAB中的剩余内存或TLAB的内存已用尽时，再在堆上分配, 采用CAS进行内存分配 ( CAS+失败重试： CAS 是乐观锁的一种实现方式。所谓乐观锁就是，每次不加锁而是假设没有冲突而去完成某项操作，如果因为冲突失败就重试，直到成功为止。虚拟机采用 CAS 配上失败重试的方式保证更新操作的原子性。)</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="72-对象的访问">7.2. 对象的访问<a href="#72-对象的访问" class="hash-link" aria-label="7.2. 对象的访问的直接链接" title="7.2. 对象的访问的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="721-对象的2种访问方式">7.2.1. 对象的2种访问方式<a href="#721-对象的2种访问方式" class="hash-link" aria-label="7.2.1. 对象的2种访问方式的直接链接" title="7.2.1. 对象的2种访问方式的直接链接">​</a></h3><p>目前主流的访问方式有①使用句柄和②直接指针两种：(Java程序通过栈上的 reference 数据来操作堆上的具体对象)</p><ol><li><p>句柄： 如果使用句柄的话，那么<code>Java堆中将会划分出一块内存来作为句柄池</code>，reference 中存储的就是对象的句柄地址，而句柄中包含了<code>对象实例数据</code>(Heap)与<code>类型数据</code>(Method Area)各自的具体地址信息; 好处:  reference 中存储的是稳定的句柄地址，在对象被移动时只会改变句柄中的实例数据指针，而 reference 本身不需要修改</p></li><li><p>直接指针： 如果使用直接指针访问，那么 Java 堆对像的布局中就必须考虑如何防止访问类型数据的相关信息，reference 中存储的直接就是对象的地址。好处: 速度快，它节省了一次指针定位的时间开销</p></li></ol><p>《深入理解java虚拟机》中的示意图:</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="722-thread具体怎么访问对象中的值呢以及volatile关键字">7.2.2. thread具体怎么访问对象中的值呢以及volatile关键字<a href="#722-thread具体怎么访问对象中的值呢以及volatile关键字" class="hash-link" aria-label="7.2.2. thread具体怎么访问对象中的值呢以及volatile关键字的直接链接" title="7.2.2. thread具体怎么访问对象中的值呢以及volatile关键字的直接链接">​</a></h3><p><a href="http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html" target="_blank" rel="noopener noreferrer">http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html</a></p><p>jvm 有一个内存区域是jvm虚拟机栈， 包含一个个的 线程栈（thread stack），每个 thread stack 保存了保存了线程运行时候变量值信息</p><p>当线程访问某一个对象时候值的时候，首先通过对象的引用找到对应在堆内存的变量的值，然后把堆内存变量的具体值load到线程本地内存中，建立一个变量副本，之后线程就不再和对象在堆内存变量值有任何关系，而是直接修改副本变量的值，在修改完之后的某一个时刻（线程退出之前），自动把线程变量副本的值回写到对象在堆中变量</p><ul><li><p>read and load 从主存复制变量到当前工作内存</p></li><li><p>use and assign  执行代码，改变共享变量值 （可反复出现, <code>如果变量加上volatile， 每次线程更新变量后， 会立即将变动后的结果更新到堆内存中的对象中</code>）</p></li><li><p>store and write 用工作内存数据刷新主存相关内容</p></li></ul><p>这一系列操作并非原子性的， 如果一个thread1 读取某个变量后， cpu 被另一个 thread2抢占， 对该变量写入新的值， thread1由于已经加载该变量， 并不会重新加载， 读取了脏数据；</p><p>对于volatile修饰的变量，jvm虚拟机只是保证从主内存加载到线程工作内存的值是最新的， 无法保证线程安全， 比如：</p><p>例如假如线程1，线程2 在进行read,load 操作中，发现主内存中count的值都是5，那么都会加载这个<code>最新的值</code></p><p>在线程1堆count进行修改之后，会write到主内存中，主内存中的count变量就会变为6</p><p>线程2由于已经进行read,load操作，在进行运算之后，也会更新主内存count的变量值为6, 产生了线程安全问题；</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="73-对象回收内存怎么释放">7.3. 对象回收(内存怎么释放)<a href="#73-对象回收内存怎么释放" class="hash-link" aria-label="7.3. 对象回收(内存怎么释放)的直接链接" title="7.3. 对象回收(内存怎么释放)的直接链接">​</a></h2><p>GC 有2种实现方式:</p><ul><li>引用计数收集器 - 每次对象赋值时要进行 &quot;引用计数&quot;的增减, 有一定消耗,, 有时候一个对象被多个其他对象引用 Java中有大量这样的引用, 累计起来消耗不小, sun jdk 未采用这种方式</li><li>跟踪收集器 - 可能会使得应用暂停, 有三种实现算法 ...</li></ul><h1>8. 有哪些虚拟机</h1><p>Hotspot - 目前使用最广泛的</p><p>ZGC - 支持超大堆的同时保证STW很短</p><p>Graal - 一个特制版的的JavaVM。用Java写的JavaVM。能让不同语言跑在同一个VM上，还能互通, 号称全栈vm, 微服务框架Quarkus 给予他</p><h1>9. java线上问题诊断排查</h1><p><a href="https://blog.csdn.net/GitChat/article/details/79019454" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/GitChat/article/details/79019454</a>
<a href="http://ifeve.com/find-bug-online/" target="_blank" rel="noopener noreferrer">http://ifeve.com/find-bug-online/</a>
<a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA4NTg4Njk0Mw==&amp;scene=161#wechat_redirect" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA4NTg4Njk0Mw==&amp;scene=161#wechat_redirect</a></p><p>一般流程如下:</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="91-日志检索">9.1. 日志检索<a href="#91-日志检索" class="hash-link" aria-label="9.1. 日志检索的直接链接" title="9.1. 日志检索的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 检索 exception 关键字或 error 关键字</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># -E 使用正则表达式, 这里可选</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># or 逻辑</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">grep -E &quot;exception|error&quot; app.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 等价</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">egrep &quot;xx&quot; xxx.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># and 逻辑</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">grep -E ‘pattern1.*pattern2’ filename</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">grep -E ‘pattern1.*pattern2|pattern2.*pattern1’ filename</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># not 逻辑</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">grep -v ‘pattern1’ filename</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 显示关键字上下 10 行日志</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">grep -C 10 exception app.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 检索 2020-05-05 19:23~25  分钟段日志</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">grep &#x27;2020-05-05 19:2[3-5]&#x27; app.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sed -n &#x27;/2020-05-05 19:23/,/2020-05-05 19:25/p&#x27; app.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 检索 2020-05-05 19:23:10~15 秒段日志</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">grep &#x27;2020-05-05 19:23:[10-15]&#x27; app.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sed -n &#x27;/2020-05-05 19:23:10/,/2020-05-05 19:23:15/p&#x27; app.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查询 /data 目录下大于 500m 的文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">find /data -type f -size +500M</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="92-查看数据库连接">9.2. 查看数据库连接<a href="#92-查看数据库连接" class="hash-link" aria-label="9.2. 查看数据库连接的直接链接" title="9.2. 查看数据库连接的直接链接">​</a></h2><p>show processlist, 查看当前数据库的连接情况。确实因为慢查询造成。须要手动kill</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="93-查看cpu-负载">9.3. 查看CPU 负载<a href="#93-查看cpu-负载" class="hash-link" aria-label="9.3. 查看CPU 负载的直接链接" title="9.3. 查看CPU 负载的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="931-cpu-user高-and--cpu-load-高">9.3.1. CPU User高 and  CPU Load 高<a href="#931-cpu-user高-and--cpu-load-高" class="hash-link" aria-label="9.3.1. CPU User高 and  CPU Load 高的直接链接" title="9.3.1. CPU User高 and  CPU Load 高的直接链接">​</a></h3><p>(User：CPU 在用户态空间（用户进程）的运行时间比例)</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="9311-代码中存在非常消耗-cpu-的操作">9.3.1.1. 代码中存在非常消耗 CPU 的操作<a href="#9311-代码中存在非常消耗-cpu-的操作" class="hash-link" aria-label="9.3.1.1. 代码中存在非常消耗 CPU 的操作的直接链接" title="9.3.1.1. 代码中存在非常消耗 CPU 的操作的直接链接">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">#找出对应的 Java 进程 pid</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ps -ef | grep java </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#找出 Java 进程中最消耗 CPU 的进程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">top -H -p &lt;pid&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jstack 获取 Java 的线程堆栈</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jstack ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 将找出的线程 id 转换为 16 进制</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 根据 16 进制的 id 从线程堆栈中找到相关的堆栈信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">printf &quot;%x\n&quot; pid</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="9312-频繁gc">9.3.1.2. 频繁gc<a href="#9312-频繁gc" class="hash-link" aria-label="9.3.1.2. 频繁gc的直接链接" title="9.3.1.2. 频繁gc的直接链接">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">jstat -gcutil pid interval(ms)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="932-cpu-system-高-and-cpu-load-高">9.3.2. CPU System 高 and CPU Load 高<a href="#932-cpu-system-高-and-cpu-load-高" class="hash-link" aria-label="9.3.2. CPU System 高 and CPU Load 高的直接链接" title="9.3.2. CPU System 高 and CPU Load 高的直接链接">​</a></h3><p>System：CPU 在内核态空间的运行时间比例。例如内存分配、IO 读写、线程创建和切换等</p><p>常见原因：</p><ul><li>并发锁竞争严重</li><li>死锁</li><li>线程频繁切换 (线程池里的线程数配置太多了)</li></ul><p>排查方法:</p><ul><li><p>jstack 打印线程堆栈，整体统计线程状态，如 WAITING、TIMED_WAITING、BLOCKED</p></li><li><p>pidstat -w 可以查看 CPU 上下文切换的状态。</p><p>  cswch/s 每秒自愿上下文切换次数：进程无法获取资源，如内存、IO 等；</p><p>  nvcswch/s 每秒非自愿上下文切换次数：时间片耗尽系统强制调度，如进程频繁争抢 CPU。</p></li></ul><p>如何优化:</p><ul><li>减小锁粒度, 使用无锁数据结构</li><li>检查死锁, 使用 给锁设置等待时间</li><li>修改线程池配置</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="933-cpu-wait高-and-cpu-load高-and-cpu利用率低">9.3.3. CPU Wait高 and CPU Load高 and CPU利用率低<a href="#933-cpu-wait高-and-cpu-load高-and-cpu利用率低" class="hash-link" aria-label="9.3.3. CPU Wait高 and CPU Load高 and CPU利用率低的直接链接" title="9.3.3. CPU Wait高 and CPU Load高 and CPU利用率低的直接链接">​</a></h3><p>说明CPU 等待磁盘写入的时间长。当 CPU 发起 IO 读写操作后，需要等待磁盘数据加载至内存</p><p>可能原因是:</p><ul><li>IO 操作频繁</li><li>资源未及时释放造成泄漏</li></ul><p>排查方法:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 查看设备的 IO 状态</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iostat -x 2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">参数含义：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rrqm/s : 每秒合并读操作的次数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wrqm/s: 每秒合并写操作的次数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">r/s ：每秒读操作的次数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">w/s : 每秒写操作的次数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rKB/s :每秒读取字节数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wKB/s: 每秒写入字节数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">avgrq-sz：平均每次 IO 的数据大小，以扇区（512字节）为单位</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">avgqu-sz：平均 IO 请求队列长度</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">await：平均每个IO所需要的时间，包括在队列等待的时间和请求处理的时间。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">r_wait：每个读操作平均所需要的时间，包括硬盘设备读操作的时间 + 内核队列中的时间。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">w_wait: 每个写操平均所需要的时间，包括硬盘设备写操作的时间 + 队列中等待的时间。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">%util: 每秒内用于 I/O 操作的时间占比</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查找引起 iowait 高的进程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iotop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iostat -m 1 10</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-m：某些使用block为单位的列强制使用MB为单位</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1 10：数据显示每隔1秒刷新一次。共显示10次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查看引起 iowait 高的具体文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">lsof -p &lt;pid&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>优化方法:</p><ul><li>有效控制资源数量，例如使用线程池等。</li><li>了解磁盘特性是必要的，一般随机写转顺序写，同步写转异步写，IO 合并都可以得到较好的改善。</li><li>压缩 &amp; Dirty Page 优化。Linux 操作系统中，当 Dirty Page 的大小达到总物理内存大小 10%，操作系统会进行刷盘但不阻塞系统调用的写线程，若达到物理内存大小的 20%，写线程会被阻塞。通过合适的压缩算法减少落盘数据的大小通常效果显著。</li><li>预读取和读缓存。</li><li>Zero Copy。</li><li>MMap 内存映射。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="94-查内存">9.4. 查内存<a href="#94-查内存" class="hash-link" aria-label="9.4. 查内存的直接链接" title="9.4. 查内存的直接链接">​</a></h2><p>内存占用高, 可能是内存泄漏</p><p>通过 内存映像分析工具分析 dump 文件,  看看是 memory leak 还是 memory overflow</p><ul><li><p>memory leak: 证明有无法回收的Object, 查看 leak Object 到 gc roots的引用链, 定位leak代码</p></li><li><p>memory overflow: 查看 -Xms, -Xmx 是否可以增大, 代码上查看对象是否生命周期过长</p></li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 内存整体情况</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">free -m </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">free -m -c10 -s1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-m：以MB为单位显示。其它的有-k -g -b</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s: 间隔多少秒持续观察内存使用状况</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-c:观察多少次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vmstat 1 10</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1表示每隔1s输出一次,10 表示输出10次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># JVM 堆内存占用排行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jmap -histo &lt;pid&gt; | head -n 30</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># JVM 内存占用信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jstat -gccause &lt;pid&gt; 1000 1000</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jstat -gcutil &lt;pid&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># dump内存</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jmap -F -dump:live,file=/home/admin/heap.bin &lt;pid&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="95-排查垃圾回收问题">9.5. 排查垃圾回收问题<a href="#95-排查垃圾回收问题" class="hash-link" aria-label="9.5. 排查垃圾回收问题的直接链接" title="9.5. 排查垃圾回收问题的直接链接">​</a></h2><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="96-网络问题">9.6. 网络问题<a href="#96-网络问题" class="hash-link" aria-label="9.6. 网络问题的直接链接" title="9.6. 网络问题的直接链接">​</a></h2><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">netstat </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">antp </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token function" style="color:rgb(0, 0, 255)">a</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">all</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">显示全部选项。默认不显示</span><span class="token constant" style="color:rgb(129, 31, 63)">LISTEN</span><span class="token plain">相关</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token function" style="color:rgb(0, 0, 255)">t</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tcp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">仅显示tcp相关选项</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token function" style="color:rgb(0, 0, 255)">u</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">udp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">仅显示udp相关选项</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n 拒绝显示别名，能显示数字的所有转化成数字。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">l 仅列出有在 </span><span class="token function maybe-class-name" style="color:rgb(0, 0, 255)">Listen</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">监听</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> 的服服务状态</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">p 显示建立相关链接的程序名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>10. jdk 自带命令行工具</h1><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">jps </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">l</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">列出jvm中的进程</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 主类</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jstat</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 监视jvm内存变化</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> gc情况</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jinfo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 查询jvm配置信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jmap</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 生成Java heap 快照</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jhat</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 分析 </span><span class="token maybe-class-name">Java</span><span class="token plain"> heap 快照</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 可在生产机器上直接访问分析结果html</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jstack</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 生成线程快照</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 用于分析线程停顿</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 如死锁</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">可视化工具</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token maybe-class-name">Jconsole</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 内存</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 线程监控</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token maybe-class-name">VirtualVM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 监控</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 性能分析</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 基于插件</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="101-java-启动-javac-编译-javap-反编译">10.1. java 启动 javac 编译 javap 反编译<a href="#101-java-启动-javac-编译-javap-反编译" class="hash-link" aria-label="10.1. java 启动 javac 编译 javap 反编译的直接链接" title="10.1. java 启动 javac 编译 javap 反编译的直接链接">​</a></h2><p>1、不带任何可选参数(如果字节码文件就位于当前工作目录，可以不写类的包名)：</p><p>实际上等同于 javap -package Person
javap Person</p><p>2、反汇编指定目录下的字节码文件：</p><p>javap -classpath D:/java/lib cn.softown.Person</p><p>3、反汇编字节码文件为 JVM 可以识别、执行的字节码命令：</p><p>javap -c Person</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="102-jstack">10.2. jstack<a href="#102-jstack" class="hash-link" aria-label="10.2. jstack的直接链接" title="10.2. jstack的直接链接">​</a></h2><p>打印线程快照， 用于分析线程停顿, 如死锁</p><p>线程快照是当前 java 虚拟机内每一条线程正在执行的方法堆栈的集合，</p><p>生成线程快照的主要目的是定位线程出现长时间停顿的原因, 一般打印三次 dump，看看没有响应的线程到底在后台做什么事情，如线程间死锁、死循环、请求外部资源导致的长时间等待等。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 默认输出 控制台</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jstack 1102</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>dump 文件分析:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 有一些 jvm 的 daemon thread，如 gc，低内存检测， 不关注</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token string" style="color:rgb(163, 21, 21)">&quot;VM Thread&quot;</span><span class="token plain"> os_prio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> tid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x0000000018167000</span><span class="token plain"> nid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0xfccc</span><span class="token plain"> runnable</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token string" style="color:rgb(163, 21, 21)">&quot;GC task thread#0 (ParallelGC)&quot;</span><span class="token plain"> os_prio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> tid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x000000000352a000</span><span class="token plain"> nid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x121b4</span><span class="token plain"> runnable</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token string" style="color:rgb(163, 21, 21)">&quot;GC task thread#1 (ParallelGC)&quot;</span><span class="token plain"> os_prio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> tid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x000000000352c000</span><span class="token plain"> nid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x12168</span><span class="token plain"> runnable</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token string" style="color:rgb(163, 21, 21)">&quot;GC task thread#2 (ParallelGC)&quot;</span><span class="token plain"> os_prio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> tid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x000000000352d800</span><span class="token plain"> nid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x121d0</span><span class="token plain"> runnable</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token string" style="color:rgb(163, 21, 21)">&quot;GC task thread#3 (ParallelGC)&quot;</span><span class="token plain"> os_prio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> tid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x0000000003530000</span><span class="token plain"> nid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x115d4</span><span class="token plain"> runnable</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token string" style="color:rgb(163, 21, 21)">&quot;VM Periodic Task Thread&quot;</span><span class="token plain"> os_prio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> tid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x0000000019621000</span><span class="token plain"> nid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x137b0</span><span class="token plain"> waiting on condition</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 关注u用户级别的 thread</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token maybe-class-name">Runnable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token maybe-class-name">Wait</span><span class="token plain"> on condition  线程等待某个条件的发生</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        常见的情况是线程在等待网络的读写，比如当网络数据没有准备好读时，线程处于这种等待状态，如果发现有大量的线程都在处在 </span><span class="token maybe-class-name">Wait</span><span class="token plain"> on condition 可能是一个网络瓶颈的征兆。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 一种情况是网络非常忙，几 乎消耗了所有的带宽，仍然有大量数据等待网络读 写</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> 另一种情况也可能是网络空闲，但由于路由等问题，导致包无法正常的到达</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        这时可以 netstat统计单位时间的发送包的数目</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 可以观察 cpu的利用率，如果系统态的 </span><span class="token constant" style="color:rgb(129, 31, 63)">CPU</span><span class="token plain">时间，相对于用户态的 </span><span class="token constant" style="color:rgb(129, 31, 63)">CPU</span><span class="token plain">时间比例较高会是网络瓶颈</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        外一种出现 </span><span class="token maybe-class-name">Wait</span><span class="token plain"> on condition的常见情况是该线程在 sleep，等待 sleep的时间到了时候，将被唤醒</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token maybe-class-name">Waiting</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> monitor entry 线程等待获取锁， 以便进入临界区， 一般是使用了 synchronizd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        如果在多线程的程序中，大量使用 synchronized，或者不适当的使用了它，会造成大量线程在临界区的入口等待，造成系统的性能大幅下降。如果在线程 </span><span class="token constant" style="color:rgb(129, 31, 63)">DUMP</span><span class="token plain">中发现了这个情况，应该审查源码，改进程序。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">wait</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> 线程释放锁， 等待再次获取锁</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        当线程获得了 </span><span class="token maybe-class-name">Monitor，进入了临界区之后，如果发现线程继续运行的条件没有满足，它则调用对象（一般就是被</span><span class="token plain"> synchronized 的对象）的 </span><span class="token function" style="color:rgb(0, 0, 255)">wait</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> 方法，放弃了 </span><span class="token maybe-class-name">Monitor，进入</span><span class="token plain"> “Wait </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Set</span><span class="token plain">”队列。只有当别的线程在该对象上调用了 </span><span class="token function" style="color:rgb(0, 0, 255)">notify</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> 或者 </span><span class="token function" style="color:rgb(0, 0, 255)">notifyAll</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> ， “ </span><span class="token maybe-class-name">Wait</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Set</span><span class="token plain">”队列中线程才得到机会去竞争</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 处理 http 的 thread， tomcat 开了一个 thread pool， 包括 http</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">nio</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">8090</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">exec</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">，</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">，</span><span class="token number" style="color:rgb(9, 134, 88)">3.</span><span class="token plain">。。</span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 可以看到 thread state 为 waiting，调用栈，当前锁住的资源 </span><span class="token number" style="color:rgb(9, 134, 88)">0x000000001d7ee000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token string" style="color:rgb(163, 21, 21)">&quot;http-nio-8090-exec-1&quot;</span><span class="token plain"> #</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> daemon prio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> os_prio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> tid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x000000001bc9d800</span><span class="token plain"> nid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x13af4</span><span class="token plain"> waiting on condition </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0x000000001d7ee000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">lang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">Thread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">State</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">WAITING</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">parking</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at sun</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">misc</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">Unsafe</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">park</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">Native</span><span class="token plain"> </span><span class="token maybe-class-name">Method</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> parking to wait </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">for</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token number" style="color:rgb(9, 134, 88)">0x00000000db266038</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">concurrent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">locks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">AbstractQueuedSynchronizer$ConditionObject</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">concurrent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">locks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">LockSupport</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">park</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">LockSupport</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">175</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">concurrent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">locks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">AbstractQueuedSynchronizer$ConditionObject</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">await</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">AbstractQueuedSynchronizer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">2039</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">concurrent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">LinkedBlockingQueue</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">take</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">LinkedBlockingQueue</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">442</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at org</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">apache</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">tomcat</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">threads</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">TaskQueue</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">take</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">TaskQueue</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">107</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at org</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">apache</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">tomcat</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">threads</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">TaskQueue</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">take</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">TaskQueue</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">33</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">concurrent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">ThreadPoolExecutor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getTask</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">ThreadPoolExecutor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">1067</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">concurrent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">ThreadPoolExecutor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">runWorker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">ThreadPoolExecutor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">1127</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">concurrent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">ThreadPoolExecutor$Worker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">ThreadPoolExecutor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">617</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at org</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">apache</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">tomcat</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">threads</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">TaskThread$WrappingRunnable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">TaskThread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">61</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">lang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">Thread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">Thread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">745</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 这是一个进入 临界区， 又退出临界区的线程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 比如，在程序中，有多个服务线程，设计成从一个队列里面读取请求数据。这个队列就是 lock以及 waiting on的对象。当队列为空的时候，这些线程都会在这个队列上等待，直到队列有了数据，这些线程被 </span><span class="token maybe-class-name">Notify，当然只有一个线程获得了</span><span class="token plain"> lock，继续执行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Thread-1&quot;</span><span class="token plain"> prio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> tid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x08223250</span><span class="token plain"> nid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0xa</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">wait</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0xef47a000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">0xef47aa38</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">lang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">wait</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">Native</span><span class="token plain"> </span><span class="token maybe-class-name">Method</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> waiting on </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token number" style="color:rgb(9, 134, 88)">0xef63beb8</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">ArrayList</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> # 在 临界区调用 obj</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">wait</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">，等待在这个对象上， 释放锁</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">lang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">wait</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">474</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at testthread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">MyWaitThread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">MyWaitThread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> locked </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token number" style="color:rgb(9, 134, 88)">0xef63beb8</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">ArrayList</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> #  用 synchronized 获得了这个对象的 锁</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        at java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">lang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">Thread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">Thread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">595</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 死锁</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Thread-1&quot;</span><span class="token plain"> prio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> tid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x00acc490</span><span class="token plain"> nid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0xe50</span><span class="token plain"> waiting </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> monitor entry </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0x02d3f000</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">0x02d3fd68</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    at deadlockthreads</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">TestThread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">TestThread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">31</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> waiting to lock </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token number" style="color:rgb(9, 134, 88)">0x22c19f18</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">lang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  # 等待获取 </span><span class="token number" style="color:rgb(9, 134, 88)">0x22c19f18</span><span class="token plain"> 锁</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> locked </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token number" style="color:rgb(9, 134, 88)">0x22c19f20</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">lang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  # 持有 </span><span class="token number" style="color:rgb(9, 134, 88)">0x22c19f20</span><span class="token plain"> 锁</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Thread-0&quot;</span><span class="token plain"> prio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> tid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0x00accdb0</span><span class="token plain"> nid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0xdec</span><span class="token plain"> waiting </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> monitor entry </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0x02cff000</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">0x02cff9e8</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    at deadlockthreads</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">TestThread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">TestThread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">java</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">31</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> waiting to lock </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token number" style="color:rgb(9, 134, 88)">0x22c19f20</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">lang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> locked </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token number" style="color:rgb(9, 134, 88)">0x22c19f18</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">lang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 热锁：由于多个线程对临界区，或者锁的竞争，可能出现 频繁的线程的上下文切换， 进而造成 大部分 </span><span class="token constant" style="color:rgb(129, 31, 63)">CPU</span><span class="token plain">开销用在 “系统态 ”</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 表现为 大多数的线程状态都是 </span><span class="token maybe-class-name">Waiting</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> monitor entry或者 </span><span class="token maybe-class-name">Wait</span><span class="token plain"> on monitor</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">我们曾经遇到过这样的例子，程序运行时，出现了以上指出的各种现象，通过观察操作系统的资源使用统计信息，以及线程 </span><span class="token constant" style="color:rgb(129, 31, 63)">DUMP</span><span class="token plain">信息，确定了程序中热锁的存在，并发现大多数的线程状态都是 </span><span class="token maybe-class-name">Waiting</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> monitor entry或者 </span><span class="token maybe-class-name">Wait</span><span class="token plain"> on monitor，且是阻塞在压缩和解压缩的方法上。后来采用第三方的压缩包 javalib替代 </span><span class="token constant" style="color:rgb(129, 31, 63)">JDK</span><span class="token plain">自带的压缩包后，系统的性能提高了几倍。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="103-jcmd">10.3. jcmd<a href="#103-jcmd" class="hash-link" aria-label="10.3. jcmd的直接链接" title="10.3. jcmd的直接链接">​</a></h2><p>用于向正在运行的 JVM 发送诊断命令请求。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 单独不带参数使用</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 返回 pid mainClass cli—args</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 类似 jps</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jcmd [-l]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 向指定进程 发送 诊断命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jcmd 11022 name=\&quot;Value of name argument\&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 向多个有相同 main class  的进程 发送命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jcmd com.xxx.AppClass name=\&quot;Value of name argument\&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 打印性能参数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jcmd 1102 PerfCounter.print</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 从指定 file 读取命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jcmd 1102 -f xxx_file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="104-jps">10.4. jps<a href="#104-jps" class="hash-link" aria-label="10.4. jps的直接链接" title="10.4. jps的直接链接">​</a></h2><p>本地当前用户所有运行的 java 进程/jvm 实例</p><p>jps 命令有个地方很不好，似乎只能显示当前用户的 java 进程，要显示其他用户的还是只能用 unix/linux 的 ps 命令。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># pid, mainClass</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jps</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># pid</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jps -q</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 传递给 main class 的参数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jps -m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># main class 完整 package path</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jps -l</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 输出传递给JVM的参数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jps -v</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 列出远程服务器192.168.0.77机器所有的jvm实例，采用rmi协议，默认连接端口为1099（前提是远程服务器提供jstatd服务）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jps 192.168.0.77</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="105-jstat">10.5. jstat<a href="#105-jstat" class="hash-link" aria-label="10.5. jstat的直接链接" title="10.5. jstat的直接链接">​</a></h2><p>虚拟机统计监控工具。可以用于服务性能优化。重要</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># -class，监控什么数据， 这里是监控 class 加载情况</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    -class：统计class loader行为信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    -compile：统计编译行为信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    -gc：统计jdk gc时heap信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    -gccapacity：统计不同的generations（不知道怎么翻译好，包括新生区，老年区，permanent区）相应的heap容量情况</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    -gccause：统计gc的情况，（同-gcutil）和引起gc的事件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    -gcnew：统计gc时，新生代的情况</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    -gcnewcapacity：统计gc时，新生代heap容量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    -gcold：统计gc时，老年区的情况</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    -gcoldcapacity：统计gc时，老年区heap容量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    -gcpermcapacity：统计gc时，permanent区heap容量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    -gcutil：统计gc时，heap情况</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    -printcompilation：不知道干什么的，一直没用过。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># -t，显示 timestamp 列</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># -h3，每n次打印一次 表格 title</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 55912，进程id</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 1000（ms），每1000ms监控打印一次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 100，共打印多少次（不写的话就是一直打印下去）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jstat -class -t -h3 55912 1000 100</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 结果列：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># timestamp，-t的输出结果</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># loaded，已加载的类数量（真多。。很多都是动态代理的）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># bytes，已加载的类总大小</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># unloaded，已卸载的类数量（多态代理的情况下，是可以卸载类的）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># bytes，已卸载的类总大小</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># time，classLoader操作类的总耗时</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># jit 情况</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jstat -compiler -t -h3 55912 1000 100</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 监控 gc 情况</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jstat -gc -t -h3 55912 1000 100</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 结果列：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># S01,S1C,S0U,S1U from，to的大小和已用量大小(KB)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># EC,EU eden的大小和已用量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># OC,OU 老边代的大小和已用量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># MC,MU 永久区大小和已用量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># CCSC,CCSU 压缩类空间大小和已用量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># YGC,YGCT: 新生代GC次数和耗时</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># FGC,FGCT: Full GC次数和耗时</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># GCT GC总耗时</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查看gc原因以及各个分代的百分信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jstat -gccapacity -t -h3 55912 1000 100</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 结果列</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># S0 ：年轻代中第一个survivor（幸存区）已使用的占当前容量百分比</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># S1 ：年轻代中第二个survivor（幸存区）已使用的占当前容量百分比</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># E ：年轻代中Eden（伊甸园）已使用的占当前容量百分比</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># O ：old代已使用的占当前容量百分比</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># M ：元空间已使用的占当前容量百分比</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># CCS： 压缩</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># YGC ：从应用程序启动到采样时年轻代中gc次数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># YGCT ：从应用程序启动到采样时年轻代中gc所用时间(s)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># FGC ：从应用程序启动到采样时old代(全gc)gc次数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># FGCT ：从应用程序启动到采样时old代(全gc)gc所用时间(s)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># GCT：从应用程序启动到采样时gc用的总时间(s)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># LGCC：最后一次GC原因</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># GCC：当前GC原因（No GC 为当前没有执行GC）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="106-jvisualvm">10.6. jvisualvm<a href="#106-jvisualvm" class="hash-link" aria-label="10.6. jvisualvm的直接链接" title="10.6. jvisualvm的直接链接">​</a></h2><p>检测 java 内存 的变化情况，下载内存快照, 可用于排查内存泄露, </p><p>垃圾回收查看</p><p>CPU 占用</p><p>线程分析 : 绿色(运行, 正在运行的 thread), 紫色(休眠, 调用 sleep 的 thread), 黄色(等待, 调用 object.wait 的 thread), 驻留(线程池中的空闲线程), 监视(正在阻塞/等待锁的 thread)</p><p>是 jconsole 升级版</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="107-jconsole">10.7. jconsole<a href="#107-jconsole" class="hash-link" aria-label="10.7. jconsole的直接链接" title="10.7. jconsole的直接链接">​</a></h2><p>图形监控界面， 类似 jvisualvm</p><p>不要 生产环境使用, 因为会对应用有性能影响</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="108-jhat">10.8. jhat<a href="#108-jhat" class="hash-link" aria-label="10.8. jhat的直接链接" title="10.8. jhat的直接链接">​</a></h2><p>JDK 自带的 Java 堆内存分析工具。</p><p>jhat 命令解析一个 java heap dump 文件并启动一个 web 服务器，http://localhost:7000/oqlhelp/。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="109-jmap">10.9. jmap<a href="#109-jmap" class="hash-link" aria-label="10.9. jmap的直接链接" title="10.9. jmap的直接链接">​</a></h2><p>打印指定 Java 进程堆内存细节 linux 下特有</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 选项获取一个运行时的heap dump</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jmap -dump 1102</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 于64位的虚拟机上</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jmap -J-d64 -heap pid</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1010-jrunscript">10.10. jrunscript<a href="#1010-jrunscript" class="hash-link" aria-label="10.10. jrunscript的直接链接" title="10.10. jrunscript的直接链接">​</a></h2><p>解释执行 javascript、groovy、ruby 等脚本语言</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 进入交互模式</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jrunscript</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 执行字符串</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jrunscript -e &quot;print(&#x27;hello world&#x27;)&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 指定语言， 指定文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jrunscript -l js -f test.js</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># test.js是一个脚本文件，arg1，arg2和arg3是传递给脚本的脚本参数。脚本可以使用&quot;arguments&quot;数组来访问这些参数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jrunscript test.js arg1 arg2 arg3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1011-jinfo">10.11. jinfo<a href="#1011-jinfo" class="hash-link" aria-label="10.11. jinfo的直接链接" title="10.11. jinfo的直接链接">​</a></h2><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1012-jprofile">10.12. jprofile<a href="#1012-jprofile" class="hash-link" aria-label="10.12. jprofile的直接链接" title="10.12. jprofile的直接链接">​</a></h2><p>可连接到 tomcat， 可监控线程， 分析服务器的资源消耗情况, 商业工具, 非开源</p><h1>11. 阿里 arthas</h1><p><a href="https://github.com/alibaba/arthas" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/arthas</a>
<a href="https://arthas.aliyun.com/doc/arthas-tutorials.html?language=en" target="_blank" rel="noopener noreferrer">https://arthas.aliyun.com/doc/arthas-tutorials.html?language=en</a></p><p><a href="https://github.com/WangJi92/arthas-idea-plugin" target="_blank" rel="noopener noreferrer">https://github.com/WangJi92/arthas-idea-plugin</a>
<a href="https://wangji.blog.csdn.net/article/details/106964278" target="_blank" rel="noopener noreferrer">https://wangji.blog.csdn.net/article/details/106964278</a></p><h1>12. jvm 性能调优 and 实用参数</h1><p><a href="http://ifeve.com/jvm-optimize/" target="_blank" rel="noopener noreferrer">http://ifeve.com/jvm-optimize/</a>
<a href="http://ifeve.com/useful-jvm-flags/" target="_blank" rel="noopener noreferrer">http://ifeve.com/useful-jvm-flags/</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="121-有哪些参数">12.1. 有哪些参数<a href="#121-有哪些参数" class="hash-link" aria-label="12.1. 有哪些参数的直接链接" title="12.1. 有哪些参数的直接链接">​</a></h2><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">MetaspaceSize</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">128m （元空间默认大小）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">MaxMetaspaceSize</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">128m （元空间最大大小）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token maybe-class-name">Xms1024m</span><span class="token plain"> （堆默认大小）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token maybe-class-name">Xmx1024m</span><span class="token plain"> （堆最大大小）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token maybe-class-name">Xmn256m</span><span class="token plain"> （新生代大小） eden 区 </span><span class="token function" style="color:rgb(0, 0, 255)">大小</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">伊甸园区</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token maybe-class-name">Xss256k</span><span class="token plain"> （棧最大深度大小）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">SurvivorRatio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"> （新生代分区比例 </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token maybe-class-name">UseConcMarkSweepGC</span><span class="token plain"> （指定使用的垃圾收集器，这里使用</span><span class="token constant" style="color:rgb(129, 31, 63)">CMS</span><span class="token plain">收集器）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token maybe-class-name">PrintGCDetails</span><span class="token plain"> （打印详细的</span><span class="token constant" style="color:rgb(129, 31, 63)">GC</span><span class="token plain">日志）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token constant" style="color:rgb(129, 31, 63)">JDK8</span><span class="token plain">之后把</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">PermSize</span><span class="token plain"> 和 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">MaxPermGen移除了，取而代之的是</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">MetaspaceSize</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">128m （元空间默认大小）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">MaxMetaspaceSize</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">128m （元空间最大大小）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token constant" style="color:rgb(129, 31, 63)">JDK</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token function" style="color:rgb(0, 0, 255)">开始把类的元数据放到本地化的堆内存</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">native heap</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">中，这一块区域就叫Metaspace，中文名叫元空间。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">使用本地化的内存有什么好处呢？最直接的表现就是java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">lang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">OutOfMemoryError</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token maybe-class-name">PermGen</span><span class="token plain"> 空间问题将不复存在，因为默认的类的元数据分配只受本地内存大小的限制，也就是说本地内存剩余多少，理论上Metaspace就可以有多大（貌似容量还与操作系统的虚拟内存有关？这里不太清楚），这解决了空间不足的问题。不过，让Metaspace变得无限大显然是不现实的，因此我们也要限制Metaspace的大小：使用</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">MaxMetaspaceSize参数来指定Metaspace区域的大小。</span><span class="token constant" style="color:rgb(129, 31, 63)">JVM</span><span class="token plain">默认在运行时根据需要动态地设置MaxMetaspaceSize的大小。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="122-配置方式">12.2. 配置方式<a href="#122-配置方式" class="hash-link" aria-label="12.2. 配置方式的直接链接" title="12.2. 配置方式的直接链接">​</a></h2><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">MetaspaceSize</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">128m </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">MaxMetaspaceSize</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">128m </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token maybe-class-name">Xms1024m</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token maybe-class-name">Xmx1024m</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token maybe-class-name">Xmn256m</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token maybe-class-name">Xss256k</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">SurvivorRatio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token maybe-class-name">UseConcMarkSweepGC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1.</span><span class="token plain"> idea </span><span class="token constant" style="color:rgb(129, 31, 63)">VM</span><span class="token plain"> options</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1.</span><span class="token plain"> java </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">jar </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">MetaspaceSize</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">128m </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">MaxMetaspaceSize</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">128m </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token maybe-class-name">Xms1024m</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token maybe-class-name">Xmx1024m</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token maybe-class-name">Xmn256m</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token maybe-class-name">Xss256k</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token maybe-class-name">SurvivorRatio</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">XX</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token maybe-class-name">UseConcMarkSweepGC</span><span class="token plain"> newframe</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">1.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">jar</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/jvm">jvm</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/gc">gc</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/内存模型">内存模型</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/java-concurrent"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Java Concurrent🌈</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/java-note"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Java Core 笔记</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#21-method-area" class="table-of-contents__link toc-highlight">2.1. Method Area</a></li><li><a href="#22-heap" class="table-of-contents__link toc-highlight">2.2. Heap</a></li><li><a href="#23-jvm-stack" class="table-of-contents__link toc-highlight">2.3. JVM Stack</a></li><li><a href="#24-native-method-stack" class="table-of-contents__link toc-highlight">2.4. Native Method Stack</a></li><li><a href="#25-pc-register程序计数器" class="table-of-contents__link toc-highlight">2.5. PC Register(程序计数器)</a></li><li><a href="#31-垃圾收集器" class="table-of-contents__link toc-highlight">3.1. 垃圾收集器</a></li><li><a href="#32-如何判断对象是否应该回收" class="table-of-contents__link toc-highlight">3.2. 如何判断对象是否应该回收</a><ul><li><a href="#321-引用计数法-reference-counting" class="table-of-contents__link toc-highlight">3.2.1. 引用计数法 reference counting</a></li><li><a href="#322-可达性分析算法-reachability-analysis" class="table-of-contents__link toc-highlight">3.2.2. 可达性分析算法 reachability analysis</a></li><li><a href="#323-reference-分类" class="table-of-contents__link toc-highlight">3.2.3. reference 分类</a></li></ul></li><li><a href="#33-垃圾回收算法" class="table-of-contents__link toc-highlight">3.3. 垃圾回收算法</a><ul><li><a href="#331-标记-清除-算法" class="table-of-contents__link toc-highlight">3.3.1. 标记-清除 算法</a></li><li><a href="#332-复制算法" class="table-of-contents__link toc-highlight">3.3.2. 复制算法</a></li><li><a href="#333-标记-整理-算法" class="table-of-contents__link toc-highlight">3.3.3. 标记-整理 算法</a></li><li><a href="#334-分代收集算法" class="table-of-contents__link toc-highlight">3.3.4. 分代收集算法</a></li></ul></li><li><a href="#41-类编译" class="table-of-contents__link toc-highlight">4.1. 类编译</a></li><li><a href="#42-类加载" class="table-of-contents__link toc-highlight">4.2. 类加载</a><ul><li><a href="#421-classloader类加载器" class="table-of-contents__link toc-highlight">4.2.1. classloader类加载器</a></li><li><a href="#422-装载load" class="table-of-contents__link toc-highlight">4.2.2. 装载(load)</a></li><li><a href="#423-链接link" class="table-of-contents__link toc-highlight">4.2.3. 链接(Link)</a></li><li><a href="#424-初始化initialize" class="table-of-contents__link toc-highlight">4.2.4. 初始化(Initialize)</a></li></ul></li><li><a href="#43-类执行" class="table-of-contents__link toc-highlight">4.3. 类执行</a><ul><li><a href="#431-字节码解释执行and编译执行并存如何分界" class="table-of-contents__link toc-highlight">4.3.1. 字节码解释执行and编译执行并存如何分界</a></li><li><a href="#432-字节码解释执行" class="table-of-contents__link toc-highlight">4.3.2. 字节码解释执行</a><ul><li><a href="#4321-方法相关的jvm指令" class="table-of-contents__link toc-highlight">4.3.2.1. 方法相关的jvm指令</a></li><li><a href="#4322-jvm指令怎么解释执行" class="table-of-contents__link toc-highlight">4.3.2.2. jvm指令怎么解释执行</a></li></ul></li><li><a href="#433-字节码编译执行" class="table-of-contents__link toc-highlight">4.3.3. 字节码编译执行</a><ul><li><a href="#4331-client-compiler" class="table-of-contents__link toc-highlight">4.3.3.1. client compiler</a></li><li><a href="#4332-server-compiler" class="table-of-contents__link toc-highlight">4.3.3.2. server compiler</a></li></ul></li><li><a href="#434-反射执行" class="table-of-contents__link toc-highlight">4.3.4. 反射执行</a></li></ul></li><li><a href="#51-final" class="table-of-contents__link toc-highlight">5.1. final</a></li><li><a href="#52-volatile" class="table-of-contents__link toc-highlight">5.2. volatile</a></li><li><a href="#53-synchronized" class="table-of-contents__link toc-highlight">5.3. synchronized</a></li><li><a href="#54-static" class="table-of-contents__link toc-highlight">5.4. static</a></li><li><a href="#61-会造成哪些溢出" class="table-of-contents__link toc-highlight">6.1. 会造成哪些溢出</a></li><li><a href="#62-java内存泄露引起原因" class="table-of-contents__link toc-highlight">6.2. Java内存泄露引起原因</a></li><li><a href="#71-对象的创建过程内存怎么分配" class="table-of-contents__link toc-highlight">7.1. 对象的创建过程(内存怎么分配)</a></li><li><a href="#72-对象的访问" class="table-of-contents__link toc-highlight">7.2. 对象的访问</a><ul><li><a href="#721-对象的2种访问方式" class="table-of-contents__link toc-highlight">7.2.1. 对象的2种访问方式</a></li><li><a href="#722-thread具体怎么访问对象中的值呢以及volatile关键字" class="table-of-contents__link toc-highlight">7.2.2. thread具体怎么访问对象中的值呢以及volatile关键字</a></li></ul></li><li><a href="#73-对象回收内存怎么释放" class="table-of-contents__link toc-highlight">7.3. 对象回收(内存怎么释放)</a></li><li><a href="#91-日志检索" class="table-of-contents__link toc-highlight">9.1. 日志检索</a></li><li><a href="#92-查看数据库连接" class="table-of-contents__link toc-highlight">9.2. 查看数据库连接</a></li><li><a href="#93-查看cpu-负载" class="table-of-contents__link toc-highlight">9.3. 查看CPU 负载</a><ul><li><a href="#931-cpu-user高-and--cpu-load-高" class="table-of-contents__link toc-highlight">9.3.1. CPU User高 and  CPU Load 高</a><ul><li><a href="#9311-代码中存在非常消耗-cpu-的操作" class="table-of-contents__link toc-highlight">9.3.1.1. 代码中存在非常消耗 CPU 的操作</a></li><li><a href="#9312-频繁gc" class="table-of-contents__link toc-highlight">9.3.1.2. 频繁gc</a></li></ul></li><li><a href="#932-cpu-system-高-and-cpu-load-高" class="table-of-contents__link toc-highlight">9.3.2. CPU System 高 and CPU Load 高</a></li><li><a href="#933-cpu-wait高-and-cpu-load高-and-cpu利用率低" class="table-of-contents__link toc-highlight">9.3.3. CPU Wait高 and CPU Load高 and CPU利用率低</a></li></ul></li><li><a href="#94-查内存" class="table-of-contents__link toc-highlight">9.4. 查内存</a></li><li><a href="#95-排查垃圾回收问题" class="table-of-contents__link toc-highlight">9.5. 排查垃圾回收问题</a></li><li><a href="#96-网络问题" class="table-of-contents__link toc-highlight">9.6. 网络问题</a></li><li><a href="#101-java-启动-javac-编译-javap-反编译" class="table-of-contents__link toc-highlight">10.1. java 启动 javac 编译 javap 反编译</a></li><li><a href="#102-jstack" class="table-of-contents__link toc-highlight">10.2. jstack</a></li><li><a href="#103-jcmd" class="table-of-contents__link toc-highlight">10.3. jcmd</a></li><li><a href="#104-jps" class="table-of-contents__link toc-highlight">10.4. jps</a></li><li><a href="#105-jstat" class="table-of-contents__link toc-highlight">10.5. jstat</a></li><li><a href="#106-jvisualvm" class="table-of-contents__link toc-highlight">10.6. jvisualvm</a></li><li><a href="#107-jconsole" class="table-of-contents__link toc-highlight">10.7. jconsole</a></li><li><a href="#108-jhat" class="table-of-contents__link toc-highlight">10.8. jhat</a></li><li><a href="#109-jmap" class="table-of-contents__link toc-highlight">10.9. jmap</a></li><li><a href="#1010-jrunscript" class="table-of-contents__link toc-highlight">10.10. jrunscript</a></li><li><a href="#1011-jinfo" class="table-of-contents__link toc-highlight">10.11. jinfo</a></li><li><a href="#1012-jprofile" class="table-of-contents__link toc-highlight">10.12. jprofile</a></li><li><a href="#121-有哪些参数" class="table-of-contents__link toc-highlight">12.1. 有哪些参数</a></li><li><a href="#122-配置方式" class="table-of-contents__link toc-highlight">12.2. 配置方式</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">历史</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tags">标签</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">归档</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/xiaoyureed" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/xiaoyuhfq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/3fPgwd3naN" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/friends">友链</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/resource">导航</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Xiaoyureed, Inc. Built with ❤️ by xiaoyu.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ad5a3358.js"></script>
<script src="/assets/js/main.bd2fa472.js"></script>
</body>
</html>