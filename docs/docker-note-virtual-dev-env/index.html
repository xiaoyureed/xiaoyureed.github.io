<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-docker-note-virtual-dev-env">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Docker Note &amp; Other Virtual Develop Environment - Xiaoyureed 的网络 Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xiaoyureed.github.io/img/logo.webp"><meta data-rh="true" name="twitter:image" content="https://xiaoyureed.github.io/img/logo.webp"><meta data-rh="true" property="og:url" content="https://xiaoyureed.github.io/docs/docker-note-virtual-dev-env"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="keywords" content="xiaoyureed"><meta data-rh="true" name="keywords" content="blog, java, spring, microservice, python, rust, typescript, react, web"><meta data-rh="true" name="keywords" content=" 半路转行的编程爱好者, 写过 Python, Rust, 现在主攻 Java 分布式系统"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Docker Note &amp; Other Virtual Develop Environment - Xiaoyureed 的网络 Wiki"><meta data-rh="true" name="description" content="https://github.com/yeasy/docker_practice"><meta data-rh="true" property="og:description" content="https://github.com/yeasy/docker_practice"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xiaoyureed.github.io/docs/docker-note-virtual-dev-env"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/en/docs/docker-note-virtual-dev-env" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/docker-note-virtual-dev-env" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/docker-note-virtual-dev-env" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://5SAMPKXTP9-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Xiaoyureed 的网络 Wiki" href="/opensearch.xml">


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f6da56a47f5085d1e0fedae39b8de00a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="xiaoyureed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="xiaoyureed Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="xiaoyureed JSON Feed">

<link rel="icon" href="/img/logo.webp">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)">
<meta name="description" content="Xiaoyureed 的个人博客"><link rel="stylesheet" href="/assets/css/styles.d08d09a2.css">
<link rel="preload" href="/assets/js/runtime~main.fcfce0fe.js" as="script">
<link rel="preload" href="/assets/js/main.c0b909ce.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><a href="/docs/rust-note" target="_blank">Rust 指北, 欢迎查看...</a></div><button type="button" aria-label="关闭" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">菜单</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/archive">博客</a></li><li><a class="dropdown__link" href="/docs/intro">教程</a></li><li><a class="dropdown__link" href="/resource">导航</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--dark_i4oU"><b></b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/SpringBoot-note">Spring Boot 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/autohotkey">Autohotkey 脚本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/blockchain">blockchain区块链</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/c-sharp-and-dot-net">C# &amp; .NET</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/chatgpt">Chatgpt Usage Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cpp">CPP and C 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cross-gfw">Cross The GFW</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cs-note">Computer Science Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/css-pre-processor">几种CSS预处理器比较选型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/data-structure-and-algorithm">Data Structure and Algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/design-pattern-note">Design Pattern 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-resources">开发者资源</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/distributed-system">Distributed System 分布式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/docker-note-virtual-dev-env">Docker Note &amp; Other Virtual Develop Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/effective-java-reading-note">Effective Java 阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/elk-elastic-log">Distributed log collection分布式日志收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/english-note">英语学习🔥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extjs-note">Extjs 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/git-note">Git 备忘 🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/golang-note">Golang 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gps-gis-tracing">基于地理位置开发技术</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gradle">Gradle note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/greasy-monkey">油猴插件&amp;编写脚本🐒</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/groovy-note">groovy note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/health">Health 关爱程序员健康🏥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/how-to-test-java-app">How to Test Java App</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/interview-system-design">系统设计 System design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/iot">Iot 物联网</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-code-clean">Java Clean Code Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-concurrent">Java Concurrent🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-memory-model-jmm-jvm">JMM and GC🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-note">Java Core 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/js-tutorial">JavaScript tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/kotlin">kotlin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/kubernetes-k8s">kubernetes-k8s ☁️</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux-note">鸟哥的 Linux 私房菜阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/low-code-platform">Low code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mac">Mac 开发环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/machine-learning-ml">machine-learning-ml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/marketing-seo">Marketing SEO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/maven-note">Maven Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/message-queue">Message Queue🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/money">Investment Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mongodb-note">MongoDB Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/monitor-system-grafana-prometheus-influxdb-hbase">monitor-system-grafana-prometheus监控🖥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mvc-mvvm">MVC to MVVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mybatis-note">MyBatis Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/netty-note">netty</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nlp-natural-language-processing">nlp-natural-language-processing👄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nodejs-yarn-npm">Nodejs, Yarn, Npm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/oracle">Oracle 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-audio-video">Audio and Video development Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-big-data-introduce">大数据开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-cache">Cache 缓存🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-computational-ad">计算广告 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-crawler-spider">网络爬虫 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-db-design-note">关系型数据库表设计🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-desktop-develop">桌面应用开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-http-restful">HTTP protocol Intro &amp; RESTful</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-reactive-programming">响应式编程 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-rpc">RPC Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-rule-engine-note">规则引擎 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/php-note">PHP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/postgres-note">Postgres note🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/process-workflow-bpm-engine">工作流引擎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/protect-your-app-authentication-oauth2-jwt-https">Protect Your App 安全保护认证鉴权🔑</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/python-note">Python🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quant-money">量化交易</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quarkus">Quarkus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/react-note">React🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/real-time-communication-protocol">实时通信 Real-time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/redis-note">Redis🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/regex">Regular Expression 正则🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/rust-note">Rust 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/scala-akka-play-framework">Scala 语言</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/serverless">Serverless</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/service-mesh">service mesh 服务网格</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/servlet">Servlet Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/shell-bash-note">shell-bash脚本收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/spring-note">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springcloud-note">Spring Cloud 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springmvc-note">Spring MVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/task-schedule-note">Task Schedule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tcp-ip-note-p2p">TCP IP, p2p</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tomcat-jetty-nginx">Tomcat Jetty Nginx 等 web 容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/vertx">Vertx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/video-creator">拍摄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webassembly">webassembly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webpack-esbuild-vite-rollup">前端打包构建工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/windows-sub-system-on-linux">WSL 使用</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Docker Note &amp; Other Virtual Develop Environment</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Docker Note &amp; Other Virtual Develop Environment</h1></header><div align="center"><p><a href="https://github.com/yeasy/docker_practice" target="_blank" rel="noopener noreferrer">https://github.com/yeasy/docker_practice</a></p><p><a href="https://vuepress.mirror.docker-practice.com/" target="_blank" rel="noopener noreferrer">https://vuepress.mirror.docker-practice.com/</a></p><p>替代品:
containerd <a href="https://github.com/containerd/containerd/" target="_blank" rel="noopener noreferrer">https://github.com/containerd/containerd/</a>
Podman
CRI-O <a href="https://github.com/cri-o/cri-o" target="_blank" rel="noopener noreferrer">https://github.com/cri-o/cri-o</a>
参考:
<a href="https://juejin.cn/post/7005393730131722247" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/7005393730131722247</a>
<a href="https://segmentfault.com/a/1190000040633750" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000040633750</a>
<a href="https://www.modb.pro/db/43692" target="_blank" rel="noopener noreferrer">https://www.modb.pro/db/43692</a></p><p>Docker Note | reference: <a href="https://docker_practice.gitee.io/image/dockerfile/healthcheck.html" target="_blank" rel="noopener noreferrer">1</a>, <a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer">2</a>, <a href="https://github.com/docker-library/docs" target="_blank" rel="noopener noreferrer">3</a>
<a href="https://blog.csdn.net/zmx729618/article/details/72930474" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/zmx729618/article/details/72930474</a></p><p><a href="https://labs.play-with-docker.com/" target="_blank" rel="noopener noreferrer">docker online</a></p><p><a href="https://www.katacoda.com/" target="_blank" rel="noopener noreferrer">快速的实验环境</a></p><p><a href="https://github.com/wsargent/docker-cheat-sheet" target="_blank" rel="noopener noreferrer">https://github.com/wsargent/docker-cheat-sheet</a> 速查表</p><p><a href="https://github.com/docker/kitematic" target="_blank" rel="noopener noreferrer">https://github.com/docker/kitematic</a> 可视化管理gui</p></div><ul><li><a href="#1-%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4">1. 常用指令</a></li><li><a href="#2-%E5%BC%80%E5%90%AF%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5">2. 开启远程连接</a></li><li><a href="#3-shipyard-ui%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2">3. shipyard ui管理界面</a></li><li><a href="#4-%E4%BB%8B%E7%BB%8D">4. 介绍</a><ul><li><a href="#41-%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84">4.1. 基本架构</a></li><li><a href="#42-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-%E5%BE%97%E5%88%B0%E4%BB%80%E4%B9%88%E5%A5%BD%E5%A4%84">4.2. 使用场景-得到什么好处</a></li><li><a href="#43-%E5%AE%B9%E5%99%A8%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8E%9F%E7%90%86">4.3. 容器实现的原理</a></li></ul></li><li><a href="#5-%E5%AE%89%E8%A3%85">5. 安装</a><ul><li><a href="#51-ubuntu-22-install-docker">5.1. ubuntu 22 install docker</a></li><li><a href="#52-%E4%BD%BF%E7%94%A8%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F">5.2. 使用国内镜像</a></li></ul></li><li><a href="#6-%E9%95%9C%E5%83%8F-image">6. 镜像 image</a><ul><li><a href="#61-packaging-image-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA">6.1. packaging image 导入导出</a></li><li><a href="#62-%E7%89%88%E6%9C%AC%E5%91%BD%E5%90%8D%E6%84%8F%E4%B9%89">6.2. 版本命名意义</a></li><li><a href="#63-%E9%95%9C%E5%83%8F%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">6.3. 镜像实现原理</a></li><li><a href="#64-%E8%8E%B7%E5%8F%96%E9%95%9C%E5%83%8F">6.4. 获取镜像</a></li><li><a href="#65-%E8%BF%90%E8%A1%8C%E9%95%9C%E5%83%8F">6.5. 运行镜像</a></li><li><a href="#66-%E5%88%97%E5%87%BA%E9%95%9C%E5%83%8F">6.6. 列出镜像</a></li><li><a href="#67-%E5%88%A0%E9%99%A4%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F">6.7. 删除本地镜像</a></li></ul></li><li><a href="#7-%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F%E7%9A%84%E6%96%B9%E6%B3%95">7. 制作镜像的方法</a><ul><li><a href="#71-work-with-golang">7.1. work with golang</a></li><li><a href="#72-working-with-frontend">7.2. working with frontend</a></li><li><a href="#73-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E4%BC%98%E5%8C%96%E4%BD%93%E7%A7%AF">7.3. 最佳实践 优化体积</a></li><li><a href="#74-%E9%80%9A%E8%BF%87-dockerfile-%E6%9D%A5-build-%E9%95%9C%E5%83%8F">7.4. 通过 dockerfile 来 build 镜像</a></li><li><a href="#75-commit%E5%AE%B9%E5%99%A8%E6%88%90%E4%B8%BA%E9%95%9C%E5%83%8F%E4%B8%8D%E6%8E%A8%E8%8D%90">7.5. commit容器成为镜像(不推荐)</a></li><li><a href="#76-%E4%BB%8E%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%AF%BC%E5%85%A5">7.6. 从压缩包导入</a></li><li><a href="#77-docker-save-%E5%92%8C-docker-load">7.7. docker save 和 docker load</a></li></ul></li><li><a href="#8-dockerfile">8. Dockerfile</a><ul><li><a href="#81-from">8.1. from</a></li><li><a href="#82-%E9%95%9C%E5%83%8F%E7%9A%84%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87context">8.2. 镜像的构建上下文context</a><ul><li><a href="#821-dockerignore">8.2.1. dockerignore</a></li></ul></li><li><a href="#83-copy-%E5%92%8C-add">8.3. COPY 和 ADD</a></li><li><a href="#84-workdir-%E6%8C%87%E5%AE%9A%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95">8.4. WORKDIR 指定工作目录</a></li><li><a href="#85-run-cmd-%E5%92%8C-entrypoint-%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4">8.5. run cmd 和 entrypoint 容器启动命令</a><ul><li><a href="#851-%E8%AE%BE%E7%BD%AE%E6%97%B6%E5%8C%BA">8.5.1. 设置时区</a></li><li><a href="#852-%E5%B8%B8%E8%A7%81%E7%9A%84%E9%94%99%E8%AF%AF%E7%94%A8%E6%B3%95">8.5.2. 常见的错误用法</a></li><li><a href="#853-%E9%83%BD%E6%94%AF%E6%8C%81%E4%B8%A4%E7%A7%8D%E6%A0%BC%E5%BC%8F-shell-%E5%92%8C-exec-%E7%9A%84%E5%8C%BA%E5%88%AB">8.5.3. 都支持两种格式 shell 和 exec 的区别</a></li><li><a href="#854-run">8.5.4. run</a><ul><li><a href="#8541-%E5%85%B8%E5%9E%8B%E9%94%99%E8%AF%AF">8.5.4.1. 典型错误</a></li></ul></li><li><a href="#855-cmd%E6%8C%87%E4%BB%A4">8.5.5. cmd指令</a></li><li><a href="#856-entrypoint-%E5%85%A5%E5%8F%A3%E7%82%B9">8.5.6. ENTRYPOINT 入口点</a><ul><li><a href="#8561-eg-%E8%AE%A9%E9%95%9C%E5%83%8F%E5%8F%98%E6%88%90%E5%83%8F%E5%91%BD%E4%BB%A4%E4%B8%80%E6%A0%B7%E4%BD%BF%E7%94%A8">8.5.6.1. eg: 让镜像变成像命令一样使用</a></li><li><a href="#8562-eg-%E5%BA%94%E7%94%A8%E8%BF%90%E8%A1%8C%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">8.5.6.2. eg: 应用运行前的准备工作</a></li></ul></li></ul></li><li><a href="#86-env-%E5%92%8C-arg-%E8%AE%BE%E7%BD%AE%E5%8F%98%E9%87%8F">8.6. ENV 和 arg 设置变量</a></li><li><a href="#87-volume-%E5%AE%9A%E4%B9%89%E5%8C%BF%E5%90%8D%E6%95%B0%E6%8D%AE%E5%8D%B7">8.7. VOLUME 定义匿名数据卷</a></li><li><a href="#88-expose-%E5%A3%B0%E6%98%8E%E7%AB%AF%E5%8F%A3">8.8. EXPOSE 声明端口</a></li><li><a href="#89-user-%E6%8C%87%E5%AE%9A%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7">8.9. USER 指定当前用户</a></li><li><a href="#810-healthcheck-%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5">8.10. HEALTHCHECK 健康检查</a></li><li><a href="#811-onbuild-%E7%BB%99%E5%88%AB%E4%BA%BA%E7%94%A8">8.11. ONBUILD 给别人用</a></li><li><a href="#812-multi-stage-%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E5%BB%BA">8.12. multi-stage 多阶段构建</a><ul><li><a href="#8121-%E6%B8%85%E7%90%86%E7%BC%93%E5%AD%98%E7%9A%84%E9%95%9C%E5%83%8F">8.12.1. 清理缓存的镜像</a></li></ul></li></ul></li><li><a href="#9-%E4%BD%BF%E7%94%A8%E5%AE%B9%E5%99%A8">9. 使用容器</a><ul><li><a href="#91-use-docker-in-github-action">9.1. use docker in github action</a></li><li><a href="#92-%E6%9F%A5%E7%9C%8B">9.2. 查看</a></li><li><a href="#93-%E5%90%AF%E5%8A%A8">9.3. 启动</a><ul><li><a href="#931--it-%E7%BB%B4%E6%8C%81%E4%BA%A4%E4%BA%92%E7%BB%88%E7%AB%AF">9.3.1. -it 维持交互终端</a></li><li><a href="#932--d-%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C">9.3.2. -d 后台运行</a></li><li><a href="#933---privilegedtrue-%E8%B5%8B%E4%BA%88%E7%89%B9%E6%9D%83">9.3.3. --privileged=true 赋予特权</a></li></ul></li><li><a href="#94-%E7%BB%88%E6%AD%A2container">9.4. 终止container</a></li><li><a href="#95-%E5%88%A0%E9%99%A4container">9.5. 删除container</a></li><li><a href="#96-%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8">9.6. 进入容器</a></li><li><a href="#97-%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA">9.7. 容器的导入和导出</a></li><li><a href="#98-%E6%8B%B7%E8%B4%9D%E5%AE%B9%E5%99%A8%E5%86%85%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%BB%E6%9C%BA">9.8. 拷贝容器内文件到主机</a></li></ul></li><li><a href="#10-%E8%AE%BF%E9%97%AE%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93">10. 访问镜像仓库</a><ul><li><a href="#101-dockerhub">10.1. dockerhub</a><ul><li><a href="#1011-publish-by-using-github-action">10.1.1. publish by using github action</a></li></ul></li><li><a href="#102-%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93">10.2. 私有仓库</a><ul><li><a href="#allow-http">allow http</a></li><li><a href="#harbor%E6%8E%A8%E8%8D%90">harbor(推荐)</a><ul><li><a href="#k8s-%E9%85%8D%E7%BD%AEharbor">k8s 配置harbor</a></li></ul></li><li><a href="#nexus">Nexus</a></li><li><a href="#docker-registry">docker-registry</a></li></ul></li></ul></li><li><a href="#11-docker%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86">11. docker数据管理</a><ul><li><a href="#111-%E6%95%B0%E6%8D%AE%E5%8D%B7">11.1. 数据卷</a></li><li><a href="#112-%E6%8C%82%E8%BD%BD%E4%B8%BB%E6%9C%BA%E7%9B%AE%E5%BD%95">11.2. 挂载主机目录</a></li><li><a href="#113-volume-%E7%9A%84%E5%85%B1%E4%BA%AB">11.3. volume 的共享</a></li></ul></li><li><a href="#12-%E7%BD%91%E7%BB%9C%E4%BA%92%E8%81%94">12. 网络互联</a><ul><li><a href="#121-docker-%E9%BB%98%E8%AE%A4%E5%88%9D%E5%A7%8B%E5%88%9B%E5%BB%BA3-%E4%B8%AA%E7%BD%91%E7%BB%9C">12.1. docker 默认初始创建3 个网络</a></li><li><a href="#124-%E5%88%9B%E5%BB%BA%E5%9B%BA%E5%AE%9Aip">12.4. 创建固定ip</a></li><li><a href="#125-%E6%9F%A5%E7%9C%8Bcontainer%E7%9A%84ip">12.5. 查看container的ip</a></li><li><a href="#126-%E5%A4%96%E9%83%A8%E8%AE%BF%E9%97%AE%E5%AE%B9%E5%99%A8">12.6. 外部访问容器</a></li><li><a href="#127-%E5%AE%B9%E5%99%A8%E4%BA%92%E8%81%94">12.7. 容器互联</a></li><li><a href="#128-%E9%85%8D%E7%BD%AEdns-%E5%92%8C-%E4%B8%BB%E6%9C%BA%E5%90%8D-hostname">12.8. 配置dns 和 主机名 hostname</a></li></ul></li><li><a href="#13-docker-compose">13. docker-compose</a><ul><li><a href="#131-some-significant-materials">13.1. some significant materials</a></li><li><a href="#132-compose%E7%AE%80%E4%BB%8B">13.2. compose简介</a></li><li><a href="#133-%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8">13.3. 命令使用</a><ul><li><a href="#1331-up">13.3.1. up</a></li><li><a href="#1332-run">13.3.2. run</a></li><li><a href="#1333-scale">13.3.3. scale</a></li><li><a href="#1334-start">13.3.4. start</a></li><li><a href="#1335-build">13.3.5. build</a></li><li><a href="#1336-config">13.3.6. config</a></li><li><a href="#1337-exec">13.3.7. exec</a></li><li><a href="#1338-images">13.3.8. images</a></li><li><a href="#1339-kill">13.3.9. kill</a></li><li><a href="#13310-down">13.3.10. down</a></li><li><a href="#13311-pause">13.3.11. pause</a></li><li><a href="#13312-unpause">13.3.12. unpause</a></li><li><a href="#13313-restart">13.3.13. restart</a></li><li><a href="#13314-stop">13.3.14. stop</a></li><li><a href="#13315-rm">13.3.15. rm</a></li><li><a href="#13316-logs">13.3.16. logs</a></li><li><a href="#13317-top">13.3.17. top</a></li><li><a href="#13318-version">13.3.18. version</a></li><li><a href="#13319-port">13.3.19. port</a></li><li><a href="#13320-ps">13.3.20. ps</a></li><li><a href="#13321-pull">13.3.21. pull</a></li><li><a href="#13322-push">13.3.22. push</a></li></ul></li><li><a href="#134-docker-composeyml">13.4. docker-compose.yml</a></li></ul></li><li><a href="#14-docker-machine">14. docker-machine</a></li><li><a href="#15-docker-swarmswarm-mode">15. docker-swarm,swarm-mode</a></li><li><a href="#16-docker%E5%AE%9E%E8%B7%B5">16. docker实践</a><ul><li><a href="#nacos">nacos</a></li><li><a href="#161-%E6%90%AD%E5%BB%BA%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E7%B3%BB%E7%BB%9F">16.1. 搭建持续集成系统</a></li><li><a href="#162-docker%E5%92%8Cspringboot">16.2. docker和springboot</a></li><li><a href="#163-oracle11g">16.3. oracle11g</a></li><li><a href="#164-%E4%BD%BF%E7%94%A8-mysql-%E9%95%9C%E5%83%8F">16.4. 使用 mysql 镜像</a></li><li><a href="#165-%E4%BD%BF%E7%94%A8postgres%E9%95%9C%E5%83%8F">16.5. 使用postgres镜像</a></li><li><a href="#166-%E4%BD%BF%E7%94%A8-rabbitmq%E9%95%9C%E5%83%8F">16.6. 使用 rabbitmq镜像</a></li><li><a href="#167-redis%E9%95%9C%E5%83%8F">16.7. redis镜像</a></li><li><a href="#168-ubuntu%E9%95%9C%E5%83%8F">16.8. ubuntu镜像</a></li><li><a href="#169-zookeeper">16.9. zookeeper</a></li><li><a href="#1610-kafka">16.10. kafka</a></li><li><a href="#1611-rabbitmq">16.11. rabbitmq</a></li><li><a href="#1612-zipkin">16.12. zipkin</a></li><li><a href="#1613-nginx">16.13. nginx</a></li><li><a href="#1614-mongodb">16.14. mongodb</a></li><li><a href="#1615-gitlab">16.15. gitlab</a></li><li><a href="#1616-etcd">16.16. etcd</a></li><li><a href="#1617-influxdb">16.17. influxdb</a></li></ul></li><li><a href="#17-vagrant">17. vagrant</a><ul><li><a href="#171-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">17.1. 基本使用</a></li><li><a href="#172-vagrant-%E8%AE%BE%E7%BD%AE-ip">17.2. vagrant 设置 ip</a></li><li><a href="#173-virtualbox%E5%9B%9B%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F">17.3. VirtualBox四种网络模式</a></li></ul></li><li><a href="#18-kali">18. kali</a></li><li><a href="#19-%E8%99%9A%E6%8B%9F%E7%BD%91%E5%8D%A1-macvlan">19. 虚拟网卡 macvlan</a></li><li><a href="#20-multipass">20. Multipass</a></li><li><a href="#21-drone">21. drone</a></li></ul><h1>1. 常用指令</h1><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker -v # 版本</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker version # client, server 版本</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 这种方式可能不准</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 推荐 ps -ef | grep &lt;container id&gt; 找到 找到容器对应的进程, 然后通过 top &lt;pid &gt; 查看实际内存, cpu 占用</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker stats # 监视容器 CPU 内存使用率</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">########## 更新 容器启动配置</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 容器随 docker 自动启动</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker update &lt;container&gt; --restart=always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker update --restart=no &lt;container-id&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">######################### prune 命令 (清理)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker container prune</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker images prune</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker volume prune</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker network prune</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker system prune     # 删除以上所有空闲</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">####################### image 相关</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 拉取 docker pull</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker pull &lt;image&gt;:&lt;tag&gt;  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查看镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker images </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker image ls [image_name][:tag]       #查看所有/指定的镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker image ls -a                    #显示包括中间层镜像在内的所有镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 自定义结果镜像查询</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker image ls --format &quot;{{.ID}}: {{.Repository}}&quot;    # 列出镜像结果，并且只包含镜像ID和仓库名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker image ls --format &quot;table {{.ID}}\t{{.Repository}}\t{{.Tag}}&quot; #带标题, 但是自己定义列</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker image ls -q                        # 仅仅显示image的id</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 删除镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker image rm &lt;xxx&gt;                           删除指定镜像(可以是id, name....)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker image rm $(docker image ls -q redis)     和其他命令配合删除</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker image rm $(docker image ls -q -f before=mongo:3.2) 配合</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker image prune                              批量清理临时镜像文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker rmi image_name </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 过滤镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># //使用grep和awk过滤得到镜像ID。(匹配镜像名称为image-b，标签为除了v1d0-7之外的其他行，获取第三列的ID)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker images | grep image-b | grep -v &quot;v1d0-7&quot; | awk  &#x27;{print $3}&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># // 使用docker rmi删除过滤得到的镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker rmi $(docker images | grep image-b | grep -v &quot;v1d0-7&quot; | awk  &#x27;{print $3}&#x27;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># // 删除5天前的镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker rmi $(docker images | grep &quot;&lt;none&gt;&quot;| grep &quot;5 days ago&quot; | awk  &#x27;{print $3}&#x27;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ###########################docker machine的命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker-machine ls                                  #查看运行docker server的虚拟机</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker-machine create --driver=virtualbox default  #创建一个虚拟机用于运行docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker-machine env [default]          #查看环境变量(机器ip在里面可以看到), 默认查看名为default的机器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">############################ docker ps</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker ps | less -S                 #查看所有运行的container, 每条记录只占用一行显示</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker ps -q                # 仅仅显示 id 列, 配合 filter 清理容器时非常好用</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker ps -a                       # 查看所有(包括停止的container)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker ps -s            # 显示容器文件大小 (如 211MB (virtual 1.83GB), 一个是容器真实增加的大小，一个是整个容器的虚拟大小, 容器虚拟大小 = 容器真实增加大小 + 容器镜像大小)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">###################### 过滤 filter</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># [-f] 过滤, 等同 --filter</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># [--filter &quot;until=24h&quot;] 删除24h以前的; [--filter &quot;label!=keep&quot;]只删除标签不为keep的</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># - 选项后跟的都是键值对 key=value (可不带引号），如果有多个过滤条件，就多次使用 filter 选项</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># - 相同条件之间的关系是或，不同条件之间的关系是与</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># - id 和 name，支持正则表达式，使用起来非常灵活。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker ps --filter id=a1b2c3 --filter name=bingohuang</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker ps --filter name=bingo --filter name=huang --filter status=running # 以上过滤条件会找出 name 包含 bingo 或 huang 并且 status 为 running 的容器。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker ps --filter name=^/bingohuang$ # 精确匹配 name 为 bingohuang 的容器。注意，容器实际名称，开头是有一个正斜线 / ，可用 docker inspect 一看便知</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker ps --filter name=.*bingohuang.* # 匹配 name 包含 bingohuang 的容器，和 --filter name=bingohuang 一个效果。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 清理名称包含 bingohuang，且状态为 exited 或 dead 的容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker rm $(docker ps -q --filter name=.*bingohuang.* --filter status=exited --filter status=dead 2&gt;/dev/null)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ########################## Format 格式化显示</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 基于 Go template（https://golang.org/pkg/html/template/）语法</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker ps --format &quot;{{.ID}}: {{.Command}}&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 如果想带上表格列头，需要再 template 中加上 table 指令：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker ps --format &quot;table {{.ID}}\t{{.Command}}&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 支持的其他占位符 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ID, Names, Image, Command, CreatedAt, RuningFor (存活了多久了), Ports, Status, Size, Mounts (volumns 的名字), Networks</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Labels (所有贴上的标签名字), Label (指定标签名的标签值, 格式: &#x27;{{.Label &quot;xxx_label_value&quot;}}&#x27;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ########################## 查看元信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker system df             #查看镜像、容器、数据卷所占用的空间, 运行状况(通过表格的形式)(常用) </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker info        # docker的基本信息(多少container, 多少image, 各个container状况 ,docker root dir)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker network ls                   #查看docker网络</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker build -t &lt;nginx:v3&gt; &lt;.&gt;      #根据Dockerfile构建镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # -t 指定镜像名称</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # . 表示构建上下文 context 为当前目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker top &lt;id, container_name&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">######################## docker run/exec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run &lt;IMAGE&gt; env                              查看镜像支持的环境变量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run --name webserver -d -p &lt;host_port&gt;:&lt;container_port&gt; nginx       指定container名字运行, 端口映射,  -p &lt;宿主端口&gt;:&lt;容器端口&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    * `-d` 后台运行(不加, 则前台运行, 日志输出到前台, ctrl+c不会终止container, 但会终止日志输出)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    * `-p` 指定端口映射</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    * `--name` 指定container名字</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run &lt;image_name&gt;:&lt;tag&gt; &lt;cmd&gt;                 运行指定镜像启动容器, 并执行一条指令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run image_name apt-get install -y app_name 运行镜像, 在容器中安装新的程序, 完成后退出</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                    * -y : 不要进入交互模式</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker exec -itd &lt;container_name/id&gt; &lt;cmd&gt;        进入容器, 执行命令后退出</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                        * -d : 后台运行, 去掉后, cmd执行完成后会呆在container内部</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -it --rm &lt;image_name&gt;:&lt;tag&gt; bash         运行并进入指定容器内部, 打开bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                        * -i：交互式操作</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                        * -t 终端</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                        * --rm：容器退出后随之将其删除</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker exec -it webserver bash                      进入某个容器内, 并执行一条命令, 以`exit` 退出</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                        * 不推荐 docker attach &lt;xxx&gt;, exit退出, container也随之终止</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker cp &lt;container_name/id&gt;:&lt;container_path&gt; &lt;host_path&gt;      复制文件, 从container到本机</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># docker container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker container ls 或 docker ps                    运行着的容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                        * -q : 只返回容器id</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker container start &lt;stoped_container&gt;           启动终止状态的容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker container restart &lt;xxx&gt;                      重启</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker-compose restart &lt;service_name&gt;               必须在上下文目录, 是service name, 而非container_name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker stop &lt;xxx&gt;                                   停止容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker container stop &lt;xxx&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker start/restart &lt;xxx&gt;                          启动</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker kill $(docker ps -a -q)                      停止所有正在运行的容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker rm &lt;xxx&gt;                               删除容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker rm -fv &lt;容器ID&gt;               停止、删除容器，并清除数据 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker container rm &lt;xxx&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker container prune                              删除所有的停止的容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># docker inspect 容器详细信息/容器配置(json格式)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker inspect &lt;container&gt;                                              容器详细信息(json格式, 大量信息 包括ip)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker inspect -f=&#x27;{{.Name}}&#x27; $(sudo docker ps -a -q)                   查看所有容器name (可以不带等号)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker inspect --format &#x27;{{ .NetworkSettings.IPAddress }}&#x27;  &lt;container&gt; 获取指定容器ip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                                            * 用 $(sudo docker ps -a -q) 替换&lt;container&gt; 获取所有container的ip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker inspect &lt;id,container_name&gt; | grep &quot;IPAddress&quot;                   查看ip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># docker log 查看日志</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker logs &lt;xxx&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker container logs &lt;xxx&gt;            #  查看指定container的日志(全部)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker logs -f -t --since=&quot;2017-05-31&quot; --tail=10 &lt;container&gt;   # 追踪日志文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #* -f : 查看实时日志</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #* -t : 带上时间戳</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #* --since : 此参数指定了输出日志开始日期</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #* --tail=10 : 后10行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># docker commit 提交 docker history 提交历史</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker commit \                                                 # 提交修改后的容器形成新的镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        --author &quot;Tao Wang &lt;twang2218@gmail.com&gt;&quot; \ # 修改人</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        --message &quot;修改了默认网页&quot; \ # 修改说明</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        webserver \ # 修改的container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        nginx:v2 # 仓库名:标签名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker history nginx:v2                 查看指定镜像的历史提交记录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker rename &lt;old容器名&gt;  &lt;new容器名&gt; 修改容器名称</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 网络相关命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker network create -d &lt;network-type&gt; --subnet=172.18.0.0/16 &lt;my-network&gt; # 创建网络</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    * -d 网络类型, 默认 bridge</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    * --subnet 指定网段</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker network rm my-net # 删除</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker network connect my-net my-nginx # 运行着的 container 加入网络</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker network disconnect my-net my-nginx # 断开网络</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -itd --name &lt;test1&gt; --network bridge --ip 172.17.0.10 &lt;centos:latest&gt; &lt;/bin/bash &gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    * 用 --network 参数，可以指定网络类型</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    * --ip 172.17.0.10指定ip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>2. 开启远程连接</h1><p>用于开发环境, 不安全</p><p>原生 docker: <a href="https://blog.csdn.net/yjt520557/article/details/99715097" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/yjt520557/article/details/99715097</a> 或者 <a href="https://www.cnblogs.com/weiyiming007/p/10168733.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/weiyiming007/p/10168733.html</a></p><p>wsl 下的 docker: <a href="https://www.jianshu.com/p/c7bc8fa1ee5f" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/c7bc8fa1ee5f</a> 修改 <code>/lib/systemd/system/docker.service</code></p><h1>3. shipyard ui管理界面</h1><p>web 管理控制台, 管理容器, 默认用户名密码 admin/shipyard</p><p>同类: docker-ui</p><h1>4. 介绍</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41-基本架构">4.1. 基本架构<a href="#41-基本架构" class="hash-link" aria-label="4.1. 基本架构的直接链接" title="4.1. 基本架构的直接链接">​</a></h2><p>docker client和docker server: docker是c/s架构, client和server可以在同一台机器也可以不再同一台机器</p><p>Repository: 具体某个镜像的仓库, 只存储某一个项目的镜像(比如Tomcat下面有很多个版本(用tag表示)的镜像，它们共同组成了Tomcat的Repository。)</p><p>Registry: 所有的镜像, 官方为Docker Hub, 也可以部署私有registry(Registry上有很多的Repository，Redis、Tomcat、MySQL等等Repository组成了Registry。)</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42-使用场景-得到什么好处">4.2. 使用场景-得到什么好处<a href="#42-使用场景-得到什么好处" class="hash-link" aria-label="4.2. 使用场景-得到什么好处的直接链接" title="4.2. 使用场景-得到什么好处的直接链接">​</a></h2><p>传统虚拟机在宿主操作系统上先虚拟出一套硬件, 硬件上再运行操作系统，在该系统上再运行所需应用进程；</p><ul><li><p>而 docker 容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便</p></li><li><p>Docker给应用提供了一个从开发到上线  <code>统一的环境</code></p></li><li><p>数据库的数据与数据库程序本身分离开：用一个container A作为数据存储，然后另一个container B运行数据库。当你想升级数据库时，用新的container C替换掉container B即可 . <code>方便的迁移应用</code></p></li><li><p>使用docker build完成单元测试(创建隔离的环境进行测试, 如用jenkins ci这样的ci工具启动一个用于测试的container)</p></li><li><p>尤其适合微服务</p><ul><li><p>后端应用是微服务化的，有很多个独立的 java 应用，开发、测试和线上多套环境。</p></li><li><p>docker 之前的部署方案: 打 war 包，上传到 ecs，重启tomcat; docker 部署方案：编译机器上编译 jar 包，打出 docker-img（把jar包放进去）, push 到 docker registry，线上机器pull docker-img, 然后 docker stop， docker run。</p></li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43-容器实现的原理">4.3. 容器实现的原理<a href="#43-容器实现的原理" class="hash-link" aria-label="4.3. 容器实现的原理的直接链接" title="4.3. 容器实现的原理的直接链接">​</a></h2><p>容器: 是一个 视图隔离, 资源可限制, 独立文件系统的进程集合</p><p>Linux 提供三大技术</p><ul><li>namespace 实现资源视图隔离, 如独立的主机名, 可以限制只能看到部分其他进程</li><li>cgroup 控制资源使用率, 如可控制cpu, 内存使用率</li><li>chroot 创建独立的文件系统 , 如吧某个目录设置为子系统的根目录</li></ul><h1>5. 安装</h1><p><a href="https://www.runoob.com/docker/ubuntu-docker-install.html" target="_blank" rel="noopener noreferrer">https://www.runoob.com/docker/ubuntu-docker-install.html</a></p><p>安装docker前检查环境是否匹配:</p><ul><li><code>uname -a</code> 查看内核版本</li><li>升级内核版本: 先通过<code>sudo apt-get update</code> 更新atp-get, 然后通过<code>sudo atp-get install &lt;指定linux内核&gt;</code>安装, 最后通过<code>sudo update-grub</code>加载新内核. 还需要重启<code>sudo reboot</code></li><li>检查是否以device mapper作为存储驱动 <code>grep device-mapper /proc/devices</code></li></ul><p>安装参考: <a href="https://docs.docker.com/engine/install/centos/#install-using-the-convenience-script" target="_blank" rel="noopener noreferrer">https://docs.docker.com/engine/install/centos/#install-using-the-convenience-script</a></p><p>最简单的 <code>curl -fsSL https://get.docker.com -o get-docker.sh &amp;&amp; sudo sh get-docker.sh</code></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sudo systemctl enable docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo systemctl start docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run hello-world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51-ubuntu-22-install-docker">5.1. ubuntu 22 install docker<a href="#51-ubuntu-22-install-docker" class="hash-link" aria-label="5.1. ubuntu 22 install docker的直接链接" title="5.1. ubuntu 22 install docker的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># According to the official doc , these two comand is the easiest way </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># but I occurred a issue : lsb_release can not be found</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">curl -fsSL https://get.docker.com -o get-docker.sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo sh ./get-docker.sh --dry-run</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># after check, this can resolve the issue above</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt-get update &amp;&amp; apt-get install -y lsb-release &amp;&amp; apt-get clean all</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># It&#x27;s fucking disgusting</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># finally I find this link : https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-22-04</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># https://cloudcone.com/docs/article/how-to-install-docker-on-ubuntu-22-04-20-04/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Every thing is ok!</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52-使用国内镜像">5.2. 使用国内镜像<a href="#52-使用国内镜像" class="hash-link" aria-label="5.2. 使用国内镜像的直接链接" title="5.2. 使用国内镜像的直接链接">​</a></h2><p>ailiyun加速<a href="https://7lwsinal.mirror.aliyuncs.com" target="_blank" rel="noopener noreferrer">https://7lwsinal.mirror.aliyuncs.com</a></p><p>临时使用 <code>docker run hello-world --registry-mirror=https://docker.mirrors.ustc.edu.cn</code></p><p>持久使用, 修改 or 新增 <code>vim /etc/docker/daemon.json</code>, </p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token property">&quot;registry-mirrors&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;registry-mirrors&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://registry.docker-cn.com&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;http://hub-mirror.c.163.com&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl restart docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://www.cnblogs.com/nihaorz/p/12131873.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/nihaorz/p/12131873.html</a></p><h1>6. 镜像 image</h1><p>可以通过Dockerfile构建image，也可以将image运行，使其变成container</p><p><a href="https://juejin.cn/post/6850418112237502472" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6850418112237502472</a> 奇怪异常</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="61-packaging-image-导入导出">6.1. packaging image 导入导出<a href="#61-packaging-image-导入导出" class="hash-link" aria-label="6.1. packaging image 导入导出的直接链接" title="6.1. packaging image 导入导出的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker save -o local-image.tar image:tag</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker save -o local-images.tar image1:tag1 image2:tag2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># save all local images</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker save -o all-local-images-in-namespace.tar $(docker image ls --format &#x27;{{json .}}&#x27; | jq -r &#x27;select(.Repository!=&quot;&lt;none&gt;&quot;) | if (.Tag==&quot;&lt;none&gt;&quot;) then .Repository else (.Repository+&quot;:&quot;+.Tag) end&#x27;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker load &lt; local-images.tar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="62-版本命名意义">6.2. 版本命名意义<a href="#62-版本命名意义" class="hash-link" aria-label="6.2. 版本命名意义的直接链接" title="6.2. 版本命名意义的直接链接">​</a></h2><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">空镜像scratch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">工具镜像busybox </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  本身只有 </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">16M，非常便于构建小镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">slim  </span><span class="token maybe-class-name">Represents</span><span class="token plain"> the minimum image size</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  是完整镜像的配对版本。这个镜像通常只安装运行特定工具所需的最小包</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  相比于 alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 带有一些工具</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  在使用这个镜像时，一定要进行彻底的测试！如果遇到无法解释的错误，请尝试切换到完整的镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token maybe-class-name">Alphine</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  高度精简又包含了基本工具的轻量级 </span><span class="token maybe-class-name">Linux</span><span class="token plain"> 发行版，基础镜像只有 </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">41M</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 但是太精简，可能出现一些奇怪的环境问题</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> but on the other hands it also cannot work very well </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> you wanna use some basic tools</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  using apk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  使用了一个更小的musl lib代替glibc。如果您的应用程序有特定的libc需求，您可能会遇到问题。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">buster  适用与 debian </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> apt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">stretch 适用于 debian </span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jessie  适用于 debian </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bullseye、bookworm   开发版本，处于未稳定状态</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="63-镜像实现原理">6.3. 镜像实现原理<a href="#63-镜像实现原理" class="hash-link" aria-label="6.3. 镜像实现原理的直接链接" title="6.3. 镜像实现原理的直接链接">​</a></h2><p>docker 镜像都是层层叠加，每一层都可能被不同的镜像共享 (在Dockerfile中每一步都会产生一层layer，每一步的结果产出变成文件)</p><p>Docker 使用 Union FS 将这些不同的层结合到一个镜像中去。</p><p>通常 Union FS 有两个用途, 一方面可以实现不借助 LVM、RAID 将多个 disk 挂到同一个目录下,另一个更常用的就是将一个只读的分支和一个可写的分支联合在一起，Live CD 正是基于此方法可以允许在镜像不变的基础上允许用户在其上进行一些写操作。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="64-获取镜像">6.4. 获取镜像<a href="#64-获取镜像" class="hash-link" aria-label="6.4. 获取镜像的直接链接" title="6.4. 获取镜像的直接链接">​</a></h2><p>通过 <code>docker pull --help</code> 查询可知格式为:</p><p><code>docker pull [选项] [Docker Registry地址 [:端口号] / ] 仓库名[:标签]</code></p><ul><li><p>Docker 镜像仓库地址的格式一般是 &lt;域名/IP&gt;<!-- -->[:端口号]<!-- -->。默认地址是 Docker Hub。</p></li><li><p>仓库名：如之前所说，这里的仓库名是两段式名称，即 &lt;用户名&gt;/&lt;软件名&gt;。对于 Docker Hub，如果不给出用户名，则默认为 library，也就是官方镜像。</p></li></ul><p>例如: </p><p>docker pull ubuntu:16.04</p><p>上面的命令中没有给出 Docker 镜像仓库地址，因此将会从 Docker Hub 获取镜像。而镜像名称是 ubuntu:16.04，因此将会获取官方镜像 library/ubuntu 仓库中标签为 16.04 的镜像。</p><p>从下载过程中可以看到我们之前提及的分层存储的概念，镜像是由多层存储所构成。下载也是一层层的去下载，并非单一文件。下载过程中给出了每一层的 ID 的前 12 位。并且下载结束后，给出该镜像完整的 sha256 的摘要，以确保下载一致性</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="65-运行镜像">6.5. 运行镜像<a href="#65-运行镜像" class="hash-link" aria-label="6.5. 运行镜像的直接链接" title="6.5. 运行镜像的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 以上面的 ubuntu:16.04 为例，如果我们打算启动里面的 bash 并且进行交互式操作的话，可以执行下面的命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -it --rm \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ubuntu:16.04 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="66-列出镜像">6.6. 列出镜像<a href="#66-列出镜像" class="hash-link" aria-label="6.6. 列出镜像的直接链接" title="6.6. 列出镜像的直接链接">​</a></h2><ul><li><p><code>docker image ls [xxx:xxx]</code> 列出所有/指定下载的顶层镜像</p></li><li><p><code>docker image ls -a</code> 列出所有包括中间层镜像</p></li><li><p><code>docker images</code> 也可查看</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="67-删除本地镜像">6.7. 删除本地镜像<a href="#67-删除本地镜像" class="hash-link" aria-label="6.7. 删除本地镜像的直接链接" title="6.7. 删除本地镜像的直接链接">​</a></h2><p><code>docker image rm [选项] &lt;镜像1&gt; [&lt;镜像2&gt; ...]</code></p><h1>7. 制作镜像的方法</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="71-work-with-golang">7.1. work with golang<a href="#71-work-with-golang" class="hash-link" aria-label="7.1. work with golang的直接链接" title="7.1. work with golang的直接链接">​</a></h2><p>create a main.go, then create dockerfile in the same directory:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">FROM golang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">1.16</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">buster AS builder</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN mkdir /src</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ADD . /src</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR /src</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN go env </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">w GO111MODULE=auto</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN go build </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">o main .</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM gcr.io/distroless/base</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">debian10</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR /</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">from=builder /src/main /main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EXPOSE 3000</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENTRYPOINT </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/main&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>generate the image:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker build . -t xiaoyureed/hellok8s:v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># when build, this error occurred:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 出现“failed to solve with frontend dockerfile.v0: failed to create LLB definition: failed to copy: httpReadSeeker: failed open: failed to do request:”</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Just need to setup the docker desktop config:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &quot;features&quot;: { buildkit: false}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># start</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -p 3000:3000 --name hellok8s -d xiaoyureed/hellok8s:v1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="72-working-with-frontend">7.2. working with frontend<a href="#72-working-with-frontend" class="hash-link" aria-label="7.2. working with frontend的直接链接" title="7.2. working with frontend的直接链接">​</a></h2><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">FROM node:latest AS builder</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR /usr/src/app</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY package.json yarn.lock ./</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN yarn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY . ./</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN yarn build</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY --from=builder /usr/src/app/dist /usr/share/nginx/html</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY nginx.conf /etc/nginx/conf.d/default.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="73-最佳实践-优化体积">7.3. 最佳实践 优化体积<a href="#73-最佳实践-优化体积" class="hash-link" aria-label="7.3. 最佳实践 优化体积的直接链接" title="7.3. 最佳实践 优化体积的直接链接">​</a></h2><p><a href="https://github.com/phusion/baseimage-docker" target="_blank" rel="noopener noreferrer">https://github.com/phusion/baseimage-docker</a> 体积最小的 Linux</p><p><a href="https://www.infoq.cn/article/3-simple-tricks-for-smaller-docker-images" target="_blank" rel="noopener noreferrer">https://www.infoq.cn/article/3-simple-tricks-for-smaller-docker-images</a>
<a href="https://segmentfault.com/a/1190000017858358" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000017858358</a>
<a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/develop/develop-images/dockerfile_best-practices/</a>
<a href="https://fuckcloudnative.io/posts/docker-images-part1-reducing-image-size/" target="_blank" rel="noopener noreferrer">https://fuckcloudnative.io/posts/docker-images-part1-reducing-image-size/</a>
TODO</p><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 编译</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM node:latest AS builder</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">maintainer xiaoyu &lt;775000738@qq.com&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR /usr/src/app</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY package.json yarn.lock ./</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN yarn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 复制当前路径(通过 docker build -t xxx . 这个 点 指定)下所有文件到 目录 ${workdir}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY . ./</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN yarn build</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 实际镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY --from=builder /usr/src/app/dist /usr/share/nginx/html</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY nginx.conf /etc/nginx/conf.d/default.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="74-通过-dockerfile-来-build-镜像">7.4. 通过 dockerfile 来 build 镜像<a href="#74-通过-dockerfile-来-build-镜像" class="hash-link" aria-label="7.4. 通过 dockerfile 来 build 镜像的直接链接" title="7.4. 通过 dockerfile 来 build 镜像的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker build [-f MyDockerfile] -t xiaoyureed/myImage:v1 .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="75-commit容器成为镜像不推荐">7.5. commit容器成为镜像(不推荐)<a href="#75-commit容器成为镜像不推荐" class="hash-link" aria-label="7.5. commit容器成为镜像(不推荐)的直接链接" title="7.5. commit容器成为镜像(不推荐)的直接链接">​</a></h2><p>将自定义的容器保存为镜像, 一般不用commit制作镜像, 因为会有大量的无关内容被添加进来，如果不小心地清理，将会导致镜像极为臃肿。)</p><p><code>docker commit [选项] &lt;容器ID或容器名&gt; [&lt;仓库名&gt;[:&lt;标签&gt;]]</code></p><p>镜像是多层存储，每一层是在前一层的基础上进行的修改；而容器同样也是多层存储，是在以镜像为基础层，在其基础上加一层作为容器运行时的存储层</p><p>先看一个例子: 定制一个 web server</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 用 nginx 镜像启动一个容器，命名为 webserver，并且映射了 80 端口，这样我们可以用浏览器去访问这个 nginx 服务器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run --name webserver -d -p 80:80 nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 进入container内部, 打开bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker exec -it webserver bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 用 &lt;h1&gt;Hello, Docker!&lt;/h1&gt; 覆盖了 /usr/share/nginx/html/index.html 的内容</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">echo &#x27;&lt;h1&gt;Hello, Docker!&lt;/h1&gt;&#x27; &gt; /usr/share/nginx/html/index.html</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>浏览器输入虚拟机的ip地址即可访问;(<code>docker-machine env</code>可以查看虚拟机ip)</p><p>现在希望commit这个新的镜像</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 先退出container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 看下图</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker commit --author &quot;xy&lt;775000738@qq.com&gt;&quot; --message &quot;修改 index.html&quot; webserver nginx:v2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 启动第二个container, 浏览器访问81端口;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 至此, 手动操作给旧的镜像添加了新的一层，形成新的镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run --name test_1 -d -p 81:80 nginx:v2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>docker history nginx:v2</code> 查看某个Repository的历史提交记录</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="76-从压缩包导入">7.6. 从压缩包导入<a href="#76-从压缩包导入" class="hash-link" aria-label="7.6. 从压缩包导入的直接链接" title="7.6. 从压缩包导入的直接链接">​</a></h2><p>格式：<code>docker import [选项] &lt;文件&gt;|&lt;URL&gt;|- [&lt;仓库名&gt;[:&lt;标签&gt;]]</code></p><p>eg:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 这条命令自动下载了 ubuntu-14.04-x86_64-minimal.tar.gz 文件，并且作为根文件系统展开导入，并保存为镜像 openvz/ubuntu:14.04</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker import \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    http://download.openvz.org/template/precreated/ubuntu-14.04-x86_64-minimal.tar.gz \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    openvz/ubuntu:14.04</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="77-docker-save-和-docker-load">7.7. docker save 和 docker load<a href="#77-docker-save-和-docker-load" class="hash-link" aria-label="7.7. docker save 和 docker load的直接链接" title="7.7. docker save 和 docker load的直接链接">​</a></h2><p>Docker 还提供了 docker load 和 docker save 命令，用以将镜像保存为一个 tar 文件，然后传输到另一个位置上，再加载进来。这是在没有 Docker Registry 时的做法，现在已经不推荐，镜像迁移应该直接使用 Docker Registry，无论是直接使用 Docker Hub 还是使用内网私有 Registry </p><p><code>docker save alpine | gzip &gt; alpine-latest.tar.gz</code> 保存之后复制到其他机器, <code>docker load -i alpine-latest.tar.gz</code>加载镜像</p><p><code>docker save &lt;镜像名&gt; | bzip2 | pv | ssh &lt;用户名&gt;@&lt;主机名&gt; &#x27;cat | docker load&#x27;</code>从一个机器将镜像迁移到另一个机器，并且带进度条的功能</p><h1>8. Dockerfile</h1><p>通过dockerfile来build定制镜像</p><p>是  一种构建image的 文件DSL</p><p>Dockerfile 是一个文本文件，其内包含了一条条的指令(Instruction)，<code>每一条指令构建一层</code>，因此每一条指令的内容，就是描述该层应当如何构建。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="81-from">8.1. from<a href="#81-from" class="hash-link" aria-label="8.1. from的直接链接" title="8.1. from的直接链接">​</a></h2><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">FROM</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token literal-property property">指令</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> 指定基础镜像</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> 一个 </span><span class="token maybe-class-name">Dockerfile</span><span class="token plain"> 中 </span><span class="token constant" style="color:rgb(129, 31, 63)">FROM</span><span class="token plain"> 是必备的指令，并且必须是第一条指令。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token maybe-class-name">Docker</span><span class="token plain"> 还存在一个特殊的镜像，名为 scratch。这个镜像是虚拟的概念，并不实际存在，它表示一个空白的镜像</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"> </span><span class="token property-access">如果你以</span><span class="token plain"> scratch 为基础镜像的话，意味着你不以任何镜像为基础，接下来所写的指令将作为镜像第一层开始存在。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    可以 </span><span class="token keyword module" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> xxx </span><span class="token keyword module" style="color:rgb(0, 0, 255)">as</span><span class="token plain"> builder</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 后面可以在 scratch 中引用 $</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">builder</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> 以缩小 image 体积</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>编写完毕, 可以键入构建命令: <code>docker build [选项] &lt; 上下文路径/URL/- &gt;</code></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 在dockerfile所在的目录运行, -t表示指定最终镜像名称, 这里的[.]表示上下文路径</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker build -t nginx:v3 .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="82-镜像的构建上下文context">8.2. 镜像的构建上下文context<a href="#82-镜像的构建上下文context" class="hash-link" aria-label="8.2. 镜像的构建上下文context的直接链接" title="8.2. 镜像的构建上下文context的直接链接">​</a></h2><p>docker build 命令构建镜像，其实并非在本地构建，而是在服务端，也就是 Docker 引擎中构建的。那么在这种客户端/服务端的架构中，如何才能让服务端获得本地文件呢？</p><p><code>docker build -t nginx:v3 .</code> 这里的<!-- -->[.]<!-- -->不是命令当前所在的目录, 而是指定docker context路径, Dockerfile中的路径都是相对于这个contxt路径来说的</p><p>一般应该会将 Dockerfile 置于一个空目录下，或者项目根目录下。如果该目录下没有所需文件，那么应该把所需文件复制一份过来。如果目录下有些东西确实不希望构建时传给 Docker 引擎，那么可以用 .gitignore 一样的语法写一个 <code>.dockerignore</code>，该文件是用于剔除不需要作为上下文传递给 Docker 引擎的。</p><p>在默认情况下，如果不额外指定 Dockerfile 的话，会将上下文目录下的名为 Dockerfile 的文件作为 Dockerfile;实际上 Dockerfile 的文件名并不要求必须为 Dockerfile，而且并不要求必须位于上下文目录中，比如可以用 <code>-f ../Dockerfile.php</code> 参数指定某个文件作为 Dockerfile。</p><p>docker build还支持从git repo中拉取文件构建<code>docker build https://github.com/twang2218/gitlab-ce-zh.git#:8.14</code>这行命令指定了构建所需的 Git repo，并且指定默认的 master 分支，构建目录为 /8.14/，然后 Docker 就会自己去 git clone 这个项目、切换到指定分支、并进入到指定目录后开始构建</p><p>还支持<code>docker build http://server/context.tar.gz</code>从压缩包构建</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="821-dockerignore">8.2.1. dockerignore<a href="#821-dockerignore" class="hash-link" aria-label="8.2.1. dockerignore的直接链接" title="8.2.1. dockerignore的直接链接">​</a></h3><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">similar </span><span class="token maybe-class-name">To</span><span class="token plain"> gitignore</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="83-copy-和-add">8.3. COPY 和 ADD<a href="#83-copy-和-add" class="hash-link" aria-label="8.3. COPY 和 ADD的直接链接" title="8.3. COPY 和 ADD的直接链接">​</a></h2><p>复制文件</p><p>和 RUN 指令一样，也有两种格式，一种类似于命令行，一种类似于函数调用:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token constant" style="color:rgb(129, 31, 63)">COPY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">source1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">source2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">target</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">源路径</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> 可以是多个，甚至可以是通配符，其通配符规则要满足 </span><span class="token maybe-class-name">Go</span><span class="token plain"> 的 filepath</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access maybe-class-name">Match</span><span class="token plain"> 规则</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">目标路径</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> 可以是容器内的绝对路径，也可以是相对于工作目录的相对路径（工作目录可以用 </span><span class="token constant" style="color:rgb(129, 31, 63)">WORKDIR</span><span class="token plain"> 指令来指定）</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 如果不是一个文件，则必须使用</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">结束</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  若 source 是文件</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> target 是 </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> 结尾</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 则 docker 会把 target 视为目录</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> source will be copied to the dir</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> target dir missing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> will auto create</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  若 source 是文件</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> target 不是 </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> 结尾</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">则 docker 会把 target 视为文件</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> the target missing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> it will be auto </span><span class="token function" style="color:rgb(0, 0, 255)">created</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">equal to source file</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> the target exist</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> it will be override </span><span class="token keyword" style="color:rgb(0, 0, 255)">with</span><span class="token plain"> the source file content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> the source is a folder and the sources only contains one </span><span class="token function" style="color:rgb(0, 0, 255)">folder</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">文件夹本身会被复制</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 内部的文件也会被复制</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> and the target </span><span class="token function" style="color:rgb(0, 0, 255)">missing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">无论是不是 </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> 结尾都会视为文件夹</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> the target will be auto created</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> the source is a folder and the sources contains more than one </span><span class="token function" style="color:rgb(0, 0, 255)">folder</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">文件夹本身不会被复制</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 仅仅内部文件复制</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token literal-property property">eg</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token constant" style="color:rgb(129, 31, 63)">COPY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">json</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">src</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">app</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token constant" style="color:rgb(129, 31, 63)">COPY</span><span class="token plain"> hom</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">mydir</span><span class="token regex regex-delimiter">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token constant" style="color:rgb(129, 31, 63)">COPY</span><span class="token plain"> hom</span><span class="token operator" style="color:rgb(0, 0, 0)">?.</span><span class="token plain">txt </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mydir</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>add命令: 更高级的复制命令, 类似 copy, 还支持从 URL 复制文件, 还支持复制本地tar文件并自动解压缩</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="84-workdir-指定工作目录">8.4. WORKDIR 指定工作目录<a href="#84-workdir-指定工作目录" class="hash-link" aria-label="8.4. WORKDIR 指定工作目录的直接链接" title="8.4. WORKDIR 指定工作目录的直接链接">​</a></h2><p>使用 WORKDIR 指令可以来指定工作目录（或者称为当前目录），就是将当前执行命令的目录定义为确定值, 以后各层的当前目录就被改为指定的目录</p><p>格式为 <code>WORKDIR &lt;absolutePath/relativePath&gt;</code>。(如该目录不存在，WORKDIR 会帮你建立目录, relative path: 它将相对于前一个 WORKDIR 指令的路径, 为了避免出错，推荐WORKDIR指令中只使用绝对路径)</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR /a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR b</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN pwd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 输出将会是 /a/b/c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>WORKDIR 指令可以使用前面 ENV 设置的环境变量</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ENV DIRPATH=/path</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR $DIRPATH/$DIRNAME</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN pwd    </span><span class="token comment" style="color:rgb(0, 128, 0)"># /path/$DIRNAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="85-run-cmd-和-entrypoint-容器启动命令">8.5. run cmd 和 entrypoint 容器启动命令<a href="#85-run-cmd-和-entrypoint-容器启动命令" class="hash-link" aria-label="8.5. run cmd 和 entrypoint 容器启动命令的直接链接" title="8.5. run cmd 和 entrypoint 容器启动命令的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="851-设置时区">8.5.1. 设置时区<a href="#851-设置时区" class="hash-link" aria-label="8.5.1. 设置时区的直接链接" title="8.5.1. 设置时区的直接链接">​</a></h3><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ENV TZ=Asia/Shanghai</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo Asia/Shanghai &gt; /etc/timezone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 将时区设置为东八区并安装bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN echo &quot;https://mirrors.aliyun.com/alpine/v3.8/main/&quot; &gt; /etc/apk/repositories \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; echo &quot;https://mirrors.aliyun.com/alpine/v3.8/community/&quot; &gt;&gt; /etc/apk/repositories \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; apk add --no-cache tzdata \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime  \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; echo Asia/Shanghai &gt; /etc/timezone \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; apk del tzdata \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; apk update \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; apk upgrade \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; apk add --no-cache bash \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bash-doc \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bash-completion \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; rm -rf /var/cache/apk/*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="852-常见的错误用法">8.5.2. 常见的错误用法<a href="#852-常见的错误用法" class="hash-link" aria-label="8.5.2. 常见的错误用法的直接链接" title="8.5.2. 常见的错误用法的直接链接">​</a></h3><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># case1: pid 的问题</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># shell 格式底层使用 /bin/sh -c 来执行, 这会导致容器中 PID 为 1 的进程是 /bin/sh 而不是 ENTRYPOINT 中指定的 Java</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 所以当我们使用 docker stop 停止容器时，接收到 SIGTERM 信号的是 /bin/sh 而不是 Java，我们的 Java 进程就不能优雅退出了</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENTRYPOINT java -jar /app.java</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 解决:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 如果一定要用 shell 格式, 可以使用 exec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENTRYPOINT exec java -jar /app.java</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># or (推荐)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># exec 格式 就是使用 exec 来执行的，可以确保容器中 PID 为 1 的进程是 ENTRYPOINT 中指定的进程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># or Shell 脚本</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY run.sh run.sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN chmod +x run.sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENTRYPOINT [&quot;./run.sh&quot;]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#!/bin/sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">exec java -jar /app.jar</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># case2: 变量替换的问题</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 直接使用 exec 执行，并没有使用 Shell, 不支持变量替换</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENTRYPOINT [&quot;java&quot;, &quot;${JAVA_OPTS}&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 解决:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 通过 shell 脚本 (推荐)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#!/bin/sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">exec java ${JAVA_OPTS} -jar /app.jar ${@}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENTRYPOINT [&quot;sh&quot;, &quot;-c&quot;, &quot;java ${JAVA_OPTS} -jar /app.jar&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="853-都支持两种格式-shell-和-exec-的区别">8.5.3. 都支持两种格式 shell 和 exec 的区别<a href="#853-都支持两种格式-shell-和-exec-的区别" class="hash-link" aria-label="8.5.3. 都支持两种格式 shell 和 exec 的区别的直接链接" title="8.5.3. 都支持两种格式 shell 和 exec 的区别的直接链接">​</a></h3><p>shell 格式 在启动时是使用 /bin/sh -c 来执行的，这会导致容器中 PID 为 1 的进程是 /bin/sh 而不是 ENTRYPOINT 中指定的 Java，所以当我们使用 docker stop 停止容器时，接收到 SIGTERM 信号的是 /bin/sh 而不是 Java，我们的 Java 进程就不能优雅退出了</p><blockquote><p>为了解决这个问题，在使用 shell 格式时, 一般在执行的命令前加上 exec: <code>ENTRYPOINT exec java -jar /app.java</code></p></blockquote><p>而 exec 格式 就是使用 exec 来执行的，可以确保容器中 PID 为 1 的进程是 ENTRYPOINT 中指定的进程，</p><blockquote><p>一般推荐使用这种格式，而且还可以配合 CMD 指令内置程序的命令行参数，shell 格式 下 CMD 是无效的。</p></blockquote><blockquote><p>当以shell形式执行指令时，由于它会调用 <code>/bin/sh -c</code> 并进行正常的shell处理, 会发生变量替换, 而 exec 格式就不会有变量替换</p></blockquote><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ENV name John Dow</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENTRYPOINT echo &quot;Hello, $name&quot;      # will replace</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="854-run">8.5.4. run<a href="#854-run" class="hash-link" aria-label="8.5.4. run的直接链接" title="8.5.4. run的直接链接">​</a></h3><p><code>RUN</code>指令: 执行命令 (每一个 RUN 都是启动一个容器 -&gt; 执行命令 -&gt; 然后提交存储层文件变更), 用于在新图层中执行命令并创建新图像</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    两种格式 , shell 格式：RUN &lt;命令&gt;; 就像直接在命令行中输入的命令一样</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # 所有的命令只有一个目的，就是编译、安装 redis 可执行文件。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    FROM debian:jessie</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    RUN buildDeps=&#x27;gcc libc6-dev make&#x27; \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; apt-get update \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; apt-get install -y $buildDeps \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; wget -O redis.tar.gz &quot;http://download.redis.io/releases/redis-3.2.5.tar.gz&quot; \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; mkdir -p /usr/src/redis \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; make -C /usr/src/redis \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; make -C /usr/src/redis install \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # 必要的清理工作, 保证每一层没有垃圾</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; rm -rf /var/lib/apt/lists/* \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; rm redis.tar.gz \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; rm -r /usr/src/redis \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; apt-get purge -y --auto-remove $buildDeps</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    还有一种 exec 格式：RUN [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;]，这更像是函数调用中的格式</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8541-典型错误">8.5.4.1. 典型错误<a href="#8541-典型错误" class="hash-link" aria-label="8.5.4.1. 典型错误的直接链接" title="8.5.4.1. 典型错误的直接链接">​</a></h4><p>如下, 是错误的, 两条run命令在内存上实际是没有联系的</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 希望在 /app 下创建文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN cd /app</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN echo &quot;hello&quot; &gt; world.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR /app</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN echo &quot;hello&quot; &gt; world.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="855-cmd指令">8.5.5. cmd指令<a href="#855-cmd指令" class="hash-link" aria-label="8.5.5. cmd指令的直接链接" title="8.5.5. cmd指令的直接链接">​</a></h3><p>CMD 指令就是用于指定默认的容器主进程的启动命令, 等效于 命令行中 image 后跟的命令</p><blockquote><p>若命令行 image 后没有跟命令, 则执行 dockerfile 中的 cmd, 若 image 后有命令, 则覆盖 dockerfile 中的 cmd</p><p>比如，ubuntu 镜像默认的 CMD 是 /bin/bash，如果我们直接<code> docker run -it ubuntu</code> 的话，会直接进入 bash。
<code>docker run -it ubuntu cat /etc/os-release</code>。这就是用 cat /etc/os-release 命令替换了默认的 /bin/bash 命令了，输出了系统版本信息。</p></blockquote><p>cmd 结束了, 容器也就退出了</p><blockquote><p>eg: <code>CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</code> 直接执行 nginx 可执行文件，并且要求以前台形式运行(CMD service nginx start是错的, 此时是&quot;sh&quot;这只程序作为主程序, 它运行结束, 容器就退出了)</p></blockquote><p>格式: </p><p><code>CMD [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;...]</code></p><p><code>CMD [&quot;param1&quot;,&quot;param2&quot;] </code> 在使用 ENTRYPOINT 指定了起始命令后，cmd 语法就变了, 参数会传递给 entrypoint</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="856-entrypoint-入口点">8.5.6. ENTRYPOINT 入口点<a href="#856-entrypoint-入口点" class="hash-link" aria-label="8.5.6. ENTRYPOINT 入口点的直接链接" title="8.5.6. ENTRYPOINT 入口点的直接链接">​</a></h3><p>指定容器启动后执行的命令</p><blockquote><p>类似 cmd, 只是一旦和 cmd 一起使用, 可以将cmd当作参数传给 enterpoint
(利用这点可以制作这种镜像: 可以当做可执行文件运行的镜像, 即能够在镜像名后面直接跟参数)</p></blockquote><p>但是 shell &amp; exec 格式区别很大:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token constant" style="color:rgb(129, 31, 63)">ENTRYPOINT</span><span class="token plain">的Exec形式允许您设置命令和参数，然后使用</span><span class="token constant" style="color:rgb(129, 31, 63)">CMD</span><span class="token plain">来设置更可能更改的其他参数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token literal-property property">如</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token constant" style="color:rgb(129, 31, 63)">ENTRYPOINT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/bin/echo&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Hello&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token constant" style="color:rgb(129, 31, 63)">CMD</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;world&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">     # 这里的命令可以被命令行覆盖</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 若命令行直接运行</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 会正常打印 </span><span class="token maybe-class-name">Hello</span><span class="token plain"> world</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 若命令行后跟 xxx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 会打印 </span><span class="token maybe-class-name">Hello</span><span class="token plain"> xxx </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><span class="token maybe-class-name">Shell形式的</span><span class="token constant" style="color:rgb(129, 31, 63)">ENTRYPOINT</span><span class="token plain">忽略任何</span><span class="token constant" style="color:rgb(129, 31, 63)">CMD</span><span class="token plain">或运行命令行参数。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8561-eg-让镜像变成像命令一样使用">8.5.6.1. eg: 让镜像变成像命令一样使用<a href="#8561-eg-让镜像变成像命令一样使用" class="hash-link" aria-label="8.5.6.1. eg: 让镜像变成像命令一样使用的直接链接" title="8.5.6.1. eg: 让镜像变成像命令一样使用的直接链接">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 获取自己的公网ip, Dockerfile如下:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 命令无法在后面接curl的参数, 比如直接在后面加&quot;-i&quot;, 会把默认的cmd整个替换而出错,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM ubuntu:16.04</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN apt-get update \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; apt-get install -y curl \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD [ &quot;curl&quot;, &quot;-s&quot;, &quot;http://ip.cn&quot; ]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 构建镜像 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker build -t myip .</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 测试:查询ip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run myip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#  不完美的解决方法如下: 通过 curl -s http://ip.cn -i 覆盖镜像内的 curl -s http://ip.cn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run myip curl -s http://ip.cn -i</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">## 上面的命令太啰嗦了, 正确的方法是修改Dockerfile, 用ENTERYPOINT代替CMD</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM ubuntu:16.04</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN apt-get update \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; apt-get install -y curl \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENTRYPOINT [ &quot;curl&quot;, &quot;-s&quot;, &quot;http://ip.cn&quot; ]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 现在可以正常使用&quot;-i&quot;参数了, 命令行的参数会直接跟在entrypoint 后面</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run myip -i</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8562-eg-应用运行前的准备工作">8.5.6.2. eg: 应用运行前的准备工作<a href="#8562-eg-应用运行前的准备工作" class="hash-link" aria-label="8.5.6.2. eg: 应用运行前的准备工作的直接链接" title="8.5.6.2. eg: 应用运行前的准备工作的直接链接">​</a></h4><p>(这些准备工作是和容器 CMD 无关的，无论 CMD 为什么，都需要事先进行一个预处理的工作。</p><p>这种情况下，可以写一个脚本，然后放入 ENTRYPOINT 中去执行，而这个脚本会将接到的参数（也就是 <code>&lt;CMD&gt;</code>）作为命令，在脚本最后执行)</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 可以看到其中为了 redis 服务创建了 redis 用户，并在最后指定了 ENTRYPOINT 为 docker-entrypoint.sh 脚本。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM alpine:3.4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN addgroup -S redis &amp;&amp; adduser -S -G redis redis</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENTRYPOINT [&quot;docker-entrypoint.sh&quot;]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EXPOSE 6379</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD [ &quot;redis-server&quot; ]  # 这里会作为参数传递给 Entrypoint</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># docker-entrypoint.sh ,该脚本的内容就是根据 CMD 的内容来判断，</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 如果是 redis-server 的话，则切换到 redis 用户身份启动服务器，否则依旧使用 root 身份执行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#!/bin/sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># allow the container to be started with `--user`</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">if [ &quot;$1&quot; = &#x27;redis-server&#x27; -a &quot;$(id -u)&quot; = &#x27;0&#x27; ]; then</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    chown -R redis .</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    exec su-exec redis &quot;$0&quot; &quot;$@&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">exec &quot;$@&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="86-env-和-arg-设置变量">8.6. ENV 和 arg 设置变量<a href="#86-env-和-arg-设置变量" class="hash-link" aria-label="8.6. ENV 和 arg 设置变量的直接链接" title="8.6. ENV 和 arg 设置变量的直接链接">​</a></h2><p>env 是设置环境变量, 定义后, 可以在 dockerfile/命令行 中使用, 也可以在 container 内部供程序使用</p><p>格式有两种：</p><ul><li><code>ENV &lt;key&gt; &lt;value&gt;</code></li><li><code>ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</code></li></ul><p>eg:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ENV VERSION=1.0 DEBUG=on \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    NAME=&quot;Happy Feet&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENV NODE_VERSION 7.2.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN curl -SLO &quot;https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz&quot; \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &amp;&amp; curl -SLO &quot;https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc&quot; \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &amp;&amp; gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &amp;&amp; grep &quot; node-v$NODE_VERSION-linux-x64.tar.xz\$&quot; SHASUMS256.txt | sha256sum -c - \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &amp;&amp; tar -xJf &quot;node-v$NODE_VERSION-linux-x64.tar.xz&quot; -C /usr/local --strip-components=1 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &amp;&amp; rm &quot;node-v$NODE_VERSION-linux-x64.tar.xz&quot; SHASUMS256.txt.asc SHASUMS256.txt \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &amp;&amp; ln -s /usr/local/bin/node /usr/local/bin/nodejs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ARG 是设置构建参数, 仅仅用于 dockerfile/命令行 中使用, 在将来容器运行时是不会存在这些环境变量的 </p><blockquote><p>但是不要因此就使用 ARG 保存密码之类的信息，因为 docker history 还是可以看到所有值的</p></blockquote><p>可以在构建命令 docker build 中用 <code>--build-arg &lt;参数名&gt;=&lt;值&gt;</code> 来覆盖。</p><blockquote><p>Define a variable that users can pass a value to at build-time with <code>docker build</code></p></blockquote><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ARG JAR_FILE=target/*.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="87-volume-定义匿名数据卷">8.7. VOLUME 定义匿名数据卷<a href="#87-volume-定义匿名数据卷" class="hash-link" aria-label="8.7. VOLUME 定义匿名数据卷的直接链接" title="8.7. VOLUME 定义匿名数据卷的直接链接">​</a></h2><p>对于数据库类需要保存动态数据的应用，其数据库文件/动态数据应该保存于卷(volume)中, 而不要直接写入容器存储层</p><p>为了防止运行时用户忘记将动态文件所保存目录挂载为卷，在 Dockerfile 中，我们可以事先指定某些目录挂载到匿名卷，这样在运行时如果用户不指定挂载,动态数据会写入匿名卷</p><p>格式为：</p><ul><li><code>VOLUME [&quot;&lt;路径1&gt;&quot;, &quot;&lt;路径2&gt;&quot;...]</code></li><li><code>VOLUME &lt;路径&gt;</code></li></ul><p><code>VOLUME /data</code> 这里的 /data 目录是容器内的目录, 会在运行时自动挂载为匿名卷，任何向 /data 中写入的信息都不会记录进容器存储层，从而保证了容器存储层的无状态化。可以进入 container, 使用 <code>ll</code> 查看, 会发现容器自动创建了目录 /data, 并挂载为匿名数据卷</p><p>当然，运行时可以覆盖这个挂载设置<code>docker run -d -v mydata:/data xxxx</code>在这行命令中，就使用了 mydata 这个命名卷挂载到了 /data 这个位置，替代了 Dockerfile 中定义的匿名卷的挂载配置</p><p>为什么在 dockerfile 中无法使用 类似 <code>docker -run -v /host_path:/container_path</code> 的效果? 这时出于可移植和分享的考虑, 因为不是每个 宿主机都一定有这样的 &quot;host_path&quot; 特定目录</p><p>匿名数据卷的数据在宿主机哪里呢? <code>docker inspect &lt;container&gt;</code> 可以在json的 volumes 值看到</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="88-expose-声明端口">8.8. EXPOSE 声明端口<a href="#88-expose-声明端口" class="hash-link" aria-label="8.8. EXPOSE 声明端口的直接链接" title="8.8. EXPOSE 声明端口的直接链接">​</a></h2><p>格式为<code> EXPOSE &lt;端口1&gt; [&lt;端口2&gt;...]</code>。</p><p>EXPOSE 指令是声明运行时容器提供服务的端口, 这只是一个声明，在运行时并不会因为这个声明应用就会开启这个端口的服务 (必须程序开通端口, 这里的声明才有效)</p><blockquote><p>要将 EXPOSE 和在运行时使用<code> -p &lt;宿主端口&gt;:&lt;容器端口&gt;</code> 区分开来。-p，是映射宿主端口和容器端口，换句话说，就是将容器的对应端口服务公开给外界访问，而 EXPOSE 仅仅是声明容器打算使用什么端口而已，并不会自动在宿主进行端口映射</p></blockquote><p>那既然只是一个声明, 并没有实际暴露端口, 有什么用呢? 在 Dockerfile 中写入这样的声明有两个好处</p><ul><li>一个是帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射；
</li><li>另一个用处则是在运行时使用随机端口映射时，也就是 docker run -P 时，会自动随机映射 EXPOSE 的端口</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="89-user-指定当前用户">8.9. USER 指定当前用户<a href="#89-user-指定当前用户" class="hash-link" aria-label="8.9. USER 指定当前用户的直接链接" title="8.9. USER 指定当前用户的直接链接">​</a></h2><p>USER指令用于指定容器执行程序的用户身份，默认是 root用户。</p><p>在docker run 中可以通过 -u 选项来覆盖USER指令的设置。</p><blockquote><p>eg: docker run -i -t -u mysql newmysqldb /bin/bash, 可以发现显示的shell提示符是： mysql@57cd57edba38:/$</p><p>docker容器中的root用户密码是随机分配的</p></blockquote><blockquote><p>USER 指令和 WORKDIR 相似，都是改变环境状态并影响以后的层。WORKDIR 是改变工作目录，USER 则是改变之后层执行 RUN, CMD 以及 ENTRYPOINT 这类命令的身份</p></blockquote><p>格式：<code>USER &lt;用户名&gt;</code> </p><blockquote><p>这个用户必须是事先建立好的，否则无法切换。</p></blockquote><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">RUN groupadd -r redis &amp;&amp; useradd -r -g redis redis</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">USER redis</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN [ &quot;redis-server&quot; ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>eg2:希望以某个已经建立好的用户来运行某个服务进程，不要使用 su 或者 sudo，这些都需要比较麻烦的配置，而且在 TTY 缺失的环境下经常出错。建议使用 gosu</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 建立 redis 用户，并使用 gosu 换另一个用户执行命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN groupadd -r redis &amp;&amp; useradd -r -g redis redis</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 下载 gosu</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN wget -O /usr/local/bin/gosu &quot;https://github.com/tianon/gosu/releases/download/1.7/gosu-amd64&quot; \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; chmod +x /usr/local/bin/gosu \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &amp;&amp; gosu nobody true</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 设置 CMD，并以另外的用户执行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD [ &quot;exec&quot;, &quot;gosu&quot;, &quot;redis&quot;, &quot;redis-server&quot; ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="810-healthcheck-健康检查">8.10. HEALTHCHECK 健康检查<a href="#810-healthcheck-健康检查" class="hash-link" aria-label="8.10. HEALTHCHECK 健康检查的直接链接" title="8.10. HEALTHCHECK 健康检查的直接链接">​</a></h2><p>HEALTHCHECK 指令是告诉 Docker 应该如何进行判断容器的状态是否正常(来自 1.12 之后，Docker 提供了 HEALTHCHECK 指令，通过该指令指定一行命令，用这行命令来判断容器主进程的服务状态是否还正常，从而比较真实的反应容器实际状态。)</p><p>为什么出现呢? </p><p>在没有 HEALTHCHECK 指令前，Docker 引擎只可以通过容器内主进程是否退出来判断容器是否状态异常。很多情况下这没问题，但是如果程序进入死锁状态，或者死循环状态，应用进程并不退出，但是该容器已经无法提供服务了。在 1.12 以前，Docker 不会检测到容器的这种状态，从而不会重新调度，导致可能会有部分容器已经无法提供服务了却还在接受用户请求</p><p>生效的原理: 当在一个镜像指定了 HEALTHCHECK 指令后，用其启动容器，初始状态会为 <code>starting</code>，在 HEALTHCHECK 指令检查成功后变为 <code>healthy</code>，如果连续一定次数失败，则会变为 <code>unhealthy</code>。</p><p>和 CMD, ENTRYPOINT 一样，HEALTHCHECK 只可以出现一次，如果写了多个，只有最后一个生效</p><p>格式：</p><p><code>HEALTHCHECK [选项] CMD &lt;命令&gt;</code>：设置检查容器健康状况的命令; 命令部分的格式和 ENTRYPOINT 一样，分为 shell 格式，和 exec 格式。命令的返回值决定了该次健康检查的成功与否：0：成功；1：失败</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 设置了每 5 秒检查一次（这里为了试验所以间隔非常短，实际应该相对较长），如果健康检查命令超过 3 秒没响应就视为失败，并且使用 curl -fs http://localhost/ || exit 1 作为健康检查命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN apt-get update &amp;&amp; apt-get install -y curl &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">HEALTHCHECK --interval=5s --timeout=3s \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD curl -fs http://localhost/ || exit 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>支持如下选项:</p><ul><li><code>--interval=&lt;间隔&gt;</code>：两次健康检查的间隔，默认为 30 秒；</li><li><code>--timeout=&lt;时长&gt;</code>：健康检查命令运行超时时间，如果超过这个时间，本次健康检查就被视为失败，默认 30 秒；</li><li><code>--retries=&lt;次数&gt;</code>：当连续失败指定次数后，则将容器状态视为 unhealthy，默认 3 次。</li></ul><p>查看健康检查日志:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ docker inspect --format &#x27;{{json .State.Health}}&#x27; web | python -m json.tool</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;FailingStreak&quot;: 0,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;Log&quot;: [</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &quot;End&quot;: &quot;2016-11-25T14:35:37.940957051Z&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &quot;ExitCode&quot;: 0,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &quot;Output&quot;: &quot;&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Welcome to nginx!&lt;/title&gt;\n&lt;style&gt;\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n&lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;\n&lt;p&gt;If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.&lt;/p&gt;\n\n&lt;p&gt;For online documentation and support please refer to\n&lt;a href=\&quot;http://nginx.org/\&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;\nCommercial support is available at\n&lt;a href=\&quot;http://nginx.com/\&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;\n\n&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &quot;Start&quot;: &quot;2016-11-25T14:35:37.780192565Z&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;Status&quot;: &quot;healthy&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>另外, <code>HEALTHCHECK NONE</code>：如果基础镜像有健康检查指令，使用这行可以屏蔽掉其健康检查指令</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="811-onbuild-给别人用">8.11. ONBUILD 给别人用<a href="#811-onbuild-给别人用" class="hash-link" aria-label="8.11. ONBUILD 给别人用的直接链接" title="8.11. ONBUILD 给别人用的直接链接">​</a></h2><p>格式：<code>ONBUILD &lt;其它指令&gt;</code></p><p>ONBUILD 是一个特殊的指令，它后面跟的是其它指令，比如 RUN, COPY 等，而这些指令，在当前镜像构建时并不会被执行。只有当以当前镜像为基础镜像，去构建下一级镜像的时候才会被执行</p><p>下面以一个例子说明:</p><p>制作 Node.js 所写的应用的镜像:  Node.js 使用 npm 进行包管理，所有依赖、配置、启动信息等会放到 package.json 文件里。在拿到程序代码后，需要先进行 npm install 才可以获得所有需要的依赖。然后就可以通过 npm start 来启动应用</p><p>Dockerfile:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">FROM node:slim</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN mkdir /app # 可以省掉?</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR /app</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY ./package.json /app</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN [ &quot;npm&quot;, &quot;install&quot; ]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY . /app/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD [ &quot;npm&quot;, &quot;start&quot; ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>把这个 Dockerfile 放到 Node.js 项目的根目录，构建好镜像后，就可以直接拿来启动容器运行。</p><p>现在考虑这样的情景: </p><p>我们还有第二个 Node.js 项目, 和这个类似, 如果需要制作镜像, 需要再复制一份Dockerfile到项目根目录, 构建. 这里就涉及到重复了, 如果第一个项目新发现有问题, 修复后, 第二个项目也需要手动再次修复</p><p>初级改进: 制作一份基础镜像, 后续的Dockerfile FROM这个镜像</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 基础镜像, 名字为 my-node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM node:slim</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN mkdir /app</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR /app</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD [ &quot;npm&quot;, &quot;start&quot; ]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 其他子镜像, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 基础镜像变化后，各个项目都用这个 Dockerfile 重新构建镜像，会继承基础镜像的更新</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM my-node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY ./package.json /app</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN [ &quot;npm&quot;, &quot;install&quot; ]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY . /app/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>现在考虑这个场景: 如果子 Dockerfile 里面有些东西需要调整呢？比如 npm install 需要加一些参数，那怎么办？这一行 RUN 是不可能放入基础镜像的，那么只能每个 子 dockerfile 都修改 npm install 这条命令了, 能否将子file中的命令提到公共file 中而不执行呢?</p><p>ONBUILD 可以解决这个问题</p><p>基础镜像:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">FROM node:slim</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN mkdir /app</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR /app</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 下面三行在当前 dockerfile 构建时候不会执行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ONBUILD COPY ./package.json /app</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ONBUILD RUN [ &quot;npm&quot;, &quot;install&quot; ]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ONBUILD COPY . /app/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD [ &quot;npm&quot;, &quot;start&quot; ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后各个子项目的 Dockerfile 就变成了简单地</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 当在各个项目目录中，用这个只有一行的 Dockerfile 构建镜像时，之前基础镜像的那三行 ONBUILD 就会开始执行，成功的将当前项目的代码复制进镜像、并且针对本项目执行 npm install，生成应用镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM my-node</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="812-multi-stage-多阶段构建">8.12. multi-stage 多阶段构建<a href="#812-multi-stage-多阶段构建" class="hash-link" aria-label="8.12. multi-stage 多阶段构建的直接链接" title="8.12. multi-stage 多阶段构建的直接链接">​</a></h2><p>一种方式是将所有的构建过程包含在一个 Dockerfile 中，包括项目及其依赖库的编译、测试、打包等流程，这里可能会带来的一些问题：</p><ul><li><p>Dockerfile 特别长，可维护性降低</p></li><li><p>镜像层次多，镜像体积较大，部署时间变长</p></li><li><p>源代码存在泄露的风险</p></li></ul><p>好处是可以减小镜像体积</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8121-清理缓存的镜像">8.12.1. 清理缓存的镜像<a href="#8121-清理缓存的镜像" class="hash-link" aria-label="8.12.1. 清理缓存的镜像的直接链接" title="8.12.1. 清理缓存的镜像的直接链接">​</a></h3><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">crontab </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">e</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 每天夜里</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">点钟删除</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">天（48h）之前的image</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> docker image prune </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">a </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">force </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">filter </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;until=48h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl restart crond</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>9. 使用容器</h1><p>容器是独立运行的一个或一组应用，以及它们的运行态环境</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="91-use-docker-in-github-action">9.1. use docker in github action<a href="#91-use-docker-in-github-action" class="hash-link" aria-label="9.1. use docker in github action的直接链接" title="9.1. use docker in github action的直接链接">​</a></h2><p><a href="https://dev.to/mihinduranasinghe/using-docker-containers-in-jobs-github-actions-3eof" target="_blank" rel="noopener noreferrer">https://dev.to/mihinduranasinghe/using-docker-containers-in-jobs-github-actions-3eof</a></p><p><a href="https://yonatankra.com/2-ways-to-use-your-docker-image-in-github-actions/" target="_blank" rel="noopener noreferrer">https://yonatankra.com/2-ways-to-use-your-docker-image-in-github-actions/</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="92-查看">9.2. 查看<a href="#92-查看" class="hash-link" aria-label="9.2. 查看的直接链接" title="9.2. 查看的直接链接">​</a></h2><ul><li><code>docker container ls -a</code>or<code>docker ps -a</code> 查看所有, 包括处于终止状态的容器</li><li><code>docker container ls</code>or<code>docker ps</code> 仅查看运行状态的容器</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="93-启动">9.3. 启动<a href="#93-启动" class="hash-link" aria-label="9.3. 启动的直接链接" title="9.3. 启动的直接链接">​</a></h2><p>启动容器有两种方式，一种是基于镜像新建一个容器并启动(常用)，另外一个是将在终止状态（stopped）的容器重新启动。</p><p>新建容器并启动: <code>docker run &lt;容器名:版本&gt; &lt;命令&gt;</code>)</p><p>启动已有的容器: <code>docker start &lt;container&gt;</code> or <code>docker container start/restart xxx</code></p><p>当利用 docker run 来创建容器时，Docker 在后台进行如下流程:</p><ul><li>检查本地是否存在指定的镜像，不存在就从公有仓库下载</li><li>利用镜像创建并启动一个容器</li><li>分配一个文件系统，并在只读的镜像层外面挂载一层可读写层</li><li>从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去</li><li>从地址池配置一个 ip 地址给容器</li><li>执行用户指定的应用程序 (如果有的话)</li><li>执行完毕后容器被终止</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="931--it-维持交互终端">9.3.1. -it 维持交互终端<a href="#931--it-维持交互终端" class="hash-link" aria-label="9.3.1. -it 维持交互终端的直接链接" title="9.3.1. -it 维持交互终端的直接链接">​</a></h3><p>eg:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 输出一个 “Hello World”，之后终止容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run ubuntu:14.04 /bin/echo &#x27;Hello world&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Hello world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 启动一个 bash 终端，允许用户进行交互</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 其中，-t 选项让Docker分配一个伪终端（pseudo-tty）并绑定到容器的标准输入上， -i 则让容器的标准输入保持打开(以便交互式操作)。 -it 一般一起使用</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -t -i ubuntu:14.04 /bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@af8bae53bdd3:/#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="932--d-后台运行">9.3.2. -d 后台运行<a href="#932--d-后台运行" class="hash-link" aria-label="9.3.2. -d 后台运行的直接链接" title="9.3.2. -d 后台运行的直接链接">​</a></h3><p>前面都是在前台运行的, 如何以守护状态运行? 通过 <code>docker run -d</code></p><p>eg:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 如果不使用 -d 参数运行容器,容器会把输出的结果 (STDOUT) 打印到宿主机上面</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run ubuntu:17.10 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 如果使用了 -d 参数运行容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 此时容器会在后台运行, 宿主机器没有任何输出(输出结果可以用 docker logs 查看)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -d ubuntu:17.10 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">77b2dc01fe0f3f1265df143181e7b9af5e05279a884f4776ee75350ea9d8017a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查看容器日志</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker container logs &lt;container ID or NAMES&gt; </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker logs &lt;container id or name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="933---privilegedtrue-赋予特权">9.3.3. --privileged=true 赋予特权<a href="#933---privilegedtrue-赋予特权" class="hash-link" aria-label="9.3.3. --privileged=true 赋予特权的直接链接" title="9.3.3. --privileged=true 赋予特权的直接链接">​</a></h3><p>是否让docker 应用容器 获取宿主机root权限</p><p>使用该参数，container内的root拥有真正的root权限。
否则，container内的root只是外部的一个普通用户权限。
privileged启动的容器，可以看到很多host上的设备，并且可以执行mount。
甚至允许你在docker容器中启动docker容器。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="94-终止container">9.4. 终止container<a href="#94-终止container" class="hash-link" aria-label="9.4. 终止container的直接链接" title="9.4. 终止container的直接链接">​</a></h2><p><code>docker container stop &lt;xxx&gt;</code></p><p>此外，当 Docker 容器中指定的应用终结时，容器也自动终止(例如: 只启动了一个终端的容器，用户通过 exit 命令或 Ctrl+d 来退出终端时，所创建的容器立刻终止。)</p><p><code>docker container ls -a</code> 查看所有的container, 包括停止的container</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="95-删除container">9.5. 删除container<a href="#95-删除container" class="hash-link" aria-label="9.5. 删除container的直接链接" title="9.5. 删除container的直接链接">​</a></h2><p>container终止后, 不会删除, 需要手动删除</p><ul><li><code>docker container rm &lt;xxx&gt;</code> 删除指定container(容器处于终止状态)</li><li><code>docker container rm -f &lt;xxx&gt;</code>如果要删除一个运行中的容器，可以添加 -f 参数。Docker 会发送 SIGKILL 信号给容器</li><li><code>docker container prune</code> 删除所有终止的容器</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="96-进入容器">9.6. 进入容器<a href="#96-进入容器" class="hash-link" aria-label="9.6. 进入容器的直接链接" title="9.6. 进入容器的直接链接">​</a></h2><p>在使用 -d 参数时，容器启动后会进入后台, 某些时候需要进入容器进行操作，包括使用 docker attach 命令或 docker exec 命令(推荐后者, 因为后者exit时不会导致容器退出)</p><ul><li><p><code>docker attach &lt;xxx&gt;</code> 进入container, 当exit时, 容器也随之终止</p></li><li><p><code>docker exec -it &lt;xxx&gt; bash</code> 进入container, 退出时容器不会终止(注意, 后面要跟一个命令bash)</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="97-容器的导入和导出">9.7. 容器的导入和导出<a href="#97-容器的导入和导出" class="hash-link" aria-label="9.7. 容器的导入和导出的直接链接" title="9.7. 容器的导入和导出的直接链接">​</a></h2><p>导出</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ docker container ls -a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                    PORTS               NAMES</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">7691a814370e        ubuntu:14.04        &quot;/bin/bash&quot;         36 hours ago        Exited (0) 21 hours ago                       test</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker export 7691a814370e &gt; ubuntu.tar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样将导出容器快照到本地文件</p><p>导入容器快照为镜像:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ cat ubuntu.tar | docker import - test/ubuntu:v1.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker image ls</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">REPOSITORY          TAG                 IMAGE ID            CREATED              VIRTUAL SIZE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">test/ubuntu         v1.0                9d37a6082e97        About a minute ago   171.3 MB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 或者</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker import http://example.com/exampleimage.tgz example/imagerepo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>docker import和docker load比较: 容器快照文件(docker import)将丢弃所有的历史记录和元数据信息（即仅保存容器当时的快照状态），而镜像存储文件(docker load)将保存完整记录，体积也要大。此外，从容器快照文件导入时可以重新指定标签等元数据信息。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="98-拷贝容器内文件到主机">9.8. 拷贝容器内文件到主机<a href="#98-拷贝容器内文件到主机" class="hash-link" aria-label="9.8. 拷贝容器内文件到主机的直接链接" title="9.8. 拷贝容器内文件到主机的直接链接">​</a></h2><p><code>docker cp &lt;container_name&gt;:/path &lt;host_path&gt;</code></p><h1>10. 访问镜像仓库</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="101-dockerhub">10.1. dockerhub<a href="#101-dockerhub" class="hash-link" aria-label="10.1. dockerhub的直接链接" title="10.1. dockerhub的直接链接">​</a></h2><p><code>docker login</code>登录
<code>docker logout</code> 退出</p><p><code>docker search &lt;xxx&gt;</code> 搜索
<code>docker pull &lt;xxx&gt;</code> 下载到本地</p><p>推送镜像到自己的仓库:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 标记新的tag用于推送到远程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 即修改镜像名字 (不过一般在 build image 时就应该规范指定好最终名字)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker tag &lt;image_old_name/old_id&gt; xiaoyureed/ubuntu:17.10</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker image ls</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">REPOSITORY                                               TAG                    IMAGE ID            CREATED             SIZE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ubuntu                                                   17.10                  275d79972a86        6 days ago          94.6MB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">username/ubuntu                                          17.10                  275d79972a86        6 days ago          94.6MB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 推送</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker push xiaoyureed/ubuntu:17.10</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 现在搜索可以搜到了</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker search username</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                      DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">xiaoyureed/ubuntu</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此外, docker hub 支持 自动创建(Automated Builds), 对于需要经常升级镜像内程序来说，十分方便 </p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1011-publish-by-using-github-action">10.1.1. publish by using github action<a href="#1011-publish-by-using-github-action" class="hash-link" aria-label="10.1.1. publish by using github action的直接链接" title="10.1.1. publish by using github action的直接链接">​</a></h3><p><a href="https://twbhub.com/post/github-actions_publish_images/" target="_blank" rel="noopener noreferrer">https://twbhub.com/post/github-actions_publish_images/</a>
todo</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="102-私有仓库">10.2. 私有仓库<a href="#102-私有仓库" class="hash-link" aria-label="10.2. 私有仓库的直接链接" title="10.2. 私有仓库的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="allow-http">allow http<a href="#allow-http" class="hash-link" aria-label="allow http的直接链接" title="allow http的直接链接">​</a></h3><p>想让本网段的其他主机也能把镜像推送到私有仓库。你就得把例如 192.168.199.100:5000 这样的内网地址作为私有仓库地址，这时你会发现无法成功推送镜像。这是因为 Docker 默认不允许非 HTTPS 方式推送镜像。我们可以通过 Docker 的配置选项来取消这个限制:</p><p><code>/etc/docker/daemon.json</code></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;registry-mirror&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://hub-mirror.c.163.com&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://mirror.baidubce.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;insecure-registries&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;192.168.199.100:5000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="harbor推荐">harbor(推荐)<a href="#harbor推荐" class="hash-link" aria-label="harbor(推荐)的直接链接" title="harbor(推荐)的直接链接">​</a></h3><p><a href="https://github.com/goharbor/harbor" target="_blank" rel="noopener noreferrer">https://github.com/goharbor/harbor</a> , 带 gui, user management</p><blockquote><p>由VMWare在Docker Registry的基础之上进行了二次封装，加进去了很多额外程序，而且提供了一个非常漂亮的web界面。</p></blockquote><p>从私服拉取镜像: 先登录 <code> docker login -u admin -p xxx &lt;harbor ip&gt;</code>, 再拉取 <code>docker pull 182.168.xxx.xxx/org_name/img_name:v</code></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="k8s-配置harbor">k8s 配置harbor<a href="#k8s-配置harbor" class="hash-link" aria-label="k8s 配置harbor的直接链接" title="k8s 配置harbor的直接链接">​</a></h4><p>在任意节点 docker 登录 harbor 后, <code>/root/.docker/config.json</code> 能查看密码, 将 json 内容 base64 编码 <code>cat /root/.docker/config.json | base64 -w O</code>, 创建 secret.yml:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 值 &quot;login&quot; 会在 Deployment 中使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> login</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubernetes.io/dockerconfigjson</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">.dockerconfigjson</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> &lt;base64_value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>kc apply -f secret.yml</code></p><p>在 deployment 中如何使用?</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> &lt;harbor url</span><span class="token punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">/org/img_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">imagePullSecretes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置k8s 登录 harbor 时使用的 secret 名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> login</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nexus">Nexus<a href="#nexus" class="hash-link" aria-label="Nexus的直接链接" title="Nexus的直接链接">​</a></h3><p>多用于 搭建 Maven repo, 也能存储 docker image</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="docker-registry">docker-registry<a href="#docker-registry" class="hash-link" aria-label="docker-registry的直接链接" title="docker-registry的直接链接">​</a></h3><p>docker hub 提供, 一个镜像即可拉起来, 没有 gui, 但是社区有 gui</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker pull docker.io/registry:latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker pull konradkleine/docker-registry-frontend:v2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d  -p 5000:5000  --restart=always  --name registry docker.io/registry:latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d  --link registry:registry  --name registry-frontend  -e ENV_DOCKER_REGISTRY_HOST=registry  -e ENV_DOCKER_REGISTRY_PORT=5000  -p 9090:80  konradkleine/docker-registry-frontend:v2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>11. docker数据管理</h1><p>Docker container 产生的数据在 container 删除后就丢失了, 除非 commit 这个 container 生成新的 image, 那么如何保存这些数据呢:</p><ul><li><p>数据卷（Volumes）</p></li><li><p>挂载主机目录 (Bind mounts)</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="111-数据卷">11.1. 数据卷<a href="#111-数据卷" class="hash-link" aria-label="11.1. 数据卷的直接链接" title="11.1. 数据卷的直接链接">​</a></h2><p>docker 默认在主机上会有一个特定的区域（/var/lib/docker/volumes/ Linux），该区域用来存放 volume。volume 在生成的时候如果不指定名称，便会随机生成</p><p>数据卷 是被设计用来持久化数据的 , 类似linux下目录的mount; 它绕过 UFS，可以提供很多有用的特性：</p><ul><li><p>数据卷 可以在容器之间共享和重用</p></li><li><p>对 数据卷 的更新，不会影响镜像</p></li><li><p>数据卷 默认会一直存在，即使容器被删除</p><p>  它的生命周期独立于容器，Docker 不会在容器被删除后自动删除 数据卷</p></li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">`docker volume create my-vol` 创建一个volume</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">`docker volume ls` 查看所有的volume</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">`docker volume inspect my-vol` 查看指定的volume</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">`docker inspect web` 在容器中查看volume信息(数据卷 信息在 &quot;Mounts&quot; Key 下面, 这里的web为container名)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">`docker volume rm my-vol`删除volume</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">`docker volume prune` 清理无主的volume</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker rm -v &lt;container_id&gt; 删除容器同时删除 volume</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 创建一个container同时挂载一个/多个数据卷</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 创建一个名为 web 的容器，并加载一个 数据卷 到容器的 /webapp 目录。, 如果/webapp中有内容则暂时会被屏蔽</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -d -P \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --name web \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # -v my-vol:/wepapp \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # 等同</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --mount source=my-vol,target=/webapp \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    training/webapp \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    python app.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="112-挂载主机目录">11.2. 挂载主机目录<a href="#112-挂载主机目录" class="hash-link" aria-label="11.2. 挂载主机目录的直接链接" title="11.2. 挂载主机目录的直接链接">​</a></h2><p>使用<code> --mount</code> 标记可以指定挂载一个本地主机的目录到容器中去 (也可以挂在数据卷到容器中去)</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 加载主机的 /src/webapp 目录到容器的 /opt/webapp目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -d -P \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --name web \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # -v /src/webapp:/opt/webapp \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --mount type=bind,source=/src/webapp,target=/opt/webapp \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    training/webapp \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    python app.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个功能在进行测试的时候十分方便，比如用户可以放置一些程序到本地目录中，来查看容器是否正常工作。本地目录的路径必须是绝对路径</p><p>Docker 挂载主机目录的默认权限是 读写，用户也可以通过增加 readonly 指定为 只读:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -d -P \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --name web \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # -v /src/webapp:/opt/webapp:ro \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --mount type=bind,source=/src/webapp,target=/opt/webapp,readonly \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    training/webapp \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    python app.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看使用<code>docker inspect &lt;container name&gt;</code>, 挂载主机目录 的配置信息在 &quot;Mounts&quot; Key 下面;</p><p>也可以挂载主机单个文件</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ docker run --rm -it \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   # -v $HOME/.bash_history:/root/.bash_history \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   --mount type=bind,source=$HOME/.bash_history,target=/root/.bash_history \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   ubuntu:17.10 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@2affd44b4667:/# history</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1  ls</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2  diskutil list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样就可以记录在容器输入过的命令了</p><p>--mount 和 -v 区别:</p><p><a href="http://einverne.github.io/post/2018/03/docker-v-and-mount.html" target="_blank" rel="noopener noreferrer">http://einverne.github.io/post/2018/03/docker-v-and-mount.html</a></p><ul><li><p>-v 选项将所有选项集中到一个值, 更精简</p><p>-v 或 --volume: 包含三个 field，使用 : 来分割，所有值需要按照正确的顺序。第一个 field 是 volume 的名字，并且在宿主机上唯一，对于匿名 volume，第一个field通常被省略；第二个field是宿主机上将要被挂载到容器的path或者文件；第三个field可选，比如说 ro</p></li><li><p>--mount 选项将可选项分开, 更啰嗦</p><p>--mount: 包含多个 key-value 对，使用逗号分割。--mount 选项更加复杂，但是各个值之间无需考虑顺序。</p><p>type，可以为 bind, volume, tmpfs, 通常为 volume
source 也可以写成 src，对于 named volumes，可以设置 volume 的名字，对于匿名 volume，可以省略
destination 可以写成 dst或者 target 该值会挂载到容器
readonly 可选，如果使用，表示只读
volume-opt 可选，可以使用多次</p></li></ul><p>如:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker run -d \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --name=nginxtest \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --mount source=nginx-vol,destination=/usr/share/nginx/html \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  nginx:latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --name=nginxtest \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -v nginx-vol:/usr/share/nginx/html \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  nginx:latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113-volume-的共享">11.3. volume 的共享<a href="#113-volume-的共享" class="hash-link" aria-label="11.3. volume 的共享的直接链接" title="11.3. volume 的共享的直接链接">​</a></h2><p><code>--volume-from</code> 为当前创建的容器指定其他容器的 volume</p><p>有镜像 imageA, 派生容器 container1, 挂载有匿名卷 /data, <code>docker run --name container2 --volume-from container1 imageA</code> 那么 /data 目录会被两个 容器共享</p><h1>12. 网络互联</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="121-docker-默认初始创建3-个网络">12.1. docker 默认初始创建3 个网络<a href="#121-docker-默认初始创建3-个网络" class="hash-link" aria-label="12.1. docker 默认初始创建3 个网络的直接链接" title="12.1. docker 默认初始创建3 个网络的直接链接">​</a></h2><p>docker 安装的时候，会在宿主机建立一块虚拟网卡 docker0 作为网桥， 宿主机 通过这个网卡 桥接到了docker内局域网。在docker容器内，通过 docker0 的 IP 地址就能访问宿主机的服务了。</p><blockquote><p>宿主执行 ifconfig, <code>eth0, eth1 ...</code> 代表真实网卡, <code>docker0</code> 是 docker 新建的虚拟网卡, 作为容器访问宿主的网桥, <code>veth2ddf66cc, vethxxxxx ...</code> 和容器内的 eth0 绑定</p></blockquote><p>Docker安装后，默认会创建下面三个 network, 除非另有指定，否则新启动的容器会链接 bridge 这个 network。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ docker network ls</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NETWORK ID     NAME        DRIVER       SCOPE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">9781b1f585ae    bridge       bridge(默认)    local   --&gt; 桥接网络, 默认, 重启下，Docker的IP地址就变了, 同个默认桥接网络下的两个容器只能通过docker内部 ip 访问, 除非创建容器时候使用--link指定链接别名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  生产一般自定义一个桥接网络(因为自定义桥接网络优先级高于默认桥接网络, 不要在生产环境使用默认 bridge network</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  链接到同一个 自定义桥接网络的两个容器互相能够通过 容器名字访问</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1252da701e55    host        host        local     --&gt; 主机网络, 容器的网络会附属在主机上，两者是互通的, 没有隔离 (在容器中运行一个Web服务，监听8080端口，则主机的8080端口就会自动映射到容器中)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">237ea3d5cfbf    none        null        local     --&gt; 无指定网络, docker 容器就不会分配局域网的IP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="124-创建固定ip">12.4. 创建固定ip<a href="#124-创建固定ip" class="hash-link" aria-label="12.4. 创建固定ip的直接链接" title="12.4. 创建固定ip的直接链接">​</a></h2><p>自己创建一个新的bridge网络bridge1，在创建bridge1的时候同时创建子网，那么在创建容器的时候指定网络为bridge1并指定ip即可</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 创建网络, 指定网段, 默认是 bridge 类型, 所以可省略</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># --driver 或者 -d 指定网络类型</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker network create [--driver bridge] --subnet=172.18.0.0/16 my-network </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -itd --name my-container --network my-network --ip 172.18.0.10 my-image &lt;/bin/bash &gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        * 用 --network 参数，可以指定网络类型</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        * --ip 172.17.0.10指定ip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="125-查看container的ip">12.5. 查看container的ip<a href="#125-查看container的ip" class="hash-link" aria-label="12.5. 查看container的ip的直接链接" title="12.5. 查看container的ip的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 查看docker0的网络(宿主机上操作)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ip addr show docker0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 到容器内部查看ip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ip addr show eth0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker inspect &lt;id,container_name&gt; | grep &quot;IPAddress&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="126-外部访问容器">12.6. 外部访问容器<a href="#126-外部访问容器" class="hash-link" aria-label="12.6. 外部访问容器的直接链接" title="12.6. 外部访问容器的直接链接">​</a></h2><p>如果是 bridge network, 可使用 -p 暴露接口</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">p </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">host port</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">container port</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> 指定端口映射</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">P</span><span class="token plain">    使用宿主随机端口映射到容器</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 可通过 docker ls 查看到底哪个端口</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果是 host network, 则容器的端口会自动暴露到宿主 (宿主连容器)</p><blockquote><p>或者查询宿主机 docker0 网卡的地址 <code>ip addr show docker0</code> 作为 宿主在 docker 局域网的地址 (然后容器连宿主)</p></blockquote><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 端口自动映射, 需要手动查看端口是多少</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -d -P training/webapp python app.py</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker container ls -l</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CONTAINER ID  IMAGE                   COMMAND       CREATED        STATUS        PORTS                    NAMES</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bc533791f3f5  training/webapp:latest  python app.py 5 seconds ago  Up 2 seconds  0.0.0.0:49155-&gt;5000/tcp  nostalgic_morse</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 映射所有接口地址</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 使用 hostPort:containerPort 格式本地的 5000 端口映射到容器的 5000 端口; 此时默认会绑定本地所有接口上的所有地址</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -d -p 5000:5000 training/webapp python app.py</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 映射到指定地址的指定端口</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 可以使用 ip:hostPort:containerPort 格式指定映射使用一个特定地址，比如 localhost 地址 127.0.0.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -d -p 127.0.0.1:5000:5000 training/webapp python app.py</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 映射到指定地址的随机端口</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 使用 ip::containerPort 绑定 localhost 的任意端口到容器的 5000 端口，本地主机会自动分配一个端口。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -d -p 127.0.0.1::5000 training/webapp python app.py</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 还可以使用 udp 标记来指定 udp 端口, 默认为tcp</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -d -p 127.0.0.1:5000:5000/udp training/webapp python app.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看当前映射的端口配置，也可以查看到绑定的地址:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ docker port &lt;container name&gt; [port]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">127.0.0.1:49155</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="127-容器互联">12.7. 容器互联<a href="#127-容器互联" class="hash-link" aria-label="12.7. 容器互联的直接链接" title="12.7. 容器互联的直接链接">​</a></h2><p>一个是通过 docker network</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 创建一个叫做 my-bridge 的网桥:     </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker network create -d bridge my-bridge</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 显示所有 bridge   : </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker network ls</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 创建容器mynginx2并添加到 my-bridge 网络中: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run --name mynginx2 --network my-bridge -p 8080:80 -d nginx:latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 使用 inspect 查看:    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker inspect mynginx2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查看 my-bridge 网络里面的容器: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker inspect my-bridge</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 手动将某个运行着的容器加入网桥:  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker network connect my-bridage test2s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">############  实例</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># BusyBox </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 是一个集成了三百多个最常用Linux命令和工具的软件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 创建docker网络, 启动两个容器, 加入网络</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker network create -d bridge my-net</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -it --rm --name busybox1 --network my-net busybox sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 需要打开新的terminal</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -it --rm --name busybox2 --network my-net busybox sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 最后在各自的terminal中ping测试</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ping busybox2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ping busybox1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># MySQL</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker network create -d bridge some-network</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d --name some-mysql --network some-network -e MYSQL_ROOT_PASSWORD=my-secret-pw mysql:tag</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 启动一个临时的 MySQL client</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -it --rm --network some-network mysql mysql -hsome-mysql -uexample-user -p</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>一个是通过 <code>--link</code> (不推荐), docker run --link可以用来链接2个容器，使得源容器（被链接的容器）和接收容器（主动去链接的容器）之间可以互相通信，并且接收容器可以获取源容器的一些数据，如源容器的环境变量。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">#--link &lt;container_name&gt;:&lt;link_name&gt; </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d --name node --link selenium_hub:hub selenium/node-chrome-debug</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker exec -it node /bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ping hub # 可以 ping 通</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更方便的容器互联使用<a href="#docker-compose"> Docker Compose</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="128-配置dns-和-主机名-hostname">12.8. 配置dns 和 主机名 hostname<a href="#128-配置dns-和-主机名-hostname" class="hash-link" aria-label="12.8. 配置dns 和 主机名 hostname的直接链接" title="12.8. 配置dns 和 主机名 hostname的直接链接">​</a></h2><p>Docker 利用虚拟文件来挂载容器的 3 个相关配置文件。</p><p>在容器中使用 mount 命令可以看到挂载信息:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ mount</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/dev/disk/by-uuid/1fec...ebdf on /etc/hostname type ext4 ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/dev/disk/by-uuid/1fec...ebdf on /etc/hosts type ext4 ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tmpfs on /etc/resolv.conf type tmpfs ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这种机制可以让宿主主机 DNS 信息发生更新后，所有 Docker 容器的 DNS 配置通过 <code>/etc/resolv.conf</code> 文件立刻得到更新</p><p>配置全部容器的 DNS ，也可以在<code> /etc/docker/daemon.json</code> 文件中增加以下内容来设置:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">&quot;dns&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;114.114.114.114&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;8.8.8.8&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样每次启动的容器 DNS 自动配置为 114.114.114.114 和 8.8.8.8。使用以下命令来证明其已经生效:<code>docker run -it --rm ubuntu:17.10  cat etc/resolv.conf</code></p><p>如果用户想要手动指定容器的配置，可以在使用 docker run 命令启动容器时加入如下参数：</p><ul><li><p><code>-h HOSTNAME</code> 或者<code> --hostname=HOSTNAME</code> 设定容器的主机名，它会被写到容器内的 /etc/hostname 和 /etc/hosts。但它在容器外部看不到，既不会在 docker container ls 中显示，也不会在其他的容器的 /etc/hosts 看到。</p></li><li><p><code>--dns=IP_ADDRESS</code> 添加 DNS 服务器到容器的 /etc/resolv.conf 中，让容器用这个服务器来解析所有不在 /etc/hosts 中的主机名。</p></li><li><p><code>--dns-search=DOMAIN</code> 设定容器的搜索域，当设定搜索域为 .example.com 时，在搜索一个名为 host 的主机时，DNS 不仅搜索 host，还会搜索 host.example.com。</p></li></ul><h1>13. docker-compose</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="131-some-significant-materials">13.1. some significant materials<a href="#131-some-significant-materials" class="hash-link" aria-label="13.1. some significant materials的直接链接" title="13.1. some significant materials的直接链接">​</a></h2><p><a href="https://www.composerize.com/" target="_blank" rel="noopener noreferrer">https://www.composerize.com/</a> convert docker command into docker-compose file</p><p><a href="https://github.com/docker/awesome-compose" target="_blank" rel="noopener noreferrer">https://github.com/docker/awesome-compose</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="132-compose简介">13.2. compose简介<a href="#132-compose简介" class="hash-link" aria-label="13.2. compose简介的直接链接" title="13.2. compose简介的直接链接">​</a></h2><p>通俗的理解: 可以同时定义和运行多个 Docker 容器. 用户通过一个单独的 docker-compose.yml 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）</p><blockquote><p>Docker Compose 是 Docker 官方编排（Orchestration）项目之一，负责快速的部署分布式应用</p><p>Compose 项目由 Python 编写，调用了 Docker 服务提供的 API 来对容器进行管理</p></blockquote><p>Compose 中有两个重要的概念：</p><ul><li><p>服务 (service)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。</p><p>Compose 的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理</p></li><li><p>项目 (project)：由一组关联的应用容器组成的一个完整业务单元，在 docker-compose.yml 文件中定义。</p></li></ul><p>安装卸载</p><p><a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/compose/install/</a></p><ol><li>通过 Python 的包管理工具 pip 进行安装，</li><li>也可以直接下载编译好的二进制文件使用 </li><li>能够直接在 Docker 容器中运行</li></ol><blockquote><p>前两种方式是传统方式，适合本地环境下安装使用；最后一种方式则不破坏系统环境，更适合云计算场景; </p></blockquote><p>Docker for Windows 自带 docker-compose 二进制文件，安装 Docker 之后可以直接使用。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 直接下载对应的二进制包(推荐)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ sudo curl -L https://github.com/docker/compose/releases/download/1.17.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ sudo chmod +x /usr/local/bin/docker-compose</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 还可以使用pip安装</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ sudo pip install -U docker-compose</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 命令补全功能需要下载一个文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ curl -L https://raw.githubusercontent.com/docker/compose/1.8.0/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 如何在linux中执行? 下载的run.sh实际是下载docker/compose 镜像并运行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ curl -L https://github.com/docker/compose/releases/download/1.8.0/run.sh &gt; /usr/local/bin/docker-compose</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ chmod +x /usr/local/bin/docker-compose</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 测试是否安装成功, 第一次会下载compose镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker-compose version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>卸载:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 如果是二进制包方式安装的，删除二进制文件即可。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ sudo rm /usr/local/bin/docker-compose</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 如果是通过 pip 安装的，则执行如下命令即可删除。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ sudo pip uninstall docker-compose</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>看一个 quick-start:</p><p>eg: 用Python 来建立一个能够记录页面访问次数的 web 网站</p><p>在文件夹project/下新建app.py</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> flask </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> Flask</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> redis </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> Redis</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">app </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Flask</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">redis </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Redis</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">host</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;redis&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> port</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">6379</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(4, 81, 165)">@app</span><span class="token decorator annotation punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token decorator annotation punctuation" style="color:rgb(4, 81, 165)">route</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;/&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    count </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> redis</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">incr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;hits&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;Hello World! 该页面已被访问 {} 次。\n&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token builtin" style="color:rgb(0, 112, 193)">format</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">count</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;__main__&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">host</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;0.0.0.0&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> debug</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>新建 Dockerfile </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">FROM python:3.6-alpine</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ADD . /code</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR /code</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN pip install redis flask</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD [&quot;python&quot;, &quot;app.py&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>新建 docker-compose.yml</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 这里的版本和docker-compose有关, 如果报错, 则改为&#x27;2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> . </span><span class="token comment" style="color:rgb(0, 128, 0)"># 在当前目录寻找 dockerfile构建</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;5000:5000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">redis</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;redis:alpine&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>运行: <code>docker-compose up</code></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="133-命令使用">13.3. 命令使用<a href="#133-命令使用" class="hash-link" aria-label="13.3. 命令使用的直接链接" title="13.3. 命令使用的直接链接">​</a></h2><p>默认的命令对象是项目，这意味着项目中所有的服务都会受到命令影响</p><p>格式: <code>docker-compose [-f=&lt;arg&gt;...] [options] [COMMAND] [ARGS...]</code></p><p>options有这些:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">file </span><span class="token constant" style="color:rgb(129, 31, 63)">FILE</span><span class="token plain"> 指定使用的 </span><span class="token maybe-class-name">Compose</span><span class="token plain"> 模板文件，默认为 docker</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">compose</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">yml，可以多次指定。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">project</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">name </span><span class="token constant" style="color:rgb(129, 31, 63)">NAME</span><span class="token plain"> 指定项目名称，默认将使用所在目录名称作为项目名。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">x</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">networking 使用 </span><span class="token maybe-class-name">Docker</span><span class="token plain"> 的可拔插网络后端特性</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">x</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">network</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">driver </span><span class="token constant" style="color:rgb(129, 31, 63)">DRIVER</span><span class="token plain"> 指定网络后端的驱动，默认为 bridge</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">verbose 输出更多调试信息。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">version 打印版本并退出</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1331-up">13.3.1. up<a href="#1331-up" class="hash-link" aria-label="13.3.1. up的直接链接" title="13.3.1. up的直接链接">​</a></h3><ul><li><p>格式为 docker-compose up <!-- -->[options][SERVICE...]</p></li><li><p>该命令十分强大，它将尝试自动完成包括 构建, 启动...</p></li><li><p>默认情况，<code>docker-compose up</code> 启动的容器都在前台，控制台将会同时打印所有容器的输出信息，可以很方便进行调试。</p><p>  当通过 Ctrl-C 停止命令时，所有容器将会停止</p><p>  如果使用 <code>docker-compose up -d</code>，将会在后台启动并运行所有的容器。一般推荐生产环境下使用该选项 (-d 必须接在 up 之后不能在之前)</p></li><li><p><code>docker-compose up --no-recreate</code>只会启动处于停止状态的容器，而忽略已经运行的服务</p><p>  默认情况，如果服务容器已经存在，docker-compose up 将会尝试停止容器，然后重新创建</p></li><li><p><code>docker-compose up --no-deps -d &lt;SERVICE_NAME&gt;</code> 只想重新部署某个服务, 通过这个命令来重新创建服务并后台停止旧服务，启动新服务，并不会影响到其所依赖的服务</p></li></ul><p>所有可用的选项:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">-d 在后台运行服务容器。(必须在 docker-compose [flags] &lt;command&gt; 中的 command 之后, 不能在之前)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-f 指定 yml 文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  docker-compose -f xxx.yml up [-d]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-p, --project-name ：指定工程名称，默认使用 docker-compose.yml 文件所在目录的名称；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--no-color 不使用颜色来区分不同的服务的控制台输出。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--no-deps 不启动服务所链接的容器。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--force-recreate 强制重新创建容器，不能与 --no-recreate 同时使用。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--no-recreate 如果容器已经存在了，则不重新创建，不能与 --force-recreate 同时使用。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--no-build 不自动构建缺失的服务镜像。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-t, --timeout TIMEOUT 停止容器时候的超时（默认为 10 秒）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1332-run">13.3.2. run<a href="#1332-run" class="hash-link" aria-label="13.3.2. run的直接链接" title="13.3.2. run的直接链接">​</a></h3><p>格式为 <code>docker-compose run [options] [-p PORT...] [-e KEY=VAL...] SERVICE [COMMAND] [ARGS...]</code>。</p><p>在指定服务上执行一个命令。</p><p>eg:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 将会启动一个 ubuntu 服务容器，并执行 ping docker.com 命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker-compose run ubuntu ping docker.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>默认情况下，如果存在关联，则所有关联的服务将会自动被启动，除非这些服务已经在运行中</p><p>如果不希望自动启动关联的容器，可以使用 --no-deps 选项</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 不会启动 web 容器所关联的其它容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker-compose run --no-deps web python manage.py shell</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该命令类似启动容器后运行指定的命令，相关卷、链接等等都将会按照配置自动创建, 但是有两个不同点</p><ol><li>给定命令将会覆盖原有的自动运行命令</li><li>不会自动创建端口，以避免冲突</li></ol><p>所有可选的选项:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">d 后台运行容器。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">name </span><span class="token constant" style="color:rgb(129, 31, 63)">NAME</span><span class="token plain"> 为容器指定一个名字。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">entrypoint </span><span class="token constant" style="color:rgb(129, 31, 63)">CMD</span><span class="token plain"> 覆盖默认的容器启动指令。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">e </span><span class="token constant" style="color:rgb(129, 31, 63)">KEY</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token constant" style="color:rgb(129, 31, 63)">VAL</span><span class="token plain"> 设置环境变量值，可多次使用选项来设置多个环境变量。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">u</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">user</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&quot;</span><span class="token plain"> 指定运行容器的用户名或者 uid。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">no</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deps 不自动启动关联的服务容器。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">rm 运行命令后自动删除容器，d 模式下将忽略。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">publish</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> 映射容器端口到本地主机。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">service</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ports 配置服务端口并映射到本地主机。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">T</span><span class="token plain"> 不分配伪 tty，意味着依赖 tty 的指令将无法运行。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1333-scale">13.3.3. scale<a href="#1333-scale" class="hash-link" aria-label="13.3.3. scale的直接链接" title="13.3.3. scale的直接链接">​</a></h3><ul><li><p>格式为 docker-compose scale <!-- -->[options][SERVICE=NUM...]<!-- -->。</p></li><li><p>设置指定服务运行的容器个数。</p></li><li><p>通过 service=num 的参数来设置数量。例如</p><ul><li><p>eg</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 将启动 3 个容器运行 web 服务，2 个容器运行 db 服务</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker-compose scale web=3 db=2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p>当指定数目多于该服务当前实际运行容器，将新创建并启动容器；反之，将停止容器</p></li></ul><p>可用选项:</p><p>-t, --timeout TIMEOUT 停止容器时候的超时（默认为 10 秒）。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1334-start">13.3.4. start<a href="#1334-start" class="hash-link" aria-label="13.3.4. start的直接链接" title="13.3.4. start的直接链接">​</a></h3><p>格式为 docker-compose start <!-- -->[SERVICE...]<!-- -->。</p><p>启动已经存在的服务容器</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1335-build">13.3.5. build<a href="#1335-build" class="hash-link" aria-label="13.3.5. build的直接链接" title="13.3.5. build的直接链接">​</a></h3><ul><li><p>格式为 docker-compose build <!-- -->[options][SERVICE...]</p></li><li><p>构建（重新构建）项目中的服务容器</p></li><li><p>服务容器一旦构建后，将会带上一个标记名，例如对于 web 项目中的一个 db 容器，可能是 web_db</p></li><li><p>可以随时在项目目录下运行 docker-compose build 来重新构建服务</p></li></ul><p>所有选项:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">force</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">rm 删除构建过程中的临时容器。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">no</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">cache 构建镜像过程中不使用 cache（这将加长构建过程）。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">pull 始终尝试通过 pull 来获取更新版本的镜像。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1336-config">13.3.6. config<a href="#1336-config" class="hash-link" aria-label="13.3.6. config的直接链接" title="13.3.6. config的直接链接">​</a></h3><p>验证 Compose 文件格式是否正确，若正确则显示配置，若格式错误显示错误原因</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1337-exec">13.3.7. exec<a href="#1337-exec" class="hash-link" aria-label="13.3.7. exec的直接链接" title="13.3.7. exec的直接链接">​</a></h3><p>进入指定的容器</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1338-images">13.3.8. images<a href="#1338-images" class="hash-link" aria-label="13.3.8. images的直接链接" title="13.3.8. images的直接链接">​</a></h3><p>列出 Compose 文件中包含的镜像。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1339-kill">13.3.9. kill<a href="#1339-kill" class="hash-link" aria-label="13.3.9. kill的直接链接" title="13.3.9. kill的直接链接">​</a></h3><p>格式为 docker-compose kill <!-- -->[options][SERVICE...]</p><p>通过发送 SIGKILL 信号来强制停止服务容器。</p><p>支持通过 -s 参数来指定发送的信号，例如通过如下指令发送 SIGINT 信号。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ docker-compose kill -s SIGINT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13310-down">13.3.10. down<a href="#13310-down" class="hash-link" aria-label="13.3.10. down的直接链接" title="13.3.10. down的直接链接">​</a></h3><p>此命令将会停止 up 命令所启动的容器，并移除网络</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13311-pause">13.3.11. pause<a href="#13311-pause" class="hash-link" aria-label="13.3.11. pause的直接链接" title="13.3.11. pause的直接链接">​</a></h3><p>格式为 docker-compose pause <!-- -->[SERVICE...]<!-- -->。</p><p>暂停一个服务容器。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13312-unpause">13.3.12. unpause<a href="#13312-unpause" class="hash-link" aria-label="13.3.12. unpause的直接链接" title="13.3.12. unpause的直接链接">​</a></h3><p>格式为 docker-compose unpause <!-- -->[SERVICE...]<!-- -->。</p><p>恢复处于暂停状态中的服务。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13313-restart">13.3.13. restart<a href="#13313-restart" class="hash-link" aria-label="13.3.13. restart的直接链接" title="13.3.13. restart的直接链接">​</a></h3><p>格式为 docker-compose restart <!-- -->[options][SERVICE...]<!-- -->。</p><p>重启项目中的服务。</p><p>选项：</p><p>-t, --timeout TIMEOUT 指定重启前停止容器的超时（默认为 10 秒）。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13314-stop">13.3.14. stop<a href="#13314-stop" class="hash-link" aria-label="13.3.14. stop的直接链接" title="13.3.14. stop的直接链接">​</a></h3><p>格式为 docker-compose stop <!-- -->[options][SERVICE...]<!-- -->。</p><p>停止已经处于运行状态的容器，但不删除它。通过 docker-compose start 可以再次启动这些容器。</p><p>选项：</p><p>-t, --timeout TIMEOUT 停止容器时候的超时（默认为 10 秒）。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13315-rm">13.3.15. rm<a href="#13315-rm" class="hash-link" aria-label="13.3.15. rm的直接链接" title="13.3.15. rm的直接链接">​</a></h3><p>格式为 docker-compose rm <!-- -->[options][SERVICE...]<!-- -->。</p><p>删除所有（停止状态的）服务容器。推荐先执行 docker-compose stop 命令来停止容器。</p><p>选项：</p><p>-f, --force 强制直接删除，包括非停止状态的容器。一般尽量不要使用该选项。</p><p>-v 删除容器所挂载的数据卷。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13316-logs">13.3.16. logs<a href="#13316-logs" class="hash-link" aria-label="13.3.16. logs的直接链接" title="13.3.16. logs的直接链接">​</a></h3><p>格式为 docker-compose logs <!-- -->[options][SERVICE...]<!-- -->。</p><p>查看服务容器的输出。默认情况下，docker-compose 将对不同的服务输出使用不同的颜色来区分。可以通过 --no-color 来关闭颜色。</p><p>该命令在调试问题的时候十分有用。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13317-top">13.3.17. top<a href="#13317-top" class="hash-link" aria-label="13.3.17. top的直接链接" title="13.3.17. top的直接链接">​</a></h3><p>查看各个服务容器内运行的进程</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13318-version">13.3.18. version<a href="#13318-version" class="hash-link" aria-label="13.3.18. version的直接链接" title="13.3.18. version的直接链接">​</a></h3><p>格式为 docker-compose version。</p><p>打印版本信息。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13319-port">13.3.19. port<a href="#13319-port" class="hash-link" aria-label="13.3.19. port的直接链接" title="13.3.19. port的直接链接">​</a></h3><p>格式为 docker-compose port <!-- -->[options]<!-- --> SERVICE PRIVATE_PORT。</p><p>打印某个容器端口所映射的公共端口。</p><p>选项：</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">protocol</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">proto 指定端口协议，tcp（默认值）或者 udp。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">index</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">index 如果同一服务存在多个容器，指定命令对象容器的序号（默认为 </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">）。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13320-ps">13.3.20. ps<a href="#13320-ps" class="hash-link" aria-label="13.3.20. ps的直接链接" title="13.3.20. ps的直接链接">​</a></h3><p>格式为 docker-compose ps <!-- -->[options][SERVICE...]<!-- -->。</p><p>列出项目中目前的所有容器。</p><p>选项：</p><p>-q 只打印容器的 ID 信息。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13321-pull">13.3.21. pull<a href="#13321-pull" class="hash-link" aria-label="13.3.21. pull的直接链接" title="13.3.21. pull的直接链接">​</a></h3><p>格式为 docker-compose pull <!-- -->[options][SERVICE...]<!-- -->。</p><p>拉取服务依赖的镜像。</p><p>选项：</p><p>--ignore-pull-failures 忽略拉取镜像过程中的错误。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13322-push">13.3.22. push<a href="#13322-push" class="hash-link" aria-label="13.3.22. push的直接链接" title="13.3.22. push的直接链接">​</a></h3><p>推送服务依赖的镜像到 Docker 镜像仓库。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="134-docker-composeyml">13.4. docker-compose.yml<a href="#134-docker-composeyml" class="hash-link" aria-label="13.4. docker-compose.yml的直接链接" title="13.4. docker-compose.yml的直接链接">​</a></h2><p><a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/compose/compose-file/</a> </p><p>默认的模板文件名称为 docker-compose.yml</p><p>模版中的命令基本跟 docker run 中对应参数的功能一致。</p><p>如果变量名称或者值中用到 true|false，yes|no 等表达 布尔 含义的词汇，最好放到引号里, 这些符号包括:</p><p>如果值的含义是密码, 应该用引号, 不管是不是数字</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">y</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token constant" style="color:rgb(129, 31, 63)">Y</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">yes</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token maybe-class-name">Yes</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token constant" style="color:rgb(129, 31, 63)">YES</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">n</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token constant" style="color:rgb(129, 31, 63)">N</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">no</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token maybe-class-name">No</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token constant" style="color:rgb(129, 31, 63)">NO</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token boolean">true</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token maybe-class-name">True</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token constant" style="color:rgb(129, 31, 63)">TRUE</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token boolean">false</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token maybe-class-name">False</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token constant" style="color:rgb(129, 31, 63)">FALSE</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">on</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token maybe-class-name">On</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token constant" style="color:rgb(129, 31, 63)">ON</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">off</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token maybe-class-name">Off</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token constant" style="color:rgb(129, 31, 63)">OFF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">webapp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定为镜像名称或镜像 ID。如果镜像在本地不存在，Compose 将会尝试拉取这个镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 每个服务都必须通过 image 指令指定镜像或 build 指令（需要 Dockerfile）等来自动构建生成镜像。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 可以不加引号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;examples/web&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 若果当前目录下有 dockerfile, 则是用 dockerfile 构建出的镜像, 此时 image 属性可以不设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ./</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 如果时多模块项目, xxx 就是子模块目录目录名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token comment" style="color:rgb(0, 128, 0)"># 使用 build 指令，在 Dockerfile 中设置的选项(例如：CMD, EXPOSE, VOLUME, ENV 等) 将会自动被获取，无需在 docker-compose.yml 中再次设置。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定 Dockerfile 所在文件夹的路径（可以是绝对路径，或者相对 docker-compose.yml 文件的路径）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ./dir_name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;80:80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/data&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># cap_add, cap_drop 指定容器的内核能力（capacity）分配</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">cap_add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ALL </span><span class="token comment" style="color:rgb(0, 128, 0)"># 让容器拥有所有能力</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">cap_drop</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> NET_ADMIN </span><span class="token comment" style="color:rgb(0, 128, 0)"># 去掉 NET_ADMIN 能力</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 覆盖容器启动后默认执行的命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> echo &quot;hello world&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 仅用于 Swarm mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 仅用于 Swarm mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">deploy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定父 cgroup 组，意味着将继承该组的资源限制; 例如，创建了一个 cgroup 组名称为 cgroups_1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">cgroup_parent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cgroups_1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定容器名称。默认将会使用 项目名称_服务名称_序号 这样的格式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 注意: 指定容器名称后，该服务将无法进行扩展（scale），因为 Docker 不允许多个容器具有相同的名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定设备映射关系</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">devices</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/dev/ttyUSB1:/dev/ttyUSB0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 解决容器的依赖、启动先后的问题。以下例子中会先启动 redis db 再启动 webapp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 注意：webapp 服务不会等待 redis db 「完全启动」之后才启动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 自定义 DNS 服务器。可以是一个值，也可以是一个列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># dns: 8.8.8.8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">dns</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> 8.8.8.8</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> 114.114.114.114</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置 DNS 搜索域。可以是一个值，也可以是一个列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># dns_search: example.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">dns_search</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> domain1.example.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> domain2.example.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 挂载一个 tmpfs 文件系统到容器。可以为单个, 也可以为列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># tmpfs: /run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">tmpfs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> /run</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> /tmp</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置环境变量。你可以使用数组或字典两种格式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 只给定名称的变量会自动获取运行 Compose 主机上对应变量的值，可以用来防止泄露不必要的数据。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># environment:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">#     RACK_ENV: development</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">#     SESSION_SECRET:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> RACK_ENV=development</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> SESSION_SECRET</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 从文件中获取环境变量，可以为单独的文件路径或列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 如果通过 docker-compose -f FILE 方式来指定 Compose 模板文件，则 env_file 中变量的路径会基于模板文件路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 如果有变量名称与 environment 指令冲突，则按照惯例，以后者为准</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 环境变量文件中每一行必须符合格式(PROG_ENV=development)，支持 # 开头的注释行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># env_file: .env</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">env_file</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ./common.env</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ./apps/web.env</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> /opt/secrets.env</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 暴露端口，但不映射到宿主机，只让内部的服务访问</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">expose</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;3000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;8000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 暴露端口信息。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 使用宿主端口：容器端口 (HOST:CONTAINER) 格式，或者仅仅指定容器的端口（宿主将会随机选择端口）都可以。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;3000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;8000:8000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;49100:22&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;127.0.0.1:8001:8001&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 链接到 docker-compose.yml 外部的容器，甚至并非 Compose 管理的外部容器。不建议使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">external_links</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> redis_1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> project_db_1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">mysql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> project_db_1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">postgresql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 类似 Docker 中的 --add-host 参数，指定额外的 host 名称映射信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 会在启动后的服务容器中 /etc/hosts 文件中添加host映射条目8.8.8.8 googledns和52.1.157.61 dockerhub</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">extra_hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;googledns:8.8.8.8&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;dockerhub:52.1.157.61&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 通过命令检查容器是否健康运行。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">healthcheck</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">test</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;CMD&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;curl&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-f&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;http://localhost&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 1m30s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 10s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">retries</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 为容器添加 Docker 元数据（metadata）信息。例如可以为容器添加辅助说明信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">com.startupteam.description</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;webapp for a startup team&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">com.startupteam.department</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;devops department&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">com.startupteam.release</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;rc3 for v1.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置日志选项。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">logging</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">driver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> syslog </span><span class="token comment" style="color:rgb(0, 128, 0)"># 支持三种日志驱动类型: &quot;json-file&quot;, &quot;syslog&quot;, &quot;none&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置日志驱动的相关参数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">syslog-address</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;tcp://192.168.0.42:123&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 需要先声明</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> some</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">network</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> other</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">network</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置网络模式。使用和 docker run 的 --network 参数一样的值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">network_mode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;bridge&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 支持&quot;bridge&quot;, &quot;host&quot;, &quot;none&quot;, &quot;service:[service name]&quot;, &quot;container:[container name/id]&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 跟主机系统共享进程命名空间。打开该选项的容器之间，以及容器和宿主机系统之间可以通过进程 ID 来相互访问和操作。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">pid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;host&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定容器模板标签（label）机制的默认属性（用户、角色、类型、级别等）。例如配置标签的用户名和角色名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">security_opt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> label</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">USER</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> label</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">role</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ROLE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置另一个信号来停止容器。在默认情况下使用的是 SIGTERM 停止容器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">stop_signal</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> SIGUSR1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置容器内核参数, 两种方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># sysctls:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">#     net.core.somaxconn: 1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">#     net.ipv4.tcp_syncookies: 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">sysctls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> net.core.somaxconn=1024</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> net.ipv4.tcp_syncookies=0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定容器的 ulimits 限制值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 例如，指定最大进程数为 65535，指定文件句柄数为 20000（软限制，应用可以随时修改，不能超过硬限制） 和 40000（系统硬限制，只能 root 用户提高）。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">ulimits</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">nproc</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">65535</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">nofile</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">soft</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">hard</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">40000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 数据卷所挂载路径设置。可以设置宿主机路径 （HOST:CONTAINER） 或加上访问模式 （HOST:CONTAINER:ro）。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> /var/lib/mysql </span><span class="token comment" style="color:rgb(0, 128, 0)"># 匿名 volume</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> cache/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/tmp/cache</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ~/configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/etc/configs/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> xxName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/tmp/data  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 为容器内的匿名volume 名为为 xxName</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ./dir</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置容器连接的网络。注意这里是引用和services同级的networks下的项</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> some</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">network</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> other</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">network</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 存储敏感数据，例如 mysql 服务密码, 注意这里是引用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">secrets</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> db_root_password</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> my_other_secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 另一种指定Dockerfile的方式, 自由度更高</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">redis</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ./dir </span><span class="token comment" style="color:rgb(0, 128, 0)"># Dockerfile所在文件夹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">dockerfile</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Dockerfile</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">alternate </span><span class="token comment" style="color:rgb(0, 128, 0)"># Dockerfile 文件名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定构建镜像时的变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">buildno</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">cache_from</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定构建镜像的缓存</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> corp/web_app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.14</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 声明网络</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">some-network</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">other-network</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">secrets</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">my_secret</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">file</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ./my_secret.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">my_other_secret</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">external</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 声明一个命名的 volume</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  xxName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Compose 模板文件支持动态读取主机的系统环境变量和当前目录下的 .env 文件中的变量</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 如果执行 MONGO_VERSION=3.2 docker-compose up 则会启动一个 mongo:3.2 镜像的容器；如果执行 MONGO_VERSION=2.8 docker-compose up 则会启动一个 mongo:2.8 镜像的容器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;mongo:${MONGO_VERSION}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>若当前目录存在 .env 文件，执行 docker-compose 命令时将从该文件中读取变量</p><p>在当前目录新建 .env 文件并写入以下内容。</p><div class="language-props codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-props codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 支持 # 号注释</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">MONGO_VERSION=3.6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行 docker-compose up 则会启动一个 mongo:3.6 镜像的容器</p><p>docker-compose.yml模版文件中的其他指令:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">指定服务容器启动后执行的入口文件。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">entrypoint: /code/entrypoint.sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">指定容器中运行应用的用户名。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">user: nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">指定容器中工作目录。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">working_dir: /code</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">指定容器中搜索域名、主机名、mac 地址等。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">domainname: your_website.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hostname: test</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mac_address: 08-00-27-00-0C-0A</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">允许容器中运行一些特权命令。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 允许container内的root拥有真正的root权限, 可以看到很多host上的设备，并且可以执行mount。甚至允许你在docker容器中启动docker容器。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">privileged: true</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#指定容器退出后的重启策略为始终重启。该命令对保持服务始终运行十分有效，在生产环境中推荐配置为 always 或者 unless-stopped。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 命令行中 --restart always, 重启策略是面向生产环境的一个启动策略，在开发过程中可以忽略</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 共有如下策略:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># no，默认策略，在容器退出时不重启容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># on-failure，在容器非正常退出时（退出状态非0），才会重启容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># on-failure:3，在容器非正常退出时重启容器，最多重启3次, 可自己指定</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># always，在容器退出时总是重启容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># unless-stopped，在容器退出时总是重启容器，但是不考虑在Docker守护进程启动时就已经停止了的容器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查看容器重启次数 docker inspect -f &quot;{{ .RestartCount }}&quot; ba-208</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查看容器最后一次的启动时间 docker inspect -f &quot;{{ .State.StartedAt }}&quot; ba-208</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">restart: always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 以只读模式挂载容器的 root 文件系统，意味着不能对容器内容进行修改。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">read_only: true</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">打开标准输入，可以接受外部输入。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">stdin_open: true</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">模拟一个伪终端。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tty: true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>14. docker-machine</h1><p>Docker Machine 是 Docker 官方编排（Orchestration）项目之一，负责在多种平台上快速安装 Docker 环境, 包括虚拟机、本地主机和云平台</p><p>linux上安装</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ sudo curl -L https://github.com/docker/machine/releases/download/v0.13.0/docker-machine-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-machine</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ sudo chmod +x /usr/local/bin/docker-machine</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">`docker-machine -v` # 查看版本</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用virtualbox驱动创建本地主机实例:</p><p><code>docker-machine create -d virtualbox test</code></p><h1>15. docker-swarm,swarm-mode</h1><p>Docker Swarm 是 Docker 官方三剑客项目之一，提供 Docker 容器集群服务，是 Docker 官方对容器云生态进行支持的核心方案; 使用它，用户可以将多个 Docker 主机封装为单个大型的虚拟 Docker 主机，快速打造一套容器云平台;Docker 1.12.0+ Swarm mode 已经内嵌入 Docker 引擎，成为了 docker 子命令 docker swarm, 因此一般使用docker的swarm mode</p><h1>16. docker实践</h1><p><a href="https://github.com/wenshunbiao/docker" target="_blank" rel="noopener noreferrer">https://github.com/wenshunbiao/docker</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nacos">nacos<a href="#nacos" class="hash-link" aria-label="nacos的直接链接" title="nacos的直接链接">​</a></h2><p><a href="https://hub.docker.com/r/nacos/nacos-server" target="_blank" rel="noopener noreferrer">https://hub.docker.com/r/nacos/nacos-server</a></p><p><a href="https://hub.docker.com/r/zhusaidong/nacos-server-m1" target="_blank" rel="noopener noreferrer">https://hub.docker.com/r/zhusaidong/nacos-server-m1</a></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">d </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">p </span><span class="token number" style="color:rgb(9, 134, 88)">8848</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">8848</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">env </span><span class="token constant" style="color:rgb(129, 31, 63)">MODE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">standalone  </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">name nacos  zhusaidong</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nacos</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">server</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">m1</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">2.0</span><span class="token number" style="color:rgb(9, 134, 88)">.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="161-搭建持续集成系统">16.1. 搭建持续集成系统<a href="#161-搭建持续集成系统" class="hash-link" aria-label="16.1. 搭建持续集成系统的直接链接" title="16.1. 搭建持续集成系统的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 查看端口占用</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">lsof -i:8080</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查看指定端口的进程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">netstat -tunlp | grep 8000</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 搭建 jenkins</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 初始密码到jenkins内部[/var/jenkins_home/secrets/initialAdminPassword]看</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># -u 0 表示覆盖镜像内部的帐号, 使用外部的root, 用于解决volume权限问题</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># -v xxx:yyy 表示 volume:container中的目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d -p 8090:8080 -p 50000:50000 -v /srv/docker/jenkins:/var/jenkins_home --name jenkins -u 0 jenkins</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 或者 使用docker-compose编排</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># docker-compose.yml:(http://www.voidcn.com/article/p-keekrhyk-brk.html)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">version: &#x27;2&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  gitlab:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      image: gitlab/gitlab-ce:latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - &quot;20443:443&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - &quot;20080:80&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - &quot;20022:22&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      networks:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - devops</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - /data/gitlab/config:/etc/gitlab</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - /data/gitlab/logs:/var/log/gitlab</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - /data/gitlab/data:/var/opt/gitlab</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  jenkins:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      image: jenkins:latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - &quot;28080:8080&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - &quot;50000:50000&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      networks:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - devops</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - /data/jenkins:/var/jenkins_home</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - /var/run/docker.sock:/var/run/docker.sock</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sonarqube:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      image: sonarqube:latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - &quot;29000:9000&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - &quot;29092:9092&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      networks:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          - devops</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">networks:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  devops:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    driver: bridge</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>搭建gitlab, 上传代码时候, <code>git remote add origin http://43.254.2.51:20080/root/rest-api-starter.git</code>, <code>git push --set-upstream origin master</code></p><p>自动部署需要jenkins的插件 Publish over SSH;</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="162-docker和springboot">16.2. docker和springboot<a href="#162-docker和springboot" class="hash-link" aria-label="16.2. docker和springboot的直接链接" title="16.2. docker和springboot的直接链接">​</a></h2><p>老外的一篇博文: <a href="https://www.callicoder.com/spring-boot-docker-example/" target="_blank" rel="noopener noreferrer">https://www.callicoder.com/spring-boot-docker-example/</a>, 先没有使用maven工具, 然后引入maven插件, 两种实现</p><p>使用了 maven 插件: <a href="http://www.ityouknow.com/springboot/2018/03/19/spring-boot-docker.html" target="_blank" rel="noopener noreferrer">http://www.ityouknow.com/springboot/2018/03/19/spring-boot-docker.html</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="163-oracle11g">16.3. oracle11g<a href="#163-oracle11g" class="hash-link" aria-label="16.3. oracle11g的直接链接" title="16.3. oracle11g的直接链接">​</a></h2><p><a href="https://blog.csdn.net/qq_33982232/article/details/83133870" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/qq_33982232/article/details/83133870</a>
<a href="https://www.35youth.cn/685.html" target="_blank" rel="noopener noreferrer">https://www.35youth.cn/685.html</a> (<a href="https://registry.hub.docker.com/r/jaspeen/oracle-11g" target="_blank" rel="noopener noreferrer">https://registry.hub.docker.com/r/jaspeen/oracle-11g</a>)</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="164-使用-mysql-镜像">16.4. 使用 mysql 镜像<a href="#164-使用-mysql-镜像" class="hash-link" aria-label="16.4. 使用 mysql 镜像的直接链接" title="16.4. 使用 mysql 镜像的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker pull mysql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=raincloud-hello mysql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mysql -h127.0.0.1 -uroot -p # password is &#x27;hello&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 若 local 没有安装 MySQL client, 则使用 container client</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker network create my-net</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker network connect my-net my-mysql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -it --network my-net --rm mysql mysql -hmy-mysql -uroot -p</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -it --rm --link my-mysql:xxxhost mysql mysql -hxxxhost -uroot -p </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 外部存储 volume</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># https://www.cnblogs.com/sablier/p/11605606.html</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># mysql8 (手动敲入, 不要复制粘贴, 容易出非法字符)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d --name mysql8 -p 3306:3306 -v /root/mysql/conf:/etc/mysql -v /root/mysql/logs:/var/log/mysql -v /root/mysql/data:/var/lib/mysql -v /root/mysql/mysql-files:/var/lib/mysql-files/　-e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=face mysql:latest --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci # utf8mb4_unicode_ci 可以考虑替换为 更快的 utf8mb4_general_ci</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># mysql5.7</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d --name mysql5_7 -p 3306:3306 -v /root/mysql/conf:/etc/mysql -v /root/mysql/logs:/var/log/mysql -v /root/mysql/data:/var/lib/mysql　-e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=face mysql:5.7.34 --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://www.jianshu.com/p/530d00f97cbf" target="_blank" rel="noopener noreferrer">mysql容器的数据持久化问题</a></p><p><a href="https://zhuanlan.zhihu.com/p/26129750" target="_blank" rel="noopener noreferrer">导入导出</a></p><p>在宿主机上连接 MySQL 容器, 地址是 127.0.0.1:3306 , 而不是 localhost, (查container ip：<code>cat /etc/hosts</code>)</p><p><code> Authentication plugin &#x27;caching_sha2_password&#x27; cannot be loaded</code> 异常 - <a href="https://www.cnblogs.com/chuancheng/p/8964385.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/chuancheng/p/8964385.html</a></p><p><code>Access denied for user &#x27;root&#x27;@&#x27;172.19.0.1&#x27;</code> 异常 - 进入dockers内部 <code>docker exec -it &lt;xxx&gt; bash</code>, <code>mysql -uroot -p</code> 登陆MySQL, <code>update mysql.user set host = &#x27;%&#x27; where user = &#x27;root&#x27;;</code> 修改root用户允许所有ip访问, 默认只能localhost访问; 如果还不行 <code>ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;root&#x27;; flush privileges;</code> 修改root用户的权限 (<a href="https://blog.csdn.net/iw1210/article/details/54646093" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/iw1210/article/details/54646093</a>)</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;3.2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">mysql</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> mysql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> 3306</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3306</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 校正时区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> TZ=Asia/Shanghai</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置编码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">character</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">server=utf8mb4 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">collation</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">server=utf8mb4_unicode_ci</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 数据卷</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ./data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/var/lib/mysql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># root 的密码, 不过貌似没有生效 不要紧 手动设置也可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> MYSQL_ROOT_PASSWORD=root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>root, root 登陆</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="165-使用postgres镜像">16.5. 使用postgres镜像<a href="#165-使用postgres镜像" class="hash-link" aria-label="16.5. 使用postgres镜像的直接链接" title="16.5. 使用postgres镜像的直接链接">​</a></h2><p><code>docker run -d --name Postgres -p 5432:5432 [-e POSTGRES_USER=dev] -e POSTGRES_PASSWORD=dev123 postgres:alpine</code></p><blockquote><p>If the db users is not been specified, the password will be setup on the head of &quot;postgres&quot; (the db user which has a root access)</p></blockquote><p>or</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">postgresdb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">#- ./data:/var/lib/postgresql/data # 挂载本地目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 使用数据卷</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> pgdata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/var/lib/postgresql/data </span><span class="token comment" style="color:rgb(0, 128, 0)"># data volume</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> 5432</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">5432</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># data volume 需要在这里声明</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">pgdata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可能错误: data directory &quot;/var/lib/postgresql/data&quot; has wrong ownership</p><p>ref: <a href="https://stackoverflow.com/questions/49148754/docker-container-shuts-down-giving-data-directory-has-wrong-ownership-error-wh" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/49148754/docker-container-shuts-down-giving-data-directory-has-wrong-ownership-error-wh</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="166-使用-rabbitmq镜像">16.6. 使用 rabbitmq镜像<a href="#166-使用-rabbitmq镜像" class="hash-link" aria-label="16.6. 使用 rabbitmq镜像的直接链接" title="16.6. 使用 rabbitmq镜像的直接链接">​</a></h2><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">rabbitmq</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> rabbitmq</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">management</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;5672:5672&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;15672:15672&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="167-redis镜像">16.7. redis镜像<a href="#167-redis镜像" class="hash-link" aria-label="16.7. redis镜像的直接链接" title="16.7. redis镜像的直接链接">​</a></h2><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">redis</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> redis </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> redis</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">server </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">requirepass 123456</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;6379:6379&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ./db/redis</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker run -p 6379:6379 -d redis:latest redis-server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 数据持久化存方式启动</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -p 6379:6379 -v $PWD/data:/data --name redis -d redis redis-server --appendonly yes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 自定义配置文件, 先创建 /usr/local/docker/redis.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -p 6379:6379 --name myredis -v /usr/local/docker/redis.conf:/etc/redis/redis.conf -v /usr/local/docker/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 带密码启动</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run --name redis_with_auth -p 6379:6379 -d --restart=always redis:latest redis-server --appendonly yes --requirepass &quot;@w-(*102Y613}-Redis&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># redis client</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker exec -ti d0b86 redis-cli [-h localhost -p 6379]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># remote client</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker exec -it redis_image redis-cli -h 192.168.1.100 -p 6379 -a your_password #如果有密码 使用 -a参数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>redis.conf</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">bind 127.0.0.1 #注释掉这部分，这是限制redis只能本地访问</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 允许外网访问redis</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bind 0.0.0.0 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">protected-mode no #默认yes，开启保护模式，会限制为本地访问</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">daemonize no#默认no，改为yes意为以守护进程方式启动，可后台运行，除非kill进程，改为yes会使配置文件方式启动redis失败</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">databases 16 #数据库个数（可选）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dir ./ #输入本地redis数据库存放文件夹（可选）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">appendonly yes #redis持久化（可选）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 设置访问redis的密码为123(可选)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">requirepass 123 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>redis-commander: 提供 redis web 管理界面</p><p><code>docker run --rm -d --name redis-cmder -p 8081:8081 --link redis:re -e REDIS_HOSTS=re:6379 rediscommander/redis-commander</code></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="168-ubuntu镜像">16.8. ubuntu镜像<a href="#168-ubuntu镜像" class="hash-link" aria-label="16.8. ubuntu镜像的直接链接" title="16.8. ubuntu镜像的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker pull ubuntu</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -it ubuntu bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 安装 vim ping wget ifconfig</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt install vim iputils-ping wget net-tools zsh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 2、把默认的Shell改成zsh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">chsh -s /bin/zsh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 安装 oh-my-zsh 需要先装git</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt install git</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="169-zookeeper">16.9. zookeeper<a href="#169-zookeeper" class="hash-link" aria-label="16.9. zookeeper的直接链接" title="16.9. zookeeper的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker run --name some-zookeeper -d -p 2181:2181 zookeeper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查看日志</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker logs -f --tail=10 some-zookeeper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 进入命令行 client (进入后 执行 zkCli.sh -server &lt;ip&gt;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -it --rm --link some-zookeeper:zk zookeeper zkCli.sh -server zk</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">###### zookeeper client cmd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ls / # 查看根节点</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">get /zookeeper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1610-kafka">16.10. kafka<a href="#1610-kafka" class="hash-link" aria-label="16.10. kafka的直接链接" title="16.10. kafka的直接链接">​</a></h2><p><a href="https://github.com/lensesio/fast-data-dev" target="_blank" rel="noopener noreferrer">https://github.com/lensesio/fast-data-dev</a></p><p><a href="https://hub.docker.com/r/bitnami/kafka/" target="_blank" rel="noopener noreferrer">https://hub.docker.com/r/bitnami/kafka/</a>
<a href="https://flxdu.cn/2023/01/23/Kafka-in-Docker-%E5%8D%95%E8%8A%82%E7%82%B9-%E5%A4%9A%E8%8A%82%E7%82%B9/" target="_blank" rel="noopener noreferrer">https://flxdu.cn/2023/01/23/Kafka-in-Docker-%E5%8D%95%E8%8A%82%E7%82%B9-%E5%A4%9A%E8%8A%82%E7%82%B9/</a></p><p><a href="https://github.com/provectus/kafka-ui" target="_blank" rel="noopener noreferrer">https://github.com/provectus/kafka-ui</a></p><p>(可能碰到 springboot 找不到 卡夫卡的地址的问题, 需要吧 docker id 和 127.0.0.1 在 host 中映射)</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">version: &quot;3&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">networks:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  kafka-tier:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    driver: bridge</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#  zookeeper:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#    image: docker.io/bitnami/zookeeper:3.8</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#    container_name: zookeeper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#    networks:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#      - kafka-tier</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#    ports:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#      - &quot;2181:2181&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#    environment:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#      - ALLOW_ANONYMOUS_LOGIN=yes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  kafka:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    image: docker.io/bitnami/kafka:3.5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    container_name: kafka</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      - &quot;9092:9092&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    networks:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      - kafka-tier</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      - ALLOW_PLAINTEXT_LISTENER=yes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  kafka-ui:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    container_name: kafka-ui</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    image: provectuslabs/kafka-ui:latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    networks:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      - kafka-tier</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      - &quot;9093:8080&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    depends_on:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      - kafka</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      DYNAMIC_CONFIG_ENABLED: &#x27;true&#x27;  # not necessary, added for tests</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka:9092</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1611-rabbitmq">16.11. rabbitmq<a href="#1611-rabbitmq" class="hash-link" aria-label="16.11. rabbitmq的直接链接" title="16.11. rabbitmq的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 带 management 的版本有 web 界面</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker pull rabbitmq:3.8.3-management</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 15672 为 web ui 端口, 登录 guest/guest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d --name rabbitmq3.7.7 -p 5672:5672 -p 15672:15672 -v `pwd`/data:/var/lib/rabbitmq --hostname myRabbit -e RABBITMQ_DEFAULT_VHOST=my_vhost  -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin df80af9ca0c9</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1612-zipkin">16.12. zipkin<a href="#1612-zipkin" class="hash-link" aria-label="16.12. zipkin的直接链接" title="16.12. zipkin的直接链接">​</a></h2><p><a href="https://zipkin.io/pages/quickstart.html" target="_blank" rel="noopener noreferrer">https://zipkin.io/pages/quickstart.html</a></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker run --name zipkin-x -d -p 9411:9411 openzipkin/zipkin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>http://localhost:9411/zipkin/</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1613-nginx">16.13. nginx<a href="#1613-nginx" class="hash-link" aria-label="16.13. nginx的直接链接" title="16.13. nginx的直接链接">​</a></h2><p><a href="https://github.com/nginx-proxy/nginx-proxy" target="_blank" rel="noopener noreferrer">https://github.com/nginx-proxy/nginx-proxy</a> 容器里的 nginx 反向代理</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 保证 nginx 下有 conf, conf 文件夹复制自 nginx docker 内部 (docker container cp nginx:/etc/nginx .)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d --name nginx -p 80:80 -v ~/docker_data/nginx/html:/usr/share/nginx/html -v ~/docker_data/nginx/logs:/var/nginx/logs -v ~/docker_data/nginx/conf:/etc/nginx nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1614-mongodb">16.14. mongodb<a href="#1614-mongodb" class="hash-link" aria-label="16.14. mongodb的直接链接" title="16.14. mongodb的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># --auth：需要密码才能访问容器服务。(默认没有账户密码)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d --name mongo -p 27017:27017 -v /Users/xiaoyu/one/docker_data/mongo/data:/data/db -v /Users/xiaoyu/one/docker_data/mongo/backup:/data/backup mongo:latest --auth</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker exec -it mongo mongo admin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 创建一个名为 admin，密码为 123456 的用户。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt;  db.createUser({ user:&#x27;admin&#x27;,pwd:&#x27;123456&#x27;,roles:[ { role:&#x27;userAdminAnyDatabase&#x27;, db: &#x27;admin&#x27;},&quot;readWriteAnyDatabase&quot;]});</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 尝试使用上面创建的用户信息进行连接。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&gt; db.auth(&#x27;admin&#x27;, &#x27;123456&#x27;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 备份</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker exec mongo sh -c &#x27;exec var=`date +%Y%m%d%H%M` &amp;amp;&amp;amp; mongodump -h localhost --port 27017 -u jsmith -p password -d dbname -o /data/backup/$var_test1.dat&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 远程连接</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -it --rm mongo mongo --host 192.168.10.130 --port 27017</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1615-gitlab">16.15. gitlab<a href="#1615-gitlab" class="hash-link" aria-label="16.15. gitlab的直接链接" title="16.15. gitlab的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 拉取gitlab镜像</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker pull beginor/gitlab-ce:11.0.1-ce.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 创建 volume 目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mkdir -p ./gitlab/etc ./gitlab/log ./gitlab/data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 复制配置文件到宿主的 volume 目录里</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 可以手动复制, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 也可以通过创建一个容器然后关闭来达到复制的效果 (推荐)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run --rm --privileged=true -v /root/gitlab/etc:/etc/gitlab -v /root/gitlab/log:/var/log/gitlab -v /root/gitlab/data:/var/opt/gitlab beginor/gitlab-ce:11.0.1-ce.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Ctrl+c 关闭, 此时配置文件被复制到宿主的 volume 目录了</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 修改 gitlab.rb,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 添加 external_url &#x27;http://&lt;宿主机 host&gt;:&lt;宿主机 port&gt;&#x27; (意思是告诉容器内的 gitlab, 在容器内部也要使用这个端口, 以和宿主机准备暴露的端口保持相同. 若宿主采用 80 作为 gitlab 对外端口, 则 external_url 的端口可省略, )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># attention!!! 这里端口配置为a_port, 那么 docker run 运行容器时 , 需要 -p a_port:a_port</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cd gitlab</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vim etc/gitlab.rb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 修改 gitlab.yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 修改 gitlab.host: 宿主机ip地址, gitlab.port: 宿主机暴露的端口, gitlab.https: false</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vim data/gitlab-rails/etc/gitlab.yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 若宿主准备使用默认端口 80, 那么可以 -p 80:80 , 此时修改 external_url 时, 可省略端口 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d --name gitlab -p 8443:443 -p 80:80 --restart unless-stopped -v /root/gitlab/etc:/etc/gitlab -v /root/gitlab/log:/var/log/gitlab -v /root/gitlab/data:/var/opt/gitlab beginor/gitlab-ce:11.0.1-ce.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 自定义暴露端口为 8090, 则需要修改 external_url 时加上端口 8090</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d --name gitlab -p 8443:443 -p 8090:8090 --privileged=true --restart unless-stopped -v /root/gitlab/etc:/etc/gitlab -v /root/gitlab/log:/var/log/gitlab -v /root/gitlab/data:/var/opt/gitlab beginor/gitlab-ce:11.0.1-ce.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1616-etcd">16.16. etcd<a href="#1616-etcd" class="hash-link" aria-label="16.16. etcd的直接链接" title="16.16. etcd的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker pull bitnami/etcd:latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 单节点</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run -p 2379:2379 -e ALLOW_NO_AUTH=yes --name Etcd bitnami/etcd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1617-influxdb">16.17. influxdb<a href="#1617-influxdb" class="hash-link" aria-label="16.17. influxdb的直接链接" title="16.17. influxdb的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker run -d \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --name influxdb \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    -p 8086:8086 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --volume $PWD:/var/lib/influxdb2 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    influxdb:2.1.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>17. vagrant</h1><p><a href="https://github.com/hashicorp/vagrant" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/vagrant</a></p><p><a href="https://github.com/utmapp/UTM" target="_blank" rel="noopener noreferrer">https://github.com/utmapp/UTM</a> ios 平台, mac 平台</p><p> firecracker, kata 之类新轻量虚拟机</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="171-基本使用">17.1. 基本使用<a href="#171-基本使用" class="hash-link" aria-label="17.1. 基本使用的直接链接" title="17.1. 基本使用的直接链接">​</a></h2><p><a href="https://www.vagrantup.com/downloads.html" target="_blank" rel="noopener noreferrer">https://www.vagrantup.com/downloads.html</a> 下载
<a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="noopener noreferrer">https://www.virtualbox.org/wiki/Downloads</a> virtualbox 下载
<a href="https://learn.hashicorp.com/collections/vagrant/getting-started" target="_blank" rel="noopener noreferrer">https://learn.hashicorp.com/collections/vagrant/getting-started</a> 入门</p><p><a href="http://www.vagrantbox.es/" target="_blank" rel="noopener noreferrer">http://www.vagrantbox.es/</a> 搜索 box
<a href="https://app.vagrantup.com/boxes/search" target="_blank" rel="noopener noreferrer">https://app.vagrantup.com/boxes/search</a> 搜索 box
<a href="https://c4ys.com/archives/1230" target="_blank" rel="noopener noreferrer">https://c4ys.com/archives/1230</a> 国内镜像收集 (<a href="http://mirrors.ustc.edu.cn/centos-cloud/centos/7/vagrant/x86_64/images/" target="_blank" rel="noopener noreferrer">清华 centos</a>)</p><p>如何手动下载 box?
例如 找到 kali 的 box 页面 <a href="https://app.vagrantup.com/kalilinux/boxes/rolling" target="_blank" rel="noopener noreferrer">https://app.vagrantup.com/kalilinux/boxes/rolling</a>, 点进 指定版本的页面 <a href="https://app.vagrantup.com/kalilinux/boxes/rolling/versions/2020.4.0" target="_blank" rel="noopener noreferrer">https://app.vagrantup.com/kalilinux/boxes/rolling/versions/2020.4.0</a> , 那么可以 <code>curl -L https://app.vagrantup.com/kalilinux/boxes/rolling/versions/2020.4.0/providers/virtualbox.box -O kali-2020.4.0.box</code></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># verify the installation</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant -v  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant box list # list all available vm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 下载好 box 文件然后</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 加载到 vagrant</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant box add &lt;xxx_box_name&gt; &lt;box_file_Url_path&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant init &lt;xxx_box_name&gt;         #初始化, create a vagrantfile in current folder</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant up        # 启动环境</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 也可以不下载 box file, 直接 init a box (box name can be find from some website), 但是可能很慢</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant init centos/7</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant up # 启动的系统 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 使用 vagrant 用户连接 虚拟机 , 不用密码, 若仅仅一个 machine, 无需指定 machine name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 切换 root, 也可使用 root/vagrant 登录 or : sudo su</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant ssh [machine_name]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant upload &lt;source&gt; [dest] [name|id] # 上传文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant reload # 重启</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant halt  # 关闭虚拟机</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant status  # 查看虚拟机运行状态</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant destroy  # 销毁当前虚拟机</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 打包自己的 box 进行分发, 打包完成后会在当前目录生成一个 package.box 的文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant package</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 上传, 默认传到 vagrant home</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant upload xxx_file [dest_path]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="172-vagrant-设置-ip">17.2. vagrant 设置 ip<a href="#172-vagrant-设置-ip" class="hash-link" aria-label="17.2. vagrant 设置 ip的直接链接" title="17.2. vagrant 设置 ip的直接链接">​</a></h2><p>配置虚拟机为固定 ip: 修改 vagrantfile , 配置为私有网络 (需要先使用 virtualbox 的主机网络管理器配置新增 hostonly 网络)</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">network</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;private_network&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token literal-property property">ip</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;virtualbox_host_only_ip&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>virtualbox_host_only_ip 就是 宿主机 中 virtualbox 的 hostonly ip, 如 192.168.56.1/24</p><p>其实 Vagrant 中一共有三种网络配置, </p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">端口映射</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">Forwarded</span><span class="token plain"> port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">forwarded_port</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain">   将访问宿主计算机</span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain">端口的请求都转发到虚拟机的</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain">端口上</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">forwarded_port</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token literal-property property">protocol</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;udp&quot;</span><span class="token plain">    默认只转发</span><span class="token constant" style="color:rgb(129, 31, 63)">TCP</span><span class="token plain">包，</span><span class="token constant" style="color:rgb(129, 31, 63)">UDP</span><span class="token plain">需要额外添加以下语句</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token literal-property property">好处</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">简单易理解</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">容易实现外网访问虚拟机</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token literal-property property">坏处</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">如果一两个端口需要映射很容易，但是如果有有很多端口，比如MySQL，MongoDB，tomcat等服务，端口比较多时，就比较麻烦。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">不支持在宿主机器上使用小于</span><span class="token number" style="color:rgb(9, 134, 88)">1024</span><span class="token plain">的端口来转发。比如：不能使用</span><span class="token constant" style="color:rgb(129, 31, 63)">SSL</span><span class="token plain">的</span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token plain">端口来进行https连接。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">私有网络（Private network），只有主机可以访问虚拟机，如果多个虚拟机设定在同一个网段也可以互相访问，当然虚拟机是可以访问外部网络的</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">network</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;private_network&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token literal-property property">ip</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;192.168.50.4&quot;</span><span class="token plain">   这里 ip 为 宿主机 上 virtualbox 对应的 host only ip 地址</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token literal-property property">好处</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">安全，只有自己能访问</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token literal-property property">坏处</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">因为私有的原因，所以团队成员其他人不能和你写作</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">公有网络（Public network），虚拟机享受实体机器一样的待遇，一样的网络配置，vagrant1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">版本之后也可以设定静态</span><span class="token constant" style="color:rgb(129, 31, 63)">IP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">network</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;public_network&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token literal-property property">ip</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;192.168.1.120&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">公有网络中还可以设置桥接的网卡</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">network</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;public_network&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token parameter">bridge</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;en1: Wi-Fi (AirPort)&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token literal-property property">好处</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">方便团队协作，别人可以访问你的虚拟机</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token literal-property property">坏处</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">需要有网络，有路由器分配</span><span class="token constant" style="color:rgb(129, 31, 63)">IP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="173-virtualbox四种网络模式">17.3. VirtualBox四种网络模式<a href="#173-virtualbox四种网络模式" class="hash-link" aria-label="17.3. VirtualBox四种网络模式的直接链接" title="17.3. VirtualBox四种网络模式的直接链接">​</a></h2><p><a href="https://blog.csdn.net/qq_28513801/article/details/90138491" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/qq_28513801/article/details/90138491</a></p><h1>18. kali</h1><p><a href="http://uni.mirrors.163.com/kali-images/kali-2020.4/" target="_blank" rel="noopener noreferrer">http://uni.mirrors.163.com/kali-images/kali-2020.4/</a>
<a href="http://mirrors.ustc.edu.cn/kali-images/" target="_blank" rel="noopener noreferrer">http://mirrors.ustc.edu.cn/kali-images/</a>
<a href="http://old.kali.org/kali-images/kali-2020.4/" target="_blank" rel="noopener noreferrer">http://old.kali.org/kali-images/kali-2020.4/</a></p><p><a href="https://www.kali.org/docs/virtualization/install-virtualbox-guest-vm/" target="_blank" rel="noopener noreferrer">https://www.kali.org/docs/virtualization/install-virtualbox-guest-vm/</a></p><p>默认用户名是 root，默认密码是 toor
kali/kali</p><h1>19. 虚拟网卡 macvlan</h1><p><a href="https://fuckcloudnative.io/posts/netwnetwork-virtualization-macvlan/" target="_blank" rel="noopener noreferrer">https://fuckcloudnative.io/posts/netwnetwork-virtualization-macvlan/</a></p><h1>20. Multipass</h1><p>类似 vagrant, 快速获取 Linux 环境</p><p><a href="https://www.chenmo.com.cn/402492" target="_blank" rel="noopener noreferrer">https://www.chenmo.com.cn/402492</a></p><h1>21. drone</h1><p>基于 docker 的持续集成 ci/cd 工具</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/docker">docker</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/distributed-system"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Distributed System 分布式</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/effective-java-reading-note"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Effective Java 阅读笔记</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#41-基本架构" class="table-of-contents__link toc-highlight">4.1. 基本架构</a></li><li><a href="#42-使用场景-得到什么好处" class="table-of-contents__link toc-highlight">4.2. 使用场景-得到什么好处</a></li><li><a href="#43-容器实现的原理" class="table-of-contents__link toc-highlight">4.3. 容器实现的原理</a></li><li><a href="#51-ubuntu-22-install-docker" class="table-of-contents__link toc-highlight">5.1. ubuntu 22 install docker</a></li><li><a href="#52-使用国内镜像" class="table-of-contents__link toc-highlight">5.2. 使用国内镜像</a></li><li><a href="#61-packaging-image-导入导出" class="table-of-contents__link toc-highlight">6.1. packaging image 导入导出</a></li><li><a href="#62-版本命名意义" class="table-of-contents__link toc-highlight">6.2. 版本命名意义</a></li><li><a href="#63-镜像实现原理" class="table-of-contents__link toc-highlight">6.3. 镜像实现原理</a></li><li><a href="#64-获取镜像" class="table-of-contents__link toc-highlight">6.4. 获取镜像</a></li><li><a href="#65-运行镜像" class="table-of-contents__link toc-highlight">6.5. 运行镜像</a></li><li><a href="#66-列出镜像" class="table-of-contents__link toc-highlight">6.6. 列出镜像</a></li><li><a href="#67-删除本地镜像" class="table-of-contents__link toc-highlight">6.7. 删除本地镜像</a></li><li><a href="#71-work-with-golang" class="table-of-contents__link toc-highlight">7.1. work with golang</a></li><li><a href="#72-working-with-frontend" class="table-of-contents__link toc-highlight">7.2. working with frontend</a></li><li><a href="#73-最佳实践-优化体积" class="table-of-contents__link toc-highlight">7.3. 最佳实践 优化体积</a></li><li><a href="#74-通过-dockerfile-来-build-镜像" class="table-of-contents__link toc-highlight">7.4. 通过 dockerfile 来 build 镜像</a></li><li><a href="#75-commit容器成为镜像不推荐" class="table-of-contents__link toc-highlight">7.5. commit容器成为镜像(不推荐)</a></li><li><a href="#76-从压缩包导入" class="table-of-contents__link toc-highlight">7.6. 从压缩包导入</a></li><li><a href="#77-docker-save-和-docker-load" class="table-of-contents__link toc-highlight">7.7. docker save 和 docker load</a></li><li><a href="#81-from" class="table-of-contents__link toc-highlight">8.1. from</a></li><li><a href="#82-镜像的构建上下文context" class="table-of-contents__link toc-highlight">8.2. 镜像的构建上下文context</a><ul><li><a href="#821-dockerignore" class="table-of-contents__link toc-highlight">8.2.1. dockerignore</a></li></ul></li><li><a href="#83-copy-和-add" class="table-of-contents__link toc-highlight">8.3. COPY 和 ADD</a></li><li><a href="#84-workdir-指定工作目录" class="table-of-contents__link toc-highlight">8.4. WORKDIR 指定工作目录</a></li><li><a href="#85-run-cmd-和-entrypoint-容器启动命令" class="table-of-contents__link toc-highlight">8.5. run cmd 和 entrypoint 容器启动命令</a><ul><li><a href="#851-设置时区" class="table-of-contents__link toc-highlight">8.5.1. 设置时区</a></li><li><a href="#852-常见的错误用法" class="table-of-contents__link toc-highlight">8.5.2. 常见的错误用法</a></li><li><a href="#853-都支持两种格式-shell-和-exec-的区别" class="table-of-contents__link toc-highlight">8.5.3. 都支持两种格式 shell 和 exec 的区别</a></li><li><a href="#854-run" class="table-of-contents__link toc-highlight">8.5.4. run</a><ul><li><a href="#8541-典型错误" class="table-of-contents__link toc-highlight">8.5.4.1. 典型错误</a></li></ul></li><li><a href="#855-cmd指令" class="table-of-contents__link toc-highlight">8.5.5. cmd指令</a></li><li><a href="#856-entrypoint-入口点" class="table-of-contents__link toc-highlight">8.5.6. ENTRYPOINT 入口点</a><ul><li><a href="#8561-eg-让镜像变成像命令一样使用" class="table-of-contents__link toc-highlight">8.5.6.1. eg: 让镜像变成像命令一样使用</a></li><li><a href="#8562-eg-应用运行前的准备工作" class="table-of-contents__link toc-highlight">8.5.6.2. eg: 应用运行前的准备工作</a></li></ul></li></ul></li><li><a href="#86-env-和-arg-设置变量" class="table-of-contents__link toc-highlight">8.6. ENV 和 arg 设置变量</a></li><li><a href="#87-volume-定义匿名数据卷" class="table-of-contents__link toc-highlight">8.7. VOLUME 定义匿名数据卷</a></li><li><a href="#88-expose-声明端口" class="table-of-contents__link toc-highlight">8.8. EXPOSE 声明端口</a></li><li><a href="#89-user-指定当前用户" class="table-of-contents__link toc-highlight">8.9. USER 指定当前用户</a></li><li><a href="#810-healthcheck-健康检查" class="table-of-contents__link toc-highlight">8.10. HEALTHCHECK 健康检查</a></li><li><a href="#811-onbuild-给别人用" class="table-of-contents__link toc-highlight">8.11. ONBUILD 给别人用</a></li><li><a href="#812-multi-stage-多阶段构建" class="table-of-contents__link toc-highlight">8.12. multi-stage 多阶段构建</a><ul><li><a href="#8121-清理缓存的镜像" class="table-of-contents__link toc-highlight">8.12.1. 清理缓存的镜像</a></li></ul></li><li><a href="#91-use-docker-in-github-action" class="table-of-contents__link toc-highlight">9.1. use docker in github action</a></li><li><a href="#92-查看" class="table-of-contents__link toc-highlight">9.2. 查看</a></li><li><a href="#93-启动" class="table-of-contents__link toc-highlight">9.3. 启动</a><ul><li><a href="#931--it-维持交互终端" class="table-of-contents__link toc-highlight">9.3.1. -it 维持交互终端</a></li><li><a href="#932--d-后台运行" class="table-of-contents__link toc-highlight">9.3.2. -d 后台运行</a></li><li><a href="#933---privilegedtrue-赋予特权" class="table-of-contents__link toc-highlight">9.3.3. --privileged=true 赋予特权</a></li></ul></li><li><a href="#94-终止container" class="table-of-contents__link toc-highlight">9.4. 终止container</a></li><li><a href="#95-删除container" class="table-of-contents__link toc-highlight">9.5. 删除container</a></li><li><a href="#96-进入容器" class="table-of-contents__link toc-highlight">9.6. 进入容器</a></li><li><a href="#97-容器的导入和导出" class="table-of-contents__link toc-highlight">9.7. 容器的导入和导出</a></li><li><a href="#98-拷贝容器内文件到主机" class="table-of-contents__link toc-highlight">9.8. 拷贝容器内文件到主机</a></li><li><a href="#101-dockerhub" class="table-of-contents__link toc-highlight">10.1. dockerhub</a><ul><li><a href="#1011-publish-by-using-github-action" class="table-of-contents__link toc-highlight">10.1.1. publish by using github action</a></li></ul></li><li><a href="#102-私有仓库" class="table-of-contents__link toc-highlight">10.2. 私有仓库</a><ul><li><a href="#allow-http" class="table-of-contents__link toc-highlight">allow http</a></li><li><a href="#harbor推荐" class="table-of-contents__link toc-highlight">harbor(推荐)</a><ul><li><a href="#k8s-配置harbor" class="table-of-contents__link toc-highlight">k8s 配置harbor</a></li></ul></li><li><a href="#nexus" class="table-of-contents__link toc-highlight">Nexus</a></li><li><a href="#docker-registry" class="table-of-contents__link toc-highlight">docker-registry</a></li></ul></li><li><a href="#111-数据卷" class="table-of-contents__link toc-highlight">11.1. 数据卷</a></li><li><a href="#112-挂载主机目录" class="table-of-contents__link toc-highlight">11.2. 挂载主机目录</a></li><li><a href="#113-volume-的共享" class="table-of-contents__link toc-highlight">11.3. volume 的共享</a></li><li><a href="#121-docker-默认初始创建3-个网络" class="table-of-contents__link toc-highlight">12.1. docker 默认初始创建3 个网络</a></li><li><a href="#124-创建固定ip" class="table-of-contents__link toc-highlight">12.4. 创建固定ip</a></li><li><a href="#125-查看container的ip" class="table-of-contents__link toc-highlight">12.5. 查看container的ip</a></li><li><a href="#126-外部访问容器" class="table-of-contents__link toc-highlight">12.6. 外部访问容器</a></li><li><a href="#127-容器互联" class="table-of-contents__link toc-highlight">12.7. 容器互联</a></li><li><a href="#128-配置dns-和-主机名-hostname" class="table-of-contents__link toc-highlight">12.8. 配置dns 和 主机名 hostname</a></li><li><a href="#131-some-significant-materials" class="table-of-contents__link toc-highlight">13.1. some significant materials</a></li><li><a href="#132-compose简介" class="table-of-contents__link toc-highlight">13.2. compose简介</a></li><li><a href="#133-命令使用" class="table-of-contents__link toc-highlight">13.3. 命令使用</a><ul><li><a href="#1331-up" class="table-of-contents__link toc-highlight">13.3.1. up</a></li><li><a href="#1332-run" class="table-of-contents__link toc-highlight">13.3.2. run</a></li><li><a href="#1333-scale" class="table-of-contents__link toc-highlight">13.3.3. scale</a></li><li><a href="#1334-start" class="table-of-contents__link toc-highlight">13.3.4. start</a></li><li><a href="#1335-build" class="table-of-contents__link toc-highlight">13.3.5. build</a></li><li><a href="#1336-config" class="table-of-contents__link toc-highlight">13.3.6. config</a></li><li><a href="#1337-exec" class="table-of-contents__link toc-highlight">13.3.7. exec</a></li><li><a href="#1338-images" class="table-of-contents__link toc-highlight">13.3.8. images</a></li><li><a href="#1339-kill" class="table-of-contents__link toc-highlight">13.3.9. kill</a></li><li><a href="#13310-down" class="table-of-contents__link toc-highlight">13.3.10. down</a></li><li><a href="#13311-pause" class="table-of-contents__link toc-highlight">13.3.11. pause</a></li><li><a href="#13312-unpause" class="table-of-contents__link toc-highlight">13.3.12. unpause</a></li><li><a href="#13313-restart" class="table-of-contents__link toc-highlight">13.3.13. restart</a></li><li><a href="#13314-stop" class="table-of-contents__link toc-highlight">13.3.14. stop</a></li><li><a href="#13315-rm" class="table-of-contents__link toc-highlight">13.3.15. rm</a></li><li><a href="#13316-logs" class="table-of-contents__link toc-highlight">13.3.16. logs</a></li><li><a href="#13317-top" class="table-of-contents__link toc-highlight">13.3.17. top</a></li><li><a href="#13318-version" class="table-of-contents__link toc-highlight">13.3.18. version</a></li><li><a href="#13319-port" class="table-of-contents__link toc-highlight">13.3.19. port</a></li><li><a href="#13320-ps" class="table-of-contents__link toc-highlight">13.3.20. ps</a></li><li><a href="#13321-pull" class="table-of-contents__link toc-highlight">13.3.21. pull</a></li><li><a href="#13322-push" class="table-of-contents__link toc-highlight">13.3.22. push</a></li></ul></li><li><a href="#134-docker-composeyml" class="table-of-contents__link toc-highlight">13.4. docker-compose.yml</a></li><li><a href="#nacos" class="table-of-contents__link toc-highlight">nacos</a></li><li><a href="#161-搭建持续集成系统" class="table-of-contents__link toc-highlight">16.1. 搭建持续集成系统</a></li><li><a href="#162-docker和springboot" class="table-of-contents__link toc-highlight">16.2. docker和springboot</a></li><li><a href="#163-oracle11g" class="table-of-contents__link toc-highlight">16.3. oracle11g</a></li><li><a href="#164-使用-mysql-镜像" class="table-of-contents__link toc-highlight">16.4. 使用 mysql 镜像</a></li><li><a href="#165-使用postgres镜像" class="table-of-contents__link toc-highlight">16.5. 使用postgres镜像</a></li><li><a href="#166-使用-rabbitmq镜像" class="table-of-contents__link toc-highlight">16.6. 使用 rabbitmq镜像</a></li><li><a href="#167-redis镜像" class="table-of-contents__link toc-highlight">16.7. redis镜像</a></li><li><a href="#168-ubuntu镜像" class="table-of-contents__link toc-highlight">16.8. ubuntu镜像</a></li><li><a href="#169-zookeeper" class="table-of-contents__link toc-highlight">16.9. zookeeper</a></li><li><a href="#1610-kafka" class="table-of-contents__link toc-highlight">16.10. kafka</a></li><li><a href="#1611-rabbitmq" class="table-of-contents__link toc-highlight">16.11. rabbitmq</a></li><li><a href="#1612-zipkin" class="table-of-contents__link toc-highlight">16.12. zipkin</a></li><li><a href="#1613-nginx" class="table-of-contents__link toc-highlight">16.13. nginx</a></li><li><a href="#1614-mongodb" class="table-of-contents__link toc-highlight">16.14. mongodb</a></li><li><a href="#1615-gitlab" class="table-of-contents__link toc-highlight">16.15. gitlab</a></li><li><a href="#1616-etcd" class="table-of-contents__link toc-highlight">16.16. etcd</a></li><li><a href="#1617-influxdb" class="table-of-contents__link toc-highlight">16.17. influxdb</a></li><li><a href="#171-基本使用" class="table-of-contents__link toc-highlight">17.1. 基本使用</a></li><li><a href="#172-vagrant-设置-ip" class="table-of-contents__link toc-highlight">17.2. vagrant 设置 ip</a></li><li><a href="#173-virtualbox四种网络模式" class="table-of-contents__link toc-highlight">17.3. VirtualBox四种网络模式</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">历史</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tags">标签</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">归档</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/xiaoyureed" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/xiaoyuhfq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/3fPgwd3naN" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/friends">友链</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/resource">导航</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Xiaoyureed, Inc. Built with ❤️ by xiaoyu.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.fcfce0fe.js"></script>
<script src="/assets/js/main.c0b909ce.js"></script>
</body>
</html>