<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-kubernetes-k8s">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">kubernetes-k8s â˜ï¸ - Xiaoyureed çš„ç½‘ç»œ Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xiaoyureed.github.io/img/logo.webp"><meta data-rh="true" name="twitter:image" content="https://xiaoyureed.github.io/img/logo.webp"><meta data-rh="true" property="og:url" content="https://xiaoyureed.github.io/docs/kubernetes-k8s"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="keywords" content="xiaoyureed"><meta data-rh="true" name="keywords" content="blog, java, spring, microservice, python, rust, typescript, react, web"><meta data-rh="true" name="keywords" content=" åŠè·¯è½¬è¡Œçš„ç¼–ç¨‹çˆ±å¥½è€…, å†™è¿‡ Python, Rust, ç°åœ¨ä¸»æ”» Java åˆ†å¸ƒå¼ç³»ç»Ÿ"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="kubernetes-k8s â˜ï¸ - Xiaoyureed çš„ç½‘ç»œ Wiki"><meta data-rh="true" name="description" content="- 1. é¢è¯•é—®é¢˜"><meta data-rh="true" property="og:description" content="- 1. é¢è¯•é—®é¢˜"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xiaoyureed.github.io/docs/kubernetes-k8s"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/en/docs/kubernetes-k8s" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/kubernetes-k8s" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/kubernetes-k8s" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://5SAMPKXTP9-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Xiaoyureed çš„ç½‘ç»œ Wiki" href="/opensearch.xml">


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f6da56a47f5085d1e0fedae39b8de00a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="xiaoyureed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="xiaoyureed Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="xiaoyureed JSON Feed">

<link rel="icon" href="/img/logo.webp">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)">
<meta name="description" content="Xiaoyureed çš„ä¸ªäººåšå®¢"><link rel="stylesheet" href="/assets/css/styles.d08d09a2.css">
<link rel="preload" href="/assets/js/runtime~main.831ed87f.js" as="script">
<link rel="preload" href="/assets/js/main.d4aae7e0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="è·³åˆ°ä¸»è¦å†…å®¹"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">è·³åˆ°ä¸»è¦å†…å®¹</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><a href="/docs/rust-note" target="_blank">Rust æŒ‡åŒ—, æ¬¢è¿æŸ¥çœ‹...</a></div><button type="button" aria-label="å…³é—­" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="ä¸»å¯¼èˆª" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="åˆ‡æ¢å¯¼èˆªæ " aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">èœå•</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/archive">åšå®¢</a></li><li><a class="dropdown__link" href="/docs/intro">æ•™ç¨‹</a></li><li><a class="dropdown__link" href="/resource">å¯¼èˆª</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-label="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="æœç´¢"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">æœç´¢</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="å›åˆ°é¡¶éƒ¨" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--dark_i4oU"><b></b></a><nav aria-label="æ–‡æ¡£ä¾§è¾¹æ " class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/SpringBoot-note">Spring Boot å¤‡å¿˜</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/autohotkey">Autohotkey è„šæœ¬</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/blockchain">blockchainåŒºå—é“¾</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/c-sharp-and-dot-net">C# &amp; .NET</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/chatgpt">Chatgpt Usage Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cpp">CPP and C å¤‡å¿˜</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cross-gfw">Cross The GFW</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cs-note">Computer Science Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/css-pre-processor">å‡ ç§CSSé¢„å¤„ç†å™¨æ¯”è¾ƒé€‰å‹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/data-structure-and-algorithm">Data Structure and Algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/design-pattern-note">Design Pattern ç¬”è®°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-resources">å¼€å‘è€…èµ„æº</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/distributed-system">Distributed System åˆ†å¸ƒå¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docker-note-virtual-dev-env">Docker Note &amp; Other Virtual Develop Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/effective-java-reading-note">Effective Java é˜…è¯»ç¬”è®°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/elk-elastic-log">Distributed log collectionåˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/english-note">è‹±è¯­å­¦ä¹ ğŸ”¥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extjs-note">Extjs ç¬”è®°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/git-note">Git å¤‡å¿˜ ğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/golang-note">Golang ç¬”è®°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gps-gis-tracing">åŸºäºåœ°ç†ä½ç½®å¼€å‘æŠ€æœ¯</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gradle">Gradle note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/greasy-monkey">æ²¹çŒ´æ’ä»¶&amp;ç¼–å†™è„šæœ¬ğŸ’</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/groovy-note">groovy note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/health">Health å…³çˆ±ç¨‹åºå‘˜å¥åº·ğŸ¥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/how-to-test-java-app">How to Test Java App</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/interview-system-design">ç³»ç»Ÿè®¾è®¡ System design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/iot">Iot ç‰©è”ç½‘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-code-clean">Java Clean Code Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-concurrent">Java ConcurrentğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-memory-model-jmm-jvm">JMM and GCğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/java-note">Java Core ç¬”è®°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/js-tutorial">JavaScript tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/kotlin">kotlin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/kubernetes-k8s">kubernetes-k8s â˜ï¸</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux-note">é¸Ÿå“¥çš„ Linux ç§æˆ¿èœé˜…è¯»ç¬”è®°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/low-code-platform">å…³äºä½ä»£ç å¹³å°çš„è°ƒç ”</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mac">Mac å¼€å‘ç¯å¢ƒ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/machine-learning-ml">machine-learning-ml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/marketing-seo">Marketing SEO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/maven-note">Maven NotesğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/message-queue">Message QueueğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/money">Investment Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mongodb-note">MongoDB NotesğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/monitor-system-grafana-prometheus-influxdb-hbase">monitor-system-grafana-prometheusç›‘æ§ğŸ–¥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mvc-mvvm">MVC to MVVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mybatis-note">MyBatis Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/netty-note">netty</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nlp-natural-language-processing">nlp-natural-language-processingğŸ‘„</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nodejs-yarn-npm">Nodejs, Yarn, Npm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/oracle">Oracle å¤‡å¿˜</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-audio-video">Audio and Video development Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-big-data-introduce">å¤§æ•°æ®å¼€å‘ Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-cache">Cache ç¼“å­˜ğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-computational-ad">è®¡ç®—å¹¿å‘Š Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-crawler-spider">ç½‘ç»œçˆ¬è™« Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-db-design-note">å…³ç³»å‹æ•°æ®åº“è¡¨è®¾è®¡ğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-desktop-develop">æ¡Œé¢åº”ç”¨å¼€å‘ Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-http-restful">HTTP protocol Intro &amp; RESTful</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-reactive-programming">å“åº”å¼ç¼–ç¨‹ Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-rpc">RPC Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/outline-about-rule-engine-note">è§„åˆ™å¼•æ“ Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/php-note">PHP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/postgres-note">Postgres noteğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/process-workflow-bpm-engine">å·¥ä½œæµå¼•æ“</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/protect-your-app-authentication-oauth2-jwt-https">Protect Your App å®‰å…¨ä¿æŠ¤è®¤è¯é‰´æƒğŸ”‘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/python-note">PythonğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quant-money">é‡åŒ–äº¤æ˜“</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quarkus">Quarkus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/react-note">ReactğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/real-time-communication-protocol">å®æ—¶é€šä¿¡ Real-time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/redis-note">RedisğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/regex">Regular Expression æ­£åˆ™ğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/rust-note">Rust ç¬”è®°ğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/scala-akka-play-framework">Scala è¯­è¨€</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/serverless">Serverless</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/service-mesh">service mesh æœåŠ¡ç½‘æ ¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/servlet">Servlet Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/shell-bash-note">shell-bashè„šæœ¬æ”¶é›†</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/spring-note">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springcloud-note">Spring Cloud ç¬”è®°ğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springmvc-note">Spring MVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/task-schedule-note">Task Schedule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tcp-ip-note-p2p">TCP IP, p2p</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tomcat-jetty-nginx">Tomcat Jetty Nginx ç­‰ web å®¹å™¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/vertx">Vertx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/video-creator">æ‹æ‘„</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webassembly">webassembly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webpack-esbuild-vite-rollup">å‰ç«¯æ‰“åŒ…æ„å»ºå·¥å…·</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/windows-sub-system-on-linux">WSL ä½¿ç”¨</a></li></ul></nav><button type="button" title="æ”¶èµ·ä¾§è¾¹æ " aria-label="æ”¶èµ·ä¾§è¾¹æ " class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="é¡µé¢è·¯å¾„"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ä¸»é¡µé¢" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">kubernetes-k8s â˜ï¸</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">æœ¬é¡µæ€»è§ˆ</button></div><div class="theme-doc-markdown markdown"><header><h1>kubernetes-k8s â˜ï¸</h1></header><ul><li><a href="#1-%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98">1. é¢è¯•é—®é¢˜</a></li><li><a href="#%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7">å¼€å‘è°ƒè¯•å·¥å…·</a></li><li><a href="#2-deploying-springcloud">2. deploying springcloud</a><ul><li><a href="#using-configmap">using configMap</a></li><li><a href="#%E9%83%A8%E7%BD%B2%E5%88%B0-k8s-%E5%90%8E%E8%BF%98%E6%98%AF%E6%9C%89%E7%BC%BA%E7%82%B9">éƒ¨ç½²åˆ° k8s åè¿˜æ˜¯æœ‰ç¼ºç‚¹</a></li></ul></li><li><a href="#3-what-and-why">3. what and why</a><ul><li><a href="#31-k8s-%E6%98%AF%E5%81%9A%E4%BB%80%E4%B9%88%E7%9A%84">3.1. k8s æ˜¯åšä»€ä¹ˆçš„</a></li><li><a href="#32-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8">3.2. ä¸ºä»€ä¹ˆä½¿ç”¨:</a></li><li><a href="#33-compare-with-spring-cloud">3.3. compare with spring cloud</a></li></ul></li><li><a href="#4-%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83">4. æ­å»ºç¯å¢ƒ</a><ul><li><a href="#41-%E7%94%9F%E4%BA%A7%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E5%AE%89%E8%A3%85">4.1. ç”Ÿäº§æœåŠ¡å™¨ä¸Šå®‰è£…</a></li><li><a href="#42-vagrant-%E6%90%AD%E5%BB%BA-k8s-%E7%8E%AF%E5%A2%83">4.2. vagrant æ­å»º k8s ç¯å¢ƒ</a></li><li><a href="#43-%E4%BC%97%E5%A4%9A%E7%9A%84%E5%8F%91%E8%A1%8C%E7%89%88">4.3. ä¼—å¤šçš„å‘è¡Œç‰ˆ</a><ul><li><a href="#431-k3s">4.3.1. k3s</a><ul><li><a href="#4311-k3d">4.3.1.1. k3d</a><ul><li><a href="#43111-%E4%BD%BF%E7%94%A8-helmchart-controller">4.3.1.1.1. ä½¿ç”¨ helmChart controller</a></li><li><a href="#43112-%E6%93%8D%E4%BD%9C-kubeconfig">4.3.1.1.2. æ“ä½œ kubeconfig</a></li><li><a href="#43113-%E6%94%AF%E6%8C%81%E7%9A%84%E5%91%BD%E4%BB%A4">4.3.1.1.3. æ”¯æŒçš„å‘½ä»¤</a></li><li><a href="#43114-%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F">4.3.1.1.4. å›½å†…é•œåƒ</a></li><li><a href="#43115-%E5%AF%BC%E5%85%A5%E9%95%9C%E5%83%8F">4.3.1.1.5. å¯¼å…¥é•œåƒ</a></li><li><a href="#43116-k3s-%E5%8C%85%E6%8B%AC%E4%BB%A5%E4%B8%8B%E4%B8%80%E4%BA%9B%E7%BB%84%E4%BB%B6">4.3.1.1.6. k3s åŒ…æ‹¬ä»¥ä¸‹ä¸€äº›ç»„ä»¶</a></li><li><a href="#43117-%E5%AE%8C%E6%95%B4%E7%9A%84-k3d-yml-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">4.3.1.1.7. å®Œæ•´çš„ k3d yml é…ç½®æ–‡ä»¶</a></li><li><a href="#43118-%E9%83%A8%E7%BD%B2%E4%B8%80%E4%B8%AA-nginx">4.3.1.1.8. éƒ¨ç½²ä¸€ä¸ª NGINX</a></li></ul></li></ul></li><li><a href="#432-k0s">4.3.2. k0s</a></li><li><a href="#433-microk8s">4.3.3. microk8s</a></li><li><a href="#434-docker-desktop-%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8-rancher-desktop-%E6%9B%BF%E4%BB%A3">4.3.4. docker desktop (æ¨èä½¿ç”¨ rancher desktop æ›¿ä»£)</a></li><li><a href="#435-kind-%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8-k3d-%E4%BB%A3%E6%9B%BF">4.3.5. kind (æ¨èä½¿ç”¨ k3d ä»£æ›¿)</a></li><li><a href="#436-minikube">4.3.6. minikube</a></li></ul></li></ul></li><li><a href="#5-quickstart">5. Quickstart</a><ul><li><a href="#51-%E4%BB%A5java-%E4%B8%BA%E4%BE%8B">5.1. ä»¥Java ä¸ºä¾‹</a></li><li><a href="#52-%E4%BB%A5-go-%E4%B8%BA%E4%BE%8B">5.2. ä»¥ go ä¸ºä¾‹</a><ul><li><a href="#521-using-pod-directly">5.2.1. using pod directly</a></li><li><a href="#522-using-deployment">5.2.2. using deployment</a></li></ul></li></ul></li><li><a href="#6-%E9%9B%86%E7%BE%A4%E7%BB%93%E6%9E%84-underlying-infrastructure-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD">6. é›†ç¾¤ç»“æ„ underlying infrastructure åŸºç¡€è®¾æ–½</a></li><li><a href="#7-api-%E7%AE%A1%E7%90%86%E7%9A%84%E5%90%84%E7%A7%8D%E8%B5%84%E6%BA%90">7. api ç®¡ç†çš„å„ç§èµ„æº</a><ul><li><a href="#71-%E5%90%84%E7%A7%8D%E8%B5%84%E6%BA%90%E7%9A%84%E5%85%B3%E7%B3%BB">7.1. å„ç§èµ„æºçš„å…³ç³»</a></li><li><a href="#72-3-common-properties">7.2. 3 common properties</a><ul><li><a href="#721-metadata">7.2.1. metadata</a></li><li><a href="#722-spec">7.2.2. spec</a></li><li><a href="#723-status">7.2.3. status</a></li></ul></li><li><a href="#73-node">7.3. node</a></li><li><a href="#74-pod">7.4. pod</a></li><li><a href="#75-label">7.5. label</a><ul><li><a href="#751-label-selector-%E4%BD%BF%E7%94%A8">7.5.1. Label selector ä½¿ç”¨</a></li></ul></li><li><a href="#76-taint%E6%B1%A1%E7%82%B9%E5%92%8C-toleration%E5%AE%B9%E5%BF%8D">7.6. Taintï¼ˆæ±¡ç‚¹ï¼‰å’Œ Tolerationï¼ˆå®¹å¿ï¼‰</a><ul><li><a href="#761-taint">7.6.1. taint</a></li><li><a href="#762-toleration">7.6.2. toleration</a></li></ul></li><li><a href="#77-controllers%E5%90%84%E7%A7%8D%E6%8E%A7%E5%88%B6%E5%99%A8">7.7. controllers(å„ç§æ§åˆ¶å™¨)</a><ul><li><a href="#771-rc-replica-controller-%E5%89%AF%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%99%A8">7.7.1. <del>RC (replica controller å‰¯æœ¬æ§åˆ¶å™¨)</del></a></li><li><a href="#772-rs-replica-set-%E4%BB%A3%E6%9B%BF-rc">7.7.2. RS (replica set, ä»£æ›¿ RC)</a></li><li><a href="#773-deployment-%E7%AE%A1%E7%90%86-rs">7.7.3. Deployment (ç®¡ç† RS)</a><ul><li><a href="#7731-scale-upback-%E6%89%A9%E5%AE%B9%E7%BC%A9%E5%AE%B9">7.7.3.1. scale up/back (æ‰©å®¹ç¼©å®¹)</a></li><li><a href="#7732-version-upgrade-%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7">7.7.3.2. version upgrade (ç‰ˆæœ¬å‡çº§)</a></li><li><a href="#7733-rolling-update-%E6%BB%9A%E5%8A%A8%E5%8D%87%E7%BA%A7">7.7.3.3. rolling update (æ»šåŠ¨å‡çº§)</a></li><li><a href="#7734-%E5%9B%9E%E6%BB%9A-%E7%89%88%E6%9C%AC%E5%9B%9E%E9%80%80-%E6%9F%A5%E7%9C%8B%E5%8E%86%E5%8F%B2">7.7.3.4. å›æ»š ç‰ˆæœ¬å›é€€ æŸ¥çœ‹å†å²</a></li><li><a href="#7735-livenessprobe-%E5%AD%98%E6%B4%BB%E6%8E%A2%E9%92%88">7.7.3.5. livenessProbe (å­˜æ´»æ¢é’ˆ)</a></li><li><a href="#7736-readinessprobe-%E5%B0%B1%E7%BB%AA%E6%8E%A2%E9%92%88">7.7.3.6. readinessProbe (å°±ç»ªæ¢é’ˆ)</a></li></ul></li><li><a href="#774-sc-stateful-set">7.7.4. SC (stateful set)</a><ul><li><a href="#7741-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96-persist">7.7.4.1. æ•°æ®æŒä¹…åŒ– persist</a></li></ul></li><li><a href="#775-ds-daemon-set-%E5%90%8E%E5%8F%B0%E6%94%AF%E6%92%91%E6%9C%8D%E5%8A%A1%E9%9B%86">7.7.5. DS (daemon set åå°æ”¯æ’‘æœåŠ¡é›†)</a></li><li><a href="#776-job-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1">7.7.6. job (ä¸€æ¬¡æ€§ä»»åŠ¡)</a></li><li><a href="#777-cronjob-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1">7.7.7. cronjob (å®šæ—¶ä»»åŠ¡)</a></li></ul></li><li><a href="#78-service">7.8. service</a><ul><li><a href="#781-endpoint">7.8.1. Endpoint</a></li><li><a href="#782-%E5%A4%9A%E7%AB%AF%E5%8F%A3">7.8.2. å¤šç«¯å£</a></li><li><a href="#783-clusterip-%E9%BB%98%E8%AE%A4%E4%BD%BF%E7%94%A8%E7%9A%84%E7%B1%BB%E5%9E%8B">7.8.3. ClusterIP (é»˜è®¤ä½¿ç”¨çš„ç±»å‹)</a><ul><li><a href="#7831-headless">7.8.3.1. Headless</a></li></ul></li><li><a href="#784-nodeport">7.8.4. NodePort</a></li><li><a href="#785-loadbalancer">7.8.5. LoadBalancer</a></li><li><a href="#786-externalname">7.8.6. ExternalName</a></li><li><a href="#787-%E6%89%8B%E5%8A%A8%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91">7.8.7. æ‰‹åŠ¨ç«¯å£è½¬å‘</a></li><li><a href="#788-service-%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C">7.8.8. service å¦‚ä½•å·¥ä½œ</a></li></ul></li><li><a href="#79-ingress">7.9. ingress</a><ul><li><a href="#791-install-ingress-nginx">7.9.1. install ingress-nginx</a></li><li><a href="#792-traefik">7.9.2. Traefik</a></li></ul></li><li><a href="#710-volume">7.10. volume</a></li><li><a href="#711-secret">7.11. secret</a></li><li><a href="#712-config-map">7.12. config map</a></li><li><a href="#713-flannel">7.13. flannel</a></li><li><a href="#714-name">7.14. name</a></li><li><a href="#715-name-namespace-%E7%94%A8%E6%9D%A5%E5%88%92%E5%88%86%E5%A4%9A%E7%8E%AF%E5%A2%83">7.15. name namespace (ç”¨æ¥åˆ’åˆ†å¤šç¯å¢ƒ)</a></li></ul></li><li><a href="#8-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6">8. åƒåœ¾å›æ”¶</a><ul><li><a href="#81-%E7%BA%A7%E8%81%94%E5%88%A0%E9%99%A4">8.1. çº§è”åˆ é™¤</a></li><li><a href="#82-%E5%AD%A4%E5%84%BF%E5%88%A0%E9%99%A4-orphan">8.2. å­¤å„¿åˆ é™¤ orphan</a></li></ul></li><li><a href="#9-%E8%B5%84%E6%BA%90%E6%8F%8F%E8%BF%B0%E6%96%87%E4%BB%B6">9. èµ„æºæè¿°æ–‡ä»¶</a><ul><li><a href="#91-%E6%9F%A5%E7%9C%8B%E5%B1%9E%E6%80%A7%E8%AF%B4%E6%98%8E">9.1. æŸ¥çœ‹å±æ€§è¯´æ˜</a></li><li><a href="#92-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E7%94%9F%E6%88%90-yml">9.2. é€šè¿‡å‘½ä»¤ç”Ÿæˆ yml</a></li><li><a href="#93-pod-%E7%9A%84-yaml-%E6%8F%8F%E8%BF%B0%E6%96%87%E4%BB%B6">9.3. pod çš„ yaml æè¿°æ–‡ä»¶</a></li><li><a href="#94-deployment-%E7%9A%84%E6%8F%8F%E8%BF%B0%E6%96%87%E4%BB%B6">9.4. deployment çš„æè¿°æ–‡ä»¶</a></li><li><a href="#95-service">9.5. service</a></li></ul></li><li><a href="#10-%E6%B3%A8%E8%A7%A3">10. æ³¨è§£</a></li><li><a href="#11-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4">11. å‘½åç©ºé—´</a></li><li><a href="#12-pod-%E7%AE%A1%E7%90%86">12. pod ç®¡ç†</a><ul><li><a href="#121-%E6%8E%A2%E6%B5%8B-pod-%E6%98%AF%E5%90%A6%E5%81%A5%E5%BA%B7">12.1. æ¢æµ‹ pod æ˜¯å¦å¥åº·</a></li><li><a href="#122-pod-%E5%89%AF%E6%9C%AC">12.2. pod å‰¯æœ¬</a></li><li><a href="#123-%E8%BF%90%E8%A1%8C%E5%8D%95%E4%B8%AA%E4%BB%BB%E5%8A%A1-job">12.3. è¿è¡Œå•ä¸ªä»»åŠ¡ Job</a></li><li><a href="#124-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1-cronjob">12.4. å®šæ—¶ä»»åŠ¡ CronJob</a></li></ul></li><li><a href="#13-pod-%E9%80%9A%E4%BF%A1">13. pod é€šä¿¡</a><ul><li><a href="#131-proxy">13.1. proxy</a></li><li><a href="#132-service">13.2. Service</a></li><li><a href="#133-pod-%E9%97%B4%E9%80%9A%E4%BF%A1">13.3. pod é—´é€šä¿¡</a></li><li><a href="#134-%E9%80%9A%E8%BF%87-service-%E8%BF%9E%E6%8E%A5%E5%A4%96%E9%83%A8%E6%9C%8D%E5%8A%A1">13.4. é€šè¿‡ Service è¿æ¥å¤–éƒ¨æœåŠ¡</a><ul><li><a href="#1341-%E9%80%9A%E8%BF%87%E6%89%8B%E5%8A%A8%E7%94%9F%E6%88%90-endpoint">13.4.1. é€šè¿‡æ‰‹åŠ¨ç”Ÿæˆ endpoint</a></li><li><a href="#1342-%E9%80%9A%E8%BF%87-externalname-%E7%B1%BB%E5%9E%8B%E7%9A%84-service">13.4.2. é€šè¿‡ externalName ç±»å‹çš„ Service</a></li></ul></li><li><a href="#135-%E5%B0%86%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2%E7%BB%99%E5%A4%96%E9%83%A8">13.5. å°†æœåŠ¡æš´éœ²ç»™å¤–éƒ¨</a><ul><li><a href="#1351-%E5%B0%86%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%B1%BB%E5%9E%8B%E8%AE%BE%E7%BD%AE%E6%88%90-nodeport">13.5.1. å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ NodePort</a></li><li><a href="#1352-%E5%B0%86%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%B1%BB%E5%9E%8B%E8%AE%BE%E7%BD%AE%E6%88%90-loadbalance">13.5.2. å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ LoadBalance</a></li><li><a href="#1353-%E5%88%9B%E5%BB%BA%E4%B8%80-%E4%B8%AA-ingress-%E8%B5%84%E6%BA%90">13.5.3. åˆ›å»ºä¸€ ä¸ª Ingress èµ„æº</a></li></ul></li></ul></li><li><a href="#14-%E5%91%BD%E4%BB%A4">14. å‘½ä»¤</a><ul><li><a href="#141-kubectl">14.1. kubectl</a><ul><li><a href="#1411-%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF">14.1.1. åŸºæœ¬ä¿¡æ¯</a></li><li><a href="#1412-%E5%88%9B%E5%BB%BA-create-expose">14.1.2. åˆ›å»º create expose</a></li><li><a href="#1413-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E5%88%B0%E5%AE%B9%E5%99%A8-exec">14.1.3. æ‰§è¡Œå‘½ä»¤åˆ°å®¹å™¨ exec</a></li><li><a href="#1414-%E4%BF%AE%E6%94%B9">14.1.4. ä¿®æ”¹</a></li><li><a href="#1415-%E8%B5%84%E6%BA%90%E5%88%97%E8%A1%A8-get">14.1.5. èµ„æºåˆ—è¡¨ get</a></li><li><a href="#1416-%E6%9F%A5%E8%AF%A2%E8%AF%A6%E7%BB%86%E6%8F%8F%E8%BF%B0-describe">14.1.6. æŸ¥è¯¢è¯¦ç»†æè¿° describe</a></li><li><a href="#1417-%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97-logs">14.1.7. æŸ¥è¯¢æ—¥å¿— logs</a></li><li><a href="#1418-%E5%88%A0%E9%99%A4-delete">14.1.8. åˆ é™¤ delete</a></li><li><a href="#1419-%E6%93%8D%E4%BD%9C%E4%B8%8A%E4%B8%8B%E6%96%87">14.1.9. æ“ä½œä¸Šä¸‹æ–‡</a></li></ul></li><li><a href="#142-kubeadmin">14.2. kubeadmin</a></li></ul></li><li><a href="#15-cka-ckad-%E8%AF%81%E4%B9%A6%E8%80%83%E8%AF%95">15. cka ckad è¯ä¹¦è€ƒè¯•</a></li><li><a href="#16-dashboard">16. dashboard</a><ul><li><a href="#161-k9s">16.1. k9s</a></li><li><a href="#162-kuboard">16.2. kuboard</a></li><li><a href="#163-kubernetes-dashboard">16.3. kubernetes-dashboard</a></li><li><a href="#164-kubesphere-%E6%8E%A8%E8%8D%90">16.4. kubesphere (æ¨è)</a></li></ul></li><li><a href="#17-rancher">17. rancher</a></li><li><a href="#18-harbor">18. Harbor</a></li><li><a href="#19-helm">19. Helm</a><ul><li><a href="#191-how-to-create-helm-chart">19.1. How to create helm chart</a></li><li><a href="#192-helm-chart-%E7%9A%84%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83">19.2. helm chart çš„æ‰“åŒ…å‘å¸ƒ</a><ul><li><a href="#1921-%E6%89%8B%E5%8A%A8%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83">19.2.1. æ‰‹åŠ¨æ‰“åŒ…å‘å¸ƒ</a></li><li><a href="#1922-%E5%88%A9%E7%94%A8-github-action-%E8%87%AA%E5%8A%A8%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83">19.2.2. åˆ©ç”¨ github action è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ</a></li></ul></li><li><a href="#193-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8">19.3. åŸºæœ¬å‘½ä»¤ä½¿ç”¨</a></li><li><a href="#194-rollback">19.4. rollback</a></li><li><a href="#195-%E5%A4%9A%E7%8E%AF%E5%A2%83">19.5. å¤šç¯å¢ƒ</a></li></ul></li><li><a href="#20-reference-materials">20. reference materials</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-é¢è¯•é—®é¢˜">1. é¢è¯•é—®é¢˜<a href="#1-é¢è¯•é—®é¢˜" class="hash-link" aria-label="1. é¢è¯•é—®é¢˜çš„ç›´æ¥é“¾æ¥" title="1. é¢è¯•é—®é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ä¸ºä»€ä¹ˆéœ€è¦ pod? ä¸ºä»€ä¹ˆä¸èƒ½ç®€å•åœ°æŠŠæ‰€æœ‰è¿›ç¨‹éƒ½æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„å®¹å™¨ä¸­?</p><ul><li>å¦‚æœåœ¨å•ä¸ªå®¹å™¨ä¸­è¿è¡Œå¤šä¸ªä¸ç›¸å…³çš„è¿›ç¨‹ï¼Œ é‚£ä¹ˆä¿æŒæ‰€æœ‰è¿›ç¨‹è¿è¡Œ(å¦‚å¤±è´¥é‡å¯)ã€ ç®¡ç†å®ƒä»¬çš„æ—¥å¿—ä¼šå›°éš¾(æ—¥å¿—ä¼šæ··åœ¨ä¸€èµ·)ã€‚</li></ul><p>ä¸ºä»€ä¹ˆè¦å°†ä¸€ä¸ª app çš„ å‰ç«¯æœåŠ¡å™¨ å’Œ åç«¯æœåŠ¡å™¨ åˆ†ä¸º ä¸¤ä¸ª pod éƒ¨ç½²?</p><ul><li><p>é€ æˆè®¡ç®—èµ„æºæµªè´¹: å¦‚æœéƒ¨ç½²åˆ°åŒä¸€ä¸ª pod, é‚£ä¹ˆå¯¹äº åŒèŠ‚ç‚¹ k8s, å°†æ€»æ˜¯åªèƒ½åˆ©ç”¨ä¸€ä¸ªèŠ‚ç‚¹</p></li><li><p>æ‰©ç¼©å®¹ä¸ä¾¿: k8s æ‰©å®¹åŸºæœ¬å•ä½å°±æ˜¯ pod, å‰åç«¯è‹¥éƒ¨ç½²åˆ°åŒä¸ª pod, ä¼šé€ æˆæ‰©ç¼©å®¹ç²’åº¦å¤ªå¤§. è€Œä¸”å¯¹äº æ•°æ®åº“æœåŠ¡å™¨, æ‰©ç¼©å®¹æ— æ³•è¿™æ ·ç®€å•å¤„ç†</p></li></ul><p>å¦‚ä½•å†³å®šæ˜¯å¦å°†å¤šä¸ª container åˆ’åˆ†åˆ°ä¸€ä¸ª pod?</p><ul><li>æ‰©ç¼©å®¹æ˜¯å¦èƒ½å¤Ÿä¸€èµ·è¿›è¡Œ</li><li>æ˜¯å¦å¯ä»¥åœ¨åŒä¸ªä¸»æœºè¿è¡Œ</li></ul><p>11 å¹´è¿ç»´å·¥ä½œç»éªŒï¼Œç°ä»äº‹è…¾è®¯å·¥ä¸šäº’è”ç½‘è¿ç»´å·¥ä½œï¼› DevOps è¿ç»´å·¥ç¨‹å¸ˆï¼Œå¼€æºçˆ±å¥½è€…ï¼› 3 å¹´+Kubernetes å¹³å°ç»éªŒï¼Œå¯¹ Kubernetes ç”Ÿæ€æœ‰è‡ªå·±çš„è®¤è¯†ï¼›æŒæ¡ Jenkins+Gitlab+Helm æŒç»­é›†æˆ/æŒç»­äº¤ä»˜å·¥å…·é“¾ï¼›å¯¹æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç¼“å­˜ç­‰ä¸­é—´ä»¶ï¼Œè½¯ä»¶æ¶æ„ä½“ç³»æœ‰ä¸€å®šçš„äº†è§£ï¼›ç†Ÿç»ƒæŒæ¡ shell ç¼–ç¨‹ï¼Œç†Ÿæ‚‰ Python,Go è¯­è¨€ï¼› TODO</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å¼€å‘è°ƒè¯•å·¥å…·">å¼€å‘è°ƒè¯•å·¥å…·<a href="#å¼€å‘è°ƒè¯•å·¥å…·" class="hash-link" aria-label="å¼€å‘è°ƒè¯•å·¥å…·çš„ç›´æ¥é“¾æ¥" title="å¼€å‘è°ƒè¯•å·¥å…·çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ä¸€èˆ¬æ¥è¯´k8sä½¿ç”¨çš„å®¹å™¨ç½‘ç»œä¸å¼€å‘è€…çš„æ‰€åœ¨çš„åŠå…¬ç½‘ç»œå¹¶ä¸èƒ½ç›´æ¥è¿é€šï¼Œå¦‚ä½•åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒè®¿é—®æœåŠ¡å™¨ä¸Šçš„k8sçš„æœåŠ¡?</p><ul><li><a href="https://github.com/alibaba/kt-connect" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/kt-connect</a> é˜¿é‡Œå‡ºå“</li><li><a href="https://github.com/telepresenceio/telepresence" target="_blank" rel="noopener noreferrer">https://github.com/telepresenceio/telepresence</a> windows ç³»ç»Ÿä¸Šå®‰è£…å¤æ‚</li><li>åˆ©ç”¨ kubectl forwardåœ¨æœ¬åœ°å»ºç«‹ k8s ä¸­æœåŠ¡çš„ä»£ç†
<code>kubectl port-forward &lt;generated target pod name&gt; &lt;local port&gt;:&lt;target port&gt;</code> è¿™é‡Œ pod name åå­—ä¸å›ºå®š, æ›´å¥½çš„åŠæ³•æ˜¯æŒ‡å®š deployment
<code>kubectl port-forward deployment/&lt;your pod name&gt; &lt;local post&gt;:&lt;target port&gt;</code> æ›´å¥½
æˆ–è€… deployment æ›¿æ¢ä¸º rs/svc</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-deploying-springcloud">2. deploying springcloud<a href="#2-deploying-springcloud" class="hash-link" aria-label="2. deploying springcloudçš„ç›´æ¥é“¾æ¥" title="2. deploying springcloudçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p><a href="https://github.com/Fenderon/springcloud-kubernetes-example" target="_blank" rel="noopener noreferrer">https://github.com/Fenderon/springcloud-kubernetes-example</a></p><p><a href="http://www.enmalvi.com/2022/05/27/springcloud-spring-cloud-kubernetes/" target="_blank" rel="noopener noreferrer">http://www.enmalvi.com/2022/05/27/springcloud-spring-cloud-kubernetes/</a></p><p>SpringCloud é€šè¿‡ spring cloud kubernetes starter, å±è”½äº†spring cloud åŸæ¥ç»„ä»¶å’Œ k8s åŸç”Ÿèƒ½åŠ›çš„å·®å¼‚</p><blockquote><p>ä½¿ç”¨spring-cloud-kubernetesæ¡†æ¶ï¼Œè¯¥æ¡†æ¶å¯ä»¥è°ƒç”¨kubernetesçš„åŸç”Ÿèƒ½åŠ›æ¥ä¸ºç°æœ‰SpringCloudåº”ç”¨æä¾›æœåŠ¡</p></blockquote><p>æœåŠ¡å‘ç°. k8sçš„service</p><blockquote><p>é€šè¿‡Spring Cloud Kubernetes Discoveryè‡ªåŠ¨å°† HTTP è®¿é—®ä¸­çš„æœåŠ¡è½¬æ¢ä¸º full qualified domain name</p></blockquote><p>è´Ÿè½½å‡è¡¡. </p><blockquote><p>é‡‡ç”¨ Kubernetes Service æœ¬èº«çš„è´Ÿè½½å‡è¡¡èƒ½åŠ›å®ç°ï¼Œå¯ä»¥ä¸å†éœ€è¦ Ribbon è¿™æ ·çš„å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡äº†</p></blockquote><p>é…ç½®ä¸­å¿ƒ. k8s çš„ Secret &amp; ConfigMap</p><blockquote><p>é€šè¿‡ springcloud kubernetes config è‡ªåŠ¨å°† configMap å†…å®¹æ³¨å…¥åˆ° springboot é…ç½®æ–‡ä»¶ä¸­å¹¶å®ç°åŠ¨æ€æ›´æ–°</p><p>æœ€ä½³å®è·µ: Gitç»´æŠ¤é…ç½®çš„ç‰ˆæœ¬ï¼ŒCI/CDéƒ¨ç½²åˆ°Kubernetesé›†ç¾¤çš„ConfigMap/Secretã€‚</p></blockquote><p>ç½‘å…³: k8s æä¾› Ingress</p><blockquote><p>ç½‘å…³éƒ¨åˆ† springcloud kubernetes ä»ç„¶ä¿ç•™äº† Zuulï¼Œæœªé‡‡ç”¨ Ingress ä»£æ›¿ã€‚è¿™é‡Œæœ‰ä¸¤ç‚¹è€ƒè™‘ï¼Œä¸€æ˜¯ Ingress Controller ä¸ç®—æ˜¯ Kubernetes çš„è‡ªå¸¦ç»„ä»¶ï¼Œå®ƒå¯ä»¥æœ‰ä¸åŒçš„é€‰æ‹©ï¼ˆKONGã€Nginxã€Haproxyï¼Œç­‰ç­‰ï¼‰ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦ç‹¬ç«‹å®‰è£…</p></blockquote><p>ç†”æ–­ã€é™çº§ã€é™æµ</p><blockquote><p>Kubernetesæœ¬èº«æ²¡æœ‰ç†”æ–­å™¨ï¼Œå› æ­¤å¾®æœåŠ¡æ¡†æ¶ä¸­çš„ç†”æ–­ç»„ä»¶æ˜¯æœ‰å¿…è¦çš„ (Sentinel, Hystrix)</p><p>å°†åœ¨åŸºäº Istio çš„æœåŠ¡ç½‘æ ¼æ¶æ„ä¸­è§£å†³è¿™ä¸ªé—®é¢˜</p></blockquote><p>è®¤è¯æˆæƒ</p><blockquote><p>ä»ç„¶é‡‡ç”¨ Spring Security OAuth 2ï¼ŒKubernetes çš„ RBAC æˆæƒå¯ä»¥è§£å†³æœåŠ¡å±‚é¢çš„è®¿é—®æ§åˆ¶é—®é¢˜ï¼Œä½† Security æ˜¯è·¨è¶Šäº†ä¸šåŠ¡å’ŒæŠ€æœ¯çš„è¾¹ç•Œçš„ï¼Œè®¤è¯æˆæƒæ¨¡å—æœ¬èº«ä»æ‰¿æ‹…ç€å¯¹å‰ç«¯ç”¨æˆ·çš„è®¤è¯ã€æˆæƒèŒè´£ï¼Œè¿™éƒ¨åˆ†æ˜¯ä¸ä¸šåŠ¡ç›¸å…³çš„ã€‚</p></blockquote><p>å®¹å™¨ç¯å¢ƒæ„ŸçŸ¥. </p><blockquote><p>springcloud k8s å¼•å…¥äº† fabric8 çš„ kubernetes client</p></blockquote><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- æ•´åˆäº† k8s çš„åŠŸèƒ½, æä¾›æœåŠ¡å‘ç°, å¯ä»¥å»æ‰ eurake äº† --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">spring-cloud-starter-kubernetes</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- è´Ÿè½½å‡è¡¡ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- spring.cloud.loadbalancer.ribbon. enabled=false</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"> --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- æœ¬åœ°è°ƒç”¨kubernetesä¸­çš„æœåŠ¡, å°†spring.cloud.kubernetes.ribbon.modeä¿®æ”¹ä¸ºserviceï¼Œç„¶åå†å°†å¯¹åº”çš„æœåŠ¡å¼€æ”¾ä¸€ä¸ªç«¯å£å‡ºæ¥ï¼Œæ”¾ä¸€ä¸ªnodeportå‡ºæ¥å°±å¯ä»¥ç›´æ¥è°ƒç”¨äº†ã€‚ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- æœ¬åœ°é¡¹ç›®ä¸­è°ƒç”¨å¦ä¸€ä¸ªæœ¬åœ°æœåŠ¡æ˜¯ç”¨çš„@FeignClientæ³¨è§£æ¥å®ç°çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨@FeignClientæ³¨è§£ä¸­æ·»åŠ urlå‚æ•°æ¥å®ç°å¿½ç•¥nameçš„åŠŸèƒ½ä»è€Œå®ç°æœ¬åœ°è¯·æ±‚åˆ°æœ¬åœ° ,</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">å¦‚ @FeignClient(name = &quot;svcb-service&quot;,url = &quot;${local.feign.server.svcb-service.url:}&quot;,fallback = ServiceBClient.ServiceBClientFallback.class) , ç„¶åå°±å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½® local.feign.server.svcb-service.url ä¸ºç›®æ ‡ ip:port, å»ºè®®é…ç½®æˆç¯å¢ƒå˜é‡, ä¸è¦å†™æ­»</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">spring-cloud-starter-kubernetes-ribbon</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- é…ç½®ä¸­å¿ƒ, å¯ä»¥å»æ‰ config server äº† --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- ä½†æ˜¯ä¸å»ºè®®æ›¿æ¢é…ç½®ä¸­å¿ƒ, config server çš„å­˜åœ¨æ–¹ä¾¿é…ç½®æ–‡ä»¶çš„æº¯æº --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">spring-cloud-starter-kubernetes-config</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- è‡ªåŠ¨ç»´æŠ¤ k8s deployment, service èµ„æºå®šä¹‰æ–‡ä»¶, äº§ç‰©åœ¨ meta-inf/fabric8 ä¸‹ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- ä¹Ÿå¯ä»¥è‡ªå·±åœ¨ src/main/fabric8 ä¸‹é‡å†™deployment.yml, service.ymlå®šä¹‰æ–‡ä»¶ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">build</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">plugins</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">plugin</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">io.fabric8</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">fabric8-maven-plugin</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">version</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">${fabric8.maven.plugin.version}</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">version</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">executions</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">execution</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">id</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">fmp</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">id</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">goals</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">goal</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">resource</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">goal</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">goal</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">build</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">goal</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">goals</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">execution</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">executions</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">configuration</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                            </span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!--dockeréœ€è¦å¼€å¯è¿œç¨‹è®¿é—®--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">dockerHost</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">http://haiyang.dockerhost.com:2375</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">dockerHost</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">enricher</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">config</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">fmp-service</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">type</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">NodePort</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">type</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">fmp-service</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">config</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">enricher</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                            </span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!--registryåœ°å€,ç”¨äºæ¨é€é•œåƒ--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                            </span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!--                            &lt;registry&gt;ccr.ccs.tencentyun.com&lt;/registry&gt;--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                            </span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!--è®¤è¯é…ç½®,ç”¨äºç§æœ‰registryè®¤è¯,å¦‚æœå¿˜è®°äº†å¯ä»¥å»é˜¿é‡Œçš„registryæŸ¥çœ‹--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">authConfig</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">push</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">username</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">your usernmae</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">username</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">password</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">your password</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">password</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">push</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">authConfig</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">configuration</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">plugin</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">plugins</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">build</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- fabric8æ’ä»¶ç”Ÿæˆçš„deploymentè¿˜ä¼šè‡ªåŠ¨ç”ŸæˆreadinessProbeå’ŒlivenessProbeã€‚ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- éœ€è¦å¼•å…¥ actuator --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">groupId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">artifactId</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">dependency</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-configmap">using configMap<a href="#using-configmap" class="hash-link" aria-label="using configMapçš„ç›´æ¥é“¾æ¥" title="using configMapçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1 by d</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¿…é¡»å’Œ åº”ç”¨åç§°ä¸€æ ·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># è¿™é‡Œçš„å†…å®¹ä¼šè¢« client-service ä½œä¸ºé…ç½®æ–‡ä»¶, è¦†ç›–åº”ç”¨å†…çš„é…ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">application.properties</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">bean.message=Testing reload! Message from backend is</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> %s &lt;br/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> Services </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> %s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="éƒ¨ç½²åˆ°-k8s-åè¿˜æ˜¯æœ‰ç¼ºç‚¹">éƒ¨ç½²åˆ° k8s åè¿˜æ˜¯æœ‰ç¼ºç‚¹<a href="#éƒ¨ç½²åˆ°-k8s-åè¿˜æ˜¯æœ‰ç¼ºç‚¹" class="hash-link" aria-label="éƒ¨ç½²åˆ° k8s åè¿˜æ˜¯æœ‰ç¼ºç‚¹çš„ç›´æ¥é“¾æ¥" title="éƒ¨ç½²åˆ° k8s åè¿˜æ˜¯æœ‰ç¼ºç‚¹çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><blockquote><p>éšç€ Kubernetes é›†ç¾¤ä¸­çš„ Pod æ•°é‡è§„æ¨¡è¶Šæ¥è¶Šåºå¤§ï¼Œåˆ°ä¸€å®šç¨‹åº¦ä¹‹åï¼Œè¿ç»´çš„åŒå­¦æ— å¥ˆåœ°è¡¨ç¤ºå·²ç»ä¸å¯èƒ½å¤Ÿä¾é äººåŠ›æ¥è·Ÿè¿›å¾®æœåŠ¡ä¸­å‡ºç°çš„å„ç§é—®é¢˜äº†ï¼šä¸€ä¸ªè¯·æ±‚åœ¨å“ªä¸ªæœåŠ¡ä¸Šè°ƒç”¨å¤±è´¥å•¦ï¼Ÿæ˜¯ A æœ‰è°ƒç”¨ B å—ï¼Ÿè¿˜æ˜¯ C è°ƒç”¨ D æ—¶å‡ºé”™äº†ï¼Ÿä¸ºä»€ä¹ˆè¿™ä¸ªè¯·æ±‚ã€é¡µé¢å¿½ç„¶å¡ä½äº†ï¼Ÿæ€ä¹ˆè°ƒåº¦åˆ°è¿™ä¸ª Node ä¸Šçš„æœåŠ¡æ¯”å…¶ä»– Node æ…¢é‚£ä¹ˆå¤šï¼Ÿ</p></blockquote><p>k8s ä¸‹çš„ springcloud å¯é…ç½®, å¯è§‚æµ‹ç‰¹æ€§è¿˜æœ‰å¾…åŠ å¼º --&gt; istio</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-what-and-why">3. what and why<a href="#3-what-and-why" class="hash-link" aria-label="3. what and whyçš„ç›´æ¥é“¾æ¥" title="3. what and whyçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31-k8s-æ˜¯åšä»€ä¹ˆçš„">3.1. k8s æ˜¯åšä»€ä¹ˆçš„<a href="#31-k8s-æ˜¯åšä»€ä¹ˆçš„" class="hash-link" aria-label="3.1. k8s æ˜¯åšä»€ä¹ˆçš„çš„ç›´æ¥é“¾æ¥" title="3.1. k8s æ˜¯åšä»€ä¹ˆçš„çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æŠ½è±¡äº†æ•°æ®ä¸­å¿ƒçš„ç¡¬ä»¶åŸºç¡€è®¾æ–½ï¼Œå¯¹å¤–æš´éœ²ç»Ÿä¸€çš„æ¥å£ï¼Œå…·ä½“åŒ…æ‹¬</p><ul><li>è°ƒåº¦: k8s è‡ªåŠ¨å†³å®šç»„ä»¶éƒ¨ç½²åˆ°å…·ä½“çš„å“ªä¸€å° æœåŠ¡å™¨èŠ‚ç‚¹ã€‚</li><li>è‡ªåŠ¨ä¿®å¤: è‡ªåŠ¨æ£€æŸ¥èŠ‚ç‚¹çš„å¥åº·çŠ¶æ€, å§ç¨‹åºè¿ç§»åˆ°å¥åº·çš„èŠ‚ç‚¹ä¸Š</li><li>æ°´å¹³ä¼¸ç¼©: è‡ªåŠ¨æ£€æµ‹ä¸šåŠ¡çš„è´Ÿè½½æƒ…å†µ, å¦‚æœ CPU è´Ÿè½½å¤ªé«˜, æˆ–è€…ç›¸åº”æ—¶é—´å¤ªé•¿, ä¼šè‡ªåŠ¨è¿›è¡Œæ‰©å®¹</li></ul><p>åªéœ€è¦å‘Šè¯‰ k8s è¦åšä»€ä¹ˆ (æ¯”å¦‚ä¿æŒæŸä¸ª pod æœ‰ä¸‰ä¸ªå‰¯æœ¬), è€Œä¸å¿…å‘Šè¯‰å®ƒæ€ä¹ˆåš, å°±åƒ sql åªå‘Šè¯‰ æ•°æ®åº“è¦æŸ¥è¯¢é‚£äº›æ•°æ®, è€Œæ²¡æœ‰å‘Šè¯‰æ•°æ®åº“æ€ä¹ˆæŸ¥æ•°æ®</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32-ä¸ºä»€ä¹ˆä½¿ç”¨">3.2. ä¸ºä»€ä¹ˆä½¿ç”¨:<a href="#32-ä¸ºä»€ä¹ˆä½¿ç”¨" class="hash-link" aria-label="3.2. ä¸ºä»€ä¹ˆä½¿ç”¨:çš„ç›´æ¥é“¾æ¥" title="3.2. ä¸ºä»€ä¹ˆä½¿ç”¨:çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å½“ container å¤ªå¤š, éœ€è¦ç®¡ç†, å•æœºæƒ…å†µä¸‹, è¿˜èƒ½ä¾é  docker-compose è¿™äº›å·¥å…·, å½“æœ‰å¾ˆå¤šæœºå™¨æ—¶, å°±å¿…é¡»é€šè¿‡ k8s æ¥å°† å®¹å™¨åˆç†åœ°åˆ†é…åˆ°è¿™äº›æœºå™¨ä¸­å»</p><ul><li>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</li><li>è‡ªåŠ¨éƒ¨ç½² and å›æ»š</li><li>æ›¿æ¢å¤±è´¥å®¹å™¨ (è‡ªæˆ‘ä¿®å¤)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="33-compare-with-spring-cloud">3.3. compare with spring cloud<a href="#33-compare-with-spring-cloud" class="hash-link" aria-label="3.3. compare with spring cloudçš„ç›´æ¥é“¾æ¥" title="3.3. compare with spring cloudçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Spring Cloud é€šè¿‡æ•´åˆNeflixç›¸å…³å¼€æºç»„ä»¶å®ç°äº†ä¸€å¥—å®Œæ•´çš„å¾®æœåŠ¡æ–¹æ¡ˆï¼Œä½†æ˜¯å¿…é¡»å€ŸåŠ©äºK8Sè¿™æ ·çš„å®¹å™¨ç¼–æ’å·¥å…·æ‰èƒ½å®ç°ç†æƒ³çš„æ•ˆæœã€‚è€ŒK8Så´å¯ä»¥è‡ªæˆä½“ç³»æ„å»ºå¾®æœåŠ¡ç³»ç»Ÿ</p><ol><li><p>k8s å¯¹æ„å»ºçš„åº”ç”¨æ— ä¾µå…¥æ€§ï¼Œæœ‰æ›´ä½çš„æ”¹é€ æˆæœ¬ã€‚</p></li><li><p>å¯¹å¼€å‘è¯­è¨€æ— è¦æ±‚ï¼ŒGoã€nodeJSã€Javaã€PHPéƒ½æ˜¯å¯ä»¥çš„ã€‚</p></li><li><p>ç¨‹åºçš„ç‰ˆæœ¬ç®¡ç†æ›´åŠ çµæ´»ï¼Œä¸å—åˆ¶ä¸Spring Cloudçš„ç‰ˆæœ¬ã€‚</p></li><li><p>Spring Cloud ä½“ç³»çš„ç¨‹åºå¦‚æœéƒ¨ç½²åœ¨K8Sçš„ç¯å¢ƒï¼Œ å¾ˆå¤šå¾®æœåŠ¡ç‰¹æ€§éƒ½æ˜¯é‡å¤çš„</p></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-æ­å»ºç¯å¢ƒ">4. æ­å»ºç¯å¢ƒ<a href="#4-æ­å»ºç¯å¢ƒ" class="hash-link" aria-label="4. æ­å»ºç¯å¢ƒçš„ç›´æ¥é“¾æ¥" title="4. æ­å»ºç¯å¢ƒçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41-ç”Ÿäº§æœåŠ¡å™¨ä¸Šå®‰è£…">4.1. ç”Ÿäº§æœåŠ¡å™¨ä¸Šå®‰è£…<a href="#41-ç”Ÿäº§æœåŠ¡å™¨ä¸Šå®‰è£…" class="hash-link" aria-label="4.1. ç”Ÿäº§æœåŠ¡å™¨ä¸Šå®‰è£…çš„ç›´æ¥é“¾æ¥" title="4.1. ç”Ÿäº§æœåŠ¡å™¨ä¸Šå®‰è£…çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><a href="https://github.com/fanux/sealos" target="_blank" rel="noopener noreferrer">https://github.com/fanux/sealos</a> ä¸€é”®å®‰è£…</p><p><a href="https://github.com/guoliangdi/springcloudFeign" target="_blank" rel="noopener noreferrer">https://github.com/guoliangdi/springcloudFeign</a> centos ä¸Šå®‰è£… åŸºäº k8s çš„ devops</p><p><a href="https://github.com/lework/kainstall" target="_blank" rel="noopener noreferrer">https://github.com/lework/kainstall</a></p><p><a href="https://github.com/easzlab/kubeasz" target="_blank" rel="noopener noreferrer">https://github.com/easzlab/kubeasz</a> ä½¿ç”¨Ansibleè„šæœ¬å®‰è£…K8Sé›†ç¾¤</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42-vagrant-æ­å»º-k8s-ç¯å¢ƒ">4.2. vagrant æ­å»º k8s ç¯å¢ƒ<a href="#42-vagrant-æ­å»º-k8s-ç¯å¢ƒ" class="hash-link" aria-label="4.2. vagrant æ­å»º k8s ç¯å¢ƒçš„ç›´æ¥é“¾æ¥" title="4.2. vagrant æ­å»º k8s ç¯å¢ƒçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä¸€ä¸ª master node: docker, kubeadm, kubelet, kubectl ä¸¤ä¸ª worker node:</p><p>Vagrantfile:</p><div class="language-vagrantfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vagrantfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Vagrant.configure(&quot;2&quot;) do |config|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   (1..3).each do |i|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        config.vm.define &quot;k8s-node#{i}&quot; do |node|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            # è®¾ç½®è™šæ‹Ÿæœºçš„Box</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            node.vm.box = &quot;centos7&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            # è®¾ç½®è™šæ‹Ÿæœºçš„ä¸»æœºå</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            node.vm.hostname=&quot;k8s-node#{i}&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            # è®¾ç½®è™šæ‹Ÿæœºçš„IP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            # 192.168.56.xxx éœ€è¦åœ¨ virtualbox å…ˆåˆ›å»º host only network 192.168.56.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            node.vm.network &quot;private_network&quot;, ip: &quot;192.168.56.#{99+i}/24&quot;, netmask: &quot;255.255.255.0&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            # è®¾ç½®ä¸»æœºä¸è™šæ‹Ÿæœºçš„å…±äº«ç›®å½•</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            # node.vm.synced_folder &quot;~/Documents/vagrant/share&quot;, &quot;/home/vagrant/share&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            # VirtaulBoxç›¸å…³é…ç½®</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            node.vm.provider &quot;virtualbox&quot; do |v|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                # è®¾ç½®è™šæ‹Ÿæœºçš„åç§°</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                v.name = &quot;k8s-node#{i}&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                # è®¾ç½®è™šæ‹Ÿæœºçš„å†…å­˜å¤§å°</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                v.memory = 4096</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                # è®¾ç½®è™šæ‹Ÿæœºçš„CPUä¸ªæ•°</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                v.cpus = 4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è™šæ‹Ÿæœºå‡†å¤‡</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># ç™»å½• machine sshd, ä¿è¯å¯ä»¥é€šè¿‡è´¦å·å¯†ç ç™»å½• (é»˜è®¤ä»…ä»… ssh ç™»å½•)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è‹¥ä½¿ç”¨ tmux + ssh config åˆ™æ— éœ€æ— éœ€è¿™ä¸€æ­¥, ç›´æ¥é€šè¿‡ ssh ç™»å½•å³å¯</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant ssh k8s-node1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo su</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vi /etc/ssh/sshd_config # ä¿®æ”¹ ä¸º PasswordAuthentication yes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">service sshd restart</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è®¾ç½®é»˜è®¤ç½‘å¡</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># show default SoftEther</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># We can find that the default soft ether is eth0, the three machine have the same eth0 ip.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># This is because eth0 default to ç½‘ç»œåœ°å€è½¬å‘(nat) ç±»å‹. in order  to make the machines can</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># access to each other, etho should be type: Natnetwork</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ip route show</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ“ä½œ virtualbox å›¾å½¢ç•Œé¢, å…¨å±€æ–°å»º natnetwork ç½‘ç»œ. ä¸ºæ¯ä¸ª machine é»˜è®¤ç½‘å¡1 å³ eth0 æŒ‡å®š è¿™ä¸ªç±»å‹, åˆ·æ–°é«˜çº§è®¾ç½®</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># é‡Œçš„ ç½‘å¡mac åœ°å€</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ç„¶ååœ¨å„ä¸ª machine å†… äº’ç›¸ ping æ˜¯å¦é€š</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># close firewall</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl stop firewalld</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl disable firewalld</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># disable selinux (æ°¸ä¹…)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sed -i &#x27;s/enforcing/disabled/&#x27; /etc/selinux/config # æ›¿æ¢äº† enforcing ä¸º disable</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å½“å‰ä¼šè¯å…³é—­ selinux (ä¸´æ—¶)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">setenforce 0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å…³é—­ swap æ°¸ä¹…</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab # å…¶å®å°±æ˜¯æ³¨é‡Šæ‰ä¸€è¡Œ   #/swapfile none swap defaults 0 0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å…³é—­ swap (å†…å­˜äº¤æ¢) ä¸´æ—¶</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">swapoff -a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ·»åŠ  ä¸»æœºå and ip æ˜ å°„</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># hostname ä¼šæ˜¾ç¤º ä¸»æœºå k8s-node1/2/3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è‹¥ hostname æ˜¾ç¤ºä¸æ­£å¸¸å¯ä»¥ä¿®æ”¹: hostnamectl set-hostname &lt;new hostname&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vi /etc/hosts</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># eth0 ç½‘å¡å°±æ˜¯ é»˜è®¤ç½‘å¡, ç”¨æ¥machine äº’è”çš„</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &lt;node1 eth0 ip&gt; k8s-node1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &lt;node2 eth0 ip&gt; k8s-node2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &lt;node3 eth0 ip&gt; k8s-node3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">10.0.2.15 k8s-node1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">10.0.2.4 k8s-node2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">10.0.2.5 k8s-node3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å°†æ¡¥æ¥çš„ ipv4 çš„æµé‡ä¼ é€’åˆ° iptables çš„é“¾</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">net.bridge.bridge-nf-call-ip6tables = 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">net.bridge.bridge-nf-call-iptables = 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># éªŒè¯</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sysctl --system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åŒæ­¥ä¸‰å°æœºå™¨çš„æ—¶é—´</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">yum install ntpdate -y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ntpdate time.windows.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å°†åªè¯»æ–‡ä»¶ç³»ç»Ÿ æ”¹ä¸º è¯»å†™</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mount -o remount rw /</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å®‰è£… docker ç­‰</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># dockerå‚ç…§å®˜ç½‘å³å¯</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å®‰è£… k8s éœ€è¦ aliyun é•œåƒ æ¨è</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[kubernetes]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">name=Kubernetes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">enabled=1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gpgcheck=0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">repo_gpgcheck=0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ustc çš„é•œåƒ</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cat &lt;&lt;EOF &gt; /etc/apt/sources.list.d/kubernetes.list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># centos</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl enable kubelet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl start kubelet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; åœ¨ master node ä¸Š</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># éœ€è¦æ‹‰å» k8s ç›¸å…³çš„é•œåƒ, é»˜è®¤ä»“åº“ k8s.gcr.io èƒŒå¢™, è¿™é‡Œé‡æ–°æŒ‡å®š</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># service-cidr æ˜¯ service é—´é€šä¿¡çš„ç½‘æ®µ/å­ç½‘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># pod network-cidr æ˜¯ pod é—´é€šä¿¡ç½‘æ®µ/å­ç½‘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubeadm init --apiserver-advertise-address=&lt;master node eth0 ip&gt; \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--image-repository registry.cn-hangzhou.aliyuncs.com/google_containers \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--kubernetes-version v1.19.4 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--service-cidr=10.96.0.0/16 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--pod-network-cidr=10.244.0.0/16</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŒ‰ç…§ è¾“å‡ºæç¤º, å¦‚ä¸‹æ­¥éª¤éœ€è¦åš:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mkdir -p $HOME/.kube</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># master ç”Ÿæˆçš„ å‘½ä»¤, åœ¨ worker node æ‰§è¡Œå³å¯åŠ å…¥ cluster.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 2h å†…æœ‰æ•ˆ</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubeadm join 10.0.2.15:6443 --token 0tpws3.y1uhbzg0rgal4okz \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --discovery-token-ca-cert-hash sha256:0a25a082e0babbc18d1646ebfa9954d82838fa86ec66ee3d88c0d57fc9c0f35e</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è¿‡æœŸä¹‹å, å¦‚ä¸‹ç”Ÿæˆæ°¸ä¹…çš„ token</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubeadm token create --print-join-command</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubeadm token create --ttl 0 --print-join-command # å¤åˆ¶ç”Ÿæˆçš„ token åˆ°ä¸Šé¢å‘½ä»¤å³å¯</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ›å»ºç½‘ç»œ</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è¿™é‡Œé€‰å®š flannel æä¾›çš„ç½‘ç»œæ‰©å±•æ’ä»¶ (addons)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å…·ä½“æœ‰å“ªäº›å¯ç”¨çš„æ’ä»¶: https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">curl -L https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml -o flannel_network.yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ä¸Šä¼ åˆ° master node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">scp ~/flanel.yml root@xxx/root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å­èŠ‚ç‚¹åŠ å…¥åˆ° cluster å, master ä¼šåŒæ­¥ flanel ç›¸å…³çš„ pod åˆ° å­èŠ‚ç‚¹ä¸Š, å¯ä»¥ç›‘æ§, ç­‰å¾…ä¸€æ®µæ—¶é—´å†æŸ¥çœ‹ nodes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f flannel.yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŸ¥çœ‹ flanel ç›¸å…³ çš„ pods æ˜¯å¦å¯åŠ¨</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get po --all-namespaces</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å¦‚æœæ˜¯ å¤±è´¥çš„, é‚£ä¹ˆå°æ›¿æ¢ flanel.yml ä¸­ image ç›¸å…³åœ°å€, åˆ° docker hub ä¸Šæ‰¾, å¦‚ https://hub.docker.com/r/easzlab/flannel</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ é™¤ , é‡æ–°åˆ›å»º</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete -f flannel.yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ­¤æ—¶å¯ä»¥åœ¨å­èŠ‚ç‚¹ä¸Šæ‰§è¡Œæ·»åŠ  node å‘½ä»¤äº†   &gt;&gt;&gt; åœ¨ worker node ä¸Š</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ç›‘æ§ æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„ æŒ‡å®šns çš„ pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ç­‰å¾… æ‰€æœ‰èŠ‚ç‚¹ ä¸Š flanel ç›¸å…³çš„ pod éƒ½æ­£å¸¸å¯åŠ¨åå†åœ¨ master ä¸ŠæŸ¥çœ‹ nodes çŠ¶æ€, ä¿è¯æ‰€æœ‰ node çŠ¶æ€ä¸º ready åˆ™ cluster æ­å»ºæˆåŠŸ</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">watch kubectl get po -n kube-system -o wide</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å®‰è£… ingress controller,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æœ‰å¤šé‡å®ç°, é€‰æ‹©ä¸€ç§å³å¯ https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è¿™é‡Œé€‰æ‹© ingress-nginx https://kubernetes.io/docs/concepts/services-networking/ingress/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ref: https://www.cnblogs.com/minseo/p/12455320.html</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43-ä¼—å¤šçš„å‘è¡Œç‰ˆ">4.3. ä¼—å¤šçš„å‘è¡Œç‰ˆ<a href="#43-ä¼—å¤šçš„å‘è¡Œç‰ˆ" class="hash-link" aria-label="4.3. ä¼—å¤šçš„å‘è¡Œç‰ˆçš„ç›´æ¥é“¾æ¥" title="4.3. ä¼—å¤šçš„å‘è¡Œç‰ˆçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="431-k3s">4.3.1. k3s<a href="#431-k3s" class="hash-link" aria-label="4.3.1. k3sçš„ç›´æ¥é“¾æ¥" title="4.3.1. k3sçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p><a href="https://github.com/k3s-io/k3s" target="_blank" rel="noopener noreferrer">https://github.com/k3s-io/k3s</a>
<a href="https://rancher.com/docs/k3s/latest/en/" target="_blank" rel="noopener noreferrer">https://rancher.com/docs/k3s/latest/en/</a> å®˜ç½‘
<a href="https://www.rancher.cn/k3s/" target="_blank" rel="noopener noreferrer">https://www.rancher.cn/k3s/</a> ä¸­æ–‡å®˜ç½‘</p><p><a href="https://oldj.net/article/2022/04/17/install-k3s-and-rancher/" target="_blank" rel="noopener noreferrer">https://oldj.net/article/2022/04/17/install-k3s-and-rancher/</a></p><p>è½»é‡çº§çš„ k8s, å†…æ ¸æœºåˆ¶è¿˜æ˜¯å’Œ K8s ä¸€æ ·ï¼Œä½†æ˜¯å‰”é™¤äº†å¾ˆå¤šå¤–éƒ¨ä¾èµ–ä»¥åŠ K8s çš„ alphaã€beta ç‰¹æ€§</p><p>å°†å…¶åº”ç”¨äº IoT è®¾å¤‡ï¼ˆæ¯”å¦‚æ ‘è“æ´¾ï¼‰, CI, development æ˜¯éå¸¸å¥½çš„é€‰æ‹©</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4311-k3d">4.3.1.1. k3d<a href="#4311-k3d" class="hash-link" aria-label="4.3.1.1. k3dçš„ç›´æ¥é“¾æ¥" title="4.3.1.1. k3dçš„ç›´æ¥é“¾æ¥">â€‹</a></h5><p><a href="https://github.com/k3d-io/k3d" target="_blank" rel="noopener noreferrer">https://github.com/k3d-io/k3d</a> å°† k3s è·‘åœ¨ docker é‡Œ</p><p><a href="https://cloud.tencent.com/developer/article/1791688" target="_blank" rel="noopener noreferrer">https://cloud.tencent.com/developer/article/1791688</a> åŸç†æ•™ç¨‹</p><p>For macOs, we can just download the binary file from github release page or by using <code>brew install k3d</code></p><h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43111-ä½¿ç”¨-helmchart-controller">4.3.1.1.1. ä½¿ç”¨ helmChart controller<a href="#43111-ä½¿ç”¨-helmchart-controller" class="hash-link" aria-label="4.3.1.1.1. ä½¿ç”¨ helmChart controllerçš„ç›´æ¥é“¾æ¥" title="4.3.1.1.1. ä½¿ç”¨ helmChart controllerçš„ç›´æ¥é“¾æ¥">â€‹</a></h6><p>Helm Controller å®šä¹‰äº†ä¸€ä¸ªæ–°çš„HelmChartè‡ªå®šä¹‰èµ„æº, éƒ¨ç½²åˆ° kubernetes ä¸­, ç”¨äºç®¡ç† Helm å›¾è¡¨ã€‚</p><blockquote><p>ç”¨äºç®€åŒ– helm å‘½ä»¤è¡Œçš„ä½¿ç”¨, ç±»æ¯” docker å‘½ä»¤è¡Œä¹‹äº docker-compose</p><p>Helm Controllerå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªCRD Controllerï¼Œç®¡ç†çš„æ˜¯HelmChartç±»å‹çš„CRD API</p><p>Helmæ˜¯ Kubernetes çš„åŒ…ç®¡ç†å™¨, Helm ç”±å®¢æˆ·ç«¯ (helm) å’ŒæœåŠ¡å™¨ç«¯ç»„ä»¶Tillerç»„æˆ,ç”¨äºç®¡ç† Helm å›¾è¡¨çš„éƒ¨ç½²å’Œç”Ÿå‘½å‘¨æœŸã€‚åœ¨ k3s ä¸­,Tiller è¢«æ›¿æ¢ä¸ºHelm Controller; </p><p>Helm v3 ä¸­ï¼ŒTiller è¢«ç§»é™¤äº†, æ–°çš„ Helm å®¢æˆ·ç«¯ä¼šåƒ kubectl å‘½ä»¤ä¸€æ ·ï¼Œè¯»å–æœ¬åœ°çš„ kubeconfig æ–‡ä»¶ï¼Œä½¿ç”¨æˆ‘ä»¬åœ¨ kubeconfig ä¸­é¢„å…ˆå®šä¹‰å¥½çš„SAæƒé™æ¥è¿›è¡Œä¸€ç³»åˆ—æ“ä½œã€‚è¿™æ ·åšæ³•å³ç®€å•ï¼Œåˆå®‰å…¨ã€‚</p></blockquote><p>HelmChartéƒ¨ç½²åº”ç”¨ï¼Œæœ‰ä»¥ä¸‹å¥½å¤„:</p><p>1ã€HelmChartæŠŠHelmçš„æ“ä½œå˜æˆå¯¹CRD APIçš„ç®¡ç†ï¼Œå½“éœ€è¦å¯¹åº”ç”¨è¿›è¡Œä¿®æ”¹æ—¶ï¼Œåªéœ€ä¿®æ”¹HelmChartç›¸å…³å±æ€§å³å¯ï¼ŒHelm-controllerä¼šä¸»åŠ¨ç›‘å¬APIå¯¹è±¡æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼›</p><p>2ã€çœå»åœ¨å®¿ä¸»æœºä¸Šå®‰è£…helmçš„æ­¥éª¤ï¼›</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> helm.cattle.io/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> HelmChart</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># Kubernetes object metadata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># Chart name (required)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¯¹äº k3s,è¿™å¿…é¡»æ˜¯kube-system,å› ä¸º Helm Controller ä»…é…ç½®ä¸ºç›‘è§†æ­¤å‘½åç©ºé—´ä»¥è·å–æ–°çš„ HelmChart èµ„æºã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">system </span><span class="token comment" style="color:rgb(0, 128, 0)"># Namespace Helm Controller is monitoring to deploy charts (required)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># resource specification</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">chart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">helmchart  </span><span class="token comment" style="color:rgb(0, 128, 0)"># char name / url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">targetNamespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">namespace </span><span class="token comment" style="color:rgb(0, 128, 0)"># which ns will be used to install the chart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 0.0.1        </span><span class="token comment" style="color:rgb(0, 128, 0)"># chart version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">repo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">//example.com/helm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">charts   </span><span class="token comment" style="color:rgb(0, 128, 0)"># chart repo url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># è¦æä¾›ç»™ Helm çš„é…ç½®å€¼çš„å­—å…¸/æ˜ å°„ã€‚é”®åº”æŒ‡å®šä¸ºå­—ç¬¦ä¸²ã€‚å€¼å¯ä»¥æ˜¯æ•´æ•°æˆ–å­—ç¬¦ä¸²ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¦‚æœéœ€è¦æ›´å¤æ‚çš„å€¼,è¯·ä½¿ç”¨valuesContent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">key1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;value1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">key2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;value2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">valuesContent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">application</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">admin_username</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> admin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">admin_password</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> insecure_password</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">tls_enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç›¸åº”çš„å‘½ä»¤è¡Œ:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ helm install test-helmchart --namespace test-namespace \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                              --version 0.0.1 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                              --repo https://example.com/helm-charts \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                              --set-string key1=value1 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                              --set-string key2=value2 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                              #  values.yaml åŒ…å«valuesContentå­—æ®µä¸‹çš„å†…å®¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                              --values values.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å®‰è£…: <code>k3s kubectl apply --filename node-red-helmchart.yaml</code>, æˆ–è€…å°†èµ„æºå®šä¹‰å¤åˆ¶åˆ°æœåŠ¡å™¨çš„manifestç›®å½• <code>/var/lib/rancher/k3s/server/manifests/</code> (Helm Controller ä¸æ–­ç›‘è§†æ­¤ç›®å½•ä¸­çš„æ–° CRDã€‚å½“å®ƒæ£€æµ‹åˆ°æ·»åŠ äº†æ–°èµ„æºæ—¶,å®ƒå°†è‡ªåŠ¨éƒ¨ç½²å›¾è¡¨)</p><p>æ›´æ–°: ä¿®æ”¹ yml æ–‡ä»¶å, å†æ¬¡æ‰§è¡Œ <code>kubectl apply --filename node-red-helmchart.yaml</code></p><p>åˆ é™¤: <code>kubectl --namespace kube-system delete helmchart &lt;char name, eg. node-red&gt;</code></p><h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43112-æ“ä½œ-kubeconfig">4.3.1.1.2. æ“ä½œ kubeconfig<a href="#43112-æ“ä½œ-kubeconfig" class="hash-link" aria-label="4.3.1.1.2. æ“ä½œ kubeconfigçš„ç›´æ¥é“¾æ¥" title="4.3.1.1.2. æ“ä½œ kubeconfigçš„ç›´æ¥é“¾æ¥">â€‹</a></h6><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># è·å– kubeconfig æ–‡ä»¶ (æœ€æ–°ç‰ˆk3d ä¼šè‡ªåŠ¨æ›´æ–° ~/.kube/config, æˆ‘ä»¬æ— éœ€æ‰‹åŠ¨ä¿®æ”¹ kubectl å³å¯æ“ä½œk3d åˆ›å»ºçš„é›†ç¾¤)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3d kubeconfig get --all</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43113-æ”¯æŒçš„å‘½ä»¤">4.3.1.1.3. æ”¯æŒçš„å‘½ä»¤<a href="#43113-æ”¯æŒçš„å‘½ä»¤" class="hash-link" aria-label="4.3.1.1.3. æ”¯æŒçš„å‘½ä»¤çš„ç›´æ¥é“¾æ¥" title="4.3.1.1.3. æ”¯æŒçš„å‘½ä»¤çš„ç›´æ¥é“¾æ¥">â€‹</a></h6><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">k3d version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># é»˜è®¤å€¼åˆ›å»ºä¸€ä¸ªå•èŠ‚ç‚¹é›†ç¾¤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3d cluster create [--servers 2 ...]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># delete the default cluster or the specified cluster</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3d cluster delete [mycluster]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl cluster-info # æ£€æŸ¥æ˜¯å¦å¯åŠ¨å®Œæˆ</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get all --all-namespaces [--output wide] #  æ£€æŸ¥å†…éƒ¨ç»“æ„, å‘ç° K3sè¿˜éƒ¨ç½²äº†DNSã€metricså’Œingressï¼ˆtraefikï¼‰æœåŠ¡</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get nodes --output wide # ä»…çœ‹åˆ°äº†ä¸€ä¸ªèŠ‚ç‚¹, k3d node list å‘ç°æœ‰ä¸¤ä¸ªèŠ‚ç‚¹, æœ‰å¦ä¸€ä¸ªâ€œèŠ‚ç‚¹â€ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å¯ä»¥çœ‹åˆ°å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨è§çš„ç»„ä»¶</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># local-path-provisioner: è¿™ä¸ªæä¾›æœ¬åœ°å­˜å‚¨pvåŠ¨æ€åˆ›å»º</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># metrics-server: ç”¨äºpod metricsçš„æ”¶é›†</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># traefik: è¿™ä¸ªç”¨äºè¯·æ±‚è½¬å‘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># coredns: é›†ç¾¤åŸŸåè§£æ</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># (å…¶å®ƒçš„å¦‚Kube-proxy, kube-scheduleræ˜¯æ²¡æœ‰ï¼Œè¿™ä¸ªå¯ä»¥ç†è§£ï¼Œç”¨k3dåˆ›å»ºå‡ºæ¥çš„é›†ç¾¤ä¸ç®¡å¤šå°‘ä¸ªagentï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€å°å®ä½“æœº)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pod --all-namespaces</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># éƒ½é»˜è®¤åˆ›å»ºäº†ä¸€ä¸ª 1ä¸ªè´Ÿè½½å‡è¡¡å™¨å®¹å™¨</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3d cluster create two-node-cluster --agents 2 [-image rancher/k3s:v1.19.3-k3s2]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3d cluster create three-node-cluster --server 3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># é€šè¿‡--api-port 127.0.0.1:6445ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨k3då°†Kubernetes APIç«¯å£ï¼ˆ6443å†…éƒ¨ï¼‰æ˜ å°„åˆ°127.0.0.1 / localhostçš„ç«¯å£6445</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># --volume /home/me/mycode:/code@agent[*]ç»‘å®šå°†ä½ çš„æœ¬åœ°ç›®å½•/home/me/mycodeæŒ‚è½½åˆ°æ‰€æœ‰ï¼ˆ[*] agent èŠ‚ç‚¹ï¼‰å†…éƒ¨çš„è·¯å¾„/codeã€‚ä½¿ç”¨ç´¢å¼•ï¼ˆ0æˆ–1ï¼‰æ›¿æ¢*ï¼Œä»¥ä¾¿åªæŠŠå®ƒæŒ‚è½½åˆ°å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3d cluster create mycluster --api-port 127.0.0.1:6445 --servers 3 --agents 2 --volume &#x27;/home/me/mycode:/code@agent[*/0/1/2/3....]&#x27; --port &#x27;8080:80@loadbalancer&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3d cluster create mycluster \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--api-port 127.0.0.1:6443 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-p 80:80@loadbalancer \   # åœ¨å®¿ä¸»æœºçš„ 80, 443 ç«¯å£è®¿é—® ingress èµ„æºã€‚</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-p 443:443@loadbalancer \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-i rancher/k3s:v1.18.6-k3s1 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--volume &quot;${HOME}/registries.yaml:/etc/rancher/k3s/registries.yaml&quot; \  # é…ç½®å›½å†…é•œåƒåŠ é€Ÿ</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--k3s-server-arg &quot;--no-deploy=traefik&quot; # ç¦ç”¨é»˜è®¤çš„ Traefik</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># registries.yaml å†…å®¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mirrors:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &quot;docker.io&quot;:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    endpoint:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      - &quot;https://fogjl973.mirror.aliyuncs.com&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      - &quot;https://docker.mirrors.ustc.edu.cn&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      - &quot;https://registry-1.docker.io&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ‡æ¢é›†ç¾¤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl config use-context k3d-two-node-cluster</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># crate node and insert into current cluster</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3d node create &lt;prefix name&gt; --role server [--image ...]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3d node list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3d registry list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43114-å›½å†…é•œåƒ">4.3.1.1.4. å›½å†…é•œåƒ<a href="#43114-å›½å†…é•œåƒ" class="hash-link" aria-label="4.3.1.1.4. å›½å†…é•œåƒçš„ç›´æ¥é“¾æ¥" title="4.3.1.1.4. å›½å†…é•œåƒçš„ç›´æ¥é“¾æ¥">â€‹</a></h6><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3d cluster create mycluster \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--api-port 127.0.0.1:6443 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-p 80:80@loadbalancer \   # åœ¨å®¿ä¸»æœºçš„ 80, 443 ç«¯å£è®¿é—® ingress èµ„æºã€‚</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-p 443:443@loadbalancer \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-i rancher/k3s:v1.18.6-k3s1 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--volume &quot;${HOME}/registries.yaml:/etc/rancher/k3s/registries.yaml&quot; \  # é…ç½®å›½å†…é•œåƒåŠ é€Ÿ</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--k3s-server-arg &quot;--no-deploy=traefik&quot; # ç¦ç”¨é»˜è®¤çš„ Traefik</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># registries.yaml å†…å®¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mirrors:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &quot;docker.io&quot;:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    endpoint:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      - &quot;https://fogjl973.mirror.aliyuncs.com&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      - &quot;https://docker.mirrors.ustc.edu.cn&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      - &quot;https://registry-1.docker.io&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43115-å¯¼å…¥é•œåƒ">4.3.1.1.5. å¯¼å…¥é•œåƒ<a href="#43115-å¯¼å…¥é•œåƒ" class="hash-link" aria-label="4.3.1.1.5. å¯¼å…¥é•œåƒçš„ç›´æ¥é“¾æ¥" title="4.3.1.1.5. å¯¼å…¥é•œåƒçš„ç›´æ¥é“¾æ¥">â€‹</a></h6><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># k3d ä¸­çš„é•œåƒå’Œ docker ä¸é€š, éœ€è¦æ‰‹åŠ¨å¯¼å…¥</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ç¼–å†™ deployment æ—¶æ³¨æ˜ imagePullPolicy: Never ä»ä¸æ‹‰å–, ä»…ä»…ä½¿ç”¨k3d å†…éƒ¨é•œåƒ</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3d image import &lt;customized image name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ–è€…è‡ªå·±æ­å»º image registry</p><h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43116-k3s-åŒ…æ‹¬ä»¥ä¸‹ä¸€äº›ç»„ä»¶">4.3.1.1.6. k3s åŒ…æ‹¬ä»¥ä¸‹ä¸€äº›ç»„ä»¶<a href="#43116-k3s-åŒ…æ‹¬ä»¥ä¸‹ä¸€äº›ç»„ä»¶" class="hash-link" aria-label="4.3.1.1.6. k3s åŒ…æ‹¬ä»¥ä¸‹ä¸€äº›ç»„ä»¶çš„ç›´æ¥é“¾æ¥" title="4.3.1.1.6. k3s åŒ…æ‹¬ä»¥ä¸‹ä¸€äº›ç»„ä»¶çš„ç›´æ¥é“¾æ¥">â€‹</a></h6><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token maybe-class-name">Containerdï¼šä¸€ä¸ªç±»ä¼¼</span><span class="token plain"> </span><span class="token maybe-class-name">Docker</span><span class="token plain"> çš„è¿è¡Œæ—¶å®¹å™¨ï¼Œä½†æ˜¯å®ƒä¸æ”¯æŒæ„å»ºé•œåƒï¼›</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token maybe-class-name">Flannelï¼šåŸºäº</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">CNI</span><span class="token plain"> å®ç°çš„ç½‘ç»œæ¨¡å‹ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ </span><span class="token maybe-class-name">Flannelï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨</span><span class="token plain"> </span><span class="token maybe-class-name">Calico</span><span class="token plain"> ç­‰å…¶ä»–å®ç°æ›¿æ¢ï¼›</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token maybe-class-name">CoreDNSï¼šé›†ç¾¤å†…éƒ¨</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">DNS</span><span class="token plain"> ç»„ä»¶ï¼›</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token maybe-class-name">SQLite3ï¼šé»˜è®¤ä½¿ç”¨</span><span class="token plain"> </span><span class="token maybe-class-name">SQLite3</span><span class="token plain"> è¿›è¡Œå­˜å‚¨ï¼ŒåŒæ ·ä¹Ÿæ”¯æŒ etcd3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token maybe-class-name">MySQL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token maybe-class-name">Postgresï¼›</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token maybe-class-name">Traefikï¼šé»˜è®¤å®‰è£…</span><span class="token plain"> </span><span class="token maybe-class-name">Ingress</span><span class="token plain"> controller æ˜¯ traefik </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">x</span><span class="token plain"> çš„ç‰ˆæœ¬ï¼›</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token maybe-class-name">Embedded</span><span class="token plain"> service loadbalancerï¼šå†…åµŒçš„ä¸€ä¸ªæœåŠ¡è´Ÿè½½å‡è¡¡ç»„ä»¶ã€‚</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43117-å®Œæ•´çš„-k3d-yml-é…ç½®æ–‡ä»¶">4.3.1.1.7. å®Œæ•´çš„ k3d yml é…ç½®æ–‡ä»¶<a href="#43117-å®Œæ•´çš„-k3d-yml-é…ç½®æ–‡ä»¶" class="hash-link" aria-label="4.3.1.1.7. å®Œæ•´çš„ k3d yml é…ç½®æ–‡ä»¶çš„ç›´æ¥é“¾æ¥" title="4.3.1.1.7. å®Œæ•´çš„ k3d yml é…ç½®æ–‡ä»¶çš„ç›´æ¥é“¾æ¥">â€‹</a></h6><p>or taking a yaml file to create cluster:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> k3d.io/v1alpha2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Simple</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> mycluster</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">servers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">agents</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kubeAPI</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¯é€šè¿‡ localhost:6443 è®¿é—® æ§åˆ¶å¹³é¢çš„ api</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">hostPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;6443&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># same as `--api-port &#x27;6443&#x27;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># å‘ä¸»æœºæš´éœ²çš„ç«¯å£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># å°†æœ¬åœ°ä¸»æœºçš„ç«¯å£8080æ˜ å°„åˆ°è´Ÿè½½å‡è¡¡å™¨ï¼ˆserverlbï¼‰ä¸Šçš„ç«¯å£80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># å³: å¯é€šè¿‡ 8080 è®¿é—®é›†ç¾¤å†…éƒ¨ 80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 8080</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># same as `--port &#x27;8080:80@loadbalancer&#x27;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># æŒ‡å®šåº”ç”¨çš„å“ªäº›èŠ‚ç‚¹, loadbalancer æ˜¯èŠ‚ç‚¹è§’è‰²åç§°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¦‚æœå†…éƒ¨Service æ˜¯ NodePort ç±»å‹ (é€šè¿‡èŠ‚ç‚¹æš´éœ²å‡ºå»), é‚£è¿™é‡Œçš„ç«¯å£æ˜ å°„åº”è¯¥é™åˆ¶åªä½œç”¨äº loadbalancer èŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#  å¦‚æœå†…éƒ¨Service é€šè¿‡ ingress æš´éœ², é‚£è¿™é‡Œæ— éœ€æŒ‡å®š nodeFilter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">nodeFilters</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> loadbalancer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 8443</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># same as `--port &#x27;8443:443@loadbalancer&#x27;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">nodeFilters</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> loadbalancer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">=================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> k3d.io/v1alpha4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Simple</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> k3s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">default</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">servers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># same as `--servers 1`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">agents</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># same as `--agents 2`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker.io/rancher/k3s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v1.25.6</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k3s1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kubeAPI</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># same as `--api-port myhost.my.domain:6445` (where the name would resolve to 127.0.0.1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;127.0.0.1&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># important for the `server` setting in the kubeconfig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># hostIP: &quot;192.168.1.200&quot; # where the Kubernetes API will be listening on</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">hostPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;6445&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># where the Kubernetes API listening port will be mapped to on your host system</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token datetime number" style="color:rgb(9, 134, 88)">80:80</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># same as `--port &#x27;8080:80@loadbalancer&#x27;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">nodeFilters</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> loadbalancer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">k3d</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># k3d runtime settings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">wait</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># wait for cluster to be usable before returining; same as `--wait` (default: true)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;60s&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># wait timeout before aborting; same as `--timeout 60s`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">disableLoadbalancer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># same as `--no-lb`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">disableImageVolume</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># same as `--no-image-volume`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">disableRollback</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># same as `--no-Rollback`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">loadbalancer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">configOverrides</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> settings.workerConnections=2048</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">k3s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># options passed on to K3s itself</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">extraArgs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># additional arguments passed to the `k3s server|agent` command; same as `--k3s-arg`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">arg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;--tls-san=127.0.0.1 --tls-san=ks.newbe.io&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">nodeFilters</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">kubeconfig</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">updateDefaultKubeconfig</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># add new cluster to your default Kubeconfig; same as `--kubeconfig-update-default` (default: true)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">switchCurrentContext</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># also set current-context to the new cluster&#x27;s context; same as `--kubeconfig-switch-context` (default: true)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">registries</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># define how registries should be created or used</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># define contents of the `registries.yaml` file (or reference a file); same as `--registry-config /path/to/config.yaml`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">&quot;docker.io&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">endpoint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://mirror.ccs.tencentyun.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>k3d cluster create --config /path/to/mycluster.yaml</code></p><h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43118-éƒ¨ç½²ä¸€ä¸ª-nginx">4.3.1.1.8. éƒ¨ç½²ä¸€ä¸ª NGINX<a href="#43118-éƒ¨ç½²ä¸€ä¸ª-nginx" class="hash-link" aria-label="4.3.1.1.8. éƒ¨ç½²ä¸€ä¸ª NGINXçš„ç›´æ¥é“¾æ¥" title="4.3.1.1.8. éƒ¨ç½²ä¸€ä¸ª NGINXçš„ç›´æ¥é“¾æ¥">â€‹</a></h6><p><a href="https://blog.bwcxtech.com/posts/ea0ef82f/" target="_blank" rel="noopener noreferrer">https://blog.bwcxtech.com/posts/ea0ef82f/</a> ä½¿ç”¨ Traefik2 ä»£æ›¿ 1</p><p>now write a k3d-cluster.yml</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> k3d.io/v1alpha4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Simple</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cluster</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">servers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">agents</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kubeAPI</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">hostPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;6443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 8087</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">30080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">nodeFilters</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> loadbalancer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 8443</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">nodeFilters</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> loadbalancer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>k3d cluster create --config /path/to/cluster.yml</code></p><p>now let&#x27;s create the simplest nginx deployment and service:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;128Mi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;500m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> NodePort</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>check the following picture to get a further understanding</p><p><img loading="lazy" src="/assets/images/k3d-e9c6aa818d0953eb83dc50aa15ba84f7.png" width="2450" height="1680" class="img_ev3q"></p><p><code>kc get pods,services -o wide</code> to check if the resources ready, and we can check <code>http://localhost:8087/</code> for the nginx welcome page</p><p>now try to bring in the Ingress resource: <code>k3d cluster delete cluster-3</code>, and update the service section in the yml:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Service type is set up to clusterIP (default)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># we can expose this service by using ingress</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ingress:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> networking.k8s.io/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># å³ä½¿ç”¨å“ªä¸€ä¸ªåŸŸåæ¥è®¿é—®service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">pathType</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Prefix</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">number</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>the cluster yml file also need some updates:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> k3d.io/v1alpha4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Simple</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cluster</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">servers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">agents</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kubeAPI</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">hostPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;6443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">#  ingressé»˜è®¤ç«¯å£æ˜¯80, å°†å…¶æ˜ å°„åˆ°å®¿ä¸»æœºçš„ 9001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># ä¸è¦æ·»åŠ  nodeFilters:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">#           - loadbalancer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 9001</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>http://localhost:9001/</code> To check the nginx welcome page</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="432-k0s">4.3.2. k0s<a href="#432-k0s" class="hash-link" aria-label="4.3.2. k0sçš„ç›´æ¥é“¾æ¥" title="4.3.2. k0sçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p><a href="https://github.com/k0sproject/k0s" target="_blank" rel="noopener noreferrer">https://github.com/k0sproject/k0s</a> ä½“ç§¯ä¸‹, æ›´ç²¾ç®€çš„ k8s</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="433-microk8s">4.3.3. microk8s<a href="#433-microk8s" class="hash-link" aria-label="4.3.3. microk8sçš„ç›´æ¥é“¾æ¥" title="4.3.3. microk8sçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p><a href="https://github.com/canonical/microk8s" target="_blank" rel="noopener noreferrer">https://github.com/canonical/microk8s</a></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="434-docker-desktop-æ¨èä½¿ç”¨-rancher-desktop-æ›¿ä»£">4.3.4. docker desktop (æ¨èä½¿ç”¨ rancher desktop æ›¿ä»£)<a href="#434-docker-desktop-æ¨èä½¿ç”¨-rancher-desktop-æ›¿ä»£" class="hash-link" aria-label="4.3.4. docker desktop (æ¨èä½¿ç”¨ rancher desktop æ›¿ä»£)çš„ç›´æ¥é“¾æ¥" title="4.3.4. docker desktop (æ¨èä½¿ç”¨ rancher desktop æ›¿ä»£)çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>it&#x27;s the easiest way to install k8s locally I think.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="435-kind-æ¨èä½¿ç”¨-k3d-ä»£æ›¿">4.3.5. kind (æ¨èä½¿ç”¨ k3d ä»£æ›¿)<a href="#435-kind-æ¨èä½¿ç”¨-k3d-ä»£æ›¿" class="hash-link" aria-label="4.3.5. kind (æ¨èä½¿ç”¨ k3d ä»£æ›¿)çš„ç›´æ¥é“¾æ¥" title="4.3.5. kind (æ¨èä½¿ç”¨ k3d ä»£æ›¿)çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p><a href="https://guoxudong.io/post/k3d-vs-kind/" target="_blank" rel="noopener noreferrer">https://guoxudong.io/post/k3d-vs-kind/</a> å¯¹æ¯”</p><p><a href="https://github.com/kubernetes-sigs/kind/" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes-sigs/kind/</a></p><p>åœ¨ docker ä¸­è¿è¡Œ k8s, æ›´å¿«æ›´æ–¹ä¾¿</p><p><a href="https://www.cnblogs.com/laochiji/p/13813743.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/laochiji/p/13813743.html</a> å¤šèŠ‚ç‚¹</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># install</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># install golang &amp;&amp; install docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker pull kindest/node:v1.19.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># --name: specify a name for the cluster. default name : kind</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#  --wait 30s: wait until the cluster reaches a ready status</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># --wait 5m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># --kubeconfig: specify cluster config file; default location : ${HOME}/.kube/config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kind create cluster [--name kind] [--wait]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ„å»ºé•œåƒ</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker build -t my-custom-image:unique-tag ./my-image-dir</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åŠ è½½åˆ° kind</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kind load docker-image my-custom-image:unique-tag</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f my-manifest-using-my-image:unique-tag</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># context name è§„åˆ™: &lt;kind&gt;-&lt;cluster_name&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ä»…ä»…ä¸€ä¸ª cluster æ—¶, å¯çœç•¥ context</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl cluster-info [--context kind-kind]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># é»˜è®¤åˆ é™¤ kind åå­—çš„ cluster</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kind delete cluster [--name kind]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åŠ è½½ images åˆ° cluster</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># é»˜è®¤ å°† é•œåƒåŠ è½½åˆ° kind åå­—çš„ cluster</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kind load docker-image &lt;img_name&gt; [--name cluster_name]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è¿›å…¥ kind å¯åŠ¨çš„ docker å†…éƒ¨, æ‰§è¡Œ crictl images, å¯ä»¥çœ‹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ°ç”¨æ¥æ¨¡æ‹Ÿ k8s çš„ä¸€ç³»åˆ—é•œåƒ</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker exec -it kind-control-plane crictl images</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="436-minikube">4.3.6. minikube<a href="#436-minikube" class="hash-link" aria-label="4.3.6. minikubeçš„ç›´æ¥é“¾æ¥" title="4.3.6. minikubeçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>create single node k8s cluster for dev, åŸç†æ˜¯ åˆ›å»ºè™šæ‹Ÿæœº,</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">minikube version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">minikube start</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">minikube dashboard</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å¯ç”¨çš„æ‰©å±•/æ’ä»¶</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">minikube addons list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å¼€å¯æ’ä»¶</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">minikube addons enable metrics-server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å…³é—­æ’ä»¶</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">minikube addons disable metrics-server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">minikube stop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">minikube delete</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å½“å‰ node ip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">minikube ip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-quickstart">5. Quickstart<a href="#5-quickstart" class="hash-link" aria-label="5. Quickstartçš„ç›´æ¥é“¾æ¥" title="5. Quickstartçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51-ä»¥java-ä¸ºä¾‹">5.1. ä»¥Java ä¸ºä¾‹<a href="#51-ä»¥java-ä¸ºä¾‹" class="hash-link" aria-label="5.1. ä»¥Java ä¸ºä¾‹çš„ç›´æ¥é“¾æ¥" title="5.1. ä»¥Java ä¸ºä¾‹çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><a href="https://mritd.com/2022/11/08/java-containerization-guide/" target="_blank" rel="noopener noreferrer">https://mritd.com/2022/11/08/java-containerization-guide/</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52-ä»¥-go-ä¸ºä¾‹">5.2. ä»¥ go ä¸ºä¾‹<a href="#52-ä»¥-go-ä¸ºä¾‹" class="hash-link" aria-label="5.2. ä»¥ go ä¸ºä¾‹çš„ç›´æ¥é“¾æ¥" title="5.2. ä»¥ go ä¸ºä¾‹çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="521-using-pod-directly">5.2.1. using pod directly<a href="#521-using-pod-directly" class="hash-link" aria-label="5.2.1. using pod directlyçš„ç›´æ¥é“¾æ¥" title="5.2.1. using pod directlyçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>here is a piece of code in go:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;io&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;net/http&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// Register a router</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">HandleFunc</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">w http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ResponseWriter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> r </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        io</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">w</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;[v1] Hello, k8s!&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// Start the server and listening on port 80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">ListenAndServe</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;:80&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>now we write a dockerfile for this go app</p><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">FROM golang:1.20 AS builder</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># create /src, then jump into it</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR /src</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># pre-copy/cache go.mod for pre-downloading dependencies and only redownloading them in subsequent builds if they change</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># COPY go.mod go.sum ./</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># RUN go mod download &amp;&amp; go mod verify</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># copy all host files to /src</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY . ./</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># required, if missing then go.mod is needed</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN go env -w GO111MODULE=auto</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN CGO_ENABLED=0 go build -a -sw -ldflags &#x27;-extldflags &quot;-static&quot;&#x27; -v -o main .</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM scratch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WORKDIR /</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY --from=builder /src/main .</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EXPOSE 80</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENTRYPOINT [&quot;/main&quot;]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>so now we can build our image and push it to docker hub:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">go build . -t xiaoyureed/hellok8s:v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker images | grep xiaoyureed</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># login docker hub</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker login</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker push</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>then write the pod resource yml:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xiaoyureed/hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;128Mi&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;500m&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>apply the yml to create pod</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f xxx.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Wait for about 30s,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># so that the resources can be created</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check pod list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pods</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check pod info</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kc describe pod &lt;pod id&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># post forwarding (Temporary use only, just for debugging)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl port-forward hello-k8s-pod 4000:80</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># enter the container in the pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl exec -it hello-k8s-pod -- /bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># echo &quot;hello kubernetes by nginx!&quot; &gt; /usr/share/nginx/html/index.html</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># visit localhost:4000</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl logs --follow hello-k8s-pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># exec cmd &quot;ls&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl exec hello-k8s-pod -- ls</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># delete resources</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete pod hello-k8s-pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete -f xxx.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="522-using-deployment">5.2.2. using deployment<a href="#522-using-deployment" class="hash-link" aria-label="5.2.2. using deploymentçš„ç›´æ¥é“¾æ¥" title="5.2.2. using deploymentçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Let&#x27;s write a yml file to define a deployment to manage the pods</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xiaoyureed/hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;128Mi&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;500m&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>then apply and check the results:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># create</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kc apply -f k8s_resources/deployment.yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check deployment info</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kc get deployments</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check pods info</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Note: the pods name is generated by deployment and it&#x27;s unique</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kc get pods</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Try to delete a pod, and then you will find that the pod number recovers after a moment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kc delete pod hello-k8s-deployment-6bb465758-5d8lk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6-é›†ç¾¤ç»“æ„-underlying-infrastructure-åŸºç¡€è®¾æ–½">6. é›†ç¾¤ç»“æ„ underlying infrastructure åŸºç¡€è®¾æ–½<a href="#6-é›†ç¾¤ç»“æ„-underlying-infrastructure-åŸºç¡€è®¾æ–½" class="hash-link" aria-label="6. é›†ç¾¤ç»“æ„ underlying infrastructure åŸºç¡€è®¾æ–½çš„ç›´æ¥é“¾æ¥" title="6. é›†ç¾¤ç»“æ„ underlying infrastructure åŸºç¡€è®¾æ–½çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p><img loading="lazy" alt="k8s design" src="/assets/images/k8s_design-3303f985c7890750df7bd0ada74e7b20.png" width="1542" height="930" class="img_ev3q"></p><p><img loading="lazy" alt="k8s design1" src="/assets/images/k8s_design1-ee6f461a1bfc8942e993842de39ed7a6.png" width="2260" height="1686" class="img_ev3q"></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">æ§åˆ¶å¹³é¢</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">control plane</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Also</span><span class="token plain"> known </span><span class="token keyword module" style="color:rgb(0, 0, 255)">as</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;master&quot;</span><span class="token plain"> node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> designed to manage the hole cluster to make it work properly</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token literal-property property">é…ç½®å­˜å‚¨ä¸­å¿ƒ</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token maybe-class-name">ETCd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    distributed data storage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> used to store the cluster status</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  api server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token maybe-class-name">Provide</span><span class="token plain"> the api </span><span class="token keyword" style="color:rgb(0, 0, 255)">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">to</span><span class="token plain"> interactive </span><span class="token keyword" style="color:rgb(0, 0, 255)">with</span><span class="token plain"> the developer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property-access">scheduler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    è°ƒåº¦ï¼Œ å†³å®šå“ªä¸ª pod éƒ¨ç½²åˆ°å“ªä¸ªèŠ‚ç‚¹</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  control manager</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">æ•´ä¸ªé›†ç¾¤çš„ç®¡å®¶ï¼Œç”¨æ¥ç®¡ç†èµ„æºå¯¹è±¡</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> å¦‚ å¤åˆ¶èŠ‚ç‚¹ï¼Œ æŒç»­è·Ÿè¸ªå·¥ä½œèŠ‚ç‚¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> node controller åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº”</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token maybe-class-name">Replication</span><span class="token plain"> </span><span class="token maybe-class-name">Controller</span><span class="token plain"> ç»´æŠ¤æ­£ç¡®æ•°é‡çš„ </span><span class="token maybe-class-name">Pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token maybe-class-name">Endpoints</span><span class="token plain"> </span><span class="token maybe-class-name">Controller</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">å¡«å……ç«¯ç‚¹</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">Endpoints</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token function" style="color:rgb(0, 0, 255)">å¯¹è±¡</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">å³åŠ å…¥ </span><span class="token maybe-class-name">Service</span><span class="token plain"> ä¸ </span><span class="token maybe-class-name">Pod</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">computer </span><span class="token function" style="color:rgb(0, 0, 255)">machines</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">è®¡ç®—èŠ‚ç‚¹ </span><span class="token maybe-class-name">Node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Also</span><span class="token plain"> known </span><span class="token keyword module" style="color:rgb(0, 0, 255)">as</span><span class="token plain"> </span><span class="token maybe-class-name">Node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> designed to run the real application</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> æ˜¯æ‰€æœ‰ </span><span class="token maybe-class-name">Pod</span><span class="token plain"> è¿è¡Œæ‰€åœ¨çš„å·¥ä½œä¸»æœºï¼Œå¯ä»¥æ˜¯ç‰©ç†æœºä¹Ÿå¯ä»¥æ˜¯è™šæ‹Ÿæœº</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token literal-property property">kubelet</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> ç›¸å½“äºèŠ‚ç‚¹çš„ä»£ç†</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> å’Œ master èŠ‚ç‚¹äº¤äº’</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    å’Œ master èŠ‚ç‚¹çš„ api server é€šä¿¡</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> ä»¥ç®¡ç†æ‰€åœ¨çš„ èŠ‚ç‚¹</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">æœºå™¨ä¸Šçš„ </span><span class="token function" style="color:rgb(0, 0, 255)">pod</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">åˆ›å»ºã€ä¿®æ”¹ã€ç›‘æ§ã€åˆ é™¤</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">proxy</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> è´Ÿè´£ä¸€ç»„ pods çš„è´Ÿè½½å‡è¡¡</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    æ˜¯ </span><span class="token maybe-class-name">K8s</span><span class="token plain"> é›†ç¾¤å†…éƒ¨çš„è´Ÿè½½å‡è¡¡å™¨ã€‚å®ƒæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ä»£ç†æœåŠ¡å™¨</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> åœ¨ </span><span class="token maybe-class-name">K8s</span><span class="token plain"> çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰ä¸€ä¸ªï¼›è¿™ä¸€è®¾è®¡ä½“ç°äº†å®ƒçš„ä¼¸ç¼©æ€§ä¼˜åŠ¿ï¼Œéœ€è¦è®¿é—®æœåŠ¡çš„èŠ‚ç‚¹è¶Šå¤šï¼Œæä¾›è´Ÿè½½å‡è¡¡èƒ½åŠ›çš„ </span><span class="token maybe-class-name">Kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">proxy å°±è¶Šå¤šï¼Œé«˜å¯ç”¨èŠ‚ç‚¹ä¹Ÿéšä¹‹å¢å¤šã€‚ä¸ä¹‹ç›¸æ¯”ï¼Œæˆ‘ä»¬å¹³æ—¶åœ¨æœåŠ¡å™¨ç«¯åšä¸ªåå‘ä»£ç†åšè´Ÿè½½å‡è¡¡ï¼Œè¿˜è¦è¿›ä¸€æ­¥è§£å†³åå‘ä»£ç†çš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨é—®é¢˜ã€‚</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token maybe-class-name">Fluentdï¼Œä¸»è¦è´Ÿè´£æ—¥å¿—æ”¶é›†ã€å­˜å‚¨ä¸æŸ¥è¯¢</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  container runtime </span><span class="token function" style="color:rgb(0, 0, 255)">engine</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">éœ€è¦ç¬¦åˆ oci æ ‡å‡†çš„è¿è¡Œæ—¶</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> å¦‚ docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> containerd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> rkt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">CRI</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token constant" style="color:rgb(129, 31, 63)">O</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> è´Ÿè´£åˆ›å»ºå®¹å™¨</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token literal-property property">æ ¸å¿ƒé™„ä»¶</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  cni ç½‘ç»œæ’ä»¶</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> flannel</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">calico</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token literal-property property">æœåŠ¡å‘ç°æ’ä»¶</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> coredns</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token literal-property property">æœåŠ¡æš´éœ²æ’ä»¶</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">traefik</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  gui ç®¡ç†æ’ä»¶</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> dashboard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7-api-ç®¡ç†çš„å„ç§èµ„æº">7. api ç®¡ç†çš„å„ç§èµ„æº<a href="#7-api-ç®¡ç†çš„å„ç§èµ„æº" class="hash-link" aria-label="7. api ç®¡ç†çš„å„ç§èµ„æºçš„ç›´æ¥é“¾æ¥" title="7. api ç®¡ç†çš„å„ç§èµ„æºçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>å³å„ç§ api object,</p><p>åƒ pod, rc, rs, deployment éƒ½å±äº api object</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="71-å„ç§èµ„æºçš„å…³ç³»">7.1. å„ç§èµ„æºçš„å…³ç³»<a href="#71-å„ç§èµ„æºçš„å…³ç³»" class="hash-link" aria-label="7.1. å„ç§èµ„æºçš„å…³ç³»çš„ç›´æ¥é“¾æ¥" title="7.1. å„ç§èµ„æºçš„å…³ç³»çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨ K8S ä¸­ï¼Œåº”ç”¨ä¼šè¢«å°è£…åœ¨ Container ä¸­æš´éœ²å‡ºæ¥ä¸€ä¸ª Port. ä¸€ä¸ªå’Œå¤šä¸ª Container ç»„æˆäº†ä¸€ä¸ª Podã€‚ Pod æ˜¯ K8S çš„åŸºæœ¬æ‰§è¡Œå•å…ƒã€‚Pod ä¼šè¢«åˆ†é…åˆ° Node ä¸Šè¿è¡Œã€‚è€Œå¤šä¸ª Node ç»„æˆäº†ä¸€ä¸ª K8S Cluster.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="72-3-common-properties">7.2. 3 common properties<a href="#72-3-common-properties" class="hash-link" aria-label="7.2. 3 common propertiesçš„ç›´æ¥é“¾æ¥" title="7.2. 3 common propertiesçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="721-metadata">7.2.1. metadata<a href="#721-metadata" class="hash-link" aria-label="7.2.1. metadataçš„ç›´æ¥é“¾æ¥" title="7.2.1. metadataçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>metadata (contains 3 factors at least):</p><ul><li><p>namespace å‘½åç©ºé—´ä¸º Kubernetes é›†ç¾¤æä¾›è™šæ‹Ÿçš„éš”ç¦»ä½œç”¨</p><p>Kubernetes é›†ç¾¤åˆå§‹æœ‰ä¸¤ä¸ªå‘½åç©ºé—´ï¼Œåˆ†åˆ«æ˜¯é»˜è®¤å‘½åç©ºé—´ default å’Œç³»ç»Ÿå‘½åç©ºé—´ kube-system</p></li><li><p>name</p></li><li><p>uid</p></li></ul><p>used to identify api obj</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="722-spec">7.2.2. spec<a href="#722-spec" class="hash-link" aria-label="7.2.2. specçš„ç›´æ¥é“¾æ¥" title="7.2.2. specçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>used to declare the configuration that we want</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="723-status">7.2.3. status<a href="#723-status" class="hash-link" aria-label="7.2.3. statusçš„ç›´æ¥é“¾æ¥" title="7.2.3. statusçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="73-node">7.3. node<a href="#73-node" class="hash-link" aria-label="7.3. nodeçš„ç›´æ¥é“¾æ¥" title="7.3. nodeçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æ˜¯ K8S çš„é›†ç¾¤å·¥ä½œèŠ‚ç‚¹ï¼Œå¯ä»¥æ˜¯ç‰©ç†æœºä¹Ÿå¯ä»¥æ˜¯è™šæ‹Ÿæœºï¼›</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># check node info</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl describe node &lt;NODENAME&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ç¦æ­¢Podè°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¸Š</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl corndon NODENAME</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># é©±é€è¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ Pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl drain NODENAME</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="74-pod">7.4. pod<a href="#74-pod" class="hash-link" aria-label="7.4. podçš„ç›´æ¥é“¾æ¥" title="7.4. podçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ç”± ä¸€ä¸ªæˆ–å¤šä¸ªç›¸äº’å…³è”çš„ container ç»„æˆ, è¿™äº› container å…±äº«ç½‘ç»œåœ°å€å’Œæ–‡ä»¶ç³»ç»Ÿ, æ˜¯ k8s ç®¡ç†çš„åŸºæœ¬å•ä½, ä»£è¡¨ç€é›†ç¾¤ä¸­çš„ä¸€ä¸ªè™šæ‹Ÿä¸»æœº</p><blockquote><p>ä¸€ä¸ª pod åªå¯èƒ½å­˜åœ¨äºä¸€ä¸ª worker node ä¸Š, ä¸å¯è·¨èŠ‚ç‚¹, ä¸€ç»„ pod å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒ node ä¸Š</p><p>ä¸€ä¸ª pod å†…çš„æ‰€æœ‰å®¹å™¨å…±äº«ç›¸åŒçš„ Linux network å‘½åç©ºé—´. è¿™æ ·æ¯ä¸ª pod å°±åƒä¸€å°ç‹¬ç«‹çš„ ä¸»æœº, æœ‰è‡ªå·±çš„ ip (é›†ç¾¤å†…éƒ¨åœ°å€), ä¸»æœºå, ç«¯å£ (pod ä¸­çš„ containers å…±äº« è¯¥ ip ä»¥åŠ ç«¯å£ç©ºé—´, å…·æœ‰ç›¸åŒçš„ loopback ç½‘ç»œæ¥å£,å¯ä½¿ç”¨ localhost ç›¸äº’é€šä¿¡).</p><p>(å¯ä»¥å’Œ docker-compose å¯åŠ¨çš„å¤šä¸ª container ç±»æ¯”)</p><p>container (å®¹å™¨) çš„æœ¬è´¨æ˜¯è¿›ç¨‹ï¼Œè€Œ pod æ˜¯ç®¡ç†è¿™ä¸€ç»„è¿›ç¨‹çš„èµ„æº</p></blockquote><p>Here is the yml spec file for pod:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xiaoyureed/hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># IfNotPresent ä»…æœ¬åœ°æ²¡æœ‰é•œåƒæ—¶æ‰è¿œç¨‹æ‹‰ï¼ŒAlways æ°¸è¿œéƒ½æ˜¯ä»è¿œç¨‹æ‹‰ï¼ŒNever æ°¸è¿œåªç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™æŠ¥é”™</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">imagePullPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> IfNotPresent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;128Mi&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;500m&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>use these commands to check the pods info</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># check list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kc get pod[s]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check list, including more info</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pods -o wide</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># enter a specific pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl exec -it &lt;pod name&gt; /bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="75-label">7.5. label<a href="#75-label" class="hash-link" aria-label="7.5. labelçš„ç›´æ¥é“¾æ¥" title="7.5. labelçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>label æ˜¯èµ„æºä¸Šçš„æ ‡è¯†ï¼Œç”¨æ¥å¯¹å®ƒä»¬è¿›è¡ŒåŒºåˆ†å’Œé€‰æ‹©,</p><p>é€šå¸¸åœ¨èµ„æºå¯¹è±¡ç¡®å®šæ—¶å®šä¹‰ï¼Œä¹Ÿå¯ä»¥åœ¨èµ„æºåˆ›å»ºååŠ¨æ€æ·»åŠ æˆ–åˆ é™¤ï¼›</p><p>ä¸€ä¸ª label ä¼šä»¥ kv å½¢å¼é™„åŠ åˆ°å„ç§å¯¹è±¡ä¸Š(node, pod, service ...)</p><p>å¸¸ç”¨ label:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token literal-property property">ç‰ˆæœ¬æ ‡ç­¾ï¼šâ€œversionâ€</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain">â€œreleaseâ€</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ç¯å¢ƒæ ‡ç­¾ï¼š</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;environment&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;dev&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string-property property">&quot;environment&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;qa&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string-property property">&quot;environment&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;production&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">æ¶æ„æ ‡ç­¾ï¼š</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;tier&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;frontend&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string-property property">&quot;tier&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;backend&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string-property property">&quot;tier&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;cache&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="751-label-selector-ä½¿ç”¨">7.5.1. Label selector ä½¿ç”¨<a href="#751-label-selector-ä½¿ç”¨" class="hash-link" aria-label="7.5.1. Label selector ä½¿ç”¨çš„ç›´æ¥é“¾æ¥" title="7.5.1. Label selector ä½¿ç”¨çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><ul><li>åŒ…å«/ä¸åŒ…å« ç‰¹å®š key çš„ èµ„æº</li><li>åŒ…å«ç‰¹å®š keyï¼Œ value çš„ èµ„æº</li><li>åŒ…å« ç‰¹å®š keyï¼Œ ä¸” value å’ŒæŒ‡å®šçš„ä¸åŒçš„èµ„æº</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="76-taintæ±¡ç‚¹å’Œ-tolerationå®¹å¿">7.6. Taintï¼ˆæ±¡ç‚¹ï¼‰å’Œ Tolerationï¼ˆå®¹å¿ï¼‰<a href="#76-taintæ±¡ç‚¹å’Œ-tolerationå®¹å¿" class="hash-link" aria-label="7.6. Taintï¼ˆæ±¡ç‚¹ï¼‰å’Œ Tolerationï¼ˆå®¹å¿ï¼‰çš„ç›´æ¥é“¾æ¥" title="7.6. Taintï¼ˆæ±¡ç‚¹ï¼‰å’Œ Tolerationï¼ˆå®¹å¿ï¼‰çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å¯ä»¥ä½œç”¨äº node å’Œ pod ä¸Š, ç”¨äºæ§åˆ¶å’Œä¼˜åŒ– pod åœ¨ node ä¸Šçš„è°ƒåº¦</p><p>å…·æœ‰ taint çš„ node å’Œ pod æ˜¯äº’æ–¥å…³ç³»ï¼Œè€Œå…·æœ‰èŠ‚ç‚¹äº²å’Œæ€§ (toleration) å…³ç³»çš„ node å’Œ pod æ˜¯ç›¸å¸çš„</p><blockquote><p>Taint å’Œ toleration ç›¸äº’é…åˆï¼Œå¯ä»¥ç”¨æ¥é¿å… pod è¢«åˆ†é…åˆ°ä¸åˆé€‚çš„èŠ‚ç‚¹ä¸Šã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½å¯ä»¥åº”ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª taint ï¼Œè¿™è¡¨ç¤ºå¯¹äºé‚£äº›ä¸èƒ½å®¹å¿è¿™äº› taint çš„ podï¼Œæ˜¯ä¸ä¼šè¢«è¯¥èŠ‚ç‚¹æ¥å—çš„ã€‚å¦‚æœå°† toleration åº”ç”¨äº pod ä¸Šï¼Œåˆ™è¡¨ç¤ºè¿™äº› pod å¯ä»¥ï¼ˆä½†ä¸è¦æ±‚ï¼‰è¢«è°ƒåº¦åˆ°å…·æœ‰ç›¸åº” taint çš„èŠ‚ç‚¹ä¸Šã€‚</p><p>å¦å¤–è¿˜æœ‰å¯ä»¥ç»™ node è®¾ç½® labelï¼Œé€šè¿‡ç»™ pod è®¾ç½® nodeSelector å°† pod è°ƒåº¦åˆ°å…·æœ‰åŒ¹é…æ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šã€‚</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="761-taint">7.6.1. taint<a href="#761-taint" class="hash-link" aria-label="7.6.1. taintçš„ç›´æ¥é“¾æ¥" title="7.6.1. taintçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ä½œç”¨åœ¨ node ä¸Š.</p><p>Node è¢«è®¾ç½®ä¸Šæ±¡ç‚¹ä¹‹åï¼Œå°±å’Œ Pod ä¹‹é—´å­˜åœ¨äº†ä¸€ç§ç›¸æ–¥çš„å…³ç³»ï¼Œè¿›è€Œæ‹’ç» Pod è°ƒåº¦è¿‡æ¥ï¼Œç”šè‡³å¯ä»¥å°†å·²å­˜åœ¨çš„ Pod é©±é€å‡ºå»ï¼›</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">æ±¡ç‚¹æ ¼å¼ï¼škey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">value</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain">effectï¼Œkeyå’Œvalueæ˜¯æ±¡ç‚¹çš„æ ‡ç­¾ï¼Œeffectæè¿°æ±¡ç‚¹çš„ä½œç”¨ï¼Œæ”¯æŒå¦‚ä¸‹ä¸‰ä¸ªé€‰é¡¹ï¼š</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token maybe-class-name">PreferNoSchedule</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> k8så°½é‡ä¸æŠŠpodè°ƒåº¦åˆ°è¯¥æ±¡ç‚¹Nodeä¸Šï¼Œé™¤éæ²¡æœ‰å…¶ä»–èŠ‚ç‚¹å¯è°ƒåº¦ï¼›</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token maybe-class-name">NoSchedule</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> k8så°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°è¯¥æ±¡ç‚¹Nodeä¸Šï¼Œå·²å­˜åœ¨çš„Podå°†ç»§ç»­è¿è¡Œï¼›</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token maybe-class-name">NoExecuteï¼šk8så°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼ŒåŒæ—¶ä¹Ÿä¼šå°†Nodeä¸Šå·²å­˜åœ¨çš„Podé©±é€ï¼›</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä½¿ç”¨è¯­æ³•:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># è®¾ç½®æ±¡ç‚¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl taint nodes &lt;node name&gt; &lt;key&gt;=&lt;value&gt;:&lt;effect&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å»é™¤æ±¡ç‚¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl taint nodes node1 &lt;key&gt;:&lt;effect&gt;-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å»é™¤æ‰€æœ‰æ±¡ç‚¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl taint nodes node1 &lt;key&gt;-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ä¾‹å¦‚ï¼š</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ä¸ºnode1è®¾ç½®æ±¡ç‚¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl taint nodes node1 tag=test:PreferNoSchedule</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ä¸ºnode1å–æ¶ˆæ±¡ç‚¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl taint nodes node1 tag:PreferNoSchedule-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ä¸ºnode1åˆ é™¤å»é™¤æ±¡ç‚¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl taint nodes node1 tag-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŸ¥çœ‹node1 æ±¡ç‚¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl describe node node1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="762-toleration">7.6.2. toleration<a href="#762-toleration" class="hash-link" aria-label="7.6.2. tolerationçš„ç›´æ¥é“¾æ¥" title="7.6.2. tolerationçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ä½œç”¨åœ¨ pod ä¸Š</p><p>è‹¥å°† pod è°ƒåº¦åˆ°ä¸€ä¸ªæœ‰æ±¡ç‚¹çš„ node ä¸Šå»ï¼Œéœ€è¦ç”¨åˆ°å®¹å¿; Node é€šè¿‡æ±¡ç‚¹æ‹’ç» pod è°ƒåº¦ä¸Šå»ï¼Œpod é€šè¿‡å®¹å¿å¿½ç•¥æ‹’ç»ï¼›</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="77-controllerså„ç§æ§åˆ¶å™¨">7.7. controllers(å„ç§æ§åˆ¶å™¨)<a href="#77-controllerså„ç§æ§åˆ¶å™¨" class="hash-link" aria-label="7.7. controllers(å„ç§æ§åˆ¶å™¨)çš„ç›´æ¥é“¾æ¥" title="7.7. controllers(å„ç§æ§åˆ¶å™¨)çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>pod æ§åˆ¶å™¨, éƒ¨ç½²/ç®¡ç† pods</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="771-rc-replica-controller-å‰¯æœ¬æ§åˆ¶å™¨">7.7.1. <del>RC (replica controller å‰¯æœ¬æ§åˆ¶å™¨)</del><a href="#771-rc-replica-controller-å‰¯æœ¬æ§åˆ¶å™¨" class="hash-link" aria-label="771-rc-replica-controller-å‰¯æœ¬æ§åˆ¶å™¨çš„ç›´æ¥é“¾æ¥" title="771-rc-replica-controller-å‰¯æœ¬æ§åˆ¶å™¨çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p><strong>outdated</strong></p><p>ä¿è¯ Pod é«˜å¯ç”¨çš„ API å¯¹è±¡ï¼› åˆ›å»º/å¤åˆ¶ pod å®ä¾‹, ç¡®ä¿ pod å‰¯æœ¬æ•°é‡ (it kill the pod or start pod to ensure that the pod number consit with the configuration)</p><p>Best practice: remember that always start pod by using RC</p><p><code>kubectl run ...</code> ä¼šåˆ›å»ºä¸€ä¸ª rcï¼Œ ç„¶å rc åˆ›å»º pod ï¼ˆæ‰€ä»¥åˆ é™¤è¿™æ ·çš„ podï¼Œ éœ€è¦å…ˆåˆ é™¤ rcï¼‰</p><p>å·¥ä½œæµç¨‹ï¼šå¯»æ‰¾ ç¬¦åˆ label selector çš„ podï¼Œ æ¯”è¾ƒæ‰¾åˆ°çš„ pod å’ŒæœŸæœ›æ•°é‡ï¼Œ å°‘äº†å°±ä»å½“å‰æ¨¡æ¿åˆ›å»ºæ–°çš„ pod å‰¯æœ¬ ï¼Œ å¤šäº†ï¼Œ å°±åˆ é™¤å¤šçš„ pod</p><p>ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p>label selectorï¼š ç”¨äºç¡®å®š ReplicationController ä½œç”¨åŸŸä¸­æœ‰å“ªäº› pod</p></li><li><p>replica count (å‰¯æœ¬ä¸ªæ•°ï¼‰ï¼Œ æŒ‡å®šåº”è¿è¡Œçš„ pod æ•°é‡</p></li><li><p>pod template (pod æ¨¡æ¿ï¼‰ï¼Œ ç”¨äºåˆ›å»ºæ–°çš„ pod å‰¯æœ¬</p></li></ul><p>åœ¨æ–°ç‰ˆçš„ K8s ä¸­ï¼Œå»ºè®®ä½¿ç”¨ ReplicaSet ä½œä¸ºå‰¯æœ¬æ§åˆ¶å™¨ï¼ŒReplicationController ä¸å†ä½¿ç”¨äº†</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="772-rs-replica-set-ä»£æ›¿-rc">7.7.2. RS (replica set, ä»£æ›¿ RC)<a href="#772-rs-replica-set-ä»£æ›¿-rc" class="hash-link" aria-label="7.7.2. RS (replica set, ä»£æ›¿ RC)çš„ç›´æ¥é“¾æ¥" title="7.7.2. RS (replica set, ä»£æ›¿ RC)çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>å‰¯æœ¬é›†</p><p>å‰¯æœ¬é›†å¯¹è±¡ä¸€èˆ¬ä¸å•ç‹¬ä½¿ç”¨ï¼Œè€Œæ˜¯ç”¨ Deployment æ¥ç®¡ç†ã€‚</p><blockquote><p>RC å’Œ RS ä¸»è¦æ˜¯æ§åˆ¶æä¾›æ— çŠ¶æ€æœåŠ¡çš„ï¼Œå…¶æ‰€æ§åˆ¶çš„ Pod çš„åå­—æ˜¯éšæœºè®¾ç½®çš„ï¼Œä¸€ä¸ª Pod å‡ºæ•…éšœäº†å°±è¢«ä¸¢å¼ƒæ‰ï¼Œåœ¨å¦ä¸€ä¸ªåœ°æ–¹é‡å¯ä¸€ä¸ªæ–°çš„ Podï¼Œåå­—å˜äº†ã€‚åå­—å’Œå¯åŠ¨åœ¨å“ªå„¿éƒ½ä¸é‡è¦ï¼Œé‡è¦çš„åªæ˜¯ Pod æ€»æ•°ï¼›</p><p>å¯¹äº RC å’Œ RS ä¸­çš„ Podï¼Œä¸€èˆ¬ä¸æŒ‚è½½å­˜å‚¨æˆ–è€…æŒ‚è½½å…±äº«å­˜å‚¨ï¼Œä¿å­˜çš„æ˜¯æ‰€æœ‰ Pod å…±äº«çš„çŠ¶æ€</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="773-deployment-ç®¡ç†-rs">7.7.3. Deployment (ç®¡ç† RS)<a href="#773-deployment-ç®¡ç†-rs" class="hash-link" aria-label="7.7.3. Deployment (ç®¡ç† RS)çš„ç›´æ¥é“¾æ¥" title="7.7.3. Deployment (ç®¡ç† RS)çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>è¡¨ç¤ºç”¨æˆ·å¯¹ Kubernetes é›†ç¾¤çš„ä¸€æ¬¡æ›´æ–°æ“ä½œã€‚å¯ä»¥æ˜¯åˆ›å»º/æ›´æ–°ä¸€ä¸ªæ–°çš„æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯æ»šåŠ¨å‡çº§ä¸€ä¸ªæœåŠ¡</p><blockquote><p>æ»šåŠ¨å‡çº§ä¸€ä¸ªæœåŠ¡ï¼Œå®é™…æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ RSï¼Œç„¶åé€æ¸å°†æ–° RS ä¸­å‰¯æœ¬æ•°å¢åŠ åˆ°ç†æƒ³çŠ¶æ€ï¼Œå°†æ—§ RS ä¸­çš„å‰¯æœ¬æ•°å‡å°åˆ° 0 çš„å¤åˆæ“ä½œ</p></blockquote><p>æ¯” replica set ä½¿ç”¨èŒƒå›´æ›´å¹¿, ä¸€èˆ¬ä½¿ç”¨ deployment æ¥ç®¡ç† replica set</p><p>Here is the yml spec file:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Control the scale up/back through this filed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># required, used to select pods which can be managed by this deployment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># Note: no need to specify &quot;name&quot; in metadata since the deployment will create the unique pod name automatically</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># required, used to be selected by deployment&#x27;s selector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># required, the final container name contains this field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xiaoyureed/hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token comment" style="color:rgb(0, 128, 0)"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;128Mi&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;500m&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token comment" style="color:rgb(0, 128, 0)"># ç¯å¢ƒå˜é‡ å¯ä»¥åœ¨ springbootåº”ç”¨ä¸­é€šè¿‡ ${xxx} ä½¿ç”¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> yyy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token comment" style="color:rgb(0, 128, 0)"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># æŒ‡å®š container ä¸­åº”ç”¨æš´éœ²çš„ç«¯å£, åº”è¯¥ä¿æŒå’Œ dockerfile ä¸­çš„ expose ä¸€æ ·</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7731-scale-upback-æ‰©å®¹ç¼©å®¹">7.7.3.1. scale up/back (æ‰©å®¹ç¼©å®¹)<a href="#7731-scale-upback-æ‰©å®¹ç¼©å®¹" class="hash-link" aria-label="7.7.3.1. scale up/back (æ‰©å®¹ç¼©å®¹)çš„ç›´æ¥é“¾æ¥" title="7.7.3.1. scale up/back (æ‰©å®¹ç¼©å®¹)çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><p>With regards to Scale up/back, we just need update the &quot;spec.replicas&quot; field, then rerun <code>kubectl apply -f xxx.yml</code></p><blockquote><p>We can use <code>kc get pods --watch</code> to monitor the pod list</p></blockquote><p>or we can use this cmd <code>kubectl scale deployment test-k8s --replicas=5</code></p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7732-version-upgrade-ç‰ˆæœ¬å‡çº§">7.7.3.2. version upgrade (ç‰ˆæœ¬å‡çº§)<a href="#7732-version-upgrade-ç‰ˆæœ¬å‡çº§" class="hash-link" aria-label="7.7.3.2. version upgrade (ç‰ˆæœ¬å‡çº§)çš„ç›´æ¥é“¾æ¥" title="7.7.3.2. version upgrade (ç‰ˆæœ¬å‡çº§)çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><p>When talking about the app Version Upgrade, after make the code change, just need rebuild the image (note version number should change from v1 to v2) and push to docker hub, then update the yml <code>image</code> field, finally exec <code>kc apply ...</code></p><blockquote><p>Use <code>kubectl describe pod xxx</code> to check the pod details info, so that you can see the version info</p></blockquote><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7733-rolling-update-æ»šåŠ¨å‡çº§">7.7.3.3. rolling update (æ»šåŠ¨å‡çº§)<a href="#7733-rolling-update-æ»šåŠ¨å‡çº§" class="hash-link" aria-label="7.7.3.3. rolling update (æ»šåŠ¨å‡çº§)çš„ç›´æ¥é“¾æ¥" title="7.7.3.3. rolling update (æ»šåŠ¨å‡çº§)çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><blockquote><p>åƒä¸Šé¢é‚£æ ·çš„éƒ¨ç½²æ–¹å¼æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ‰€æœ‰çš„å‰¯æœ¬åœ¨åŒä¸€æ—¶é—´æ›´æ–°ï¼Œè¿™ä¼šå¯¼è‡´æˆ‘ä»¬ hellok8s æœåŠ¡åœ¨çŸ­æ—¶é—´å†…æ˜¯ä¸å¯ç”¨çš„ï¼Œå› ä¸ºæ‰€æœ‰ pod éƒ½åœ¨å‡çº§åˆ° v2 ç‰ˆæœ¬çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ç­‰å¾…æŸä¸ª pod å‡çº§å®Œæˆåæ‰èƒ½æä¾›æœåŠ¡</p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ»šåŠ¨æ›´æ–°ï¼Œåœ¨ä¿è¯æ–°ç‰ˆæœ¬ v2 çš„ pod è¿˜æ²¡æœ‰ ready ä¹‹å‰ï¼Œå…ˆä¸åˆ é™¤ v1 ç‰ˆæœ¬çš„ podã€‚</p></blockquote><p><code>spec.strategy.type</code> &#x27;s possible values include:</p><ul><li><p>RollingUpdate: é€æ¸å¢åŠ æ–°ç‰ˆæœ¬çš„ podï¼Œé€æ¸å‡å°‘æ—§ç‰ˆæœ¬çš„ podã€‚</p><p>(å¯ä»¥é€šè¿‡ maxSurge å’Œ maxUnavailable å­—æ®µæ¥æ§åˆ¶å‡çº§ pod çš„é€Ÿç‡)</p><ul><li>maxSurge: æœ€å¤§å³°å€¼ï¼Œç”¨æ¥æŒ‡å®šå¯ä»¥åˆ›å»ºçš„è¶…å‡ºæœŸæœ› Pod ä¸ªæ•°çš„ Pod æ•°é‡ã€‚</li><li>maxUnavailable: æœ€å¤§ä¸å¯ç”¨ï¼Œç”¨æ¥æŒ‡å®šæ›´æ–°è¿‡ç¨‹ä¸­ä¸å¯ç”¨çš„ Pod çš„ä¸ªæ•°ä¸Šé™ã€‚</li></ul></li><li><p>Recreate: åœ¨æ–°ç‰ˆæœ¬çš„ pod å¢åŠ å‰ï¼Œå…ˆå°†æ‰€æœ‰æ—§ç‰ˆæœ¬ pod åˆ é™¤ã€‚</p></li></ul><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">strategy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># specify the upgrade type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">rollingUpdate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># æŒ‡å®š pod çš„æœ€å¤§è¶…å‡ºä¸ªæ•°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># æœ€å¤§å¯èƒ½ä¼šåˆ›å»º 4 ä¸ª hellok8s pod (replicas + maxSurge)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">maxSurge</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># æŒ‡å®š pod çš„æœ€å¤§ä¸å¯ç”¨ä¸ªæ•°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># æœ€å°ä¼šæœ‰ 2 ä¸ª hellok8s pod å­˜æ´» (replicas - maxUnavailable)ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">maxUnavailable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> guangzhengli/hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">container</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7734-å›æ»š-ç‰ˆæœ¬å›é€€-æŸ¥çœ‹å†å²">7.7.3.4. å›æ»š ç‰ˆæœ¬å›é€€ æŸ¥çœ‹å†å²<a href="#7734-å›æ»š-ç‰ˆæœ¬å›é€€-æŸ¥çœ‹å†å²" class="hash-link" aria-label="7.7.3.4. å›æ»š ç‰ˆæœ¬å›é€€ æŸ¥çœ‹å†å²çš„ç›´æ¥é“¾æ¥" title="7.7.3.4. å›æ»š ç‰ˆæœ¬å›é€€ æŸ¥çœ‹å†å²çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># roll back to last deployment version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl rollout undo deployment hellok8s-deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check the history version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl rollout history deployment hellok8s-deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># roll back to the specified version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl rollout undo deployment/hellok8s-deployment --to-revision=2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7735-livenessprobe-å­˜æ´»æ¢é’ˆ">7.7.3.5. livenessProbe (å­˜æ´»æ¢é’ˆ)<a href="#7735-livenessprobe-å­˜æ´»æ¢é’ˆ" class="hash-link" aria-label="7.7.3.5. livenessProbe (å­˜æ´»æ¢é’ˆ)çš„ç›´æ¥é“¾æ¥" title="7.7.3.5. livenessProbe (å­˜æ´»æ¢é’ˆ)çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><blockquote><p>åœ¨ç”Ÿäº§ä¸­ï¼Œæœ‰æ—¶å€™å› ä¸ºæŸäº› bug å¯¼è‡´åº”ç”¨æ­»é”æˆ–è€…çº¿ç¨‹è€—å°½äº†ï¼Œæœ€ç»ˆä¼šå¯¼è‡´åº”ç”¨æ— æ³•ç»§ç»­æä¾›æœåŠ¡ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæ²¡æœ‰æ‰‹æ®µæ¥è‡ªåŠ¨ç›‘æ§å’Œå¤„ç†è¿™ä¸€é—®é¢˜çš„è¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¾ˆé•¿ä¸€æ®µæ—¶é—´æ— äººå‘ç°</p></blockquote><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">strategy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">rollingUpdate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">maxSurge</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">maxUnavailable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> guangzhengli/hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">liveness</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¦‚æœæœåŠ¡å™¨ä¸Š /healthz è·¯å¾„ä¸‹çš„å¤„ç†ç¨‹åºè¿”å›æˆåŠŸä»£ç ï¼Œåˆ™ kubelet è®¤ä¸ºå®¹å™¨æ˜¯å¥åº·å­˜æ´»çš„ã€‚ å¦‚æœå¤„ç†ç¨‹åºè¿”å›å¤±è´¥ä»£ç ï¼Œåˆ™ kubelet ä¼šæ€æ­»è¿™ä¸ªå®¹å™¨å¹¶å°†å…¶é‡å¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">livenessProbe</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># ä½¿ç”¨ HTTP GET è¯·æ±‚çš„æ–¹å¼æ¢æ´»</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">httpGet</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token comment" style="color:rgb(0, 128, 0)"># Specify the application route (api path)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /healthz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token comment" style="color:rgb(0, 128, 0)"># specify the application port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># å‘Šè¯‰ kubelet åœ¨æ‰§è¡Œç¬¬ä¸€æ¬¡æ¢æµ‹å‰åº”è¯¥ç­‰å¾… 3 ç§’</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># å³å®¹å™¨å¯åŠ¨åè¦ç­‰å¾…å¤šå°‘ç§’åæ‰å¯åŠ¨å­˜æ´»å’Œå°±ç»ªæ¢æµ‹å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">initialDelaySeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># æ‰§è¡Œæ¢æµ‹çš„æ—¶é—´é—´éš”ï¼ˆå•ä½æ˜¯ç§’ï¼‰ã€‚é»˜è®¤æ˜¯ 10 ç§’ã€‚æœ€å°å€¼æ˜¯ 1ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">periodSeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># timeoutSecondsï¼šæ¢æµ‹çš„è¶…æ—¶åç­‰å¾…å¤šå°‘ç§’ã€‚é»˜è®¤å€¼æ˜¯ 1 ç§’ã€‚æœ€å°å€¼æ˜¯ 1ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># failureThresholdï¼šå½“æ¢æµ‹å¤±è´¥æ—¶ï¼ŒKubernetes çš„é‡è¯•æ¬¡æ•°ã€‚ å¯¹å­˜æ´»æ¢æµ‹è€Œè¨€ï¼Œæ”¾å¼ƒå°±æ„å‘³ç€é‡æ–°å¯åŠ¨å®¹å™¨ã€‚ å¯¹å°±ç»ªæ¢æµ‹è€Œè¨€ï¼Œæ”¾å¼ƒæ„å‘³ç€ Pod ä¼šè¢«æ‰“ä¸Šæœªå°±ç»ªçš„æ ‡ç­¾ã€‚é»˜è®¤å€¼æ˜¯ 3ã€‚æœ€å°å€¼æ˜¯ 1ã€‚</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é€šè¿‡ <code>kubectl get pods</code> æŸ¥çœ‹çŠ¶æ€ or <code>kubectl describe pod hellok8s-68f47f657c-zwn6g</code> æŸ¥çœ‹åŸå› ,</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7736-readinessprobe-å°±ç»ªæ¢é’ˆ">7.7.3.6. readinessProbe (å°±ç»ªæ¢é’ˆ)<a href="#7736-readinessprobe-å°±ç»ªæ¢é’ˆ" class="hash-link" aria-label="7.7.3.6. readinessProbe (å°±ç»ªæ¢é’ˆ)çš„ç›´æ¥é“¾æ¥" title="7.7.3.6. readinessProbe (å°±ç»ªæ¢é’ˆ)çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><blockquote><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå‡çº§æœåŠ¡çš„ç‰ˆæœ¬æ˜¯æ—¥å¸¸çš„éœ€æ±‚ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸€ç§åœºæ™¯ï¼Œå³å½“å‘å¸ƒçš„ç‰ˆæœ¬å­˜åœ¨é—®é¢˜ï¼Œå°±ä¸åº”è¯¥è®©å®ƒå‡çº§æˆåŠŸã€‚kubelet ä½¿ç”¨å°±ç»ªæ¢æµ‹å™¨å¯ä»¥çŸ¥é“å®¹å™¨ä½•æ—¶å‡†å¤‡å¥½æ¥å—è¯·æ±‚æµé‡ï¼Œå½“ä¸€ä¸ª pod å‡çº§åä¸èƒ½å°±ç»ªï¼Œå³ä¸åº”è¯¥è®©æµé‡è¿›å…¥è¯¥ podï¼Œåœ¨é…åˆ rollingUpate çš„åŠŸèƒ½ä¸‹ï¼Œä¹Ÿä¸èƒ½å…è®¸å‡çº§ç‰ˆæœ¬ç»§ç»­ä¸‹å»ï¼Œå¦åˆ™æœåŠ¡ä¼šå‡ºç°å…¨éƒ¨å‡çº§å®Œæˆï¼Œå¯¼è‡´æ‰€æœ‰æœåŠ¡å‡ä¸å¯ç”¨çš„æƒ…å†µã€‚</p></blockquote><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">strategy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">rollingUpdate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">maxSurge</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">maxUnavailable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> guangzhengli/hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">bad</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">readinessProbe</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">httpGet</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /healthz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># åˆæ¬¡æ¢æµ‹å‰ç­‰å¾…æ—¶é—´, é»˜è®¤æ˜¯ 0 ç§’ï¼Œæœ€å°å€¼æ˜¯ 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">initialDelaySeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># è¢«è§†ä¸ºæˆåŠŸçš„æœ€å°è¿ç»­æˆåŠŸæ•°ã€‚é»˜è®¤å€¼æ˜¯ 1ã€‚ å­˜æ´»å’Œå¯åŠ¨æ¢æµ‹çš„è¿™ä¸ªå€¼å¿…é¡»æ˜¯ 1ã€‚æœ€å°å€¼æ˜¯ 1ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">successThreshold</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="774-sc-stateful-set">7.7.4. SC (stateful set)<a href="#774-sc-stateful-set" class="hash-link" aria-label="7.7.4. SC (stateful set)çš„ç›´æ¥é“¾æ¥" title="7.7.4. SC (stateful set)çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>æœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½² (å¦‚ MySQL, ZooKeeperã€etcd )</p><p>StatefulSet ä¸­çš„æ¯ä¸ª Pod çš„åå­—éƒ½æ˜¯äº‹å…ˆç¡®å®šçš„ï¼Œä¼šè¢«å›ºå®šä½</p><p>StatefulSet ä¸­çš„ Podï¼Œæ¯ä¸ª Pod æŒ‚è½½è‡ªå·±ç‹¬ç«‹æŒ‡å®šçš„å­˜å‚¨ï¼Œ</p><blockquote><p>å¦‚æœä¸€ä¸ª Pod å‡ºç°æ•…éšœï¼Œä»å…¶ä»–èŠ‚ç‚¹å¯åŠ¨ä¸€ä¸ªåŒæ ·åå­—çš„ Podï¼Œè¦æŒ‚è½½ä¸ŠåŸæ¥ Pod çš„å­˜å‚¨ç»§ç»­ä»¥å®ƒçš„çŠ¶æ€æä¾›æœåŠ¡</p><p>ä½¿ç”¨ StatefulSetï¼ŒPod ä»ç„¶å¯ä»¥é€šè¿‡æ¼‚ç§»åˆ°ä¸åŒèŠ‚ç‚¹æä¾›é«˜å¯ç”¨ï¼Œè€Œå­˜å‚¨ä¹Ÿå¯ä»¥é€šè¿‡å¤–æŒ‚çš„å­˜å‚¨æ¥æä¾›é«˜å¯é æ€§ï¼ŒStatefulSet åšçš„åªæ˜¯å°†ç¡®å®šçš„ Pod ä¸ç¡®å®šçš„å­˜å‚¨å…³è”èµ·æ¥ä¿è¯çŠ¶æ€çš„è¿ç»­æ€§ã€‚</p></blockquote><p>Service çš„ CLUSTER-IP æ˜¯ç©ºçš„</p><p>Pod åˆ›å»ºå’Œé”€æ¯æ˜¯æœ‰åºçš„ï¼Œåˆ›å»ºæ˜¯é¡ºåºçš„ï¼Œé”€æ¯æ˜¯é€†åºçš„</p><p>å¦‚ä¸‹éƒ¨ç½² MongoDB:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> mongodb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> mongodb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> mongodb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> mongodb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> mongo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> mongo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">4.4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token comment" style="color:rgb(0, 128, 0)"># IfNotPresent ä»…æœ¬åœ°æ²¡æœ‰é•œåƒæ—¶æ‰è¿œç¨‹æ‹‰ï¼ŒAlways æ°¸è¿œéƒ½æ˜¯ä»è¿œç¨‹æ‹‰ï¼ŒNever æ°¸è¿œåªç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™æŠ¥é”™</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">imagePullPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> IfNotPresent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /data/db </span><span class="token comment" style="color:rgb(0, 128, 0)"># å®¹å™¨é‡Œé¢çš„æŒ‚è½½è·¯å¾„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> mongo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">data    </span><span class="token comment" style="color:rgb(0, 128, 0)"># å·åå­—ï¼Œå¿…é¡»è·Ÿä¸‹é¢å®šä¹‰çš„åå­—ä¸€è‡´</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> mongo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">data              </span><span class="token comment" style="color:rgb(0, 128, 0)"># å·åå­—</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">hostPath</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># æŠŠèŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ªç›®å½•æŒ‚è½½åˆ° Podï¼Œä½†æ˜¯å·²ç»ä¸æ¨èä½¿ç”¨äº†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /data/mongo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">data      </span><span class="token comment" style="color:rgb(0, 128, 0)"># èŠ‚ç‚¹ä¸Šçš„è·¯å¾„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> DirectoryOrCreate     </span><span class="token comment" style="color:rgb(0, 128, 0)"># æŒ‡å‘ä¸€ä¸ªç›®å½•ï¼Œä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»º</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> mongodb </span><span class="token comment" style="color:rgb(0, 128, 0)"># å›ºå®šçš„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> mongodb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># HeadLess</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">clusterIP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> None</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">27017</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">27017</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7741-æ•°æ®æŒä¹…åŒ–-persist">7.7.4.1. æ•°æ®æŒä¹…åŒ– persist<a href="#7741-æ•°æ®æŒä¹…åŒ–-persist" class="hash-link" aria-label="7.7.4.1. æ•°æ®æŒä¹…åŒ– persistçš„ç›´æ¥é“¾æ¥" title="7.7.4.1. æ•°æ®æŒä¹…åŒ– persistçš„ç›´æ¥é“¾æ¥">â€‹</a></h5><p>Storage Class (SC) : å°†å­˜å‚¨å·åˆ’åˆ†ä¸ºä¸åŒçš„ç§ç±»ï¼Œä¾‹å¦‚ï¼šSSDï¼Œæ™®é€šç£ç›˜ï¼Œæœ¬åœ°ç£ç›˜</p><p>Persistent Volume (PV) : æè¿°å·çš„å…·ä½“ä¿¡æ¯ï¼Œä¾‹å¦‚ç£ç›˜å¤§å°ï¼Œè®¿é—®æ¨¡å¼</p><p>Persistent Volume Claim (PVC): å¯¹å­˜å‚¨éœ€æ±‚çš„ä¸€ä¸ªç”³æ˜ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç”³è¯·å•ï¼Œç³»ç»Ÿæ ¹æ®è¿™ä¸ªç”³è¯·å•å»æ‰¾ä¸€ä¸ªåˆé€‚çš„ PV</p><blockquote><p>è¿˜å¯ä»¥æ ¹æ® PVC è‡ªåŠ¨åˆ›å»º PVã€‚</p></blockquote><p>PersistemVolume(PV)ç”¨æ¥å®šä¹‰å­˜å‚¨å·ï¼ŒPersistemVolumeClaim(PVC)ç”¨æ¥å£°æ˜åœ¨Podä¸­ç”¨å“ªä¸ªPVã€‚é€šå¸¸PVå’ŒPVCæ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚ä½†æ˜¯å¦‚æœæ¯æ¬¡éƒ½è¦å»åˆ›å»ºPVå¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥K8Sè¿˜æä¾›äº†StorageClassæ¥åŠ¨æ€åˆ›å»ºPVã€‚å‰é¢çš„StatefulSetså› ä¸ºè¦ä¿è¯Podçš„çŠ¶æ€æŒä¹…åŒ–è½ç›˜ï¼Œå®ƒå°±ä¾èµ–äºPVå’ŒPVCè¿™ç©æ„å„¿åšæŒä¹…åŒ–ã€‚</p><p><img loading="lazy" alt="xx" src="/assets/images/k8s_storage-be12cdb7b38ab477a52835c7c8343043.png" width="1264" height="1362" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="775-ds-daemon-set-åå°æ”¯æ’‘æœåŠ¡é›†">7.7.5. DS (daemon set åå°æ”¯æ’‘æœåŠ¡é›†)<a href="#775-ds-daemon-set-åå°æ”¯æ’‘æœåŠ¡é›†" class="hash-link" aria-label="7.7.5. DS (daemon set åå°æ”¯æ’‘æœåŠ¡é›†)çš„ç›´æ¥é“¾æ¥" title="7.7.5. DS (daemon set åå°æ”¯æ’‘æœåŠ¡é›†)çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ç¡®ä¿æ¯ä¸ª working node éƒ½è¿è¡Œä¸€ä¸ªæŒ‡å®š pod (working node å¯èƒ½æ˜¯æ‰€æœ‰é›†ç¾¤èŠ‚ç‚¹ä¹Ÿå¯èƒ½æ˜¯é€šè¿‡ nodeSelector é€‰å®šçš„ä¸€äº›ç‰¹å®šèŠ‚ç‚¹)</p><blockquote><p>è¿™ä¸ª pod å¯èƒ½æ˜¯ç”¨æ¥ä¸“é—¨æ”¯æ’‘ä¸šåŠ¡ç³»ç»Ÿè¿è¡Œçš„åŸºç¡€æœåŠ¡, æ¯”å¦‚å¯¹é›†ç¾¤ä¸­çš„æ¯ä¸ª working node åšæ—¥å¿—é‡‡é›†ï¼Œæ€§èƒ½æŒ‡æ ‡ç›‘æ§</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="776-job-ä¸€æ¬¡æ€§ä»»åŠ¡">7.7.6. job (ä¸€æ¬¡æ€§ä»»åŠ¡)<a href="#776-job-ä¸€æ¬¡æ€§ä»»åŠ¡" class="hash-link" aria-label="7.7.6. job (ä¸€æ¬¡æ€§ä»»åŠ¡)çš„ç›´æ¥é“¾æ¥" title="7.7.6. job (ä¸€æ¬¡æ€§ä»»åŠ¡)çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Job ç®¡ç†çš„ Pod æ ¹æ®ç”¨æˆ·çš„è®¾ç½®æŠŠä»»åŠ¡æˆåŠŸå®Œæˆå°±è‡ªåŠ¨é€€å‡ºäº†</p><blockquote><p>æˆåŠŸå®Œæˆçš„æ ‡å¿—æ ¹æ®ä¸åŒçš„ spec.completions ç­–ç•¥è€Œä¸åŒï¼š</p><ul><li>å• Pod å‹ä»»åŠ¡æœ‰ä¸€ä¸ª Pod æˆåŠŸå°±æ ‡å¿—å®Œæˆï¼›</li><li>å®šæ•°æˆåŠŸå‹ä»»åŠ¡ä¿è¯æœ‰ N ä¸ªä»»åŠ¡å…¨éƒ¨æˆåŠŸï¼›</li><li>å·¥ä½œé˜Ÿåˆ—å‹ä»»åŠ¡æ ¹æ®åº”ç”¨ç¡®è®¤çš„å…¨å±€æˆåŠŸè€Œæ ‡å¿—æˆåŠŸã€‚</li></ul></blockquote><p>Job å®Œæˆæ—¶ä¸ä¼šå†åˆ›å»ºæ–°çš„ Podï¼Œä¸è¿‡å·²æœ‰çš„ Pod é€šå¸¸ä¹Ÿä¸ä¼šè¢«åˆ é™¤</p><blockquote><p>ä¿ç•™è¿™äº› Pod ä½¿å¾—ä½ å¯ä»¥æŸ¥çœ‹å·²å®Œæˆçš„ Pod çš„æ—¥å¿—è¾“å‡ºï¼Œä»¥ä¾¿æ£€æŸ¥é”™è¯¯ã€è­¦å‘Šæˆ–è€…å…¶å®ƒè¯Šæ–­æ€§è¾“å‡ºã€‚ å¯ä»¥ä½¿ç”¨ kubectl æ¥åˆ é™¤ Jobï¼ˆä¾‹å¦‚ kubectl delete -f hello-job.yaml)ã€‚å½“ä½¿ç”¨ kubectl æ¥åˆ é™¤ Job æ—¶ï¼Œè¯¥ Job æ‰€åˆ›å»ºçš„ Pod ä¹Ÿä¼šè¢«åˆ é™¤</p></blockquote><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> batch/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Job</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">job</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># ä¾‹å¦‚ä¸‹é¢å°±ä¼šå…ˆåˆ›å»º 3 ä¸ª pod å¹¶å‘æ‰§è¡Œä»»åŠ¡ï¼Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># ä¸€æ—¦æŸä¸ª pod æ‰§è¡Œå®Œæˆï¼Œå°±ä¼šå†åˆ›å»ºæ–°çš„ pod æ¥æ‰§è¡Œï¼Œç›´åˆ° 5 ä¸ª pod æ‰§è¡Œå®Œæˆï¼ŒJob æ‰ä¼šè¢«æ ‡è®°ä¸ºå®Œæˆã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¹¶å‘æ‰§è¡Œçš„ pod çš„æ•°é‡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">parallelism</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># åˆ›å»º Pod çš„æ•°é‡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">completions</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># pod å†…çš„ container å¼‚å¸¸è€Œç»“æŸæ—¶, Pod ä¼šç»§ç»­ä¿ç•™åœ¨å½“å‰ node, ä½†æ˜¯é‡å¯å†…éƒ¨ container</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¯é€‰å€¼: Never, ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> OnFailure</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> echo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> busybox</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/bin/sh&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-c&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;for i in 9 8 7 6 5 4 3 2 1 ; do echo $i ; done&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f hello-job.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get jobs      </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get cronjob[s]            </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pods -w</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl logs -f xxx_pod</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="777-cronjob-å®šæ—¶ä»»åŠ¡">7.7.7. cronjob (å®šæ—¶ä»»åŠ¡)<a href="#777-cronjob-å®šæ—¶ä»»åŠ¡" class="hash-link" aria-label="7.7.7. cronjob (å®šæ—¶ä»»åŠ¡)çš„ç›´æ¥é“¾æ¥" title="7.7.7. cronjob (å®šæ—¶ä»»åŠ¡)çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ç”¨æ³•é™¤äº†éœ€è¦åŠ ä¸Š cron è¡¨è¾¾å¼ä¹‹å¤–ï¼Œå…¶ä½™åŸºæœ¬å’Œ Job ä¿æŒä¸€è‡´ã€‚</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ </span><span class="token function" style="color:rgb(0, 0, 255)">åˆ†é’Ÿ</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">59</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ </span><span class="token function" style="color:rgb(0, 0, 255)">å°æ—¶</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ </span><span class="token function" style="color:rgb(0, 0, 255)">æœˆçš„æŸå¤©</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">31</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ </span><span class="token function" style="color:rgb(0, 0, 255)">æœˆä»½</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ </span><span class="token function" style="color:rgb(0, 0, 255)">å‘¨çš„æŸå¤©</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">ï¼ˆå‘¨æ—¥åˆ°å‘¨ä¸€ï¼›åœ¨æŸäº›ç³»ç»Ÿä¸Šï¼Œ</span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> ä¹Ÿæ˜¯æ˜ŸæœŸæ—¥ï¼‰</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># â”‚ â”‚ â”‚ â”‚ â”‚                          æˆ–è€…æ˜¯ sunï¼Œmonï¼Œtueï¼Œwebï¼Œthuï¼Œfriï¼Œsat</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># â”‚ â”‚ â”‚ â”‚ â”‚</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># â”‚ â”‚ â”‚ â”‚ â”‚</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> batch/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> CronJob</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">cronjob</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">schedule</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;* * * * *&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># Every minute</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">jobTemplate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> OnFailure</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> echo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> busybox</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/bin/sh&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-c&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;for i in 9 8 7 6 5 4 3 2 1 ; do echo $i ; done&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="78-service">7.8. service<a href="#78-service" class="hash-link" aria-label="7.8. serviceçš„ç›´æ¥é“¾æ¥" title="7.8. serviceçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ç”¨æ¥ä»£ç†ä¸€ç»„ pods, é€šè¿‡ label selector é€‰æ‹©ä¸€æ‰¹ pods</p><blockquote><p>Podé‡å»ºåipæ˜¯ä¼šé‡æ–°åˆ†é…çš„ï¼Œè€Œä¸”ä¸€ä¸ªæœåŠ¡Podæœ‰å¥½å‡ ä¸ª, æ‰€ä»¥æœåŠ¡ä¹‹é—´çš„è°ƒç”¨è‚¯å®šä¸èƒ½ç”¨Podçš„ipï¼Œéœ€è¦ service æä¾›ä»£ç†; ä½†æ˜¯è¿™ä¸ªServiceä»£ç†å’ŒNginxè¿™æ ·çš„åå‘ä»£ç†è¿˜æ˜¯ä¸ä¸€æ ·çš„ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯å’ŒLVSç±»ä¼¼çš„å››å±‚ä»£ç†ï¼Œä¹Ÿå°±æ˜¯ä¼ è¾“å±‚ä»£ç†, å®ƒæ˜¯ä¸åŒºåˆ†åº”ç”¨å±‚æ˜¯httpæµé‡è¿˜æ˜¯mysqlçš„æµé‡çš„</p><p>æä¾›è®¿é—®æœåŠ¡çš„å›ºå®šåœ°å€(æœåŠ¡å‘ç°, è´Ÿè½½å‡è¡¡).</p></blockquote><p>æ¯ä¸ª Service ä¼šå¯¹åº”ä¸€ä¸ªé›†ç¾¤å†…éƒ¨æœ‰æ•ˆçš„è™šæ‹Ÿ IPï¼Œé›†ç¾¤å†…éƒ¨é€šè¿‡è™šæ‹Ÿ IP (or service name) è®¿é—®ä¸€ä¸ªæœåŠ¡</p><blockquote><p>RCã€RS å’Œ Deployment åªæ˜¯ä¿è¯äº†æ”¯æ’‘æœåŠ¡çš„å¾®æœåŠ¡ Pod çš„æ•°é‡ï¼Œä½†æ˜¯æ²¡æœ‰è§£å†³å¦‚ä½•è®¿é—®è¿™äº›æœåŠ¡çš„é—®é¢˜ã€‚ä¸€ä¸ª Pod åªæ˜¯ä¸€ä¸ªè¿è¡ŒæœåŠ¡çš„å®ä¾‹ï¼Œéšæ—¶å¯èƒ½åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šåœæ­¢ï¼Œåœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹ä»¥ä¸€ä¸ªæ–°çš„ IP å¯åŠ¨ä¸€ä¸ªæ–°çš„ Podï¼Œå› æ­¤ä¸èƒ½ä»¥ç¡®å®šçš„ IP å’Œç«¯å£å·æä¾›æœåŠ¡ã€‚è¦ç¨³å®šåœ°æä¾›æœåŠ¡éœ€è¦æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡èƒ½åŠ›ã€‚</p><p>åœ¨ K8 é›†ç¾¤ä¸­ï¼Œå®¢æˆ·ç«¯éœ€è¦è®¿é—®çš„æœåŠ¡å°±æ˜¯ Service å¯¹è±¡, ç±»ä¼¼ å¾®æœåŠ¡ä¸­æ³¨å†Œä¸­å¿ƒçš„è§’è‰², é€šè¿‡æŸä¸ª service, å¯è®¿é—®ä¸€ç»„æä¾›ç›¸åŒæœåŠ¡çš„ pods</p></blockquote><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get service[s]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="781-endpoint">7.8.1. Endpoint<a href="#781-endpoint" class="hash-link" aria-label="7.8.1. Endpointçš„ç›´æ¥é“¾æ¥" title="7.8.1. Endpointçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>è¢« selector é€‰ä¸­çš„ Podï¼Œå°±ç§°ä¸º Service çš„ Endpoints</p><blockquote><p>å®ƒç»´æŠ¤ç€ Pod çš„ IP åœ°å€ï¼Œåªè¦æœåŠ¡ä¸­çš„ Pod é›†åˆå‘ç”Ÿæ›´æ”¹ï¼ŒEndpoints å°±ä¼šè¢«æ›´æ–°</p></blockquote><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># check list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get endpoints</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="782-å¤šç«¯å£">7.8.2. å¤šç«¯å£<a href="#782-å¤šç«¯å£" class="hash-link" aria-label="7.8.2. å¤šç«¯å£çš„ç›´æ¥é“¾æ¥" title="7.8.2. å¤šç«¯å£çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> NodePort</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># æœ¬ Service çš„ç«¯å£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s    </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¤šç«¯å£æ—¶å¿…é¡»é…ç½® name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># (è¢« Service ä»£ç†çš„)å®¹å™¨ç«¯å£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">nodePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">31000</span><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)"># èŠ‚ç‚¹ç«¯å£ï¼ŒèŒƒå›´å›ºå®š 30000 ~ 32767</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">other</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">nodePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">32000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>K8S çš„ç»“æ„å¯ä»¥å¤§è‡´åˆ†ä¸º 3 å±‚ï¼ŒNode, Pod, Container, ä¸ºäº†ä¿æŠ¤ Container é‡Œé¢çš„åº”ç”¨ï¼Œå„å±‚éƒ½è¿›è¡Œäº†éš”ç¦»ã€‚ä¸ºäº†èƒ½å¤Ÿè®¿é—®åˆ° Pod é‡Œé¢çš„ Container, Service å®šä¹‰äº†å‡ ç§ Port ç±»å‹ï¼š</p><ul><li><p>Port - exposes the Kubernetes service on the specified port within the cluster. Other pods within the cluster can communicate with this server on the specified port.</p><p>æ˜¯æš´éœ²åœ¨é›†ç¾¤å†…éƒ¨ Ip ä¸Šçš„ç«¯å£, æä¾›é›†ç¾¤å†…éƒ¨è®¿é—® service çš„å…¥å£, å³ <code>clusterIP:port</code></p><p>è¿™æ—¶çš„ service ç±»å‹å³ clusterIp ç±»å‹ (k8s é»˜è®¤çš„ service type), ä»…ä»…èƒ½åœ¨å†…éƒ¨äº’ç›¸è®¿é—®</p></li><li><p>TargetPort - is the port on which the service will send requests to, that your pod will be listening on. Your application in the container will need to be listening on this port also.</p><p>å³ Pod / Container ç›‘å¬çš„ Port.</p></li><li><p>NodePort - exposes a service externally to the cluster by means of the target nodes IP address and the NodePort. </p><p>NodePort is the default setting if the port field is not specified.</p><p>æš´éœ²ç«¯å£åˆ°èŠ‚ç‚¹ï¼Œå¯ä»¥è®©å¤–ç½‘èƒ½å¤Ÿè®¿é—®åˆ° Pod/Container.</p><p>èŒƒå›´å›ºå®š 30000 ~ 32767</p></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="783-clusterip-é»˜è®¤ä½¿ç”¨çš„ç±»å‹">7.8.3. ClusterIP (é»˜è®¤ä½¿ç”¨çš„ç±»å‹)<a href="#783-clusterip-é»˜è®¤ä½¿ç”¨çš„ç±»å‹" class="hash-link" aria-label="7.8.3. ClusterIP (é»˜è®¤ä½¿ç”¨çš„ç±»å‹)çš„ç›´æ¥é“¾æ¥" title="7.8.3. ClusterIP (é»˜è®¤ä½¿ç”¨çš„ç±»å‹)çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Service çš„é»˜è®¤ç±»å‹ï¼Œè‡ªåŠ¨åˆ†é…ä¸€ä¸ªä»…Clusterå†…éƒ¨å¯ä»¥è®¿é—®çš„è™šæ‹ŸIP, é€šè¿‡ kubernetes é›†ç¾¤çš„å†…éƒ¨ IP æš´éœ²æœåŠ¡</p><blockquote><p>å½“æˆ‘ä»¬åªéœ€è¦è®©é›†ç¾¤ä¸­è¿è¡Œçš„å…¶ä»–åº”ç”¨ç¨‹åºè®¿é—®æˆ‘ä»¬çš„ pod æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ç§ç±»å‹çš„ Service</p></blockquote><p><img loading="lazy" src="/assets/images/k8s_service_clusterip-e86739dbbf5a24827a7c8a13cadbe0ec.png" width="1306" height="976" class="img_ev3q"></p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">clusterip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># optional, é»˜è®¤å°±æ˜¯è¿™æ ·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># associate with pods by using the label selector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># å½“å‰ service åœ¨é›†ç¾¤å†…éƒ¨æš´éœ²çš„ç«¯å£, å³é›†ç¾¤å†…éƒ¨å…¶ä»–clienté€šè¿‡è¿™ä¸ªç«¯å£è®¿é—®å½“å‰ service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">#  æŒ‡å®šå½“å‰ service ç®¡ç†çš„ pod ä¸Šçš„ç«¯å£(ä¸åˆ¶ä½œå®¹å™¨æ—¶æš´éœ²çš„ç«¯å£ä¸€è‡´ï¼ˆå³DockerFileä¸­çš„EXPOSEï¼‰)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># ä»port/nodePortä¸Šæ¥çš„æ•°æ®ï¼Œç»è¿‡kube-proxyæµå…¥åˆ°åç«¯podçš„targetPortä¸Šï¼Œæœ€åè¿›å…¥å®¹å™¨ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7831-headless">7.8.3.1. Headless<a href="#7831-headless" class="hash-link" aria-label="7.8.3.1. Headlessçš„ç›´æ¥é“¾æ¥" title="7.8.3.1. Headlessçš„ç›´æ¥é“¾æ¥">â€‹</a></h5><p>service type è¿˜æ˜¯ clusterIP, ä½†æ˜¯ clusterIp è®¾ç½®ä¸º None å°±å˜æˆ Headless äº†ï¼Œä¸ä¼šå†åˆ†é… IP </p><blockquote><p>é€‚åˆæ•°æ®åº“</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="784-nodeport">7.8.4. NodePort<a href="#784-nodeport" class="hash-link" aria-label="7.8.4. NodePortçš„ç›´æ¥é“¾æ¥" title="7.8.4. NodePortçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>åœ¨ClusterlPåŸºç¡€ä¸Šä¸ºServiceåœ¨æ¯å°æœºå™¨ä¸Šç»‘å®šä¸€ä¸ªç«¯å£ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ cluster å¤–éƒ¨é€šè¿‡<code>&lt;NodeIP&gt;:NodePort </code>æ¥è®¿é—®è¯¥æœåŠ¡</p><blockquote><p>æ¯”å¦‚å¤–éƒ¨ç”¨æˆ·è¦è®¿é—® k8s é›†ç¾¤ä¸­çš„ä¸€ä¸ª Web åº”ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é…ç½®å¯¹åº” service çš„ type=NodePortï¼ŒnodePort=30001ã€‚å…¶ä»–ç”¨æˆ·å°±å¯ä»¥é€šè¿‡æµè§ˆå™¨ http://node:30001 è®¿é—®åˆ°è¯¥ web æœåŠ¡ã€‚</p><p>è€Œæ•°æ®åº“ç­‰æœåŠ¡å¯èƒ½ä¸éœ€è¦è¢«å¤–ç•Œè®¿é—®ï¼Œåªéœ€è¢«å†…éƒ¨æœåŠ¡è®¿é—®å³å¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸å¿…è®¾ç½® service çš„ NodePortã€‚</p></blockquote><blockquote><p>ä½†æ˜¯ node port æ•°é‡æ˜¯æœ‰é™çš„, å…­ä¸‡å¤šä¸ªå§, å¦‚æœéƒ½ç”¨è¿™ç§æ–¹å¼æš´éœ²æœåŠ¡ç»™é›†ç¾¤å¤–éƒ¨è®¿é—®, æ€»æœ‰ç”¨å®Œçš„æ—¶å€™, è¿™æ˜¯éœ€è¦ ingress</p></blockquote><p>NodePort æœåŠ¡ä¼šè·¯ç”±åˆ°è‡ªåŠ¨åˆ›å»ºçš„ ClusterIP æœåŠ¡ã€‚</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> NodePort            // é…ç½®NodePortï¼Œå¤–éƒ¨æµé‡å¯è®¿é—®k8sä¸­çš„æœåŠ¡</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 30080             // æœåŠ¡è®¿é—®ç«¯å£ï¼Œé›†ç¾¤å†…éƒ¨è®¿é—®çš„ç«¯å£</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 80          // podæ§åˆ¶å™¨ä¸­å®šä¹‰çš„ç«¯å£ï¼ˆå³ container å®šä¹‰ä¸­çš„ç«¯å£ï¼‰</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">nodePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 30001         // NodePortï¼Œå¤–éƒ¨å®¢æˆ·ç«¯è®¿é—®çš„ç«¯å£</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> èŒƒå›´å›ºå®š 30000 ~ 32767</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="785-loadbalancer">7.8.5. LoadBalancer<a href="#785-loadbalancer" class="hash-link" aria-label="7.8.5. LoadBalancerçš„ç›´æ¥é“¾æ¥" title="7.8.5. LoadBalancerçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>åœ¨NodePortçš„åŸºç¡€ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨, å°†è¯·æ±‚è½¬å‘åˆ°å†…éƒ¨ Service ä¸Š; éœ€è¦ç¬¬ä¸‰æ–¹è´Ÿè½½å‡è¡¡æœåŠ¡æ¥å®ç°ï¼Œå¯ä»¥æ˜¯è½¯ä»¶çš„ä¹Ÿå¯ä»¥æ˜¯ç¡¬ä»¶çš„ã€‚</p><blockquote><p>ä¸€èˆ¬æ˜¯ä½¿ç”¨äº‘æä¾›å•†çš„è´Ÿè½½å‡è¡¡å™¨å‘å¤–éƒ¨æš´éœ²æœåŠ¡ã€‚ è¿™ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨å¯ä»¥å°†æµé‡è·¯ç”±åˆ°è‡ªåŠ¨åˆ›å»ºçš„ NodePort æœåŠ¡å’Œ ClusterIP æœåŠ¡ä¸Š.</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="786-externalname">7.8.6. ExternalName<a href="#786-externalname" class="hash-link" aria-label="7.8.6. ExternalNameçš„ç›´æ¥é“¾æ¥" title="7.8.6. ExternalNameçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>æ­¤ç±»å‹çš„ServiceèŠ‚ç‚¹ä¼šå°†æ‰€æœ‰æµé‡ç›´æ¥è½¬å‘åˆ°æŸä¸ªé¢„å®šä¹‰çš„å¤–éƒ¨æœåŠ¡ã€‚</p><blockquote><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨é›†ç¾¤å†…ä½¿ç”¨ExternalName Serviceç±»å‹ï¼Œå°†æŸä¸ªå¤–éƒ¨æœåŠ¡ä½œä¸ºé›†ç¾¤å†…éƒ¨æœåŠ¡çš„åˆ«åæ¥ä½¿ç”¨ï¼Œä½¿å¾—å†…éƒ¨æœåŠ¡ä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿å’Œç®€å•</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="787-æ‰‹åŠ¨ç«¯å£è½¬å‘">7.8.7. æ‰‹åŠ¨ç«¯å£è½¬å‘<a href="#787-æ‰‹åŠ¨ç«¯å£è½¬å‘" class="hash-link" aria-label="7.8.7. æ‰‹åŠ¨ç«¯å£è½¬å‘çš„ç›´æ¥é“¾æ¥" title="7.8.7. æ‰‹åŠ¨ç«¯å£è½¬å‘çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p><code>kubectl port-forward</code>, ç”¨äºä¸´æ—¶è°ƒè¯•</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="788-service-å¦‚ä½•å·¥ä½œ">7.8.8. service å¦‚ä½•å·¥ä½œ<a href="#788-service-å¦‚ä½•å·¥ä½œ" class="hash-link" aria-label="7.8.8. service å¦‚ä½•å·¥ä½œçš„ç›´æ¥é“¾æ¥" title="7.8.8. service å¦‚ä½•å·¥ä½œçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Pod é€šè¿‡ label é”®å€¼å¯¹ä¸ Service ä¸Šçš„ label selector ç›¸å…³è”ã€‚Service ä¼šè‡ªåŠ¨å‘ç°å¸¦æœ‰ä¸é€‰æ‹©å™¨åŒ¹é…çš„æ ‡ç­¾çš„æ–° Podã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="79-ingress">7.9. ingress<a href="#79-ingress" class="hash-link" aria-label="7.9. ingressçš„ç›´æ¥é“¾æ¥" title="7.9. ingressçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å¯ä¸º Service æä¾›å¤–éƒ¨å¯è®¿é—®çš„åŸŸåç»‘å®š(é»˜è®¤ç«¯å£ 80, é€šè¿‡åŸŸåè¿›è¡Œæµé‡è½¬å‘)ã€è´Ÿè½½å‡è¡¡ã€ SSL/TLS </p><blockquote><p>å’Œ Service åŒºåˆ«:
service æ¯•ç«Ÿåªæ˜¯å†…éƒ¨ä½¿ç”¨çš„è´Ÿè½½å‡è¡¡, æ— æ³•æä¾›ç»™å¤–ç•Œè®¿é—®; Service å·¥ä½œåœ¨ç½‘ç»œä¼ è¾“å±‚, åªèƒ½è¯†åˆ« ip å’Œç«¯å£æ¥å¤„ç†ç½‘ç»œæµé‡
ingress åˆ™ç”¨äºå°†å¤–éƒ¨ç½‘ç»œæµé‡è·¯ç”±åˆ°é€‚å½“çš„Serviceä¸Š; ingress å·¥ä½œåœ¨åº”ç”¨å±‚, èƒ½è¯†åˆ« httpåè®®, æ›´ç»†çš„è·¯ç”±æ§åˆ¶</p></blockquote><blockquote><p>ä¸ºä»€ä¹ˆéœ€è¦? - NodePortçš„æ–¹å¼æœ‰ä¸ªé—®é¢˜ï¼Œæ¯ä¸ª working node ç«¯å£65535ä¸ªï¼Œæ€»æœ‰ç”¨å®Œçš„æ—¶å€™ï¼Œè¦æ˜¯æš´éœ²çš„æœåŠ¡ç‰¹åˆ«å¤šï¼Œ65535å°±ä¸å¤Ÿç”¨äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯å¾—ä¸Šnginxè¿™æ ·çš„åå‘ä»£ç†ï¼Œå› æ­¤K8Sè¿˜æœ‰ä¸ªIngressçš„ä¸œè¥¿ã€‚é¿å…äº†å¯¹å¤–æš´éœ²é›†ç¾¤èŠ‚ç‚¹ç«¯å£</p></blockquote><p>å¯ä»¥æ ¹æ®åŸŸåã€è·¯å¾„æŠŠè¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„ Service, ç›¸å½“äº nginx</p><p>å¸¸ç”¨çš„å®ç°æ˜¯ nginx-ingress, kong-ingress, Traefik Ingress; k8s ä¹Ÿåªæ˜¯å®šä¹‰äº† ingress èµ„æºçš„å„ä¸ªå±æ€§ï¼Œingress èµ„æºçš„åˆ›å»ºéœ€è¦å€ŸåŠ© ingressControllerï¼ŒingressController åˆ™éœ€è¦æœ‰ç¬¬ä¸‰æ–¹æœåŠ¡æ¥æä¾›ã€‚</p><blockquote><p>åŸç†: Ingress Contronler é€šè¿‡ä¸ Kubernetes API äº¤äº’ï¼ŒåŠ¨æ€çš„å»æ„ŸçŸ¥é›†ç¾¤ä¸­ Ingress è§„åˆ™å˜åŒ–ï¼Œç„¶åè¯»å–å®ƒï¼ŒæŒ‰ç…§è‡ªå®šä¹‰çš„è§„åˆ™ï¼Œè§„åˆ™å°±æ˜¯å†™æ˜äº†å“ªä¸ªåŸŸåå¯¹åº”å“ªä¸ª serviceï¼Œç”Ÿæˆä¸€æ®µ Nginx é…ç½®ï¼Œå†å†™åˆ° Nginx-ingress-control çš„ Pod é‡Œï¼Œè¿™ä¸ª Ingress Contronler çš„ pod é‡Œé¢è¿è¡Œç€ä¸€ä¸ª nginx æœåŠ¡ï¼Œæ§åˆ¶å™¨ä¼šæŠŠç”Ÿæˆçš„ nginx é…ç½®å†™å…¥/etc/nginx.conf æ–‡ä»¶ä¸­ï¼Œç„¶å reload ä¸€ä¸‹ ä½¿ç”¨é…ç½®ç”Ÿæ•ˆã€‚ä»¥æ­¤æ¥è¾¾åˆ°åŸŸååˆ†é…ç½®åŠåŠ¨æ€æ›´æ–°çš„é—®é¢˜ã€‚</p></blockquote><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> networking.k8s.io/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># We are defining this annotation to prevent nginx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># from redirecting requests to `https` for now å…³é—­ https è¿æ¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">nginx.ingress.kubernetes.io/ssl-redirect</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;false&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">pathType</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Prefix</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">clusterip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  </span><span class="token key atrule">number</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">pathType</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Prefix</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">clusterip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  </span><span class="token key atrule">number</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ”¯æŒè¿™äº›å‘½ä»¤</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># create</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f ingress.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get ingress </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="791-install-ingress-nginx">7.9.1. install ingress-nginx<a href="#791-install-ingress-nginx" class="hash-link" aria-label="7.9.1. install ingress-nginxçš„ç›´æ¥é“¾æ¥" title="7.9.1. install ingress-nginxçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p><a href="https://docs.rancherdesktop.io/zh/how-to-guides/setup-NGINX-Ingress-Controller" target="_blank" rel="noopener noreferrer">https://docs.rancherdesktop.io/zh/how-to-guides/setup-NGINX-Ingress-Controller</a></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="792-traefik">7.9.2. Traefik<a href="#792-traefik" class="hash-link" aria-label="7.9.2. Traefikçš„ç›´æ¥é“¾æ¥" title="7.9.2. Traefikçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>todo Traefik</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="710-volume">7.10. volume<a href="#710-volume" class="hash-link" aria-label="7.10. volumeçš„ç›´æ¥é“¾æ¥" title="7.10. volumeçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å³åœ¨ pod ä¸­å¯è®¿é—®çš„æ–‡ä»¶ç›®å½•, ç”¨æ¥å­˜å‚¨å¤§æ•°æ®é‡çš„å†…å®¹</p><p>æ¯ä¸ª Pod ä¸­å£°æ˜çš„å­˜å‚¨å·ç”± Pod ä¸­çš„æ‰€æœ‰å®¹å™¨å…±äº«</p><blockquote><p>å¯è¢«æŒ‚è½½åˆ° pod ä¸­çš„ä¸€ä¸ª/å¤šä¸ª container çš„æŒ‡å®šè·¯å¾„ ä¸‹</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="711-secret">7.11. secret<a href="#711-secret" class="hash-link" aria-label="7.11. secretçš„ç›´æ¥é“¾æ¥" title="7.11. secretçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Secret æ˜¯ç”¨æ¥ä¿å­˜å’Œä¼ é€’å¯†ç </p><blockquote><p>å¥½å¤„æ˜¯å¯ä»¥é¿å…æŠŠæ•æ„Ÿä¿¡æ¯æ˜æ–‡å†™åœ¨é…ç½®æ–‡ä»¶é‡Œ</p></blockquote><p>Secret çš„èµ„æºå®šä¹‰å’Œ ConfigMap ç»“æ„åŸºæœ¬ä¸€è‡´ï¼Œå”¯ä¸€åŒºåˆ«åœ¨äº kind æ˜¯ Secretï¼Œè¿˜æœ‰ Value éœ€è¦ Base64 ç¼–ç </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">echo &quot;db_password&quot; | base64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ZGJfcGFzc3dvcmQK</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">echo &quot;ZGJfcGFzc3dvcmQK&quot; | base64 -d</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># db_password</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>for example:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># hellok8s-secret.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">DB_PASSWORD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;ZGJfcGFzc3dvcmQK&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä»ä¸­æŸ¥è¯¢ä¿¡æ¯:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl get secret my-mongo-mongodb -o json</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get secret my-mongo-mongodb -o yaml &gt; secret.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="712-config-map">7.12. config map<a href="#712-config-map" class="hash-link" aria-label="7.12. config mapçš„ç›´æ¥é“¾æ¥" title="7.12. config mapçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å°†éæœºå¯†æ€§çš„æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­</p><blockquote><p>ç”¨dockerçš„æ—¶å€™æœ‰ä¸€ä¸ªvolumeå¯ä»¥æŠŠå®¿ä¸»æœºçš„å­˜å‚¨æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œåœ¨k8sé‡Œä¹Ÿå·®ä¸å¤šï¼Œä½†æ˜¯æœ‰ä¸¤ç§åœºæ™¯:</p><p>æŒ‚è½½é…ç½®æ–‡ä»¶. åœ¨ docker é‡Œç»™åº”ç”¨è¿›è¡Œé…ç½®, å¯ä»¥ä½¿ç”¨ envç¯å¢ƒå˜é‡ä¼ åˆ°å®¹å™¨é‡Œ. è¿˜æœ‰ä¸€ç§æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨é‡Œé¢ã€‚ç”¨ç¯å¢ƒå˜é‡çš„æ–¹å¼è¿˜å¥½è¯´ï¼Œk8sä¹Ÿæä¾›äº†envå˜é‡ï¼Œä½†æ˜¯é…ç½®å¤šäº†envç®¡ç†èµ·æ¥ä¸æ–¹ä¾¿ï¼Œè¿˜æ˜¯é…ç½®æ–‡ä»¶å¥½ã€‚
ä½†æ˜¯k8sæœ‰çš„æœåŠ¡Podå¯èƒ½éƒ¨ç½²åœ¨å¤šå°æœºå™¨, æ‰€ä»¥ configMap å‡ºç°äº†, å¯ä»¥å’Œ å¾®æœåŠ¡çš„é…ç½®ä¸­å¿ƒç±»æ¯” (è¿™ä¸¤è€…çš„åŒºåˆ«åœ¨äºConfigMapæ˜¯ç›´æ¥æŠŠä¸­å¿ƒåŒ–çš„é…ç½®æ˜ å°„åˆ°å„ä¸ªå®¹å™¨å†…ï¼Œè®©å®¹å™¨å†…çš„åº”ç”¨æ„Ÿè§‰åƒæ˜¯è¯»æœ¬åœ°çš„æ–‡ä»¶ä¸€æ ·ï¼Œè€Œé…ç½®ä¸­å¿ƒæ˜¯éœ€è¦åº”ç”¨å±‚æä¸€ä¸ªå®¢æˆ·ç«¯ä¸é…ç½®ä¸­å¿ƒé€šä¿¡æ‹‰å–é…ç½®ç»™SpringCloudç”¨)</p><p>æŒ‚è½½æ•°æ®å­˜å‚¨, è¿™ä¸ªè¯·çœ‹æ•°æ®æŒä¹…åŒ–</p></blockquote><p>ConfigMap åœ¨è®¾è®¡ä¸Šä¸æ˜¯ç”¨æ¥ä¿å­˜å¤§é‡æ•°æ®çš„ã€‚åœ¨ ConfigMap ä¸­ä¿å­˜çš„æ•°æ®ä¸å¯è¶…è¿‡ 1 MiBã€‚å¦‚æœä½ éœ€è¦ä¿å­˜è¶…å‡ºæ­¤å°ºå¯¸é™åˆ¶çš„æ•°æ®ï¼Œä½ å¯èƒ½è€ƒè™‘æŒ‚è½½å­˜å‚¨å·ã€‚</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># hellok8s-config-dev.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">DB_URL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;http://DB_ADDRESS_DEV&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># hellok8s-config-test.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">DB_URL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;http://DB_ADDRESS_TEST&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åˆ†åˆ«åœ¨ dev test ä¸¤ä¸ª namespace ä¸‹åˆ›å»ºç›¸åŒçš„ ConfigMapï¼Œåå­—éƒ½å« hellok8s-configï¼Œä½†æ˜¯å­˜æ”¾çš„ Pair å¯¹ä¸­ Value å€¼ä¸ä¸€æ ·</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f hellok8s-config-dev.yaml -n dev</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f hellok8s-config-test.yaml -n test </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check list in all ns</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get configmap --all-namespaces</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨ pod éƒ¨ç½²ä¸­ä½¿ç”¨ configMap</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> guangzhengli/hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># used to declare an env var</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> DB_URL   </span><span class="token comment" style="color:rgb(0, 128, 0)"># the value have to consist with code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token comment" style="color:rgb(0, 128, 0)"># specify that getting db_url from the specified config map</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">valueFrom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">configMapKeyRef</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token comment" style="color:rgb(0, 128, 0)"># config map çš„name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> DB_URL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="713-flannel">7.13. flannel<a href="#713-flannel" class="hash-link" aria-label="7.13. flannelçš„ç›´æ¥é“¾æ¥" title="7.13. flannelçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æ˜¯ CoreOS å›¢é˜Ÿé’ˆå¯¹ Kubernetes è®¾è®¡çš„ä¸€ä¸ªç½‘ç»œè§„åˆ’æœåŠ¡, ç®€å•æ¥è¯´, å®ƒçš„åŠŸèƒ½æ˜¯è®©é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸»æœºåˆ›å»ºçš„ Docker å®¹å™¨éƒ½å…·æœ‰å…¨é›†ç¾¤å”¯ä¸€çš„è™šæ‹Ÿ IP åœ°å€, è®©å±äºä¸åŒèŠ‚ç‚¹ä¸Šçš„å®¹å™¨èƒ½å¤Ÿç›´æ¥é€šè¿‡å†…ç½‘ IP äº’é€š</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="714-name">7.14. name<a href="#714-name" class="hash-link" aria-label="7.14. nameçš„ç›´æ¥é“¾æ¥" title="7.14. nameçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ç”±äº K8S å†…éƒ¨,ä½¿ç”¨â€œèµ„æºâ€æ¥å®šä¹‰æ¯ä¸€ç§é€»è¾‘æ¦‚å¿µ(åŠŸèƒ½)æ•…æ¯ç§&quot;èµ„æºâ€, éƒ½åº”è¯¥æœ‰è‡ªå·±çš„&quot;åç§°â€</p><p>&quot;èµ„æºâ€æœ‰ api ç‰ˆæœ¬( apiVersion )ç±»åˆ«( kind )ã€å…ƒæ•°æ®( metadata)ã€å®šä¹‰æ¸…å•( spec)ã€çŠ¶æ€( status )ç­‰é…ç½®ä¿¡æ¯</p><p>&quot;åç§°â€é€šå¸¸å®šä¹‰åœ¨&quot;èµ„æºâ€çš„&quot;å…ƒæ•°æ®â€ä¿¡æ¯é‡Œ</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="715-name-namespace-ç”¨æ¥åˆ’åˆ†å¤šç¯å¢ƒ">7.15. name namespace (ç”¨æ¥åˆ’åˆ†å¤šç¯å¢ƒ)<a href="#715-name-namespace-ç”¨æ¥åˆ’åˆ†å¤šç¯å¢ƒ" class="hash-link" aria-label="7.15. name namespace (ç”¨æ¥åˆ’åˆ†å¤šç¯å¢ƒ)çš„ç›´æ¥é“¾æ¥" title="7.15. name namespace (ç”¨æ¥åˆ’åˆ†å¤šç¯å¢ƒ)çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å¯ä»¥ä½¿ç”¨ namespace åˆ’åˆ†å‡ºå¤šä¸ªâ€œè™šæ‹Ÿé›†ç¾¤â€ï¼Œè¿™äº› ns ä¹‹é—´å¯ä»¥å®Œå…¨éš”ç¦», ä¾‹å¦‚ dev ç¯å¢ƒç»™å¼€å‘ä½¿ç”¨ï¼Œtest ç¯å¢ƒç»™ QA ä½¿ç”¨</p><blockquote><p>ä¹Ÿå¯ä»¥è·¨ nsï¼Œè®©ä¸€ä¸ª ns ä¸­çš„ service è®¿é—®åˆ°å…¶ä»– ns çš„æœåŠ¡</p><p> åå­—ç©ºé—´ä½œç”¨åŸŸä»…é’ˆå¯¹å¸¦æœ‰åå­—ç©ºé—´çš„å¯¹è±¡ï¼Œä¾‹å¦‚ Deploymentã€Service ç­‰ã€‚</p></blockquote><p>namespace: isolate all all kinds of resources. resources of the same kind cannot have the same name in the same namespace</p><p>default initialized namespaces: default, kube-system, kube-public</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Namespace</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> dev</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Namespace</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># create</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f namespaces.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get namespaces          </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># specify the namespace when creating resources</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f deployment.yaml -n dev</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check pods in specified ns</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pods -n dev</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ›å»ºå‘½åç©ºé—´</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl create namespace testapp</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ‡æ¢å‘½åç©ºé—´</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubens kube-system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å›åˆ°ä¸Šä¸ªå‘½åç©ºé—´</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubens -</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ‡æ¢é›†ç¾¤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectx minikube</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8-åƒåœ¾å›æ”¶">8. åƒåœ¾å›æ”¶<a href="#8-åƒåœ¾å›æ”¶" class="hash-link" aria-label="8. åƒåœ¾å›æ”¶çš„ç›´æ¥é“¾æ¥" title="8. åƒåœ¾å›æ”¶çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="81-çº§è”åˆ é™¤">8.1. çº§è”åˆ é™¤<a href="#81-çº§è”åˆ é™¤" class="hash-link" aria-label="8.1. çº§è”åˆ é™¤çš„ç›´æ¥é“¾æ¥" title="8.1. çº§è”åˆ é™¤çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æ‰€æœ‰è€…åˆ é™¤ï¼Œä»å±å¯¹è±¡ä¹Ÿè¢«åˆ é™¤ï¼›</p><p>åˆ†ä¸ºå‰å°çº§è”åˆ é™¤ Foreground å’Œåå°çº§è”åˆ é™¤ Background æ¨¡å¼ï¼›</p><ul><li><p>Foreground å‰å°çº§è”åˆ é™¤ï¼šæ‰€æœ‰ä»å±å¯¹è±¡åˆ é™¤å®Œæ¯•ååˆ é™¤æ‰€æœ‰è€…å¯¹è±¡ï¼›å½“æ‰€æœ‰è€…åˆ é™¤æ—¶ä¼šè¿›å…¥â€œæ­£åœ¨åˆ é™¤â€çŠ¶æ€ï¼Œä»å¯ä»¥é€šè¿‡ RestApi æŸ¥è¯¢åˆ°å½“å‰å¯¹è±¡ï¼›</p></li><li><p>Background åå°çº§è”åˆ é™¤ï¼š ç«‹å³åˆ é™¤æ‰€æœ‰è€…çš„å¯¹è±¡ï¼Œå¹¶ç”±åƒåœ¾å›æ”¶å™¨åœ¨åå°åˆ é™¤å…¶ä»å±å¯¹è±¡ ï¼› ä¸ç”¨ç­‰å¾…åˆ é™¤ä»å±å¯¹è±¡çš„æ—¶é—´ï¼›</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="82-å­¤å„¿åˆ é™¤-orphan">8.2. å­¤å„¿åˆ é™¤ orphan<a href="#82-å­¤å„¿åˆ é™¤-orphan" class="hash-link" aria-label="8.2. å­¤å„¿åˆ é™¤ orphançš„ç›´æ¥é“¾æ¥" title="8.2. å­¤å„¿åˆ é™¤ orphançš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æ‰€æœ‰è€…åˆ é™¤ï¼Œä»å±å¯¹è±¡å˜æˆå­¤å„¿</p><blockquote><p>ç›´æ¥åˆ é™¤æ‰€æœ‰è€…å¯¹è±¡ï¼Œå¹¶å°†ä»å±å¯¹è±¡ä¸­çš„ ownerReference å…ƒæ•°æ®è®¾ç½®ä¸ºé»˜è®¤å€¼ã€‚ä¹‹ååƒåœ¾å›æ”¶å™¨ä¼šç¡®å®šå­¤å„¿å¯¹è±¡å¹¶å°†å…¶åˆ é™¤ï¼›</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="9-èµ„æºæè¿°æ–‡ä»¶">9. èµ„æºæè¿°æ–‡ä»¶<a href="#9-èµ„æºæè¿°æ–‡ä»¶" class="hash-link" aria-label="9. èµ„æºæè¿°æ–‡ä»¶çš„ç›´æ¥é“¾æ¥" title="9. èµ„æºæè¿°æ–‡ä»¶çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="91-æŸ¥çœ‹å±æ€§è¯´æ˜">9.1. æŸ¥çœ‹å±æ€§è¯´æ˜<a href="#91-æŸ¥çœ‹å±æ€§è¯´æ˜" class="hash-link" aria-label="9.1. æŸ¥çœ‹å±æ€§è¯´æ˜çš„ç›´æ¥é“¾æ¥" title="9.1. æŸ¥çœ‹å±æ€§è¯´æ˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å¦‚ å½“å‰ k8s æ”¯æŒçš„ apiVersion ...</p><p><code>kc explain deployment</code> , <code>kc explain deployment.spec.template.spec</code></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="92-é€šè¿‡å‘½ä»¤ç”Ÿæˆ-yml">9.2. é€šè¿‡å‘½ä»¤ç”Ÿæˆ yml<a href="#92-é€šè¿‡å‘½ä»¤ç”Ÿæˆ-yml" class="hash-link" aria-label="9.2. é€šè¿‡å‘½ä»¤ç”Ÿæˆ ymlçš„ç›´æ¥é“¾æ¥" title="9.2. é€šè¿‡å‘½ä»¤ç”Ÿæˆ ymlçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl create deployment tomcat6 --image=tomcat:6.0.53-jre8 --dry-run -o yaml &gt; tomcat6.yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f xxx.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="93-pod-çš„-yaml-æè¿°æ–‡ä»¶">9.3. pod çš„ yaml æè¿°æ–‡ä»¶<a href="#93-pod-çš„-yaml-æè¿°æ–‡ä»¶" class="hash-link" aria-label="9.3. pod çš„ yaml æè¿°æ–‡ä»¶çš„ç›´æ¥é“¾æ¥" title="9.3. pod çš„ yaml æè¿°æ–‡ä»¶çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1 </span><span class="token comment" style="color:rgb(0, 128, 0)">#(k8s api server version)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Deploymentã€Jobã€Ingressã€Service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Pod </span><span class="token comment" style="color:rgb(0, 128, 0)">#(å¯¹è±¡ç±»å‹)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#åŒ…æ‹¬åç§°ã€å‘½åç©ºé—´ã€æ ‡ç­¾å’Œå…³äºè¯¥å®¹å™¨çš„å…¶ä»–ä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">manual</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># optional, default ns: default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">xxx_key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">yyy_key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> yyy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># åŒ…æ‹¬ä¸€äº›containerï¼Œstorageï¼Œvolume, æ¢é’ˆ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">containerPost</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># å®¹å™¨ä¼šç›‘å¬çš„ç«¯å£, ä»…ä»…æ˜¯å±•ç¤º, æ²¡æœ‰ æŒ‡å®šä½œç”¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">protocal</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 100m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 100Mi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># å­˜æ´»æ¢é’ˆï¼Œ ç”¨äº pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># åœ¨ç”Ÿäº§ä¸­ è¿è¡Œçš„pod, ä¸€å®š è¦å®šä¹‰ ä¸€ ä¸ªå­˜ æ´»æ¢é’ˆ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">livenessProbe</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">httpGet</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¦‚æœæ²¡æœ‰è®¾ç½®åˆå§‹å»¶è¿Ÿï¼Œæ¢é’ˆå°†åœ¨å¯åŠ¨æ—¶ç«‹å³å¼€å§‹æ¢æµ‹å®¹å™¨ï¼Œ è¿™é€šå¸¸ä¼šå¯¼è‡´æ¢æµ‹å¤±è´¥ï¼Œ å› ä¸ºåº”ç”¨ç¨‹åºè¿˜æ²¡å‡†å¤‡å¥½å¼€å§‹æ¥æ”¶è¯·æ±‚ã€‚ å¦‚æœå¤±è´¥æ¬¡æ•°è¶…è¿‡é˜…å€¼ï¼Œåœ¨åº”ç”¨ç¨‹åºèƒ½æ­£ç¡®å“åº”è¯·æ±‚ä¹‹å‰ï¼Œ å®¹å™¨å°±ä¼šé‡å¯ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">initialDelaySeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># åœ¨ç¬¬ä¸€æ¬¡æ¢æµ‹å‰ï¼Œ ç­‰å¾… 15s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">delay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># ç¤ºåœ¨å®¹å™¨å¯åŠ¨åç«‹å³å¼€å§‹æ¢æµ‹ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># å®¹å™¨å¿…é¡»åœ¨1ç§’å†…è¿›è¡Œå“åº”ï¼Œ ä¸ç„¶è¿™æ¬¡æ¢æµ‹è®°ä½œå¤±è´¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">period</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># æ¯10ç§’æ¢æµ‹ä¸€æ¬¡å®¹å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">failure</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># æ¢æµ‹è¿ç»­ä¸‰æ¬¡å¤±è´¥(#faè¾½ure= 3)åé‡å¯å®¹å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">status</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#åŒ…å«è¿è¡Œä¸­çš„ po çš„å½“å‰ä¿¡æ¯ï¼Œä¾‹å¦‚ po æ‰€å¤„çš„æ¡ä»¶ æ¯ä¸ªå®¹å™¨çš„æè¿°å’ŒçŠ¶æ€ï¼Œä»¥åŠå†…éƒ¨ IP å’Œå…¶ä»–åŸºæœ¬ä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="94-deployment-çš„æè¿°æ–‡ä»¶">9.4. deployment çš„æè¿°æ–‡ä»¶<a href="#94-deployment-çš„æè¿°æ–‡ä»¶" class="hash-link" aria-label="9.4. deployment çš„æè¿°æ–‡ä»¶çš„ç›´æ¥é“¾æ¥" title="9.4. deployment çš„æè¿°æ–‡ä»¶çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">## optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">gpu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;true&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#ä½¿ç”¨ æ ‡ç­¾é€‰æ‹©å™¨ä½¿å¾— pod åªè¢«è°ƒåº¦åˆ°ç¬¦åˆè¦æ±‚çš„ worker node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># select pods that will be affected by this deployment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># have to match labels that specified in template.metadata.labels</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># tells deployment to run 2 pods matching the template</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># define pods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="95-service">9.5. service<a href="#95-service" class="hash-link" aria-label="9.5. serviceçš„ç›´æ¥é“¾æ¥" title="9.5. serviceçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> LoadBalancer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="10-æ³¨è§£">10. æ³¨è§£<a href="#10-æ³¨è§£" class="hash-link" aria-label="10. æ³¨è§£çš„ç›´æ¥é“¾æ¥" title="10. æ³¨è§£çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æ³¨è§£: TODO</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11-å‘½åç©ºé—´">11. å‘½åç©ºé—´<a href="#11-å‘½åç©ºé—´" class="hash-link" aria-label="11. å‘½åç©ºé—´çš„ç›´æ¥é“¾æ¥" title="11. å‘½åç©ºé—´çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>K8S namespace: ä¸º å¯¹è±¡èµ„æºæä¾›äº†ä¸€ä¸ªä½œç”¨åŸŸ, åœ¨ä¸åŒçš„ ä½œç”¨åŸŸä¸­å¯ä»¥ä½¿ç”¨ç›¸åŒçš„èµ„æºåï¼Œ ä½†è¿™ç›¸åŒçš„èµ„æºåä»£è¡¨äº†ä¸åŒçš„èµ„æºã€‚ ç±»æ¯” java package</p><ul><li><p>é€šè¿‡ label å¯¹ pod è¿›è¡Œåˆ†ç»„, æ¯ä¸ª ç»„ å¯èƒ½æœ‰ pod é‡å , é€šè¿‡ k8s namespace åˆ†ç»„å¯ä»¥å®Œå…¨é¿å…é‡å </p></li><li><p>ns åªéš”ç¦»èµ„æºï¼Œ ä¸éš”ç¦»è¿è¡Œçš„å¯¹è±¡ ï¼ˆèµ„æºå®ä¾‹ï¼‰ï¼Œ å¦‚ ä¸åŒ ns ä¸­çš„ pod ä»ç„¶å¯é€šä¿¡</p></li><li><p>é€‚ç”¨äºå¤šç”¨æˆ· ä½¿ç”¨ k8sï¼Œ é™åˆ¶æŸä¸ªç”¨æˆ·çš„èµ„æºä½¿ç”¨é‡</p></li></ul><p>ä» ymal æ–‡ä»¶åˆ›å»º nsï¼š</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Namespace</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> custome</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ns</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>kubectl create -f custom-ns.yaml</code></p><p>é€šè¿‡å‘½ä»¤åˆ›å»º nsï¼š <code>kubectl create namespace custom-namespace</code></p><p>åˆ‡æ¢ nsï¼š <code>kubectl config set-context $(kubectl config current-context) --namespace &lt;other ns&gt;</code></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12-pod-ç®¡ç†">12. pod ç®¡ç†<a href="#12-pod-ç®¡ç†" class="hash-link" aria-label="12. pod ç®¡ç†çš„ç›´æ¥é“¾æ¥" title="12. pod ç®¡ç†çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="121-æ¢æµ‹-pod-æ˜¯å¦å¥åº·">12.1. æ¢æµ‹ pod æ˜¯å¦å¥åº·<a href="#121-æ¢æµ‹-pod-æ˜¯å¦å¥åº·" class="hash-link" aria-label="12.1. æ¢æµ‹ pod æ˜¯å¦å¥åº·çš„ç›´æ¥é“¾æ¥" title="12.1. æ¢æµ‹ pod æ˜¯å¦å¥åº·çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>k8s ä¼šä¿æŒ pod å§‹ç»ˆæ­£å¸¸è¿è¡Œï¼Œ å¦‚æœå®¹å™¨çš„ä¸»è¿›ç¨‹å´©æºƒï¼Œ Kubelet å°†é‡å¯å®¹å™¨ã€‚ å½“å®¹å™¨è¢«å¼ºè¡Œç»ˆæ­¢æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„å®¹å™¨â€”-è€Œä¸æ˜¯é‡å¯åŸæ¥çš„å®¹å™¨</p><p>ä½†æ˜¯ è¿›ç¨‹æ²¡æœ‰å´©æºƒï¼Œ æœ‰æ—¶åº”ç”¨ç¨‹åºä¹Ÿä¼šåœæ­¢æ­£å¸¸å·¥ä½œã€‚ ä¾‹å¦‚ï¼Œ å…·æœ‰å†…å­˜æ³„æ¼çš„ Java åº”ç”¨ç¨‹åºå°†å¼€å§‹æŠ›å‡º OutOfMemoryErrors, ä½† JVM è¿›ç¨‹ä¼šä¸€ç›´è¿è¡Œ</p><ul><li><p>æ–¹æ³• 1: ä» app å†…éƒ¨è‡ªå·±æ£€æµ‹, å¯ä»¥åœ¨åº”ç”¨ä¸­æ•è·è¿™ç±»é”™è¯¯ï¼Œ å¹¶åœ¨é”™è¯¯å‘ç”Ÿæ—¶é€€å‡ºè¯¥è¿›ç¨‹ã€‚</p><p>å­˜åœ¨é—®é¢˜: åº”ç”¨å› ä¸ºæ— é™å¾ªç¯æˆ–æ­»é”è€Œåœæ­¢å“åº”, è¿™ä¸ªæ–¹æ³•å°±æ— æ•ˆäº†</p></li><li><p>æ–¹æ³• 2: é¡»ä»å¤–éƒ¨æ£€æŸ¥åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µ</p><ul><li><p>å­˜æ´»æ¢é’ˆ (liveness probe) - æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿˜åœ¨è¿è¡Œ</p><ul><li><p>HTTP GET æ¢é’ˆ, è¿”å› 2xx, 3xx åˆ™ä»£è¡¨æ­£å¸¸, ä¸é‡å¯</p></li><li><p>TCP å¥—æ¥å­—æ¢é’ˆ, å’Œ pod æ­£å¸¸å»ºç«‹ é“¾æ¥, æ­£å¸¸, ä¸é‡å¯</p></li><li><p>Exec æ¢é’ˆ , è¿›å…¥ pod æŸä¸ª container, æ‰§è¡Œä»»æ„å‘½ä»¤, å¹¶æ£€æŸ¥å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ç ã€‚å¦‚æœçŠ¶æ€ç æ˜¯ 0, åˆ™æ¢æµ‹æˆåŠŸ</p></li></ul></li></ul></li></ul><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> custome</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">livenessProbe</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">httpGet</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="122-pod-å‰¯æœ¬">12.2. pod å‰¯æœ¬<a href="#122-pod-å‰¯æœ¬" class="hash-link" aria-label="12.2. pod å‰¯æœ¬çš„ç›´æ¥é“¾æ¥" title="12.2. pod å‰¯æœ¬çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ReplicationController æ˜¯ä¸€ç§ Kubernetes èµ„æºï¼Œè´Ÿè´£åˆ›å»ºå’Œç®¡ç† pod å‰¯æœ¬</p><p>è¢« ReplicationController åˆ›å»ºçš„ pod ä¸º â€œæ‰˜ç®¡ podâ€ï¼Œ ç›´æ¥åˆ›å»ºçš„ pod ä¸º â€œéæ‰˜ç®¡ podâ€ã€‚æ‰˜ç®¡ pod å¼‚å¸¸é€€å‡º ï¼ˆå¦‚ worker node å´©æºƒï¼Œ æˆ– è¯¥ pod å´©æºƒï¼‰åï¼Œ ReplicationController ä¼š åˆ›å»ºæ–°çš„ pod ä»£æ›¿</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Replicationcontroller</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># å®šä¹‰ReplicationControlleræ—¶ä¸è¦æŒ‡å®š é€‰æ‹©å™¨ï¼Œè®©Kubemetesä»podæ¨¡æ¿ä¸­æå–å®ƒã€‚è¿™æ ·YAMLæ›´ç®€çŸ­ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># rc åˆ›å»ºåï¼Œ label selector ä¸ä¼šå†æ›´æ”¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># ä¸€èˆ¬åˆ›å»ºåä¼šæ›´æ”¹ template</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># åˆ›å»ºæ–° pod æ‰€ç”¨çš„ æ¨¡æ¿</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># è¿™é‡Œçš„ æ ‡ç­¾å¿…é¡»å’Œ å‰é¢çš„ æ ‡ç­¾é€‰æ‹©å™¨ åŒ¹é…ï¼Œ å¦åˆ™å°†æ— ä¼‘æ­¢åœ°åˆ›å»ºæ–°çš„å®¹å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> luksa/kubia</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                      </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>kubectl create -f kubia-rc.yaml</p><p>rc åˆ›å»ºåï¼Œç”±äºæ²¡æœ‰ä»»ä½• pod æœ‰ app=kubia æ ‡ç­¾ï¼Œ ReplicationController ä¼šæ ¹æ® pod æ¨¡æ¿å¯åŠ¨ä¸‰ä¸ªæ–°çš„ pod</p><p>ç”± ReplicationController åˆ›å»ºçš„ pod å¹¶ä¸æ˜¯ç»‘å®šåˆ° ReplicationControllerã€‚ åœ¨ä»»ä½•æ—¶åˆ»ï¼Œ ReplicationController ç®¡ç†ä¸æ ‡ç­¾é€‰æ‹©å™¨åŒ¹é…çš„ podã€‚ é€š è¿‡æ›´æ”¹ pod çš„æ ‡ç­¾ï¼Œ å¯ä»¥å°†å®ƒ ä» ReplicationController çš„ä½œç”¨åŸŸä¸­æ·»åŠ æˆ–åˆ é™¤</p><p>å°½ç®¡ä¸€ä¸ª pod æ²¡æœ‰ç»‘å®šåˆ°ä¸€ä¸ª ReplicationController ï¼Œä½† pod åœ¨ metadata.ownerReferences ä¸­å¼•ç”¨å®ƒ ä»¥è½»æ¾ä½¿ç”¨å®ƒ æ¥æ‰¾åˆ°ä¸€ pod çš„ Replication controller</p><p>å‡çº§ pod å¯ä»¥è¿™ä¹ˆåšï¼šç¼–è¾‘ rc çš„ template åï¼Œ åˆ é™¤ æ‰€æœ‰è¦å‡çº§çš„ podï¼Œ rc ä¼šè‡ªåŠ¨åˆ›å»ºå‡çº§åçš„ pod</p><p>================æ°´å¹³ç¼©æ‰©å®¹ï¼š</p><p>æ–¹æ³• 1ï¼š<code>kubectl scale re kubia --replicas=3 </code></p><p>æ–¹æ³• 2ï¼š<code>kubectl edit re kubia</code> æ›´æ–° <code>spec.replicas</code> å€¼</p><p>======================æ–°çš„æ›¿ä»£è€… ReplicaSet</p><p>ReplicaSetï¼šReplicaSet çš„è¡Œä¸ºä¸ ReplicationController å®Œå…¨ç›¸åŒï¼Œ ä½†æ ‡ç­¾é€‰æ‹©å™¨çš„è¡¨è¾¾èƒ½åŠ›æ›´å¼ºã€‚</p><ul><li>å•ä¸ª rc æ— æ³•å°† pod ä¸ ï¼ˆ label env=prod å’Œ env=dev ï¼‰ åŒæ—¶åŒ¹é…ï¼Œå®ƒåªèƒ½åŒ¹é…å¸¦æœ‰ env=devel æ ‡ç­¾çš„ pod æˆ–å¸¦æœ‰ env=dev æ ‡ç­¾çš„ pod</li><li>rs å¯ä»¥ä»…ä»…æ ¹æ® æ˜¯å¦æœ‰ label key å­˜åœ¨ æ¥åŒ¹é…</li></ul><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1beta2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ReplicaSet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># æŒ‡å®šäº†å¤šä¸ªè¡¨è¾¾å¼ï¼Œåˆ™æ‰€æœ‰è¿™äº›è¡¨è¾¾å¼éƒ½å¿…é¡»ä¸ºtrueæ‰èƒ½ä½¿é€‰æ‹©å™¨ä¸</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># podåŒ¹é…ã€‚å¦‚æœåŒæ—¶æŒ‡å®šmatchLabelså’ŒmatchExpressions, åˆ™æ‰€æœ‰æ ‡ç­¾éƒ½</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¿…é¡»åŒ¹é…ï¼Œå¹¶ä¸”æ‰€æœ‰è¡¨è¾¾å¼å¿…é¡»è®¡ç®—ä¸ºtrueä»¥ä½¿è¯¥podä¸é€‰æ‹©å™¨åŒ¹é…</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">hah</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hoo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">matchExpressions</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hah </span><span class="token comment" style="color:rgb(0, 128, 0)"># è¦æ±‚ pod åŒ…å« key ä¸º hah çš„ label</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token comment" style="color:rgb(0, 128, 0)"># è¦æ±‚ label å€¼ä¸º hoo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token comment" style="color:rgb(0, 128, 0)"># operator å¯é€‰ In (label å€¼éœ€è¦åŒ¹é… value ä¸­çš„ä¸€ä¸ª), NotIn ï¼ˆlabel å€¼éœ€è¦ä¸åœ¨ values ä¸­ï¼‰ï¼ŒExists ï¼ˆlabel å¿…é¡»æœ‰æŒ‡å®š keyï¼Œä¸æŒ‡å®š valuesï¼‰</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token comment" style="color:rgb(0, 128, 0)"># DoesNotExist ï¼ˆpodä¸å¾—åŒ…å«æœ‰æŒ‡å®šåç§°çš„æ ‡ç­¾ã€‚valueså±æ€§ä¸å¾—æŒ‡å®šï¼‰</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">operator</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> In</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">values</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> hoo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># åˆ›å»ºæ–° pod æ‰€ç”¨çš„ æ¨¡æ¿</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># è¿™é‡Œçš„ æ ‡ç­¾å¿…é¡»å’Œ å‰é¢çš„ æ ‡ç­¾é€‰æ‹©å™¨ åŒ¹é…ï¼Œ å¦åˆ™å°†æ— ä¼‘æ­¢åœ°åˆ›å»ºæ–°çš„å®¹å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">hah</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hoo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> luksa/kubia</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                      </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>================ DaemonSet åœ¨æ¯ä¸ª worker node ä¸Šéƒ¨ç½²ä¸€ä¸ª pod</p><p>ç”¨æ¥è¿è¡Œç³»ç»ŸæœåŠ¡ï¼Œå¦‚ kube-proxy</p><p>DaemonSet ç®¡ç†ä¸‹çš„ pod ä¸æ˜¯éšæœºåˆ†å¸ƒåœ¨ worker node ä¸Šï¼Œ è€Œæ˜¯ä¿è¯ æ¯ä¸ª node åªå­˜åœ¨ä¸€ä¸ª podã€‚</p><p>è‹¥ node ä¸‹çº¿ï¼Œ DaemonSet ä¸ä¼šåœ¨å…¶ä»–åœ°æ–¹åˆ›å»ºæ–°çš„ podï¼Œ ä½†æ˜¯å½“æŸä¸ª node çš„ pod è¢«æ„å¤–åˆ é™¤ï¼Œä¼šé‡æ–°åˆ›å»ºæ–°çš„ pod ä»£æ›¿</p><p>ä½†æ˜¯ å½“æ–°çš„ node æ·»åŠ è¿› é›†ç¾¤ï¼Œ DaemonSet ä¼šç«‹å³éƒ¨ç½²ä¸€ä¸ªæ–° pod åˆ°è¿™ä¸ª nodeã€‚</p><p>é€šè¿‡ <code>spec.nodeSelector</code> (èŠ‚ç‚¹é€‰æ‹©å™¨ï¼ŒåŸç†æ˜¯ç»™ node æ‰“æ ‡ç­¾) åªåœ¨ç‰¹å®š node éƒ¨ç½² pod</p><p>======================= Deployment ======= æ›´åŠ æ–¹ä¾¿çš„ç®¡ç† Replica Set</p><p>Deployment é¢å¤–çš„ç‰¹æ€§ï¼š</p><ul><li><p>äº‹ä»¶ï¼ŒçŠ¶æ€æŸ¥çœ‹ï¼šå¯ä»¥æŸ¥çœ‹ Deployment çš„å‡çº§è¯¦ç»†è¿›åº¦å’ŒçŠ¶æ€</p></li><li><p>å›æ»šï¼šå½“å‡çº§ pod é•œåƒæˆ–è€…ç›¸å…³å‚æ•°çš„æ—¶å€™å‘ç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å›æ»šæ“ä½œå›æ»šåˆ°ä¸Šä¸€ä¸ªç¨³å®šçš„ç‰ˆæœ¬æˆ–è€…æŒ‡å®šçš„ç‰ˆæœ¬</p></li><li><p>ç‰ˆæœ¬è®°å½•: æ¯ä¸€æ¬¡å¯¹ Deployment çš„æ“ä½œï¼Œéƒ½èƒ½ä¿å­˜ä¸‹æ¥ï¼Œç»™äºˆåç»­å¯èƒ½çš„å›æ»šä½¿ç”¨</p></li><li><p>æš‚åœå’Œå¯åŠ¨ï¼šå¯¹äºæ¯ä¸€æ¬¡å‡çº§ï¼Œéƒ½èƒ½å¤Ÿéšæ—¶æš‚åœå’Œå¯åŠ¨</p></li><li><p>å¤šç§å‡çº§æ–¹æ¡ˆï¼š</p><p>Recreateï¼šåˆ é™¤æ‰€æœ‰å·²å­˜åœ¨çš„ pod,é‡æ–°åˆ›å»ºæ–°çš„;</p><p>RollingUpdateï¼šæ»šåŠ¨å‡çº§ï¼Œé€æ­¥æ›¿æ¢çš„ç­–ç•¥ï¼ŒåŒæ—¶æ»šåŠ¨å‡çº§æ—¶ï¼Œæ”¯æŒæ›´å¤šçš„é™„åŠ å‚æ•°ï¼Œä¾‹å¦‚è®¾ç½®æœ€å¤§ä¸å¯ç”¨ pod æ•°é‡ï¼Œæœ€å°å‡çº§é—´éš”æ—¶é—´ç­‰ç­‰ã€‚</p></li></ul><p>================= HPA å¼¹æ€§ä¼¸ç¼© æ ¹æ®èµ„æºçš„ä½¿ç”¨æƒ…å†µè‡ªåŠ¨ç¼©æ‰©å®¹</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="123-è¿è¡Œå•ä¸ªä»»åŠ¡-job">12.3. è¿è¡Œå•ä¸ªä»»åŠ¡ Job<a href="#123-è¿è¡Œå•ä¸ªä»»åŠ¡-job" class="hash-link" aria-label="12.3. è¿è¡Œå•ä¸ªä»»åŠ¡ Jobçš„ç›´æ¥é“¾æ¥" title="12.3. è¿è¡Œå•ä¸ªä»»åŠ¡ Jobçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œ æˆ‘ä»¬åªè°ˆè®ºäº†éœ€è¦æŒç»­è¿è¡Œçš„ podï¼Œ è¿™äº› pod ç”± rcï¼Œ rsï¼Œ ds ç®¡ç†ã€‚ ä½ ä¼šé‡åˆ°åªæƒ³è¿è¡Œå®Œæˆå·¥ä½œåå°±ç»ˆæ­¢ä»»åŠ¡çš„æ¸…å†µï¼Œ è¿™ç§ pod ç”± Job ç®¡ç†</p><p>è¯¥ pod åœ¨å†…éƒ¨è¿›ç¨‹æˆåŠŸç»“æŸæ—¶ï¼Œ ä¸é‡å¯å®¹å™¨ã€‚ä¸€æ—¦ä»»åŠ¡å®Œæˆï¼Œ pod å°±è¢«è®¤ä¸ºå¤„åƒå®ŒæˆçŠ¶æ€</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> batch/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Job</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> baä¸ƒch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">job</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">completions</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># é¡ºåºè¿è¡Œ 5 ä¸ª pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">parallelism</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># æœ€å¤šå¯ä»¥ 2 ä¸ª pod å¹¶è¡Œè¿è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">activeDeadlineSeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">120</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># job è¶…æ—¶æ—¶é—´ï¼Œè‹¥ pod è¶…æ—¶è¿˜æ²¡ç»“æŸï¼Œç³»ç»Ÿå°†ç»ˆæ­¢ podï¼Œ æ ‡è®° job ä¸ºå¤±è´¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">backOffLimit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># job æ ‡è®°ä¸ºå¤±è´¥å‰çš„é‡è¯•æ¬¡æ•°ï¼Œ é»˜è®¤ 6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># Job çš„ pod é€‰æ‹©å™¨ å°†è‡ªåŠ¨æ ¹æ®è¿™é‡Œçš„ labels åˆ›å»º</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> batch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">job</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># é‡å¯ç­–ç•¥ï¼Œ æŒ‡å®š å®¹å™¨ä¸­è¿›ç¨‹ç»“æŸåï¼Œ k8s åšä»€ä¹ˆ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># ä¸èƒ½æ˜¯ é»˜è®¤çš„ Always</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># è¿™é‡Œ Never äº¦å¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> OnFailure</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> luksa/batch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">job</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="124-å®šæ—¶ä»»åŠ¡-cronjob">12.4. å®šæ—¶ä»»åŠ¡ CronJob<a href="#124-å®šæ—¶ä»»åŠ¡-cronjob" class="hash-link" aria-label="12.4. å®šæ—¶ä»»åŠ¡ CronJobçš„ç›´æ¥é“¾æ¥" title="12.4. å®šæ—¶ä»»åŠ¡ CronJobçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>TODO</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13-pod-é€šä¿¡">13. pod é€šä¿¡<a href="#13-pod-é€šä¿¡" class="hash-link" aria-label="13. pod é€šä¿¡çš„ç›´æ¥é“¾æ¥" title="13. pod é€šä¿¡çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="131-proxy">13.1. proxy<a href="#131-proxy" class="hash-link" aria-label="13.1. proxyçš„ç›´æ¥é“¾æ¥" title="13.1. proxyçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="132-service">13.2. Service<a href="#132-service" class="hash-link" aria-label="13.2. Serviceçš„ç›´æ¥é“¾æ¥" title="13.2. Serviceçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>pods æœ‰è‡ªå·±çš„å†…éƒ¨åœ°å€, ä½†æ˜¯æ— æ³•ä» cluster å¤–éƒ¨è®¿é—®, é€šè¿‡ service å¯ä»¥æš´éœ²åˆ° cluster å¤–éƒ¨</p><p>service æ˜¯ä¸€ä¸ªé€»è¾‘ç»“æ„, å®šä¹‰ä¸€ç³»åˆ— pods, ä»¥åŠä»–ä»¬çš„è®¿é—®ç­–ç•¥(é€šè¿‡ç±»å‹æŒ‡å®š)</p><ul><li>ClusterIP (default): åªèƒ½åœ¨ cluster å†…éƒ¨è®¿é—®åˆ° service</li><li>NodePort: å¤–éƒ¨å¯ä»¥ä½¿ç”¨ <code>&lt;NodeIP&gt;:&lt;NodePort&gt;</code> è®¿é—® service</li><li>LoadBalancer: ç»™ service åˆ†é…ä¸€ä¸ªé™æ€ ip, å¯ä»¥è´Ÿè½½å‡è¡¡å¤šä¸ª pods</li><li>ExternalName: é€šè¿‡éšæœºåå­—è®¿é—® service (å¯é€šè¿‡ externalName åœ¨é…ç½®ä¸­æŒ‡å®š). This type requires v1.7 or higher of kube-dns.</li></ul><p>a default service named kubernetes will be created with type ClusterIP</p><p>å¯ä»¥å®šä¹‰é…ç½®æ–‡ä»¶, æŒ‡å®šæ ‡ç­¾é€‰æ‹©å™¨, é€‰æ‹©åŒ…å«å“ªäº› pods</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="133-pod-é—´é€šä¿¡">13.3. pod é—´é€šä¿¡<a href="#133-pod-é—´é€šä¿¡" class="hash-link" aria-label="13.3. pod é—´é€šä¿¡çš„ç›´æ¥é“¾æ¥" title="13.3. pod é—´é€šä¿¡çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Service</p><p>ä½œç”¨ï¼š</p><ul><li>æœåŠ¡çš„ä¸»è¦ç›®æ ‡å°±æ˜¯ä½¿é›†ç¾¤å†…éƒ¨çš„å…¶ä»– pod å¯ä»¥è®¿é—®å½“å‰è¿™ç»„ pod</li><li>å¯¹å¤–æš´éœ²æœåŠ¡</li></ul><p>å¦‚ä½•åˆ›å»ºï¼Ÿ</p><p>æ–¹å¼ 1ï¼š<code>kubectl expose rc kubia --type=LoadBalancer --name kubia-http</code></p><p>æ–¹å¼ 2ï¼šé€šè¿‡ <code>kubectl create -f xxx-service.yml</code></p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># é…ç½®ä¼šè¯äº²å’Œæ€§</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># ç‰¹å®šå®¢æˆ·ç«¯äº§ç”Ÿçš„æ‰€æœ‰è¯·æ±‚æ¯æ¬¡éƒ½æŒ‡å‘åŒ ä¸€ä¸ª pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># è¿˜å¯é€‰ Noneï¼Œ é»˜è®¤å€¼ã€‚ä¸æ”¯æŒ cookie</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">sessionAffinity</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ClientIP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># service çš„å¯ç”¨ç«¯å£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¯ä»¥å¼•ç”¨ Pod ä¸­ çš„ port name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># serviceå°†é“¾æ¥è½¬å‘åˆ° å®¹å™¨çš„ç«¯å£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># ä¸æ˜¯å¿…é¡»ï¼Œ å¤šç«¯å£æ˜ å°„å¿…é¡»</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xxx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¤šç«¯å£æ˜ å°„</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># é…ç½®ä¼šè¯äº²å’Œæ€§</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># ç‰¹å®šå®¢æˆ·ç«¯äº§ç”Ÿçš„æ‰€æœ‰è¯·æ±‚æ¯æ¬¡éƒ½æŒ‡å‘åŒ ä¸€ä¸ª pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># è¿˜å¯é€‰ Noneï¼Œ é»˜è®¤å€¼ã€‚ä¸æ”¯æŒ cookie</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">sessionAffinity</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ClientIP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># service çš„å¯ç”¨ç«¯å£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># serviceå°†é“¾æ¥è½¬å‘åˆ° å®¹å™¨çš„ç«¯å£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> yyy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¦‚ä½•å‘ç° service</p><ul><li><p>é€šè¿‡ç¯å¢ƒå˜é‡å‘ç°æœåŠ¡</p><p>æ¯ä¸ª pod å†…ä¼šæœ‰ç¯å¢ƒå˜é‡è¡¨ç¤º Service ip ï¼ˆ<code>&lt;pod name&gt;_SERVICE_HOST</code>ï¼‰ï¼Œ port (<code>&lt;pod name&gt;_SERVICE_PORT</code>)</p></li><li><p>é€šè¿‡ dns</p><p>kube-system ns ä¸­æœ‰ä¸ª pod ä¸º kube-dnsï¼Œå°±æ˜¯ dns serverã€‚åœ¨é›†ç¾¤ ä¸­çš„å…¶ä»– pod éƒ½è¢«é…ç½®æˆä½¿ç”¨å…¶ä½œä¸º dns ( Kubemetes é€šè¿‡ä¿®æ”¹å®¹å™¨çš„ /etc/resolv.conf å®ç°ï¼‰ã€‚è¿è¡Œåœ¨ pod ä¸Šçš„è¿›ç¨‹ DNS æŸ¥è¯¢éƒ½ä¼šè¢« Kubemetes è‡ªèº«çš„ DNS åŠ¡å™¨å“åº”</p><p>pod æ˜¯å¦ä½¿ç”¨å†…éƒ¨çš„ DNS æœåŠ¡å™¨æ˜¯æ ¹æ® pod çš„ spec.dnsPolicy å±æ€§æ¥å†³å®šçš„</p></li><li><p>é€šè¿‡ FQDN ï¼ˆå…¨é™å®šåŸŸåï¼‰ è¿æ¥æœåŠ¡</p><p><code>curl http://kubia.default.svc.cluster.local </code></p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="134-é€šè¿‡-service-è¿æ¥å¤–éƒ¨æœåŠ¡">13.4. é€šè¿‡ Service è¿æ¥å¤–éƒ¨æœåŠ¡<a href="#134-é€šè¿‡-service-è¿æ¥å¤–éƒ¨æœåŠ¡" class="hash-link" aria-label="13.4. é€šè¿‡ Service è¿æ¥å¤–éƒ¨æœåŠ¡çš„ç›´æ¥é“¾æ¥" title="13.4. é€šè¿‡ Service è¿æ¥å¤–éƒ¨æœåŠ¡çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>pod å¦‚ä½•è®¿é—® k8s å¤–éƒ¨ æœåŠ¡ï¼Ÿ</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1341-é€šè¿‡æ‰‹åŠ¨ç”Ÿæˆ-endpoint">13.4.1. é€šè¿‡æ‰‹åŠ¨ç”Ÿæˆ endpoint<a href="#1341-é€šè¿‡æ‰‹åŠ¨ç”Ÿæˆ-endpoint" class="hash-link" aria-label="13.4.1. é€šè¿‡æ‰‹åŠ¨ç”Ÿæˆ endpointçš„ç›´æ¥é“¾æ¥" title="13.4.1. é€šè¿‡æ‰‹åŠ¨ç”Ÿæˆ endpointçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Service å’Œ pod ä¸­é—´ä¸æ˜¯ç›´æ¥ç›¸è¿ï¼Œ è€Œæ˜¯æ’ç€ Endpointï¼Œå°±æ˜¯ä¸€ä¸ª ip:port åˆ—è¡¨ï¼Œåœ¨åˆ›å»º Service æ—¶ æ ¹æ® è¯¥æœåŠ¡çš„ label selector äº§ç”Ÿ</p><p>å¦‚æœ Service æ²¡æœ‰æŒ‡å®š pod selectorï¼Œ å°±ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆ endpointsï¼Œéœ€è¦æ‰‹åŠ¨ç”Ÿæˆï¼Œè¿™æ—¶å¯ä»¥æŒ‡å®šåœ°å€ä¸ºä»»æ„ å¤–éƒ¨çš„ ipï¼š</p><p>demo-service.yml:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># æ²¡æœ‰é…ç½® selector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># å°†æ¥æ”¶ç«¯å£80ä¸Šçš„ä¼ å…¥è¿æ¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>demo-service-endpoints.yml</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Endpoints</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Endpointçš„åç§°å¿…é¡»å’Œ service çš„åç§°ç›¸åŒ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">subsets</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Serviceå°†æŠŠè¯·æ±‚é‡å®šå‘åˆ° ä¸‹é¢çš„ åœ°å€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">addresses</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">ip</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 11. 11. 11. 11</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">ip</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 22.22.22.22</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¦‚æœç¨åå†³å®šå°† å¤–éƒ¨æœåŠ¡è¿ç§»åˆ° Kubemetes ä¸­è¿è¡Œçš„ pod, å¯ä»¥ä¸ºæœåŠ¡æ·»åŠ é€‰æ‹©å™¨ï¼Œä»è€Œå¯¹ Endpoint è¿›è¡Œè‡ªåŠ¨ç®¡ç†</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1342-é€šè¿‡-externalname-ç±»å‹çš„-service">13.4.2. é€šè¿‡ externalName ç±»å‹çš„ Service<a href="#1342-é€šè¿‡-externalname-ç±»å‹çš„-service" class="hash-link" aria-label="13.4.2. é€šè¿‡ externalName ç±»å‹çš„ Serviceçš„ç›´æ¥é“¾æ¥" title="13.4.2. é€šè¿‡ externalName ç±»å‹çš„ Serviceçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>å¦å¤–çš„æ–¹å¼æ¥è®¿é—®å¤–éƒ¨æœåŠ¡ï¼šåˆ›å»º ExtemalName ç±»å‹çš„ Service</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> external</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># é»˜è®¤ä¸º ClusterIPï¼Œåªèƒ½ pod é—´é€šä¿¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># è¿˜æœ‰å¾ˆå¤šç§ type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ExternalName</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">externalName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> someapi.somecompany.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç„¶ååœ¨ pod ä¸­é€šè¿‡ <code>external-service[.default.svc.cluster.local]</code> è®¿é—® someapi.somecompany.com</p><p>åœ¨ä»¥åå¦‚æœå°†å…¶æŒ‡å‘ä¸åŒçš„æœåŠ¡ï¼Œåªéœ€ç®€å•åœ°ä¿®æ”¹ externalName å±æ€§ï¼Œæˆ–è€…å°†ç±»å‹é‡æ–°å˜å› ClusterIP å¹¶ä¸ºæœåŠ¡åˆ›å»º Endpoint</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="135-å°†æœåŠ¡æš´éœ²ç»™å¤–éƒ¨">13.5. å°†æœåŠ¡æš´éœ²ç»™å¤–éƒ¨<a href="#135-å°†æœåŠ¡æš´éœ²ç»™å¤–éƒ¨" class="hash-link" aria-label="13.5. å°†æœåŠ¡æš´éœ²ç»™å¤–éƒ¨çš„ç›´æ¥é“¾æ¥" title="13.5. å°†æœåŠ¡æš´éœ²ç»™å¤–éƒ¨çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1351-å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ-nodeport">13.5.1. å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ NodePort<a href="#1351-å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ-nodeport" class="hash-link" aria-label="13.5.1. å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ NodePortçš„ç›´æ¥é“¾æ¥" title="13.5.1. å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ NodePortçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹éƒ½ä¼šåœ¨èŠ‚ç‚¹ä¸Šæ‰“å¼€ä¸€ä¸ªç«¯å£(ç«¯å£å·ç›¸åŒ)ã€‚å¹¶å°†ä¼ å…¥çš„è¿æ¥è½¬å‘ç»™ pod</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">nodeport</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> NodePort</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># é€šè¿‡ é›†ç¾¤ä»»æ„èŠ‚ç‚¹çš„ 30123 ç«¯å£å¯ä»¥è®¿é—® è¿™ä¸ª service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¦‚æœä¸æŒ‡å®šï¼ŒKuberneteså°†é€‰æ‹©ä¸€ä¸ªéšæœºç«¯å£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">nodePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">30123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>worker node ip å¦‚ä½•è·å–ï¼š<code>kubectl get nodes -o jsonpath=&#x27;...&#x27;</code></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1352-å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ-loadbalance">13.5.2. å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ LoadBalance<a href="#1352-å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ-loadbalance" class="hash-link" aria-label="13.5.2. å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ LoadBalanceçš„ç›´æ¥é“¾æ¥" title="13.5.2. å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ LoadBalanceçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>NodePort ç±»å‹çš„ä¸€ ç§æ‰©å±•, åœ¨ client å’Œ worker node é—´ æ”¾äº†ä¸€ä¸ª LoadBalancerï¼Œ é˜²æ­¢èŠ‚ç‚¹å•ç‚¹æ•…éšœ</p><p>è´Ÿè½½å‡è¡¡å™¨æ‹¥æœ‰è‡ªå·±ç‹¬ä¸€æ— äºŒçš„å¯å…¬å¼€è®¿é—®çš„ IP åœ°å€ï¼Œ å¹¶å°†æ‰€æœ‰è¿æ¥é‡å®šå‘åˆ°æœåŠ¡ã€‚å¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡å™¨çš„ IP åœ°å€è®¿é—®æœåŠ¡</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> vl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">meä¸ƒadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">loadbalancer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> LoadBalancer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># ä»…å°†å¤–éƒ¨é€šä¿¡é‡å®šå‘åˆ°æ¥æ”¶è¿æ¥çš„èŠ‚ç‚¹ä¸Šè¿è¡Œçš„pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¦‚æœæ²¡æœ‰æœ¬åœ°podå­˜åœ¨ï¼Œ åˆ™è¿æ¥å°†æŒ‚èµ·ã€‚å› æ­¤ï¼Œ éœ€è¦ç¡®ä¿è´Ÿè½½å¹³è¡¡å™¨å°†è¿æ¥è½¬å‘ç»™è‡³å°‘å…·æœ‰ä¸€ä¸ªpodçš„èŠ‚ç‚¹ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># å¯é¿å…é¢å¤–çš„ç½‘ç»œè·³è½¬ã€‚ä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´è·¨èŠ‚ç‚¹çš„ pod çš„è´Ÿè½½åˆ†å¸ƒä¸å‡è¡¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token key atrule">externalTrafficPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Local </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">portS</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1353-åˆ›å»ºä¸€-ä¸ª-ingress-èµ„æº">13.5.3. åˆ›å»ºä¸€ ä¸ª Ingress èµ„æº<a href="#1353-åˆ›å»ºä¸€-ä¸ª-ingress-èµ„æº" class="hash-link" aria-label="13.5.3. åˆ›å»ºä¸€ ä¸ª Ingress èµ„æºçš„ç›´æ¥é“¾æ¥" title="13.5.3. åˆ›å»ºä¸€ ä¸ª Ingress èµ„æºçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>é€šè¿‡ä¸€ ä¸ª IP åœ°å€å…¬å¼€å¤šä¸ªæœåŠ¡ï¼Œå®ƒè¿è¡Œåœ¨ HTTP å±‚ï¼ˆç½‘ç»œåè®®ç¬¬ 7 å±‚ï¼‰ä¸Šï¼Œ å› æ­¤å¯ä»¥æä¾›æ¯”å·¥ä½œåœ¨ç¬¬ 4 å±‚çš„æœåŠ¡æ›´å¤šçš„åŠŸèƒ½</p><p>ä¸ºä»€ä¹ˆéœ€è¦ Ingressï¼šæ¯ä¸ª LoadBalancer æœåŠ¡éƒ½éœ€è¦è‡ªå·±çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæ¯ä¸ª loadbalancer éƒ½éœ€è¦è‡ªå·±çš„ ipï¼Œ è€Œ Ingress åªéœ€è¦ä¸€ä¸ªå…¬ç½‘ IP å°±èƒ½ä¸ºè®¸å¤šæœåŠ¡æä¾›è®¿é—®</p><p>å½“å®¢æˆ·ç«¯å‘ Ingress å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œ Ingress ä¼šæ ¹æ®è¯·æ±‚çš„ä¸»æœºåå’Œè·¯å¾„å†³å®šè¯·æ±‚è½¬å‘åˆ°çš„æœåŠ¡ã€‚</p><p>Ingress å·¥ä½œåœ¨ åº”ç”¨å±‚ åŸºäº cookie çš„ä¼šè¯äº²å’Œæ€§ (session affinity)</p><p>å·²ç»ç¡®è®¤é›†ç¾¤ä¸­æ­£åœ¨è¿è¡Œ Ingress æ§åˆ¶å™¨ï¼Œ å› æ­¤ç°åœ¨å¯ä»¥åˆ›å»ºä¸€ä¸ª Ingress èµ„æºï¼š</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> extensions/v1beta1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># Ingress å°†è¿™ä¸ªåŸŸåæ˜ å°„åˆ°ä½ çš„ service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia . example.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token comment" style="color:rgb(0, 128, 0)"># å°†è¯·æ±‚å‘é€åˆ°  kubia-nodeport æœåŠ¡çš„ 80 ç«¯å£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubia</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">nodeport</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>kubectl get ingresses </code> è·å– Ingress æ§åˆ¶å™¨ å†…ç½‘ ipï¼Œé…ç½®åˆ° dns server</p><p>ä¸º ingress åˆ›å»º tls è®¤è¯ TODO</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="14-å‘½ä»¤">14. å‘½ä»¤<a href="#14-å‘½ä»¤" class="hash-link" aria-label="14. å‘½ä»¤çš„ç›´æ¥é“¾æ¥" title="14. å‘½ä»¤çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="141-kubectl">14.1. kubectl<a href="#141-kubectl" class="hash-link" aria-label="14.1. kubectlçš„ç›´æ¥é“¾æ¥" title="14.1. kubectlçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1411-åŸºæœ¬ä¿¡æ¯">14.1.1. åŸºæœ¬ä¿¡æ¯<a href="#1411-åŸºæœ¬ä¿¡æ¯" class="hash-link" aria-label="14.1.1. åŸºæœ¬ä¿¡æ¯çš„ç›´æ¥é“¾æ¥" title="14.1.1. åŸºæœ¬ä¿¡æ¯çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl cluster-info</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get nodes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è·å–kube-schedulerå’Œkube-controller-managerç»„ä»¶çŠ¶æ€</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get cs # å¥åº·çŠ¶å†µ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1412-åˆ›å»º-create-expose">14.1.2. åˆ›å»º create expose<a href="#1412-åˆ›å»º-create-expose" class="hash-link" aria-label="14.1.2. åˆ›å»º create exposeçš„ç›´æ¥é“¾æ¥" title="14.1.2. åˆ›å»º create exposeçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># create depend on a spec file.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å’Œ kubectl apply åŒºåˆ«:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># - create æ˜¯åˆ›å»ºæ–°èµ„æºã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå†æ¬¡è¿è¡Œç›¸åŒçš„å‘½ä»¤ï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºèµ„æºåç§°åœ¨åç§°ç©ºé—´ä¸­åº”è¯¥æ˜¯å”¯ä¸€çš„ã€‚</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># - apply ä½¿é…ç½®åœ¨èµ„æºä¸Šç”Ÿæ•ˆ, å¯èƒ½æ˜¯åˆ›å»º, ä¹Ÿå¯èƒ½æ˜¯æ ¹æ®èµ„æºå®šä¹‰æ–‡ä»¶æ›´æ–°èµ„æº, å¯é‡å¤æ‰§è¡Œ  (æ¨è)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl create -f xxx.yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># é€’å½’ä» dir ä¸‹æŸ¥æ‰¾èµ„æºå®šä¹‰æ–‡ä»¶, å¹¶åˆ›å»º</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kc create -R -f &lt;dir&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; deployment,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># dep-name ä¸èƒ½éšä¾¿è®¾ç½®, å¿…é¡»ç¬¦åˆåŸŸåå‘½åè§„èŒƒ.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è‡ªåŠ¨åˆ›å»ºçš„ ReplicaSet åå­—ä¸º dep_name + random uuid</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è‡ªåŠ¨åˆ›å»º pod åå­—ä¸º ReplicaSet-name + random uuid</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># é•œåƒåœ°å€ include the full repository url</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è‡ªåŠ¨åˆ›å»º label -&gt; run={dep name}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># auto  create selector -&gt; run={dep name}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl create deployment &lt;dep name&gt; --image=k8s.gcr.io/echoserver:1.4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl create deployment tomcat6 --image=tomcat:6.0.53-jre8 # ä¸æŒ‡å®š url å‰ç¼€, é»˜è®¤ä» docker hub æ‹‰å–</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; proxy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#  pods é»˜è®¤ä»…ä»…èƒ½è¢« åŒä¸ªé›†ç¾¤çš„ pods, service  è®¿é—®</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ›å»ºä¸´æ—¶çš„ ä»£ç†, å¯ä»¥å°†å¤–éƒ¨å‘½ä»¤è½¬å‘åˆ° cluster å†…éƒ¨çš„ pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Ctrl +c å…³é—­</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl proxy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŸ¥ ç‰ˆæœ¬</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">curl http://localhost:8001/version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è®¿é—®æŒ‡å®š pod çš„æœåŠ¡</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">curl http://localhost:8001/api/v1/namespaces/default/pods/$POD_NAME/proxy/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl run &lt;pod name&gt; --image=nginx --restart=Never --port=80</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># --generator=run/vl  è¡¨ç¤ºåŒæ—¶åˆ›å»º rc ç®¡ç† pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl run &lt;pod name&gt; --image=luksa/kubia --port=8080 --generator=run/vl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ä»æè¿°æ–‡ä»¶åˆ›å»º èµ„æºï¼Œ å¯ä»¥ podï¼Œ rcã€‚ã€‚ã€‚ï¼Œ å¯æŒ‡å®š nsï¼Œ é»˜è®¤ default</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl create -f kubia-manual.yaml [-n xxx_ns]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ›å»º service, åå­—åŒ deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># The LoadBalancer type makes the Service accessible through the minikube service command</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Port 8080 is specified in image code, so cannot be other port here</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># --port : service æš´éœ²åœ¨ cluster ip ä¸‹çš„ç«¯å£, é€šè¿‡è¿™ä¸ªç«¯å£,  å¯ä»¥åœ¨ cluster å†…éƒ¨è®¿é—®åˆ°å¤šä¸ª pod. é€šè¿‡è¿™ä¸ª service è´Ÿè½½å‡è¡¡äº† å¤šä¸ª pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># --targetPort å®¹å™¨çš„ç«¯å£, é»˜è®¤=== port, ä¸åˆ¶ä½œé•œåƒæ—¶æš´éœ²çš„ç«¯å£ä¸€è‡´, ä¸èƒ½éšä¾¿æŒ‡å®š</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># --type: service ç±»å‹,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#       NodePort: åˆ›å»ºä¸€ä¸ª service å¹¶æš´éœ²åˆ° cluster å¤–éƒ¨, service çš„ç«¯å£è¿˜æ˜¯ --port æŒ‡å®š, åŒæ—¶ service æœ‰è‡ªå·±çš„ cluster url, node ä¼šæŒ‡å®šä¸€ä¸ªéšæœºç«¯å£æ˜ å°„åˆ° service çš„ ç«¯å£, è‹¥æŒ‡å®šäº† --nodePort, å°±ç”¨æŒ‡å®šç«¯å£æ˜ å°„åˆ° service ç«¯å£; å¦‚ type=NodePortï¼Œè€Œä¸”é…ç½® nodePort=30001, é‚£ä¹ˆå¤–éƒ¨æœºå™¨ å¯ä»¥ scheme://nodeIP:30001è®¿é—®åˆ°è¯¥æœåŠ¡</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#       LoadBalancer:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl expose deployment &lt;dep name&gt; --type=LoadBalancer --port=8080</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŸ¥æ‰¾æš´éœ²çš„éšæœºç«¯å£</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl describe service mywebservice | grep NodePort</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># service port 80 will mapping to random node port ,and this service can be visited by someone outside cluster</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è‹¥æ‰©å®¹, åˆ™åœ¨å„ä¸ªæœ‰ pod è¿è¡Œçš„èŠ‚ç‚¹éƒ½èƒ½é€šè¿‡ node ç«¯å£è®¿é—®  è¿™ä¸ª service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl expose deploy tomcat6 --port=80 --target-port=8080 --type=NodePort</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ›å»ºä¸€ä¸ªè´Ÿè½½å‡è¡¡æœåŠ¡ service å¯¹è±¡. å¯ä»¥ä»å¤–éƒ¨è®¿é—® pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># rc ä¸º replicationController ç¼©å†™</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl expose rc &lt;po name&gt; --type=LoadBalancer --name kubia-http</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; label</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è¯­æ³•: kubectl label &lt;obj_type, eg: pod, service&gt; &lt;obj_name&gt; &lt;label, eg: app=v1&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl label pod $POD_NAME app=v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; å‘½åç©ºé—´</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ›å»º</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl config set-context Kubernetes --namespace=beta</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># éªŒè¯</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl config view | grep namespace command</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1413-æ‰§è¡Œå‘½ä»¤åˆ°å®¹å™¨-exec">14.1.3. æ‰§è¡Œå‘½ä»¤åˆ°å®¹å™¨ exec<a href="#1413-æ‰§è¡Œå‘½ä»¤åˆ°å®¹å™¨-exec" class="hash-link" aria-label="14.1.3. æ‰§è¡Œå‘½ä»¤åˆ°å®¹å™¨ execçš„ç›´æ¥é“¾æ¥" title="14.1.3. æ‰§è¡Œå‘½ä»¤åˆ°å®¹å™¨ execçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># ä»…æœ‰ ä¸€ä¸ªå®¹å™¨åœ¨ pod, æ— éœ€æŒ‡å®šå®¹å™¨</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl exec [-c container_name] $POD_NAME -- env</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è¿›å…¥ pod å†…éƒ¨éšæœºä¸€ä¸ªå®¹å™¨ </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl exec -ti $POD_NAME -- bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1414-ä¿®æ”¹">14.1.4. ä¿®æ”¹<a href="#1414-ä¿®æ”¹" class="hash-link" aria-label="14.1.4. ä¿®æ”¹çš„ç›´æ¥é“¾æ¥" title="14.1.4. ä¿®æ”¹çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; æ‰©å®¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŒ‡å®š replicas å¯ä»¥ç¼©æ‰©å®¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ kubectl scale deployments/&lt;dep_name&gt; --replicas=4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl scale deployment.apps/tomcat6 --replicas=2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl scale deployment tomcat6 --replicas=2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; æ»šåŠ¨æ›´æ–°</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ›´æ–° image version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ kubectl set image deployments/&lt;dep_name&gt; &lt;dep_name&gt;=jocatalin/kubernetes-bootcamp:v2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># éªŒè¯æ›´æ–°æ˜¯å¦æˆåŠŸ</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ kubectl rollout status deployments/kubernetes-bootcamp</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; å›æ»š</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å–æ¶ˆä¹‹å‰çš„éƒ¨ç½²ï¼Œè¿™å°†æ‰§è¡Œåå‘æ“ä½œï¼Œå°†è´Ÿè½½ç§»åŠ¨è‡³ä¹‹å‰ç‰ˆæœ¬çš„å®¹å™¨</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ kubectl rollout undo deployments/kubernetes-bootcamp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1415-èµ„æºåˆ—è¡¨-get">14.1.5. èµ„æºåˆ—è¡¨ get<a href="#1415-èµ„æºåˆ—è¡¨-get" class="hash-link" aria-label="14.1.5. èµ„æºåˆ—è¡¨ getçš„ç›´æ¥é“¾æ¥" title="14.1.5. èµ„æºåˆ—è¡¨ getçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>å•å¤æ•°å‡å¯</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ‰€æœ‰</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get all</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get deployments</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; pods</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># --show-labels åŒæ—¶æ˜¾ç¤ºæ‰€æœ‰æ ‡ç­¾ã€‚</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># -A æŸ¥çœ‹æ‰€æœ‰ pods, åŒ…æ‹¬ kube-system å‘½åç©ºé—´ ä¸‹çš„ pods</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># --all-namespaces æ‰€æœ‰ç©ºé—´çš„ pods</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pods [--show-labels]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># -o è¾“å‡ºæ ¼å¼; wide è¡¨ç¤ºè¾“å‡ºæ–‡æœ¬ä¿¡æ¯, åˆ—å‡º ip , èŠ‚ç‚¹ name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># -o yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pods -o wide</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># é€šè¿‡æ ‡ç­¾è¿‡æ»¤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pods -l &lt;label&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è·å– pod å®Œæ•´ yaml/json æ–‡ä»¶</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ç¼©å†™ po</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get po &lt;pod name&gt; -o yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get po &lt;pod name&gt; -o json</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ ¹æ®æ¨¡æ¿è·å– ä¿¡æ¯</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">export POD_NAME=$(kubectl get pods -o go-template --template &#x27;{{range .items}}{{.metadata.name}}{{&quot;\n&quot;}}{{end}}&#x27;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">export NODE_PORT=$(kubectl get services/kubernetes-bootcamp -o go-template=&#x27;{{(index .spec.ports 0).nodePort}}&#x27;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŸ¥çœ‹ service  çš„ endpoint åˆ—è¡¨</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get endpoints &lt;service name&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŸ¥çœ‹æ‰€æœ‰ svc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ç¼©å†™ svc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get services</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; ReplicaSet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get rs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ç«¯å£è½¬å‘ï¼Œ å°†ä¼šè¿è¡Œä¸€ä¸ªç«¯å£è½¬å‘ä»£ç†</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å°† local port 8888 è½¬å‘åˆ° pod çš„ 8080</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl port-forward &lt;pod name&gt; 8888:8080</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ ‡ç­¾</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ—å‡º pods çš„æ‰€æœ‰æ ‡ç­¾</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pods --show-labels</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åªåˆ—å‡ºæ„Ÿå…´è¶£çš„æ ‡ç­¾ï¼Œ æ ‡ç­¾æŒ‰ç…§åˆ—å±•ç¤º</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get po -L creation_method,env</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ·»åŠ </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl label po &lt;pod name&gt; creation_method=manual</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ä¿®æ”¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl label po &lt;pod name&gt; creation_method=manual --override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ ‡ç­¾é€‰æ‹©å™¨</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get po -1 creation_method=manual</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get po -1 creation_method!=manual</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get po -1 env</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ—å‡ºæ²¡æœ‰ env çš„pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get po -1 &#x27;!env&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># é€‰æ‹©å¸¦æœ‰envæ ‡ç­¾ä¸”å€¼ä¸ºprodæˆ–develçš„pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get po -1 env in (prod, devel)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get po -1 env notin (prod, devel)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ä½¿ç”¨ label åˆ†ç±» worker node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get nodes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl label node &lt;node name&gt; gpu=true # æ¯ä¸ª node éƒ½æœ‰ä¸€ä¸ªé»˜è®¤ labelï¼Œ kubernetes.io/hostname:ä¸»æœºå</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get nodes -l gpu=true</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å‘½åç©ºé—´</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŸ¥çœ‹æ‰€æœ‰ ns, æœ‰ defaultï¼Œ kube-publicï¼Œ kube-systemï¼Œé»˜è®¤æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ default</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get ns</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ—å‡ºåªå±äºè¯¥å‘½åç©ºé—´çš„ pod, å¯ä½¿ç”¨ -n</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get po --namespace kube-system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ç¼–è¾‘ rc çš„ yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ä¸€èˆ¬ä»…ä»…ç¼–è¾‘ rc çš„ templateï¼Œ ä¸åŠ¨ label selector</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ç”¨æ¥å‡çº§ pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl edit rc kubia</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å¢åŠ  å‰¯æœ¬æ•°ï¼Œ æ°´å¹³æ‰©å®¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl scale rc kubia --replicas=3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ç­‰åŒ parallelism</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl scale job xxx_job --replicas 3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è¿œç¨‹åœ¨ pod ä¸­æŸä¸ª container æ‰§è¡Œå‘½ä»¤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># â€œ--â€ è¡¨ç¤º kubectl å‘½ä»¤ç»“æŸï¼Œ åé¢çš„æ˜¯åœ¨ pod å†…æ‰§è¡Œçš„</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl exec &lt;pod name&gt; -- curl -s http://10.23...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ—å‡ºç¯å¢ƒå˜é‡ï¼Œå¦‚ Service çš„ ipï¼Œ ç«¯å£</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl exec kubia-3inly env</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åœ¨ pod ä¸­æ‰§è¡Œ shell</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl exec -it kubi-3inly bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; é…ç½®æ–‡ä»¶</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl config view</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; äº‹ä»¶</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get events</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># é€šè¿‡ describe ä¹Ÿèƒ½å¾—åˆ° object ç›¸å…³çš„äº‹ä»¶</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1416-æŸ¥è¯¢è¯¦ç»†æè¿°-describe">14.1.6. æŸ¥è¯¢è¯¦ç»†æè¿° describe<a href="#1416-æŸ¥è¯¢è¯¦ç»†æè¿°-describe" class="hash-link" aria-label="14.1.6. æŸ¥è¯¢è¯¦ç»†æè¿° describeçš„ç›´æ¥é“¾æ¥" title="14.1.6. æŸ¥è¯¢è¯¦ç»†æè¿° describeçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; pods</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŸ¥çœ‹èµ„æºæè¿°ï¼Œ é™„åŠ ä¿¡æ¯ï¼Œ ä½œä¸º kubectl get xxx xxx è¡¥å……, å¯ç”¨äºæ’æŸ¥é—®é¢˜</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å¦‚ pod æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Œ é‡å¯åŸå› ï¼Œ é€€å‡ºç  137ï¼Œ143 è¡¨ç¤º pod è¢«è¿«ç»ˆæ­¢</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl describe pods [pod_name]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl describe services/&lt;srv name&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &gt;&gt;&gt; deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ kubectl describe deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1417-æŸ¥è¯¢æ—¥å¿—-logs">14.1.7. æŸ¥è¯¢æ—¥å¿— logs<a href="#1417-æŸ¥è¯¢æ—¥å¿—-logs" class="hash-link" aria-label="14.1.7. æŸ¥è¯¢æ—¥å¿— logsçš„ç›´æ¥é“¾æ¥" title="14.1.7. æŸ¥è¯¢æ—¥å¿— logsçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># æŸ¥æŒ‡å®š pod ä¸‹çš„ container æ—¥å¿—</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è‹¥pod åªæœ‰ä¸€ä¸ª container, æ— éœ€æŒ‡å®š container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl logs $POD_NAME</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl logs -f POD-NAME</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># éœ€è¦ ssh åˆ° pod æ‰€åœ¨çš„ worker node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker logs &lt;container_id&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ— éœ€ ssh, å¯æŒ‡å®šæŸä¸ª containerï¼Œ å¯æŒ‡å®šçœ‹é‡å¯å‰çš„ç‰ˆæœ¬çš„æ—¥å¿—</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl logs &lt;pod name&gt; [-c container_name] [--previous]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŸ¥çœ‹ k8s èµ„æº</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl explain pods</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl explain pod.spec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1418-åˆ é™¤-delete">14.1.8. åˆ é™¤ delete<a href="#1418-åˆ é™¤-delete" class="hash-link" aria-label="14.1.8. åˆ é™¤ deleteçš„ç›´æ¥é“¾æ¥" title="14.1.8. åˆ é™¤ deleteçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># delete by spec file</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete -f flask.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ é™¤ pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ— æ³•ç›´æ¥åˆ é™¤, åªè¦ replicaSet æ²¡æœ‰åˆ é™¤, åˆ äº† po, è¿˜ä¼šé‡ç°åˆ›å»º po</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å¯ç›´æ¥ é€šè¿‡åˆ é™¤ deployment åˆ é™¤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete po kubia-gpu [pod2 [pod3]]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ é™¤å½“å‰ ns ä¸‹ all podï¼Œ ä¿ç•™ ns</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete po --all</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŒ‰ç…§æ ‡ç­¾åˆ é™¤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete po -1 creation_method=manual</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete service hello-node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete deployment hello-node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#  åˆ é™¤ ns, åŒæ—¶ä¼šåˆ é™¤ ns ä¸‹çš„æ‰€æœ‰ pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete ns custom-namespace</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ é™¤æ‰€æœ‰èµ„æºï¼Œ åŒ…æ‹¬ rcï¼Œ podï¼Œ service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete all --all</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ é™¤ rcï¼Œ rc ç®¡ç†çš„ pods ä¹Ÿä¼šåˆ é™¤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete rc &lt;rc name&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ é™¤ rcï¼Œ ä½†æ˜¯ä¿ç•™ pods</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete rc &lt;rc name&gt; --cascade=false</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete rs kubia</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ é™¤æ‰€æœ‰ pod, deployment, service èµ„æº</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl delete deployment,service --all</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1419-æ“ä½œä¸Šä¸‹æ–‡">14.1.9. æ“ä½œä¸Šä¸‹æ–‡<a href="#1419-æ“ä½œä¸Šä¸‹æ–‡" class="hash-link" aria-label="14.1.9. æ“ä½œä¸Šä¸‹æ–‡çš„ç›´æ¥é“¾æ¥" title="14.1.9. æ“ä½œä¸Šä¸‹æ–‡çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># æ›´æ–°ä¸Šä¸‹æ–‡, ä¸ºå½“å‰ä¸Šä¸‹æ–‡åŠ ä¸Š namespace</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl config set-context $(kubectl config current-context) --namespace &lt;other ns&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl config get-contexts</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ›´æ¢ä¸Šä¸‹æ–‡</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl config use-context docker-desktop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="142-kubeadmin">14.2. kubeadmin<a href="#142-kubeadmin" class="hash-link" aria-label="14.2. kubeadminçš„ç›´æ¥é“¾æ¥" title="14.2. kubeadminçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubeadm init # create a master node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubeadm join &lt;master_id:port&gt; # add a node to cluster</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="15-cka-ckad-è¯ä¹¦è€ƒè¯•">15. cka ckad è¯ä¹¦è€ƒè¯•<a href="#15-cka-ckad-è¯ä¹¦è€ƒè¯•" class="hash-link" aria-label="15. cka ckad è¯ä¹¦è€ƒè¯•çš„ç›´æ¥é“¾æ¥" title="15. cka ckad è¯ä¹¦è€ƒè¯•çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p><a href="https://blog.csdn.net/vic_qxz/article/details/108338442" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/vic_qxz/article/details/108338442</a> <a href="https://zhuanlan.zhihu.com/p/139052135" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/139052135</a> å¤‡è€ƒ cka ckad</p><p><a href="https://training.linuxfoundation.cn/certificate/details/1" target="_blank" rel="noopener noreferrer">https://training.linuxfoundation.cn/certificate/details/1</a> ä¸­å›½åŒº</p><p><a href="https://zhuanlan.zhihu.com/p/138796893" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/138796893</a> <a href="https://www.jianshu.com/p/629525af31c4" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/629525af31c4</a> <a href="https://www.kubernetes.org.cn/peixun" target="_blank" rel="noopener noreferrer">https://www.kubernetes.org.cn/peixun</a> è€ƒè¯•è¦ç‚¹ <a href="https://zhuanlan.zhihu.com/p/138796893" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/138796893</a> , <a href="https://www.zhihu.com/zvideo/1302356091591372800" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/zvideo/1302356091591372800</a> çœŸé¢˜</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="16-dashboard">16. dashboard<a href="#16-dashboard" class="hash-link" aria-label="16. dashboardçš„ç›´æ¥é“¾æ¥" title="16. dashboardçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="161-k9s">16.1. k9s<a href="#161-k9s" class="hash-link" aria-label="16.1. k9sçš„ç›´æ¥é“¾æ¥" title="16.1. k9sçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><a href="https://k9scli.io/" target="_blank" rel="noopener noreferrer">https://k9scli.io/</a>, åŸºäº Terminal çš„è½»é‡çº§ UI</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="162-kuboard">16.2. kuboard<a href="#162-kuboard" class="hash-link" aria-label="16.2. kuboardçš„ç›´æ¥é“¾æ¥" title="16.2. kuboardçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><a href="https://github.com/eip-work/kuboard-press" target="_blank" rel="noopener noreferrer">https://github.com/eip-work/kuboard-press</a> é¢æ¿</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="163-kubernetes-dashboard">16.3. kubernetes-dashboard<a href="#163-kubernetes-dashboard" class="hash-link" aria-label="16.3. kubernetes-dashboardçš„ç›´æ¥é“¾æ¥" title="16.3. kubernetes-dashboardçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><a href="https://github.com/kubernetes/dashboard" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/dashboard</a></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># install</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/master/aio/deploy/recommended.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># start</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl proxy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># start in background</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl proxy &gt;/dev/null &amp;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># create administrator</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f https://raw.githubusercontent.com/gotok8s/gotok8s/master/dashboard-admin.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># and token</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep kubernetes-dashboard-admin | awk &quot;&#x27;{print $1}&#x27;&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># visit</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="164-kubesphere-æ¨è">16.4. kubesphere (æ¨è)<a href="#164-kubesphere-æ¨è" class="hash-link" aria-label="16.4. kubesphere (æ¨è)çš„ç›´æ¥é“¾æ¥" title="16.4. kubesphere (æ¨è)çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æ‰“é€š devops å…¨å¥—æµæ°´çº¿, å¯¹ cluster è¦æ±‚é«˜ <a href="https://github.com/kubesphere/kubesphere" target="_blank" rel="noopener noreferrer">https://github.com/kubesphere/kubesphere</a></p><p>(kuboard ä¹Ÿè¡Œ, å¯¹ cluster è¦æ±‚ä¸é«˜)</p><p><a href="https://www.zhihu.com/question/348609092" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/348609092</a> rancher å’Œ kubesphere å¯¹æ¯”</p><p><a href="https://www.bilibili.com/video/BV1cL4y167GV" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1cL4y167GV</a> è§†é¢‘æ•™ç¨‹</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="17-rancher">17. rancher<a href="#17-rancher" class="hash-link" aria-label="17. rancherçš„ç›´æ¥é“¾æ¥" title="17. rancherçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>éƒ¨ç½²å’Œç®¡ç† k8s é›†ç¾¤</p><p><a href="https://docs.rancher.cn/" target="_blank" rel="noopener noreferrer">https://docs.rancher.cn/</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="18-harbor">18. Harbor<a href="#18-harbor" class="hash-link" aria-label="18. Harborçš„ç›´æ¥é“¾æ¥" title="18. Harborçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>Harbor æ˜¯ç”± VMware å…¬å¸ä¸­å›½å›¢é˜Ÿä¸ºä¼ä¸šç”¨æˆ·è®¾è®¡çš„ Registry server å¼€æºé¡¹ç›® (é•œåƒä»“åº“, ç±»ä¼¼ docker hub)</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="19-helm">19. Helm<a href="#19-helm" class="hash-link" aria-label="19. Helmçš„ç›´æ¥é“¾æ¥" title="19. Helmçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æ¥è‡ª CNCF, ä½¿ç”¨ helm chart ä¸€é”®æ‹‰èµ·æ•´å¥—ç¯å¢ƒ(ç¬¬ä¸‰æ–¹éƒ¨ç½²k8såº”ç”¨çš„å·¥å…·). ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶åº”ç”¨å•†åº—, ä¸€é”®éƒ¨ç½²åˆ«äººå†™å¥½çš„è½¯ä»¶é›†ç¾¤</p><blockquote><p>HelmæŠŠKubernetesèµ„æºï¼ˆæ¯”å¦‚deploymentsã€servicesæˆ– ingressç­‰ï¼‰æ‰“åŒ…åˆ°ä¸€ä¸ªchartä¸­ï¼Œè€Œchartè¢«ä¿å­˜åˆ°chartä»“åº“ã€‚é€šè¿‡chartä»“åº“å¯ç”¨æ¥å­˜å‚¨å’Œåˆ†äº«chartã€‚Helmä½¿å‘å¸ƒå¯é…ç½®ï¼Œæ”¯æŒå‘å¸ƒåº”ç”¨é…ç½®çš„ç‰ˆæœ¬ç®¡ç†ï¼Œç®€åŒ–äº†Kuberneteséƒ¨ç½²åº”ç”¨çš„ç‰ˆæœ¬æ§åˆ¶ã€æ‰“åŒ…ã€å‘å¸ƒã€åˆ é™¤ã€æ›´æ–°ç­‰æ“ä½œã€‚</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="191-how-to-create-helm-chart">19.1. How to create helm chart<a href="#191-how-to-create-helm-chart" class="hash-link" aria-label="19.1. How to create helm chartçš„ç›´æ¥é“¾æ¥" title="19.1. How to create helm chartçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>We can use <code>helm create &lt;chart-name&gt;</code> to create a default chart template, è¯¥å‘½ä»¤é»˜è®¤ä¼šåˆ›å»ºä¸€äº› k8s èµ„æºå®šä¹‰çš„åˆå§‹æ–‡ä»¶ï¼Œå¹¶ä¸”ä¼šç”Ÿæˆå®˜ç½‘æ¨èçš„ç›®å½•ç»“æ„</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helm create hello-helm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">â”œâ”€â”€ Chart.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">â”œâ”€â”€ charts</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">â”œâ”€â”€ templates     // we can put our resource yml files into this folder, then our code can be put into the root path</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">â”‚Â Â  â”œâ”€â”€ NOTES.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">â”‚Â Â  â”œâ”€â”€ _helpers.tpl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">â”‚Â Â  â”œâ”€â”€ deployment.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">â”‚Â Â  â”œâ”€â”€ hpa.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">â”‚Â Â  â”œâ”€â”€ ingress.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">â”‚Â Â  â”œâ”€â”€ service.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">â”‚Â Â  â”œâ”€â”€ serviceaccount.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">â”‚Â Â  â””â”€â”€ tests</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">â”‚Â Â      â””â”€â”€ test-connection.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">â””â”€â”€ values.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>values.yml is used to define the env vars, we can extract the vars from cofigMap and then put the vars into this file.</p><blockquote><p>å¥½å¤„æ˜¯å¯ä»¥å°†æ‰€æœ‰å¯å˜çš„å‚æ•°å®šä¹‰åœ¨ values.yaml æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨è¯¥ helm charts çš„äººæ— éœ€äº†è§£å…·ä½“ k8s çš„å®šä¹‰ï¼Œåªéœ€æ”¹å˜æˆè‡ªå·±æƒ³è¦çš„å‚æ•°ï¼Œå³å¯åˆ›å»ºè‡ªå®šä¹‰çš„èµ„æºï¼</p></blockquote><p>for example:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># values.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">application</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> guangzhengli/hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v6</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">message</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;It works with Helm Values[v2]!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">database</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">url</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;http://DB_ADDRESS_DEFAULT&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">password</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;db_password&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>we can change the configMap like this:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># hello-k8s-configmap.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># æ„æ€æ˜¯ä» values.yaml æ–‡ä»¶ä¸­è·å– application.name çš„å€¼ hellok8sï¼Œæ‹¼æ¥ -config å­—ç¬¦ä¸²ï¼Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># è¿™æ ·åˆ›å»ºå‡ºæ¥çš„ configmaps èµ„æºåç§°å°±æ˜¯ hellok8s-configã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> .Values.application.name </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">DB_URL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> .Values.application.hellok8s.database.url </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>change secret yml like this:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># hellok8s-secret.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> .Values.application.name </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># é€šè¿‡ b64enc æ–¹æ³•å°†å€¼ Base64 ç¼–ç </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">DB_PASSWORD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> .Values.application.hellok8s.database.password </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token plain"> b64enc </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and change deployment like this:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># hello-k8s-deployment.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> .Values.application.name </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> .Values.application.hellok8s.replicas </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> .Values.application.hellok8s.image </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hellok8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> DB_URL</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">valueFrom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">configMapKeyRef</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> .Values.application.name </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> DB_URL</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> DB_PASSWORD</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">valueFrom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">secretKeyRef</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> .Values.application.name </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> DB_PASSWORD</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> NAMESPACE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token comment" style="color:rgb(0, 128, 0)"># Helm çš„å†…ç½®å¯¹è±¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> .Release.Namespace </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> MESSAGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> .Values.application.hellok8s.message </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="192-helm-chart-çš„æ‰“åŒ…å‘å¸ƒ">19.2. helm chart çš„æ‰“åŒ…å‘å¸ƒ<a href="#192-helm-chart-çš„æ‰“åŒ…å‘å¸ƒ" class="hash-link" aria-label="19.2. helm chart çš„æ‰“åŒ…å‘å¸ƒçš„ç›´æ¥é“¾æ¥" title="19.2. helm chart çš„æ‰“åŒ…å‘å¸ƒçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>è¿™é‡Œä¸€ ä½¿ç”¨ github pages å­˜å‚¨ä¸ºä¾‹</p><p>æ‰“åŒ…å‘å¸ƒåˆ° <a href="https://artifacthub.io/" target="_blank" rel="noopener noreferrer">https://artifacthub.io/</a>  (ç±»ä¼¼ dockerhub)</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1921-æ‰‹åŠ¨æ‰“åŒ…å‘å¸ƒ">19.2.1. æ‰‹åŠ¨æ‰“åŒ…å‘å¸ƒ<a href="#1921-æ‰‹åŠ¨æ‰“åŒ…å‘å¸ƒ" class="hash-link" aria-label="19.2.1. æ‰‹åŠ¨æ‰“åŒ…å‘å¸ƒçš„ç›´æ¥é“¾æ¥" title="19.2.1. æ‰‹åŠ¨æ‰“åŒ…å‘å¸ƒçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helm package &lt;char name&gt; # å°†chartç›®å½•æ‰“åŒ…åˆ°chartå½’æ¡£ä¸­ã€‚</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo index . # å‘½ä»¤å¯ä»¥åŸºäºåŒ…å«æ‰“åŒ…chartçš„ç›®å½•ï¼Œç”Ÿæˆä»“åº“çš„ç´¢å¼•æ–‡ä»¶ index.yamlã€‚</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŒ‡å®šåŒ…è¿›è¡Œå®‰è£…ä½¿ç”¨</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade --install *.tgz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade --install hello-helm hello-helm-0.1.0.tgz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1922-åˆ©ç”¨-github-action-è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ">19.2.2. åˆ©ç”¨ github action è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ<a href="#1922-åˆ©ç”¨-github-action-è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ" class="hash-link" aria-label="19.2.2. åˆ©ç”¨ github action è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒçš„ç›´æ¥é“¾æ¥" title="19.2.2. åˆ©ç”¨ github action è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ä½¿ç”¨ <a href="https://github.com/helm/chart-releaser-action" target="_blank" rel="noopener noreferrer">char-release-action</a> è‡ªåŠ¨å‘å¸ƒ (è¯¥ action ä¼šé»˜è®¤ç”Ÿæˆ helm chart å‘å¸ƒåˆ° gh-pages åˆ†æ”¯ä¸Š)</p><p>ci.yml</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Release Charts</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">push</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">branches</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">jobs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">release</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># depending on default permission settings for your org (contents being read-only or read-write for workloads), you will have to add permissions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># see: https://docs.github.com/en/actions/security-guides/automatic-token-authentication#modifying-the-permissions-for-the-github_token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">permissions</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">contents</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> write</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">runs-on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Checkout</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> actions/checkout@v2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">with</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">fetch-depth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Configure Git</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">          git config user.name &quot;$GITHUB_ACTOR&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">          git config user.email &quot;$GITHUB_ACTOR@users.noreply.github.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Install Helm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> azure/setup</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">helm@v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">with</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v3.8.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Run chart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">releaser</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> helm/chart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">releaser</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">action@v1.4.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">with</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">charts_dir</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> helm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">charts</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">CR_TOKEN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;${{ secrets.GITHUB_TOKEN }}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="193-åŸºæœ¬å‘½ä»¤ä½¿ç”¨">19.3. åŸºæœ¬å‘½ä»¤ä½¿ç”¨<a href="#193-åŸºæœ¬å‘½ä»¤ä½¿ç”¨" class="hash-link" aria-label="19.3. åŸºæœ¬å‘½ä»¤ä½¿ç”¨çš„ç›´æ¥é“¾æ¥" title="19.3. åŸºæœ¬å‘½ä»¤ä½¿ç”¨çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># Chart ä»“åº“å…¶å®å°±æ˜¯ä¸€ä¸ªå¸¦æœ‰index.yamlç´¢å¼•æ–‡ä»¶å’Œä»»æ„ä¸ªæ‰“åŒ…çš„ Chart çš„ HTTP æœåŠ¡å™¨è€Œå·²</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å¯ä»¥åˆ©ç”¨ Github pages æ­å»ºè‡ªå·±çš„ä»“åº“</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># stable https://kubernetes-charts.storage.googleapis.com the offical repo from google</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Repos provided by Microsoft</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># stable: http://mirror.azure.cn/kubernetes/charts/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># incubator: http://mirror.azure.cn/kubernetes/charts-incubator/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># provied by bitnami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># bitnami   https://charts.bitnami.com/bitnami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># aliyun                https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ingress-nginx         https://kubernetes.github.io/ingress-nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo remove &lt;repo name&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo add &lt;repo name&gt; &lt;url&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># search from local added repo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm search repo [chart name]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># search from helm hub</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm search hub [chart name]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŸ¥çœ‹ä¸€ä¸ª chart çš„è¯¦ç»†ä¿¡æ¯</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm inspect stable/mysql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Chart name usually consists of repo_name + / + sub_name, eg. stable/mysql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å®‰è£… chart ä¼šåˆ›å»ºä¸€ä¸ªæ–° release å¯¹è±¡, é€šè¿‡ --name æŒ‡å®šåå­—</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># -f config.yaml æŒ‡å®šè‡ªå®šä¹‰é…ç½®æ–‡ä»¶</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm install [-f config.yaml] &lt;char name&gt; [--name &lt;release name&gt;]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm install &lt;release name&gt; &lt;chart name&gt; [--version 0.1.0]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#  è‡ªå·±åˆ¶ä½œå¥½ chart å, åœ¨ helm chart ç›®å½•ä¸‹æ‰§è¡Œå®‰è£…, ä¼šåˆ›å»ºå¥½ resources</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade --install hello-helm --values values.yaml .</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è·Ÿè¸ª release çŠ¶æ€æˆ–é‡æ–°è¯»å–é…ç½®ä¿¡æ¯</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm status &lt;release name&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŸ¥çœ‹ chart ä¸Šå¯é…ç½®è‡ªå®šä¹‰çš„é€‰é¡¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># é€šè¿‡ yml æ ¼å¼å®šä¹‰é…ç½®å¦‚ config.ymlå, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#   å¯ helm install -f config.yaml stable/mysql --name mydb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#   äº¦å¯ --set persistence.enabled=false æ¥è‡ªå®šä¹‰é…ç½®</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm inspect values</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ›´æ–°/å‡çº§ (config.yml ä¸­å°±æ˜¯æ›´æ–°çš„å†…å®¹)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade -f config.yaml &lt;release object&gt; &lt;chart name&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æŸ¥çœ‹ å·²ç»å®‰è£…çš„ charts list (å³å·²ç» release çš„å¯¹è±¡), åŒ…æ‹¬å·²ç»åˆ é™¤çš„</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm ls [--all]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># åˆ é™¤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ä¸ä»£è¡¨å°±å®Œå…¨åˆ é™¤äº†</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ç”±äº Helm ä¿ç•™å·²åˆ é™¤ release çš„è®°å½•ï¼Œå› æ­¤ä¸èƒ½é‡æ–°ä½¿ç”¨ release åç§°ã€‚ï¼ˆå¦‚æœ ç¡®å® éœ€è¦é‡æ–°ä½¿ç”¨æ­¤ release åç§°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ­¤ â€“replace å‚æ•°ï¼Œä½†å®ƒåªä¼šé‡ç”¨ç°æœ‰ release å¹¶æ›¿æ¢å…¶èµ„æºã€‚ï¼‰</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># --purge å½»åº•åˆ é™¤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm delete &lt;release name&gt; [--purge]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ˜¾ç¤ºè¢«åˆ é™¤æ‰ release</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm list --deleted</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm uninstall &lt;chart name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="194-rollback">19.4. rollback<a href="#194-rollback" class="hash-link" aria-label="19.4. rollbackçš„ç›´æ¥é“¾æ¥" title="19.4. rollbackçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># å…ˆæŸ¥çœ‹å†å²</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm history &lt;release object name&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ¯”å¦‚, æˆ‘ä»¬å¯¹ values.yml åšäº†ä¿®æ”¹</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># æ›´æ–° k8s èµ„æº</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade --install hello-helm --values values.yaml .</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># å‘ç°æ›´æ–°æœ‰é—®é¢˜, å›æ»šä¸Šä¸€ä¸ªç‰ˆæœ¬ (å›æ»šå REVISION ç‰ˆæœ¬éƒ½ä¼šå¢å¤§åˆ° 3 è€Œä¸æ˜¯å›æ»šåˆ° 1)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm rollback hello-helm 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="195-å¤šç¯å¢ƒ">19.5. å¤šç¯å¢ƒ<a href="#195-å¤šç¯å¢ƒ" class="hash-link" aria-label="19.5. å¤šç¯å¢ƒçš„ç›´æ¥é“¾æ¥" title="19.5. å¤šç¯å¢ƒçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>create <code>values-dev.yaml</code></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># å¯ä»¥å¤šæ¬¡æŒ‡å®š&#x27;--values æˆ–è€… -f&#x27;å‚æ•°ï¼Œæœ€åï¼ˆæœ€å³è¾¹ï¼‰æŒ‡å®šçš„æ–‡ä»¶ä¼˜å…ˆçº§æœ€é«˜</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è¿™é‡Œæœ€å³è¾¹çš„æ˜¯ values-dev.yaml æ–‡ä»¶ï¼Œæ‰€ä»¥ values-dev.yaml æ–‡ä»¶ä¸­çš„å€¼ä¼šè¦†ç›– values.yaml ä¸­ç›¸åŒçš„å€¼</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># -n dev è¡¨ç¤ºåœ¨åå­—ä¸º dev çš„ namespace ä¸­åˆ›å»º k8s èµ„æº</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade --install hello-helm -f values.yaml -f values-dev.yaml -n dev .</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># è¿˜å¯ä»¥å† cmd ä¸­ä¸´æ—¶è®¾ç½® values (æ­¤æ–¹æ³•åœ¨ CICD ä¸­ç»å¸¸ç”¨åˆ°ã€‚)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade --install hello-helm -f values.yaml -f values-dev.yaml \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --set application.hellok8s.message=&quot;It works with set helm values&quot; \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -n dev .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="20-reference-materials">20. reference materials<a href="#20-reference-materials" class="hash-link" aria-label="20. reference materialsçš„ç›´æ¥é“¾æ¥" title="20. reference materialsçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p><a href="https://github.com/techiescamp/kubernetes-learning-path" target="_blank" rel="noopener noreferrer">https://github.com/techiescamp/kubernetes-learning-path</a>
<a href="https://github.com/guangzhengli/k8s-tutorials" target="_blank" rel="noopener noreferrer">https://github.com/guangzhengli/k8s-tutorials</a></p><p><a href="https://www.bilibili.com/video/BV1Ja4y1x748" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1Ja4y1x748</a> è§†é¢‘æ•™ç¨‹
<a href="https://edu.aliyun.com/roadmap/cloudnative?from=timeline" target="_blank" rel="noopener noreferrer">https://edu.aliyun.com/roadmap/cloudnative?from=timeline</a></p><p><a href="https://github.com/caicloud/kube-ladder" target="_blank" rel="noopener noreferrer">https://github.com/caicloud/kube-ladder</a></p><p><a href="https://github.com/jpetazzo/container.training" target="_blank" rel="noopener noreferrer">https://github.com/jpetazzo/container.training</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/k-8-s">k8s</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="æ–‡æ¡£åˆ†é¡µå¯¼èˆª"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/kotlin"><div class="pagination-nav__sublabel">ä¸Šä¸€é¡µ</div><div class="pagination-nav__label">kotlin</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/linux-note"><div class="pagination-nav__sublabel">ä¸‹ä¸€é¡µ</div><div class="pagination-nav__label">é¸Ÿå“¥çš„ Linux ç§æˆ¿èœé˜…è¯»ç¬”è®°</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-é¢è¯•é—®é¢˜" class="table-of-contents__link toc-highlight">1. é¢è¯•é—®é¢˜</a></li><li><a href="#å¼€å‘è°ƒè¯•å·¥å…·" class="table-of-contents__link toc-highlight">å¼€å‘è°ƒè¯•å·¥å…·</a></li><li><a href="#2-deploying-springcloud" class="table-of-contents__link toc-highlight">2. deploying springcloud</a><ul><li><a href="#using-configmap" class="table-of-contents__link toc-highlight">using configMap</a></li><li><a href="#éƒ¨ç½²åˆ°-k8s-åè¿˜æ˜¯æœ‰ç¼ºç‚¹" class="table-of-contents__link toc-highlight">éƒ¨ç½²åˆ° k8s åè¿˜æ˜¯æœ‰ç¼ºç‚¹</a></li></ul></li><li><a href="#3-what-and-why" class="table-of-contents__link toc-highlight">3. what and why</a><ul><li><a href="#31-k8s-æ˜¯åšä»€ä¹ˆçš„" class="table-of-contents__link toc-highlight">3.1. k8s æ˜¯åšä»€ä¹ˆçš„</a></li><li><a href="#32-ä¸ºä»€ä¹ˆä½¿ç”¨" class="table-of-contents__link toc-highlight">3.2. ä¸ºä»€ä¹ˆä½¿ç”¨:</a></li><li><a href="#33-compare-with-spring-cloud" class="table-of-contents__link toc-highlight">3.3. compare with spring cloud</a></li></ul></li><li><a href="#4-æ­å»ºç¯å¢ƒ" class="table-of-contents__link toc-highlight">4. æ­å»ºç¯å¢ƒ</a><ul><li><a href="#41-ç”Ÿäº§æœåŠ¡å™¨ä¸Šå®‰è£…" class="table-of-contents__link toc-highlight">4.1. ç”Ÿäº§æœåŠ¡å™¨ä¸Šå®‰è£…</a></li><li><a href="#42-vagrant-æ­å»º-k8s-ç¯å¢ƒ" class="table-of-contents__link toc-highlight">4.2. vagrant æ­å»º k8s ç¯å¢ƒ</a></li><li><a href="#43-ä¼—å¤šçš„å‘è¡Œç‰ˆ" class="table-of-contents__link toc-highlight">4.3. ä¼—å¤šçš„å‘è¡Œç‰ˆ</a><ul><li><a href="#431-k3s" class="table-of-contents__link toc-highlight">4.3.1. k3s</a><ul><li><a href="#4311-k3d" class="table-of-contents__link toc-highlight">4.3.1.1. k3d</a></li></ul></li><li><a href="#432-k0s" class="table-of-contents__link toc-highlight">4.3.2. k0s</a></li><li><a href="#433-microk8s" class="table-of-contents__link toc-highlight">4.3.3. microk8s</a></li><li><a href="#434-docker-desktop-æ¨èä½¿ç”¨-rancher-desktop-æ›¿ä»£" class="table-of-contents__link toc-highlight">4.3.4. docker desktop (æ¨èä½¿ç”¨ rancher desktop æ›¿ä»£)</a></li><li><a href="#435-kind-æ¨èä½¿ç”¨-k3d-ä»£æ›¿" class="table-of-contents__link toc-highlight">4.3.5. kind (æ¨èä½¿ç”¨ k3d ä»£æ›¿)</a></li><li><a href="#436-minikube" class="table-of-contents__link toc-highlight">4.3.6. minikube</a></li></ul></li></ul></li><li><a href="#5-quickstart" class="table-of-contents__link toc-highlight">5. Quickstart</a><ul><li><a href="#51-ä»¥java-ä¸ºä¾‹" class="table-of-contents__link toc-highlight">5.1. ä»¥Java ä¸ºä¾‹</a></li><li><a href="#52-ä»¥-go-ä¸ºä¾‹" class="table-of-contents__link toc-highlight">5.2. ä»¥ go ä¸ºä¾‹</a><ul><li><a href="#521-using-pod-directly" class="table-of-contents__link toc-highlight">5.2.1. using pod directly</a></li><li><a href="#522-using-deployment" class="table-of-contents__link toc-highlight">5.2.2. using deployment</a></li></ul></li></ul></li><li><a href="#6-é›†ç¾¤ç»“æ„-underlying-infrastructure-åŸºç¡€è®¾æ–½" class="table-of-contents__link toc-highlight">6. é›†ç¾¤ç»“æ„ underlying infrastructure åŸºç¡€è®¾æ–½</a></li><li><a href="#7-api-ç®¡ç†çš„å„ç§èµ„æº" class="table-of-contents__link toc-highlight">7. api ç®¡ç†çš„å„ç§èµ„æº</a><ul><li><a href="#71-å„ç§èµ„æºçš„å…³ç³»" class="table-of-contents__link toc-highlight">7.1. å„ç§èµ„æºçš„å…³ç³»</a></li><li><a href="#72-3-common-properties" class="table-of-contents__link toc-highlight">7.2. 3 common properties</a><ul><li><a href="#721-metadata" class="table-of-contents__link toc-highlight">7.2.1. metadata</a></li><li><a href="#722-spec" class="table-of-contents__link toc-highlight">7.2.2. spec</a></li><li><a href="#723-status" class="table-of-contents__link toc-highlight">7.2.3. status</a></li></ul></li><li><a href="#73-node" class="table-of-contents__link toc-highlight">7.3. node</a></li><li><a href="#74-pod" class="table-of-contents__link toc-highlight">7.4. pod</a></li><li><a href="#75-label" class="table-of-contents__link toc-highlight">7.5. label</a><ul><li><a href="#751-label-selector-ä½¿ç”¨" class="table-of-contents__link toc-highlight">7.5.1. Label selector ä½¿ç”¨</a></li></ul></li><li><a href="#76-taintæ±¡ç‚¹å’Œ-tolerationå®¹å¿" class="table-of-contents__link toc-highlight">7.6. Taintï¼ˆæ±¡ç‚¹ï¼‰å’Œ Tolerationï¼ˆå®¹å¿ï¼‰</a><ul><li><a href="#761-taint" class="table-of-contents__link toc-highlight">7.6.1. taint</a></li><li><a href="#762-toleration" class="table-of-contents__link toc-highlight">7.6.2. toleration</a></li></ul></li><li><a href="#77-controllerså„ç§æ§åˆ¶å™¨" class="table-of-contents__link toc-highlight">7.7. controllers(å„ç§æ§åˆ¶å™¨)</a><ul><li><a href="#771-rc-replica-controller-å‰¯æœ¬æ§åˆ¶å™¨" class="table-of-contents__link toc-highlight">7.7.1. <del>RC (replica controller å‰¯æœ¬æ§åˆ¶å™¨)</del></a></li><li><a href="#772-rs-replica-set-ä»£æ›¿-rc" class="table-of-contents__link toc-highlight">7.7.2. RS (replica set, ä»£æ›¿ RC)</a></li><li><a href="#773-deployment-ç®¡ç†-rs" class="table-of-contents__link toc-highlight">7.7.3. Deployment (ç®¡ç† RS)</a><ul><li><a href="#7731-scale-upback-æ‰©å®¹ç¼©å®¹" class="table-of-contents__link toc-highlight">7.7.3.1. scale up/back (æ‰©å®¹ç¼©å®¹)</a></li><li><a href="#7732-version-upgrade-ç‰ˆæœ¬å‡çº§" class="table-of-contents__link toc-highlight">7.7.3.2. version upgrade (ç‰ˆæœ¬å‡çº§)</a></li><li><a href="#7733-rolling-update-æ»šåŠ¨å‡çº§" class="table-of-contents__link toc-highlight">7.7.3.3. rolling update (æ»šåŠ¨å‡çº§)</a></li><li><a href="#7734-å›æ»š-ç‰ˆæœ¬å›é€€-æŸ¥çœ‹å†å²" class="table-of-contents__link toc-highlight">7.7.3.4. å›æ»š ç‰ˆæœ¬å›é€€ æŸ¥çœ‹å†å²</a></li><li><a href="#7735-livenessprobe-å­˜æ´»æ¢é’ˆ" class="table-of-contents__link toc-highlight">7.7.3.5. livenessProbe (å­˜æ´»æ¢é’ˆ)</a></li><li><a href="#7736-readinessprobe-å°±ç»ªæ¢é’ˆ" class="table-of-contents__link toc-highlight">7.7.3.6. readinessProbe (å°±ç»ªæ¢é’ˆ)</a></li></ul></li><li><a href="#774-sc-stateful-set" class="table-of-contents__link toc-highlight">7.7.4. SC (stateful set)</a><ul><li><a href="#7741-æ•°æ®æŒä¹…åŒ–-persist" class="table-of-contents__link toc-highlight">7.7.4.1. æ•°æ®æŒä¹…åŒ– persist</a></li></ul></li><li><a href="#775-ds-daemon-set-åå°æ”¯æ’‘æœåŠ¡é›†" class="table-of-contents__link toc-highlight">7.7.5. DS (daemon set åå°æ”¯æ’‘æœåŠ¡é›†)</a></li><li><a href="#776-job-ä¸€æ¬¡æ€§ä»»åŠ¡" class="table-of-contents__link toc-highlight">7.7.6. job (ä¸€æ¬¡æ€§ä»»åŠ¡)</a></li><li><a href="#777-cronjob-å®šæ—¶ä»»åŠ¡" class="table-of-contents__link toc-highlight">7.7.7. cronjob (å®šæ—¶ä»»åŠ¡)</a></li></ul></li><li><a href="#78-service" class="table-of-contents__link toc-highlight">7.8. service</a><ul><li><a href="#781-endpoint" class="table-of-contents__link toc-highlight">7.8.1. Endpoint</a></li><li><a href="#782-å¤šç«¯å£" class="table-of-contents__link toc-highlight">7.8.2. å¤šç«¯å£</a></li><li><a href="#783-clusterip-é»˜è®¤ä½¿ç”¨çš„ç±»å‹" class="table-of-contents__link toc-highlight">7.8.3. ClusterIP (é»˜è®¤ä½¿ç”¨çš„ç±»å‹)</a><ul><li><a href="#7831-headless" class="table-of-contents__link toc-highlight">7.8.3.1. Headless</a></li></ul></li><li><a href="#784-nodeport" class="table-of-contents__link toc-highlight">7.8.4. NodePort</a></li><li><a href="#785-loadbalancer" class="table-of-contents__link toc-highlight">7.8.5. LoadBalancer</a></li><li><a href="#786-externalname" class="table-of-contents__link toc-highlight">7.8.6. ExternalName</a></li><li><a href="#787-æ‰‹åŠ¨ç«¯å£è½¬å‘" class="table-of-contents__link toc-highlight">7.8.7. æ‰‹åŠ¨ç«¯å£è½¬å‘</a></li><li><a href="#788-service-å¦‚ä½•å·¥ä½œ" class="table-of-contents__link toc-highlight">7.8.8. service å¦‚ä½•å·¥ä½œ</a></li></ul></li><li><a href="#79-ingress" class="table-of-contents__link toc-highlight">7.9. ingress</a><ul><li><a href="#791-install-ingress-nginx" class="table-of-contents__link toc-highlight">7.9.1. install ingress-nginx</a></li><li><a href="#792-traefik" class="table-of-contents__link toc-highlight">7.9.2. Traefik</a></li></ul></li><li><a href="#710-volume" class="table-of-contents__link toc-highlight">7.10. volume</a></li><li><a href="#711-secret" class="table-of-contents__link toc-highlight">7.11. secret</a></li><li><a href="#712-config-map" class="table-of-contents__link toc-highlight">7.12. config map</a></li><li><a href="#713-flannel" class="table-of-contents__link toc-highlight">7.13. flannel</a></li><li><a href="#714-name" class="table-of-contents__link toc-highlight">7.14. name</a></li><li><a href="#715-name-namespace-ç”¨æ¥åˆ’åˆ†å¤šç¯å¢ƒ" class="table-of-contents__link toc-highlight">7.15. name namespace (ç”¨æ¥åˆ’åˆ†å¤šç¯å¢ƒ)</a></li></ul></li><li><a href="#8-åƒåœ¾å›æ”¶" class="table-of-contents__link toc-highlight">8. åƒåœ¾å›æ”¶</a><ul><li><a href="#81-çº§è”åˆ é™¤" class="table-of-contents__link toc-highlight">8.1. çº§è”åˆ é™¤</a></li><li><a href="#82-å­¤å„¿åˆ é™¤-orphan" class="table-of-contents__link toc-highlight">8.2. å­¤å„¿åˆ é™¤ orphan</a></li></ul></li><li><a href="#9-èµ„æºæè¿°æ–‡ä»¶" class="table-of-contents__link toc-highlight">9. èµ„æºæè¿°æ–‡ä»¶</a><ul><li><a href="#91-æŸ¥çœ‹å±æ€§è¯´æ˜" class="table-of-contents__link toc-highlight">9.1. æŸ¥çœ‹å±æ€§è¯´æ˜</a></li><li><a href="#92-é€šè¿‡å‘½ä»¤ç”Ÿæˆ-yml" class="table-of-contents__link toc-highlight">9.2. é€šè¿‡å‘½ä»¤ç”Ÿæˆ yml</a></li><li><a href="#93-pod-çš„-yaml-æè¿°æ–‡ä»¶" class="table-of-contents__link toc-highlight">9.3. pod çš„ yaml æè¿°æ–‡ä»¶</a></li><li><a href="#94-deployment-çš„æè¿°æ–‡ä»¶" class="table-of-contents__link toc-highlight">9.4. deployment çš„æè¿°æ–‡ä»¶</a></li><li><a href="#95-service" class="table-of-contents__link toc-highlight">9.5. service</a></li></ul></li><li><a href="#10-æ³¨è§£" class="table-of-contents__link toc-highlight">10. æ³¨è§£</a></li><li><a href="#11-å‘½åç©ºé—´" class="table-of-contents__link toc-highlight">11. å‘½åç©ºé—´</a></li><li><a href="#12-pod-ç®¡ç†" class="table-of-contents__link toc-highlight">12. pod ç®¡ç†</a><ul><li><a href="#121-æ¢æµ‹-pod-æ˜¯å¦å¥åº·" class="table-of-contents__link toc-highlight">12.1. æ¢æµ‹ pod æ˜¯å¦å¥åº·</a></li><li><a href="#122-pod-å‰¯æœ¬" class="table-of-contents__link toc-highlight">12.2. pod å‰¯æœ¬</a></li><li><a href="#123-è¿è¡Œå•ä¸ªä»»åŠ¡-job" class="table-of-contents__link toc-highlight">12.3. è¿è¡Œå•ä¸ªä»»åŠ¡ Job</a></li><li><a href="#124-å®šæ—¶ä»»åŠ¡-cronjob" class="table-of-contents__link toc-highlight">12.4. å®šæ—¶ä»»åŠ¡ CronJob</a></li></ul></li><li><a href="#13-pod-é€šä¿¡" class="table-of-contents__link toc-highlight">13. pod é€šä¿¡</a><ul><li><a href="#131-proxy" class="table-of-contents__link toc-highlight">13.1. proxy</a></li><li><a href="#132-service" class="table-of-contents__link toc-highlight">13.2. Service</a></li><li><a href="#133-pod-é—´é€šä¿¡" class="table-of-contents__link toc-highlight">13.3. pod é—´é€šä¿¡</a></li><li><a href="#134-é€šè¿‡-service-è¿æ¥å¤–éƒ¨æœåŠ¡" class="table-of-contents__link toc-highlight">13.4. é€šè¿‡ Service è¿æ¥å¤–éƒ¨æœåŠ¡</a><ul><li><a href="#1341-é€šè¿‡æ‰‹åŠ¨ç”Ÿæˆ-endpoint" class="table-of-contents__link toc-highlight">13.4.1. é€šè¿‡æ‰‹åŠ¨ç”Ÿæˆ endpoint</a></li><li><a href="#1342-é€šè¿‡-externalname-ç±»å‹çš„-service" class="table-of-contents__link toc-highlight">13.4.2. é€šè¿‡ externalName ç±»å‹çš„ Service</a></li></ul></li><li><a href="#135-å°†æœåŠ¡æš´éœ²ç»™å¤–éƒ¨" class="table-of-contents__link toc-highlight">13.5. å°†æœåŠ¡æš´éœ²ç»™å¤–éƒ¨</a><ul><li><a href="#1351-å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ-nodeport" class="table-of-contents__link toc-highlight">13.5.1. å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ NodePort</a></li><li><a href="#1352-å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ-loadbalance" class="table-of-contents__link toc-highlight">13.5.2. å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆ LoadBalance</a></li><li><a href="#1353-åˆ›å»ºä¸€-ä¸ª-ingress-èµ„æº" class="table-of-contents__link toc-highlight">13.5.3. åˆ›å»ºä¸€ ä¸ª Ingress èµ„æº</a></li></ul></li></ul></li><li><a href="#14-å‘½ä»¤" class="table-of-contents__link toc-highlight">14. å‘½ä»¤</a><ul><li><a href="#141-kubectl" class="table-of-contents__link toc-highlight">14.1. kubectl</a><ul><li><a href="#1411-åŸºæœ¬ä¿¡æ¯" class="table-of-contents__link toc-highlight">14.1.1. åŸºæœ¬ä¿¡æ¯</a></li><li><a href="#1412-åˆ›å»º-create-expose" class="table-of-contents__link toc-highlight">14.1.2. åˆ›å»º create expose</a></li><li><a href="#1413-æ‰§è¡Œå‘½ä»¤åˆ°å®¹å™¨-exec" class="table-of-contents__link toc-highlight">14.1.3. æ‰§è¡Œå‘½ä»¤åˆ°å®¹å™¨ exec</a></li><li><a href="#1414-ä¿®æ”¹" class="table-of-contents__link toc-highlight">14.1.4. ä¿®æ”¹</a></li><li><a href="#1415-èµ„æºåˆ—è¡¨-get" class="table-of-contents__link toc-highlight">14.1.5. èµ„æºåˆ—è¡¨ get</a></li><li><a href="#1416-æŸ¥è¯¢è¯¦ç»†æè¿°-describe" class="table-of-contents__link toc-highlight">14.1.6. æŸ¥è¯¢è¯¦ç»†æè¿° describe</a></li><li><a href="#1417-æŸ¥è¯¢æ—¥å¿—-logs" class="table-of-contents__link toc-highlight">14.1.7. æŸ¥è¯¢æ—¥å¿— logs</a></li><li><a href="#1418-åˆ é™¤-delete" class="table-of-contents__link toc-highlight">14.1.8. åˆ é™¤ delete</a></li><li><a href="#1419-æ“ä½œä¸Šä¸‹æ–‡" class="table-of-contents__link toc-highlight">14.1.9. æ“ä½œä¸Šä¸‹æ–‡</a></li></ul></li><li><a href="#142-kubeadmin" class="table-of-contents__link toc-highlight">14.2. kubeadmin</a></li></ul></li><li><a href="#15-cka-ckad-è¯ä¹¦è€ƒè¯•" class="table-of-contents__link toc-highlight">15. cka ckad è¯ä¹¦è€ƒè¯•</a></li><li><a href="#16-dashboard" class="table-of-contents__link toc-highlight">16. dashboard</a><ul><li><a href="#161-k9s" class="table-of-contents__link toc-highlight">16.1. k9s</a></li><li><a href="#162-kuboard" class="table-of-contents__link toc-highlight">16.2. kuboard</a></li><li><a href="#163-kubernetes-dashboard" class="table-of-contents__link toc-highlight">16.3. kubernetes-dashboard</a></li><li><a href="#164-kubesphere-æ¨è" class="table-of-contents__link toc-highlight">16.4. kubesphere (æ¨è)</a></li></ul></li><li><a href="#17-rancher" class="table-of-contents__link toc-highlight">17. rancher</a></li><li><a href="#18-harbor" class="table-of-contents__link toc-highlight">18. Harbor</a></li><li><a href="#19-helm" class="table-of-contents__link toc-highlight">19. Helm</a><ul><li><a href="#191-how-to-create-helm-chart" class="table-of-contents__link toc-highlight">19.1. How to create helm chart</a></li><li><a href="#192-helm-chart-çš„æ‰“åŒ…å‘å¸ƒ" class="table-of-contents__link toc-highlight">19.2. helm chart çš„æ‰“åŒ…å‘å¸ƒ</a><ul><li><a href="#1921-æ‰‹åŠ¨æ‰“åŒ…å‘å¸ƒ" class="table-of-contents__link toc-highlight">19.2.1. æ‰‹åŠ¨æ‰“åŒ…å‘å¸ƒ</a></li><li><a href="#1922-åˆ©ç”¨-github-action-è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ" class="table-of-contents__link toc-highlight">19.2.2. åˆ©ç”¨ github action è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ</a></li></ul></li><li><a href="#193-åŸºæœ¬å‘½ä»¤ä½¿ç”¨" class="table-of-contents__link toc-highlight">19.3. åŸºæœ¬å‘½ä»¤ä½¿ç”¨</a></li><li><a href="#194-rollback" class="table-of-contents__link toc-highlight">19.4. rollback</a></li><li><a href="#195-å¤šç¯å¢ƒ" class="table-of-contents__link toc-highlight">19.5. å¤šç¯å¢ƒ</a></li></ul></li><li><a href="#20-reference-materials" class="table-of-contents__link toc-highlight">20. reference materials</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">å†å²</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tags">æ ‡ç­¾</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">å½’æ¡£</a></li></ul></div><div class="col footer__col"><div class="footer__title">ç¤¾äº¤åª’ä½“</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">å…³äºæˆ‘</a></li><li class="footer__item"><a href="https://github.com/xiaoyureed" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/xiaoyuhfq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/3fPgwd3naN" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">æ›´å¤š</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/friends">å‹é“¾</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/resource">å¯¼èˆª</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Xiaoyureed, Inc. Built with â¤ï¸ by xiaoyu.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.831ed87f.js"></script>
<script src="/assets/js/main.d4aae7e0.js"></script>
</body>
</html>