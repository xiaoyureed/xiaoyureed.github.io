"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[1867],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return d}});var a=t(67294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var i=a.createContext({}),s=function(e){var n=a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=s(e.components);return a.createElement(i.Provider,{value:n},e.children)},k={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,r=e.originalType,i=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),u=s(t),d=l,m=u["".concat(i,".").concat(d)]||u[d]||k[d]||r;return t?a.createElement(m,o(o({ref:n},c),{},{components:t})):a.createElement(m,o({ref:n},c))}));function d(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=t.length,o=new Array(r);o[0]=u;var p={};for(var i in n)hasOwnProperty.call(n,i)&&(p[i]=n[i]);p.originalType=e,p.mdxType="string"==typeof e?e:l,o[1]=p;for(var s=2;s<r;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},3419:function(e,n,t){t.r(n),t.d(n,{assets:function(){return c},contentTitle:function(){return i},default:function(){return d},frontMatter:function(){return p},metadata:function(){return s},toc:function(){return k}});var a=t(83117),l=t(80102),r=(t(67294),t(3905)),o=["components"],p={title:"kubernetes-k8s \u2601\ufe0f",date:new Date("2019-04-06T00:00:00.000Z"),tags:["k8s"],toc_min_heading_level:2,toc_max_heading_level:5},i=void 0,s={unversionedId:"kubernetes-k8s",id:"kubernetes-k8s",title:"kubernetes-k8s \u2601\ufe0f",description:"- 1. \u9762\u8bd5\u95ee\u9898",source:"@site/docs/kubernetes-k8s.md",sourceDirName:".",slug:"/kubernetes-k8s",permalink:"/docs/kubernetes-k8s",draft:!1,tags:[{label:"k8s",permalink:"/docs/tags/k-8-s"}],version:"current",frontMatter:{title:"kubernetes-k8s \u2601\ufe0f",date:"2019-04-06T00:00:00.000Z",tags:["k8s"],toc_min_heading_level:2,toc_max_heading_level:5},sidebar:"tutorialSidebar",previous:{title:"kotlin",permalink:"/docs/kotlin"},next:{title:"\u9e1f\u54e5\u7684 Linux \u79c1\u623f\u83dc\u9605\u8bfb\u7b14\u8bb0",permalink:"/docs/linux-note"}},c={},k=[{value:"1. \u9762\u8bd5\u95ee\u9898",id:"1-\u9762\u8bd5\u95ee\u9898",level:2},{value:"2. what and why",id:"2-what-and-why",level:2},{value:"2.1. k8s \u662f\u505a\u4ec0\u4e48\u7684",id:"21-k8s-\u662f\u505a\u4ec0\u4e48\u7684",level:3},{value:"2.2. \u4e3a\u4ec0\u4e48\u4f7f\u7528:",id:"22-\u4e3a\u4ec0\u4e48\u4f7f\u7528",level:3},{value:"compare with spring cloud",id:"compare-with-spring-cloud",level:3},{value:"3. \u642d\u5efa\u73af\u5883",id:"3-\u642d\u5efa\u73af\u5883",level:2},{value:"3.1. \u751f\u4ea7\u670d\u52a1\u5668\u4e0a\u5b89\u88c5",id:"31-\u751f\u4ea7\u670d\u52a1\u5668\u4e0a\u5b89\u88c5",level:3},{value:"3.2. vagrant \u642d\u5efa k8s \u73af\u5883",id:"32-vagrant-\u642d\u5efa-k8s-\u73af\u5883",level:3},{value:"3.3. \u4f17\u591a\u7684\u53d1\u884c\u7248",id:"33-\u4f17\u591a\u7684\u53d1\u884c\u7248",level:3},{value:"3.3.1. k3s",id:"331-k3s",level:4},{value:"3.3.2. k0s",id:"332-k0s",level:4},{value:"3.3.3. microk8s",id:"333-microk8s",level:4},{value:"3.3.4. docker desktop",id:"334-docker-desktop",level:4},{value:"3.3.5. kind",id:"335-kind",level:4},{value:"3.3.6. minikube",id:"336-minikube",level:4},{value:"4. Quickstart",id:"4-quickstart",level:2},{value:"4.1. \u4ee5Java \u4e3a\u4f8b",id:"41-\u4ee5java-\u4e3a\u4f8b",level:3},{value:"4.2. \u4ee5 go \u4e3a\u4f8b",id:"42-\u4ee5-go-\u4e3a\u4f8b",level:3},{value:"4.2.1. using pod directly",id:"421-using-pod-directly",level:4},{value:"4.2.2. using deployment",id:"422-using-deployment",level:4},{value:"5. \u96c6\u7fa4\u7ed3\u6784 underlying infrastructure \u57fa\u7840\u8bbe\u65bd",id:"5-\u96c6\u7fa4\u7ed3\u6784-underlying-infrastructure-\u57fa\u7840\u8bbe\u65bd",level:2},{value:"5.1. control plane \u63a7\u5236\u5e73\u9762",id:"51-control-plane-\u63a7\u5236\u5e73\u9762",level:3},{value:"5.2. computer machines (\u8ba1\u7b97\u8282\u70b9 Node)",id:"52-computer-machines-\u8ba1\u7b97\u8282\u70b9-node",level:3},{value:"6. api \u7ba1\u7406\u7684\u5404\u79cd\u8d44\u6e90",id:"6-api-\u7ba1\u7406\u7684\u5404\u79cd\u8d44\u6e90",level:2},{value:"6.1. \u5404\u79cd\u8d44\u6e90\u7684\u5173\u7cfb",id:"61-\u5404\u79cd\u8d44\u6e90\u7684\u5173\u7cfb",level:3},{value:"6.2. 3 common properties",id:"62-3-common-properties",level:3},{value:"6.2.1. metadata",id:"621-metadata",level:4},{value:"6.2.2. spec",id:"622-spec",level:4},{value:"6.2.3. status",id:"623-status",level:4},{value:"6.3. node",id:"63-node",level:3},{value:"6.4. pod",id:"64-pod",level:3},{value:"6.5. label",id:"65-label",level:3},{value:"6.5.1. Label selector \u4f7f\u7528",id:"651-label-selector-\u4f7f\u7528",level:4},{value:"6.6. Taint\uff08\u6c61\u70b9\uff09\u548c Toleration\uff08\u5bb9\u5fcd\uff09",id:"66-taint\u6c61\u70b9\u548c-toleration\u5bb9\u5fcd",level:3},{value:"6.6.1. taint",id:"661-taint",level:4},{value:"6.6.2. toleration",id:"662-toleration",level:4},{value:"6.7. controllers(\u5404\u79cd\u63a7\u5236\u5668)",id:"67-controllers\u5404\u79cd\u63a7\u5236\u5668",level:3},{value:"6.7.1. <del>RC (replica controller \u526f\u672c\u63a7\u5236\u5668)</del>",id:"671-rc-replica-controller-\u526f\u672c\u63a7\u5236\u5668",level:4},{value:"6.7.2. RS (replica set, \u4ee3\u66ff RC)",id:"672-rs-replica-set-\u4ee3\u66ff-rc",level:4},{value:"6.7.3. Deployment (\u7ba1\u7406 RS)",id:"673-deployment-\u7ba1\u7406-rs",level:4},{value:"6.7.3.1. scale up/back (\u6269\u5bb9\u7f29\u5bb9)",id:"6731-scale-upback-\u6269\u5bb9\u7f29\u5bb9",level:5},{value:"6.7.3.2. version upgrade (\u7248\u672c\u5347\u7ea7)",id:"6732-version-upgrade-\u7248\u672c\u5347\u7ea7",level:5},{value:"6.7.3.3. rolling update (\u6eda\u52a8\u5347\u7ea7)",id:"6733-rolling-update-\u6eda\u52a8\u5347\u7ea7",level:5},{value:"6.7.3.4. \u56de\u6eda \u7248\u672c\u56de\u9000 \u67e5\u770b\u5386\u53f2",id:"6734-\u56de\u6eda-\u7248\u672c\u56de\u9000-\u67e5\u770b\u5386\u53f2",level:5},{value:"6.7.3.5. livenessProbe (\u5b58\u6d3b\u63a2\u9488)",id:"6735-livenessprobe-\u5b58\u6d3b\u63a2\u9488",level:5},{value:"6.7.3.6. readinessProbe (\u5c31\u7eea\u63a2\u9488)",id:"6736-readinessprobe-\u5c31\u7eea\u63a2\u9488",level:5},{value:"6.7.4. SC (stateful set)",id:"674-sc-stateful-set",level:4},{value:"6.7.4.1. \u6570\u636e\u6301\u4e45\u5316 persist",id:"6741-\u6570\u636e\u6301\u4e45\u5316-persist",level:5},{value:"6.7.5. DS (daemon set \u540e\u53f0\u652f\u6491\u670d\u52a1\u96c6)",id:"675-ds-daemon-set-\u540e\u53f0\u652f\u6491\u670d\u52a1\u96c6",level:4},{value:"6.7.6. job (\u4e00\u6b21\u6027\u4efb\u52a1)",id:"676-job-\u4e00\u6b21\u6027\u4efb\u52a1",level:4},{value:"6.7.7. cronjob (\u5b9a\u65f6\u4efb\u52a1)",id:"677-cronjob-\u5b9a\u65f6\u4efb\u52a1",level:4},{value:"6.8. service",id:"68-service",level:3},{value:"6.8.1. Endpoint",id:"681-endpoint",level:4},{value:"6.8.2. \u591a\u7aef\u53e3",id:"682-\u591a\u7aef\u53e3",level:4},{value:"6.8.3. \u5404\u79cd service port \u7c7b\u578b",id:"683-\u5404\u79cd-service-port-\u7c7b\u578b",level:4},{value:"6.8.4. ClusterIP (\u9ed8\u8ba4\u4f7f\u7528\u7684\u7c7b\u578b)",id:"684-clusterip-\u9ed8\u8ba4\u4f7f\u7528\u7684\u7c7b\u578b",level:4},{value:"6.8.4.1. Headless",id:"6841-headless",level:5},{value:"6.8.5. NodePort",id:"685-nodeport",level:4},{value:"6.8.6. LoadBalancer",id:"686-loadbalancer",level:4},{value:"6.8.7. ExternalName",id:"687-externalname",level:4},{value:"6.8.8. \u624b\u52a8\u7aef\u53e3\u8f6c\u53d1",id:"688-\u624b\u52a8\u7aef\u53e3\u8f6c\u53d1",level:4},{value:"6.8.9. service \u5982\u4f55\u5de5\u4f5c",id:"689-service-\u5982\u4f55\u5de5\u4f5c",level:4},{value:"6.9. ingress",id:"69-ingress",level:3},{value:"6.9.1. Traefik",id:"691-traefik",level:4},{value:"6.10. volume",id:"610-volume",level:3},{value:"6.11. secret",id:"611-secret",level:3},{value:"6.12. config map",id:"612-config-map",level:3},{value:"6.13. flannel",id:"613-flannel",level:3},{value:"6.14. name",id:"614-name",level:3},{value:"6.15. name namespace (\u7528\u6765\u5212\u5206\u591a\u73af\u5883)",id:"615-name-namespace-\u7528\u6765\u5212\u5206\u591a\u73af\u5883",level:3},{value:"7. \u5783\u573e\u56de\u6536",id:"7-\u5783\u573e\u56de\u6536",level:2},{value:"7.1. \u7ea7\u8054\u5220\u9664",id:"71-\u7ea7\u8054\u5220\u9664",level:3},{value:"7.2. \u5b64\u513f\u5220\u9664 orphan",id:"72-\u5b64\u513f\u5220\u9664-orphan",level:3},{value:"8. \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6",id:"8-\u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6",level:2},{value:"8.1. \u901a\u8fc7\u547d\u4ee4\u751f\u6210 yml",id:"81-\u901a\u8fc7\u547d\u4ee4\u751f\u6210-yml",level:3},{value:"8.2. pod \u7684 yaml \u63cf\u8ff0\u6587\u4ef6",id:"82-pod-\u7684-yaml-\u63cf\u8ff0\u6587\u4ef6",level:3},{value:"8.3. deployment \u7684\u63cf\u8ff0\u6587\u4ef6",id:"83-deployment-\u7684\u63cf\u8ff0\u6587\u4ef6",level:3},{value:"8.4. service",id:"84-service",level:3},{value:"9. \u6ce8\u89e3",id:"9-\u6ce8\u89e3",level:2},{value:"10. \u547d\u540d\u7a7a\u95f4",id:"10-\u547d\u540d\u7a7a\u95f4",level:2},{value:"11. pod \u7ba1\u7406",id:"11-pod-\u7ba1\u7406",level:2},{value:"11.1. \u63a2\u6d4b pod \u662f\u5426\u5065\u5eb7",id:"111-\u63a2\u6d4b-pod-\u662f\u5426\u5065\u5eb7",level:3},{value:"11.2. pod \u526f\u672c",id:"112-pod-\u526f\u672c",level:3},{value:"11.3. \u8fd0\u884c\u5355\u4e2a\u4efb\u52a1 Job",id:"113-\u8fd0\u884c\u5355\u4e2a\u4efb\u52a1-job",level:3},{value:"11.4. \u5b9a\u65f6\u4efb\u52a1 CronJob",id:"114-\u5b9a\u65f6\u4efb\u52a1-cronjob",level:3},{value:"12. pod \u901a\u4fe1",id:"12-pod-\u901a\u4fe1",level:2},{value:"12.1. proxy",id:"121-proxy",level:3},{value:"12.2. Service",id:"122-service",level:3},{value:"12.3. pod \u95f4\u901a\u4fe1",id:"123-pod-\u95f4\u901a\u4fe1",level:3},{value:"12.4. \u901a\u8fc7 Service \u8fde\u63a5\u5916\u90e8\u670d\u52a1",id:"124-\u901a\u8fc7-service-\u8fde\u63a5\u5916\u90e8\u670d\u52a1",level:3},{value:"12.4.1. \u901a\u8fc7\u624b\u52a8\u751f\u6210 endpoint",id:"1241-\u901a\u8fc7\u624b\u52a8\u751f\u6210-endpoint",level:4},{value:"12.4.2. \u901a\u8fc7 externalName \u7c7b\u578b\u7684 Service",id:"1242-\u901a\u8fc7-externalname-\u7c7b\u578b\u7684-service",level:4},{value:"12.5. \u5c06\u670d\u52a1\u66b4\u9732\u7ed9\u5916\u90e8",id:"125-\u5c06\u670d\u52a1\u66b4\u9732\u7ed9\u5916\u90e8",level:3},{value:"12.5.1. \u5c06\u670d\u52a1\u7684\u7c7b\u578b\u8bbe\u7f6e\u6210 NodePort",id:"1251-\u5c06\u670d\u52a1\u7684\u7c7b\u578b\u8bbe\u7f6e\u6210-nodeport",level:4},{value:"12.5.2. \u5c06\u670d\u52a1\u7684\u7c7b\u578b\u8bbe\u7f6e\u6210 LoadBalance",id:"1252-\u5c06\u670d\u52a1\u7684\u7c7b\u578b\u8bbe\u7f6e\u6210-loadbalance",level:4},{value:"12.5.3. \u521b\u5efa\u4e00 \u4e2a Ingress \u8d44\u6e90",id:"1253-\u521b\u5efa\u4e00-\u4e2a-ingress-\u8d44\u6e90",level:4},{value:"13. \u547d\u4ee4",id:"13-\u547d\u4ee4",level:2},{value:"13.1. kubectl",id:"131-kubectl",level:3},{value:"13.1.1. \u57fa\u672c\u4fe1\u606f",id:"1311-\u57fa\u672c\u4fe1\u606f",level:4},{value:"13.1.2. \u521b\u5efa create expose",id:"1312-\u521b\u5efa-create-expose",level:4},{value:"13.1.3. \u6267\u884c\u547d\u4ee4\u5230\u5bb9\u5668 exec",id:"1313-\u6267\u884c\u547d\u4ee4\u5230\u5bb9\u5668-exec",level:4},{value:"13.1.4. \u4fee\u6539",id:"1314-\u4fee\u6539",level:4},{value:"13.1.5. \u8d44\u6e90\u5217\u8868 get",id:"1315-\u8d44\u6e90\u5217\u8868-get",level:4},{value:"13.1.6. \u67e5\u8be2\u8be6\u7ec6\u63cf\u8ff0 describe",id:"1316-\u67e5\u8be2\u8be6\u7ec6\u63cf\u8ff0-describe",level:4},{value:"13.1.7. \u67e5\u8be2\u65e5\u5fd7 logs",id:"1317-\u67e5\u8be2\u65e5\u5fd7-logs",level:4},{value:"13.1.8. \u5220\u9664 delete",id:"1318-\u5220\u9664-delete",level:4},{value:"13.2. kubeadmin",id:"132-kubeadmin",level:3},{value:"14. cka ckad \u8bc1\u4e66\u8003\u8bd5",id:"14-cka-ckad-\u8bc1\u4e66\u8003\u8bd5",level:2},{value:"15. dashboard",id:"15-dashboard",level:2},{value:"15.1. k9s",id:"151-k9s",level:3},{value:"15.2. kuboard",id:"152-kuboard",level:3},{value:"15.3. kubernetes-dashboard",id:"153-kubernetes-dashboard",level:3},{value:"15.4. kubesphere (\u63a8\u8350)",id:"154-kubesphere-\u63a8\u8350",level:3},{value:"15.5. rancher",id:"155-rancher",level:3},{value:"16. Harbor",id:"16-harbor",level:2},{value:"17. Helm",id:"17-helm",level:2},{value:"17.1. How to create helm chart",id:"171-how-to-create-helm-chart",level:3},{value:"17.2. helm chart \u7684\u6253\u5305\u53d1\u5e03",id:"172-helm-chart-\u7684\u6253\u5305\u53d1\u5e03",level:3},{value:"17.2.1. \u624b\u52a8\u6253\u5305\u53d1\u5e03",id:"1721-\u624b\u52a8\u6253\u5305\u53d1\u5e03",level:4},{value:"17.2.2. \u5229\u7528 github action \u81ea\u52a8\u6253\u5305\u53d1\u5e03",id:"1722-\u5229\u7528-github-action-\u81ea\u52a8\u6253\u5305\u53d1\u5e03",level:4},{value:"17.3. \u57fa\u672c\u4f7f\u7528",id:"173-\u57fa\u672c\u4f7f\u7528",level:3},{value:"17.4. rollback",id:"174-rollback",level:3},{value:"17.5. \u591a\u73af\u5883",id:"175-\u591a\u73af\u5883",level:3},{value:"18. reference materials",id:"18-reference-materials",level:2}],u={toc:k};function d(e){var n=e.components,p=(0,l.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},u,p,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1-%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98"},"1. \u9762\u8bd5\u95ee\u9898")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#2-what-and-why"},"2. what and why"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#21-k8s-%E6%98%AF%E5%81%9A%E4%BB%80%E4%B9%88%E7%9A%84"},"2.1. k8s \u662f\u505a\u4ec0\u4e48\u7684")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#22-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8"},"2.2. \u4e3a\u4ec0\u4e48\u4f7f\u7528:")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#compare-with-spring-cloud"},"compare with spring cloud")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#3-%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83"},"3. \u642d\u5efa\u73af\u5883"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#31-%E7%94%9F%E4%BA%A7%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E5%AE%89%E8%A3%85"},"3.1. \u751f\u4ea7\u670d\u52a1\u5668\u4e0a\u5b89\u88c5")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#32-vagrant-%E6%90%AD%E5%BB%BA-k8s-%E7%8E%AF%E5%A2%83"},"3.2. vagrant \u642d\u5efa k8s \u73af\u5883")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#33-%E4%BC%97%E5%A4%9A%E7%9A%84%E5%8F%91%E8%A1%8C%E7%89%88"},"3.3. \u4f17\u591a\u7684\u53d1\u884c\u7248"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#331-k3s"},"3.3.1. k3s")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#332-k0s"},"3.3.2. k0s")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#333-microk8s"},"3.3.3. microk8s")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#334-docker-desktop"},"3.3.4. docker desktop")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#335-kind"},"3.3.5. kind")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#336-minikube"},"3.3.6. minikube")))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#4-quickstart"},"4. Quickstart"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#41-%E4%BB%A5java-%E4%B8%BA%E4%BE%8B"},"4.1. \u4ee5Java \u4e3a\u4f8b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#42-%E4%BB%A5-go-%E4%B8%BA%E4%BE%8B"},"4.2. \u4ee5 go \u4e3a\u4f8b"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#421-using-pod-directly"},"4.2.1. using pod directly")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#422-using-deployment"},"4.2.2. using deployment")))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#5-%E9%9B%86%E7%BE%A4%E7%BB%93%E6%9E%84-underlying-infrastructure-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD"},"5. \u96c6\u7fa4\u7ed3\u6784 underlying infrastructure \u57fa\u7840\u8bbe\u65bd"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#51-control-plane-%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2"},"5.1. control plane \u63a7\u5236\u5e73\u9762")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#52-computer-machines-%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9-node"},"5.2. computer machines (\u8ba1\u7b97\u8282\u70b9 Node)")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6-api-%E7%AE%A1%E7%90%86%E7%9A%84%E5%90%84%E7%A7%8D%E8%B5%84%E6%BA%90"},"6. api \u7ba1\u7406\u7684\u5404\u79cd\u8d44\u6e90"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#61-%E5%90%84%E7%A7%8D%E8%B5%84%E6%BA%90%E7%9A%84%E5%85%B3%E7%B3%BB"},"6.1. \u5404\u79cd\u8d44\u6e90\u7684\u5173\u7cfb")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#62-3-common-properties"},"6.2. 3 common properties"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#621-metadata"},"6.2.1. metadata")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#622-spec"},"6.2.2. spec")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#623-status"},"6.2.3. status")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#63-node"},"6.3. node")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#64-pod"},"6.4. pod")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#65-label"},"6.5. label"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#651-label-selector-%E4%BD%BF%E7%94%A8"},"6.5.1. Label selector \u4f7f\u7528")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#66-taint%E6%B1%A1%E7%82%B9%E5%92%8C-toleration%E5%AE%B9%E5%BF%8D"},"6.6. Taint\uff08\u6c61\u70b9\uff09\u548c Toleration\uff08\u5bb9\u5fcd\uff09"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#661-taint"},"6.6.1. taint")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#662-toleration"},"6.6.2. toleration")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#67-controllers%E5%90%84%E7%A7%8D%E6%8E%A7%E5%88%B6%E5%99%A8"},"6.7. controllers(\u5404\u79cd\u63a7\u5236\u5668)"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#671-rc-replica-controller-%E5%89%AF%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%99%A8"},"6.7.1. ",(0,r.kt)("del",{parentName:"a"},"RC (replica controller \u526f\u672c\u63a7\u5236\u5668)"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#672-rs-replica-set-%E4%BB%A3%E6%9B%BF-rc"},"6.7.2. RS (replica set, \u4ee3\u66ff RC)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#673-deployment-%E7%AE%A1%E7%90%86-rs"},"6.7.3. Deployment (\u7ba1\u7406 RS)"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6731-scale-upback-%E6%89%A9%E5%AE%B9%E7%BC%A9%E5%AE%B9"},"6.7.3.1. scale up/back (\u6269\u5bb9\u7f29\u5bb9)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6732-version-upgrade-%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7"},"6.7.3.2. version upgrade (\u7248\u672c\u5347\u7ea7)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6733-rolling-update-%E6%BB%9A%E5%8A%A8%E5%8D%87%E7%BA%A7"},"6.7.3.3. rolling update (\u6eda\u52a8\u5347\u7ea7)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6734-%E5%9B%9E%E6%BB%9A-%E7%89%88%E6%9C%AC%E5%9B%9E%E9%80%80-%E6%9F%A5%E7%9C%8B%E5%8E%86%E5%8F%B2"},"6.7.3.4. \u56de\u6eda \u7248\u672c\u56de\u9000 \u67e5\u770b\u5386\u53f2")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6735-livenessprobe-%E5%AD%98%E6%B4%BB%E6%8E%A2%E9%92%88"},"6.7.3.5. livenessProbe (\u5b58\u6d3b\u63a2\u9488)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6736-readinessprobe-%E5%B0%B1%E7%BB%AA%E6%8E%A2%E9%92%88"},"6.7.3.6. readinessProbe (\u5c31\u7eea\u63a2\u9488)")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#674-sc-stateful-set"},"6.7.4. SC (stateful set)"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6741-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96-persist"},"6.7.4.1. \u6570\u636e\u6301\u4e45\u5316 persist")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#675-ds-daemon-set-%E5%90%8E%E5%8F%B0%E6%94%AF%E6%92%91%E6%9C%8D%E5%8A%A1%E9%9B%86"},"6.7.5. DS (daemon set \u540e\u53f0\u652f\u6491\u670d\u52a1\u96c6)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#676-job-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1"},"6.7.6. job (\u4e00\u6b21\u6027\u4efb\u52a1)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#677-cronjob-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"},"6.7.7. cronjob (\u5b9a\u65f6\u4efb\u52a1)")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#68-service"},"6.8. service"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#681-endpoint"},"6.8.1. Endpoint")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#682-%E5%A4%9A%E7%AB%AF%E5%8F%A3"},"6.8.2. \u591a\u7aef\u53e3")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#683-%E5%90%84%E7%A7%8D-service-port-%E7%B1%BB%E5%9E%8B"},"6.8.3. \u5404\u79cd service port \u7c7b\u578b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#684-clusterip-%E9%BB%98%E8%AE%A4%E4%BD%BF%E7%94%A8%E7%9A%84%E7%B1%BB%E5%9E%8B"},"6.8.4. ClusterIP (\u9ed8\u8ba4\u4f7f\u7528\u7684\u7c7b\u578b)"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6841-headless"},"6.8.4.1. Headless")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#685-nodeport"},"6.8.5. NodePort")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#686-loadbalancer"},"6.8.6. LoadBalancer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#687-externalname"},"6.8.7. ExternalName")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#688-%E6%89%8B%E5%8A%A8%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"},"6.8.8. \u624b\u52a8\u7aef\u53e3\u8f6c\u53d1")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#689-service-%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C"},"6.8.9. service \u5982\u4f55\u5de5\u4f5c")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#69-ingress"},"6.9. ingress"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#691-traefik"},"6.9.1. Traefik")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#610-volume"},"6.10. volume")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#611-secret"},"6.11. secret")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#612-config-map"},"6.12. config map")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#613-flannel"},"6.13. flannel")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#614-name"},"6.14. name")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#615-name-namespace-%E7%94%A8%E6%9D%A5%E5%88%92%E5%88%86%E5%A4%9A%E7%8E%AF%E5%A2%83"},"6.15. name namespace (\u7528\u6765\u5212\u5206\u591a\u73af\u5883)")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#7-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"},"7. \u5783\u573e\u56de\u6536"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#71-%E7%BA%A7%E8%81%94%E5%88%A0%E9%99%A4"},"7.1. \u7ea7\u8054\u5220\u9664")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#72-%E5%AD%A4%E5%84%BF%E5%88%A0%E9%99%A4-orphan"},"7.2. \u5b64\u513f\u5220\u9664 orphan")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#8-%E8%B5%84%E6%BA%90%E6%8F%8F%E8%BF%B0%E6%96%87%E4%BB%B6"},"8. \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#81-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E7%94%9F%E6%88%90-yml"},"8.1. \u901a\u8fc7\u547d\u4ee4\u751f\u6210 yml")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#82-pod-%E7%9A%84-yaml-%E6%8F%8F%E8%BF%B0%E6%96%87%E4%BB%B6"},"8.2. pod \u7684 yaml \u63cf\u8ff0\u6587\u4ef6")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#83-deployment-%E7%9A%84%E6%8F%8F%E8%BF%B0%E6%96%87%E4%BB%B6"},"8.3. deployment \u7684\u63cf\u8ff0\u6587\u4ef6")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#84-service"},"8.4. service")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#9-%E6%B3%A8%E8%A7%A3"},"9. \u6ce8\u89e3")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#10-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"},"10. \u547d\u540d\u7a7a\u95f4")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#11-pod-%E7%AE%A1%E7%90%86"},"11. pod \u7ba1\u7406"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#111-%E6%8E%A2%E6%B5%8B-pod-%E6%98%AF%E5%90%A6%E5%81%A5%E5%BA%B7"},"11.1. \u63a2\u6d4b pod \u662f\u5426\u5065\u5eb7")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#112-pod-%E5%89%AF%E6%9C%AC"},"11.2. pod \u526f\u672c")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#113-%E8%BF%90%E8%A1%8C%E5%8D%95%E4%B8%AA%E4%BB%BB%E5%8A%A1-job"},"11.3. \u8fd0\u884c\u5355\u4e2a\u4efb\u52a1 Job")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#114-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1-cronjob"},"11.4. \u5b9a\u65f6\u4efb\u52a1 CronJob")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#12-pod-%E9%80%9A%E4%BF%A1"},"12. pod \u901a\u4fe1"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#121-proxy"},"12.1. proxy")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#122-service"},"12.2. Service")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#123-pod-%E9%97%B4%E9%80%9A%E4%BF%A1"},"12.3. pod \u95f4\u901a\u4fe1")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#124-%E9%80%9A%E8%BF%87-service-%E8%BF%9E%E6%8E%A5%E5%A4%96%E9%83%A8%E6%9C%8D%E5%8A%A1"},"12.4. \u901a\u8fc7 Service \u8fde\u63a5\u5916\u90e8\u670d\u52a1"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1241-%E9%80%9A%E8%BF%87%E6%89%8B%E5%8A%A8%E7%94%9F%E6%88%90-endpoint"},"12.4.1. \u901a\u8fc7\u624b\u52a8\u751f\u6210 endpoint")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1242-%E9%80%9A%E8%BF%87-externalname-%E7%B1%BB%E5%9E%8B%E7%9A%84-service"},"12.4.2. \u901a\u8fc7 externalName \u7c7b\u578b\u7684 Service")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#125-%E5%B0%86%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2%E7%BB%99%E5%A4%96%E9%83%A8"},"12.5. \u5c06\u670d\u52a1\u66b4\u9732\u7ed9\u5916\u90e8"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1251-%E5%B0%86%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%B1%BB%E5%9E%8B%E8%AE%BE%E7%BD%AE%E6%88%90-nodeport"},"12.5.1. \u5c06\u670d\u52a1\u7684\u7c7b\u578b\u8bbe\u7f6e\u6210 NodePort")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1252-%E5%B0%86%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%B1%BB%E5%9E%8B%E8%AE%BE%E7%BD%AE%E6%88%90-loadbalance"},"12.5.2. \u5c06\u670d\u52a1\u7684\u7c7b\u578b\u8bbe\u7f6e\u6210 LoadBalance")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1253-%E5%88%9B%E5%BB%BA%E4%B8%80-%E4%B8%AA-ingress-%E8%B5%84%E6%BA%90"},"12.5.3. \u521b\u5efa\u4e00 \u4e2a Ingress \u8d44\u6e90")))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13-%E5%91%BD%E4%BB%A4"},"13. \u547d\u4ee4"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#131-kubectl"},"13.1. kubectl"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1311-%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"},"13.1.1. \u57fa\u672c\u4fe1\u606f")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1312-%E5%88%9B%E5%BB%BA-create-expose"},"13.1.2. \u521b\u5efa create expose")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1313-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E5%88%B0%E5%AE%B9%E5%99%A8-exec"},"13.1.3. \u6267\u884c\u547d\u4ee4\u5230\u5bb9\u5668 exec")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1314-%E4%BF%AE%E6%94%B9"},"13.1.4. \u4fee\u6539")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1315-%E8%B5%84%E6%BA%90%E5%88%97%E8%A1%A8-get"},"13.1.5. \u8d44\u6e90\u5217\u8868 get")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1316-%E6%9F%A5%E8%AF%A2%E8%AF%A6%E7%BB%86%E6%8F%8F%E8%BF%B0-describe"},"13.1.6. \u67e5\u8be2\u8be6\u7ec6\u63cf\u8ff0 describe")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1317-%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97-logs"},"13.1.7. \u67e5\u8be2\u65e5\u5fd7 logs")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1318-%E5%88%A0%E9%99%A4-delete"},"13.1.8. \u5220\u9664 delete")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#132-kubeadmin"},"13.2. kubeadmin")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#14-cka-ckad-%E8%AF%81%E4%B9%A6%E8%80%83%E8%AF%95"},"14. cka ckad \u8bc1\u4e66\u8003\u8bd5")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#15-dashboard"},"15. dashboard"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#151-k9s"},"15.1. k9s")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#152-kuboard"},"15.2. kuboard")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#153-kubernetes-dashboard"},"15.3. kubernetes-dashboard")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#154-kubesphere-%E6%8E%A8%E8%8D%90"},"15.4. kubesphere (\u63a8\u8350)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#155-rancher"},"15.5. rancher")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#16-harbor"},"16. Harbor")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#17-helm"},"17. Helm"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#171-how-to-create-helm-chart"},"17.1. How to create helm chart")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#172-helm-chart-%E7%9A%84%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83"},"17.2. helm chart \u7684\u6253\u5305\u53d1\u5e03"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1721-%E6%89%8B%E5%8A%A8%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83"},"17.2.1. \u624b\u52a8\u6253\u5305\u53d1\u5e03")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1722-%E5%88%A9%E7%94%A8-github-action-%E8%87%AA%E5%8A%A8%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83"},"17.2.2. \u5229\u7528 github action \u81ea\u52a8\u6253\u5305\u53d1\u5e03")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#173-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"},"17.3. \u57fa\u672c\u4f7f\u7528")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#174-rollback"},"17.4. rollback")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#175-%E5%A4%9A%E7%8E%AF%E5%A2%83"},"17.5. \u591a\u73af\u5883")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#18-reference-materials"},"18. reference materials"))),(0,r.kt)("h2",{id:"1-\u9762\u8bd5\u95ee\u9898"},"1. \u9762\u8bd5\u95ee\u9898"),(0,r.kt)("p",null,"\u4e3a\u4ec0\u4e48\u9700\u8981 pod? \u4e3a\u4ec0\u4e48\u4e0d\u80fd\u7b80\u5355\u5730\u628a\u6240\u6709\u8fdb\u7a0b\u90fd\u653e\u5728\u4e00\u4e2a\u5355\u72ec\u7684\u5bb9\u5668\u4e2d?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u5728\u5355\u4e2a\u5bb9\u5668\u4e2d\u8fd0\u884c\u591a\u4e2a\u4e0d\u76f8\u5173\u7684\u8fdb\u7a0b\uff0c \u90a3\u4e48\u4fdd\u6301\u6240\u6709\u8fdb\u7a0b\u8fd0\u884c(\u5982\u5931\u8d25\u91cd\u542f)\u3001 \u7ba1\u7406\u5b83\u4eec\u7684\u65e5\u5fd7\u4f1a\u56f0\u96be(\u65e5\u5fd7\u4f1a\u6df7\u5728\u4e00\u8d77)\u3002")),(0,r.kt)("p",null,"\u4e3a\u4ec0\u4e48\u8981\u5c06\u4e00\u4e2a app \u7684 \u524d\u7aef\u670d\u52a1\u5668 \u548c \u540e\u7aef\u670d\u52a1\u5668 \u5206\u4e3a \u4e24\u4e2a pod \u90e8\u7f72?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u9020\u6210\u8ba1\u7b97\u8d44\u6e90\u6d6a\u8d39: \u5982\u679c\u90e8\u7f72\u5230\u540c\u4e00\u4e2a pod, \u90a3\u4e48\u5bf9\u4e8e \u53cc\u8282\u70b9 k8s, \u5c06\u603b\u662f\u53ea\u80fd\u5229\u7528\u4e00\u4e2a\u8282\u70b9")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6269\u7f29\u5bb9\u4e0d\u4fbf: k8s \u6269\u5bb9\u57fa\u672c\u5355\u4f4d\u5c31\u662f pod, \u524d\u540e\u7aef\u82e5\u90e8\u7f72\u5230\u540c\u4e2a pod, \u4f1a\u9020\u6210\u6269\u7f29\u5bb9\u7c92\u5ea6\u592a\u5927. \u800c\u4e14\u5bf9\u4e8e \u6570\u636e\u5e93\u670d\u52a1\u5668, \u6269\u7f29\u5bb9\u65e0\u6cd5\u8fd9\u6837\u7b80\u5355\u5904\u7406"))),(0,r.kt)("p",null,"\u5982\u4f55\u51b3\u5b9a\u662f\u5426\u5c06\u591a\u4e2a container \u5212\u5206\u5230\u4e00\u4e2a pod?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6269\u7f29\u5bb9\u662f\u5426\u80fd\u591f\u4e00\u8d77\u8fdb\u884c"),(0,r.kt)("li",{parentName:"ul"},"\u662f\u5426\u53ef\u4ee5\u5728\u540c\u4e2a\u4e3b\u673a\u8fd0\u884c")),(0,r.kt)("p",null,"11 \u5e74\u8fd0\u7ef4\u5de5\u4f5c\u7ecf\u9a8c\uff0c\u73b0\u4ece\u4e8b\u817e\u8baf\u5de5\u4e1a\u4e92\u8054\u7f51\u8fd0\u7ef4\u5de5\u4f5c\uff1b DevOps \u8fd0\u7ef4\u5de5\u7a0b\u5e08\uff0c\u5f00\u6e90\u7231\u597d\u8005\uff1b 3 \u5e74+Kubernetes \u5e73\u53f0\u7ecf\u9a8c\uff0c\u5bf9 Kubernetes \u751f\u6001\u6709\u81ea\u5df1\u7684\u8ba4\u8bc6\uff1b\u638c\u63e1 Jenkins+Gitlab+Helm \u6301\u7eed\u96c6\u6210/\u6301\u7eed\u4ea4\u4ed8\u5de5\u5177\u94fe\uff1b\u5bf9\u6d88\u606f\u961f\u5217\uff0c\u7f13\u5b58\u7b49\u4e2d\u95f4\u4ef6\uff0c\u8f6f\u4ef6\u67b6\u6784\u4f53\u7cfb\u6709\u4e00\u5b9a\u7684\u4e86\u89e3\uff1b\u719f\u7ec3\u638c\u63e1 shell \u7f16\u7a0b\uff0c\u719f\u6089 Python,Go \u8bed\u8a00\uff1b TODO"),(0,r.kt)("h2",{id:"2-what-and-why"},"2. what and why"),(0,r.kt)("h3",{id:"21-k8s-\u662f\u505a\u4ec0\u4e48\u7684"},"2.1. k8s \u662f\u505a\u4ec0\u4e48\u7684"),(0,r.kt)("p",null,"\u62bd\u8c61\u4e86\u6570\u636e\u4e2d\u5fc3\u7684\u786c\u4ef6\u57fa\u7840\u8bbe\u65bd\uff0c\u5bf9\u5916\u66b4\u9732\u7edf\u4e00\u7684\u63a5\u53e3\uff0c\u5177\u4f53\u5305\u62ec"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u8c03\u5ea6: k8s \u81ea\u52a8\u51b3\u5b9a\u7ec4\u4ef6\u90e8\u7f72\u5230\u5177\u4f53\u7684\u54ea\u4e00\u53f0 \u670d\u52a1\u5668\u8282\u70b9\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u81ea\u52a8\u4fee\u590d: \u81ea\u52a8\u68c0\u67e5\u8282\u70b9\u7684\u5065\u5eb7\u72b6\u6001, \u5427\u7a0b\u5e8f\u8fc1\u79fb\u5230\u5065\u5eb7\u7684\u8282\u70b9\u4e0a"),(0,r.kt)("li",{parentName:"ul"},"\u6c34\u5e73\u4f38\u7f29: \u81ea\u52a8\u68c0\u6d4b\u4e1a\u52a1\u7684\u8d1f\u8f7d\u60c5\u51b5, \u5982\u679c CPU \u8d1f\u8f7d\u592a\u9ad8, \u6216\u8005\u76f8\u5e94\u65f6\u95f4\u592a\u957f, \u4f1a\u81ea\u52a8\u8fdb\u884c\u6269\u5bb9")),(0,r.kt)("p",null,"\u53ea\u9700\u8981\u544a\u8bc9 k8s \u8981\u505a\u4ec0\u4e48 (\u6bd4\u5982\u4fdd\u6301\u67d0\u4e2a pod \u6709\u4e09\u4e2a\u526f\u672c), \u800c\u4e0d\u5fc5\u544a\u8bc9\u5b83\u600e\u4e48\u505a, \u5c31\u50cf sql \u53ea\u544a\u8bc9 \u6570\u636e\u5e93\u8981\u67e5\u8be2\u90a3\u4e9b\u6570\u636e, \u800c\u6ca1\u6709\u544a\u8bc9\u6570\u636e\u5e93\u600e\u4e48\u67e5\u6570\u636e"),(0,r.kt)("h3",{id:"22-\u4e3a\u4ec0\u4e48\u4f7f\u7528"},"2.2. \u4e3a\u4ec0\u4e48\u4f7f\u7528:"),(0,r.kt)("p",null,"\u5f53 container \u592a\u591a, \u9700\u8981\u7ba1\u7406, \u5355\u673a\u60c5\u51b5\u4e0b, \u8fd8\u80fd\u4f9d\u9760 docker-compose \u8fd9\u4e9b\u5de5\u5177, \u5f53\u6709\u5f88\u591a\u673a\u5668\u65f6, \u5c31\u5fc5\u987b\u901a\u8fc7 k8s \u6765\u5c06 \u5bb9\u5668\u5408\u7406\u5730\u5206\u914d\u5230\u8fd9\u4e9b\u673a\u5668\u4e2d\u53bb"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u53d1\u73b0\u548c\u8d1f\u8f7d\u5747\u8861"),(0,r.kt)("li",{parentName:"ul"},"\u81ea\u52a8\u90e8\u7f72 and \u56de\u6eda"),(0,r.kt)("li",{parentName:"ul"},"\u66ff\u6362\u5931\u8d25\u5bb9\u5668 (\u81ea\u6211\u4fee\u590d)")),(0,r.kt)("h3",{id:"compare-with-spring-cloud"},"compare with spring cloud"),(0,r.kt)("p",null,"Spring Cloud \u901a\u8fc7\u6574\u5408Neflix\u76f8\u5173\u5f00\u6e90\u7ec4\u4ef6\u5b9e\u73b0\u4e86\u4e00\u5957\u5b8c\u6574\u7684\u5fae\u670d\u52a1\u65b9\u6848\uff0c\u4f46\u662f\u5fc5\u987b\u501f\u52a9\u4e8eK8S\u8fd9\u6837\u7684\u5bb9\u5668\u7f16\u6392\u5de5\u5177\u624d\u80fd\u5b9e\u73b0\u7406\u60f3\u7684\u6548\u679c\u3002\u800cK8S\u5374\u53ef\u4ee5\u81ea\u6210\u4f53\u7cfb\u6784\u5efa\u5fae\u670d\u52a1\u7cfb\u7edf"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"k8s \u5bf9\u6784\u5efa\u7684\u5e94\u7528\u65e0\u4fb5\u5165\u6027\uff0c\u6709\u66f4\u4f4e\u7684\u6539\u9020\u6210\u672c\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5bf9\u5f00\u53d1\u8bed\u8a00\u65e0\u8981\u6c42\uff0cGo\u3001nodeJS\u3001Java\u3001PHP\u90fd\u662f\u53ef\u4ee5\u7684\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u7a0b\u5e8f\u7684\u7248\u672c\u7ba1\u7406\u66f4\u52a0\u7075\u6d3b\uff0c\u4e0d\u53d7\u5236\u4e0eSpring Cloud\u7684\u7248\u672c\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Spring Cloud \u4f53\u7cfb\u7684\u7a0b\u5e8f\u5982\u679c\u90e8\u7f72\u5728K8S\u7684\u73af\u5883\uff0c \u5f88\u591a\u5fae\u670d\u52a1\u7279\u6027\u90fd\u662f\u91cd\u590d\u7684"))),(0,r.kt)("h2",{id:"3-\u642d\u5efa\u73af\u5883"},"3. \u642d\u5efa\u73af\u5883"),(0,r.kt)("h3",{id:"31-\u751f\u4ea7\u670d\u52a1\u5668\u4e0a\u5b89\u88c5"},"3.1. \u751f\u4ea7\u670d\u52a1\u5668\u4e0a\u5b89\u88c5"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fanux/sealos"},"https://github.com/fanux/sealos")," \u4e00\u952e\u5b89\u88c5"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/lework/kainstall"},"https://github.com/lework/kainstall")),(0,r.kt)("h3",{id:"32-vagrant-\u642d\u5efa-k8s-\u73af\u5883"},"3.2. vagrant \u642d\u5efa k8s \u73af\u5883"),(0,r.kt)("p",null,"\u4e00\u4e2a master node: docker, kubeadm, kubelet, kubectl \u4e24\u4e2a worker node:"),(0,r.kt)("p",null,"Vagrantfile:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-vagrantfile"},'\nVagrant.configure("2") do |config|\n   (1..3).each do |i|\n        config.vm.define "k8s-node#{i}" do |node|\n            # \u8bbe\u7f6e\u865a\u62df\u673a\u7684Box\n            node.vm.box = "centos7"\n\n            # \u8bbe\u7f6e\u865a\u62df\u673a\u7684\u4e3b\u673a\u540d\n            node.vm.hostname="k8s-node#{i}"\n\n            # \u8bbe\u7f6e\u865a\u62df\u673a\u7684IP\n            # 192.168.56.xxx \u9700\u8981\u5728 virtualbox \u5148\u521b\u5efa host only network 192.168.56.1\n            node.vm.network "private_network", ip: "192.168.56.#{99+i}/24", netmask: "255.255.255.0"\n\n            # \u8bbe\u7f6e\u4e3b\u673a\u4e0e\u865a\u62df\u673a\u7684\u5171\u4eab\u76ee\u5f55\n            # node.vm.synced_folder "~/Documents/vagrant/share", "/home/vagrant/share"\n\n            # VirtaulBox\u76f8\u5173\u914d\u7f6e\n            node.vm.provider "virtualbox" do |v|\n                # \u8bbe\u7f6e\u865a\u62df\u673a\u7684\u540d\u79f0\n                v.name = "k8s-node#{i}"\n                # \u8bbe\u7f6e\u865a\u62df\u673a\u7684\u5185\u5b58\u5927\u5c0f\n                v.memory = 4096\n                # \u8bbe\u7f6e\u865a\u62df\u673a\u7684CPU\u4e2a\u6570\n                v.cpus = 4\n            end\n        end\n   end\nend\n\n')),(0,r.kt)("p",null,"\u865a\u62df\u673a\u51c6\u5907"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u767b\u5f55 machine sshd, \u4fdd\u8bc1\u53ef\u4ee5\u901a\u8fc7\u8d26\u53f7\u5bc6\u7801\u767b\u5f55 (\u9ed8\u8ba4\u4ec5\u4ec5 ssh \u767b\u5f55)\n# \u82e5\u4f7f\u7528 tmux + ssh config \u5219\u65e0\u9700\u65e0\u9700\u8fd9\u4e00\u6b65, \u76f4\u63a5\u901a\u8fc7 ssh \u767b\u5f55\u5373\u53ef\nvagrant ssh k8s-node1\nsudo su\nvi /etc/ssh/sshd_config # \u4fee\u6539 \u4e3a PasswordAuthentication yes\nservice sshd restart\n\n\n# \u8bbe\u7f6e\u9ed8\u8ba4\u7f51\u5361\n\n# show default SoftEther\n# We can find that the default soft ether is eth0, the three machine have the same eth0 ip.\n# This is because eth0 default to \u7f51\u7edc\u5730\u5740\u8f6c\u53d1(nat) \u7c7b\u578b. in order  to make the machines can\n# access to each other, etho should be type: Natnetwork\nip route show\n# \u64cd\u4f5c virtualbox \u56fe\u5f62\u754c\u9762, \u5168\u5c40\u65b0\u5efa natnetwork \u7f51\u7edc. \u4e3a\u6bcf\u4e2a machine \u9ed8\u8ba4\u7f51\u53611 \u5373 eth0 \u6307\u5b9a \u8fd9\u4e2a\u7c7b\u578b, \u5237\u65b0\u9ad8\u7ea7\u8bbe\u7f6e\n# \u91cc\u7684 \u7f51\u5361mac \u5730\u5740\n# \u7136\u540e\u5728\u5404\u4e2a machine \u5185 \u4e92\u76f8 ping \u662f\u5426\u901a\n\n# close firewall\nsystemctl stop firewalld\nsystemctl disable firewalld\n\n# disable selinux (\u6c38\u4e45)\nsed -i 's/enforcing/disabled/' /etc/selinux/config # \u66ff\u6362\u4e86 enforcing \u4e3a disable\n# \u5f53\u524d\u4f1a\u8bdd\u5173\u95ed selinux (\u4e34\u65f6)\nsetenforce 0\n\n# \u5173\u95ed swap \u6c38\u4e45\nsed -ri 's/.*swap.*/#&/' /etc/fstab # \u5176\u5b9e\u5c31\u662f\u6ce8\u91ca\u6389\u4e00\u884c   #/swapfile none swap defaults 0 0\n# \u5173\u95ed swap (\u5185\u5b58\u4ea4\u6362) \u4e34\u65f6\nswapoff -a\n\n# \u6dfb\u52a0 \u4e3b\u673a\u540d and ip \u6620\u5c04\n# hostname \u4f1a\u663e\u793a \u4e3b\u673a\u540d k8s-node1/2/3\n# \u82e5 hostname \u663e\u793a\u4e0d\u6b63\u5e38\u53ef\u4ee5\u4fee\u6539: hostnamectl set-hostname <new hostname>\nvi /etc/hosts\n# eth0 \u7f51\u5361\u5c31\u662f \u9ed8\u8ba4\u7f51\u5361, \u7528\u6765machine \u4e92\u8054\u7684\n# <node1 eth0 ip> k8s-node1\n# <node2 eth0 ip> k8s-node2\n# <node3 eth0 ip> k8s-node3\n10.0.2.15 k8s-node1\n10.0.2.4 k8s-node2\n10.0.2.5 k8s-node3\n\n# \u5c06\u6865\u63a5\u7684 ipv4 \u7684\u6d41\u91cf\u4f20\u9012\u5230 iptables \u7684\u94fe\ncat > /etc/sysctl.d/k8s.conf << EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n# \u9a8c\u8bc1\nsysctl --system\n\n# \u540c\u6b65\u4e09\u53f0\u673a\u5668\u7684\u65f6\u95f4\nyum install ntpdate -y\nntpdate time.windows.com\n\n# \u5c06\u53ea\u8bfb\u6587\u4ef6\u7cfb\u7edf \u6539\u4e3a \u8bfb\u5199\nmount -o remount rw /\n\n")),(0,r.kt)("p",null,"\u5b89\u88c5 docker \u7b49"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# docker\u53c2\u7167\u5b98\u7f51\u5373\u53ef\n\n# \u5b89\u88c5 k8s \u9700\u8981 aliyun \u955c\u50cf \u63a8\u8350\ncat <<EOF > /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\n        http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n\n# ustc \u7684\u955c\u50cf\ncat <<EOF > /etc/apt/sources.list.d/kubernetes.list\ndeb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main\nEOF\n# centos\ncat <<EOF > /etc/yum.repos.d/kubernetes.repo\ndeb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main\nEOF\n\n\n\nsystemctl enable kubelet\nsystemctl start kubelet\n\n\n# >>> \u5728 master node \u4e0a\n\n# \u9700\u8981\u62c9\u53bb k8s \u76f8\u5173\u7684\u955c\u50cf, \u9ed8\u8ba4\u4ed3\u5e93 k8s.gcr.io \u80cc\u5899, \u8fd9\u91cc\u91cd\u65b0\u6307\u5b9a\n# service-cidr \u662f service \u95f4\u901a\u4fe1\u7684\u7f51\u6bb5/\u5b50\u7f51\n# pod network-cidr \u662f pod \u95f4\u901a\u4fe1\u7f51\u6bb5/\u5b50\u7f51\nkubeadm init --apiserver-advertise-address=<master node eth0 ip> \\\n--image-repository registry.cn-hangzhou.aliyuncs.com/google_containers \\\n--kubernetes-version v1.19.4 \\\n--service-cidr=10.96.0.0/16 \\\n--pod-network-cidr=10.244.0.0/16\n\n# \u6309\u7167 \u8f93\u51fa\u63d0\u793a, \u5982\u4e0b\u6b65\u9aa4\u9700\u8981\u505a:\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n# master \u751f\u6210\u7684 \u547d\u4ee4, \u5728 worker node \u6267\u884c\u5373\u53ef\u52a0\u5165 cluster.\n# 2h \u5185\u6709\u6548\nkubeadm join 10.0.2.15:6443 --token 0tpws3.y1uhbzg0rgal4okz \\\n    --discovery-token-ca-cert-hash sha256:0a25a082e0babbc18d1646ebfa9954d82838fa86ec66ee3d88c0d57fc9c0f35e\n# \u8fc7\u671f\u4e4b\u540e, \u5982\u4e0b\u751f\u6210\u6c38\u4e45\u7684 token\nkubeadm token create --print-join-command\nkubeadm token create --ttl 0 --print-join-command # \u590d\u5236\u751f\u6210\u7684 token \u5230\u4e0a\u9762\u547d\u4ee4\u5373\u53ef\n\n# \u521b\u5efa\u7f51\u7edc\n# \u8fd9\u91cc\u9009\u5b9a flannel \u63d0\u4f9b\u7684\u7f51\u7edc\u6269\u5c55\u63d2\u4ef6 (addons)\n# \u5177\u4f53\u6709\u54ea\u4e9b\u53ef\u7528\u7684\u63d2\u4ef6: https://kubernetes.io/docs/concepts/cluster-administration/addons/\ncurl -L https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml -o flannel_network.yml\n# \u4e0a\u4f20\u5230 master node\nscp ~/flanel.yml root@xxx/root\n# \u5b50\u8282\u70b9\u52a0\u5165\u5230 cluster \u540e, master \u4f1a\u540c\u6b65 flanel \u76f8\u5173\u7684 pod \u5230 \u5b50\u8282\u70b9\u4e0a, \u53ef\u4ee5\u76d1\u63a7, \u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u518d\u67e5\u770b nodes\nkubectl apply -f flannel.yml\n# \u67e5\u770b flanel \u76f8\u5173 \u7684 pods \u662f\u5426\u542f\u52a8\nkubectl get po --all-namespaces\n# \u5982\u679c\u662f \u5931\u8d25\u7684, \u90a3\u4e48\u5c0f\u66ff\u6362 flanel.yml \u4e2d image \u76f8\u5173\u5730\u5740, \u5230 docker hub \u4e0a\u627e, \u5982 https://hub.docker.com/r/easzlab/flannel\n# \u5220\u9664 , \u91cd\u65b0\u521b\u5efa\nkubectl delete -f flannel.yml\n\n\n# \u6b64\u65f6\u53ef\u4ee5\u5728\u5b50\u8282\u70b9\u4e0a\u6267\u884c\u6dfb\u52a0 node \u547d\u4ee4\u4e86   >>> \u5728 worker node \u4e0a\n\n\n# \u76d1\u63a7 \u6240\u6709\u8282\u70b9\u4e0a\u7684 \u6307\u5b9ans \u7684 pod\n# \u7b49\u5f85 \u6240\u6709\u8282\u70b9 \u4e0a flanel \u76f8\u5173\u7684 pod \u90fd\u6b63\u5e38\u542f\u52a8\u540e\u518d\u5728 master \u4e0a\u67e5\u770b nodes \u72b6\u6001, \u4fdd\u8bc1\u6240\u6709 node \u72b6\u6001\u4e3a ready \u5219 cluster \u642d\u5efa\u6210\u529f\nwatch kubectl get po -n kube-system -o wide\n\n# \u5b89\u88c5 ingress controller,\n# \u6709\u591a\u91cd\u5b9e\u73b0, \u9009\u62e9\u4e00\u79cd\u5373\u53ef https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/\n# \u8fd9\u91cc\u9009\u62e9 ingress-nginx https://kubernetes.io/docs/concepts/services-networking/ingress/\n# ref: https://www.cnblogs.com/minseo/p/12455320.html\n\n\n")),(0,r.kt)("h3",{id:"33-\u4f17\u591a\u7684\u53d1\u884c\u7248"},"3.3. \u4f17\u591a\u7684\u53d1\u884c\u7248"),(0,r.kt)("h4",{id:"331-k3s"},"3.3.1. k3s"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/k3s-io/k3s"},"https://github.com/k3s-io/k3s")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://oldj.net/article/2022/04/17/install-k3s-and-rancher/"},"https://oldj.net/article/2022/04/17/install-k3s-and-rancher/")),(0,r.kt)("p",null,"\u8f7b\u91cf\u7ea7\u7684 k8s, \u5185\u6838\u673a\u5236\u8fd8\u662f\u548c K8s \u4e00\u6837\uff0c\u4f46\u662f\u5254\u9664\u4e86\u5f88\u591a\u5916\u90e8\u4f9d\u8d56\u4ee5\u53ca K8s \u7684 alpha\u3001beta \u7279\u6027"),(0,r.kt)("p",null,"\u5c06\u5176\u5e94\u7528\u4e8e IoT \u8bbe\u5907\uff08\u6bd4\u5982\u6811\u8393\u6d3e\uff09"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://rancher.com/docs/k3s/latest/en/"},"https://rancher.com/docs/k3s/latest/en/")," \u5b98\u7f51"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.rancher.cn/k3s/"},"https://www.rancher.cn/k3s/")," \u4e2d\u6587\u5b98\u7f51"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://zhuanlan.zhihu.com/p/269556628"},"https://zhuanlan.zhihu.com/p/269556628")," \u7b80\u4ecb"),(0,r.kt)("h4",{id:"332-k0s"},"3.3.2. k0s"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/k0sproject/k0s"},"https://github.com/k0sproject/k0s")," \u4f53\u79ef\u4e0b, \u66f4\u7cbe\u7b80\u7684 k8s"),(0,r.kt)("h4",{id:"333-microk8s"},"3.3.3. microk8s"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/canonical/microk8s"},"https://github.com/canonical/microk8s")),(0,r.kt)("h4",{id:"334-docker-desktop"},"3.3.4. docker desktop"),(0,r.kt)("p",null,"it's the easiest way to install k8s locally I think."),(0,r.kt)("h4",{id:"335-kind"},"3.3.5. kind"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/kubernetes-sigs/kind/"},"https://github.com/kubernetes-sigs/kind/")),(0,r.kt)("p",null,"\u5728 docker \u4e2d\u8fd0\u884c k8s, \u66f4\u5feb\u66f4\u65b9\u4fbf"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/laochiji/p/13813743.html"},"https://www.cnblogs.com/laochiji/p/13813743.html")," \u591a\u8282\u70b9"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# install\n# install golang && install docker\ndocker pull kindest/node:v1.19.1\n\n\n# --name: specify a name for the cluster. default name : kind\n#  --wait 30s: wait until the cluster reaches a ready status\n# --wait 5m\n# --kubeconfig: specify cluster config file; default location : ${HOME}/.kube/config\nkind create cluster [--name kind] [--wait]\n\n# \u6784\u5efa\u955c\u50cf\ndocker build -t my-custom-image:unique-tag ./my-image-dir\n# \u52a0\u8f7d\u5230 kind\nkind load docker-image my-custom-image:unique-tag\nkubectl apply -f my-manifest-using-my-image:unique-tag\n\n# context name \u89c4\u5219: <kind>-<cluster_name>\n# \u4ec5\u4ec5\u4e00\u4e2a cluster \u65f6, \u53ef\u7701\u7565 context\nkubectl cluster-info [--context kind-kind]\n\n# \u9ed8\u8ba4\u5220\u9664 kind \u540d\u5b57\u7684 cluster\nkind delete cluster [--name kind]\n\n# \u52a0\u8f7d images \u5230 cluster\n# \u9ed8\u8ba4 \u5c06 \u955c\u50cf\u52a0\u8f7d\u5230 kind \u540d\u5b57\u7684 cluster\nkind load docker-image <img_name> [--name cluster_name]\n\n# \u8fdb\u5165 kind \u542f\u52a8\u7684 docker \u5185\u90e8, \u6267\u884c crictl images, \u53ef\u4ee5\u770b\n# \u5230\u7528\u6765\u6a21\u62df k8s \u7684\u4e00\u7cfb\u5217\u955c\u50cf\ndocker exec -it kind-control-plane crictl images\n")),(0,r.kt)("h4",{id:"336-minikube"},"3.3.6. minikube"),(0,r.kt)("p",null,"create single node k8s cluster for dev, \u539f\u7406\u662f \u521b\u5efa\u865a\u62df\u673a,"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"\nminikube version\n\nminikube start\n\n\nminikube dashboard\n\n# \u53ef\u7528\u7684\u6269\u5c55/\u63d2\u4ef6\nminikube addons list\n\n# \u5f00\u542f\u63d2\u4ef6\nminikube addons enable metrics-server\n# \u5173\u95ed\u63d2\u4ef6\nminikube addons disable metrics-server\n\n\nminikube stop\n\nminikube delete\n\n# \u5f53\u524d node ip\nminikube ip\n\n")),(0,r.kt)("h2",{id:"4-quickstart"},"4. Quickstart"),(0,r.kt)("h3",{id:"41-\u4ee5java-\u4e3a\u4f8b"},"4.1. \u4ee5Java \u4e3a\u4f8b"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://mritd.com/2022/11/08/java-containerization-guide/"},"https://mritd.com/2022/11/08/java-containerization-guide/")),(0,r.kt)("h3",{id:"42-\u4ee5-go-\u4e3a\u4f8b"},"4.2. \u4ee5 go \u4e3a\u4f8b"),(0,r.kt)("h4",{id:"421-using-pod-directly"},"4.2.1. using pod directly"),(0,r.kt)("p",null,"here is a piece of code in go:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "io"\n    "net/http"\n)\n\nfunc main() {\n    // Register a router\n    http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {\n        io.WriteString(w, "[v1] Hello, k8s!")\n    })\n    // Start the server and listening on port 80\n    http.ListenAndServe(":80", nil)\n}\n\n')),(0,r.kt)("p",null,"now we write a dockerfile for this go app"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dockerfile"},'FROM golang:1.20 AS builder\n\n# create /src, then jump into it\nWORKDIR /src\n\n# pre-copy/cache go.mod for pre-downloading dependencies and only redownloading them in subsequent builds if they change\n# COPY go.mod go.sum ./\n# RUN go mod download && go mod verify\n\n# copy all host files to /src\nCOPY . ./\n\n# required, if missing then go.mod is needed\nRUN go env -w GO111MODULE=auto\n\nRUN CGO_ENABLED=0 go build -a -sw -ldflags \'-extldflags "-static"\' -v -o main .\n\n# ---\n\nFROM scratch\n\nWORKDIR /\n\nCOPY --from=builder /src/main .\n\nEXPOSE 80\n\nENTRYPOINT ["/main"]\n\n\n')),(0,r.kt)("p",null,"so now we can build our image and push it to docker hub:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"go build . -t xiaoyureed/hellok8s:v1\n\n# check\ndocker images | grep xiaoyureed\n\n# login docker hub\ndocker login\n\ndocker push\n\n")),(0,r.kt)("p",null,"then write the pod resource yml:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: hello-k8s-pod\n  labels:\n    name: hello-k8s\nspec:\n  containers:\n    - image: xiaoyureed/hellok8s:v1\n      name: hello-k8s-container\n      # optional\n      resources:\n        limits:\n          memory: '128Mi'\n          cpu: '500m'\n")),(0,r.kt)("p",null,"apply the yml to create pod"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'kubectl apply -f xxx.yaml\n\n# Wait for about 30s,\n# so that the resources can be created\n\n# check pod list\nkubectl get pods\n\n# check pod info\nkc describe pod <pod id>\n\n# post forwarding (Temporary use only, just for debugging)\nkubectl port-forward hello-k8s-pod 4000:80\n\n# enter the container in the pod\nkubectl exec -it hello-k8s-pod -- /bin/bash\n\n# echo "hello kubernetes by nginx!" > /usr/share/nginx/html/index.html\n\n# visit localhost:4000\n\n# check log\nkubectl logs --follow hello-k8s-pod\n\n# exec cmd "ls"\nkubectl exec hello-k8s-pod -- ls\n\n# delete resources\nkubectl delete pod hello-k8s-pod\n# or\nkubectl delete -f xxx.yaml\n\n')),(0,r.kt)("h4",{id:"422-using-deployment"},"4.2.2. using deployment"),(0,r.kt)("p",null,"Let's write a yml file to define a deployment to manage the pods"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: hello-k8s-pod\n  labels:\n    name: hello-k8s\nspec:\n  containers:\n    - name: hello-k8s-container\n      image: xiaoyureed/hellok8s:v1\n      resources:\n        limits:\n          memory: '128Mi'\n          cpu: '500m'\n")),(0,r.kt)("p",null,"then apply and check the results:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# create\nkc apply -f k8s_resources/deployment.yml\n\n# check deployment info\nkc get deployments\n\n# check pods info\n# Note: the pods name is generated by deployment and it's unique\nkc get pods\n\n# Try to delete a pod, and then you will find that the pod number recovers after a moment\nkc delete pod hello-k8s-deployment-6bb465758-5d8lk\n")),(0,r.kt)("h2",{id:"5-\u96c6\u7fa4\u7ed3\u6784-underlying-infrastructure-\u57fa\u7840\u8bbe\u65bd"},"5. \u96c6\u7fa4\u7ed3\u6784 underlying infrastructure \u57fa\u7840\u8bbe\u65bd"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"k8s design",src:t(58121).Z,width:"1542",height:"930"})),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"k8s design1",src:t(73314).Z,width:"2260",height:"1686"})),(0,r.kt)("h3",{id:"51-control-plane-\u63a7\u5236\u5e73\u9762"},"5.1. control plane \u63a7\u5236\u5e73\u9762"),(0,r.kt)("p",null,'Also known as "master" node, designed to manage the hole cluster to make it work properly'),(0,r.kt)("p",null,"Consists of these part:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"api server"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Provide the api interface to interactive with the developer."),(0,r.kt)("li",{parentName:"ul"},"Also, offer the authentication, authorization"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"etcd"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"distributed data storage; used to store the cluster status"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"scheduler"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u8c03\u5ea6\uff0c \u51b3\u5b9a\u54ea\u4e2a pod \u90e8\u7f72\u5230\u54ea\u4e2a\u8282\u70b9;"),(0,r.kt)("li",{parentName:"ul"},"\u76d1\u89c6\u90a3\u4e9b\u65b0\u521b\u5efa\u7684\u672a\u6307\u5b9a\u8fd0\u884c\u8282\u70b9\u7684 Pod\uff0c\u5e76\u9009\u62e9\u8282\u70b9\u8ba9 Pod \u5728\u4e0a\u9762\u8fd0\u884c"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"controller manager"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6574\u4e2a\u96c6\u7fa4\u7684\u7ba1\u5bb6\uff0c\u7528\u6765\u7ba1\u7406\u8d44\u6e90\u5bf9\u8c61: \u5982 \u590d\u5236\u8282\u70b9\uff0c \u6301\u7eed\u8ddf\u8e2a\u5de5\u4f5c\u8282\u70b9"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"node controller \u5728\u8282\u70b9\u51fa\u73b0\u6545\u969c\u65f6\u8fdb\u884c\u901a\u77e5\u548c\u54cd\u5e94"),(0,r.kt)("li",{parentName:"ul"},"Replication Controller \u7ef4\u62a4\u6b63\u786e\u6570\u91cf\u7684 Pod"),(0,r.kt)("li",{parentName:"ul"},"Endpoints Controller \u586b\u5145\u7aef\u70b9(Endpoints)\u5bf9\u8c61(\u5373\u52a0\u5165 Service \u4e0e Pod)")))))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Minikube \u7ba1\u7406\u7684\u662f\u5355\u8282\u70b9 k8s\uff0c master node\uff0c \u548c worker node \u90fd\u5728\u4e00\u53f0\u7269\u7406\u4e3b\u673a\u4e0a")),(0,r.kt)("h3",{id:"52-computer-machines-\u8ba1\u7b97\u8282\u70b9-node"},"5.2. computer machines (\u8ba1\u7b97\u8282\u70b9 Node)"),(0,r.kt)("p",null,"Also known as Node, designed to run the real application"),(0,r.kt)("p",null,"\u662f\u6240\u6709 Pod \u8fd0\u884c\u6240\u5728\u7684\u5de5\u4f5c\u4e3b\u673a\uff0c\u53ef\u4ee5\u662f\u7269\u7406\u673a\u4e5f\u53ef\u4ee5\u662f\u865a\u62df\u673a"),(0,r.kt)("p",null,"\u5305\u542b\u8fd9\u4e9b\u7ec4\u4ef6"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"kubelet: \u548c master \u8282\u70b9\u7684 api server \u901a\u4fe1, \u4ee5\u7ba1\u7406\u6240\u5728\u7684 \u8282\u70b9/\u673a\u5668\u4e0a\u7684 pod (\u521b\u5efa\u3001\u4fee\u6539\u3001\u76d1\u63a7\u3001\u5220\u9664)"),(0,r.kt)("p",{parentName:"li"},"\u76f8\u5f53\u4e8e\u8282\u70b9\u7684\u4ee3\u7406, \u548c master \u8282\u70b9\u4ea4\u4e92")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"kube-proxy: \u8d1f\u8d23\u4e00\u7ec4 pods \u7684\u8d1f\u8f7d\u5747\u8861"),(0,r.kt)("p",{parentName:"li"},"\u662f K8s \u96c6\u7fa4\u5185\u90e8\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u3002\u5b83\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u4ee3\u7406\u670d\u52a1\u5668, \u5728 K8s \u7684\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90fd\u6709\u4e00\u4e2a\uff1b\u8fd9\u4e00\u8bbe\u8ba1\u4f53\u73b0\u4e86\u5b83\u7684\u4f38\u7f29\u6027\u4f18\u52bf\uff0c\u9700\u8981\u8bbf\u95ee\u670d\u52a1\u7684\u8282\u70b9\u8d8a\u591a\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u80fd\u529b\u7684 Kube-proxy \u5c31\u8d8a\u591a\uff0c\u9ad8\u53ef\u7528\u8282\u70b9\u4e5f\u968f\u4e4b\u589e\u591a\u3002\u4e0e\u4e4b\u76f8\u6bd4\uff0c\u6211\u4eec\u5e73\u65f6\u5728\u670d\u52a1\u5668\u7aef\u505a\u4e2a\u53cd\u5411\u4ee3\u7406\u505a\u8d1f\u8f7d\u5747\u8861\uff0c\u8fd8\u8981\u8fdb\u4e00\u6b65\u89e3\u51b3\u53cd\u5411\u4ee3\u7406\u7684\u8d1f\u8f7d\u5747\u8861\u548c\u9ad8\u53ef\u7528\u95ee\u9898\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Fluentd\uff0c\u4e3b\u8981\u8d1f\u8d23\u65e5\u5fd7\u6536\u96c6\u3001\u5b58\u50a8\u4e0e\u67e5\u8be2")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"container runtime engine (\u9700\u8981\u7b26\u5408 oci \u6807\u51c6\u7684\u8fd0\u884c\u65f6, \u5982 docker, rkt, CRI-O): \u8d1f\u8d23\u521b\u5efa\u5bb9\u5668"))),(0,r.kt)("h2",{id:"6-api-\u7ba1\u7406\u7684\u5404\u79cd\u8d44\u6e90"},"6. api \u7ba1\u7406\u7684\u5404\u79cd\u8d44\u6e90"),(0,r.kt)("p",null,"\u5373\u5404\u79cd api object,"),(0,r.kt)("p",null,"\u50cf pod, rc, rs, deployment \u90fd\u5c5e\u4e8e api object"),(0,r.kt)("h3",{id:"61-\u5404\u79cd\u8d44\u6e90\u7684\u5173\u7cfb"},"6.1. \u5404\u79cd\u8d44\u6e90\u7684\u5173\u7cfb"),(0,r.kt)("p",null,"\u5728 K8S \u4e2d\uff0c\u5e94\u7528\u4f1a\u88ab\u5c01\u88c5\u5728 Container \u4e2d\u66b4\u9732\u51fa\u6765\u4e00\u4e2a Port. \u4e00\u4e2a\u548c\u591a\u4e2a Container \u7ec4\u6210\u4e86\u4e00\u4e2a Pod\u3002 Pod \u662f K8S \u7684\u57fa\u672c\u6267\u884c\u5355\u5143\u3002Pod \u4f1a\u88ab\u5206\u914d\u5230 Node \u4e0a\u8fd0\u884c\u3002\u800c\u591a\u4e2a Node \u7ec4\u6210\u4e86\u4e00\u4e2a K8S Cluster."),(0,r.kt)("h3",{id:"62-3-common-properties"},"6.2. 3 common properties"),(0,r.kt)("h4",{id:"621-metadata"},"6.2.1. metadata"),(0,r.kt)("p",null,"metadata (contains 3 factors at least):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"namespace \u547d\u540d\u7a7a\u95f4\u4e3a Kubernetes \u96c6\u7fa4\u63d0\u4f9b\u865a\u62df\u7684\u9694\u79bb\u4f5c\u7528"),(0,r.kt)("p",{parentName:"li"},"Kubernetes \u96c6\u7fa4\u521d\u59cb\u6709\u4e24\u4e2a\u547d\u540d\u7a7a\u95f4\uff0c\u5206\u522b\u662f\u9ed8\u8ba4\u547d\u540d\u7a7a\u95f4 default \u548c\u7cfb\u7edf\u547d\u540d\u7a7a\u95f4 kube-system")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"name")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"uid"))),(0,r.kt)("p",null,"used to identify api obj"),(0,r.kt)("h4",{id:"622-spec"},"6.2.2. spec"),(0,r.kt)("p",null,"used to declare the configuration that we want"),(0,r.kt)("h4",{id:"623-status"},"6.2.3. status"),(0,r.kt)("h3",{id:"63-node"},"6.3. node"),(0,r.kt)("p",null,"\u662f K8S \u7684\u96c6\u7fa4\u5de5\u4f5c\u8282\u70b9\uff0c\u53ef\u4ee5\u662f\u7269\u7406\u673a\u4e5f\u53ef\u4ee5\u662f\u865a\u62df\u673a\uff1b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# check node info\nkubectl describe node <NODENAME>\n\n# \u7981\u6b62Pod\u8c03\u5ea6\u5230\u8be5\u8282\u70b9\u4e0a\nkubectl corndon NODENAME\n\n# \u9a71\u9010\u8be5\u8282\u70b9\u4e0a\u7684\u6240\u6709 Pod\nkubectl drain NODENAME\n\n")),(0,r.kt)("h3",{id:"64-pod"},"6.4. pod"),(0,r.kt)("p",null,"\u7531 \u4e00\u4e2a\u6216\u591a\u4e2a\u76f8\u4e92\u5173\u8054\u7684 container \u7ec4\u6210, \u8fd9\u4e9b container \u5171\u4eab\u7f51\u7edc\u5730\u5740\u548c\u6587\u4ef6\u7cfb\u7edf, \u662f k8s \u7ba1\u7406\u7684\u57fa\u672c\u5355\u4f4d, \u4ee3\u8868\u7740\u96c6\u7fa4\u4e2d\u7684\u4e00\u4e2a\u865a\u62df\u4e3b\u673a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u4e00\u4e2a pod \u53ea\u53ef\u80fd\u5b58\u5728\u4e8e\u4e00\u4e2a worker node \u4e0a, \u4e0d\u53ef\u8de8\u8282\u70b9, \u4e00\u7ec4 pod \u53ef\u4ee5\u5206\u5e03\u5728\u4e0d\u540c node \u4e0a"),(0,r.kt)("p",{parentName:"blockquote"},"\u4e00\u4e2a pod \u5185\u7684\u6240\u6709\u5bb9\u5668\u5171\u4eab\u76f8\u540c\u7684 Linux network \u547d\u540d\u7a7a\u95f4. \u8fd9\u6837\u6bcf\u4e2a pod \u5c31\u50cf\u4e00\u53f0\u72ec\u7acb\u7684 \u4e3b\u673a, \u6709\u81ea\u5df1\u7684 ip (\u96c6\u7fa4\u5185\u90e8\u5730\u5740), \u4e3b\u673a\u540d, \u7aef\u53e3 (pod \u4e2d\u7684 containers \u5171\u4eab \u8be5 ip \u4ee5\u53ca \u7aef\u53e3\u7a7a\u95f4, \u5177\u6709\u76f8\u540c\u7684 loopback \u7f51\u7edc\u63a5\u53e3,\u53ef\u4f7f\u7528 localhost \u76f8\u4e92\u901a\u4fe1)."),(0,r.kt)("p",{parentName:"blockquote"},"(\u53ef\u4ee5\u548c docker-compose \u542f\u52a8\u7684\u591a\u4e2a container \u7c7b\u6bd4)"),(0,r.kt)("p",{parentName:"blockquote"},"container (\u5bb9\u5668) \u7684\u672c\u8d28\u662f\u8fdb\u7a0b\uff0c\u800c pod \u662f\u7ba1\u7406\u8fd9\u4e00\u7ec4\u8fdb\u7a0b\u7684\u8d44\u6e90")),(0,r.kt)("p",null,"Here is the yml spec file for pod:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: hello-k8s-pod\n  # optional\n  labels:\n    name: hello-k8s\nspec:\n  containers:\n    - name: hello-k8s-container\n      image: xiaoyureed/hellok8s:v1\n      # IfNotPresent \u4ec5\u672c\u5730\u6ca1\u6709\u955c\u50cf\u65f6\u624d\u8fdc\u7a0b\u62c9\uff0cAlways \u6c38\u8fdc\u90fd\u662f\u4ece\u8fdc\u7a0b\u62c9\uff0cNever \u6c38\u8fdc\u53ea\u7528\u672c\u5730\u955c\u50cf\uff0c\u672c\u5730\u6ca1\u6709\u5219\u62a5\u9519\n      # optional\n      imagePullPolicy: IfNotPresent\n      # optional\n      resources:\n        limits:\n          memory: '128Mi'\n          cpu: '500m'\n")),(0,r.kt)("p",null,"use these commands to check the pods info"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# check list\nkc get pod[s]\n# check list, including more info\nkubectl get pods -o wide\n\n# enter a specific pod\nkubectl exec -it <pod name> /bin/bash\n\n")),(0,r.kt)("h3",{id:"65-label"},"6.5. label"),(0,r.kt)("p",null,"label \u662f\u8d44\u6e90\u4e0a\u7684\u6807\u8bc6\uff0c\u7528\u6765\u5bf9\u5b83\u4eec\u8fdb\u884c\u533a\u5206\u548c\u9009\u62e9,"),(0,r.kt)("p",null,"\u901a\u5e38\u5728\u8d44\u6e90\u5bf9\u8c61\u786e\u5b9a\u65f6\u5b9a\u4e49\uff0c\u4e5f\u53ef\u4ee5\u5728\u8d44\u6e90\u521b\u5efa\u540e\u52a8\u6001\u6dfb\u52a0\u6216\u5220\u9664\uff1b"),(0,r.kt)("p",null,"\u4e00\u4e2a label \u4f1a\u4ee5 kv \u5f62\u5f0f\u9644\u52a0\u5230\u5404\u79cd\u5bf9\u8c61\u4e0a(node, pod, service ...)"),(0,r.kt)("p",null,"\u5e38\u7528 label:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'\u7248\u672c\u6807\u7b7e\uff1a\u201cversion\u201d:\u201crelease\u201d,\n\u73af\u5883\u6807\u7b7e\uff1a"environment": "dev", "environment": "qa", "environment": "production"\n\u67b6\u6784\u6807\u7b7e\uff1a"tier": "frontend" ,"tier": "backend","tier": "cache"\n')),(0,r.kt)("h4",{id:"651-label-selector-\u4f7f\u7528"},"6.5.1. Label selector \u4f7f\u7528"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5305\u542b/\u4e0d\u5305\u542b \u7279\u5b9a key \u7684 \u8d44\u6e90"),(0,r.kt)("li",{parentName:"ul"},"\u5305\u542b\u7279\u5b9a key\uff0c value \u7684 \u8d44\u6e90"),(0,r.kt)("li",{parentName:"ul"},"\u5305\u542b \u7279\u5b9a key\uff0c \u4e14 value \u548c\u6307\u5b9a\u7684\u4e0d\u540c\u7684\u8d44\u6e90")),(0,r.kt)("h3",{id:"66-taint\u6c61\u70b9\u548c-toleration\u5bb9\u5fcd"},"6.6. Taint\uff08\u6c61\u70b9\uff09\u548c Toleration\uff08\u5bb9\u5fcd\uff09"),(0,r.kt)("p",null,"\u53ef\u4ee5\u4f5c\u7528\u4e8e node \u548c pod \u4e0a, \u7528\u4e8e\u63a7\u5236\u548c\u4f18\u5316 pod \u5728 node \u4e0a\u7684\u8c03\u5ea6"),(0,r.kt)("p",null,"\u5177\u6709 taint \u7684 node \u548c pod \u662f\u4e92\u65a5\u5173\u7cfb\uff0c\u800c\u5177\u6709\u8282\u70b9\u4eb2\u548c\u6027 (toleration) \u5173\u7cfb\u7684 node \u548c pod \u662f\u76f8\u5438\u7684"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Taint \u548c toleration \u76f8\u4e92\u914d\u5408\uff0c\u53ef\u4ee5\u7528\u6765\u907f\u514d pod \u88ab\u5206\u914d\u5230\u4e0d\u5408\u9002\u7684\u8282\u70b9\u4e0a\u3002\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90fd\u53ef\u4ee5\u5e94\u7528\u4e00\u4e2a\u6216\u591a\u4e2a taint \uff0c\u8fd9\u8868\u793a\u5bf9\u4e8e\u90a3\u4e9b\u4e0d\u80fd\u5bb9\u5fcd\u8fd9\u4e9b taint \u7684 pod\uff0c\u662f\u4e0d\u4f1a\u88ab\u8be5\u8282\u70b9\u63a5\u53d7\u7684\u3002\u5982\u679c\u5c06 toleration \u5e94\u7528\u4e8e pod \u4e0a\uff0c\u5219\u8868\u793a\u8fd9\u4e9b pod \u53ef\u4ee5\uff08\u4f46\u4e0d\u8981\u6c42\uff09\u88ab\u8c03\u5ea6\u5230\u5177\u6709\u76f8\u5e94 taint \u7684\u8282\u70b9\u4e0a\u3002"),(0,r.kt)("p",{parentName:"blockquote"},"\u53e6\u5916\u8fd8\u6709\u53ef\u4ee5\u7ed9 node \u8bbe\u7f6e label\uff0c\u901a\u8fc7\u7ed9 pod \u8bbe\u7f6e nodeSelector \u5c06 pod \u8c03\u5ea6\u5230\u5177\u6709\u5339\u914d\u6807\u7b7e\u7684\u8282\u70b9\u4e0a\u3002")),(0,r.kt)("h4",{id:"661-taint"},"6.6.1. taint"),(0,r.kt)("p",null,"\u4f5c\u7528\u5728 node \u4e0a."),(0,r.kt)("p",null,"Node \u88ab\u8bbe\u7f6e\u4e0a\u6c61\u70b9\u4e4b\u540e\uff0c\u5c31\u548c Pod \u4e4b\u95f4\u5b58\u5728\u4e86\u4e00\u79cd\u76f8\u65a5\u7684\u5173\u7cfb\uff0c\u8fdb\u800c\u62d2\u7edd Pod \u8c03\u5ea6\u8fc7\u6765\uff0c\u751a\u81f3\u53ef\u4ee5\u5c06\u5df2\u5b58\u5728\u7684 Pod \u9a71\u9010\u51fa\u53bb\uff1b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\n\u6c61\u70b9\u683c\u5f0f\uff1akey=value:effect\uff0ckey\u548cvalue\u662f\u6c61\u70b9\u7684\u6807\u7b7e\uff0ceffect\u63cf\u8ff0\u6c61\u70b9\u7684\u4f5c\u7528\uff0c\u652f\u6301\u5982\u4e0b\u4e09\u4e2a\u9009\u9879\uff1a\n\n- PreferNoSchedule: k8s\u5c3d\u91cf\u4e0d\u628apod\u8c03\u5ea6\u5230\u8be5\u6c61\u70b9Node\u4e0a\uff0c\u9664\u975e\u6ca1\u6709\u5176\u4ed6\u8282\u70b9\u53ef\u8c03\u5ea6\uff1b\n\n- NoSchedule: k8s\u5c06\u4e0d\u4f1a\u628aPod\u8c03\u5ea6\u5230\u8be5\u6c61\u70b9Node\u4e0a\uff0c\u5df2\u5b58\u5728\u7684Pod\u5c06\u7ee7\u7eed\u8fd0\u884c\uff1b\n\n- NoExecute\uff1ak8s\u5c06\u4e0d\u4f1a\u628aPod\u8c03\u5ea6\u5230\u5177\u6709\u8be5\u6c61\u70b9\u7684Node\u4e0a\uff0c\u540c\u65f6\u4e5f\u4f1a\u5c06Node\u4e0a\u5df2\u5b58\u5728\u7684Pod\u9a71\u9010\uff1b\n")),(0,r.kt)("p",null,"\u4f7f\u7528\u8bed\u6cd5:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u8bbe\u7f6e\u6c61\u70b9\nkubectl taint nodes <node name> <key>=<value>:<effect>\n# \u53bb\u9664\u6c61\u70b9\nkubectl taint nodes node1 <key>:<effect>-\n# \u53bb\u9664\u6240\u6709\u6c61\u70b9\nkubectl taint nodes node1 <key>-\n\n# \u4f8b\u5982\uff1a\n# \u4e3anode1\u8bbe\u7f6e\u6c61\u70b9\nkubectl taint nodes node1 tag=test:PreferNoSchedule\n# \u4e3anode1\u53d6\u6d88\u6c61\u70b9\nkubectl taint nodes node1 tag:PreferNoSchedule-\n# \u4e3anode1\u5220\u9664\u53bb\u9664\u6c61\u70b9\nkubectl taint nodes node1 tag-\n# \u67e5\u770bnode1 \u6c61\u70b9\nkubectl describe node node1\n")),(0,r.kt)("h4",{id:"662-toleration"},"6.6.2. toleration"),(0,r.kt)("p",null,"\u4f5c\u7528\u5728 pod \u4e0a"),(0,r.kt)("p",null,"\u82e5\u5c06 pod \u8c03\u5ea6\u5230\u4e00\u4e2a\u6709\u6c61\u70b9\u7684 node \u4e0a\u53bb\uff0c\u9700\u8981\u7528\u5230\u5bb9\u5fcd; Node \u901a\u8fc7\u6c61\u70b9\u62d2\u7edd pod \u8c03\u5ea6\u4e0a\u53bb\uff0cpod \u901a\u8fc7\u5bb9\u5fcd\u5ffd\u7565\u62d2\u7edd\uff1b"),(0,r.kt)("h3",{id:"67-controllers\u5404\u79cd\u63a7\u5236\u5668"},"6.7. controllers(\u5404\u79cd\u63a7\u5236\u5668)"),(0,r.kt)("p",null,"pod \u63a7\u5236\u5668, \u90e8\u7f72/\u7ba1\u7406 pods"),(0,r.kt)("h4",{id:"671-rc-replica-controller-\u526f\u672c\u63a7\u5236\u5668"},"6.7.1. ",(0,r.kt)("del",{parentName:"h4"},"RC (replica controller \u526f\u672c\u63a7\u5236\u5668)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"outdated")),(0,r.kt)("p",null,"\u4fdd\u8bc1 Pod \u9ad8\u53ef\u7528\u7684 API \u5bf9\u8c61\uff1b \u521b\u5efa/\u590d\u5236 pod \u5b9e\u4f8b, \u786e\u4fdd pod \u526f\u672c\u6570\u91cf (it kill the pod or start pod to ensure that the pod number consit with the configuration)"),(0,r.kt)("p",null,"Best practice: remember that always start pod by using RC"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"kubectl run ...")," \u4f1a\u521b\u5efa\u4e00\u4e2a rc\uff0c \u7136\u540e rc \u521b\u5efa pod \uff08\u6240\u4ee5\u5220\u9664\u8fd9\u6837\u7684 pod\uff0c \u9700\u8981\u5148\u5220\u9664 rc\uff09"),(0,r.kt)("p",null,"\u5de5\u4f5c\u6d41\u7a0b\uff1a\u5bfb\u627e \u7b26\u5408 label selector \u7684 pod\uff0c \u6bd4\u8f83\u627e\u5230\u7684 pod \u548c\u671f\u671b\u6570\u91cf\uff0c \u5c11\u4e86\u5c31\u4ece\u5f53\u524d\u6a21\u677f\u521b\u5efa\u65b0\u7684 pod \u526f\u672c \uff0c \u591a\u4e86\uff0c \u5c31\u5220\u9664\u591a\u7684 pod"),(0,r.kt)("p",null,"\u4e09\u4e2a\u90e8\u5206\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"label selector\uff1a \u7528\u4e8e\u786e\u5b9a ReplicationController \u4f5c\u7528\u57df\u4e2d\u6709\u54ea\u4e9b pod")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"replica count (\u526f\u672c\u4e2a\u6570\uff09\uff0c \u6307\u5b9a\u5e94\u8fd0\u884c\u7684 pod \u6570\u91cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"pod template (pod \u6a21\u677f\uff09\uff0c \u7528\u4e8e\u521b\u5efa\u65b0\u7684 pod \u526f\u672c"))),(0,r.kt)("p",null,"\u5728\u65b0\u7248\u7684 K8s \u4e2d\uff0c\u5efa\u8bae\u4f7f\u7528 ReplicaSet \u4f5c\u4e3a\u526f\u672c\u63a7\u5236\u5668\uff0cReplicationController \u4e0d\u518d\u4f7f\u7528\u4e86"),(0,r.kt)("h4",{id:"672-rs-replica-set-\u4ee3\u66ff-rc"},"6.7.2. RS (replica set, \u4ee3\u66ff RC)"),(0,r.kt)("p",null,"\u526f\u672c\u96c6"),(0,r.kt)("p",null,"\u526f\u672c\u96c6\u5bf9\u8c61\u4e00\u822c\u4e0d\u5355\u72ec\u4f7f\u7528\uff0c\u800c\u662f\u7528 Deployment \u6765\u7ba1\u7406\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"RC \u548c RS \u4e3b\u8981\u662f\u63a7\u5236\u63d0\u4f9b\u65e0\u72b6\u6001\u670d\u52a1\u7684\uff0c\u5176\u6240\u63a7\u5236\u7684 Pod \u7684\u540d\u5b57\u662f\u968f\u673a\u8bbe\u7f6e\u7684\uff0c\u4e00\u4e2a Pod \u51fa\u6545\u969c\u4e86\u5c31\u88ab\u4e22\u5f03\u6389\uff0c\u5728\u53e6\u4e00\u4e2a\u5730\u65b9\u91cd\u542f\u4e00\u4e2a\u65b0\u7684 Pod\uff0c\u540d\u5b57\u53d8\u4e86\u3002\u540d\u5b57\u548c\u542f\u52a8\u5728\u54ea\u513f\u90fd\u4e0d\u91cd\u8981\uff0c\u91cd\u8981\u7684\u53ea\u662f Pod \u603b\u6570\uff1b"),(0,r.kt)("p",{parentName:"blockquote"},"\u5bf9\u4e8e RC \u548c RS \u4e2d\u7684 Pod\uff0c\u4e00\u822c\u4e0d\u6302\u8f7d\u5b58\u50a8\u6216\u8005\u6302\u8f7d\u5171\u4eab\u5b58\u50a8\uff0c\u4fdd\u5b58\u7684\u662f\u6240\u6709 Pod \u5171\u4eab\u7684\u72b6\u6001")),(0,r.kt)("h4",{id:"673-deployment-\u7ba1\u7406-rs"},"6.7.3. Deployment (\u7ba1\u7406 RS)"),(0,r.kt)("p",null,"\u8868\u793a\u7528\u6237\u5bf9 Kubernetes \u96c6\u7fa4\u7684\u4e00\u6b21\u66f4\u65b0\u64cd\u4f5c\u3002\u53ef\u4ee5\u662f\u521b\u5efa/\u66f4\u65b0\u4e00\u4e2a\u65b0\u7684\u670d\u52a1\uff0c\u4e5f\u53ef\u4ee5\u662f\u6eda\u52a8\u5347\u7ea7\u4e00\u4e2a\u670d\u52a1"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u6eda\u52a8\u5347\u7ea7\u4e00\u4e2a\u670d\u52a1\uff0c\u5b9e\u9645\u662f\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 RS\uff0c\u7136\u540e\u9010\u6e10\u5c06\u65b0 RS \u4e2d\u526f\u672c\u6570\u589e\u52a0\u5230\u7406\u60f3\u72b6\u6001\uff0c\u5c06\u65e7 RS \u4e2d\u7684\u526f\u672c\u6570\u51cf\u5c0f\u5230 0 \u7684\u590d\u5408\u64cd\u4f5c")),(0,r.kt)("p",null,"\u6bd4 replica set \u4f7f\u7528\u8303\u56f4\u66f4\u5e7f, \u4e00\u822c\u4f7f\u7528 deployment \u6765\u7ba1\u7406 replica set"),(0,r.kt)("p",null,"Here is the yml spec file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: hello-k8s-deployment\nspec:\n  # Control the scale up/back through this filed\n  replicas: 1\n  # required, used to select pods which can be managed by this deployment\n  selector:\n    matchLabels:\n      app: hello-k8s\n  template:\n    # Note: no need to specify \"name\" in metadata since the deployment will create the unique pod name automatically\n    metadata:\n      # required, used to be selected by deployment's selector\n      labels:\n        app: hello-k8s\n    spec:\n      containers:\n        # required, the final container name contains this field\n        - name: hello-k8s-container\n          image: xiaoyureed/hellok8s:v1\n          # optional\n          resources:\n            limits:\n              memory: '128Mi'\n              cpu: '500m'\n          # optional\n          ports:\n            - containerPort: 80  # \u6307\u5b9a container \u4e2d\u5e94\u7528\u66b4\u9732\u7684\u7aef\u53e3, \u5e94\u8be5\u4fdd\u6301\u548c dockerfile \u4e2d\u7684 expose \u4e00\u6837\n")),(0,r.kt)("h5",{id:"6731-scale-upback-\u6269\u5bb9\u7f29\u5bb9"},"6.7.3.1. scale up/back (\u6269\u5bb9\u7f29\u5bb9)"),(0,r.kt)("p",null,'With regards to Scale up/back, we just need update the "spec.replicas" field, then rerun ',(0,r.kt)("inlineCode",{parentName:"p"},"kubectl apply -f xxx.yml")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"We can use ",(0,r.kt)("inlineCode",{parentName:"p"},"kc get pods --watch")," to monitor the pod list")),(0,r.kt)("p",null,"or we can use this cmd ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl scale deployment test-k8s --replicas=5")),(0,r.kt)("h5",{id:"6732-version-upgrade-\u7248\u672c\u5347\u7ea7"},"6.7.3.2. version upgrade (\u7248\u672c\u5347\u7ea7)"),(0,r.kt)("p",null,"When talking about the app Version Upgrade, after make the code change, just need rebuild the image (note version number should change from v1 to v2) and push to docker hub, then update the yml ",(0,r.kt)("inlineCode",{parentName:"p"},"image")," field, finally exec ",(0,r.kt)("inlineCode",{parentName:"p"},"kc apply ...")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl describe pod xxx")," to check the pod details info, so that you can see the version info")),(0,r.kt)("h5",{id:"6733-rolling-update-\u6eda\u52a8\u5347\u7ea7"},"6.7.3.3. rolling update (\u6eda\u52a8\u5347\u7ea7)"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u50cf\u4e0a\u9762\u90a3\u6837\u7684\u90e8\u7f72\u65b9\u5f0f\u662f\u53ef\u4ee5\u7684\uff0c\u4f46\u662f\u4e5f\u4f1a\u5e26\u6765\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u6240\u6709\u7684\u526f\u672c\u5728\u540c\u4e00\u65f6\u95f4\u66f4\u65b0\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u6211\u4eec hellok8s \u670d\u52a1\u5728\u77ed\u65f6\u95f4\u5185\u662f\u4e0d\u53ef\u7528\u7684\uff0c\u56e0\u4e3a\u6240\u6709 pod \u90fd\u5728\u5347\u7ea7\u5230 v2 \u7248\u672c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u7b49\u5f85\u67d0\u4e2a pod \u5347\u7ea7\u5b8c\u6210\u540e\u624d\u80fd\u63d0\u4f9b\u670d\u52a1"),(0,r.kt)("p",{parentName:"blockquote"},"\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u9700\u8981\u6eda\u52a8\u66f4\u65b0\uff0c\u5728\u4fdd\u8bc1\u65b0\u7248\u672c v2 \u7684 pod \u8fd8\u6ca1\u6709 ready \u4e4b\u524d\uff0c\u5148\u4e0d\u5220\u9664 v1 \u7248\u672c\u7684 pod\u3002")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"spec.strategy.type")," 's possible values include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"RollingUpdate: \u9010\u6e10\u589e\u52a0\u65b0\u7248\u672c\u7684 pod\uff0c\u9010\u6e10\u51cf\u5c11\u65e7\u7248\u672c\u7684 pod\u3002"),(0,r.kt)("p",{parentName:"li"},"(\u53ef\u4ee5\u901a\u8fc7 maxSurge \u548c maxUnavailable \u5b57\u6bb5\u6765\u63a7\u5236\u5347\u7ea7 pod \u7684\u901f\u7387)"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"maxSurge: \u6700\u5927\u5cf0\u503c\uff0c\u7528\u6765\u6307\u5b9a\u53ef\u4ee5\u521b\u5efa\u7684\u8d85\u51fa\u671f\u671b Pod \u4e2a\u6570\u7684 Pod \u6570\u91cf\u3002"),(0,r.kt)("li",{parentName:"ul"},"maxUnavailable: \u6700\u5927\u4e0d\u53ef\u7528\uff0c\u7528\u6765\u6307\u5b9a\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u4e0d\u53ef\u7528\u7684 Pod \u7684\u4e2a\u6570\u4e0a\u9650\u3002"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Recreate: \u5728\u65b0\u7248\u672c\u7684 pod \u589e\u52a0\u524d\uff0c\u5148\u5c06\u6240\u6709\u65e7\u7248\u672c pod \u5220\u9664\u3002"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: hellok8s-deployment\nspec:\n  strategy:\n    # specify the upgrade type\n    rollingUpdate:\n      # \u6307\u5b9a pod \u7684\u6700\u5927\u8d85\u51fa\u4e2a\u6570\n      # \u6700\u5927\u53ef\u80fd\u4f1a\u521b\u5efa 4 \u4e2a hellok8s pod (replicas + maxSurge)\n      maxSurge: 1\n      # \u6307\u5b9a pod \u7684\u6700\u5927\u4e0d\u53ef\u7528\u4e2a\u6570\n      # \u6700\u5c0f\u4f1a\u6709 2 \u4e2a hellok8s pod \u5b58\u6d3b (replicas - maxUnavailable)\u3002\n      maxUnavailable: 1\n  replicas: 3\n  selector:\n    matchLabels:\n      app: hellok8s\n  template:\n    metadata:\n      labels:\n        app: hellok8s\n    spec:\n      containers:\n        - image: guangzhengli/hellok8s:v2\n          name: hellok8s-container\n")),(0,r.kt)("h5",{id:"6734-\u56de\u6eda-\u7248\u672c\u56de\u9000-\u67e5\u770b\u5386\u53f2"},"6.7.3.4. \u56de\u6eda \u7248\u672c\u56de\u9000 \u67e5\u770b\u5386\u53f2"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# roll back to last deployment version\nkubectl rollout undo deployment hellok8s-deployment\n\n# check the history version\nkubectl rollout history deployment hellok8s-deployment\n\n# roll back to the specified version\nkubectl rollout undo deployment/hellok8s-deployment --to-revision=2\n")),(0,r.kt)("h5",{id:"6735-livenessprobe-\u5b58\u6d3b\u63a2\u9488"},"6.7.3.5. livenessProbe (\u5b58\u6d3b\u63a2\u9488)"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5728\u751f\u4ea7\u4e2d\uff0c\u6709\u65f6\u5019\u56e0\u4e3a\u67d0\u4e9b bug \u5bfc\u81f4\u5e94\u7528\u6b7b\u9501\u6216\u8005\u7ebf\u7a0b\u8017\u5c3d\u4e86\uff0c\u6700\u7ec8\u4f1a\u5bfc\u81f4\u5e94\u7528\u65e0\u6cd5\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\uff0c\u8fd9\u4e2a\u65f6\u5019\u5982\u679c\u6ca1\u6709\u624b\u6bb5\u6765\u81ea\u52a8\u76d1\u63a7\u548c\u5904\u7406\u8fd9\u4e00\u95ee\u9898\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u65e0\u4eba\u53d1\u73b0")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: hellok8s-deployment\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 1\n      maxUnavailable: 1\n  replicas: 3\n  selector:\n    matchLabels:\n      app: hellok8s\n  template:\n    metadata:\n      labels:\n        app: hellok8s\n    spec:\n      containers:\n        - image: guangzhengli/hellok8s:liveness\n          name: hellok8s-container\n          # \u5982\u679c\u670d\u52a1\u5668\u4e0a /healthz \u8def\u5f84\u4e0b\u7684\u5904\u7406\u7a0b\u5e8f\u8fd4\u56de\u6210\u529f\u4ee3\u7801\uff0c\u5219 kubelet \u8ba4\u4e3a\u5bb9\u5668\u662f\u5065\u5eb7\u5b58\u6d3b\u7684\u3002 \u5982\u679c\u5904\u7406\u7a0b\u5e8f\u8fd4\u56de\u5931\u8d25\u4ee3\u7801\uff0c\u5219 kubelet \u4f1a\u6740\u6b7b\u8fd9\u4e2a\u5bb9\u5668\u5e76\u5c06\u5176\u91cd\u542f\n          livenessProbe:\n            # \u4f7f\u7528 HTTP GET \u8bf7\u6c42\u7684\u65b9\u5f0f\u63a2\u6d3b\n            httpGet:\n              # Specify the application route (api path)\n              path: /healthz\n              # specify the application port\n              port: 3000\n            # \u544a\u8bc9 kubelet \u5728\u6267\u884c\u7b2c\u4e00\u6b21\u63a2\u6d4b\u524d\u5e94\u8be5\u7b49\u5f85 3 \u79d2\n            # \u5373\u5bb9\u5668\u542f\u52a8\u540e\u8981\u7b49\u5f85\u591a\u5c11\u79d2\u540e\u624d\u542f\u52a8\u5b58\u6d3b\u548c\u5c31\u7eea\u63a2\u6d4b\u5668\n            initialDelaySeconds: 3\n            # \u6267\u884c\u63a2\u6d4b\u7684\u65f6\u95f4\u95f4\u9694\uff08\u5355\u4f4d\u662f\u79d2\uff09\u3002\u9ed8\u8ba4\u662f 10 \u79d2\u3002\u6700\u5c0f\u503c\u662f 1\u3002\n            periodSeconds: 3\n\n            # timeoutSeconds\uff1a\u63a2\u6d4b\u7684\u8d85\u65f6\u540e\u7b49\u5f85\u591a\u5c11\u79d2\u3002\u9ed8\u8ba4\u503c\u662f 1 \u79d2\u3002\u6700\u5c0f\u503c\u662f 1\u3002\n            # failureThreshold\uff1a\u5f53\u63a2\u6d4b\u5931\u8d25\u65f6\uff0cKubernetes \u7684\u91cd\u8bd5\u6b21\u6570\u3002 \u5bf9\u5b58\u6d3b\u63a2\u6d4b\u800c\u8a00\uff0c\u653e\u5f03\u5c31\u610f\u5473\u7740\u91cd\u65b0\u542f\u52a8\u5bb9\u5668\u3002 \u5bf9\u5c31\u7eea\u63a2\u6d4b\u800c\u8a00\uff0c\u653e\u5f03\u610f\u5473\u7740 Pod \u4f1a\u88ab\u6253\u4e0a\u672a\u5c31\u7eea\u7684\u6807\u7b7e\u3002\u9ed8\u8ba4\u503c\u662f 3\u3002\u6700\u5c0f\u503c\u662f 1\u3002\n")),(0,r.kt)("p",null,"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl get pods")," \u67e5\u770b\u72b6\u6001 or ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl describe pod hellok8s-68f47f657c-zwn6g")," \u67e5\u770b\u539f\u56e0,"),(0,r.kt)("h5",{id:"6736-readinessprobe-\u5c31\u7eea\u63a2\u9488"},"6.7.3.6. readinessProbe (\u5c31\u7eea\u63a2\u9488)"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5347\u7ea7\u670d\u52a1\u7684\u7248\u672c\u662f\u65e5\u5e38\u7684\u9700\u6c42\uff0c\u8fd9\u65f6\u6211\u4eec\u9700\u8981\u8003\u8651\u4e00\u79cd\u573a\u666f\uff0c\u5373\u5f53\u53d1\u5e03\u7684\u7248\u672c\u5b58\u5728\u95ee\u9898\uff0c\u5c31\u4e0d\u5e94\u8be5\u8ba9\u5b83\u5347\u7ea7\u6210\u529f\u3002kubelet \u4f7f\u7528\u5c31\u7eea\u63a2\u6d4b\u5668\u53ef\u4ee5\u77e5\u9053\u5bb9\u5668\u4f55\u65f6\u51c6\u5907\u597d\u63a5\u53d7\u8bf7\u6c42\u6d41\u91cf\uff0c\u5f53\u4e00\u4e2a pod \u5347\u7ea7\u540e\u4e0d\u80fd\u5c31\u7eea\uff0c\u5373\u4e0d\u5e94\u8be5\u8ba9\u6d41\u91cf\u8fdb\u5165\u8be5 pod\uff0c\u5728\u914d\u5408 rollingUpate \u7684\u529f\u80fd\u4e0b\uff0c\u4e5f\u4e0d\u80fd\u5141\u8bb8\u5347\u7ea7\u7248\u672c\u7ee7\u7eed\u4e0b\u53bb\uff0c\u5426\u5219\u670d\u52a1\u4f1a\u51fa\u73b0\u5168\u90e8\u5347\u7ea7\u5b8c\u6210\uff0c\u5bfc\u81f4\u6240\u6709\u670d\u52a1\u5747\u4e0d\u53ef\u7528\u7684\u60c5\u51b5\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: hellok8s-deployment\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 1\n      maxUnavailable: 1\n  replicas: 3\n  selector:\n    matchLabels:\n      app: hellok8s\n  template:\n    metadata:\n      labels:\n        app: hellok8s\n    spec:\n      containers:\n        - image: guangzhengli/hellok8s:bad\n          name: hellok8s-container\n          readinessProbe:\n            httpGet:\n              path: /healthz\n              port: 3000\n            # \u521d\u6b21\u63a2\u6d4b\u524d\u7b49\u5f85\u65f6\u95f4, \u9ed8\u8ba4\u662f 0 \u79d2\uff0c\u6700\u5c0f\u503c\u662f 0\n            initialDelaySeconds: 1\n            # \u88ab\u89c6\u4e3a\u6210\u529f\u7684\u6700\u5c0f\u8fde\u7eed\u6210\u529f\u6570\u3002\u9ed8\u8ba4\u503c\u662f 1\u3002 \u5b58\u6d3b\u548c\u542f\u52a8\u63a2\u6d4b\u7684\u8fd9\u4e2a\u503c\u5fc5\u987b\u662f 1\u3002\u6700\u5c0f\u503c\u662f 1\u3002\n            successThreshold: 5\n")),(0,r.kt)("h4",{id:"674-sc-stateful-set"},"6.7.4. SC (stateful set)"),(0,r.kt)("p",null,"\u6709\u72b6\u6001\u5e94\u7528\u90e8\u7f72 (\u5982 MySQL, ZooKeeper\u3001etcd )"),(0,r.kt)("p",null,"StatefulSet \u4e2d\u7684\u6bcf\u4e2a Pod \u7684\u540d\u5b57\u90fd\u662f\u4e8b\u5148\u786e\u5b9a\u7684\uff0c\u4f1a\u88ab\u56fa\u5b9a\u4f4f"),(0,r.kt)("p",null,"StatefulSet \u4e2d\u7684 Pod\uff0c\u6bcf\u4e2a Pod \u6302\u8f7d\u81ea\u5df1\u72ec\u7acb\u6307\u5b9a\u7684\u5b58\u50a8\uff0c"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5982\u679c\u4e00\u4e2a Pod \u51fa\u73b0\u6545\u969c\uff0c\u4ece\u5176\u4ed6\u8282\u70b9\u542f\u52a8\u4e00\u4e2a\u540c\u6837\u540d\u5b57\u7684 Pod\uff0c\u8981\u6302\u8f7d\u4e0a\u539f\u6765 Pod \u7684\u5b58\u50a8\u7ee7\u7eed\u4ee5\u5b83\u7684\u72b6\u6001\u63d0\u4f9b\u670d\u52a1"),(0,r.kt)("p",{parentName:"blockquote"},"\u4f7f\u7528 StatefulSet\uff0cPod \u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7\u6f02\u79fb\u5230\u4e0d\u540c\u8282\u70b9\u63d0\u4f9b\u9ad8\u53ef\u7528\uff0c\u800c\u5b58\u50a8\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5916\u6302\u7684\u5b58\u50a8\u6765\u63d0\u4f9b\u9ad8\u53ef\u9760\u6027\uff0cStatefulSet \u505a\u7684\u53ea\u662f\u5c06\u786e\u5b9a\u7684 Pod \u4e0e\u786e\u5b9a\u7684\u5b58\u50a8\u5173\u8054\u8d77\u6765\u4fdd\u8bc1\u72b6\u6001\u7684\u8fde\u7eed\u6027\u3002")),(0,r.kt)("p",null,"Service \u7684 CLUSTER-IP \u662f\u7a7a\u7684"),(0,r.kt)("p",null,"Pod \u521b\u5efa\u548c\u9500\u6bc1\u662f\u6709\u5e8f\u7684\uff0c\u521b\u5efa\u662f\u987a\u5e8f\u7684\uff0c\u9500\u6bc1\u662f\u9006\u5e8f\u7684"),(0,r.kt)("p",null,"\u5982\u4e0b\u90e8\u7f72 MongoDB:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mongodb\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: mongodb\n  serviceName: mongodb\n  template:\n    metadata:\n      labels:\n        app: mongodb\n    spec:\n      containers:\n        - name: mongo\n          image: mongo:4.4\n          # IfNotPresent \u4ec5\u672c\u5730\u6ca1\u6709\u955c\u50cf\u65f6\u624d\u8fdc\u7a0b\u62c9\uff0cAlways \u6c38\u8fdc\u90fd\u662f\u4ece\u8fdc\u7a0b\u62c9\uff0cNever \u6c38\u8fdc\u53ea\u7528\u672c\u5730\u955c\u50cf\uff0c\u672c\u5730\u6ca1\u6709\u5219\u62a5\u9519\n          imagePullPolicy: IfNotPresent\n          volumeMounts:\n            - mountPath: /data/db # \u5bb9\u5668\u91cc\u9762\u7684\u6302\u8f7d\u8def\u5f84\n              name: mongo-data    # \u5377\u540d\u5b57\uff0c\u5fc5\u987b\u8ddf\u4e0b\u9762\u5b9a\u4e49\u7684\u540d\u5b57\u4e00\u81f4\n      volumes:\n        - name: mongo-data              # \u5377\u540d\u5b57\n          hostPath:\n            # \u628a\u8282\u70b9\u4e0a\u7684\u4e00\u4e2a\u76ee\u5f55\u6302\u8f7d\u5230 Pod\uff0c\u4f46\u662f\u5df2\u7ecf\u4e0d\u63a8\u8350\u4f7f\u7528\u4e86\n            path: /data/mongo-data      # \u8282\u70b9\u4e0a\u7684\u8def\u5f84\n            type: DirectoryOrCreate     # \u6307\u5411\u4e00\u4e2a\u76ee\u5f55\uff0c\u4e0d\u5b58\u5728\u65f6\u81ea\u52a8\u521b\u5efa\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: mongodb # \u56fa\u5b9a\u7684\nspec:\n  selector:\n    app: mongodb\n  type: ClusterIP\n  # HeadLess\n  clusterIP: None\n  ports:\n    - port: 27017\n      targetPort: 27017\n\n")),(0,r.kt)("h5",{id:"6741-\u6570\u636e\u6301\u4e45\u5316-persist"},"6.7.4.1. \u6570\u636e\u6301\u4e45\u5316 persist"),(0,r.kt)("p",null,"Storage Class (SC) : \u5c06\u5b58\u50a8\u5377\u5212\u5206\u4e3a\u4e0d\u540c\u7684\u79cd\u7c7b\uff0c\u4f8b\u5982\uff1aSSD\uff0c\u666e\u901a\u78c1\u76d8\uff0c\u672c\u5730\u78c1\u76d8"),(0,r.kt)("p",null,"Persistent Volume (PV) : \u63cf\u8ff0\u5377\u7684\u5177\u4f53\u4fe1\u606f\uff0c\u4f8b\u5982\u78c1\u76d8\u5927\u5c0f\uff0c\u8bbf\u95ee\u6a21\u5f0f"),(0,r.kt)("p",null,"Persistent Volume Claim (PVC): \u5bf9\u5b58\u50a8\u9700\u6c42\u7684\u4e00\u4e2a\u7533\u660e\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u7533\u8bf7\u5355\uff0c\u7cfb\u7edf\u6839\u636e\u8fd9\u4e2a\u7533\u8bf7\u5355\u53bb\u627e\u4e00\u4e2a\u5408\u9002\u7684 PV"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u8fd8\u53ef\u4ee5\u6839\u636e PVC \u81ea\u52a8\u521b\u5efa PV\u3002")),(0,r.kt)("p",null,"PersistemVolume(PV)\u7528\u6765\u5b9a\u4e49\u5b58\u50a8\u5377\uff0cPersistemVolumeClaim(PVC)\u7528\u6765\u58f0\u660e\u5728Pod\u4e2d\u7528\u54ea\u4e2aPV\u3002\u901a\u5e38PV\u548cPVC\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u3002\u4f46\u662f\u5982\u679c\u6bcf\u6b21\u90fd\u8981\u53bb\u521b\u5efaPV\u592a\u9ebb\u70e6\u4e86\uff0c\u6240\u4ee5K8S\u8fd8\u63d0\u4f9b\u4e86StorageClass\u6765\u52a8\u6001\u521b\u5efaPV\u3002\u524d\u9762\u7684StatefulSets\u56e0\u4e3a\u8981\u4fdd\u8bc1Pod\u7684\u72b6\u6001\u6301\u4e45\u5316\u843d\u76d8\uff0c\u5b83\u5c31\u4f9d\u8d56\u4e8ePV\u548cPVC\u8fd9\u73a9\u610f\u513f\u505a\u6301\u4e45\u5316\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"xx",src:t(15978).Z,width:"1264",height:"1362"})),(0,r.kt)("h4",{id:"675-ds-daemon-set-\u540e\u53f0\u652f\u6491\u670d\u52a1\u96c6"},"6.7.5. DS (daemon set \u540e\u53f0\u652f\u6491\u670d\u52a1\u96c6)"),(0,r.kt)("p",null,"\u786e\u4fdd\u6bcf\u4e2a working node \u90fd\u8fd0\u884c\u4e00\u4e2a\u6307\u5b9a pod (working node \u53ef\u80fd\u662f\u6240\u6709\u96c6\u7fa4\u8282\u70b9\u4e5f\u53ef\u80fd\u662f\u901a\u8fc7 nodeSelector \u9009\u5b9a\u7684\u4e00\u4e9b\u7279\u5b9a\u8282\u70b9)"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u8fd9\u4e2a pod \u53ef\u80fd\u662f\u7528\u6765\u4e13\u95e8\u652f\u6491\u4e1a\u52a1\u7cfb\u7edf\u8fd0\u884c\u7684\u57fa\u7840\u670d\u52a1, \u6bd4\u5982\u5bf9\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e2a working node \u505a\u65e5\u5fd7\u91c7\u96c6\uff0c\u6027\u80fd\u6307\u6807\u76d1\u63a7")),(0,r.kt)("h4",{id:"676-job-\u4e00\u6b21\u6027\u4efb\u52a1"},"6.7.6. job (\u4e00\u6b21\u6027\u4efb\u52a1)"),(0,r.kt)("p",null,"Job \u7ba1\u7406\u7684 Pod \u6839\u636e\u7528\u6237\u7684\u8bbe\u7f6e\u628a\u4efb\u52a1\u6210\u529f\u5b8c\u6210\u5c31\u81ea\u52a8\u9000\u51fa\u4e86"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u6210\u529f\u5b8c\u6210\u7684\u6807\u5fd7\u6839\u636e\u4e0d\u540c\u7684 spec.completions \u7b56\u7565\u800c\u4e0d\u540c\uff1a"),(0,r.kt)("ul",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ul"},"\u5355 Pod \u578b\u4efb\u52a1\u6709\u4e00\u4e2a Pod \u6210\u529f\u5c31\u6807\u5fd7\u5b8c\u6210\uff1b"),(0,r.kt)("li",{parentName:"ul"},"\u5b9a\u6570\u6210\u529f\u578b\u4efb\u52a1\u4fdd\u8bc1\u6709 N \u4e2a\u4efb\u52a1\u5168\u90e8\u6210\u529f\uff1b"),(0,r.kt)("li",{parentName:"ul"},"\u5de5\u4f5c\u961f\u5217\u578b\u4efb\u52a1\u6839\u636e\u5e94\u7528\u786e\u8ba4\u7684\u5168\u5c40\u6210\u529f\u800c\u6807\u5fd7\u6210\u529f\u3002"))),(0,r.kt)("p",null,"Job \u5b8c\u6210\u65f6\u4e0d\u4f1a\u518d\u521b\u5efa\u65b0\u7684 Pod\uff0c\u4e0d\u8fc7\u5df2\u6709\u7684 Pod \u901a\u5e38\u4e5f\u4e0d\u4f1a\u88ab\u5220\u9664"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u4fdd\u7559\u8fd9\u4e9b Pod \u4f7f\u5f97\u4f60\u53ef\u4ee5\u67e5\u770b\u5df2\u5b8c\u6210\u7684 Pod \u7684\u65e5\u5fd7\u8f93\u51fa\uff0c\u4ee5\u4fbf\u68c0\u67e5\u9519\u8bef\u3001\u8b66\u544a\u6216\u8005\u5176\u5b83\u8bca\u65ad\u6027\u8f93\u51fa\u3002 \u53ef\u4ee5\u4f7f\u7528 kubectl \u6765\u5220\u9664 Job\uff08\u4f8b\u5982 kubectl delete -f hello-job.yaml)\u3002\u5f53\u4f7f\u7528 kubectl \u6765\u5220\u9664 Job \u65f6\uff0c\u8be5 Job \u6240\u521b\u5efa\u7684 Pod \u4e5f\u4f1a\u88ab\u5220\u9664")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: hello-job\n# \u4f8b\u5982\u4e0b\u9762\u5c31\u4f1a\u5148\u521b\u5efa 3 \u4e2a pod \u5e76\u53d1\u6267\u884c\u4efb\u52a1\uff0c\n# \u4e00\u65e6\u67d0\u4e2a pod \u6267\u884c\u5b8c\u6210\uff0c\u5c31\u4f1a\u518d\u521b\u5efa\u65b0\u7684 pod \u6765\u6267\u884c\uff0c\u76f4\u5230 5 \u4e2a pod \u6267\u884c\u5b8c\u6210\uff0cJob \u624d\u4f1a\u88ab\u6807\u8bb0\u4e3a\u5b8c\u6210\u3002\nspec:\n  # \u5e76\u53d1\u6267\u884c\u7684 pod \u7684\u6570\u91cf\n  parallelism: 3\n  # \u521b\u5efa Pod \u7684\u6570\u91cf\n  completions: 5\n  template:\n    spec:\n      # pod \u5185\u7684 container \u5f02\u5e38\u800c\u7ed3\u675f\u65f6, Pod \u4f1a\u7ee7\u7eed\u4fdd\u7559\u5728\u5f53\u524d node, \u4f46\u662f\u91cd\u542f\u5185\u90e8 container\n      # \u53ef\u9009\u503c: Never, ...\n      restartPolicy: OnFailure\n      containers:\n        - name: echo\n          image: busybox\n          command:\n            - "/bin/sh"\n          args:\n            - "-c"\n            - "for i in 9 8 7 6 5 4 3 2 1 ; do echo $i ; done"\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl apply -f hello-job.yaml\n\n\nkubectl get jobs      \nkubectl get cronjob[s]            \n\nkubectl get pods -w\n\nkubectl logs -f xxx_pod\n")),(0,r.kt)("h4",{id:"677-cronjob-\u5b9a\u65f6\u4efb\u52a1"},"6.7.7. cronjob (\u5b9a\u65f6\u4efb\u52a1)"),(0,r.kt)("p",null,"\u7528\u6cd5\u9664\u4e86\u9700\u8981\u52a0\u4e0a cron \u8868\u8fbe\u5f0f\u4e4b\u5916\uff0c\u5176\u4f59\u57fa\u672c\u548c Job \u4fdd\u6301\u4e00\u81f4\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u5206\u949f (0 - 59)\n# \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u5c0f\u65f6 (0 - 23)\n# \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u6708\u7684\u67d0\u5929 (1 - 31)\n# \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u6708\u4efd (1 - 12)\n# \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u5468\u7684\u67d0\u5929 (0 - 6)\uff08\u5468\u65e5\u5230\u5468\u4e00\uff1b\u5728\u67d0\u4e9b\u7cfb\u7edf\u4e0a\uff0c7 \u4e5f\u662f\u661f\u671f\u65e5\uff09\n# \u2502 \u2502 \u2502 \u2502 \u2502                          \u6216\u8005\u662f sun\uff0cmon\uff0ctue\uff0cweb\uff0cthu\uff0cfri\uff0csat\n# \u2502 \u2502 \u2502 \u2502 \u2502\n# \u2502 \u2502 \u2502 \u2502 \u2502\n# * * * * *\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'apiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: hello-cronjob\nspec:\n  schedule: "* * * * *" # Every minute\n  jobTemplate:\n    spec:\n      template:\n        spec:\n          restartPolicy: OnFailure\n          containers:\n            - name: echo\n              image: busybox\n              command:\n                - "/bin/sh"\n              args:\n                - "-c"\n                - "for i in 9 8 7 6 5 4 3 2 1 ; do echo $i ; done"\n')),(0,r.kt)("h3",{id:"68-service"},"6.8. service"),(0,r.kt)("p",null,"\u7528\u6765\u4ee3\u7406\u4e00\u7ec4 pods, \u901a\u8fc7 label selector \u9009\u62e9\u4e00\u6279 pods"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Pod\u91cd\u5efa\u540eip\u662f\u4f1a\u91cd\u65b0\u5206\u914d\u7684\uff0c\u800c\u4e14\u4e00\u4e2a\u670d\u52a1Pod\u6709\u597d\u51e0\u4e2a, \u6240\u4ee5\u670d\u52a1\u4e4b\u95f4\u7684\u8c03\u7528\u80af\u5b9a\u4e0d\u80fd\u7528Pod\u7684ip\uff0c\u9700\u8981 service \u63d0\u4f9b\u4ee3\u7406; \u4f46\u662f\u8fd9\u4e2aService\u4ee3\u7406\u548cNginx\u8fd9\u6837\u7684\u53cd\u5411\u4ee3\u7406\u8fd8\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u5b83\u672c\u8d28\u4e0a\u662f\u548cLVS\u7c7b\u4f3c\u7684\u56db\u5c42\u4ee3\u7406\uff0c\u4e5f\u5c31\u662f\u4f20\u8f93\u5c42\u4ee3\u7406, \u5b83\u662f\u4e0d\u533a\u5206\u5e94\u7528\u5c42\u662fhttp\u6d41\u91cf\u8fd8\u662fmysql\u7684\u6d41\u91cf\u7684"),(0,r.kt)("p",{parentName:"blockquote"},"\u63d0\u4f9b\u8bbf\u95ee\u670d\u52a1\u7684\u56fa\u5b9a\u5730\u5740(\u670d\u52a1\u53d1\u73b0, \u8d1f\u8f7d\u5747\u8861).")),(0,r.kt)("p",null,"\u6bcf\u4e2a Service \u4f1a\u5bf9\u5e94\u4e00\u4e2a\u96c6\u7fa4\u5185\u90e8\u6709\u6548\u7684\u865a\u62df IP\uff0c\u96c6\u7fa4\u5185\u90e8\u901a\u8fc7\u865a\u62df IP (or service name) \u8bbf\u95ee\u4e00\u4e2a\u670d\u52a1"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"RC\u3001RS \u548c Deployment \u53ea\u662f\u4fdd\u8bc1\u4e86\u652f\u6491\u670d\u52a1\u7684\u5fae\u670d\u52a1 Pod \u7684\u6570\u91cf\uff0c\u4f46\u662f\u6ca1\u6709\u89e3\u51b3\u5982\u4f55\u8bbf\u95ee\u8fd9\u4e9b\u670d\u52a1\u7684\u95ee\u9898\u3002\u4e00\u4e2a Pod \u53ea\u662f\u4e00\u4e2a\u8fd0\u884c\u670d\u52a1\u7684\u5b9e\u4f8b\uff0c\u968f\u65f6\u53ef\u80fd\u5728\u4e00\u4e2a\u8282\u70b9\u4e0a\u505c\u6b62\uff0c\u5728\u53e6\u4e00\u4e2a\u8282\u70b9\u4ee5\u4e00\u4e2a\u65b0\u7684 IP \u542f\u52a8\u4e00\u4e2a\u65b0\u7684 Pod\uff0c\u56e0\u6b64\u4e0d\u80fd\u4ee5\u786e\u5b9a\u7684 IP \u548c\u7aef\u53e3\u53f7\u63d0\u4f9b\u670d\u52a1\u3002\u8981\u7a33\u5b9a\u5730\u63d0\u4f9b\u670d\u52a1\u9700\u8981\u670d\u52a1\u53d1\u73b0\u548c\u8d1f\u8f7d\u5747\u8861\u80fd\u529b\u3002"),(0,r.kt)("p",{parentName:"blockquote"},"\u5728 K8 \u96c6\u7fa4\u4e2d\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u8bbf\u95ee\u7684\u670d\u52a1\u5c31\u662f Service \u5bf9\u8c61, \u7c7b\u4f3c \u5fae\u670d\u52a1\u4e2d\u6ce8\u518c\u4e2d\u5fc3\u7684\u89d2\u8272, \u901a\u8fc7\u67d0\u4e2a service, \u53ef\u8bbf\u95ee\u4e00\u7ec4\u63d0\u4f9b\u76f8\u540c\u670d\u52a1\u7684 pods")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"\nkubectl get service[s]\n\n\n")),(0,r.kt)("h4",{id:"681-endpoint"},"6.8.1. Endpoint"),(0,r.kt)("p",null,"\u88ab selector \u9009\u4e2d\u7684 Pod\uff0c\u5c31\u79f0\u4e3a Service \u7684 Endpoints"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5b83\u7ef4\u62a4\u7740 Pod \u7684 IP \u5730\u5740\uff0c\u53ea\u8981\u670d\u52a1\u4e2d\u7684 Pod \u96c6\u5408\u53d1\u751f\u66f4\u6539\uff0cEndpoints \u5c31\u4f1a\u88ab\u66f4\u65b0")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# check list\nkubectl get endpoints\n")),(0,r.kt)("h4",{id:"682-\u591a\u7aef\u53e3"},"6.8.2. \u591a\u7aef\u53e3"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: v1\nkind: Service\nmetadata:\n  name: test-k8s\nspec:\n  selector:\n    app: test-k8s\n  type: NodePort\n  ports:\n    - port: 8080        # \u672c Service \u7684\u7aef\u53e3\n      name: test-k8s    # \u591a\u7aef\u53e3\u65f6\u5fc5\u987b\u914d\u7f6e name\n      targetPort: 8080  # \u5bb9\u5668\u7aef\u53e3\n      nodePort: 31000   # \u8282\u70b9\u7aef\u53e3\uff0c\u8303\u56f4\u56fa\u5b9a 30000 ~ 32767\n    - port: 8090\n      name: test-other\n      targetPort: 8090\n      nodePort: 32000\n\n\n")),(0,r.kt)("h4",{id:"683-\u5404\u79cd-service-port-\u7c7b\u578b"},"6.8.3. \u5404\u79cd service port \u7c7b\u578b"),(0,r.kt)("p",null,"K8S \u7684\u7ed3\u6784\u53ef\u4ee5\u5927\u81f4\u5206\u4e3a 3 \u5c42\uff0cNode, Pod, Container, \u4e3a\u4e86\u4fdd\u62a4 Container \u91cc\u9762\u7684\u5e94\u7528\uff0c\u5404\u5c42\u90fd\u8fdb\u884c\u4e86\u9694\u79bb\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u80fd\u591f\u8bbf\u95ee\u5230 Pod \u91cc\u9762\u7684 Container, Service \u5b9a\u4e49\u4e86\u51e0\u79cd Port \u7c7b\u578b\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Port - exposes the Kubernetes service on the specified port within the cluster. Other pods within the cluster can communicate with this server on the specified port."),(0,r.kt)("p",{parentName:"li"},"\u662f\u66b4\u9732\u5728\u96c6\u7fa4\u5185\u90e8 Ip \u4e0a\u7684\u7aef\u53e3, \u63d0\u4f9b\u96c6\u7fa4\u5185\u90e8\u8bbf\u95ee service \u7684\u5165\u53e3, \u5373 ",(0,r.kt)("inlineCode",{parentName:"p"},"clusterIP:port")),(0,r.kt)("p",{parentName:"li"},"\u8fd9\u65f6\u7684 service \u7c7b\u578b\u5373 clusterIp \u7c7b\u578b (k8s \u9ed8\u8ba4\u7684 service type), \u4ec5\u4ec5\u80fd\u5728\u5185\u90e8\u4e92\u76f8\u8bbf\u95ee")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"TargetPort - is the port on which the service will send requests to, that your pod will be listening on. Your application in the container will need to be listening on this port also."),(0,r.kt)("p",{parentName:"li"},"Pod \u548c Container \u76d1\u542c\u7684 Port.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"NodePort - exposes a service externally to the cluster by means of the target nodes IP address and the NodePort. NodePort is the default setting if the port field is not specified."),(0,r.kt)("p",{parentName:"li"},"\u66b4\u9732\u7aef\u53e3\u5230\u8282\u70b9\uff0c\u53ef\u4ee5\u8ba9\u5916\u7f51\u80fd\u591f\u8bbf\u95ee\u5230 Pod/Container."),(0,r.kt)("p",{parentName:"li"},"\u8303\u56f4\u56fa\u5b9a 30000 ~ 32767"))),(0,r.kt)("h4",{id:"684-clusterip-\u9ed8\u8ba4\u4f7f\u7528\u7684\u7c7b\u578b"},"6.8.4. ClusterIP (\u9ed8\u8ba4\u4f7f\u7528\u7684\u7c7b\u578b)"),(0,r.kt)("p",null,"\u901a\u8fc7 kubernetes \u96c6\u7fa4\u7684\u5185\u90e8 IP \u66b4\u9732\u670d\u52a1"),(0,r.kt)("p",null,"\u4ec5\u4f9b\u96c6\u7fa4\u5185\u90e8\u4e92\u76f8\u8bbf\u95ee"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5f53\u6211\u4eec\u53ea\u9700\u8981\u8ba9\u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u6211\u4eec\u7684 pod \u65f6\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u7c7b\u578b\u7684 Service")),(0,r.kt)("p",null,(0,r.kt)("img",{src:t(26758).Z,width:"1306",height:"976"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: v1\nkind: Service\nmetadata:\n  name: service-hellok8s-clusterip\nspec:\n  # optional, \u9ed8\u8ba4\u5c31\u662f\u8fd9\u6837\n  type: ClusterIP\n  # associate with pods by using the label selector\n  selector:\n    app: hellok8s\n  ports:\n    # \u5f53\u524d service \u5728\u96c6\u7fa4\u5185\u90e8\u66b4\u9732\u7684\u7aef\u53e3, \u5373\u96c6\u7fa4\u5185\u90e8\u5176\u4ed6client\u901a\u8fc7\u8fd9\u4e2a\u7aef\u53e3\u8bbf\u95ee\u5f53\u524d service\n    - port: 3000\n      #  \u6307\u5b9a\u5f53\u524d service \u7ba1\u7406\u7684 pod \u4e0a\u7684\u7aef\u53e3(\u4e0e\u5236\u4f5c\u5bb9\u5668\u65f6\u66b4\u9732\u7684\u7aef\u53e3\u4e00\u81f4\uff08\u5373DockerFile\u4e2d\u7684EXPOSE\uff09)\n      # \u4eceport/nodePort\u4e0a\u6765\u7684\u6570\u636e\uff0c\u7ecf\u8fc7kube-proxy\u6d41\u5165\u5230\u540e\u7aefpod\u7684targetPort\u4e0a\uff0c\u6700\u540e\u8fdb\u5165\u5bb9\u5668\u3002\n      targetPort: 3000\n")),(0,r.kt)("h5",{id:"6841-headless"},"6.8.4.1. Headless"),(0,r.kt)("p",null,"service type \u8fd8\u662f clusterIP, \u4f46\u662f clusterIp \u8bbe\u7f6e\u4e3a None \u5c31\u53d8\u6210 Headless \u4e86\uff0c\u4e0d\u4f1a\u518d\u5206\u914d IP "),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u9002\u5408\u6570\u636e\u5e93")),(0,r.kt)("h4",{id:"685-nodeport"},"6.8.5. NodePort"),(0,r.kt)("p",null,"\u628aService\u6620\u5c04\u5230\u8282\u70b9\u7684IP\u4e0a, \u901a\u8fc7node \u4e0a\u6307\u5b9a\u7684\u7aef\u53e3\u5c06\u670d\u52a1\u66b4\u9732\u7ed9\u96c6\u7fa4\u5916\u90e8\u8bbf\u95ee"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u4f46\u662f node port \u6570\u91cf\u662f\u6709\u9650\u7684, \u516d\u4e07\u591a\u4e2a\u5427, \u5982\u679c\u90fd\u7528\u8fd9\u79cd\u65b9\u5f0f\u66b4\u9732\u670d\u52a1\u7ed9\u96c6\u7fa4\u5916\u90e8\u8bbf\u95ee, \u603b\u6709\u7528\u5b8c\u7684\u65f6\u5019, \u8fd9\u662f\u9700\u8981 ingress")),(0,r.kt)("p",null,"NodePort \u670d\u52a1\u4f1a\u8def\u7531\u5230\u81ea\u52a8\u521b\u5efa\u7684 ClusterIP \u670d\u52a1\u3002"),(0,r.kt)("p",null,"\u901a\u8fc7\u8bf7\u6c42 ",(0,r.kt)("inlineCode",{parentName:"p"},"<nodeIP>:<nodePort>"),"\uff0c\u4f60\u53ef\u4ee5\u4ece\u96c6\u7fa4\u7684\u5916\u90e8\u8bbf\u95ee\u4e00\u4e2a NodePort \u670d\u52a1"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u6bd4\u5982\u5916\u90e8\u7528\u6237\u8981\u8bbf\u95ee k8s \u96c6\u7fa4\u4e2d\u7684\u4e00\u4e2a Web \u5e94\u7528\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u914d\u7f6e\u5bf9\u5e94 service \u7684 type=NodePort\uff0cnodePort=30001\u3002\u5176\u4ed6\u7528\u6237\u5c31\u53ef\u4ee5\u901a\u8fc7\u6d4f\u89c8\u5668 http://node:30001 \u8bbf\u95ee\u5230\u8be5 web \u670d\u52a1\u3002"),(0,r.kt)("p",{parentName:"blockquote"},"\u800c\u6570\u636e\u5e93\u7b49\u670d\u52a1\u53ef\u80fd\u4e0d\u9700\u8981\u88ab\u5916\u754c\u8bbf\u95ee\uff0c\u53ea\u9700\u88ab\u5185\u90e8\u670d\u52a1\u8bbf\u95ee\u5373\u53ef\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u4e0d\u5fc5\u8bbe\u7f6e service \u7684 NodePort\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-service\nspec:\n  type: NodePort            // \u914d\u7f6eNodePort\uff0c\u5916\u90e8\u6d41\u91cf\u53ef\u8bbf\u95eek8s\u4e2d\u7684\u670d\u52a1\n  ports:\n  - port: 30080             // \u670d\u52a1\u8bbf\u95ee\u7aef\u53e3\uff0c\u96c6\u7fa4\u5185\u90e8\u8bbf\u95ee\u7684\u7aef\u53e3\n    targetPort: 80          // pod\u63a7\u5236\u5668\u4e2d\u5b9a\u4e49\u7684\u7aef\u53e3\uff08\u5373 container \u5b9a\u4e49\u4e2d\u7684\u7aef\u53e3\uff09\n    nodePort: 30001         // NodePort\uff0c\u5916\u90e8\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u7aef\u53e3, \u8303\u56f4\u56fa\u5b9a 30000 ~ 32767\n  selector:\n    name: nginx-pod\n\n")),(0,r.kt)("h4",{id:"686-loadbalancer"},"6.8.6. LoadBalancer"),(0,r.kt)("p",null,"\u662f\u4f7f\u7528\u4e91\u63d0\u4f9b\u5546\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u5411\u5916\u90e8\u66b4\u9732\u670d\u52a1\u3002 \u8fd9\u4e2a\u5916\u90e8\u8d1f\u8f7d\u5747\u8861\u5668\u53ef\u4ee5\u5c06\u6d41\u91cf\u8def\u7531\u5230\u81ea\u52a8\u521b\u5efa\u7684 NodePort \u670d\u52a1\u548c ClusterIP \u670d\u52a1\u4e0a."),(0,r.kt)("h4",{id:"687-externalname"},"6.8.7. ExternalName"),(0,r.kt)("p",null,"\u901a\u8fc7\u8fd4\u56de CNAME \u548c\u5bf9\u5e94\u503c\uff0c\u53ef\u4ee5\u5c06\u670d\u52a1\u6620\u5c04\u5230 externalName \u5b57\u6bb5\u7684\u5185\u5bb9\uff08\u4f8b\u5982\uff0cfoo.bar.example.com\uff09\u3002 \u65e0\u9700\u521b\u5efa\u4efb\u4f55\u7c7b\u578b\u4ee3\u7406\u3002"),(0,r.kt)("h4",{id:"688-\u624b\u52a8\u7aef\u53e3\u8f6c\u53d1"},"6.8.8. \u624b\u52a8\u7aef\u53e3\u8f6c\u53d1"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"kubectl port-forward"),", \u7528\u4e8e\u4e34\u65f6\u8c03\u8bd5"),(0,r.kt)("h4",{id:"689-service-\u5982\u4f55\u5de5\u4f5c"},"6.8.9. service \u5982\u4f55\u5de5\u4f5c"),(0,r.kt)("p",null,"Pod \u901a\u8fc7 label \u952e\u503c\u5bf9\u4e0e Service \u4e0a\u7684 label selector \u76f8\u5173\u8054\u3002Service \u4f1a\u81ea\u52a8\u53d1\u73b0\u5e26\u6709\u4e0e\u9009\u62e9\u5668\u5339\u914d\u7684\u6807\u7b7e\u7684\u65b0 Pod\u3002"),(0,r.kt)("h3",{id:"69-ingress"},"6.9. ingress"),(0,r.kt)("p",null,"\u53ef\u4e3a Service \u63d0\u4f9b\u5916\u90e8\u53ef\u8bbf\u95ee\u7684 URL\u3001\u8d1f\u8f7d\u5747\u8861\u6d41\u91cf\u3001 SSL/TLS\uff0c\u4ee5\u53ca\u57fa\u4e8e\u540d\u79f0\u7684\u865a\u62df\u6258\u7ba1 (service \u6bd5\u7adf\u53ea\u662f\u5185\u90e8\u4f7f\u7528\u7684\u8d1f\u8f7d\u5747\u8861)"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"NodePort\u7684\u65b9\u5f0f\u6709\u4e2a\u95ee\u9898\uff0c\u6bcf\u4e2a working node \u7aef\u53e365535\u4e2a\uff0c\u603b\u6709\u7528\u5b8c\u7684\u65f6\u5019\uff0c\u8981\u662f\u66b4\u9732\u7684\u670d\u52a1\u7279\u522b\u591a\uff0c65535\u5c31\u4e0d\u591f\u7528\u4e86\uff0c\u6240\u4ee5\u8fd8\u662f\u5f97\u4e0anginx\u8fd9\u6837\u7684\u53cd\u5411\u4ee3\u7406\uff0c\u56e0\u6b64K8S\u8fd8\u6709\u4e2aIngress\u7684\u4e1c\u897f\u3002\u907f\u514d\u4e86\u5bf9\u5916\u66b4\u9732\u96c6\u7fa4\u8282\u70b9\u7aef\u53e3")),(0,r.kt)("p",null,"\u53ef\u4ee5\u6839\u636e\u57df\u540d\u3001\u8def\u5f84\u628a\u8bf7\u6c42\u8f6c\u53d1\u5230\u4e0d\u540c\u7684 Service, \u76f8\u5f53\u4e8e nginx, \u5e38\u7528\u7684\u5b9e\u73b0\u662f nginx-ingress, kong-ingress, \u4ec5\u521b\u5efa Ingress \u8d44\u6e90\u672c\u8eab\u6ca1\u6709\u4efb\u4f55\u6548\u679c, \u9700\u8981\u548c\u67d0\u4e2a\u5177\u4f53\u5b9e\u73b0\u4e00\u8d77\u4f7f\u7528"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u539f\u7406: Ingress Contronler \u901a\u8fc7\u4e0e Kubernetes API \u4ea4\u4e92\uff0c\u52a8\u6001\u7684\u53bb\u611f\u77e5\u96c6\u7fa4\u4e2d Ingress \u89c4\u5219\u53d8\u5316\uff0c\u7136\u540e\u8bfb\u53d6\u5b83\uff0c\u6309\u7167\u81ea\u5b9a\u4e49\u7684\u89c4\u5219\uff0c\u89c4\u5219\u5c31\u662f\u5199\u660e\u4e86\u54ea\u4e2a\u57df\u540d\u5bf9\u5e94\u54ea\u4e2a service\uff0c\u751f\u6210\u4e00\u6bb5 Nginx \u914d\u7f6e\uff0c\u518d\u5199\u5230 Nginx-ingress-control \u7684 Pod \u91cc\uff0c\u8fd9\u4e2a Ingress Contronler \u7684 pod \u91cc\u9762\u8fd0\u884c\u7740\u4e00\u4e2a nginx \u670d\u52a1\uff0c\u63a7\u5236\u5668\u4f1a\u628a\u751f\u6210\u7684 nginx \u914d\u7f6e\u5199\u5165/etc/nginx.conf \u6587\u4ef6\u4e2d\uff0c\u7136\u540e reload \u4e00\u4e0b \u4f7f\u7528\u914d\u7f6e\u751f\u6548\u3002\u4ee5\u6b64\u6765\u8fbe\u5230\u57df\u540d\u5206\u914d\u7f6e\u53ca\u52a8\u6001\u66f4\u65b0\u7684\u95ee\u9898\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: hello-ingress\n  annotations:\n    # We are defining this annotation to prevent nginx\n    # from redirecting requests to `https` for now \u5173\u95ed https \u8fde\u63a5\n    nginx.ingress.kubernetes.io/ssl-redirect: "false"\nspec:\n  rules:\n    - http:\n        paths:\n          - path: /hello\n            pathType: Prefix\n            backend:\n              service:\n                name: service-hellok8s-clusterip\n                port:\n                  number: 3000\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: service-nginx-clusterip\n                port:\n                  number: 4000\n\n')),(0,r.kt)("p",null,"\u652f\u6301\u8fd9\u4e9b\u547d\u4ee4"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# create\nkubectl apply -f ingress.yaml\n\n# check list\nkubectl get ingress \n\n")),(0,r.kt)("h4",{id:"691-traefik"},"6.9.1. Traefik"),(0,r.kt)("p",null,"todo Traefik"),(0,r.kt)("h3",{id:"610-volume"},"6.10. volume"),(0,r.kt)("p",null,"\u5373\u5728 pod \u4e2d\u53ef\u8bbf\u95ee\u7684\u6587\u4ef6\u76ee\u5f55, \u7528\u6765\u5b58\u50a8\u5927\u6570\u636e\u91cf\u7684\u5185\u5bb9"),(0,r.kt)("p",null,"\u6bcf\u4e2a Pod \u4e2d\u58f0\u660e\u7684\u5b58\u50a8\u5377\u7531 Pod \u4e2d\u7684\u6240\u6709\u5bb9\u5668\u5171\u4eab"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u53ef\u88ab\u6302\u8f7d\u5230 pod \u4e2d\u7684\u4e00\u4e2a/\u591a\u4e2a container \u7684\u6307\u5b9a\u8def\u5f84 \u4e0b")),(0,r.kt)("h3",{id:"611-secret"},"6.11. secret"),(0,r.kt)("p",null,"Secret \u662f\u7528\u6765\u4fdd\u5b58\u548c\u4f20\u9012\u5bc6\u7801"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u597d\u5904\u662f\u53ef\u4ee5\u907f\u514d\u628a\u654f\u611f\u4fe1\u606f\u660e\u6587\u5199\u5728\u914d\u7f6e\u6587\u4ef6\u91cc")),(0,r.kt)("p",null,"Secret \u7684\u8d44\u6e90\u5b9a\u4e49\u548c ConfigMap \u7ed3\u6784\u57fa\u672c\u4e00\u81f4\uff0c\u552f\u4e00\u533a\u522b\u5728\u4e8e kind \u662f Secret\uff0c\u8fd8\u6709 Value \u9700\u8981 Base64 \u7f16\u7801"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'echo "db_password" | base64\n# ZGJfcGFzc3dvcmQK\n\necho "ZGJfcGFzc3dvcmQK" | base64 -d\n# db_password\n')),(0,r.kt)("p",null,"for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'# hellok8s-secret.yaml\napiVersion: v1\nkind: Secret\nmetadata:\n  name: hellok8s-secret\ndata:\n  DB_PASSWORD: "ZGJfcGFzc3dvcmQK"\n')),(0,r.kt)("p",null,"\u4ece\u4e2d\u67e5\u8be2\u4fe1\u606f:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl get secret my-mongo-mongodb -o json\nkubectl get secret my-mongo-mongodb -o yaml > secret.yaml\n")),(0,r.kt)("h3",{id:"612-config-map"},"6.12. config map"),(0,r.kt)("p",null,"\u5c06\u975e\u673a\u5bc6\u6027\u7684\u6570\u636e\u4fdd\u5b58\u5230\u952e\u503c\u5bf9\u4e2d"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u7528docker\u7684\u65f6\u5019\u6709\u4e00\u4e2avolume\u53ef\u4ee5\u628a\u5bbf\u4e3b\u673a\u7684\u5b58\u50a8\u6302\u8f7d\u5230\u5bb9\u5668\u4e2d\uff0c\u5728k8s\u91cc\u4e5f\u5dee\u4e0d\u591a\uff0c\u4f46\u662f\u6709\u4e24\u79cd\u573a\u666f:"),(0,r.kt)("p",{parentName:"blockquote"},"\u6302\u8f7d\u914d\u7f6e\u6587\u4ef6. \u5728 docker \u91cc\u7ed9\u5e94\u7528\u8fdb\u884c\u914d\u7f6e, \u53ef\u4ee5\u4f7f\u7528 env\u73af\u5883\u53d8\u91cf\u4f20\u5230\u5bb9\u5668\u91cc. \u8fd8\u6709\u4e00\u79cd\u662f\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6302\u8f7d\u5230\u5bb9\u5668\u91cc\u9762\u3002\u7528\u73af\u5883\u53d8\u91cf\u7684\u65b9\u5f0f\u8fd8\u597d\u8bf4\uff0ck8s\u4e5f\u63d0\u4f9b\u4e86env\u53d8\u91cf\uff0c\u4f46\u662f\u914d\u7f6e\u591a\u4e86env\u7ba1\u7406\u8d77\u6765\u4e0d\u65b9\u4fbf\uff0c\u8fd8\u662f\u914d\u7f6e\u6587\u4ef6\u597d\u3002\n\u4f46\u662fk8s\u6709\u7684\u670d\u52a1Pod\u53ef\u80fd\u90e8\u7f72\u5728\u591a\u53f0\u673a\u5668, \u6240\u4ee5 configMap \u51fa\u73b0\u4e86, \u53ef\u4ee5\u548c \u5fae\u670d\u52a1\u7684\u914d\u7f6e\u4e2d\u5fc3\u7c7b\u6bd4 (\u8fd9\u4e24\u8005\u7684\u533a\u522b\u5728\u4e8eConfigMap\u662f\u76f4\u63a5\u628a\u4e2d\u5fc3\u5316\u7684\u914d\u7f6e\u6620\u5c04\u5230\u5404\u4e2a\u5bb9\u5668\u5185\uff0c\u8ba9\u5bb9\u5668\u5185\u7684\u5e94\u7528\u611f\u89c9\u50cf\u662f\u8bfb\u672c\u5730\u7684\u6587\u4ef6\u4e00\u6837\uff0c\u800c\u914d\u7f6e\u4e2d\u5fc3\u662f\u9700\u8981\u5e94\u7528\u5c42\u641e\u4e00\u4e2a\u5ba2\u6237\u7aef\u4e0e\u914d\u7f6e\u4e2d\u5fc3\u901a\u4fe1\u62c9\u53d6\u914d\u7f6e\u7ed9SpringCloud\u7528)"),(0,r.kt)("p",{parentName:"blockquote"},"\u6302\u8f7d\u6570\u636e\u5b58\u50a8, \u8fd9\u4e2a\u8bf7\u770b\u6570\u636e\u6301\u4e45\u5316")),(0,r.kt)("p",null,"ConfigMap \u5728\u8bbe\u8ba1\u4e0a\u4e0d\u662f\u7528\u6765\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u7684\u3002\u5728 ConfigMap \u4e2d\u4fdd\u5b58\u7684\u6570\u636e\u4e0d\u53ef\u8d85\u8fc7 1 MiB\u3002\u5982\u679c\u4f60\u9700\u8981\u4fdd\u5b58\u8d85\u51fa\u6b64\u5c3a\u5bf8\u9650\u5236\u7684\u6570\u636e\uff0c\u4f60\u53ef\u80fd\u8003\u8651\u6302\u8f7d\u5b58\u50a8\u5377\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'# hellok8s-config-dev.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: hellok8s-config\ndata:\n  DB_URL: "http://DB_ADDRESS_DEV"\n\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'# hellok8s-config-test.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: hellok8s-config\ndata:\n  DB_URL: "http://DB_ADDRESS_TEST"\n')),(0,r.kt)("p",null,"\u5206\u522b\u5728 dev test \u4e24\u4e2a namespace \u4e0b\u521b\u5efa\u76f8\u540c\u7684 ConfigMap\uff0c\u540d\u5b57\u90fd\u53eb hellok8s-config\uff0c\u4f46\u662f\u5b58\u653e\u7684 Pair \u5bf9\u4e2d Value \u503c\u4e0d\u4e00\u6837"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl apply -f hellok8s-config-dev.yaml -n dev\nkubectl apply -f hellok8s-config-test.yaml -n test \n\n# check list in all ns\nkubectl get configmap --all-namespaces\n\n")),(0,r.kt)("p",null,"\u5728 pod \u90e8\u7f72\u4e2d\u4f7f\u7528 configMap"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: hellok8s-pod\nspec:\n  containers:\n    - name: hellok8s-container\n      image: guangzhengli/hellok8s:v4\n      # used to declare an env var\n      env:\n        - name: DB_URL   # the value have to consist with code\n          # specify that getting db_url from the specified config map\n          valueFrom:\n            configMapKeyRef:\n              name: hellok8s-config\n              key: DB_URL\n")),(0,r.kt)("h3",{id:"613-flannel"},"6.13. flannel"),(0,r.kt)("p",null,"\u662f CoreOS \u56e2\u961f\u9488\u5bf9 Kubernetes \u8bbe\u8ba1\u7684\u4e00\u4e2a\u7f51\u7edc\u89c4\u5212\u670d\u52a1, \u7b80\u5355\u6765\u8bf4, \u5b83\u7684\u529f\u80fd\u662f\u8ba9\u96c6\u7fa4\u4e2d\u7684\u4e0d\u540c\u8282\u70b9\u4e3b\u673a\u521b\u5efa\u7684 Docker \u5bb9\u5668\u90fd\u5177\u6709\u5168\u96c6\u7fa4\u552f\u4e00\u7684\u865a\u62df IP \u5730\u5740, \u8ba9\u5c5e\u4e8e\u4e0d\u540c\u8282\u70b9\u4e0a\u7684\u5bb9\u5668\u80fd\u591f\u76f4\u63a5\u901a\u8fc7\u5185\u7f51 IP \u4e92\u901a"),(0,r.kt)("h3",{id:"614-name"},"6.14. name"),(0,r.kt)("p",null,'\u7531\u4e8e K8S \u5185\u90e8,\u4f7f\u7528\u201c\u8d44\u6e90\u201d\u6765\u5b9a\u4e49\u6bcf\u4e00\u79cd\u903b\u8f91\u6982\u5ff5(\u529f\u80fd)\u6545\u6bcf\u79cd"\u8d44\u6e90\u201d, \u90fd\u5e94\u8be5\u6709\u81ea\u5df1\u7684"\u540d\u79f0\u201d'),(0,r.kt)("p",null,'"\u8d44\u6e90\u201d\u6709 api \u7248\u672c( apiVersion )\u7c7b\u522b( kind )\u3001\u5143\u6570\u636e( metadata)\u3001\u5b9a\u4e49\u6e05\u5355( spec)\u3001\u72b6\u6001( status )\u7b49\u914d\u7f6e\u4fe1\u606f'),(0,r.kt)("p",null,'"\u540d\u79f0\u201d\u901a\u5e38\u5b9a\u4e49\u5728"\u8d44\u6e90\u201d\u7684"\u5143\u6570\u636e\u201d\u4fe1\u606f\u91cc'),(0,r.kt)("h3",{id:"615-name-namespace-\u7528\u6765\u5212\u5206\u591a\u73af\u5883"},"6.15. name namespace (\u7528\u6765\u5212\u5206\u591a\u73af\u5883)"),(0,r.kt)("p",null,"\u53ef\u4ee5\u4f7f\u7528 namespace \u5212\u5206\u51fa\u591a\u4e2a\u201c\u865a\u62df\u96c6\u7fa4\u201d\uff0c\u8fd9\u4e9b ns \u4e4b\u95f4\u53ef\u4ee5\u5b8c\u5168\u9694\u79bb, \u4f8b\u5982 dev \u73af\u5883\u7ed9\u5f00\u53d1\u4f7f\u7528\uff0ctest \u73af\u5883\u7ed9 QA \u4f7f\u7528"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u4e5f\u53ef\u4ee5\u8de8 ns\uff0c\u8ba9\u4e00\u4e2a ns \u4e2d\u7684 service \u8bbf\u95ee\u5230\u5176\u4ed6 ns \u7684\u670d\u52a1"),(0,r.kt)("p",{parentName:"blockquote"}," \u540d\u5b57\u7a7a\u95f4\u4f5c\u7528\u57df\u4ec5\u9488\u5bf9\u5e26\u6709\u540d\u5b57\u7a7a\u95f4\u7684\u5bf9\u8c61\uff0c\u4f8b\u5982 Deployment\u3001Service \u7b49\u3002")),(0,r.kt)("p",null,"namespace: isolate all all kinds of resources. resources of the same kind cannot have the same name in the same namespace"),(0,r.kt)("p",null,"default initialized namespaces: default, kube-system, kube-public"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: v1\nkind: Namespace\nmetadata:\n  name: dev\n  \n---\n\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: test\n\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# create\nkubectl apply -f namespaces.yaml\n\n# check list\nkubectl get namespaces          \n\n\n\n# specify the namespace when creating resources\nkubectl apply -f deployment.yaml -n dev\n\n# check pods in specified ns\nkubectl get pods -n dev\n\n\n\n\n\n# \u521b\u5efa\u547d\u540d\u7a7a\u95f4\nkubectl create namespace testapp\n\n\n# \u5207\u6362\u547d\u540d\u7a7a\u95f4\nkubens kube-system\n# \u56de\u5230\u4e0a\u4e2a\u547d\u540d\u7a7a\u95f4\nkubens -\n# \u5207\u6362\u96c6\u7fa4\nkubectx minikube\n\n\n")),(0,r.kt)("h2",{id:"7-\u5783\u573e\u56de\u6536"},"7. \u5783\u573e\u56de\u6536"),(0,r.kt)("h3",{id:"71-\u7ea7\u8054\u5220\u9664"},"7.1. \u7ea7\u8054\u5220\u9664"),(0,r.kt)("p",null,"\u6240\u6709\u8005\u5220\u9664\uff0c\u4ece\u5c5e\u5bf9\u8c61\u4e5f\u88ab\u5220\u9664\uff1b"),(0,r.kt)("p",null,"\u5206\u4e3a\u524d\u53f0\u7ea7\u8054\u5220\u9664 Foreground \u548c\u540e\u53f0\u7ea7\u8054\u5220\u9664 Background \u6a21\u5f0f\uff1b"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Foreground \u524d\u53f0\u7ea7\u8054\u5220\u9664\uff1a\u6240\u6709\u4ece\u5c5e\u5bf9\u8c61\u5220\u9664\u5b8c\u6bd5\u540e\u5220\u9664\u6240\u6709\u8005\u5bf9\u8c61\uff1b\u5f53\u6240\u6709\u8005\u5220\u9664\u65f6\u4f1a\u8fdb\u5165\u201c\u6b63\u5728\u5220\u9664\u201d\u72b6\u6001\uff0c\u4ecd\u53ef\u4ee5\u901a\u8fc7 RestApi \u67e5\u8be2\u5230\u5f53\u524d\u5bf9\u8c61\uff1b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Background \u540e\u53f0\u7ea7\u8054\u5220\u9664\uff1a \u7acb\u5373\u5220\u9664\u6240\u6709\u8005\u7684\u5bf9\u8c61\uff0c\u5e76\u7531\u5783\u573e\u56de\u6536\u5668\u5728\u540e\u53f0\u5220\u9664\u5176\u4ece\u5c5e\u5bf9\u8c61 \uff1b \u4e0d\u7528\u7b49\u5f85\u5220\u9664\u4ece\u5c5e\u5bf9\u8c61\u7684\u65f6\u95f4\uff1b"))),(0,r.kt)("h3",{id:"72-\u5b64\u513f\u5220\u9664-orphan"},"7.2. \u5b64\u513f\u5220\u9664 orphan"),(0,r.kt)("p",null,"\u6240\u6709\u8005\u5220\u9664\uff0c\u4ece\u5c5e\u5bf9\u8c61\u53d8\u6210\u5b64\u513f"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u76f4\u63a5\u5220\u9664\u6240\u6709\u8005\u5bf9\u8c61\uff0c\u5e76\u5c06\u4ece\u5c5e\u5bf9\u8c61\u4e2d\u7684 ownerReference \u5143\u6570\u636e\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u503c\u3002\u4e4b\u540e\u5783\u573e\u56de\u6536\u5668\u4f1a\u786e\u5b9a\u5b64\u513f\u5bf9\u8c61\u5e76\u5c06\u5176\u5220\u9664\uff1b")),(0,r.kt)("h2",{id:"8-\u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6"},"8. \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6"),(0,r.kt)("h3",{id:"81-\u901a\u8fc7\u547d\u4ee4\u751f\u6210-yml"},"8.1. \u901a\u8fc7\u547d\u4ee4\u751f\u6210 yml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl create deployment tomcat6 --image=tomcat:6.0.53-jre8 --dry-run -o yaml > tomcat6.yml\n\nkubectl apply -f xxx.yaml\n\n\n")),(0,r.kt)("h3",{id:"82-pod-\u7684-yaml-\u63cf\u8ff0\u6587\u4ef6"},"8.2. pod \u7684 yaml \u63cf\u8ff0\u6587\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion : v1 #(k8s api server version)\n# Deployment\u3001Job\u3001Ingress\u3001Service\nkind: Pod #(\u5bf9\u8c61\u7c7b\u578b)\nmetadata: #\u5305\u62ec\u540d\u79f0\u3001\u547d\u540d\u7a7a\u95f4\u3001\u6807\u7b7e\u548c\u5173\u4e8e\u8be5\u5bb9\u5668\u7684\u5176\u4ed6\u4fe1\u606f\n    name: kubia-manual\n    # optional, default ns: default\n    namespace: xxx\n    # optional\n    labels:\n        xxx_key: xxx\n        yyy_key: yyy\n# \u5305\u62ec\u4e00\u4e9bcontainer\uff0cstorage\uff0cvolume, \u63a2\u9488...\nspec:\n    containers:\n    - image: xxx\n      name: xxx\n      ports:\n      - containerPost: 8080 # \u5bb9\u5668\u4f1a\u76d1\u542c\u7684\u7aef\u53e3, \u4ec5\u4ec5\u662f\u5c55\u793a, \u6ca1\u6709 \u6307\u5b9a\u4f5c\u7528\n        protocal: TCP\n    resources:\n        requests:\n            cpu: 100m\n            memory: 100Mi\n    # \u5b58\u6d3b\u63a2\u9488\uff0c \u7528\u4e8e pod\n    # \u5728\u751f\u4ea7\u4e2d \u8fd0\u884c\u7684pod, \u4e00\u5b9a \u8981\u5b9a\u4e49 \u4e00 \u4e2a\u5b58 \u6d3b\u63a2\u9488\n#   optional\n    livenessProbe:\n    httpGet:\n        path: /\n        port: 8080\n    # \u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\u521d\u59cb\u5ef6\u8fdf\uff0c\u63a2\u9488\u5c06\u5728\u542f\u52a8\u65f6\u7acb\u5373\u5f00\u59cb\u63a2\u6d4b\u5bb9\u5668\uff0c \u8fd9\u901a\u5e38\u4f1a\u5bfc\u81f4\u63a2\u6d4b\u5931\u8d25\uff0c \u56e0\u4e3a\u5e94\u7528\u7a0b\u5e8f\u8fd8\u6ca1\u51c6\u5907\u597d\u5f00\u59cb\u63a5\u6536\u8bf7\u6c42\u3002 \u5982\u679c\u5931\u8d25\u6b21\u6570\u8d85\u8fc7\u9605\u503c\uff0c\u5728\u5e94\u7528\u7a0b\u5e8f\u80fd\u6b63\u786e\u54cd\u5e94\u8bf7\u6c42\u4e4b\u524d\uff0c \u5bb9\u5668\u5c31\u4f1a\u91cd\u542f\u3002\n    initialDelaySeconds: 15 # \u5728\u7b2c\u4e00\u6b21\u63a2\u6d4b\u524d\uff0c \u7b49\u5f85 15s\n    [delay: 0] # \u793a\u5728\u5bb9\u5668\u542f\u52a8\u540e\u7acb\u5373\u5f00\u59cb\u63a2\u6d4b\u3002\n    [timeout: 1] # \u5bb9\u5668\u5fc5\u987b\u57281\u79d2\u5185\u8fdb\u884c\u54cd\u5e94\uff0c \u4e0d\u7136\u8fd9\u6b21\u63a2\u6d4b\u8bb0\u4f5c\u5931\u8d25\n    [period: 10] # \u6bcf10\u79d2\u63a2\u6d4b\u4e00\u6b21\u5bb9\u5668\n    [failure: 3] # \u63a2\u6d4b\u8fde\u7eed\u4e09\u6b21\u5931\u8d25(#fa\u8fbdure= 3)\u540e\u91cd\u542f\u5bb9\u5668\n\nstatus: #\u5305\u542b\u8fd0\u884c\u4e2d\u7684 po \u7684\u5f53\u524d\u4fe1\u606f\uff0c\u4f8b\u5982 po \u6240\u5904\u7684\u6761\u4ef6 \u6bcf\u4e2a\u5bb9\u5668\u7684\u63cf\u8ff0\u548c\u72b6\u6001\uff0c\u4ee5\u53ca\u5185\u90e8 IP \u548c\u5176\u4ed6\u57fa\u672c\u4fe1\u606f\n\n")),(0,r.kt)("h3",{id:"83-deployment-\u7684\u63cf\u8ff0\u6587\u4ef6"},"8.3. deployment \u7684\u63cf\u8ff0\u6587\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  ## optional\n  nodeSelector:\n    gpu: 'true' #\u4f7f\u7528 \u6807\u7b7e\u9009\u62e9\u5668\u4f7f\u5f97 pod \u53ea\u88ab\u8c03\u5ea6\u5230\u7b26\u5408\u8981\u6c42\u7684 worker node\n  # optional\n  # select pods that will be affected by this deployment\n  # have to match labels that specified in template.metadata.labels\n  selector:\n    matchLabels:\n      app: nginx\n  # optional\n  replicas: 2 # tells deployment to run 2 pods matching the template\n  # define pods\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n        - name: nginx\n          image: nginx:alpine\n          ports:\n            - containerPort: 80\n")),(0,r.kt)("h3",{id:"84-service"},"8.4. service"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-service\nspec:\n  type: LoadBalancer\n  ports:\n    - name: nginx\n      port: 80\n      targetPort: 80\n  selector:\n    app: nginx\n")),(0,r.kt)("h2",{id:"9-\u6ce8\u89e3"},"9. \u6ce8\u89e3"),(0,r.kt)("p",null,"\u6ce8\u89e3: TODO"),(0,r.kt)("h2",{id:"10-\u547d\u540d\u7a7a\u95f4"},"10. \u547d\u540d\u7a7a\u95f4"),(0,r.kt)("p",null,"K8S namespace: \u4e3a \u5bf9\u8c61\u8d44\u6e90\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4f5c\u7528\u57df, \u5728\u4e0d\u540c\u7684 \u4f5c\u7528\u57df\u4e2d\u53ef\u4ee5\u4f7f\u7528\u76f8\u540c\u7684\u8d44\u6e90\u540d\uff0c \u4f46\u8fd9\u76f8\u540c\u7684\u8d44\u6e90\u540d\u4ee3\u8868\u4e86\u4e0d\u540c\u7684\u8d44\u6e90\u3002 \u7c7b\u6bd4 java package"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u901a\u8fc7 label \u5bf9 pod \u8fdb\u884c\u5206\u7ec4, \u6bcf\u4e2a \u7ec4 \u53ef\u80fd\u6709 pod \u91cd\u53e0, \u901a\u8fc7 k8s namespace \u5206\u7ec4\u53ef\u4ee5\u5b8c\u5168\u907f\u514d\u91cd\u53e0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"ns \u53ea\u9694\u79bb\u8d44\u6e90\uff0c \u4e0d\u9694\u79bb\u8fd0\u884c\u7684\u5bf9\u8c61 \uff08\u8d44\u6e90\u5b9e\u4f8b\uff09\uff0c \u5982 \u4e0d\u540c ns \u4e2d\u7684 pod \u4ecd\u7136\u53ef\u901a\u4fe1")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u9002\u7528\u4e8e\u591a\u7528\u6237 \u4f7f\u7528 k8s\uff0c \u9650\u5236\u67d0\u4e2a\u7528\u6237\u7684\u8d44\u6e90\u4f7f\u7528\u91cf"))),(0,r.kt)("p",null,"\u4ece ymal \u6587\u4ef6\u521b\u5efa ns\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: vl\nkind: Namespace\nmetadata:\n  name: custome-ns\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"kubectl create -f custom-ns.yaml")),(0,r.kt)("p",null,"\u901a\u8fc7\u547d\u4ee4\u521b\u5efa ns\uff1a ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl create namespace custom-namespace")),(0,r.kt)("p",null,"\u5207\u6362 ns\uff1a ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl config set-context $(kubectl config current-context) --namespace <other ns>")),(0,r.kt)("h2",{id:"11-pod-\u7ba1\u7406"},"11. pod \u7ba1\u7406"),(0,r.kt)("h3",{id:"111-\u63a2\u6d4b-pod-\u662f\u5426\u5065\u5eb7"},"11.1. \u63a2\u6d4b pod \u662f\u5426\u5065\u5eb7"),(0,r.kt)("p",null,"k8s \u4f1a\u4fdd\u6301 pod \u59cb\u7ec8\u6b63\u5e38\u8fd0\u884c\uff0c \u5982\u679c\u5bb9\u5668\u7684\u4e3b\u8fdb\u7a0b\u5d29\u6e83\uff0c Kubelet \u5c06\u91cd\u542f\u5bb9\u5668\u3002 \u5f53\u5bb9\u5668\u88ab\u5f3a\u884c\u7ec8\u6b62\u65f6\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a\u5168\u65b0\u7684\u5bb9\u5668\u2014-\u800c\u4e0d\u662f\u91cd\u542f\u539f\u6765\u7684\u5bb9\u5668"),(0,r.kt)("p",null,"\u4f46\u662f \u8fdb\u7a0b\u6ca1\u6709\u5d29\u6e83\uff0c \u6709\u65f6\u5e94\u7528\u7a0b\u5e8f\u4e5f\u4f1a\u505c\u6b62\u6b63\u5e38\u5de5\u4f5c\u3002 \u4f8b\u5982\uff0c \u5177\u6709\u5185\u5b58\u6cc4\u6f0f\u7684 Java \u5e94\u7528\u7a0b\u5e8f\u5c06\u5f00\u59cb\u629b\u51fa OutOfMemoryErrors, \u4f46 JVM \u8fdb\u7a0b\u4f1a\u4e00\u76f4\u8fd0\u884c"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u65b9\u6cd5 1: \u4ece app \u5185\u90e8\u81ea\u5df1\u68c0\u6d4b, \u53ef\u4ee5\u5728\u5e94\u7528\u4e2d\u6355\u83b7\u8fd9\u7c7b\u9519\u8bef\uff0c \u5e76\u5728\u9519\u8bef\u53d1\u751f\u65f6\u9000\u51fa\u8be5\u8fdb\u7a0b\u3002"),(0,r.kt)("p",{parentName:"li"},"\u5b58\u5728\u95ee\u9898: \u5e94\u7528\u56e0\u4e3a\u65e0\u9650\u5faa\u73af\u6216\u6b7b\u9501\u800c\u505c\u6b62\u54cd\u5e94, \u8fd9\u4e2a\u65b9\u6cd5\u5c31\u65e0\u6548\u4e86")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u65b9\u6cd5 2: \u987b\u4ece\u5916\u90e8\u68c0\u67e5\u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\u72b6\u51b5"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5b58\u6d3b\u63a2\u9488 (liveness probe) - \u68c0\u67e5\u5bb9\u5668\u662f\u5426\u8fd8\u5728\u8fd0\u884c"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"HTTP GET \u63a2\u9488, \u8fd4\u56de 2xx, 3xx \u5219\u4ee3\u8868\u6b63\u5e38, \u4e0d\u91cd\u542f")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"TCP \u5957\u63a5\u5b57\u63a2\u9488, \u548c pod \u6b63\u5e38\u5efa\u7acb \u94fe\u63a5, \u6b63\u5e38, \u4e0d\u91cd\u542f")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Exec \u63a2\u9488 , \u8fdb\u5165 pod \u67d0\u4e2a container, \u6267\u884c\u4efb\u610f\u547d\u4ee4, \u5e76\u68c0\u67e5\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u7801\u3002\u5982\u679c\u72b6\u6001\u7801\u662f 0, \u5219\u63a2\u6d4b\u6210\u529f"))))))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: vl\nkind: Pod\nmetadata:\n  name: custome-pod\nspec:\n  containers:\n    - image: xxx\n      name: xxx\n      livenessProbe:\n        httpGet:\n          path: /\n          port: 8080\n")),(0,r.kt)("h3",{id:"112-pod-\u526f\u672c"},"11.2. pod \u526f\u672c"),(0,r.kt)("p",null,"ReplicationController \u662f\u4e00\u79cd Kubernetes \u8d44\u6e90\uff0c\u8d1f\u8d23\u521b\u5efa\u548c\u7ba1\u7406 pod \u526f\u672c"),(0,r.kt)("p",null,"\u88ab ReplicationController \u521b\u5efa\u7684 pod \u4e3a \u201c\u6258\u7ba1 pod\u201d\uff0c \u76f4\u63a5\u521b\u5efa\u7684 pod \u4e3a \u201c\u975e\u6258\u7ba1 pod\u201d\u3002\u6258\u7ba1 pod \u5f02\u5e38\u9000\u51fa \uff08\u5982 worker node \u5d29\u6e83\uff0c \u6216 \u8be5 pod \u5d29\u6e83\uff09\u540e\uff0c ReplicationController \u4f1a \u521b\u5efa\u65b0\u7684 pod \u4ee3\u66ff"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: vl\nkind: Replicationcontroller\nmetadata:\n    name: kubia\nspec:\n    replicas: 3\n    # \u5b9a\u4e49ReplicationController\u65f6\u4e0d\u8981\u6307\u5b9a \u9009\u62e9\u5668\uff0c\u8ba9Kubemetes\u4ecepod\u6a21\u677f\u4e2d\u63d0\u53d6\u5b83\u3002\u8fd9\u6837YAML\u66f4\u7b80\u77ed\u3002\n    # rc \u521b\u5efa\u540e\uff0c label selector \u4e0d\u4f1a\u518d\u66f4\u6539\n    # \u4e00\u822c\u521b\u5efa\u540e\u4f1a\u66f4\u6539 template\n    [selector:\n        app: kubia]\n    # \u521b\u5efa\u65b0 pod \u6240\u7528\u7684 \u6a21\u677f\n    template:\n        metadata:\n            # \u8fd9\u91cc\u7684 \u6807\u7b7e\u5fc5\u987b\u548c \u524d\u9762\u7684 \u6807\u7b7e\u9009\u62e9\u5668 \u5339\u914d\uff0c \u5426\u5219\u5c06\u65e0\u4f11\u6b62\u5730\u521b\u5efa\u65b0\u7684\u5bb9\u5668\n            labels:\n                app: kubia\n            spec:\n                containers:\n                    - name: kubia\n                      image: luksa/kubia\n                      ports:\n                        - containerPort: 8080\n\n\n")),(0,r.kt)("p",null,"kubectl create -f kubia-rc.yaml"),(0,r.kt)("p",null,"rc \u521b\u5efa\u540e\uff0c\u7531\u4e8e\u6ca1\u6709\u4efb\u4f55 pod \u6709 app=kubia \u6807\u7b7e\uff0c ReplicationController \u4f1a\u6839\u636e pod \u6a21\u677f\u542f\u52a8\u4e09\u4e2a\u65b0\u7684 pod"),(0,r.kt)("p",null,"\u7531 ReplicationController \u521b\u5efa\u7684 pod \u5e76\u4e0d\u662f\u7ed1\u5b9a\u5230 ReplicationController\u3002 \u5728\u4efb\u4f55\u65f6\u523b\uff0c ReplicationController \u7ba1\u7406\u4e0e\u6807\u7b7e\u9009\u62e9\u5668\u5339\u914d\u7684 pod\u3002 \u901a \u8fc7\u66f4\u6539 pod \u7684\u6807\u7b7e\uff0c \u53ef\u4ee5\u5c06\u5b83 \u4ece ReplicationController \u7684\u4f5c\u7528\u57df\u4e2d\u6dfb\u52a0\u6216\u5220\u9664"),(0,r.kt)("p",null,"\u5c3d\u7ba1\u4e00\u4e2a pod \u6ca1\u6709\u7ed1\u5b9a\u5230\u4e00\u4e2a ReplicationController \uff0c\u4f46 pod \u5728 metadata.ownerReferences \u4e2d\u5f15\u7528\u5b83 \u4ee5\u8f7b\u677e\u4f7f\u7528\u5b83 \u6765\u627e\u5230\u4e00 pod \u7684 Replication controller"),(0,r.kt)("p",null,"\u5347\u7ea7 pod \u53ef\u4ee5\u8fd9\u4e48\u505a\uff1a\u7f16\u8f91 rc \u7684 template \u540e\uff0c \u5220\u9664 \u6240\u6709\u8981\u5347\u7ea7\u7684 pod\uff0c rc \u4f1a\u81ea\u52a8\u521b\u5efa\u5347\u7ea7\u540e\u7684 pod"),(0,r.kt)("p",null,"================\u6c34\u5e73\u7f29\u6269\u5bb9\uff1a"),(0,r.kt)("p",null,"\u65b9\u6cd5 1\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl scale re kubia --replicas=3 ")),(0,r.kt)("p",null,"\u65b9\u6cd5 2\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl edit re kubia")," \u66f4\u65b0 ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.replicas")," \u503c"),(0,r.kt)("p",null,"======================\u65b0\u7684\u66ff\u4ee3\u8005 ReplicaSet"),(0,r.kt)("p",null,"ReplicaSet\uff1aReplicaSet \u7684\u884c\u4e3a\u4e0e ReplicationController \u5b8c\u5168\u76f8\u540c\uff0c \u4f46\u6807\u7b7e\u9009\u62e9\u5668\u7684\u8868\u8fbe\u80fd\u529b\u66f4\u5f3a\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5355\u4e2a rc \u65e0\u6cd5\u5c06 pod \u4e0e \uff08 label env=prod \u548c env=dev \uff09 \u540c\u65f6\u5339\u914d\uff0c\u5b83\u53ea\u80fd\u5339\u914d\u5e26\u6709 env=devel \u6807\u7b7e\u7684 pod \u6216\u5e26\u6709 env=dev \u6807\u7b7e\u7684 pod"),(0,r.kt)("li",{parentName:"ul"},"rs \u53ef\u4ee5\u4ec5\u4ec5\u6839\u636e \u662f\u5426\u6709 label key \u5b58\u5728 \u6765\u5339\u914d")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: apps/v1beta2\nkind: ReplicaSet\nmetadata:\n    name: kubia\nspec:\n    replicas: 3\n    selector:\n        # \u6307\u5b9a\u4e86\u591a\u4e2a\u8868\u8fbe\u5f0f\uff0c\u5219\u6240\u6709\u8fd9\u4e9b\u8868\u8fbe\u5f0f\u90fd\u5fc5\u987b\u4e3atrue\u624d\u80fd\u4f7f\u9009\u62e9\u5668\u4e0e\n        # pod\u5339\u914d\u3002\u5982\u679c\u540c\u65f6\u6307\u5b9amatchLabels\u548cmatchExpressions, \u5219\u6240\u6709\u6807\u7b7e\u90fd\n        # \u5fc5\u987b\u5339\u914d\uff0c\u5e76\u4e14\u6240\u6709\u8868\u8fbe\u5f0f\u5fc5\u987b\u8ba1\u7b97\u4e3atrue\u4ee5\u4f7f\u8be5pod\u4e0e\u9009\u62e9\u5668\u5339\u914d\n        [matchLabels:\n            hah: hoo]\n        matchExpressions:\n            - key: hah # \u8981\u6c42 pod \u5305\u542b key \u4e3a hah \u7684 label\n              # \u8981\u6c42 label \u503c\u4e3a hoo\n              # operator \u53ef\u9009 In (label \u503c\u9700\u8981\u5339\u914d value \u4e2d\u7684\u4e00\u4e2a), NotIn \uff08label \u503c\u9700\u8981\u4e0d\u5728 values \u4e2d\uff09\uff0cExists \uff08label \u5fc5\u987b\u6709\u6307\u5b9a key\uff0c\u4e0d\u6307\u5b9a values\uff09\n              # DoesNotExist \uff08pod\u4e0d\u5f97\u5305\u542b\u6709\u6307\u5b9a\u540d\u79f0\u7684\u6807\u7b7e\u3002values\u5c5e\u6027\u4e0d\u5f97\u6307\u5b9a\uff09\n              operator: In\n              values:\n                - hoo\n    # \u521b\u5efa\u65b0 pod \u6240\u7528\u7684 \u6a21\u677f\n    template:\n        metadata:\n            # \u8fd9\u91cc\u7684 \u6807\u7b7e\u5fc5\u987b\u548c \u524d\u9762\u7684 \u6807\u7b7e\u9009\u62e9\u5668 \u5339\u914d\uff0c \u5426\u5219\u5c06\u65e0\u4f11\u6b62\u5730\u521b\u5efa\u65b0\u7684\u5bb9\u5668\n            labels:\n                hah: hoo\n            spec:\n                containers:\n                    - name: kubia\n                      image: luksa/kubia\n                      ports:\n                        - containerPort: 8080\n\n\n")),(0,r.kt)("p",null,"================ DaemonSet \u5728\u6bcf\u4e2a worker node \u4e0a\u90e8\u7f72\u4e00\u4e2a pod"),(0,r.kt)("p",null,"\u7528\u6765\u8fd0\u884c\u7cfb\u7edf\u670d\u52a1\uff0c\u5982 kube-proxy"),(0,r.kt)("p",null,"DaemonSet \u7ba1\u7406\u4e0b\u7684 pod \u4e0d\u662f\u968f\u673a\u5206\u5e03\u5728 worker node \u4e0a\uff0c \u800c\u662f\u4fdd\u8bc1 \u6bcf\u4e2a node \u53ea\u5b58\u5728\u4e00\u4e2a pod\u3002"),(0,r.kt)("p",null,"\u82e5 node \u4e0b\u7ebf\uff0c DaemonSet \u4e0d\u4f1a\u5728\u5176\u4ed6\u5730\u65b9\u521b\u5efa\u65b0\u7684 pod\uff0c \u4f46\u662f\u5f53\u67d0\u4e2a node \u7684 pod \u88ab\u610f\u5916\u5220\u9664\uff0c\u4f1a\u91cd\u65b0\u521b\u5efa\u65b0\u7684 pod \u4ee3\u66ff"),(0,r.kt)("p",null,"\u4f46\u662f \u5f53\u65b0\u7684 node \u6dfb\u52a0\u8fdb \u96c6\u7fa4\uff0c DaemonSet \u4f1a\u7acb\u5373\u90e8\u7f72\u4e00\u4e2a\u65b0 pod \u5230\u8fd9\u4e2a node\u3002"),(0,r.kt)("p",null,"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.nodeSelector")," (\u8282\u70b9\u9009\u62e9\u5668\uff0c\u539f\u7406\u662f\u7ed9 node \u6253\u6807\u7b7e) \u53ea\u5728\u7279\u5b9a node \u90e8\u7f72 pod"),(0,r.kt)("p",null,"======================= Deployment ======= \u66f4\u52a0\u65b9\u4fbf\u7684\u7ba1\u7406 Replica Set"),(0,r.kt)("p",null,"Deployment \u989d\u5916\u7684\u7279\u6027\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4e8b\u4ef6\uff0c\u72b6\u6001\u67e5\u770b\uff1a\u53ef\u4ee5\u67e5\u770b Deployment \u7684\u5347\u7ea7\u8be6\u7ec6\u8fdb\u5ea6\u548c\u72b6\u6001")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u56de\u6eda\uff1a\u5f53\u5347\u7ea7 pod \u955c\u50cf\u6216\u8005\u76f8\u5173\u53c2\u6570\u7684\u65f6\u5019\u53d1\u73b0\u95ee\u9898\uff0c\u53ef\u4ee5\u4f7f\u7528\u56de\u6eda\u64cd\u4f5c\u56de\u6eda\u5230\u4e0a\u4e00\u4e2a\u7a33\u5b9a\u7684\u7248\u672c\u6216\u8005\u6307\u5b9a\u7684\u7248\u672c")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u7248\u672c\u8bb0\u5f55: \u6bcf\u4e00\u6b21\u5bf9 Deployment \u7684\u64cd\u4f5c\uff0c\u90fd\u80fd\u4fdd\u5b58\u4e0b\u6765\uff0c\u7ed9\u4e88\u540e\u7eed\u53ef\u80fd\u7684\u56de\u6eda\u4f7f\u7528")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6682\u505c\u548c\u542f\u52a8\uff1a\u5bf9\u4e8e\u6bcf\u4e00\u6b21\u5347\u7ea7\uff0c\u90fd\u80fd\u591f\u968f\u65f6\u6682\u505c\u548c\u542f\u52a8")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u591a\u79cd\u5347\u7ea7\u65b9\u6848\uff1a"),(0,r.kt)("p",{parentName:"li"},"Recreate\uff1a\u5220\u9664\u6240\u6709\u5df2\u5b58\u5728\u7684 pod,\u91cd\u65b0\u521b\u5efa\u65b0\u7684;"),(0,r.kt)("p",{parentName:"li"},"RollingUpdate\uff1a\u6eda\u52a8\u5347\u7ea7\uff0c\u9010\u6b65\u66ff\u6362\u7684\u7b56\u7565\uff0c\u540c\u65f6\u6eda\u52a8\u5347\u7ea7\u65f6\uff0c\u652f\u6301\u66f4\u591a\u7684\u9644\u52a0\u53c2\u6570\uff0c\u4f8b\u5982\u8bbe\u7f6e\u6700\u5927\u4e0d\u53ef\u7528 pod \u6570\u91cf\uff0c\u6700\u5c0f\u5347\u7ea7\u95f4\u9694\u65f6\u95f4\u7b49\u7b49\u3002"))),(0,r.kt)("p",null,"================= HPA \u5f39\u6027\u4f38\u7f29 \u6839\u636e\u8d44\u6e90\u7684\u4f7f\u7528\u60c5\u51b5\u81ea\u52a8\u7f29\u6269\u5bb9"),(0,r.kt)("h3",{id:"113-\u8fd0\u884c\u5355\u4e2a\u4efb\u52a1-job"},"11.3. \u8fd0\u884c\u5355\u4e2a\u4efb\u52a1 Job"),(0,r.kt)("p",null,"\u5230\u76ee\u524d\u4e3a\u6b62\uff0c \u6211\u4eec\u53ea\u8c08\u8bba\u4e86\u9700\u8981\u6301\u7eed\u8fd0\u884c\u7684 pod\uff0c \u8fd9\u4e9b pod \u7531 rc\uff0c rs\uff0c ds \u7ba1\u7406\u3002 \u4f60\u4f1a\u9047\u5230\u53ea\u60f3\u8fd0\u884c\u5b8c\u6210\u5de5\u4f5c\u540e\u5c31\u7ec8\u6b62\u4efb\u52a1\u7684\u6e05\u51b5\uff0c \u8fd9\u79cd pod \u7531 Job \u7ba1\u7406"),(0,r.kt)("p",null,"\u8be5 pod \u5728\u5185\u90e8\u8fdb\u7a0b\u6210\u529f\u7ed3\u675f\u65f6\uff0c \u4e0d\u91cd\u542f\u5bb9\u5668\u3002\u4e00\u65e6\u4efb\u52a1\u5b8c\u6210\uff0c pod \u5c31\u88ab\u8ba4\u4e3a\u5904\u5343\u5b8c\u6210\u72b6\u6001"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: batch/v1\nkind: Job\nmetadata:\n    name: ba\u4e03ch-job\nspec:\n    [completions: 5] # \u987a\u5e8f\u8fd0\u884c 5 \u4e2a pod\n    [parallelism: 2] # \u6700\u591a\u53ef\u4ee5 2 \u4e2a pod \u5e76\u884c\u8fd0\u884c\n    [activeDeadlineSeconds: 120] # job \u8d85\u65f6\u65f6\u95f4\uff0c\u82e5 pod \u8d85\u65f6\u8fd8\u6ca1\u7ed3\u675f\uff0c\u7cfb\u7edf\u5c06\u7ec8\u6b62 pod\uff0c \u6807\u8bb0 job \u4e3a\u5931\u8d25\n    [backOffLimit: 6] # job \u6807\u8bb0\u4e3a\u5931\u8d25\u524d\u7684\u91cd\u8bd5\u6b21\u6570\uff0c \u9ed8\u8ba4 6\n    template:\n        metadata:\n            # Job \u7684 pod \u9009\u62e9\u5668 \u5c06\u81ea\u52a8\u6839\u636e\u8fd9\u91cc\u7684 labels \u521b\u5efa\n            labels:\n                app: batch-job\n        spec:\n            # \u91cd\u542f\u7b56\u7565\uff0c \u6307\u5b9a \u5bb9\u5668\u4e2d\u8fdb\u7a0b\u7ed3\u675f\u540e\uff0c k8s \u505a\u4ec0\u4e48\n            # \u4e0d\u80fd\u662f \u9ed8\u8ba4\u7684 Always\n            # \u8fd9\u91cc Never \u4ea6\u53ef\n            restartPolicy: OnFailure\n            containers:\n                - name: main\n                  image: luksa/batch-job\n\n")),(0,r.kt)("h3",{id:"114-\u5b9a\u65f6\u4efb\u52a1-cronjob"},"11.4. \u5b9a\u65f6\u4efb\u52a1 CronJob"),(0,r.kt)("p",null,"TODO"),(0,r.kt)("h2",{id:"12-pod-\u901a\u4fe1"},"12. pod \u901a\u4fe1"),(0,r.kt)("h3",{id:"121-proxy"},"12.1. proxy"),(0,r.kt)("h3",{id:"122-service"},"12.2. Service"),(0,r.kt)("p",null,"pods \u6709\u81ea\u5df1\u7684\u5185\u90e8\u5730\u5740, \u4f46\u662f\u65e0\u6cd5\u4ece cluster \u5916\u90e8\u8bbf\u95ee, \u901a\u8fc7 service \u53ef\u4ee5\u66b4\u9732\u5230 cluster \u5916\u90e8"),(0,r.kt)("p",null,"service \u662f\u4e00\u4e2a\u903b\u8f91\u7ed3\u6784, \u5b9a\u4e49\u4e00\u7cfb\u5217 pods, \u4ee5\u53ca\u4ed6\u4eec\u7684\u8bbf\u95ee\u7b56\u7565(\u901a\u8fc7\u7c7b\u578b\u6307\u5b9a)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"ClusterIP (default): \u53ea\u80fd\u5728 cluster \u5185\u90e8\u8bbf\u95ee\u5230 service"),(0,r.kt)("li",{parentName:"ul"},"NodePort: \u5916\u90e8\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"<NodeIP>:<NodePort>")," \u8bbf\u95ee service"),(0,r.kt)("li",{parentName:"ul"},"LoadBalancer: \u7ed9 service \u5206\u914d\u4e00\u4e2a\u9759\u6001 ip, \u53ef\u4ee5\u8d1f\u8f7d\u5747\u8861\u591a\u4e2a pods"),(0,r.kt)("li",{parentName:"ul"},"ExternalName: \u901a\u8fc7\u968f\u673a\u540d\u5b57\u8bbf\u95ee service (\u53ef\u901a\u8fc7 externalName \u5728\u914d\u7f6e\u4e2d\u6307\u5b9a). This type requires v1.7 or higher of kube-dns.")),(0,r.kt)("p",null,"a default service named kubernetes will be created with type ClusterIP"),(0,r.kt)("p",null,"\u53ef\u4ee5\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6, \u6307\u5b9a\u6807\u7b7e\u9009\u62e9\u5668, \u9009\u62e9\u5305\u542b\u54ea\u4e9b pods"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"")),(0,r.kt)("h3",{id:"123-pod-\u95f4\u901a\u4fe1"},"12.3. pod \u95f4\u901a\u4fe1"),(0,r.kt)("p",null,"Service"),(0,r.kt)("p",null,"\u4f5c\u7528\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u7684\u4e3b\u8981\u76ee\u6807\u5c31\u662f\u4f7f\u96c6\u7fa4\u5185\u90e8\u7684\u5176\u4ed6 pod \u53ef\u4ee5\u8bbf\u95ee\u5f53\u524d\u8fd9\u7ec4 pod"),(0,r.kt)("li",{parentName:"ul"},"\u5bf9\u5916\u66b4\u9732\u670d\u52a1")),(0,r.kt)("p",null,"\u5982\u4f55\u521b\u5efa\uff1f"),(0,r.kt)("p",null,"\u65b9\u5f0f 1\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl expose rc kubia --type=LoadBalancer --name kubia-http")),(0,r.kt)("p",null,"\u65b9\u5f0f 2\uff1a\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl create -f xxx-service.yml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: vl\nkind: Service\nmetadata:\n    name: kubia\nspec:\n    # \u914d\u7f6e\u4f1a\u8bdd\u4eb2\u548c\u6027\n    # \u7279\u5b9a\u5ba2\u6237\u7aef\u4ea7\u751f\u7684\u6240\u6709\u8bf7\u6c42\u6bcf\u6b21\u90fd\u6307\u5411\u540c \u4e00\u4e2a pod\n    # \u8fd8\u53ef\u9009 None\uff0c \u9ed8\u8ba4\u503c\u3002\u4e0d\u652f\u6301 cookie\n    [sessionAffinity: ClientIP]\n    ports:\n      - port: 80 # service \u7684\u53ef\u7528\u7aef\u53e3\n        # \u53ef\u4ee5\u5f15\u7528 Pod \u4e2d \u7684 port name\n        targetPort: 8080 # service\u5c06\u94fe\u63a5\u8f6c\u53d1\u5230 \u5bb9\u5668\u7684\u7aef\u53e3\n        # \u4e0d\u662f\u5fc5\u987b\uff0c \u591a\u7aef\u53e3\u6620\u5c04\u5fc5\u987b\n        [name: xxx]\n    selector:\n        app: kubia\n")),(0,r.kt)("p",null,"\u591a\u7aef\u53e3\u6620\u5c04"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: vl\nkind: Service\nmetadata:\n    name: kubia\nspec:\n    # \u914d\u7f6e\u4f1a\u8bdd\u4eb2\u548c\u6027\n    # \u7279\u5b9a\u5ba2\u6237\u7aef\u4ea7\u751f\u7684\u6240\u6709\u8bf7\u6c42\u6bcf\u6b21\u90fd\u6307\u5411\u540c \u4e00\u4e2a pod\n    # \u8fd8\u53ef\u9009 None\uff0c \u9ed8\u8ba4\u503c\u3002\u4e0d\u652f\u6301 cookie\n    [sessionAffinity: ClientIP]\n    ports:\n      - port: 80 # service \u7684\u53ef\u7528\u7aef\u53e3\n        targetPort: 8080 # service\u5c06\u94fe\u63a5\u8f6c\u53d1\u5230 \u5bb9\u5668\u7684\u7aef\u53e3\n        name: xxx\n      - port: 443\n        targetPort: 8443\n        name: yyy\n    selector:\n        app: kubia\n")),(0,r.kt)("p",null,"\u5982\u4f55\u53d1\u73b0 service"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u53d1\u73b0\u670d\u52a1"),(0,r.kt)("p",{parentName:"li"},"\u6bcf\u4e2a pod \u5185\u4f1a\u6709\u73af\u5883\u53d8\u91cf\u8868\u793a Service ip \uff08",(0,r.kt)("inlineCode",{parentName:"p"},"<pod name>_SERVICE_HOST"),"\uff09\uff0c port (",(0,r.kt)("inlineCode",{parentName:"p"},"<pod name>_SERVICE_PORT"),")")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u901a\u8fc7 dns"),(0,r.kt)("p",{parentName:"li"},"kube-system ns \u4e2d\u6709\u4e2a pod \u4e3a kube-dns\uff0c\u5c31\u662f dns server\u3002\u5728\u96c6\u7fa4 \u4e2d\u7684\u5176\u4ed6 pod \u90fd\u88ab\u914d\u7f6e\u6210\u4f7f\u7528\u5176\u4f5c\u4e3a dns ( Kubemetes \u901a\u8fc7\u4fee\u6539\u5bb9\u5668\u7684 /etc/resolv.conf \u5b9e\u73b0\uff09\u3002\u8fd0\u884c\u5728 pod \u4e0a\u7684\u8fdb\u7a0b DNS \u67e5\u8be2\u90fd\u4f1a\u88ab Kubemetes \u81ea\u8eab\u7684 DNS \u52a1\u5668\u54cd\u5e94"),(0,r.kt)("p",{parentName:"li"},"pod \u662f\u5426\u4f7f\u7528\u5185\u90e8\u7684 DNS \u670d\u52a1\u5668\u662f\u6839\u636e pod \u7684 spec.dnsPolicy \u5c5e\u6027\u6765\u51b3\u5b9a\u7684")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u901a\u8fc7 FQDN \uff08\u5168\u9650\u5b9a\u57df\u540d\uff09 \u8fde\u63a5\u670d\u52a1"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"curl http://kubia.default.svc.cluster.local ")))),(0,r.kt)("h3",{id:"124-\u901a\u8fc7-service-\u8fde\u63a5\u5916\u90e8\u670d\u52a1"},"12.4. \u901a\u8fc7 Service \u8fde\u63a5\u5916\u90e8\u670d\u52a1"),(0,r.kt)("p",null,"pod \u5982\u4f55\u8bbf\u95ee k8s \u5916\u90e8 \u670d\u52a1\uff1f"),(0,r.kt)("h4",{id:"1241-\u901a\u8fc7\u624b\u52a8\u751f\u6210-endpoint"},"12.4.1. \u901a\u8fc7\u624b\u52a8\u751f\u6210 endpoint"),(0,r.kt)("p",null,"Service \u548c pod \u4e2d\u95f4\u4e0d\u662f\u76f4\u63a5\u76f8\u8fde\uff0c \u800c\u662f\u63d2\u7740 Endpoint\uff0c\u5c31\u662f\u4e00\u4e2a ip:port \u5217\u8868\uff0c\u5728\u521b\u5efa Service \u65f6 \u6839\u636e \u8be5\u670d\u52a1\u7684 label selector \u4ea7\u751f"),(0,r.kt)("p",null,"\u5982\u679c Service \u6ca1\u6709\u6307\u5b9a pod selector\uff0c \u5c31\u4e0d\u4f1a\u81ea\u52a8\u751f\u6210 endpoints\uff0c\u9700\u8981\u624b\u52a8\u751f\u6210\uff0c\u8fd9\u65f6\u53ef\u4ee5\u6307\u5b9a\u5730\u5740\u4e3a\u4efb\u610f \u5916\u90e8\u7684 ip\uff1a"),(0,r.kt)("p",null,"demo-service.yml:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: vl\nkind: Service\nmetadata:\n  name: demo-service\nspec:\n  # \u6ca1\u6709\u914d\u7f6e selector\n\n  # \u5c06\u63a5\u6536\u7aef\u53e380\u4e0a\u7684\u4f20\u5165\u8fde\u63a5\n  ports:\n    - port: 80\n")),(0,r.kt)("p",null,"demo-service-endpoints.yml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: vl\nkind: Endpoints\nmetadata:\n  # Endpoint\u7684\u540d\u79f0\u5fc5\u987b\u548c service \u7684\u540d\u79f0\u76f8\u540c\n  name: demo-service\nsubsets:\n  # Service\u5c06\u628a\u8bf7\u6c42\u91cd\u5b9a\u5411\u5230 \u4e0b\u9762\u7684 \u5730\u5740\n  - addresses:\n      - ip: 11. 11. 11. 11\n      - ip: 22.22.22.22\n    ports:\n      - port: 80\n")),(0,r.kt)("p",null,"\u5982\u679c\u7a0d\u540e\u51b3\u5b9a\u5c06 \u5916\u90e8\u670d\u52a1\u8fc1\u79fb\u5230 Kubemetes \u4e2d\u8fd0\u884c\u7684 pod, \u53ef\u4ee5\u4e3a\u670d\u52a1\u6dfb\u52a0\u9009\u62e9\u5668\uff0c\u4ece\u800c\u5bf9 Endpoint \u8fdb\u884c\u81ea\u52a8\u7ba1\u7406"),(0,r.kt)("h4",{id:"1242-\u901a\u8fc7-externalname-\u7c7b\u578b\u7684-service"},"12.4.2. \u901a\u8fc7 externalName \u7c7b\u578b\u7684 Service"),(0,r.kt)("p",null,"\u53e6\u5916\u7684\u65b9\u5f0f\u6765\u8bbf\u95ee\u5916\u90e8\u670d\u52a1\uff1a\u521b\u5efa ExtemalName \u7c7b\u578b\u7684 Service"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: vl\nkind: Service\nmetadata:\n  name: external-service\nspec:\n  # \u9ed8\u8ba4\u4e3a ClusterIP\uff0c\u53ea\u80fd pod \u95f4\u901a\u4fe1\n  # \u8fd8\u6709\u5f88\u591a\u79cd type\n  type: ExternalName\n  externalName: someapi.somecompany.com\n  ports:\n    - port: 80\n")),(0,r.kt)("p",null,"\u7136\u540e\u5728 pod \u4e2d\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"external-service[.default.svc.cluster.local]")," \u8bbf\u95ee someapi.somecompany.com"),(0,r.kt)("p",null,"\u5728\u4ee5\u540e\u5982\u679c\u5c06\u5176\u6307\u5411\u4e0d\u540c\u7684\u670d\u52a1\uff0c\u53ea\u9700\u7b80\u5355\u5730\u4fee\u6539 externalName \u5c5e\u6027\uff0c\u6216\u8005\u5c06\u7c7b\u578b\u91cd\u65b0\u53d8\u56de ClusterIP \u5e76\u4e3a\u670d\u52a1\u521b\u5efa Endpoint"),(0,r.kt)("h3",{id:"125-\u5c06\u670d\u52a1\u66b4\u9732\u7ed9\u5916\u90e8"},"12.5. \u5c06\u670d\u52a1\u66b4\u9732\u7ed9\u5916\u90e8"),(0,r.kt)("h4",{id:"1251-\u5c06\u670d\u52a1\u7684\u7c7b\u578b\u8bbe\u7f6e\u6210-nodeport"},"12.5.1. \u5c06\u670d\u52a1\u7684\u7c7b\u578b\u8bbe\u7f6e\u6210 NodePort"),(0,r.kt)("p",null,"\u6bcf\u4e2a\u96c6\u7fa4\u8282\u70b9\u90fd\u4f1a\u5728\u8282\u70b9\u4e0a\u6253\u5f00\u4e00\u4e2a\u7aef\u53e3(\u7aef\u53e3\u53f7\u76f8\u540c)\u3002\u5e76\u5c06\u4f20\u5165\u7684\u8fde\u63a5\u8f6c\u53d1\u7ed9 pod"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: vl\nkind: Service\nmetadata:\n  name: kubia-nodeport\nspec:\n  type: NodePort\n  ports:\n    - port: 80\n      targetPort: 8080\n      # \u901a\u8fc7 \u96c6\u7fa4\u4efb\u610f\u8282\u70b9\u7684 30123 \u7aef\u53e3\u53ef\u4ee5\u8bbf\u95ee \u8fd9\u4e2a service\n      # \u5982\u679c\u4e0d\u6307\u5b9a\uff0cKubernetes\u5c06\u9009\u62e9\u4e00\u4e2a\u968f\u673a\u7aef\u53e3\n      nodePort: 30123\n  selector:\n    app: kubia\n")),(0,r.kt)("p",null,"worker node ip \u5982\u4f55\u83b7\u53d6\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl get nodes -o jsonpath='...'")),(0,r.kt)("h4",{id:"1252-\u5c06\u670d\u52a1\u7684\u7c7b\u578b\u8bbe\u7f6e\u6210-loadbalance"},"12.5.2. \u5c06\u670d\u52a1\u7684\u7c7b\u578b\u8bbe\u7f6e\u6210 LoadBalance"),(0,r.kt)("p",null,"NodePort \u7c7b\u578b\u7684\u4e00 \u79cd\u6269\u5c55, \u5728 client \u548c worker node \u95f4 \u653e\u4e86\u4e00\u4e2a LoadBalancer\uff0c \u9632\u6b62\u8282\u70b9\u5355\u70b9\u6545\u969c"),(0,r.kt)("p",null,"\u8d1f\u8f7d\u5747\u8861\u5668\u62e5\u6709\u81ea\u5df1\u72ec\u4e00\u65e0\u4e8c\u7684\u53ef\u516c\u5f00\u8bbf\u95ee\u7684 IP \u5730\u5740\uff0c \u5e76\u5c06\u6240\u6709\u8fde\u63a5\u91cd\u5b9a\u5411\u5230\u670d\u52a1\u3002\u53ef\u4ee5\u901a\u8fc7\u8d1f\u8f7d\u5747\u8861\u5668\u7684 IP \u5730\u5740\u8bbf\u95ee\u670d\u52a1"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: vl\nkind: Service\nme\u4e03adata:\n    name: kubia-loadbalancer\nspec:\n    type: LoadBalancer\n    # \u4ec5\u5c06\u5916\u90e8\u901a\u4fe1\u91cd\u5b9a\u5411\u5230\u63a5\u6536\u8fde\u63a5\u7684\u8282\u70b9\u4e0a\u8fd0\u884c\u7684pod\n    # \u5982\u679c\u6ca1\u6709\u672c\u5730pod\u5b58\u5728\uff0c \u5219\u8fde\u63a5\u5c06\u6302\u8d77\u3002\u56e0\u6b64\uff0c \u9700\u8981\u786e\u4fdd\u8d1f\u8f7d\u5e73\u8861\u5668\u5c06\u8fde\u63a5\u8f6c\u53d1\u7ed9\u81f3\u5c11\u5177\u6709\u4e00\u4e2apod\u7684\u8282\u70b9\u3002\n    # \u53ef\u907f\u514d\u989d\u5916\u7684\u7f51\u7edc\u8df3\u8f6c\u3002\u4f46\u662f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8de8\u8282\u70b9\u7684 pod \u7684\u8d1f\u8f7d\u5206\u5e03\u4e0d\u5747\u8861\n    [externalTrafficPolicy: Local ]\n    portS:\n        - port: 80\n          targetPort: 8080\n    selector:\n        app: kubia\n")),(0,r.kt)("h4",{id:"1253-\u521b\u5efa\u4e00-\u4e2a-ingress-\u8d44\u6e90"},"12.5.3. \u521b\u5efa\u4e00 \u4e2a Ingress \u8d44\u6e90"),(0,r.kt)("p",null,"\u901a\u8fc7\u4e00 \u4e2a IP \u5730\u5740\u516c\u5f00\u591a\u4e2a\u670d\u52a1\uff0c\u5b83\u8fd0\u884c\u5728 HTTP \u5c42\uff08\u7f51\u7edc\u534f\u8bae\u7b2c 7 \u5c42\uff09\u4e0a\uff0c \u56e0\u6b64\u53ef\u4ee5\u63d0\u4f9b\u6bd4\u5de5\u4f5c\u5728\u7b2c 4 \u5c42\u7684\u670d\u52a1\u66f4\u591a\u7684\u529f\u80fd"),(0,r.kt)("p",null,"\u4e3a\u4ec0\u4e48\u9700\u8981 Ingress\uff1a\u6bcf\u4e2a LoadBalancer \u670d\u52a1\u90fd\u9700\u8981\u81ea\u5df1\u7684\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u6bcf\u4e2a loadbalancer \u90fd\u9700\u8981\u81ea\u5df1\u7684 ip\uff0c \u800c Ingress \u53ea\u9700\u8981\u4e00\u4e2a\u516c\u7f51 IP \u5c31\u80fd\u4e3a\u8bb8\u591a\u670d\u52a1\u63d0\u4f9b\u8bbf\u95ee"),(0,r.kt)("p",null,"\u5f53\u5ba2\u6237\u7aef\u5411 Ingress \u53d1\u9001 HTTP \u8bf7\u6c42\u65f6\uff0c Ingress \u4f1a\u6839\u636e\u8bf7\u6c42\u7684\u4e3b\u673a\u540d\u548c\u8def\u5f84\u51b3\u5b9a\u8bf7\u6c42\u8f6c\u53d1\u5230\u7684\u670d\u52a1\u3002"),(0,r.kt)("p",null,"Ingress \u5de5\u4f5c\u5728 \u5e94\u7528\u5c42 \u57fa\u4e8e cookie \u7684\u4f1a\u8bdd\u4eb2\u548c\u6027 (session affinity)"),(0,r.kt)("p",null,"\u5df2\u7ecf\u786e\u8ba4\u96c6\u7fa4\u4e2d\u6b63\u5728\u8fd0\u884c Ingress \u63a7\u5236\u5668\uff0c \u56e0\u6b64\u73b0\u5728\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a Ingress \u8d44\u6e90\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: kubia\nspec:\n  rules:\n    # Ingress \u5c06\u8fd9\u4e2a\u57df\u540d\u6620\u5c04\u5230\u4f60\u7684 service\n    - host: kubia . example.com\n      http:\n        paths:\n          # \u5c06\u8bf7\u6c42\u53d1\u9001\u5230  kubia-nodeport \u670d\u52a1\u7684 80 \u7aef\u53e3\n          - path: /\n            backend:\n              serviceName: kubia-nodeport\n              servicePort: 80\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"kubectl get ingresses ")," \u83b7\u53d6 Ingress \u63a7\u5236\u5668 \u5185\u7f51 ip\uff0c\u914d\u7f6e\u5230 dns server"),(0,r.kt)("p",null,"\u4e3a ingress \u521b\u5efa tls \u8ba4\u8bc1 TODO"),(0,r.kt)("h2",{id:"13-\u547d\u4ee4"},"13. \u547d\u4ee4"),(0,r.kt)("h3",{id:"131-kubectl"},"13.1. kubectl"),(0,r.kt)("h4",{id:"1311-\u57fa\u672c\u4fe1\u606f"},"13.1.1. \u57fa\u672c\u4fe1\u606f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl version\nkubectl cluster-info\nkubectl get nodes\n# \u83b7\u53d6kube-scheduler\u548ckube-controller-manager\u7ec4\u4ef6\u72b6\u6001\nkubectl get cs # \u5065\u5eb7\u72b6\u51b5\n")),(0,r.kt)("h4",{id:"1312-\u521b\u5efa-create-expose"},"13.1.2. \u521b\u5efa create expose"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"\n# create depend on a spec file.\nkubectl create -f xxx.yml\n\n\n\n# >>> deployment,\n\n# dep-name \u4e0d\u80fd\u968f\u4fbf\u8bbe\u7f6e, \u5fc5\u987b\u7b26\u5408\u57df\u540d\u547d\u540d\u89c4\u8303.\n# \u81ea\u52a8\u521b\u5efa\u7684 ReplicaSet \u540d\u5b57\u4e3a dep_name + random uuid\n# \u81ea\u52a8\u521b\u5efa pod \u540d\u5b57\u4e3a ReplicaSet-name + random uuid\n# \u955c\u50cf\u5730\u5740 include the full repository url\n# \u81ea\u52a8\u521b\u5efa label -> run={dep name}\n# auto  create selector -> run={dep name}\nkubectl create deployment <dep name> --image=k8s.gcr.io/echoserver:1.4\nkubectl create deployment tomcat6 --image=tomcat:6.0.53-jre8 # \u4e0d\u6307\u5b9a url \u524d\u7f00, \u9ed8\u8ba4\u4ece docker hub \u62c9\u53d6\n\n# >>> proxy\n\n#  pods \u9ed8\u8ba4\u4ec5\u4ec5\u80fd\u88ab \u540c\u4e2a\u96c6\u7fa4\u7684 pods, service  \u8bbf\u95ee\n# \u521b\u5efa\u4e34\u65f6\u7684 \u4ee3\u7406, \u53ef\u4ee5\u5c06\u5916\u90e8\u547d\u4ee4\u8f6c\u53d1\u5230 cluster \u5185\u90e8\u7684 pod\n# Ctrl +c \u5173\u95ed\nkubectl proxy\n# \u67e5 \u7248\u672c\ncurl http://localhost:8001/version\n# \u8bbf\u95ee\u6307\u5b9a pod \u7684\u670d\u52a1\ncurl http://localhost:8001/api/v1/namespaces/default/pods/$POD_NAME/proxy/\n\n\n\n# >>> pod\n\nkubectl run <pod name> --image=nginx --restart=Never --port=80\n# --generator=run/vl  \u8868\u793a\u540c\u65f6\u521b\u5efa rc \u7ba1\u7406 pod\nkubectl run <pod name> --image=luksa/kubia --port=8080 --generator=run/vl\n# \u4ece\u63cf\u8ff0\u6587\u4ef6\u521b\u5efa \u8d44\u6e90\uff0c \u53ef\u4ee5 pod\uff0c rc\u3002\u3002\u3002\uff0c \u53ef\u6307\u5b9a ns\uff0c \u9ed8\u8ba4 default\nkubectl create -f kubia-manual.yaml [-n xxx_ns]\n\n\n\n# >>> service\n\n# \u521b\u5efa service, \u540d\u5b57\u540c deployment\n# The LoadBalancer type makes the Service accessible through the minikube service command\n# Port 8080 is specified in image code, so cannot be other port here\n# --port : service \u66b4\u9732\u5728 cluster ip \u4e0b\u7684\u7aef\u53e3, \u901a\u8fc7\u8fd9\u4e2a\u7aef\u53e3,  \u53ef\u4ee5\u5728 cluster \u5185\u90e8\u8bbf\u95ee\u5230\u591a\u4e2a pod. \u901a\u8fc7\u8fd9\u4e2a service \u8d1f\u8f7d\u5747\u8861\u4e86 \u591a\u4e2a pod\n# --targetPort \u5bb9\u5668\u7684\u7aef\u53e3, \u9ed8\u8ba4=== port, \u4e0e\u5236\u4f5c\u955c\u50cf\u65f6\u66b4\u9732\u7684\u7aef\u53e3\u4e00\u81f4, \u4e0d\u80fd\u968f\u4fbf\u6307\u5b9a\n# --type: service \u7c7b\u578b,\n#       NodePort: \u521b\u5efa\u4e00\u4e2a service \u5e76\u66b4\u9732\u5230 cluster \u5916\u90e8, service \u7684\u7aef\u53e3\u8fd8\u662f --port \u6307\u5b9a, \u540c\u65f6 service \u6709\u81ea\u5df1\u7684 cluster url, node \u4f1a\u6307\u5b9a\u4e00\u4e2a\u968f\u673a\u7aef\u53e3\u6620\u5c04\u5230 service \u7684 \u7aef\u53e3, \u82e5\u6307\u5b9a\u4e86 --nodePort, \u5c31\u7528\u6307\u5b9a\u7aef\u53e3\u6620\u5c04\u5230 service \u7aef\u53e3; \u5982 type=NodePort\uff0c\u800c\u4e14\u914d\u7f6e nodePort=30001, \u90a3\u4e48\u5916\u90e8\u673a\u5668 \u53ef\u4ee5 scheme://nodeIP:30001\u8bbf\u95ee\u5230\u8be5\u670d\u52a1\n#       LoadBalancer:\nkubectl expose deployment <dep name> --type=LoadBalancer --port=8080\n\n# \u67e5\u627e\u66b4\u9732\u7684\u968f\u673a\u7aef\u53e3\nkubectl describe service mywebservice | grep NodePort\n\n# service port 80 will mapping to random node port ,and this service can be visited by someone outside cluster\n# \u82e5\u6269\u5bb9, \u5219\u5728\u5404\u4e2a\u6709 pod \u8fd0\u884c\u7684\u8282\u70b9\u90fd\u80fd\u901a\u8fc7 node \u7aef\u53e3\u8bbf\u95ee  \u8fd9\u4e2a service\nkubectl expose deploy tomcat6 --port=80 --target-port=8080 --type=NodePort\n\n# \u521b\u5efa\u4e00\u4e2a\u8d1f\u8f7d\u5747\u8861\u670d\u52a1 service \u5bf9\u8c61. \u53ef\u4ee5\u4ece\u5916\u90e8\u8bbf\u95ee pod\n# rc \u4e3a replicationController \u7f29\u5199\nkubectl expose rc <po name> --type=LoadBalancer --name kubia-http\n\n\n# >>> label\n\n# \u8bed\u6cd5: kubectl label <obj_type, eg: pod, service> <obj_name> <label, eg: app=v1>\nkubectl label pod $POD_NAME app=v1\n\n\n# >>> \u547d\u540d\u7a7a\u95f4\n\n# \u521b\u5efa\nkubectl config set-context Kubernetes --namespace=beta\n# \u9a8c\u8bc1\nkubectl config view | grep namespace command\n")),(0,r.kt)("h4",{id:"1313-\u6267\u884c\u547d\u4ee4\u5230\u5bb9\u5668-exec"},"13.1.3. \u6267\u884c\u547d\u4ee4\u5230\u5bb9\u5668 exec"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u4ec5\u6709 \u4e00\u4e2a\u5bb9\u5668\u5728 pod, \u65e0\u9700\u6307\u5b9a\u5bb9\u5668\nkubectl exec [-c container_name] $POD_NAME -- env\n\n# \u8fdb\u5165 pod \u5185\u90e8\u968f\u673a\u4e00\u4e2a\u5bb9\u5668 \nkubectl exec -ti $POD_NAME -- bash\n")),(0,r.kt)("h4",{id:"1314-\u4fee\u6539"},"13.1.4. \u4fee\u6539"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"\n# >>> \u6269\u5bb9\n\n# \u6307\u5b9a replicas \u53ef\u4ee5\u7f29\u6269\u5bb9\n$ kubectl scale deployments/<dep_name> --replicas=4\nkubectl scale deployment.apps/tomcat6 --replicas=2\nkubectl scale deployment tomcat6 --replicas=2\n\n\n# >>> \u6eda\u52a8\u66f4\u65b0\n\n# \u66f4\u65b0 image version\n$ kubectl set image deployments/<dep_name> <dep_name>=jocatalin/kubernetes-bootcamp:v2\n# \u9a8c\u8bc1\u66f4\u65b0\u662f\u5426\u6210\u529f\n$ kubectl rollout status deployments/kubernetes-bootcamp\n\n# >>> \u56de\u6eda\n\n# \u53d6\u6d88\u4e4b\u524d\u7684\u90e8\u7f72\uff0c\u8fd9\u5c06\u6267\u884c\u53cd\u5411\u64cd\u4f5c\uff0c\u5c06\u8d1f\u8f7d\u79fb\u52a8\u81f3\u4e4b\u524d\u7248\u672c\u7684\u5bb9\u5668\n$ kubectl rollout undo deployments/kubernetes-bootcamp\n")),(0,r.kt)("h4",{id:"1315-\u8d44\u6e90\u5217\u8868-get"},"13.1.5. \u8d44\u6e90\u5217\u8868 get"),(0,r.kt)("p",null,"\u5355\u590d\u6570\u5747\u53ef"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"\n# \u6240\u6709\nkubectl get all\n\n\n# >>> deployment\n\nkubectl get deployments\n\n\n# >>> pods\n\n# --show-labels \u540c\u65f6\u663e\u793a\u6240\u6709\u6807\u7b7e\u3002\n# -A \u67e5\u770b\u6240\u6709 pods, \u5305\u62ec kube-system \u547d\u540d\u7a7a\u95f4 \u4e0b\u7684 pods\n# --all-namespaces \u6240\u6709\u7a7a\u95f4\u7684 pods\nkubectl get pods [--show-labels]\n\n# -o \u8f93\u51fa\u683c\u5f0f; wide \u8868\u793a\u8f93\u51fa\u6587\u672c\u4fe1\u606f, \u5217\u51fa ip , \u8282\u70b9 name\n# -o yaml\nkubectl get pods -o wide\n\n# \u901a\u8fc7\u6807\u7b7e\u8fc7\u6ee4\nkubectl get pods -l <label>\n\n# \u83b7\u53d6 pod \u5b8c\u6574 yaml/json \u6587\u4ef6\n# \u7f29\u5199 po\nkubectl get po <pod name> -o yaml\nkubectl get po <pod name> -o json\nkubectl get node\n\n# \u6839\u636e\u6a21\u677f\u83b7\u53d6 \u4fe1\u606f\nexport POD_NAME=$(kubectl get pods -o go-template --template '{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}')\nexport NODE_PORT=$(kubectl get services/kubernetes-bootcamp -o go-template='{{(index .spec.ports 0).nodePort}}')\n\n\n# >>> service\n\n\n# \u67e5\u770b service  \u7684 endpoint \u5217\u8868\nkubectl get endpoints <service name>\n# \u67e5\u770b\u6240\u6709 svc\n# \u7f29\u5199 svc\nkubectl get services\n\n\n# >>> ReplicaSet\n\nkubectl get rs\n\n\n\n\n# \u7aef\u53e3\u8f6c\u53d1\uff0c \u5c06\u4f1a\u8fd0\u884c\u4e00\u4e2a\u7aef\u53e3\u8f6c\u53d1\u4ee3\u7406\n# \u5c06 local port 8888 \u8f6c\u53d1\u5230 pod \u7684 8080\nkubectl port-forward <pod name> 8888:8080\n\n# \u6807\u7b7e\n# \u5217\u51fa pods \u7684\u6240\u6709\u6807\u7b7e\nkubectl get pods --show-labels\n# \u53ea\u5217\u51fa\u611f\u5174\u8da3\u7684\u6807\u7b7e\uff0c \u6807\u7b7e\u6309\u7167\u5217\u5c55\u793a\nkubectl get po -L creation_method,env\n# \u6dfb\u52a0\nkubectl label po <pod name> creation_method=manual\n# \u4fee\u6539\nkubectl label po <pod name> creation_method=manual --override\n\n# \u6807\u7b7e\u9009\u62e9\u5668\nkubectl get po -1 creation_method=manual\nkubectl get po -1 creation_method!=manual\nkubectl get po -1 env\n# \u5217\u51fa\u6ca1\u6709 env \u7684pod\nkubectl get po -1 '!env'\n# \u9009\u62e9\u5e26\u6709env\u6807\u7b7e\u4e14\u503c\u4e3aprod\u6216devel\u7684pod\nkubectl get po -1 env in (prod, devel)\nkubectl get po -1 env notin (prod, devel)\n\n# \u4f7f\u7528 label \u5206\u7c7b worker node\nkubectl get nodes\nkubectl label node <node name> gpu=true # \u6bcf\u4e2a node \u90fd\u6709\u4e00\u4e2a\u9ed8\u8ba4 label\uff0c kubernetes.io/hostname:\u4e3b\u673a\u540d\nkubectl get nodes -l gpu=true\n\n# \u547d\u540d\u7a7a\u95f4\n# \u67e5\u770b\u6240\u6709 ns, \u6709 default\uff0c kube-public\uff0c kube-system\uff0c\u9ed8\u8ba4\u6211\u4eec\u4f7f\u7528\u7684\u662f default\nkubectl get ns\n# \u5217\u51fa\u53ea\u5c5e\u4e8e\u8be5\u547d\u540d\u7a7a\u95f4\u7684 pod, \u53ef\u4f7f\u7528 -n\nkubectl get po --namespace kube-system\n\n\n# \u7f16\u8f91 rc \u7684 yaml\n# \u4e00\u822c\u4ec5\u4ec5\u7f16\u8f91 rc \u7684 template\uff0c \u4e0d\u52a8 label selector\n# \u7528\u6765\u5347\u7ea7 pod\nkubectl edit rc kubia\n\n# \u589e\u52a0 \u526f\u672c\u6570\uff0c \u6c34\u5e73\u6269\u5bb9\nkubectl scale rc kubia --replicas=3\n# \u7b49\u540c parallelism\nkubectl scale job xxx_job --replicas 3\n\n# \u8fdc\u7a0b\u5728 pod \u4e2d\u67d0\u4e2a container \u6267\u884c\u547d\u4ee4\n# \u201c--\u201d \u8868\u793a kubectl \u547d\u4ee4\u7ed3\u675f\uff0c \u540e\u9762\u7684\u662f\u5728 pod \u5185\u6267\u884c\u7684\nkubectl exec <pod name> -- curl -s http://10.23...\n# \u5217\u51fa\u73af\u5883\u53d8\u91cf\uff0c\u5982 Service \u7684 ip\uff0c \u7aef\u53e3\nkubectl exec kubia-3inly env\n# \u5728 pod \u4e2d\u6267\u884c shell\nkubectl exec -it kubi-3inly bash\n\n\n# >>> \u914d\u7f6e\u6587\u4ef6\n\nkubectl config view\n\n\n\n# >>> \u4e8b\u4ef6\n\nkubectl get events\n\n# \u901a\u8fc7 describe \u4e5f\u80fd\u5f97\u5230 object \u76f8\u5173\u7684\u4e8b\u4ef6\n\n")),(0,r.kt)("h4",{id:"1316-\u67e5\u8be2\u8be6\u7ec6\u63cf\u8ff0-describe"},"13.1.6. \u67e5\u8be2\u8be6\u7ec6\u63cf\u8ff0 describe"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# >>> pods\n\n# \u67e5\u770b\u8d44\u6e90\u63cf\u8ff0\uff0c \u9644\u52a0\u4fe1\u606f\uff0c \u4f5c\u4e3a kubectl get xxx xxx \u8865\u5145, \u53ef\u7528\u4e8e\u6392\u67e5\u95ee\u9898\n# \u5982 pod \u662f\u5426\u6b63\u5728\u8fd0\u884c\uff0c \u91cd\u542f\u539f\u56e0\uff0c \u9000\u51fa\u7801 137\uff0c143 \u8868\u793a pod \u88ab\u8feb\u7ec8\u6b62\nkubectl describe pods [pod_name]\n\n\n# >>> service\n\nkubectl describe services/<srv name>\n\n# >>> deployment\n\n$ kubectl describe deployment\n\n\n")),(0,r.kt)("h4",{id:"1317-\u67e5\u8be2\u65e5\u5fd7-logs"},"13.1.7. \u67e5\u8be2\u65e5\u5fd7 logs"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u67e5\u6307\u5b9a pod \u4e0b\u7684 container \u65e5\u5fd7\n# \u82e5pod \u53ea\u6709\u4e00\u4e2a container, \u65e0\u9700\u6307\u5b9a container\nkubectl logs $POD_NAME\nkubectl logs -f POD-NAME\n\n\n# \u9700\u8981 ssh \u5230 pod \u6240\u5728\u7684 worker node\ndocker logs <container_id>\n# \u65e0\u9700 ssh, \u53ef\u6307\u5b9a\u67d0\u4e2a container\uff0c \u53ef\u6307\u5b9a\u770b\u91cd\u542f\u524d\u7684\u7248\u672c\u7684\u65e5\u5fd7\nkubectl logs <pod name> [-c container_name] [--previous]\n\n\n\n\n# \u67e5\u770b k8s \u8d44\u6e90\nkubectl explain pods\nkubectl explain pod.spec\n\n")),(0,r.kt)("h4",{id:"1318-\u5220\u9664-delete"},"13.1.8. \u5220\u9664 delete"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# delete by spec file\nkubectl delete -f flask.yaml\n\n# \u5220\u9664 pod\n# \u65e0\u6cd5\u76f4\u63a5\u5220\u9664, \u53ea\u8981 replicaSet \u6ca1\u6709\u5220\u9664, \u5220\u4e86 po, \u8fd8\u4f1a\u91cd\u73b0\u521b\u5efa po\n# \u53ef\u76f4\u63a5 \u901a\u8fc7\u5220\u9664 deployment \u5220\u9664\nkubectl delete po kubia-gpu [pod2 [pod3]]\n# \u5220\u9664\u5f53\u524d ns \u4e0b all pod\uff0c \u4fdd\u7559 ns\nkubectl delete po --all\n# \u6309\u7167\u6807\u7b7e\u5220\u9664\nkubectl delete po -1 creation_method=manual\n\nkubectl delete service hello-node\nkubectl delete deployment hello-node\n\n#  \u5220\u9664 ns, \u540c\u65f6\u4f1a\u5220\u9664 ns \u4e0b\u7684\u6240\u6709 pod\nkubectl delete ns custom-namespace\n# \u5220\u9664\u6240\u6709\u8d44\u6e90\uff0c \u5305\u62ec rc\uff0c pod\uff0c service\nkubectl delete all --all\n# \u5220\u9664 rc\uff0c rc \u7ba1\u7406\u7684 pods \u4e5f\u4f1a\u5220\u9664\nkubectl delete rc <rc name>\n# \u5220\u9664 rc\uff0c \u4f46\u662f\u4fdd\u7559 pods\nkubectl delete rc <rc name> --cascade=false\nkubectl delete rs kubia\n\n\n# \u5220\u9664\u6240\u6709 pod, deployment, service \u8d44\u6e90\nkubectl delete deployment,service --all\n\n")),(0,r.kt)("h3",{id:"132-kubeadmin"},"13.2. kubeadmin"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"kubeadm init # create a master node\n\nkubeadm join <master_id:port> # add a node to cluster\n")),(0,r.kt)("h2",{id:"14-cka-ckad-\u8bc1\u4e66\u8003\u8bd5"},"14. cka ckad \u8bc1\u4e66\u8003\u8bd5"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/vic_qxz/article/details/108338442"},"https://blog.csdn.net/vic_qxz/article/details/108338442")," ",(0,r.kt)("a",{parentName:"p",href:"https://zhuanlan.zhihu.com/p/139052135"},"https://zhuanlan.zhihu.com/p/139052135")," \u5907\u8003 cka ckad"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://training.linuxfoundation.cn/certificate/details/1"},"https://training.linuxfoundation.cn/certificate/details/1")," \u4e2d\u56fd\u533a"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://zhuanlan.zhihu.com/p/138796893"},"https://zhuanlan.zhihu.com/p/138796893")," ",(0,r.kt)("a",{parentName:"p",href:"https://www.jianshu.com/p/629525af31c4"},"https://www.jianshu.com/p/629525af31c4")," ",(0,r.kt)("a",{parentName:"p",href:"https://www.kubernetes.org.cn/peixun"},"https://www.kubernetes.org.cn/peixun")," \u8003\u8bd5\u8981\u70b9 ",(0,r.kt)("a",{parentName:"p",href:"https://zhuanlan.zhihu.com/p/138796893"},"https://zhuanlan.zhihu.com/p/138796893")," , ",(0,r.kt)("a",{parentName:"p",href:"https://www.zhihu.com/zvideo/1302356091591372800"},"https://www.zhihu.com/zvideo/1302356091591372800")," \u771f\u9898"),(0,r.kt)("h2",{id:"15-dashboard"},"15. dashboard"),(0,r.kt)("h3",{id:"151-k9s"},"15.1. k9s"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://k9scli.io/"},"https://k9scli.io/"),", \u57fa\u4e8e Terminal \u7684\u8f7b\u91cf\u7ea7 UI"),(0,r.kt)("h3",{id:"152-kuboard"},"15.2. kuboard"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/eip-work/kuboard-press"},"https://github.com/eip-work/kuboard-press")," \u9762\u677f"),(0,r.kt)("h3",{id:"153-kubernetes-dashboard"},"15.3. kubernetes-dashboard"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/dashboard"},"https://github.com/kubernetes/dashboard")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# install\nkubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/master/aio/deploy/recommended.yaml\n\n# start\nkubectl proxy\n# start in background\nkubectl proxy >/dev/null &\n\n# create administrator\nkubectl apply -f https://raw.githubusercontent.com/gotok8s/gotok8s/master/dashboard-admin.yaml\n# and token\nkubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep kubernetes-dashboard-admin | awk \"'{print $1}'\")\n\n# visit\nhttp://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/\n")),(0,r.kt)("h3",{id:"154-kubesphere-\u63a8\u8350"},"15.4. kubesphere (\u63a8\u8350)"),(0,r.kt)("p",null,"\u6253\u901a devops \u5168\u5957\u6d41\u6c34\u7ebf, \u5bf9 cluster \u8981\u6c42\u9ad8 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/kubesphere/kubesphere"},"https://github.com/kubesphere/kubesphere")),(0,r.kt)("p",null,"(kuboard \u4e5f\u884c, \u5bf9 cluster \u8981\u6c42\u4e0d\u9ad8)"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.zhihu.com/question/348609092"},"https://www.zhihu.com/question/348609092")," rancher \u548c kubesphere \u5bf9\u6bd4"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.bilibili.com/video/BV1cL4y167GV"},"https://www.bilibili.com/video/BV1cL4y167GV")," \u89c6\u9891\u6559\u7a0b"),(0,r.kt)("h3",{id:"155-rancher"},"15.5. rancher"),(0,r.kt)("p",null,"\u90e8\u7f72 k8s \u96c6\u7fa4"),(0,r.kt)("h2",{id:"16-harbor"},"16. Harbor"),(0,r.kt)("h2",{id:"17-helm"},"17. Helm"),(0,r.kt)("p",null,"\u6765\u81ea CNCF, \u4f7f\u7528 helm chart \u4e00\u952e\u62c9\u8d77\u6574\u5957\u73af\u5883. \u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u5e94\u7528\u5546\u5e97, \u4e00\u952e\u90e8\u7f72\u522b\u4eba\u5199\u597d\u7684\u8f6f\u4ef6\u96c6\u7fa4"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Helm \u7684\u4f7f\u7528\u65b9\u5f0f\u53ef\u4ee5\u89e3\u91ca\u4e3a\uff1aHelm \u5b89\u88c5 charts \u5230 Kubernetes \u96c6\u7fa4\u4e2d\uff0c\u6bcf\u6b21\u5b89\u88c5\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 release\u3002\u4f60\u53ef\u4ee5\u5728 Helm \u7684 chart repositories \u4e2d\u5bfb\u627e\u65b0\u7684 chart\u3002")),(0,r.kt)("h3",{id:"171-how-to-create-helm-chart"},"17.1. How to create helm chart"),(0,r.kt)("p",null,"We can use ",(0,r.kt)("inlineCode",{parentName:"p"},"helm create <chart-name>")," to create a default chart template, \u8be5\u547d\u4ee4\u9ed8\u8ba4\u4f1a\u521b\u5efa\u4e00\u4e9b k8s \u8d44\u6e90\u5b9a\u4e49\u7684\u521d\u59cb\u6587\u4ef6\uff0c\u5e76\u4e14\u4f1a\u751f\u6210\u5b98\u7f51\u63a8\u8350\u7684\u76ee\u5f55\u7ed3\u6784"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"helm create hello-helm\n\n.\n\u251c\u2500\u2500 Chart.yaml\n\u251c\u2500\u2500 charts\n\u251c\u2500\u2500 templates     // we can put our resource yml files into this folder, then our code can be put into the root path\n\u2502\xa0\xa0 \u251c\u2500\u2500 NOTES.txt\n\u2502\xa0\xa0 \u251c\u2500\u2500 _helpers.tpl\n\u2502\xa0\xa0 \u251c\u2500\u2500 deployment.yaml\n\u2502\xa0\xa0 \u251c\u2500\u2500 hpa.yaml\n\u2502\xa0\xa0 \u251c\u2500\u2500 ingress.yaml\n\u2502\xa0\xa0 \u251c\u2500\u2500 service.yaml\n\u2502\xa0\xa0 \u251c\u2500\u2500 serviceaccount.yaml\n\u2502\xa0\xa0 \u2514\u2500\u2500 tests\n\u2502\xa0\xa0     \u2514\u2500\u2500 test-connection.yaml\n\u2514\u2500\u2500 values.yaml\n\n")),(0,r.kt)("p",null,"values.yml is used to define the env vars, we can extract the vars from cofigMap and then put the vars into this file."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u597d\u5904\u662f\u53ef\u4ee5\u5c06\u6240\u6709\u53ef\u53d8\u7684\u53c2\u6570\u5b9a\u4e49\u5728 values.yaml \u6587\u4ef6\u4e2d\uff0c\u4f7f\u7528\u8be5 helm charts \u7684\u4eba\u65e0\u9700\u4e86\u89e3\u5177\u4f53 k8s \u7684\u5b9a\u4e49\uff0c\u53ea\u9700\u6539\u53d8\u6210\u81ea\u5df1\u60f3\u8981\u7684\u53c2\u6570\uff0c\u5373\u53ef\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u8d44\u6e90\uff01")),(0,r.kt)("p",null,"for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'# values.yml\napplication:\n  name: hellok8s\n  hellok8s:\n    image: guangzhengli/hellok8s:v6\n    replicas: 3\n    message: "It works with Helm Values[v2]!"\n    database:\n      url: "http://DB_ADDRESS_DEFAULT"\n      password: "db_password"\n  nginx:\n    image: nginx\n    replicas: 2\n')),(0,r.kt)("p",null,"we can change the configMap like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"# hello-k8s-configmap.yml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  # \u610f\u601d\u662f\u4ece values.yaml \u6587\u4ef6\u4e2d\u83b7\u53d6 application.name \u7684\u503c hellok8s\uff0c\u62fc\u63a5 -config \u5b57\u7b26\u4e32\uff0c\n  # \u8fd9\u6837\u521b\u5efa\u51fa\u6765\u7684 configmaps \u8d44\u6e90\u540d\u79f0\u5c31\u662f hellok8s-config\u3002\n  name: {{ .Values.application.name }}-config\ndata:\n  DB_URL: {{ .Values.application.hellok8s.database.url }}\n")),(0,r.kt)("p",null,"change secret yml like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"# hellok8s-secret.yaml\napiVersion: v1\nkind: Secret\nmetadata:\n  name: {{ .Values.application.name }}-secret\ndata:\n  # \u901a\u8fc7 b64enc \u65b9\u6cd5\u5c06\u503c Base64 \u7f16\u7801\n  DB_PASSWORD: {{ .Values.application.hellok8s.database.password | b64enc }}\n")),(0,r.kt)("p",null,"and change deployment like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"# hello-k8s-deployment.yml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: {{ .Values.application.name }}-deployment\nspec:\n  replicas: {{ .Values.application.hellok8s.replicas }}\n  selector:\n    matchLabels:\n      app: hellok8s\n  template:\n    metadata:\n      labels:\n        app: hellok8s\n    spec:\n      containers:\n        - image: {{ .Values.application.hellok8s.image }}\n          name: hellok8s-container\n          env:\n            - name: DB_URL\n              valueFrom:\n                configMapKeyRef:\n                  name: {{ .Values.application.name }}-config\n                  key: DB_URL\n            - name: DB_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: {{ .Values.application.name }}-secret\n                  key: DB_PASSWORD\n            - name: NAMESPACE\n              # Helm \u7684\u5185\u7f6e\u5bf9\u8c61\n              value: {{ .Release.Namespace }}\n            - name: MESSAGE\n              value: {{ .Values.application.hellok8s.message }}\n")),(0,r.kt)("h3",{id:"172-helm-chart-\u7684\u6253\u5305\u53d1\u5e03"},"17.2. helm chart \u7684\u6253\u5305\u53d1\u5e03"),(0,r.kt)("p",null,"\u8fd9\u91cc\u4e00 \u4f7f\u7528 github pages \u5b58\u50a8\u4e3a\u4f8b"),(0,r.kt)("p",null,"\u6253\u5305\u53d1\u5e03\u5230 ",(0,r.kt)("a",{parentName:"p",href:"https://artifacthub.io/"},"https://artifacthub.io/"),"  (\u7c7b\u4f3c dockerhub)"),(0,r.kt)("h4",{id:"1721-\u624b\u52a8\u6253\u5305\u53d1\u5e03"},"17.2.1. \u624b\u52a8\u6253\u5305\u53d1\u5e03"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"helm package <char name> # \u5c06chart\u76ee\u5f55\u6253\u5305\u5230chart\u5f52\u6863\u4e2d\u3002\n\nhelm repo index . # \u547d\u4ee4\u53ef\u4ee5\u57fa\u4e8e\u5305\u542b\u6253\u5305chart\u7684\u76ee\u5f55\uff0c\u751f\u6210\u4ed3\u5e93\u7684\u7d22\u5f15\u6587\u4ef6 index.yaml\u3002\n\n# \u6307\u5b9a\u5305\u8fdb\u884c\u5b89\u88c5\u4f7f\u7528\nhelm upgrade --install *.tgz\n# or\nhelm upgrade --install hello-helm hello-helm-0.1.0.tgz\n")),(0,r.kt)("h4",{id:"1722-\u5229\u7528-github-action-\u81ea\u52a8\u6253\u5305\u53d1\u5e03"},"17.2.2. \u5229\u7528 github action \u81ea\u52a8\u6253\u5305\u53d1\u5e03"),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/helm/chart-releaser-action"},"char-release-action")," \u81ea\u52a8\u53d1\u5e03 (\u8be5 action \u4f1a\u9ed8\u8ba4\u751f\u6210 helm chart \u53d1\u5e03\u5230 gh-pages \u5206\u652f\u4e0a)"),(0,r.kt)("p",null,"ci.yml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'name: Release Charts\n\non:\n  push:\n    branches:\n      - main\n\njobs:\n  release:\n    # depending on default permission settings for your org (contents being read-only or read-write for workloads), you will have to add permissions\n    # see: https://docs.github.com/en/actions/security-guides/automatic-token-authentication#modifying-the-permissions-for-the-github_token\n    permissions:\n      contents: write\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v2\n        with:\n          fetch-depth: 0\n\n      - name: Configure Git\n        run: |\n          git config user.name "$GITHUB_ACTOR"\n          git config user.email "$GITHUB_ACTOR@users.noreply.github.com"\n\n      - name: Install Helm\n        uses: azure/setup-helm@v1\n        with:\n          version: v3.8.1\n\n      - name: Run chart-releaser\n        uses: helm/chart-releaser-action@v1.4.0\n        with: \n          charts_dir: helm-charts\n        env:\n          CR_TOKEN: "${{ secrets.GITHUB_TOKEN }}"\n')),(0,r.kt)("h3",{id:"173-\u57fa\u672c\u4f7f\u7528"},"17.3. \u57fa\u672c\u4f7f\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u4f7f\u7528\u522b\u4eba\u5236\u4f5c\u597d\u7684 chart\n# Add the remote git repository to local helm repo\n# The git repo include a chart yml file, with which we can used to create all of the resources\nhelm repo add <chart name> <git url>\nhelm install my-hello-helm hellok8s/hello-helm [--version 0.1.0]\n\n\n# or\n#  \u81ea\u5df1\u5236\u4f5c\u597d chart \u540e, \u5728 helm chart \u76ee\u5f55\u4e0b\u6267\u884c\u5b89\u88c5, \u4f1a\u521b\u5efa\u597d resources\nhelm upgrade --install hello-helm --values values.yaml .\n\n\n\n# \u67e5\u770b charts list\nhelm ls\n\n# \u5220\u9664\nhelm delete my-mongo\n")),(0,r.kt)("h3",{id:"174-rollback"},"17.4. rollback"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u6bd4\u5982, \u6211\u4eec\u5bf9 values.yml \u505a\u4e86\u4fee\u6539\n\n# \u66f4\u65b0 k8s \u8d44\u6e90\nhelm upgrade --install hello-helm --values values.yaml .\n\n# \u53d1\u73b0\u66f4\u65b0\u6709\u95ee\u9898, \u56de\u6eda (\u56de\u6eda\u540e REVISION \u7248\u672c\u90fd\u4f1a\u589e\u5927\u5230 3 \u800c\u4e0d\u662f\u56de\u6eda\u5230 1)\nhelm rollback hello-helm 1\n\n")),(0,r.kt)("h3",{id:"175-\u591a\u73af\u5883"},"17.5. \u591a\u73af\u5883"),(0,r.kt)("p",null,"create ",(0,r.kt)("inlineCode",{parentName:"p"},"values-dev.yaml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u53ef\u4ee5\u591a\u6b21\u6307\u5b9a'--values \u6216\u8005 -f'\u53c2\u6570\uff0c\u6700\u540e\uff08\u6700\u53f3\u8fb9\uff09\u6307\u5b9a\u7684\u6587\u4ef6\u4f18\u5148\u7ea7\u6700\u9ad8\n# \u8fd9\u91cc\u6700\u53f3\u8fb9\u7684\u662f values-dev.yaml \u6587\u4ef6\uff0c\u6240\u4ee5 values-dev.yaml \u6587\u4ef6\u4e2d\u7684\u503c\u4f1a\u8986\u76d6 values.yaml \u4e2d\u76f8\u540c\u7684\u503c\n# -n dev \u8868\u793a\u5728\u540d\u5b57\u4e3a dev \u7684 namespace \u4e2d\u521b\u5efa k8s \u8d44\u6e90\nhelm upgrade --install hello-helm -f values.yaml -f values-dev.yaml -n dev .\n\n# \u8fd8\u53ef\u4ee5\u518d cmd \u4e2d\u4e34\u65f6\u8bbe\u7f6e values (\u6b64\u65b9\u6cd5\u5728 CICD \u4e2d\u7ecf\u5e38\u7528\u5230\u3002)\nhelm upgrade --install hello-helm -f values.yaml -f values-dev.yaml \\\n  --set application.hellok8s.message=\"It works with set helm values\" \\\n  -n dev .\n")),(0,r.kt)("h2",{id:"18-reference-materials"},"18. reference materials"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.bilibili.com/video/BV1Ja4y1x748"},"https://www.bilibili.com/video/BV1Ja4y1x748")," \u89c6\u9891\u6559\u7a0b"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/caicloud/kube-ladder"},"https://github.com/caicloud/kube-ladder")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/jpetazzo/container.training"},"https://github.com/jpetazzo/container.training")))}d.isMDXComponent=!0},58121:function(e,n,t){n.Z=t.p+"assets/images/k8s_design-3303f985c7890750df7bd0ada74e7b20.png"},73314:function(e,n,t){n.Z=t.p+"assets/images/k8s_design1-ee6f461a1bfc8942e993842de39ed7a6.png"},26758:function(e,n,t){n.Z=t.p+"assets/images/k8s_service_clusterip-e86739dbbf5a24827a7c8a13cadbe0ec.png"},15978:function(e,n,t){n.Z=t.p+"assets/images/k8s_storage-be12cdb7b38ab477a52835c7c8343043.png"}}]);