"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[2586],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return k}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),s=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(o.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),m=s(n),k=r,d=m["".concat(o,".").concat(k)]||m[k]||c[k]||l;return n?a.createElement(d,i(i({ref:t},u),{},{components:n})):a.createElement(d,i({ref:t},u))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=m;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=e,p.mdxType="string"==typeof e?e:r,i[1]=p;for(var s=2;s<l;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},56307:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return o},default:function(){return k},frontMatter:function(){return p},metadata:function(){return s},toc:function(){return c}});var a=n(83117),r=n(80102),l=(n(67294),n(3905)),i=["components"],p={title:"Spring Cloud \u7b14\u8bb0\ud83c\udf08",tags:["springcloud"],date:new Date("2018-05-02T10:46:12.000Z"),toc_min_heading_level:2,toc_max_heading_level:5},o=void 0,s={unversionedId:"springcloud-note",id:"springcloud-note",title:"Spring Cloud \u7b14\u8bb0\ud83c\udf08",description:"https://github.com/macrozheng/mall-swarm",source:"@site/docs/springcloud-note.md",sourceDirName:".",slug:"/springcloud-note",permalink:"/docs/springcloud-note",draft:!1,tags:[{label:"springcloud",permalink:"/docs/tags/springcloud"}],version:"current",frontMatter:{title:"Spring Cloud \u7b14\u8bb0\ud83c\udf08",tags:["springcloud"],date:"2018-05-02T10:46:12.000Z",toc_min_heading_level:2,toc_max_heading_level:5},sidebar:"tutorialSidebar",previous:{title:"Spring",permalink:"/docs/spring-note"},next:{title:"Spring MVC",permalink:"/docs/springmvc-note"}},u={},c=[{value:"4.1. Spring-Cloud-Config",id:"41-spring-cloud-config",level:2},{value:"4.2. apolo",id:"42-apolo",level:2},{value:"4.3. alibaba nacos \u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3",id:"43-alibaba-nacos-\u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3",level:2},{value:"5.1. \u6ce8\u518c\u4e2d\u5fc3\u9009\u578b",id:"51-\u6ce8\u518c\u4e2d\u5fc3\u9009\u578b",level:2},{value:"5.2. eureka",id:"52-eureka",level:2},{value:"5.3. consul",id:"53-consul",level:2},{value:"5.4. zookeeper",id:"54-zookeeper",level:2},{value:"5.5. nacos \u4f5c\u4e3a\u6ce8\u518c\u4e2d\u5fc3",id:"55-nacos-\u4f5c\u4e3a\u6ce8\u518c\u4e2d\u5fc3",level:2},{value:"5.6. etcd",id:"56-etcd",level:2},{value:"6.1. \u624b\u52a8\u5b9e\u73b0\u8c03\u7528\u6846\u67b6",id:"61-\u624b\u52a8\u5b9e\u73b0\u8c03\u7528\u6846\u67b6",level:2},{value:"6.2. feign",id:"62-feign",level:2},{value:"6.3. OpenFeign",id:"63-openfeign",level:2},{value:"6.3.1. \u57fa\u672c\u4f7f\u7528",id:"631-\u57fa\u672c\u4f7f\u7528",level:3},{value:"6.3.2. \u8d85\u65f6\u7efc\u5408\u914d\u7f6e",id:"632-\u8d85\u65f6\u7efc\u5408\u914d\u7f6e",level:3},{value:"6.3.3. feign client interceptor",id:"633-feign-client-interceptor",level:3},{value:"6.3.4. \u65e5\u5fd7\u914d\u7f6e",id:"634-\u65e5\u5fd7\u914d\u7f6e",level:3},{value:"6.3.5. feign Client \u5728\u751f\u4ea7\u8005\u7aef\u8fd8\u662f\u5728\u6d88\u8d39\u8005\u7aef\u5b9a\u4e49",id:"635-feign-client-\u5728\u751f\u4ea7\u8005\u7aef\u8fd8\u662f\u5728\u6d88\u8d39\u8005\u7aef\u5b9a\u4e49",level:3},{value:"7.1. \u96c6\u4e2d\u5f0f\u8d1f\u8f7d\u5747\u8861\u548c\u5ba2\u6237\u7aef\u8d1f\u8f7d\u5747\u8861",id:"71-\u96c6\u4e2d\u5f0f\u8d1f\u8f7d\u5747\u8861\u548c\u5ba2\u6237\u7aef\u8d1f\u8f7d\u5747\u8861",level:2},{value:"7.2. ribbon",id:"72-ribbon",level:2},{value:"7.2.1. \u5982\u4f55\u4f7f\u7528 ribbon",id:"721-\u5982\u4f55\u4f7f\u7528-ribbon",level:3},{value:"7.2.2. \u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5",id:"722-\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5",level:3},{value:"7.3. spring cloud loadBalancer",id:"73-spring-cloud-loadbalancer",level:2},{value:"8.1. hystrix",id:"81-hystrix",level:2},{value:"8.1.1. hystrix \u539f\u7406",id:"811-hystrix-\u539f\u7406",level:3},{value:"8.1.2. hystrix \u964d\u7ea7\u4f7f\u7528",id:"812-hystrix-\u964d\u7ea7\u4f7f\u7528",level:3},{value:"8.1.2.1. \u5355\u72ec\u4f7f\u7528",id:"8121-\u5355\u72ec\u4f7f\u7528",level:4},{value:"8.1.2.2. \u914d\u5408 openFeign",id:"8122-\u914d\u5408-openfeign",level:4},{value:"8.1.3. \u7194\u65ad\u76d1\u63a7Hystrix-Dashboard\u548cTurbine",id:"813-\u7194\u65ad\u76d1\u63a7hystrix-dashboard\u548cturbine",level:3},{value:"8.1.4. \u81ea\u5b9a\u4e49\u9694\u79bb\u7b56\u7565",id:"814-\u81ea\u5b9a\u4e49\u9694\u79bb\u7b56\u7565",level:3},{value:"8.2. spring cloud alibaba sentinel",id:"82-spring-cloud-alibaba-sentinel",level:2},{value:"8.3. resilience4j",id:"83-resilience4j",level:2},{value:"9.1. \u7f51\u5173\u9009\u578b",id:"91-\u7f51\u5173\u9009\u578b",level:2},{value:"9.2. \u7f51\u5173\u9ad8\u53ef\u7528",id:"92-\u7f51\u5173\u9ad8\u53ef\u7528",level:2},{value:"9.3. nodejs",id:"93-nodejs",level:2},{value:"9.4. kong",id:"94-kong",level:2},{value:"9.5. openResty",id:"95-openresty",level:2},{value:"9.6. zuul",id:"96-zuul",level:2},{value:"9.6.1. \u4ec0\u4e48\u662fzuul",id:"961-\u4ec0\u4e48\u662fzuul",level:3},{value:"9.6.2. \u57fa\u672c\u4f7f\u7528",id:"962-\u57fa\u672c\u4f7f\u7528",level:3},{value:"9.7. spring-cloud-gateway",id:"97-spring-cloud-gateway",level:2},{value:"9.7.1. \u7b80\u5355\u4ecb\u7ecd",id:"971-\u7b80\u5355\u4ecb\u7ecd",level:3},{value:"9.7.2. \u548c\u6ce8\u518c\u4e2d\u5fc3\u914d\u5408",id:"972-\u548c\u6ce8\u518c\u4e2d\u5fc3\u914d\u5408",level:3},{value:"9.7.3. \u8def\u7531",id:"973-\u8def\u7531",level:3},{value:"9.7.4. predcates \u4ecb\u7ecd",id:"974-predcates-\u4ecb\u7ecd",level:3},{value:"9.7.4.1. \u6709\u54ea\u4e9b\u5185\u7f6e route predicate factory",id:"9741-\u6709\u54ea\u4e9b\u5185\u7f6e-route-predicate-factory",level:4},{value:"9.7.4.2. \u65ad\u8a00\u5728\u4ee3\u7801\u4e2d\u914d\u7f6e",id:"9742-\u65ad\u8a00\u5728\u4ee3\u7801\u4e2d\u914d\u7f6e",level:4},{value:"9.7.4.3. \u65ad\u8a00\u5728yml\u4e2d\u914d\u7f6e",id:"9743-\u65ad\u8a00\u5728yml\u4e2d\u914d\u7f6e",level:4},{value:"9.7.5. filter \u4ecb\u7ecd",id:"975-filter-\u4ecb\u7ecd",level:3},{value:"9.7.5.1. \u6709\u54ea\u4e9b \u5185\u7f6e filter",id:"9751-\u6709\u54ea\u4e9b-\u5185\u7f6e-filter",level:4},{value:"9.7.5.2. \u8fc7\u6ee4\u5668\u7684\u914d\u7f6e\u65b9\u6cd5-\u4ee3\u7801",id:"9752-\u8fc7\u6ee4\u5668\u7684\u914d\u7f6e\u65b9\u6cd5-\u4ee3\u7801",level:4},{value:"9.7.5.3. \u8fc7\u6ee4\u5668\u914d\u7f6e\u65b9\u6cd5-yml",id:"9753-\u8fc7\u6ee4\u5668\u914d\u7f6e\u65b9\u6cd5-yml",level:4},{value:"9.7.5.4. \u81ea\u5b9a\u4e49\u5168\u5c40 filter",id:"9754-\u81ea\u5b9a\u4e49\u5168\u5c40-filter",level:4},{value:"9.7.5.5. \u81ea\u5b9a\u4e49\u666e\u901a gateway filter",id:"9755-\u81ea\u5b9a\u4e49\u666e\u901a-gateway-filter",level:4},{value:"9.7.6. gateway \u914d\u7f6e\u65b9\u6cd5",id:"976-gateway-\u914d\u7f6e\u65b9\u6cd5",level:3},{value:"9.7.7. \u7f51\u5173\u76d1\u63a7",id:"977-\u7f51\u5173\u76d1\u63a7",level:3},{value:"9.7.8. \u8d85\u65f6\u914d\u7f6e",id:"978-\u8d85\u65f6\u914d\u7f6e",level:3},{value:"9.7.9. \u8de8\u57df\u914d\u7f6e",id:"979-\u8de8\u57df\u914d\u7f6e",level:3},{value:"10.1. sleuth \u548c zipkin",id:"101-sleuth-\u548c-zipkin",level:2},{value:"10.1.1. \u5206\u5e03\u5f0f\u8ffd\u8e2a",id:"1011-\u5206\u5e03\u5f0f\u8ffd\u8e2a",level:3},{value:"10.1.2. spring-cloud-sleuth",id:"1012-spring-cloud-sleuth",level:3},{value:"10.1.3. zipkin \u4f7f\u7528",id:"1013-zipkin-\u4f7f\u7528",level:3},{value:"10.1.4. \u4f7f\u7528\u6848\u4f8b",id:"1014-\u4f7f\u7528\u6848\u4f8b",level:3},{value:"10.2. skyWalking",id:"102-skywalking",level:2},{value:"11.1. \u65e5\u5fd7\u600e\u4e48\u641c\u7d22 elasticSearch",id:"111-\u65e5\u5fd7\u600e\u4e48\u641c\u7d22-elasticsearch",level:2},{value:"11.2. \u65e5\u5fd7\u600e\u4e48\u6536\u96c6",id:"112-\u65e5\u5fd7\u600e\u4e48\u6536\u96c6",level:2},{value:"11.3. \u65e5\u5fd7\u600e\u4e48\u5c55\u793a",id:"113-\u65e5\u5fd7\u600e\u4e48\u5c55\u793a",level:2},{value:"12.1. prometheus/thanos",id:"121-prometheusthanos",level:2},{value:"13.1. Spring-Cloud-Bus",id:"131-spring-cloud-bus",level:2},{value:"13.2. alibaba nacos \u4f5c\u4e3a\u6d88\u606f\u603b\u7ebf",id:"132-alibaba-nacos-\u4f5c\u4e3a\u6d88\u606f\u603b\u7ebf",level:2},{value:"16.1. seata",id:"161-seata",level:2},{value:"Seata \u57fa\u672c\u4ecb\u7ecd",id:"seata-\u57fa\u672c\u4ecb\u7ecd",level:3},{value:"16.2. \u672c\u5730\u6d88\u606f\u8868",id:"162-\u672c\u5730\u6d88\u606f\u8868",level:2},{value:"18.1. \u4e1a\u52a1\u67b6\u6784",id:"181-\u4e1a\u52a1\u67b6\u6784",level:2},{value:"18.2. \u5e94\u7528\u67b6\u6784",id:"182-\u5e94\u7528\u67b6\u6784",level:2},{value:"18.3. \u6280\u672f\u67b6\u6784",id:"183-\u6280\u672f\u67b6\u6784",level:2},{value:"18.4. \u6570\u636e\u5e93\u67b6\u6784",id:"184-\u6570\u636e\u5e93\u67b6\u6784",level:2},{value:"18.5. \u9879\u76ee\u7ba1\u7406",id:"185-\u9879\u76ee\u7ba1\u7406",level:2},{value:"19.1. \u884c\u4e1a\u80cc\u666f and \u5546\u4e1a\u6a21\u5f0f",id:"191-\u884c\u4e1a\u80cc\u666f-and-\u5546\u4e1a\u6a21\u5f0f",level:2},{value:"20.1. \u805a\u5408\u652f\u4ed8\u6982\u5ff5",id:"201-\u805a\u5408\u652f\u4ed8\u6982\u5ff5",level:2},{value:"20.2. \u96c6\u5408\u652f\u4ed8\u9879\u76ee\u67b6\u6784",id:"202-\u96c6\u5408\u652f\u4ed8\u9879\u76ee\u67b6\u6784",level:2},{value:"20.3. \u652f\u4ed8\u4e1a\u52a1\u6d41\u7a0b",id:"203-\u652f\u4ed8\u4e1a\u52a1\u6d41\u7a0b",level:2},{value:"21.1. \u5e7f\u544a\u6982\u5ff5",id:"211-\u5e7f\u544a\u6982\u5ff5",level:2},{value:"21.2. \u7cfb\u7edf\u7ec4\u6210",id:"212-\u7cfb\u7edf\u7ec4\u6210",level:2},{value:"21.3. \u5e7f\u544a\u7684\u6838\u5fc3\u4e1a\u52a1\u6d41\u7a0b",id:"213-\u5e7f\u544a\u7684\u6838\u5fc3\u4e1a\u52a1\u6d41\u7a0b",level:2},{value:"21.4. \u6280\u672f\u96be\u70b9",id:"214-\u6280\u672f\u96be\u70b9",level:2},{value:"21.4.1. \u5e7f\u544a\u6570\u636e\u7684\u5b58\u50a8",id:"2141-\u5e7f\u544a\u6570\u636e\u7684\u5b58\u50a8",level:3},{value:"21.4.2. \u5e7f\u544a\u6570\u636e\u68c0\u7d22",id:"2142-\u5e7f\u544a\u6570\u636e\u68c0\u7d22",level:3},{value:"21.4.3. \u8ba1\u8d39\u5e73\u53f0\u7684\u6280\u672f\u65b9\u6848",id:"2143-\u8ba1\u8d39\u5e73\u53f0\u7684\u6280\u672f\u65b9\u6848",level:3},{value:"21.5. \u5e7f\u544a\u8868\u8bbe\u8ba1",id:"215-\u5e7f\u544a\u8868\u8bbe\u8ba1",level:2},{value:"21.6. MySQL \u7684 binlog \u5b9e\u73b0\u589e\u91cf\u7d22\u5f15",id:"216-mysql-\u7684-binlog-\u5b9e\u73b0\u589e\u91cf\u7d22\u5f15",level:2},{value:"21.6.1. java \u7ec4\u4ef6\u5b9e\u73b0\u76d1\u63a7",id:"2161-java-\u7ec4\u4ef6\u5b9e\u73b0\u76d1\u63a7",level:3},{value:"21.6.2. binlog \u914d\u7f6e SQL",id:"2162-binlog-\u914d\u7f6e-sql",level:3},{value:"22.1. \u5f00\u53d1\u73af\u5883\u642d\u5efa",id:"221-\u5f00\u53d1\u73af\u5883\u642d\u5efa",level:2},{value:"22.2. \u884c\u4e1a\u672f\u8bed",id:"222-\u884c\u4e1a\u672f\u8bed",level:2},{value:"22.3. \u4e1a\u52a1\u6d41\u7a0b\u5206\u6790",id:"223-\u4e1a\u52a1\u6d41\u7a0b\u5206\u6790",level:2},{value:"22.3.1. \u5546\u54c1\u65b0\u589e",id:"2231-\u5546\u54c1\u65b0\u589e",level:3},{value:"22.3.2. \u5546\u54c1\u4e0a\u67b6",id:"2232-\u5546\u54c1\u4e0a\u67b6",level:3},{value:"22.4. elasticsearch \u6570\u636e\u5efa\u6a21\u5206\u6790",id:"224-elasticsearch-\u6570\u636e\u5efa\u6a21\u5206\u6790",level:2},{value:"22.5. \u7f13\u5b58\u5206\u6790",id:"225-\u7f13\u5b58\u5206\u6790",level:2},{value:"22.6. \u90e8\u7f72\u67b6\u6784\u5206\u6790",id:"226-\u90e8\u7f72\u67b6\u6784\u5206\u6790",level:2},{value:"22.7. \u5f02\u6b65\u5904\u7406\u5206\u6790",id:"227-\u5f02\u6b65\u5904\u7406\u5206\u6790",level:2},{value:"22.7.1. mq",id:"2271-mq",level:3}],m={toc:c};function k(e){var t=e.components,p=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,a.Z)({},m,p,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("div",{align:"center"},(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/macrozheng/mall-swarm"},"https://github.com/macrozheng/mall-swarm"),"\nTODO"),(0,l.kt)("p",null,"Spring Cloud\u662f\u4e00\u7cfb\u5217\u6846\u67b6\u7684\u6709\u5e8f\u96c6\u5408, \u5b83\u5229\u7528Spring Boot\u7b80\u5316\u4e86\u5206\u5e03\u5f0f\u7cfb\u7edf\u57fa\u7840\u8bbe\u65bd\u7684\u5f00\u53d1\uff0c\u5982\u670d\u52a1\u53d1\u73b0\u6ce8\u518c\u3001\u914d\u7f6e\u4e2d\u5fc3\u3001\u6d88\u606f\u603b\u7ebf\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u65ad\u8def\u5668\u3001\u6570\u636e\u76d1\u63a7\u7b49;\n",(0,l.kt)("a",{parentName:"p",href:"http://projects.spring.io/spring-cloud/#quick-start"},"\u5b98\u7f51"),";\n",(0,l.kt)("a",{parentName:"p",href:"http://www.ityouknow.com/springcloud/2017/11/02/framework-and-springcloud.html"},"\u5fae\u670d\u52a1\u7684\u67b6\u6784\u6f14\u5316"),"\n",(0,l.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=aO3W-lYnw-o"},"https://www.youtube.com/watch?v=aO3W-lYnw-o")," (\u4e00\u4e2a\u5165\u95e8\u4ecb\u7ecd)\n",(0,l.kt)("a",{parentName:"p",href:"https://github.com/xiaoyureed/springcloud-tutorial"},"demo\u5728\u8fd9\u91cc")),(0,l.kt)("p",null,"spring cloud alibaba: nacos (\u670d\u52a1\u6ce8\u518c, \u914d\u7f6e\u4e2d\u5fc3, bus),  sentinel (\u7194\u65ad\u9650\u6d41), seata (\u5206\u5e03\u5f0f\u4e8b\u52a1)"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://juejin.im/post/6870288195674718222"},"https://juejin.im/post/6870288195674718222")," \u9009\u578b 2020"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/macrozheng"},"https://github.com/macrozheng")," \u7535\u5546\u7cfb\u7edftutorial"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/zhoutaoo/SpringCloud"},"https://github.com/zhoutaoo/SpringCloud")," demo"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://docshome.gitbook.io/microservices/"},"https://docshome.gitbook.io/microservices/")," \u4ece\u8bbe\u8ba1\u5230\u90e8\u7f72"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/maventalker/simplemall"},"https://github.com/maventalker/simplemall"),"\nTODO"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/chillzhuang/SpringBlade"},"https://github.com/chillzhuang/SpringBlade")," \u5b9e\u4f8b")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1-%E4%B8%80%E5%A5%97%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%B9%B3%E5%8F%B0%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"},"1. \u4e00\u5957\u5fae\u670d\u52a1\u5e73\u53f0\u6280\u672f\u9009\u578b")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#2-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A0%B8%E5%BF%83%E8%A6%81%E7%B4%A0%E5%92%8C-spring-cloud-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"},"2. \u5fae\u670d\u52a1\u6838\u5fc3\u8981\u7d20\u548c spring cloud \u5de5\u4f5c\u6d41\u7a0b")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#3-%E5%92%8Cdubbo-zookeeper%E5%AF%B9%E6%AF%94"},"3. \u548cdubbo-zookeeper\u5bf9\u6bd4")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#4-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"},"4. \u914d\u7f6e\u4e2d\u5fc3"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#41-spring-cloud-config"},"4.1. Spring-Cloud-Config")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#42-apolo"},"4.2. apolo")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#43-alibaba-nacos-%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"},"4.3. alibaba nacos \u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#5-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"},"5. \u6ce8\u518c\u4e2d\u5fc3"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#51-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E9%80%89%E5%9E%8B"},"5.1. \u6ce8\u518c\u4e2d\u5fc3\u9009\u578b")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#52-eureka"},"5.2. eureka")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#53-consul"},"5.3. consul")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#54-zookeeper"},"5.4. zookeeper")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#55-nacos-%E4%BD%9C%E4%B8%BA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"},"5.5. nacos \u4f5c\u4e3a\u6ce8\u518c\u4e2d\u5fc3")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#56-etcd"},"5.6. etcd")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#6-%E6%9C%8D%E5%8A%A1%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8"},"6. \u670d\u52a1\u76f8\u4e92\u8c03\u7528"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#61-%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0%E8%B0%83%E7%94%A8%E6%A1%86%E6%9E%B6"},"6.1. \u624b\u52a8\u5b9e\u73b0\u8c03\u7528\u6846\u67b6")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#62-feign"},"6.2. feign")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#63-openfeign"},"6.3. OpenFeign"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#631-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"},"6.3.1. \u57fa\u672c\u4f7f\u7528")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#632-%E8%B6%85%E6%97%B6%E7%BB%BC%E5%90%88%E9%85%8D%E7%BD%AE"},"6.3.2. \u8d85\u65f6\u7efc\u5408\u914d\u7f6e")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#633-feign-client-interceptor"},"6.3.3. feign client interceptor")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#634-%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"},"6.3.4. \u65e5\u5fd7\u914d\u7f6e")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#635-feign-client-%E5%9C%A8%E7%94%9F%E4%BA%A7%E8%80%85%E7%AB%AF%E8%BF%98%E6%98%AF%E5%9C%A8%E6%B6%88%E8%B4%B9%E8%80%85%E7%AB%AF%E5%AE%9A%E4%B9%89"},"6.3.5. feign Client \u5728\u751f\u4ea7\u8005\u7aef\u8fd8\u662f\u5728\u6d88\u8d39\u8005\u7aef\u5b9a\u4e49")))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#7-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"},"7. \u8d1f\u8f7d\u5747\u8861"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#71-%E9%9B%86%E4%B8%AD%E5%BC%8F%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"},"7.1. \u96c6\u4e2d\u5f0f\u8d1f\u8f7d\u5747\u8861\u548c\u5ba2\u6237\u7aef\u8d1f\u8f7d\u5747\u8861")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#72-ribbon"},"7.2. ribbon"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#721-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-ribbon"},"7.2.1. \u5982\u4f55\u4f7f\u7528 ribbon")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#722-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95"},"7.2.2. \u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#73-spring-cloud-loadbalancer"},"7.3. spring cloud loadBalancer")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#8-%E7%86%94%E6%96%AD%E5%99%A8"},"8. \u7194\u65ad\u5668"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#81-hystrix"},"8.1. hystrix"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#811-hystrix-%E5%8E%9F%E7%90%86"},"8.1.1. hystrix \u539f\u7406")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#812-hystrix-%E9%99%8D%E7%BA%A7%E4%BD%BF%E7%94%A8"},"8.1.2. hystrix \u964d\u7ea7\u4f7f\u7528"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#8121-%E5%8D%95%E7%8B%AC%E4%BD%BF%E7%94%A8"},"8.1.2.1. \u5355\u72ec\u4f7f\u7528")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#8122-%E9%85%8D%E5%90%88-openfeign"},"8.1.2.2. \u914d\u5408 openFeign")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#813-%E7%86%94%E6%96%AD%E7%9B%91%E6%8E%A7hystrix-dashboard%E5%92%8Cturbine"},"8.1.3. \u7194\u65ad\u76d1\u63a7Hystrix-Dashboard\u548cTurbine")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#814-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9A%94%E7%A6%BB%E7%AD%96%E7%95%A5"},"8.1.4. \u81ea\u5b9a\u4e49\u9694\u79bb\u7b56\u7565")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#82-spring-cloud-alibaba-sentinel"},"8.2. spring cloud alibaba sentinel")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#83-resilience4j"},"8.3. resilience4j")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#9-%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3"},"9. \u670d\u52a1\u7f51\u5173"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#91-%E7%BD%91%E5%85%B3%E9%80%89%E5%9E%8B"},"9.1. \u7f51\u5173\u9009\u578b")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#92-%E7%BD%91%E5%85%B3%E9%AB%98%E5%8F%AF%E7%94%A8"},"9.2. \u7f51\u5173\u9ad8\u53ef\u7528")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#93-nodejs"},"9.3. nodejs")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#94-kong"},"9.4. kong")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#95-openresty"},"9.5. openResty")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#96-zuul"},"9.6. zuul"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#961-%E4%BB%80%E4%B9%88%E6%98%AFzuul"},"9.6.1. \u4ec0\u4e48\u662fzuul")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#962-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"},"9.6.2. \u57fa\u672c\u4f7f\u7528")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#97-spring-cloud-gateway"},"9.7. spring-cloud-gateway"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#971-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D"},"9.7.1. \u7b80\u5355\u4ecb\u7ecd")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#972-%E5%92%8C%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E9%85%8D%E5%90%88"},"9.7.2. \u548c\u6ce8\u518c\u4e2d\u5fc3\u914d\u5408")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#973-%E8%B7%AF%E7%94%B1"},"9.7.3. \u8def\u7531")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#974-predcates-%E4%BB%8B%E7%BB%8D"},"9.7.4. predcates \u4ecb\u7ecd"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#9741-%E6%9C%89%E5%93%AA%E4%BA%9B%E5%86%85%E7%BD%AE-route-predicate-factory"},"9.7.4.1. \u6709\u54ea\u4e9b\u5185\u7f6e route predicate factory")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#9742-%E6%96%AD%E8%A8%80%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%85%8D%E7%BD%AE"},"9.7.4.2. \u65ad\u8a00\u5728\u4ee3\u7801\u4e2d\u914d\u7f6e")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#9743-%E6%96%AD%E8%A8%80%E5%9C%A8yml%E4%B8%AD%E9%85%8D%E7%BD%AE"},"9.7.4.3. \u65ad\u8a00\u5728yml\u4e2d\u914d\u7f6e")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#975-filter-%E4%BB%8B%E7%BB%8D"},"9.7.5. filter \u4ecb\u7ecd"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#9751-%E6%9C%89%E5%93%AA%E4%BA%9B-%E5%86%85%E7%BD%AE-filter"},"9.7.5.1. \u6709\u54ea\u4e9b \u5185\u7f6e filter")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#9752-%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95-%E4%BB%A3%E7%A0%81"},"9.7.5.2. \u8fc7\u6ee4\u5668\u7684\u914d\u7f6e\u65b9\u6cd5-\u4ee3\u7801")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#9753-%E8%BF%87%E6%BB%A4%E5%99%A8%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95-yml"},"9.7.5.3. \u8fc7\u6ee4\u5668\u914d\u7f6e\u65b9\u6cd5-yml")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#9754-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%A8%E5%B1%80-filter"},"9.7.5.4. \u81ea\u5b9a\u4e49\u5168\u5c40 filter")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#9755-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%99%AE%E9%80%9A-gateway-filter"},"9.7.5.5. \u81ea\u5b9a\u4e49\u666e\u901a gateway filter")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#976-gateway-%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95"},"9.7.6. gateway \u914d\u7f6e\u65b9\u6cd5")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#977-%E7%BD%91%E5%85%B3%E7%9B%91%E6%8E%A7"},"9.7.7. \u7f51\u5173\u76d1\u63a7")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#978-%E8%B6%85%E6%97%B6%E9%85%8D%E7%BD%AE"},"9.7.8. \u8d85\u65f6\u914d\u7f6e")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#979-%E8%B7%A8%E5%9F%9F%E9%85%8D%E7%BD%AE"},"9.7.9. \u8de8\u57df\u914d\u7f6e")))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#10-%E8%B0%83%E7%94%A8%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA"},"10. \u8c03\u7528\u94fe\u8def\u8ffd\u8e2a"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#101-sleuth-%E5%92%8C-zipkin"},"10.1. sleuth \u548c zipkin"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1011-%E5%88%86%E5%B8%83%E5%BC%8F%E8%BF%BD%E8%B8%AA"},"10.1.1. \u5206\u5e03\u5f0f\u8ffd\u8e2a")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1012-spring-cloud-sleuth"},"10.1.2. spring-cloud-sleuth")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1013-zipkin-%E4%BD%BF%E7%94%A8"},"10.1.3. zipkin \u4f7f\u7528")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1014-%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"},"10.1.4. \u4f7f\u7528\u6848\u4f8b")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#102-skywalking"},"10.2. skyWalking")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#11-%E4%B8%9A%E5%8A%A1%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86"},"11. \u4e1a\u52a1\u65e5\u5fd7\u6536\u96c6"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#111-%E6%97%A5%E5%BF%97%E6%80%8E%E4%B9%88%E6%90%9C%E7%B4%A2-elasticsearch"},"11.1. \u65e5\u5fd7\u600e\u4e48\u641c\u7d22 elasticSearch")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#112-%E6%97%A5%E5%BF%97%E6%80%8E%E4%B9%88%E6%94%B6%E9%9B%86"},"11.2. \u65e5\u5fd7\u600e\u4e48\u6536\u96c6")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#113-%E6%97%A5%E5%BF%97%E6%80%8E%E4%B9%88%E5%B1%95%E7%A4%BA"},"11.3. \u65e5\u5fd7\u600e\u4e48\u5c55\u793a")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#12-%E8%BF%90%E7%BB%B4%E7%9B%91%E6%8E%A7"},"12. \u8fd0\u7ef4\u76d1\u63a7"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#121-prometheusthanos"},"12.1. prometheus/thanos")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#13-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF"},"13. \u6d88\u606f\u603b\u7ebf"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#131-spring-cloud-bus"},"13.1. Spring-Cloud-Bus")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#132-alibaba-nacos-%E4%BD%9C%E4%B8%BA%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF"},"13.2. alibaba nacos \u4f5c\u4e3a\u6d88\u606f\u603b\u7ebf")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#14-spring-cloud-stream-%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8"},"14. spring-cloud-stream \u6d88\u606f\u9a71\u52a8")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#15-spring-cloud-data-flow"},"15. spring-cloud-data-flow")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#16-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1"},"16. \u5206\u5e03\u5f0f\u4e8b\u52a1"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#161-seata"},"16.1. seata"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#seata-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"},"Seata \u57fa\u672c\u4ecb\u7ecd")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#162-%E6%9C%AC%E5%9C%B0%E6%B6%88%E6%81%AF%E8%A1%A8"},"16.2. \u672c\u5730\u6d88\u606f\u8868")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#17-spring-cloud-alibaba-%E9%85%8D%E5%90%88-dubbo"},"17. spring cloud alibaba \u914d\u5408 dubbo")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#18-%E5%AE%9E%E9%99%85%E8%AE%BE%E8%AE%A1%E6%A1%88%E4%BE%8B-%E7%A5%A8%E5%8A%A1%E7%BD%91%E7%AB%99"},"18. \u5b9e\u9645\u8bbe\u8ba1\u6848\u4f8b \u7968\u52a1\u7f51\u7ad9"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#181-%E4%B8%9A%E5%8A%A1%E6%9E%B6%E6%9E%84"},"18.1. \u4e1a\u52a1\u67b6\u6784")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#182-%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84"},"18.2. \u5e94\u7528\u67b6\u6784")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#183-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84"},"18.3. \u6280\u672f\u67b6\u6784")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#184-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9E%B6%E6%9E%84"},"18.4. \u6570\u636e\u5e93\u67b6\u6784")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#185-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86"},"18.5. \u9879\u76ee\u7ba1\u7406")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#19-%E6%A1%88%E4%BE%8B-%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2"},"19. \u6848\u4f8b \u5728\u7ebf\u6559\u80b2"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#191-%E8%A1%8C%E4%B8%9A%E8%83%8C%E6%99%AF-and-%E5%95%86%E4%B8%9A%E6%A8%A1%E5%BC%8F"},"19.1. \u884c\u4e1a\u80cc\u666f and \u5546\u4e1a\u6a21\u5f0f")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#20-%E6%A1%88%E4%BE%8B-%E8%81%9A%E5%90%88%E6%94%AF%E4%BB%98"},"20. \u6848\u4f8b \u805a\u5408\u652f\u4ed8"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#201-%E8%81%9A%E5%90%88%E6%94%AF%E4%BB%98%E6%A6%82%E5%BF%B5"},"20.1. \u805a\u5408\u652f\u4ed8\u6982\u5ff5")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#202-%E9%9B%86%E5%90%88%E6%94%AF%E4%BB%98%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84"},"20.2. \u96c6\u5408\u652f\u4ed8\u9879\u76ee\u67b6\u6784")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#203-%E6%94%AF%E4%BB%98%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B"},"20.3. \u652f\u4ed8\u4e1a\u52a1\u6d41\u7a0b")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#21-%E6%A1%88%E4%BE%8B-%E5%B9%BF%E5%91%8A%E7%B3%BB%E7%BB%9F"},"21. \u6848\u4f8b \u5e7f\u544a\u7cfb\u7edf"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#211-%E5%B9%BF%E5%91%8A%E6%A6%82%E5%BF%B5"},"21.1. \u5e7f\u544a\u6982\u5ff5")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#212-%E7%B3%BB%E7%BB%9F%E7%BB%84%E6%88%90"},"21.2. \u7cfb\u7edf\u7ec4\u6210")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#213-%E5%B9%BF%E5%91%8A%E7%9A%84%E6%A0%B8%E5%BF%83%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B"},"21.3. \u5e7f\u544a\u7684\u6838\u5fc3\u4e1a\u52a1\u6d41\u7a0b")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#214-%E6%8A%80%E6%9C%AF%E9%9A%BE%E7%82%B9"},"21.4. \u6280\u672f\u96be\u70b9"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#2141-%E5%B9%BF%E5%91%8A%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AD%98%E5%82%A8"},"21.4.1. \u5e7f\u544a\u6570\u636e\u7684\u5b58\u50a8")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#2142-%E5%B9%BF%E5%91%8A%E6%95%B0%E6%8D%AE%E6%A3%80%E7%B4%A2"},"21.4.2. \u5e7f\u544a\u6570\u636e\u68c0\u7d22")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#2143-%E8%AE%A1%E8%B4%B9%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88"},"21.4.3. \u8ba1\u8d39\u5e73\u53f0\u7684\u6280\u672f\u65b9\u6848")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#215-%E5%B9%BF%E5%91%8A%E8%A1%A8%E8%AE%BE%E8%AE%A1"},"21.5. \u5e7f\u544a\u8868\u8bbe\u8ba1")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#216-mysql-%E7%9A%84-binlog-%E5%AE%9E%E7%8E%B0%E5%A2%9E%E9%87%8F%E7%B4%A2%E5%BC%95"},"21.6. MySQL \u7684 binlog \u5b9e\u73b0\u589e\u91cf\u7d22\u5f15"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#2161-java-%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0%E7%9B%91%E6%8E%A7"},"21.6.1. java \u7ec4\u4ef6\u5b9e\u73b0\u76d1\u63a7")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#2162-binlog-%E9%85%8D%E7%BD%AE-sql"},"21.6.2. binlog \u914d\u7f6e SQL")))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#22-%E6%A1%88%E4%BE%8B-%E7%94%B5%E5%95%86%E7%B1%BB%E7%BD%91%E7%AB%99"},"22. \u6848\u4f8b \u7535\u5546\u7c7b\u7f51\u7ad9"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#221-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"},"22.1. \u5f00\u53d1\u73af\u5883\u642d\u5efa")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#222-%E8%A1%8C%E4%B8%9A%E6%9C%AF%E8%AF%AD"},"22.2. \u884c\u4e1a\u672f\u8bed")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#223-%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"},"22.3. \u4e1a\u52a1\u6d41\u7a0b\u5206\u6790"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#2231-%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E"},"22.3.1. \u5546\u54c1\u65b0\u589e")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#2232-%E5%95%86%E5%93%81%E4%B8%8A%E6%9E%B6"},"22.3.2. \u5546\u54c1\u4e0a\u67b6")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#224-elasticsearch-%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1%E5%88%86%E6%9E%90"},"22.4. elasticsearch \u6570\u636e\u5efa\u6a21\u5206\u6790")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#225-%E7%BC%93%E5%AD%98%E5%88%86%E6%9E%90"},"22.5. \u7f13\u5b58\u5206\u6790")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#226-%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84%E5%88%86%E6%9E%90"},"22.6. \u90e8\u7f72\u67b6\u6784\u5206\u6790")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#227-%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86%E5%88%86%E6%9E%90"},"22.7. \u5f02\u6b65\u5904\u7406\u5206\u6790"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#2271-mq"},"22.7.1. mq")))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#23-%E6%A1%88%E4%BE%8B-%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0"},"23. \u6848\u4f8b \u7269\u8054\u7f51\u5e73\u53f0"))),(0,l.kt)("h1",{id:"1-\u4e00\u5957\u5fae\u670d\u52a1\u5e73\u53f0\u6280\u672f\u9009\u578b"},"1. \u4e00\u5957\u5fae\u670d\u52a1\u5e73\u53f0\u6280\u672f\u9009\u578b"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(54297).Z,width:"2106",height:"1432"})),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"\n\u5f00\u53d1\u7ec4\u4ef6\n\n  spring boot\n  jpa / mybatisplus\n  mapstruct \u5bf9\u8c61\u8f6c\u6362\u63d2\u4ef6\n  knife + swagger api \u6587\u6863\n  easycode \u4ee3\u7801\u751f\u6210\n  idea \u63d2\u4ef6\n    jrebel\n    mybatisx\n    batslog\n    generateAllsetter\n    swagger tools\n    restful tool\n    string manipulation\n    gsonformatplus\n    Maven helper\n    key promoter\n    Rainbow brackets\n    grep console\n    code glance\n\n\u5fae\u670d\u52a1\n\n  nacos \u914d\u7f6e\u4e2d\u5fc3, \u6ce8\u518c\u4e2d\u5fc3\n  spring-cloud-gateway \u7f51\u5173\n  spring-security + oauth2.0 \u5b89\u5168\u9a8c\u8bc1\n  seata \u5206\u5e03\u5f0f\u4e8b\u52a1\n  sentinel \u9650\u6d41(\u6d41\u91cf\u9632\u62a4, \u5e26\u6709\u63a7\u5236\u9762\u677f)\n  open feign \u670d\u52a1\u8c03\u7528(\u8d1f\u8f7d\u5747\u8861)\n  skywalking \u94fe\u8def\u8ffd\u8e2a\n  elastic search \u4e1a\u52a1\u641c\u7d22\n  EFK(es, filebeat, kibana) \u5206\u5e03\u5f0f\u65e5\u5fd7\u5b58\u50a8\u5c55\u793a\n  Prometheus + grafana \u76d1\u63a7 (\u6307\u6807\u91c7\u96c6 + \u5c55\u793a\u9762\u677f)\n    \u9489\u9489\u544a\u8b66\n  canal \u6570\u636e\u540c\u6b65 (MySql -> ES)\n  xxl-job \u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\n  rocketMQ \u6d88\u606f\u961f\u5217\n  redis-cluster \u7f13\u5b58\n  redission \u57fa\u4e8eredis \u7684\u5206\u5e03\u5f0f\u9501\n  MySQL \u6570\u636e\u5e93\n  jeepay \u652f\u4ed8\u805a\u5408\u5e73\u53f0\n\n\n\u4e91\u539f\u751f devops\n\n  docker \u5bb9\u5668\u5316\n  Harbor \u79c1\u6709\u955c\u50cf\u4ed3\u5e93\n  k8s \u7f16\u6392\u7ba1\u7406, \u90e8\u7f72\n    kubesphere \u5bb9\u5668\u76d1\u63a7\n  gitlab \u4ee3\u7801\u7ba1\u7406\n  Jenkins \u6301\u7eed\u96c6\u6210\n  Maven \u6253\u5305\u7f16\u8bd1\n  nexus Maven \u79c1\u6709\u4ed3\u5e93\n\n")),(0,l.kt)("h1",{id:"2-\u5fae\u670d\u52a1\u6838\u5fc3\u8981\u7d20\u548c-spring-cloud-\u5de5\u4f5c\u6d41\u7a0b"},"2. \u5fae\u670d\u52a1\u6838\u5fc3\u8981\u7d20\u548c spring cloud \u5de5\u4f5c\u6d41\u7a0b"),(0,l.kt)("p",null,"Spring Cloud\u4e3b\u8981\u7684\u8981\u7d20/\u7ec4\u4ef6:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"service registry/find (client, server)")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"distributed configuration management (server , client)")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"http/rpc, load balance")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"circuit breaker")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"gateway"))),(0,l.kt)("p",null,"\u4ee5\u53ca\u5b83\u7684\u8bbf\u95ee\u6d41\u7a0b:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5916\u90e8\u6216\u8005\u5185\u90e8\u7684\u975eSpring Cloud\u9879\u76ee\u90fd\u7edf\u4e00\u901a\u8fc7API\u7f51\u5173\uff08Zuul\uff09\u6765\u8bbf\u95ee\u5185\u90e8\u670d\u52a1.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7f51\u5173\u63a5\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u4ece\u6ce8\u518c\u4e2d\u5fc3\uff08Eureka\uff09\u83b7\u53d6\u53ef\u7528\u670d\u52a1")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7531Ribbon\u8fdb\u884c\u5747\u8861\u8d1f\u8f7d\u540e\uff0c\u5206\u53d1\u5230\u540e\u7aef\u7684\u5177\u4f53\u5b9e\u4f8b")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5fae\u670d\u52a1\u4e4b\u95f4\u901a\u8fc7Feign\u8fdb\u884c\u901a\u4fe1\u5904\u7406\u4e1a\u52a1")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Hystrix\u8d1f\u8d23\u5904\u7406\u670d\u52a1\u8d85\u65f6\u7194\u65ad")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Turbine\u76d1\u63a7\u670d\u52a1\u95f4\u7684\u8c03\u7528\u548c\u7194\u65ad\u76f8\u5173\u6307\u6807"))),(0,l.kt)("h1",{id:"3-\u548cdubbo-zookeeper\u5bf9\u6bd4"},"3. \u548cdubbo-zookeeper\u5bf9\u6bd4"),(0,l.kt)("p",null,"dubbo\u662f\u7528\u6765\u8de8\u7cfb\u7edf\u901a\u4fe1\u7684\uff0c\u662f\u4e00\u4e2a rpc \u6846\u67b6\u3002"),(0,l.kt)("p",null,"zookeeper \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\u8282\u70b9\u7ba1\u7406, \u53ef\u4ee5\u505a\u6ce8\u518c\u4e2d\u5fc3"),(0,l.kt)("p",null,"\u4e00\u4e2a\u7cfb\u7edf\u7528\u4f5c\u5ba2\u6237\u7aef\uff0c\u4e00\u4e2a\u7cfb\u7edf\u5219\u5145\u5f53\u670d\u52a1\u7aef\u3002\u670d\u52a1\u7aef\u8981\u628a\u81ea\u5df1\u7684\u63a5\u53e3\u5b9a\u4e49\u63d0\u4f9b\u7ed9\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u5c06\u63a5\u53e3\u5b9a\u4e49\u5728spring\u4e2d\u7684bean\u3002\u5ba2\u6237\u7aef\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2abean\uff0c\u5c31\u597d\u50cf\u8fd9\u4e9b\u63a5\u53e3\u7684\u5b9e\u73b0\u4e5f\u662f\u5728\u81ea\u5df1\u4ee3\u7801\u91cc\u4e00\u6837\u3002\n\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u542f\u52a8\u7684\u65f6\u5019\u90fd\u4f1a\u628a\u81ea\u5df1\u7684\u673a\u5668IP\u6ce8\u518c\u5230zookeeper\u4e0a\u3002\u5ba2\u6237\u7aef\u4f1a\u628azk\u4e0a\u7684\u670d\u52a1\u7aefip\u62c9\u5230\u78c1\u76d8\u4e0a\uff0c\u5e76\u8bb0\u5f55\u54ea\u4e9bip\u63d0\u4f9b\u54ea\u4e9b\u670d\u52a1\uff08\u670d\u52a1\u7aef\u542f\u52a8\u7684\u65f6\u5019\u66b4\u9732\u7ed9zk\uff09\u3002\u7136\u540e\u8c03\u7528\u7684\u65f6\u5019\u5ba2\u6237\u7aef\u4f1a\u6839\u636eip\u8c03\u7528\u670d\u52a1\u7aef\u7684\u670d\u52a1\uff0c\u8fd9\u65f6\u5019\u5373\u4f7fzk\u6302\u6389\u4e5f\u6ca1\u5173\u7cfb\u3002"),(0,l.kt)("p",null,"springcloud \u662f dubbo \u7684\u8d85\u96c6;"),(0,l.kt)("p",null,"\u53ef\u4ee5\u81ea\u5b9a\u4e49\u540d\u5b57 , \u4f4d\u7f6e;"),(0,l.kt)("h1",{id:"4-\u914d\u7f6e\u4e2d\u5fc3"},"4. \u914d\u7f6e\u4e2d\u5fc3"),(0,l.kt)("p",null,"\u4f7f\u7528\u4e86\u914d\u7f6e\u4e2d\u5fc3\u540e, \u5728\u5404\u4e2a config client \u9700\u8981\u7528 bootstrap application context, \u5bf9\u5e94\u7684 \u914d\u7f6e\u6587\u4ef6 bootstrap.yml, \u7528\u4e8e\u914d\u7f6e\u4e0d\u4f1a\u7ecf\u5e38\u53d8\u5316\u7684 \u914d\u7f6e, \u5982 app name, config server addr"),(0,l.kt)("p",null,"\u5148\u4e8e application.yml \u8bfb\u53d6, \u5e94\u7528\u4e8e\u66f4\u52a0\u65e9\u671f\u914d\u7f6e\u4fe1\u606f\u8bfb\u53d6\uff0c\u5982\u53ef\u4ee5\u4f7f\u7528\u6765\u914d\u7f6eapplication.yml\u4e2d\u4f7f\u7528\u5230\u53c2\u6570\u7b49"),(0,l.kt)("p",null,"\u5982\u4f7f\u7528 Spring Cloud Config Server \u7684\u65f6\u5019\uff0c\u5728 bootstrap.yml \u91cc\u9762\u6307\u5b9a spring.application.name \u548c spring.cloud.config.server.git.uri"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},"spring:\n  application:\n    name: service-a\n  cloud:\n    bootstrap:\n        # \u7981\u7528 bootstrap \u8fc7\u7a0b\n        enabled: false\n    config:\n      uri: http://127.0.0.1:8888\n      fail-fast: true\n      username: user\n      password: ${CONFIG_SERVER_PASSWORD:password}\n      retry:\n        initial-interval: 2000\n        max-interval: 10000\n        multiplier: 2\n        max-attempts: 10\n")),(0,l.kt)("h2",{id:"41-spring-cloud-config"},"4.1. Spring-Cloud-Config"),(0,l.kt)("p",null,"\u8fdb\u5165 maintenance"),(0,l.kt)("p",null,"\u5305\u542b\u4e86Client\u548cServer\u4e24\u4e2a\u90e8\u5206, server\u81ea\u52a8\u5c06\u5b58\u50a8\u7684\u914d\u7f6e\u6587\u4ef6\u53d1\u5e03\u6210REST\u63a5\u53e3, client\u901a\u8fc7\u63a5\u53e3\u83b7\u53d6\u6570\u636e\u3001\u5e76\u4f9d\u636e\u6b64\u6570\u636e\u521d\u59cb\u5316\u81ea\u5df1\u7684\u5e94\u7528"),(0,l.kt)("p",null,"\u5ba2\u6237\u7aef\u5b8c\u5168\u900f\u660e(\u4f46\u662f\u9700\u8981\u5728 client \u7684 bootstrap.properties \u4e2d\u914d\u7f6eserver\u7aef\u4fe1\u606f, \u81f3\u5c11\u9700\u8981 ",(0,l.kt)("inlineCode",{parentName:"p"},"spring.cloud.config.server.git.uri"),", \u540c\u65f6\u53ef\u4ee5\u914d\u7f6e\u641c\u7d22\u76ee\u5f55 ",(0,l.kt)("inlineCode",{parentName:"p"},"spring.cloud.config.search-paths"),"), server \u9700\u8981\u5f00\u542f ",(0,l.kt)("inlineCode",{parentName:"p"},"@enableConfigServer")),(0,l.kt)("p",null,"Spring cloud\u4f7f\u7528git\u6216svn\u5b58\u653e\u914d\u7f6e\u6587\u4ef6\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f7f\u7528git;"),(0,l.kt)("p",null,"\u548c eureka \u914d\u5408\u540e, config server\u7aefapi\u63a5\u53e3\u4f7f\u7528\u89c4\u5219:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"/{application}/{profile}[/{label}]          \n    # application -  [\u4e3b\u6587\u4ef6\u540d] \n    # profile \u4e3a \u6587\u4ef6\u540dprofile \u540e\u7f00, \u6ca1\u6709\u5219\u4e3a default\n    # label(\u5206\u652f\u540d)\u53ef\u9009,\u9ed8\u8ba4\u4e3amaster, \u8fd4\u56de\u7ed3\u6784\u5316\u7684json\n/{application}-{profile}.yml                # \u76f4\u63a5\u8fd4\u56deproperty source\u6587\u4ef6\u5185\u7684\u6587\u672c\u5185\u5bb9\n/{application}-{profile}.properties         \n/{label}/{application}-{profile}.yml\n/{label}/{application}-{profile}.properties\n\n")),(0,l.kt)("p",null,"git repo config file \u9ed8\u8ba4\u547d\u540d\u89c4\u5219: \u5bf9\u4e8e git repo \u4e2d\u7684\u914d\u7f6e\u6587\u4ef6 'config-client-dev.yml', config-client \u4e3aclient\u7aef spring.application.name \u7684\u503c, dev \u4e3a client \u6fc0\u6d3b\u7684 profiles"),(0,l.kt)("p",null,"\u5982\u679c\u5e0c\u671b\u81ea\u5b9a\u4e49 git repo config file \u547d\u540d, \u53ef\u4ee5\u5728 config client \u914d\u7f6e ",(0,l.kt)("inlineCode",{parentName:"p"},"spring.cloud.config.name/profile/label/"),", name \u662f\u4e3b\u6587\u4ef6\u540d, profile \u662f\u540e\u7f00\u540d"),(0,l.kt)("p",null,"client \u7684\u5237\u65b0\u529f\u80fd: \u6700\u597d\u901a\u8fc7 spring cloud bus \u5b9e\u73b0; \u4f46\u662f\u57fa\u672c\u7684 refresh \u4e5f\u5b9e\u73b0\u4e86, ",(0,l.kt)("inlineCode",{parentName:"p"},"curl -d{} http://localhost:8080/refresh")," \u4e4b\u540e client \u624d\u4f1a\u4f7f\u7528\u65b0\u7684\u914d\u7f6e, ",(0,l.kt)("a",{parentName:"p",href:"https://www.jianshu.com/p/8fcb88ea4458"},"\u5982\u679c\u5f00\u542f\u4e86 actuator , \u5219\u4f1a\u51fa\u73b0 404"),", \u9700\u8981\u914d\u7f6e ",(0,l.kt)("inlineCode",{parentName:"p"},"management.endpoints.web.exposure.include=refresh,info,health")," (\u9ed8\u8ba4\u503c\u53ea\u6709 info , health. \u5982\u679c\u662f yml , \u5219\u503c\u9700\u8981\u52a0\u5355\u5f15\u53f7), \u7136\u540e ",(0,l.kt)("inlineCode",{parentName:"p"},"curl -d{} http://xxx:xxx/actuator/refresh"),", \u6d89\u53ca\u5230\u5237\u65b0\u7684\u7c7b, \u9700\u8981 ",(0,l.kt)("inlineCode",{parentName:"p"},"@RefreshScope")," (to support config refresh; \u539f\u7406\u662f config server \u4fee\u6539\u4e86\u914d\u7f6e, \u8fd9\u4e2a controller bean \u4f1a\u9500\u6bc1\u91cd\u65b0\u751f\u6210)"),(0,l.kt)("p",null,"\u5f15\u5165 \u914d\u7f6e\u4e2d\u5fc3\u540e, client \u7aef\u7684 application.yml \u9700\u8981 rename \u4e3a bootstrap.yml, \u6700\u5148\u8bfb\u53d6, \u4f1a\u88ab\u540e\u9762\u8bfb\u53d6\u7684\u914d\u7f6e\u8986\u76d6, \u6240\u4ee5\u4f18\u5148\u7ea7\u4f4e\u4e8e config server \u4e2d\u7684\u914d\u7f6e"),(0,l.kt)("p",null,"config server \u4fee\u6539\u914d\u7f6e\u540e, commit(git \u4ed3\u5e93\u5728\u672c\u5730) \u6216\u8005 push (git \u5e93\u5728\u8fdc\u7a0b) \u540e client \u7aef\u5373\u53ef\u751f\u6548"),(0,l.kt)("p",null,"\u591a\u670d\u52a1\u516c\u7528\u914d\u7f6e\u6587\u4ef6 (\u516c\u5171\u914d\u7f6e\u6587\u4ef6): "),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u65b9\u6cd51: \u5728\u914d\u7f6e\u6587\u4ef6\u4ed3\u5e93\u589e\u52a0\u914d\u7f6e\u6587\u4ef6 application.properties \u4f5c\u4e3a\u516c\u5171\u6587\u4ef6\u5373\u53ef. serviceA \u65e0\u6cd5\u5728\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6 (\u5982 serviceA.properties, serviceA-dev.properties) \u627e\u5230\u914d\u7f6e\u9879, \u4f1a\u5230 \u516c\u5171\u6587\u4ef6\u4e2d\u627e")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u65b9\u6cd52: \u65b0\u5efa common.properties \u4f5c\u4e3a\u516c\u5171\u6587\u4ef6, \u5230\u6bcf\u4e2a client \u7aef \u4fee\u6539 ",(0,l.kt)("inlineCode",{parentName:"p"},"spring.cloud.config.name=ServiceA,common")," \u914d\u7f6e\u591a\u4e2a\u914d\u7f6e\u6587\u4ef6\u540d"))),(0,l.kt)("p",null,"\u91cd\u8981\u7684\u914d\u7f6e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-props"},"# server \n\nserver.port=8888\n# \u672c\u5730\u7684git repo \u5c31\u8fd9\u4e48\u8bbe\u7f6e file://${user.home}/config-repo(Linux) file:///${user.home}/config-repo (windows), \u6700\u65b0\u7248\u672c\u65e0\u9700\u5982\u6b64\u8bbe\u7f6e\u4e86\n# \u5982\u679c\u662f remote git repo, \u8fd8\u9700\u8981 username, password, basedir (clone to here), search-path(properties source \u8def\u5f84)\nspring.cloud.config.server.git.uri=${user.home}/Desktop/config\n\n# client\n\nspring.application.name=reservation-service\n# \u4e00\u822c\u5728 bootstrap.yml \u914d\u7f6e\n# default\n# \u8fd8\u6709 label(master), profile(default to `default`), fail-first(default to false), name(file name in remote config repo)\nspring.cloud.config.uri=http://localhost:8888\n# config refresh required: curl -d{} http://localhost:8000/actuator/refresh\nmanagement.endpoints.web.exposure.include=refresh,info,health\n\n")),(0,l.kt)("h2",{id:"42-apolo"},"4.2. apolo"),(0,l.kt)("p",null,"\u6765\u81ea\u643a\u7a0b"),(0,l.kt)("h2",{id:"43-alibaba-nacos-\u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3"},"4.3. alibaba nacos \u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"namespace \u547d\u540d\u7a7a\u95f4"),(0,l.kt)("p",{parentName:"li"},"\u82e5\u4e0d\u914d\u7f6e, \u5219 App \u9ed8\u8ba4\u8bfb\u53d6 public \u4e0b\u7684\u914d\u7f6e; {spring.application.name}.yml/properties "),(0,l.kt)("p",{parentName:"li"},"\u5e38\u7528\u7684\u9694\u79bb\u65b9\u6848\u6709\u4e24\u4e2a: \u5982 \u6bcf\u4e2a sub module \u62e5\u6709\u4e00\u4e2a namespace, \u6bcf\u4e2a namespace \u91cc\u9762\u5206 dev.yml, prod.yml... ; \u6216\u8005\u6709\u4e09\u4e2a namespace: dev, prod, test. \u6bcf\u4e2a namespace \u4e0b\u6709 sub-module1.yml, sub-module2.yml, sub-module3.yml...")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},'data-id \u914d\u7f6e\u96c6, \u53ef\u5c06\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u5206\u62c6\u4e3a\u591a\u4e2a\u914d\u7f6e\u6587\u4ef6, \u6bcf\u4e2a\u914d\u7f6e\u96c6\u90fd\u6709\u4f4d\u4e8e extension-configs \u4e0b\u7684 data-id, group, refresh(\u9700\u8981 @NacosValue(value = "${aa.bb}", autoRefreshed = true) \u914d\u5408)'),(0,l.kt)("p",{parentName:"li"},"\u82e5\u4e0d\u914d\u7f6e, \u9ed8\u8ba4\u8bfb\u53d6 {spring.application.name}.yml/properties"),(0,l.kt)("p",{parentName:"li"},"\u4e00\u822c\u9879\u76ee\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\u4f1a\u62c6\u5206\u4e3a\u591a\u4e2a\u914d\u7f6e\u96c6, \u5982 datasource.yml, mybatis.yml..."),(0,l.kt)("p",{parentName:"li"},"\u5fc5\u987b\u914d\u7f6e\u4e3a \u6587\u4ef6\u5168\u540d(\u5373\u5305\u62ec\u540e\u7f00, xml, json, properties, yml)")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"group \u914d\u7f6e\u7684\u5206\u7ec4"),(0,l.kt)("p",{parentName:"li"},"\u82e5\u4e0d\u914d\u7f6e, \u52a0\u8f7d\u65f6, \u9ed8\u8ba4\u6bcf\u6b21\u90fd\u52a0\u8f7d\u67d0 namespace \u4e0b\u5c5e\u4e8e DEFAULT_GROUP \u5206\u7ec4\u7684\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("p",{parentName:"li"},"\u4e00\u822c\u7528\u6765\u533a\u5206\u73af\u5883, \u5982 dev , prod , test . \u573a\u666f: \u53cc\u5341\u4e00\u4e34\u65f6\u4f7f\u7528 \u5206\u7ec4 11-11 \u4e0b\u7684\u914d\u7f6e\u6587\u4ef6, \u53ef\u4ee5\u65b9\u4fbf\u7684\u5207\u6362"))),(0,l.kt)("h1",{id:"5-\u6ce8\u518c\u4e2d\u5fc3"},"5. \u6ce8\u518c\u4e2d\u5fc3"),(0,l.kt)("h2",{id:"51-\u6ce8\u518c\u4e2d\u5fc3\u9009\u578b"},"5.1. \u6ce8\u518c\u4e2d\u5fc3\u9009\u578b"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://blog.csdn.net/fly910905/article/details/100023415"},"https://blog.csdn.net/fly910905/article/details/100023415")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://yq.aliyun.com/articles/599997"},"\u963f\u91cc\u5df4\u5df4\u4e3a\u4ec0\u4e48\u4e0d\u4f7f\u7528 zk \u4f5c\u4e3a registry center")),(0,l.kt)("p",null,"Eureka, consul (golang), zookeeper; \u65b0\u51fa\u7684 nacos"),(0,l.kt)("p",null,"eureka\u5c31\u662f\u4e2aservlet\u7a0b\u5e8f\uff0c\u8dd1\u5728servlet\u5bb9\u5668\u4e2d; Consul\u5219\u662fgo\u7f16\u5199\u800c\u6210\u3002"),(0,l.kt)("p",null,"cap \u652f\u6301\u4e0d\u540c:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Consul\u4f18\u5148\u4fdd\u8bc1\u5f3a\u4e00\u81f4\u6027(C), \u670d\u52a1\u6ce8\u518c\u76f8\u6bd4Eureka\u4f1a\u7a0d\u6162\u4e00\u4e9b\u3002\u56e0\u4e3aConsul\u7684raft\u534f\u8bae\u8981\u6c42\u5fc5\u987b\u8fc7\u534a\u6570\u7684\u8282\u70b9\u90fd\u5199\u5165\u6210\u529f\u624d\u8ba4\u4e3a\u6ce8\u518c\u6210\u529f; Leader\u6302\u6389\u65f6\uff0c\u91cd\u65b0\u9009\u4e3e\u671f\u95f4\u6574\u4e2aconsul\u4e0d\u53ef\u7528\u3002\u4fdd\u8bc1\u4e86\u5f3a\u4e00\u81f4\u6027\u4f46\u727a\u7272\u4e86\u53ef\u7528\u6027\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Eureka\u4f18\u5148\u4fdd\u8bc1\u9ad8\u53ef\u7528(A), \u4f46\u662f\u4f1a\u4fdd\u8bc1\u6700\u7ec8\u4e00\u81f4\u6027, \u670d\u52a1\u6ce8\u518c\u76f8\u5bf9\u8981\u5feb\uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u7b49\u6ce8\u518c\u4fe1\u606freplicate\u5230\u5176\u4ed6\u8282\u70b9; \u5f53\u6570\u636e\u51fa\u73b0\u4e0d\u4e00\u81f4\u65f6\uff0c\u867d\u7136A, B\u4e0a\u7684\u6ce8\u518c\u4fe1\u606f\u4e0d\u5b8c\u5168\u76f8\u540c\uff0c\u4f46\u6bcf\u4e2aEureka\u8282\u70b9\u4f9d\u7136\u80fd\u591f\u6b63\u5e38\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u8fd9\u4f1a\u51fa\u73b0\u67e5\u8be2\u670d\u52a1\u4fe1\u606f\u65f6\u5982\u679c\u8bf7\u6c42A\u67e5\u4e0d\u5230\uff0c\u4f46\u8bf7\u6c42B\u5c31\u80fd\u67e5\u5230\u3002\u5982\u6b64\u4fdd\u8bc1\u4e86\u53ef\u7528\u6027\u4f46\u727a\u7272\u4e86\u4e00\u81f4\u6027")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"zookeeper \u4f18\u5148\u4fdd\u8bc1 c , client \u6ca1\u6709\u5fc3\u8df3, \u7acb\u5373\u5220\u9664\u8be5\u8282\u70b9")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"nacos \u662f\u7528\u4e8e\u66ff\u4ee3 eureka, \u7279\u6027\u548c eureka \u7c7b\u4f3c, \u4fdd\u8bc1 ap, \u4e5f\u652f\u6301\u63a7\u5236\u53f0"))),(0,l.kt)("p",null,"\u5bf9\u5916\u66b4\u9732\u7684\u63a5\u53e3\u60c5\u51b5\u4e0d\u540c:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"consul \u548c eureka \u652f\u6301 http")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"zookeeper \u53ea\u63d0\u4f9b\u4e86 client, \u9700\u8981\u901a\u8fc7 client \u4ea4\u4e92"))),(0,l.kt)("h2",{id:"52-eureka"},"5.2. eureka"),(0,l.kt)("p",null,"\u76ee\u524d maintenance"),(0,l.kt)("p",null,"\u9ed8\u8ba4\u4e0b, eureka client \u52a0\u5165 class path \u540e, \u5e94\u7528\u4f1a\u81ea\u52a8\u6ce8\u518c\u5230 eureka server (\u9ed8\u8ba4 defaultZone \u4e3a http://localhost:8761/eureka); \u4f5c\u4e3a eureka server, eureka client \u4f9d\u8d56\u4e0d\u9700\u8981\u5f15\u5165\u4e86"),(0,l.kt)("p",null,"client \u7aef\u8fde\u63a5 server, \u5982\u679c\u81ea\u5b9a\u4e49 eureka \u5730\u5740, client \u9700\u8981\u914d\u7f6e ",(0,l.kt)("inlineCode",{parentName:"p"},"eureka.client.serviceUrl"),"(map \u7c7b\u578b), \u589e\u52a0 defaultZone (\u5927\u5c0f\u5199\u654f\u611f, \u9ed8\u8ba4\u503c\u4e3a localhost:8761/eureka) \u5c5e\u6027, \u7528\u6765\u5b9a\u4f4d server \u5730\u5740, \u7136\u540e @EnableDiscoveryClient // compared with @EnableEurekaClient, more comprehensive"),(0,l.kt)("p",null,"\u63d0\u4f9b\u670d\u52a1\u6ce8\u518c\u548c\u53d1\u73b0, Eureka\u7684\u5de5\u4f5c\u8fc7\u7a0b: "),(0,l.kt)("p",null,"\u6bcf\u4e2a service \u90fd\u5305\u542b\u4e00\u4e2a Eureka client \u7ec4\u4ef6, \u5c06 \u673a\u5668ip, \u76d1\u542c\u7aef\u53e3\u4e0a\u62a5\u7ed9 Eureka server, Eureka server \u4e2d\u4fdd\u5b58\u6709\u4e00\u4e2a\u6ce8\u518c\u8868, application name \u548c ip \u7aef\u53e3 \u4e00\u4e00\u5bf9\u5e94, Eureka client \u4f1a\u4ece Eureka server \u62c9\u53bb\u6ce8\u518c\u8868\u7f13\u5b58\u5728\u672c\u5730, "),(0,l.kt)("p",null,"\u6ce8\u518c\u4e2d\u5fc3\u662f\u6bd4\u8f83\u91cd\u8981\u7684\u57fa\u7840\u7ec4\u4ef6\uff0c \u4ec5\u4ec5\u4f7f\u7528\u201c\u5355\u70b9\u201d\u8fd8\u4e0d\u591f\uff0c \u66f4\u591a\u4f7f\u7528\u201c\u96c6\u7fa4\u201d\uff08\u901a\u8fc7\u8fd0\u884c\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u8fdb\u884c\u4e92\u76f8\u6ce8\u518c\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u9ad8\u53ef\u7528\u7684\u90e8\u7f72\uff09; "),(0,l.kt)("p",null,"\u81ea\u6211\u4fdd\u62a4\u673a\u5236: \u67d0\u4e00\u65f6\u523b\u6709\u5927\u91cf\u8282\u70b9\u7684\u5fc3\u8df3\u65e0\u6cd5\u88ab\u67d0\u4e2a eureka \u8282\u70b9\u63a5\u6536\u5230, eureka \u4f1a\u8ba4\u4e3a\u53d1\u751f\u4e86\u7f51\u7edc\u5206\u533a\u6545\u969c (\u6bd4\u5982 \u5ef6\u65f6 \u5361\u987f \u62e5\u6324), eureka \u4e0d\u4f1a\u7acb\u5373\u6e05\u9664\u8fd9\u4e9b\u8282\u70b9, \u800c\u662f\u4f1a\u4fdd\u6301\u4e00\u6bb5\u65f6\u95f4 (\u4fdd\u8bc1 ap, \u727a\u7272\u6389\u4e86 cp), "),(0,l.kt)("p",null,"\u63a7\u5236\u53f0\u663e\u793a\u4fe1\u606f\u4f18\u5316: \u9ed8\u8ba4 eureka \u63a7\u5236\u53f0 ui \u4e2d, \u5df2\u6ce8\u518c\u8282\u70b9 table \u7684 status \u5217\u4f1a\u663e\u793a\u4e3b\u673a\u540d, ",(0,l.kt)("inlineCode",{parentName:"p"},"eureka.instance.instance-id")," \u53ef\u4ee5\u5b9a\u5236\u663e\u793a\u7684 \u5b9e\u4f8b\u540d, \u4e00\u822c\u548c application name \u76f8\u540c\u6216\u8005\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"${spring.cloud.client.ip-address}:${server.port}"),", \u8fd8\u6709 ",(0,l.kt)("inlineCode",{parentName:"p"},"eureka.instance.prefer-ip-address=true"),"(\u8d85\u94fe\u63a5\u663e\u793a ip),  \u8fd9\u4e24\u4e2a\u90fd\u662f\u9488\u5bf9 eureka client \u7684\u914d\u7f6e"),(0,l.kt)("p",null,"\u91cd\u8981\u7684\u914d\u7f6e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-props"},"\n\n# server \n\n\n# \u81ea\u6211\u4fdd\u62a4\u6a21\u5f0f, default  true, \u82e5\u5e0c\u671b\u4fdd\u8bc1\u4e00\u81f4\u6027, \u4e0d\u8981\u53ef\u7528\u6027, \u53ef\u4ee5\u5173\u95ed\n# If set this to true, the registration info cannot be changed if register/remove frequently\neureka.server.enable-self-preservation: true\n\n# Remove invalid service instance info every xxx ms\n# \u7eed\u671f\u65f6\u95f4\uff0c\u5373\u626b\u63cf\u5931\u6548\u670d\u52a1\u7684\u95f4\u9694\u65f6\u95f4\uff08\u7f3a\u7701\u4e3a60*1000ms\uff09\neureka.server.eviction-interval-timer-in-ms: 6000\n\n# The time that server wait between two heartbeats, if the second heartbeat arrives late, then remove the instance\n# Have to > \u5ba2\u6237\u7aef\u7684 lease-renewal-interval-in-seconds\neureka.instance.lease-expiration-duration-in-seconds: 90 \n\n\n\n# client \n\n\n\n# \u8bbe\u7f6e\u662f\u5426\u5c06\u81ea\u5df1\u4f5c\u4e3a\u5ba2\u6237\u7aef\u6ce8\u518c\u5230\u6ce8\u518c\u4e2d\u5fc3\uff08\u7f3a\u7701true\uff09\n# \u5176\u5b9e\u67e5\u770b@EnableEurekaServer\u6ce8\u89e3\u7684\u6e90\u7801\uff0c\u4f1a\u53d1\u73b0\u5b83\u95f4\u63a5\u7528\u5230\u4e86@EnableDiscoveryClient\uff09, so server \u7aef\u65e0\u9700\u5f15\u5165 client \u4f9d\u8d56\neureka.client.register-with-eureka=true\n\n# \u9700\u8981\u6ce8\u518c\u5230\u7684\u5730\u5740 , serviceUrl \u662f\u4e00\u4e2a map, defaultZone \u65e0\u6cd5\u4f7f\u7528 '-', yml \u6587\u4ef6 map \u4e3a `{xxx: yyy}`, list \u4e3a `- xxx: yyy`\n# \u5982\u679c\u5355\u70b9\u5c31\u662f\u6ce8\u518c\u5230\u81ea\u5df1, \u9ad8\u53ef\u7528\u5c31\u9700\u8981\u914d\u7f6e\u4e3a\u6ce8\u518c\u5230\u522b\u7684 eureka \u8282\u70b9, \u6ce8\u518c\u5230\u591a\u4e2a eureka \u7528 `,` \u5206\u5f00\neureka.client.serviceUrl.defaultZone=http://localhost:${server.port}/eureka/\n\n# \u662f\u5426\u540c\u6b65\u5176\u4ed6\u5df2\u7ecf\u6ce8\u518c\u7684 service \u6570\u636e, \u5355\u70b9\u9700\u8981 false (default \u4e3a true, \u96c6\u7fa4\u5fc5\u987b\u4e3atrue, \u5426\u5219 ribbon\u4e0d\u53ef\u7528)\neureka.client.fetch-registry\n\n# depend on spring-boot-starter-actuator, default to true\neureka.client.health-check.enabled=true\n\n# fetch info from eureka server interval, default 30s (clients have an copy of registration info from server)\neureka.client.registry-fetch-interval-seconds=30\n\n# the Frequency that client send heartbeat to server, default 30s (\u5fc3\u8df3\u65f6\u95f4 / \u670d\u52a1\u7eed\u7ea6\u95f4\u9694\u65f6\u95f4)\neureka.instance.lease-renewal-interval-in-seconds=30\n\n# server \u5728\u53d7\u5230\u6700\u540e\u4e00\u6b21\u5fc3\u8df3\u540e\u7684\u7b49\u5f85\u65f6\u95f4 (default to 90s), \u8d85\u65f6\u5219\u5220\u9664\u8282\u70b9\neureka.instance.lease-expiration-duration-in-seconds=90\n\n# \u5b9a\u5236 ui \u9875\u4e2d\u7684 status \u5217\u663e\u793a\u4ec0\u4e48 (\u4e3b\u673a\u540d\u79f0:\u670d\u52a1\u540d\u79f0\u4fee\u6539)\neureka.instance.instance-id=xxx\n\n#  ui \u9875\u4e2d\u7684\u8bbf\u95ee\u8def\u5f84\u53ef\u4ee5\u663e\u793a ip \u5730\u5740\neureka.instance.prefer-id-address=true\n")),(0,l.kt)("p",null,"eureka \u96c6\u7fa4\u914d\u7f6e:"),(0,l.kt)("p",null,"\u4fee\u6539\u673a\u5668 hosts"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"127.0.0.1 eureka001.com\n127.0.0.1 eureka002.com\n127.0.0.1 eureka003.com\n\n")),(0,l.kt)("p",null,"\u4e3a eureka \u52a0\u4e0a\u5b89\u5168\u6821\u9a8c:"),(0,l.kt)("p",null,"\u5f15\u5165 ",(0,l.kt)("inlineCode",{parentName:"p"},"spring-boot-starter-security"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"security.user.name=\u4f60\u7684\u7528\u6237\u540d")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"security.user.password=\u4f60\u7684\u5bc6\u7801")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"eureka.client.serviceUrl.defaultZone=http://${security.user.name}:${security.user.password}@127.0.0.1:${server.port}/eureka/")),(0,l.kt)("h2",{id:"53-consul"},"5.3. consul"),(0,l.kt)("p",null,"\u529f\u80fd\u6bd4 Eureka \u591a (\u8fd8\u80fd\u505a \u914d\u7f6e\u4e2d\u5fc3, \u6d88\u606f\u603b\u7ebfbus), \u4f5c\u4e3a\u6ce8\u518c\u4e2d\u5fc3, \u533a\u522b\u5728\u4e8e: Eureka\u4fdd\u8bc1 AP (\u81ea\u6211\u4fdd\u62a4\u673a\u5236\u5bfc\u81f4 ap), Consul\u4e3aCP\u3002"),(0,l.kt)("p",null,"\u76ee\u524d\uff0cConsul  \u5df2\u7ecf\u53d6\u4ee3 Eureka \u6210\u4e3a Spring Cloud \u7684\u7f3a\u7701\u670d\u52a1\u6ce8\u518c\u53d1\u73b0\u7ec4\u4ef6"),(0,l.kt)("h2",{id:"54-zookeeper"},"5.4. zookeeper"),(0,l.kt)("p",null,"\u4e1a\u754c\u4f7f\u7528\u6682\u65f6\u4e0d\u591a, \u539f\u751f\u4e0d\u5e26 ui \u754c\u9762"),(0,l.kt)("h2",{id:"55-nacos-\u4f5c\u4e3a\u6ce8\u518c\u4e2d\u5fc3"},"5.5. nacos \u4f5c\u4e3a\u6ce8\u518c\u4e2d\u5fc3"),(0,l.kt)("p",null,"\u5b8c\u7f8e\u66ff\u4ee3 eureka"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://www.jianshu.com/p/6b6cf891ac6a"},"https://www.jianshu.com/p/6b6cf891ac6a"),"  \u6269\u5c55Ribbon\u652f\u6301Nacos\u6743\u91cd\u7684\u4e09\u79cd\u65b9\u5f0f todo"),(0,l.kt)("p",null,"\u4fee\u6539\u914d\u7f6e: (\u6570\u636e\u6e90, auth)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},'# \u6570\u636e\u5e93\u8fde\u63a5\u914d\u7f6e\uff0c\u539f\u6765\u8fd9\u4e09\u9879\u662f\u6ce8\u91ca\u4e86\u7684\uff0c\u53bb\u6389\u524d\u9762\u7684"#"\u53f7\n# \u6570\u636e\u5e93\u8fde\u63a5\u5730\u5740\u53ca\u6570\u636e\u5e93\u540d\u79f0\u6839\u636e\u81ea\u5df1\u5b9e\u9645\u60c5\u51b5\u4fee\u6539\ndb.url.0=jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useUnicode=true&useSSL=false&serverTimezone=UTC\n# \u6570\u636e\u5e93\u7684\u7528\u6237\u540d\u53ca\u5bc6\u7801\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u9645\u60c5\u51b5\u4fee\u6539\ndb.user.0=root\ndb.password.0=rootPassword\n\n# \u539f\u6765\u8be5\u914d\u7f6e\u7684\u4e3afalse\uff0c\u5f00\u542fnacos\u63a5\u5165\u9274\u6743\uff0c\u8fd9\u884c\u6700\u4e3a\u5173\u952e\nnacos.core.auth.enabled=true\n\n# \u5f53nacos.core.auth.enabled\u8bbe\u7f6e\u4e3atrue\u4e4b\u540e\uff0c\u4e0b\u9762\u4e24\u9879\u5fc5\u987b\u7ed9\u503c\uff0c\u539f\u6765\u7684\u4ee5\u4e0b\u4e24\u9879\u90fd\u6ca1\u6709\u503c\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u4e0b\u9762\u7684\u503c\uff0c\u4e0d\u62a5\u9519\nnacos.core.auth.server.identity.key=serverIdentity\nnacos.core.auth.server.identity.value=security\n\n# \u539f\u6765\u8fd9\u9879\u914d\u7f6e\u4e3a\u7a7a\uff0ckey\u8fd8\u5fc5\u987b\u4e3abase64\uff0c\u5c31\u7528\u4ee5\u4e0b\u8fd9\u4e2akey\u53ef\u4ee5\u4e0d\u62a5\u9519\nnacos.core.auth.plugin.nacos.token.secret.key=SecretKey012345678901234567890123456789012345678901234567890123456789\n')),(0,l.kt)("h2",{id:"56-etcd"},"5.6. etcd"),(0,l.kt)("p",null,"TODO golang \u5b9e\u73b0"),(0,l.kt)("h1",{id:"6-\u670d\u52a1\u76f8\u4e92\u8c03\u7528"},"6. \u670d\u52a1\u76f8\u4e92\u8c03\u7528"),(0,l.kt)("h2",{id:"61-\u624b\u52a8\u5b9e\u73b0\u8c03\u7528\u6846\u67b6"},"6.1. \u624b\u52a8\u5b9e\u73b0\u8c03\u7528\u6846\u67b6"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://zhuanlan.zhihu.com/p/29348799"},"https://zhuanlan.zhihu.com/p/29348799"),"\n",(0,l.kt)("a",{parentName:"p",href:"https://github.com/xwjie/MyRestUtil"},"https://github.com/xwjie/MyRestUtil")),(0,l.kt)("h2",{id:"62-feign"},"6.2. feign"),(0,l.kt)("p",null,"\u8fdb\u5165 maintenance, \u4e0d\u63a8\u8350\u4f7f\u7528"),(0,l.kt)("h2",{id:"63-openfeign"},"6.3. OpenFeign"),(0,l.kt)("p",null,"\u58f0\u660e\u5f0f\u7684rest client, \u5e95\u5c42\u662f\u901a\u8fc7 ribbon \u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861 (\u76f8\u5f53\u4e8e RestTemplate + ribbon)"),(0,l.kt)("p",null,"\u5305\u542b\u4e86 hystrix \u4f9d\u8d56"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4f7f\u7528feign\u65f6\u9ed8\u8ba4\u63d0\u4f9b\u4e86Ribbon \u7684load balancing")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4f7f\u7528 Feign \u65f6\u4e5f\u5f15\u5165\u4e86 hystrix, \u9ed8\u8ba4\u4e0d\u5f00\u542f (hystrix \u4e00\u822c\u662f\u4f5c\u7528\u5728\u670d\u52a1\u8c03\u7528\u5373\u5ba2\u6237\u7aef\u8fd9\u4e00\u7aef, \u4e5f\u5c31\u662f\u5e38\u5e38\u548cFeign\u4e00\u8d77\u4f7f\u7528)")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4e00\u4e2aclient \u5c31\u662f\u4e00\u4e2a\u63a5\u53e3, feign \u9488\u5bf9\u8fd9\u4e2a\u63a5\u53e3\u5b9e\u73b0\u4e86\u4ee3\u7406\u7c7b (\u52a8\u6001\u4ee3\u7406)"))),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"}," @EnableFeignClients")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"@FeignClient"),"(also support 'url', \u7528\u4e8e\u65e0 eureka \u7684\u60c5\u51b5; fallback \u4e3a class type , \u662f\u5f53\u524d client interface \u7684\u5b9e\u73b0\u7c7b, \u9700\u8981 @component, \u5728\u5b9e\u73b0\u7684\u65b9\u6cd5\u4e2d\u505a\u964d\u7ea7\u56de\u8c03\u903b\u8f91, configuration \u5f53\u524d feign client \u7684\u914d\u7f6e\u7c7b,\u53ef\u4ee5\u81ea\u5b9a\u4e49Feign\u7684Encoder\u3001Decoder\u3001LogLevel\u3001Contract ; path: \u5b9a\u4e49\u5f53\u524dFeignClient\u7684\u7edf\u4e00\u524d\u7f00)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-props"},"# enable hystrix support, default to false, \u4e5f\u53ef\u4ee5\u4f7f\u7528 @EnableCircuitBreaker \nfeign.hystrix.enabled: true\n")),(0,l.kt)("h3",{id:"631-\u57fa\u672c\u4f7f\u7528"},"6.3.1. \u57fa\u672c\u4f7f\u7528"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"\n\n")),(0,l.kt)("h3",{id:"632-\u8d85\u65f6\u7efc\u5408\u914d\u7f6e"},"6.3.2. \u8d85\u65f6\u7efc\u5408\u914d\u7f6e"),(0,l.kt)("p",null,"\u5404\u79cd\u8d85\u65f6\u914d\u7f6e\uff0c\u5982\u679c\u90fd\u5b58\u5728\uff0c\u5219\u65f6\u95f4\u5c0f\u7684\u914d\u7f6e\u751f\u6548"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-props"},"\u6700\u5e38\u7528\u7684\u914d\u7f6e\u914d\u7f6e\u539f\u5219:\n1 \u5f00\u542fFeign\u7684hystrix\u5f00\u5173\n2 hystrix\u8d85\u65f6\u65f6\u957f\n3 \u914d\u7f6eribbon\u7684ConnectTimeout\u65f6\u957f\n4 \u914d\u7f6eribbon\u7684ReadTimeout \u65f6\u957f\n\n\n\n# hystrix\u53ef\u914d\u7f6e\u7684\u90e8\u5206 (feign \u9ed8\u8ba4 \u5173\u95ed hystrix)\n\nhystrix.command.default.execution.timeout.enable=true //\u4e3afalse\u5219\u8d85\u65f6\u63a7\u5236\u6709ribbon\u63a7\u5236\uff0c\u4e3atrue\u5219hystrix\u8d85\u65f6\u548cribbon\u8d85\u65f6\u90fd\u662f\u7528\uff0c\u4f46\u662f\u8c01\u5c0f\u8c01\u751f\u6548\uff0c\u9ed8\u8ba4\u4e3atrue\nhystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=3000//\u7194\u65ad\u5668\u7684\u8d85\u65f6\u65f6\u957f\u9ed8\u8ba41\u79d2\uff0c\u6700\u5e38\u4fee\u6539\u7684\u53c2\u6570\ncircuitBreaker.requestVolumeThreshold=20 //\u89e6\u53d1\u7194\u65ad\u7684\u6700\u5c0f\u8bf7\u6c42\u6b21\u6570\uff0c\u9ed8\u8ba4\u4e3a20\ncircuitBreaker.sleepWindowInMilliseconds=5000 //\u4f11\u7720\u65f6\u957f\uff0c\u9ed8\u8ba4\u4e3a5\u79d2\ncircuitBreaker.errorThresholdPercentage=50 //\u89e6\u53d1\u7194\u65ad\u7684\u5931\u8d25\u8bf7\u6c42\u6700\u5c0f\u5360\u6bd4\uff0c\u9ed8\u8ba450%\n\n\n# ribbon\u7684\u53ef\u914d\u7f6e\u90e8\u5206\n\nribbon.ReadTimeout=1000 //\u5904\u7406\u8bf7\u6c42\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a1\u79d2\nribbon.ConnectTimeout=1000 //\u8fde\u63a5\u5efa\u7acb\u7684\u8d85\u65f6\u65f6\u957f\uff0c\u9ed8\u8ba41\u79d2\nribbon.MaxAutoRetries=1 //\u540c\u4e00\u53f0\u5b9e\u4f8b\u7684\u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0c\u4f46\u662f\u4e0d\u5305\u62ec\u9996\u6b21\u8c03\u7528\uff0c\u9ed8\u8ba4\u4e3a1\u6b21\nribbon.MaxAutoRetriesNextServer=0 //\u91cd\u8bd5\u8d1f\u8f7d\u5747\u8861\u5176\u4ed6\u5b9e\u4f8b\u7684\u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0c\u4e0d\u5305\u62ec\u9996\u6b21\u8c03\u7528\uff0c\u9ed8\u8ba4\u4e3a0\u6b21\nribbon.OkToRetryOnAllOperations=false //\u662f\u5426\u5bf9\u6240\u6709\u64cd\u4f5c\u90fd\u91cd\u8bd5\uff0c\u9ed8\u8ba4false\n\n\n# Feign\u7684\u53ef\u914d\u7f6e\u90e8\u5206\n\nfeign.hystrix.enabled=false //Feign\u662f\u5426\u542f\u7528\u65ad\u8def\u5668,\u9ed8\u8ba4\u4e3afalse\n# default\u4e3a\u5168\u5c40\u914d\u7f6e\uff0c\u5982\u679c\u8981\u5355\u72ec\u914d\u7f6e\u6bcf\u4e2a\u670d\u52a1\uff0c\u6539\u4e3a\u670d\u52a1\u540d\nfeign.client.config.default.connectTimeout=10000 //Feign\u7684\u8fde\u63a5\u5efa\u7acb\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a10\u79d2\nfeign.client.config.default.readTimeout=60000 //Feign\u7684\u8bf7\u6c42\u5904\u7406\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a60s\nfeign.client.config.default.retryer=feign.Retryer.Default //Feign\u4f7f\u7528\u9ed8\u8ba4\u7684\u8d85\u65f6\u914d\u7f6e\uff0c\u5728\u8be5\u7c7b\u6e90\u7801\u4e2d\u53ef\u89c1\uff0c\u9ed8\u8ba4\u5355\u6b21\u8bf7\u6c42\u6700\u5927\u65f6\u957f1\u79d2\uff0c\u91cd\u8bd55\u6b21\n")),(0,l.kt)("h3",{id:"633-feign-client-interceptor"},"6.3.3. feign client interceptor"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class FeignBasicAuthRequestInterceptor implements RequestInterceptor {\n\n    private static final Logger logger = LoggerFactory.getLogger(FeignBasicAuthRequestInterceptor.class);\n\n    @Override\n    public void apply(RequestTemplate requestTemplate) {\n        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder\n                .getRequestAttributes();\n        HttpServletRequest request = attributes.getRequest();\n        Enumeration<String> headerNames = request.getHeaderNames();\n        if (headerNames != null) {\n            while (headerNames.hasMoreElements()) {\n                String name = headerNames.nextElement();\n                String values = request.getHeader(name);\n                requestTemplate.header(name, values);\n            }\n        }\n        Enumeration<String> bodyNames = request.getParameterNames();\n        StringBuffer body =new StringBuffer();\n        if (bodyNames != null) {\n            while (bodyNames.hasMoreElements()) {\n                String name = bodyNames.nextElement();\n                String values = request.getParameter(name);\n                body.append(name).append("=").append(values).append("&");\n            }\n        }\n        if(body.length()!=0) {\n            body.deleteCharAt(body.length()-1);\n            requestTemplate.body(body.toString());\n            logger.info("feign interceptor body:{}",body.toString());\n        }\n    }\n}\n\n\n\u914d\u7f6e \u8ba9\u6240\u6709 FeignClient\uff0c\u4f7f\u7528 FeignBasicAuthRequestInterceptor\n\nfeign:\n  client:\n    config:\n      default:\n        connectTimeout: 5000\n        readTimeout: 5000\n        loggerLevel: basic\n        requestInterceptors: com.leparts.config.FeignBasicAuthR\n\n\n\u4e5f\u53ef\u4ee5\u914d\u7f6e\u8ba9 \u67d0\u4e2a FeignClient \u4f7f\u7528\u8fd9\u4e2a FeignBasicAuthRequestInterceptor\n\nfeign:\n  client:\n    config:\n      xxxx: # \u8fdc\u7a0b\u670d\u52a1\u540d\n        connectTimeout: 5000\n        readTimeout: 5000\n        loggerLevel: basic\n        requestInterceptors: com.leparts.config.FeignBasicAuthR\n\n\n\u5728\u8f6c\u53d1Feign\u7684\u8bf7\u6c42\u5934\u7684\u65f6\u5019, \u5982\u679c\u5f00\u542f\u4e86Hystrix, Hystrix\u7684\u9ed8\u8ba4\u9694\u79bb\u7b56\u7565\u662fThread(\u7ebf\u7a0b\u9694\u79bb\u7b56\u7565), \u56e0\u6b64\u8f6c\u53d1\u62e6\u622a\u5668\u5185\u662f\u65e0\u6cd5\u83b7\u53d6\u5230\u8bf7\u6c42\u7684\u8bf7\u6c42\u5934\u4fe1\u606f\u7684\u3002\n\u53ef\u4ee5\u81ea\u5b9a\u4e49 hystrix \u9694\u79bb\u7b56\u7565\n')),(0,l.kt)("h3",{id:"634-\u65e5\u5fd7\u914d\u7f6e"},"6.3.4. \u65e5\u5fd7\u914d\u7f6e"),(0,l.kt)("p",null,"\u4e86\u89e3 http \u8bf7\u6c42\u7ec6\u8282"),(0,l.kt)("p",null,"\u65e5\u5fd7\u7ea7\u522b:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"none: \u9ed8\u8ba4, \u4e0d\u663e\u793a\u65e5\u5fd7")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"basic \u4ec5\u4ec5\u8bb0\u5f55\u8bf7\u6c42\u65b9\u6cd5, url, response status code, \u54cd\u5e94\u65f6\u95f4")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"headers: \u589e\u52a0\u4e86 header \u4fe1\u606f")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"full: \u589e\u52a0\u4e86 \u8bf7\u6c42\u54cd\u5e94\u4f53"))),(0,l.kt)("p",null,"\u914d\u7f6e\u7c7b\u4e2d\u589e\u52a0"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\nclass FeignConfig {\n\n    @Bean\n    public Logger.Level feignLoggerLevel() {\n        return Logger.Level.FULL;\n    }\n}\n\n")),(0,l.kt)("p",null,"\u7136\u540e\u914d\u7f6e\u6587\u4ef6\u4e2d, \u6307\u5b9a\u76d1\u63a7\u7684 feign client \u63a5\u53e3\u4ee5\u53ca\u65e5\u5fd7\u7ea7\u522b ",(0,l.kt)("inlineCode",{parentName:"p"},"logging.level.io.github.xiaoyu.xxx.ReservationResource=debug")),(0,l.kt)("h3",{id:"635-feign-client-\u5728\u751f\u4ea7\u8005\u7aef\u8fd8\u662f\u5728\u6d88\u8d39\u8005\u7aef\u5b9a\u4e49"},"6.3.5. feign Client \u5728\u751f\u4ea7\u8005\u7aef\u8fd8\u662f\u5728\u6d88\u8d39\u8005\u7aef\u5b9a\u4e49"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'\u5728\u751f\u4ea7\u7aefAPI\u4e2d\u58f0\u660eFeign\u5ba2\u6237\u7aef (\u6d88\u8d39\u7aef\u670d\u52a1\u76f4\u63a5\u4f9d\u8d56\u751f\u4ea7\u7aef\u63d0\u4f9b\u7684API\u5305\uff0c\u7136\u540e\u901a\u8fc7@Autowired\u6ce8\u89e3\u6ce8\u5165\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u751f\u4ea7\u8005\u63d0\u4f9b\u7684\u63a5\u53e3)\n\n  \u597d\u5904 \u662f\uff1a\u7b80\u5355\u65b9\u4fbf\uff0c\u6d88\u8d39\u7aef\u76f4\u63a5\u4f7f\u7528\u751f\u4ea7\u8005\u63d0\u4f9b\u7684Feign\u63a5\u53e3\u5373\u53ef\u3002\n\n  \u574f\u5904 \u4e5f\u5f88\u660e\u663e: \n\n    \u7194\u65ad\u964d\u7ea7\u7c7b\u4e5f\u5728\u751f\u4ea7\u7aef, \u65e0\u6cd5\u81ea\u5b9a\u4e49\n\n    \u6d88\u8d39\u7aef\u5728\u8c03\u7528\u65f6\u7531\u4e8e\u5305\u8def\u5f84\u53ef\u80fd\u4e0e\u751f\u4ea7\u8005\u4e0d\u4e00\u6837\uff0c\u5fc5\u987b\u8981\u901a\u8fc7@SpringBootApplication(scanBasePackages = {"com.javadaily.feign"})\u626b\u63cfFeign\u7684\u8def\u5f84\uff0c\u5f53\u6d88\u8d39\u7aef\u9700\u8981\u5f15\u5165\u5f88\u591a\u751f\u4ea7\u8005Feign\u65f6\u90a3\u5c31\u9700\u8981\u626b\u63cf\u5f88\u591a\u4e2a\u63a5\u53e3\u8def\u5f84\u3002\n\n\u5728\u6d88\u8d39\u7aef\u58f0\u660eFeign\u5ba2\u6237\u7aef (\u63a8\u8350)\n\n  \u597d\u5904 \u662f\uff1a\u5ba2\u6237\u7aef\u53ef\u4ee5\u6309\u9700\u7f16\u5199\u81ea\u5df1\u9700\u8981\u7684\u63a5\u53e3\uff0c\u7194\u65ad\u964d\u7ea7\u90fd\u7531\u6d88\u8d39\u8005\u63a7\u5236\uff1b\u4e0d\u9700\u8981\u5728\u542f\u52a8\u7c7b\u4e0a\u52a0\u5165\u989d\u5916\u7684\u626b\u63cf\u6ce8\u89e3scanBasePackages\u3002\n\n  \u574f\u5904 \u662f\uff1a\u6d88\u8d39\u7aef\u4ee3\u7801\u5197\u4f59\uff0c\u6bcf\u4e2a\u6d88\u8d39\u8005\u90fd\u9700\u8981\u7f16\u5199Feign\u5ba2\u6237\u7aef\uff1b\u670d\u52a1\u95f4\u8026\u5408\u6bd4\u8f83\u7d27\uff0c\u4fee\u6539\u4e00\u5904\u63a5\u53e3\u4e09\u5904\u90fd\u8981\u4fee\u6539\u3002\n\n')),(0,l.kt)("h1",{id:"7-\u8d1f\u8f7d\u5747\u8861"},"7. \u8d1f\u8f7d\u5747\u8861"),(0,l.kt)("h2",{id:"71-\u96c6\u4e2d\u5f0f\u8d1f\u8f7d\u5747\u8861\u548c\u5ba2\u6237\u7aef\u8d1f\u8f7d\u5747\u8861"},"7.1. \u96c6\u4e2d\u5f0f\u8d1f\u8f7d\u5747\u8861\u548c\u5ba2\u6237\u7aef\u8d1f\u8f7d\u5747\u8861"),(0,l.kt)("p",null,"\u5728 consumer \u548c provider \u95f4\u4f7f\u7528\u72ec\u7acb\u7684\u8bbe\u65bd, \u5982 nginx, \u5c06\u8bf7\u6c42\u4ee5\u67d0\u79cd\u7b56\u7565\u8fdb\u884c\u5206\u53d1, \u53d1\u9001\u5230\u591a\u4e2a provider \u5b9e\u4f8b "),(0,l.kt)("p",null,"\u4e0b\u9762\u90fd\u662f client side LoadBalance"),(0,l.kt)("h2",{id:"72-ribbon"},"7.2. ribbon"),(0,l.kt)("p",null,"\u8fdb\u5165  maintenance, \u4f46\u662f spring cloud \u5b98\u65b9\u8fd8\u5728\u7528, \u53ea\u662f\u65e5\u5fd7\u4e2d\u4f1a\u63a8\u8350\u4f7f\u7528 spring cloud loadbalancer"),(0,l.kt)("p",null,"\u6216\u8005\u53eb \u8fdb\u7a0b\u5f0f\u8d1f\u8f7d\u5747\u8861, \u5c31\u662f \u5c06 \u8d1f\u8f7d\u5747\u8861\u903b\u8f91\u96c6\u6210\u5230consumer, consumer\u4ece\u6ce8\u518c\u4e2d\u5fc3\u7684 client \u7aef\u83b7\u77e5\u6709\u90a3\u4e9b\u5730\u5740\u53ef\u4ee5\u7528,\u7136\u540e\u81ea\u5df1\u518d\u4ece\u8fd9\u4e9b\u5730\u5740\u4e2d\u9009\u62e9\u51fa\u4e00\u4e2a\u5408\u9002\u7684 provider"),(0,l.kt)("p",null,"Ribbon: (client side) load balancing; ribbon\u53ef\u4ee5\u5c06\u8bf7\u6c42\u5747\u5300\u7684\u5206\u914d\u5230\u5404\u4e2a\u673a\u5668\u4e0a, \u5fc5\u987b\u548c \u6ce8\u518c\u4e2d\u5fc3\u4e00\u8d77\u4f7f\u7528 (eureka client \u4f9d\u8d56\u5305\u542b\u4e86 ribbon \u4f9d\u8d56)"),(0,l.kt)("h3",{id:"721-\u5982\u4f55\u4f7f\u7528-ribbon"},"7.2.1. \u5982\u4f55\u4f7f\u7528 ribbon"),(0,l.kt)("p",null,"\u4e00\u79cd\u65b9\u6cd5\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"@LoadBalanced ")," + restTemplate:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@SpringBootApplication\n@EnableDiscoveryClient\n@RestController\npublic class RibbonDemoApplication {\n\n    @Autowired\n    private RestTemplate restTemplate;\n\n    @GetMapping("/hello")\n    public String hello() {\n        //Spring Cloud Ribbon\u6709\u4e00\u4e2a\u62e6\u622a\u5668\uff0c\u5b83\u80fd\u591f\u5728\u8fd9\u91cc\u8fdb\u884c\u5b9e\u9645\u8c03\u7528\u7684\u65f6\u5019\uff0c\u81ea\u52a8\u7684\n        // \u53bb\u9009\u53d6\u670d\u52a1\u5b9e\u4f8b\uff0c\u5e76\u5c06\u5b9e\u9645\u8981\u8bf7\u6c42\u7684IP\u5730\u5740\u548c\u7aef\u53e3\u66ff\u6362\u8fd9\u91cc\u7684\u670d\u52a1\u540d\n        return restTemplate.getForObject("http://eureka-single-client/hah", String.class);\n    }\n\n\n    public static void main(String[] args) {\n        SpringApplication.run(RibbonDemoApplication.class, args);\n    }\n\n    @Bean\n    @LoadBalanced  // ribbon\n    public RestTemplate restTemplate() {\n        return new RestTemplate();\n    }\n\n}\n')),(0,l.kt)("p",null,"\u8fd8\u6709\u4e00\u79cd\u5c31\u662f \u914d\u5408 openFeign: (\u63a8\u8350)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@FeignClient("reservation-service")\n        // also support \'url\' ( outside eureka)\ninterface ReservationResources {\n\n    @RequestMapping("/reservations")\n    CollectionModel<Reservation> reservations();\n\n    @RequestMapping("/message")\n    String message();\n}\n')),(0,l.kt)("h3",{id:"722-\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5"},"7.2.2. \u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5"),(0,l.kt)("p",null,"ribbon \u63d0\u4f9b\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u9ed8\u8ba4\u4f7f\u7528Round Robin\u8f6e\u8be2\u7b97\u6cd5 (\u8bf7\u6c42\u5c06\u4f9d\u6b21\u5206\u53d1\u52301~n\u53f0\u673a\u5668, \u5982\u679c\u8fd8\u6ca1\u5206\u53d1\u5b8c, \u518d\u6b21\u4ece\u7b2c\u4e00\u53f0\u673a\u5668\u5f00\u59cb\u5faa\u73af); "),(0,l.kt)("p",{parentName:"li"},"\u7b97\u6cd5\u5b9e\u73b0: \u6bcf\u6b21\u8ba1\u7b97\u51fa instance index \u540e\u90fd\u5bf9\u5176\u8fdb\u884c\u8bb0\u5f55, \u4e0b\u4e00\u6b21\u8bf7\u6c42\u8fc7\u6765\u5728\u4e0a\u6b21 index \u57fa\u7840\u4e0a\u589e\u52a0\u4e00, \u5982\u679c\u4e0b\u6807\u8d85\u51fa instance \u4e2a\u6570, \u4f7f\u7528 instance count \u53d6\u4f59")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u54cd\u5e94\u65f6\u95f4\u6743\u91cd\u7b97\u6cd5, \u5373\u6839\u636e\u6bcf\u4e2a provider \u7684 response time \u4e3a\u8be5 provider \u5b9e\u4f8b\u5206\u914d\u4e00\u4e2a\u6743\u91cd, response time \u8d8a\u957f, \u6743\u91cd\u8d8a\u5c0f, \u88ab\u9009\u4e2d\u7684\u51e0\u7387\u8d8a\u4f4e")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u968f\u673a")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u6700\u5c11\u5e76\u53d1\u6570\u7b56\u7565: \u9009\u62e9\u8fd9\u6837\u7684 provider, \u5b83\u7684\u6b63\u5728\u5904\u7406\u7684\u5e76\u53d1\u6570\u6700\u5c11, \u5e76\u4e14\u8fd9\u4e2a provider \u6ca1\u6709\u5904\u4e8e\u7194\u65ad\u4e2d"))),(0,l.kt)("p",null,"\u5982\u4f55\u66ff\u6362 ribbon \u63d0\u4f9b\u7684\u7b97\u6cd5, \u505a\u4e2a\u6027\u5316\u914d\u7f6e? "),(0,l.kt)("p",null,"\u81ea\u5b9a\u4e49\u4e00\u4e2a \u914d\u7f6e\u7c7b, \u5c06 \u9009\u5b9a\u7684 \u89c4\u5219 bean \u6ce8\u5165 spring, ",(0,l.kt)("inlineCode",{parentName:"p"},'@RibbonClient(name = "target-service", configuration = {RibbonRuleConfig.class})')," (\u610f\u601d\u662f\u5bf9\u540d\u4e3a target-service \u7684\u670d\u52a1\u7aef\u4ee5 RibbonRuleConfig \u4e2d\u914d\u7f6e\u7684\u7b56\u7565\u505a\u8d1f\u8f7d\u5747\u8861, \u5373 service \u548c rule \u7684\u6620\u5c04)"),(0,l.kt)("p",null,"\u81ea\u5b9a\u4e49 ribbon \u914d\u7f6e\u7c7b\u4e0d\u8981\u653e\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"@componentScan")," \u626b\u7684 package \u4e0b, \u5426\u5219\u8fd9\u4e2a\u81ea\u5b9a\u4e49\u914d\u7f6e\u4e2d\u7684 rule bean \u4f1a\u88ab\u6240\u6709 ribbon client \u5171\u4eab"),(0,l.kt)("p",null,"\u5206\u6790 ",(0,l.kt)("inlineCode",{parentName:"p"},"RoundRobinRule")," \u6e90\u7801:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public Server choose(ILoadBalancer lb, Object key) {\n    if (lb == null) {\n        log.warn("no load balancer");\n        return null;\n    }\n\n    Server server = null;\n    int count = 0;\n    // \u4ece loadBalancer \u83b7\u53d6 allServer, \u91cd\u8bd5 10 \u6b21\n    while (server == null && count++ < 10) {\n        List<Server> reachableServers = lb.getReachableServers();\n        List<Server> allServers = lb.getAllServers();\n        int upCount = reachableServers.size();\n        int serverCount = allServers.size();\n\n        if ((upCount == 0) || (serverCount == 0)) {\n            log.warn("No up servers available from load balancer: " + lb);\n            return null;\n        }\n\n        int nextServerIndex = incrementAndGetModulo(serverCount);\n        server = allServers.get(nextServerIndex);\n\n        if (server == null) {\n            /* Transient. */\n            Thread.yield();\n            continue;\n        }\n\n        if (server.isAlive() && (server.isReadyToServe())) {\n            return (server);\n        }\n\n        // Next.\n        server = null;\n    }\n\n    if (count >= 10) {\n        log.warn("No available alive servers after 10 tries from load balancer: "\n                + lb);\n    }\n    return server;\n}\n\n\n/**\n  * Inspired by the implementation of {@link AtomicInteger#incrementAndGet()}.\n  *\n  * @param modulo The modulo to bound the value of the counter.\n  * @return The next value.\n  */\nprivate int incrementAndGetModulo(int modulo) {\n    // cas + \u81ea\u65cb\n    // nextServerCyclicCounter \u662f\u4e0a\u6b21\u9009\u4e2d\u7684 instance index\n    for (;;) {\n        int current = nextServerCyclicCounter.get();\n        int next = (current + 1) % modulo;\n        if (nextServerCyclicCounter.compareAndSet(current, next))\n            return next;\n    }\n}\n\n')),(0,l.kt)("h2",{id:"73-spring-cloud-loadbalancer"},"7.3. spring cloud loadBalancer"),(0,l.kt)("p",null,"Spring Cloud Load Balancer\u5e76\u4e0d\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u9879\u76ee\uff0c\u800c\u662fspring-cloud-commons\u5176\u4e2d\u7684\u4e00\u4e2a\u6a21\u5757\n\u9879\u76ee\u4e2d\u7528\u4e86Eureka\u4ee5\u53ca\u76f8\u5173\u7684 starter\uff0c\u60f3\u5b8c\u5168\u5254\u9664Ribbon\u7684\u76f8\u5173\u4f9d\u8d56\u57fa\u672c\u662f\u4e0d\u53ef\u80fd\u7684\uff0cSpring \u793e\u533a\u7684\u4eba\u4e5f\u662f\u770b\u5230\u4e86\u8fd9\u4e00\u70b9\uff0c\u6240\u4ee5\u7ed9\u51fa\u7684\u505a\u6cd5\u662f: \u901a\u8fc7\u914d\u7f6e",(0,l.kt)("inlineCode",{parentName:"p"},"spring.cloud.loadbalancer.ribbon.enabled=false"),"\u53bb\u5173\u95edRibbon, \u81ea\u52a8\u5c31\u542f\u7528\u4e86 Spring-Cloud-LoadBalancer, \u6210\u4e3a\u9ed8\u8ba4\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u3002 (",(0,l.kt)("a",{parentName:"p",href:"https://www.yht7.com/news/92837"},"https://www.yht7.com/news/92837"),")"),(0,l.kt)("h1",{id:"8-\u7194\u65ad\u5668"},"8. \u7194\u65ad\u5668"),(0,l.kt)("h2",{id:"81-hystrix"},"8.1. hystrix"),(0,l.kt)("p",null,"\u8fdb\u5165 maintenance, \u4f46\u662f\u8bbe\u8ba1\u7406\u5ff5\u503c\u5f97\u5b66\u4e60"),(0,l.kt)("h3",{id:"811-hystrix-\u539f\u7406"},"8.1.1. hystrix \u539f\u7406"),(0,l.kt)("p",null,"Hystrix: \u9694\u79bb, \u7194\u65ad(\u9632\u6b62\u6545\u969c\u6269\u6563, ",(0,l.kt)("a",{parentName:"p",href:"https://martinfowler.com/bliki/CircuitBreaker.html"},"circuit breaker"),"), \u964d\u7ea7, \u9650\u6d41, \u5b9e\u65f6\u7684\u76d1\u63a7"),(0,l.kt)("p",null,"\u4e3a\u4ec0\u4e48\u9700\u8981 CircuitBreaker? \u9632\u6b62 cascading failure (\u670d\u52a1\u96ea\u5d29)"),(0,l.kt)("p",null,"\u670d\u52a1\u96ea\u5d29\u6548\u5e94: \u5728\u4e00\u4e2a micro service system \u91cc, \u4f1a\u6d89\u53ca\u5230\u670d\u52a1\u7684 \u7ea7\u8054\u8c03\u7528, \u5982\u679c\u4e0b\u6e38\u7684 service \u5f02\u5e38, \u4e0a\u6e38\u7684 service \u4e5f\u4f1a\u5361\u4f4f(\u7136\u540e\u8d85\u65f6\u5f02\u5e38), \u4e0a\u6e38 service \u5361\u4f4f\u7684\u8bf7\u6c42\u591a\u4e86 \u7ebf\u7a0b\u7b49\u8d44\u6e90\u4f1a\u8017\u5c3d, \u8fdb\u800c\u8fd9\u4e2a\u4e0a\u6e38 service \u4e5f\u4f1a\u5f02\u5e38, \u7531\u4e8e\u8fde\u9501\u53cd\u5e94, \u6700\u540e\u6574\u6761\u8c03\u7528\u94fe\u4e0a\u7684\u670d\u52a1\u90fd\u4f1a\u5f02\u5e38; ",(0,l.kt)("inlineCode",{parentName:"p"},"\u800c\u5b9e\u9645\u4e0a\u4e0a\u6e38 service \u662f\u53ef\u4ee5\u5728\u4e0b\u6e38 service \u6302\u6389\u540e\u5355\u72ec\u63d0\u4f9b\u670d\u52a1\u7684, \u6bd4\u5982 \u8ba2\u5355\u670d\u52a1 \u548c \u79ef\u5206\u670d\u52a1")),(0,l.kt)("p",null,"hystrix \u662f \u7194\u65ad\u5668\u7684\u4e00\u4e2a\u5b9e\u73b0, \u6d88\u8d39\u4fa7,\u670d\u52a1\u4fa7\u90fd\u53ef\u4f7f\u7528"),(0,l.kt)("p",null,"\u7194\u65ad\u5668\uff08CircuitBreaker\uff09: (\u7194\u65ad\u5668\u6a21\u5f0f\u5c31\u50cf\u662f\u90a3\u4e9b\u5bb9\u6613\u5bfc\u81f4\u9519\u8bef\u7684\u64cd\u4f5c\u7684\u4e00\u79cd\u4ee3\u7406\u3002\u8fd9\u79cd\u4ee3\u7406\u80fd\u591f\u8bb0\u5f55\u6700\u8fd1\u8c03\u7528\u53d1\u751f\u9519\u8bef\u7684\u6b21\u6570\uff0c\u7136\u540e\u51b3\u5b9a\u4f7f\u7528\u5141\u8bb8\u64cd\u4f5c\u7ee7\u7eed\uff0c\u6216\u8005\u7acb\u5373\u8fd4\u56de\u9519\u8bef) \u7194\u65ad\u5668\u5c31\u662f\u4fdd\u62a4\u670d\u52a1\u9ad8\u53ef\u7528\u7684\u6700\u540e\u4e00\u9053\u9632\u7ebf\u3002"),(0,l.kt)("p",null,"\u539f\u7406: \u5f53\u524d service \u8c03\u7528\u5176\u4ed6\u4e0d\u540c\u7684 service, \u90fd\u6709\u4e00\u4e2a\u72ec\u7acb\u7684 thread pool (",(0,l.kt)("inlineCode",{parentName:"p"},"\u9694\u79bb"),"), \u9632\u6b62\u7ebf\u7a0b\u8d44\u6e90\u7531\u4e8e\u67d0\u4e2a service \u6545\u969c\u800c\u88ab\u8017\u5c3d; \u5c06\u51fd\u6570\u8c03\u7528\u5305\u88c5\u5728\u4e00\u4e2a circuit breaker \u5bf9\u8c61\u4e2d, \u5bf9\u8c03\u7528\u5931\u8d25\u6b21\u6570\u8fdb\u884c\u76d1\u63a7, \u8fbe\u5230\u8bbe\u5b9a\u7684\u9608\u503c, \u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u800c\u4e0d\u8bbf\u95ee\u539f\u59cb\u51fd\u6570 (",(0,l.kt)("inlineCode",{parentName:"p"},"\u7194\u65ad"),"), \u540c\u65f6\u6709\u4e00\u4e2a\u56de\u8c03\u51fd\u6570, \u8fdb\u884c\u989d\u5916\u52a8\u4f5c(",(0,l.kt)("inlineCode",{parentName:"p"},"\u964d\u7ea7"),")"),(0,l.kt)("p",null,"\u7194\u65ad\u53ea\u662f\u4f5c\u7528\u5728\u670d\u52a1\u8c03\u7528\u8fd9\u4e00\u7aef(consumer \u7ec4\u4ef6\u7aef)"),(0,l.kt)("p",null,"Hystrix\u7279\u6027:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7194\u65ad\u673a\u5236 : \u5f53Hystrix Command\u8bf7\u6c42\u540e\u7aef\u670d\u52a1\u5931\u8d25\u6570\u91cf\u8d85\u8fc7\u4e00\u5b9a\u6bd4\u4f8b(",(0,l.kt)("inlineCode",{parentName:"p"},"\u9ed8\u8ba450%"),"), \u65ad\u8def\u5668\u4f1a\u5207\u6362\u5230\u5f00\u8def\u72b6\u6001(Open). \u8fd9\u65f6\u6240\u6709\u8bf7\u6c42\u4f1a\u76f4\u63a5\u5931\u8d25\u800c\u4e0d\u4f1a\u53d1\u9001\u5230\u540e\u7aef\u670d\u52a1, \u5728\u4e00\u4e2a \u65f6\u95f4\u7a97\u53e3\u671f\u5185 (\u9ed8\u8ba4 5s) , fallback \u6210\u4e3a\u4e3b\u903b\u8f91, \u5f53\u4f11\u7720\u65f6\u95f4\u7a97\u5230\u671f, , \u81ea\u52a8\u5207\u6362\u5230\u534a\u5f00\u8def\u72b6\u6001(HALF-OPEN). \u8fd9\u65f6\u4f1a\u5224\u65ad\u4e0b\u4e00\u6b21\u8bf7\u6c42\u7684\u8fd4\u56de\u60c5\u51b5, \u5982\u679c\u8bf7\u6c42\u6210\u529f, \u65ad\u8def\u5668\u5207\u56de\u95ed\u8def\u72b6\u6001(CLOSED), \u5426\u5219\u91cd\u65b0\u5207\u6362\u5230\u5f00\u8def\u72b6\u6001(OPEN), \u65f6\u95f4\u7a97\u91cd\u65b0\u8ba1\u65f6. ")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Fallback: \u964d\u7ea7\u64cd\u4f5c. "),(0,l.kt)("p",{parentName:"li"},"\u5bf9\u4e8e\u67e5\u8be2\u64cd\u4f5c, \u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2afallback\u65b9\u6cd5, \u5f53\u8bf7\u6c42\u540e\u7aef\u670d\u52a1\u51fa\u73b0\u5f02\u5e38\u7684\u65f6\u5019, \u53ef\u4ee5\u4f7f\u7528fallback\u65b9\u6cd5\u8fd4\u56de\u503c. fallback\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u4e00\u822c\u662f\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u503c\u6216\u8005\u6765\u81ea\u7f13\u5b58."),(0,l.kt)("p",{parentName:"li"},"\u4ec0\u4e48\u65f6\u5019\u9700\u8981\u964d\u7ea7? \u8d85\u65f6, \u5f02\u5e38, \u7194\u65ad, \u7ebf\u7a0b\u6c60/\u4fe1\u53f7\u91cf \u6253\u6ee1")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u8d44\u6e90\u9694\u79bb: \u5728Hystrix\u4e2d, \u4e3b\u8981\u901a\u8fc7\u7ebf\u7a0b\u6c60\u6765\u5b9e\u73b0\u8d44\u6e90\u9694\u79bb; \u901a\u5e38\u5728\u4f7f\u7528\u7684\u65f6\u5019\u6211\u4eec\u4f1a\u6839\u636e\u8c03\u7528\u7684\u8fdc\u7a0b\u670d\u52a1\u5212\u5206\u51fa\u591a\u4e2a\u7ebf\u7a0b\u6c60. \u4f8b\u5982\u8c03\u7528\u4ea7\u54c1\u670d\u52a1\u7684Command\u653e\u5165A\u7ebf\u7a0b\u6c60, \u8c03\u7528\u8d26\u6237\u670d\u52a1\u7684Command\u653e\u5165B\u7ebf\u7a0b\u6c60. \u8fd9\u6837\u505a\u7684\u4e3b\u8981\u4f18\u70b9\u662f\u8fd0\u884c\u73af\u5883\u88ab\u9694\u79bb\u5f00\u4e86. \u8fd9\u6837\u5c31\u7b97\u8c03\u7528\u670d\u52a1\u7684\u4ee3\u7801\u5b58\u5728bug\u6216\u8005\u7531\u4e8e\u5176\u4ed6\u539f\u56e0\u5bfc\u81f4\u81ea\u5df1\u6240\u5728\u7ebf\u7a0b\u6c60\u88ab\u8017\u5c3d\u65f6, \u4e0d\u4f1a\u5bf9\u7cfb\u7edf\u7684\u5176\u4ed6\u670d\u52a1\u9020\u6210\u5f71\u54cd. \u4f46\u662f\u5e26\u6765\u7684\u4ee3\u4ef7\u5c31\u662f\u7ef4\u62a4\u591a\u4e2a\u7ebf\u7a0b\u6c60\u4f1a\u5bf9\u7cfb\u7edf\u5e26\u6765\u989d\u5916\u7684\u6027\u80fd\u5f00\u9500. \u5982\u679c\u662f\u5bf9\u6027\u80fd\u6709\u4e25\u683c\u8981\u6c42\u800c\u4e14\u786e\u4fe1\u81ea\u5df1\u8c03\u7528\u670d\u52a1\u7684\u5ba2\u6237\u7aef\u4ee3\u7801\u4e0d\u4f1a\u51fa\u95ee\u9898\u7684\u8bdd, \u53ef\u4ee5\u4f7f\u7528Hystrix\u7684\u4fe1\u53f7\u6a21\u5f0f(Semaphores)\u6765\u9694\u79bb\u8d44\u6e90."))),(0,l.kt)("h3",{id:"812-hystrix-\u964d\u7ea7\u4f7f\u7528"},"8.1.2. hystrix \u964d\u7ea7\u4f7f\u7528"),(0,l.kt)("h4",{id:"8121-\u5355\u72ec\u4f7f\u7528"},"8.1.2.1. \u5355\u72ec\u4f7f\u7528"),(0,l.kt)("p",null,"\u4e00\u79cd\u4f7f\u7528\u65b9\u6cd5: ",(0,l.kt)("inlineCode",{parentName:"p"},'@HystrixCommand(fallbackMethod = "defaultHah")')," , defaultHah \u65b9\u6cd5\u53ef\u4ee5\u591a\u4e00\u4e2a\u53c2\u6570\u8868\u793a\u5f02\u5e38; \u7136\u540e ",(0,l.kt)("inlineCode",{parentName:"p"},"@EnableCircuitBreaker"),"/",(0,l.kt)("inlineCode",{parentName:"p"},"@EnableHystrix")," (\u540e\u8005\u5305\u542b\u4e86\u524d\u8005)"),(0,l.kt)("p",null,"\u7194\u65ad\u6761\u4ef6\u914d\u7f6e, \u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"server:\n  port: 8080\ncircuitBreaker:\n  # \u7b26\u5408\u8fd9\u4e9b\u6761\u4ef6, \u6253\u5f00\n  # When calls to a particular service exceed\n  requestVolumeThreshold: 20\n  # failure percentage is greater than\n  errorThresholdPercentage: 50%\nmetrics:\n  rollingStats:\n    # in a rolling window defined by ..,  the circuit opens and the call is not made\n    timeInMilliseconds: 10\n")),(0,l.kt)("p",null,"\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u6ce8\u89e3\u4e0a\u914d\u7f6e:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@HystrixCommand(fallbackMethod = "fallback", commandProperties = {\n        @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds", value = "3000")\n})\n@RequestMapping("/reservations/names")\npublic ResponseEntity<Collection<String>> names() {\n    // \u8d85\u65f6\u6216\u8005\u5f02\u5e38 \u90fd\u8d70 fallback \u65b9\u6cd5\n\n    // if (enableErr) {\n    //     throw new RuntimeException("some error produced");\n    // }\n\n    try {\n        Thread.sleep(5 * 1000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n    return new ResponseEntity<>(reservationResources.reservations().getContent().stream()\n            .map(Reservation::getName).collect(Collectors.toList()), HttpStatus.OK);\n}\n')),(0,l.kt)("p",null,"\u7c7b\u7ea7\u522b\u7684(\u5168\u5c40\u7684)\u964d\u7ea7: \u7c7b\u7ea7\u522b\u7684\u6ce8\u89e3 ",(0,l.kt)("inlineCode",{parentName:"p"},'@DefaultProperties(defaultFallback = "defaultFallback")'),", defaultFallback \u662f\u5f53\u524d\u7c7b\u7684\u4e00\u4e2a\u65b9\u6cd5"),(0,l.kt)("p",null,"\u914d\u7f6e\u53c2\u6570\u53ca\u9ed8\u8ba4\u503c\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"HystrixCommandProperties")," \u53ef\u4ee5\u67e5\u770b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@HystrixCommand(fallbackMethod = "fallback", commandProperties = {\n  @HystrixProperty(name = "circuitBreaker.enabled", value = "true"), // \u662f\u5426\u5f00\u542f\n  @HystrixProperty(name = "circuitBreakerVolumeThreshold", value = "10"),// \u8bf7\u6c42\u6b21\u6570, \u9ed8\u8ba4 20 \u6b21, \u8d85\u8fc7\u624d\u4f1a\u6253\u5f00\n  @HystrixProperty(name = "circuitBreaker.sleepWindowInMilliSeconds", value = "5000"),// \u7761\u7720\u65f6\u95f4\u7a97\u53e3 (\u8fd9\u6bb5\u65f6\u95f4\u540e\u8fdb\u5165\u534a\u5f00\u72b6\u6001), \u9ed8\u8ba4 5s\n  @HystrixProperty(name = "circuitBreaker.errorThresholdPercentage", value = "60")// \u5931\u8d25\u7387\u9650\u989d, \u8d85\u8fc7\u5219\u65ad\u5f00\n  @HystrixProperty(name = "metrics.rollingStats.timeInMilliseconds", value = "10000")// \u6eda\u52a8\u7edf\u8ba1\u65f6\u95f4\u7a97\u53e3\n})\n@RequestMapping("/reservations/names")\npublic ResponseEntity<Collection<String>> names() {\n    // \u8d85\u65f6\u6216\u8005\u5f02\u5e38 \u90fd\u8d70 fallback \u65b9\u6cd5\n    \n    // if (enableErr) {\n    //     throw new RuntimeException("some error produced");\n    // }\n\n    try {\n        Thread.sleep(5 * 1000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n    return new ResponseEntity<>(reservationResources.reservations().getContent().stream()\n            .map(Reservation::getName).collect(Collectors.toList()), HttpStatus.OK);\n}\n')),(0,l.kt)("h4",{id:"8122-\u914d\u5408-openfeign"},"8.1.2.2. \u914d\u5408 openFeign"),(0,l.kt)("p",null,"\u7b2c\u4e8c\u79cd\u4f7f\u7528\u65b9\u6cd5: \u4e00\u822c\u662f\u914d\u5408 openFeign \u8fdb\u884c\u964d\u7ea7"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@FeignClient(value = "reservation-service", fallback = ReservationResourcesFallback.class)\n        // also support \'url\' ( outside eureka)\ninterface ReservationResources {\n\n    @RequestMapping("/reservations")\n    CollectionModel<Reservation> reservations();\n\n    @RequestMapping("/message")\n    String message();\n}\n\n@Component\nclass ReservationResourcesFallback implements ReservationResources {\n\n    @Override\n    public CollectionModel<Reservation> reservations() {\n        return null;\n    }\n\n    @Override\n    public String message() {\n        return null;\n    }\n}\n')),(0,l.kt)("h3",{id:"813-\u7194\u65ad\u76d1\u63a7hystrix-dashboard\u548cturbine"},"8.1.3. \u7194\u65ad\u76d1\u63a7Hystrix-Dashboard\u548cTurbine"),(0,l.kt)("p",null,"Hystrix-dashboard\u662f\u4e00\u6b3e\u9488\u5bf9Hystrix\u8fdb\u884c\u5b9e\u65f6\u76d1\u63a7\u7684\u5de5\u5177, \u5404Hystrix Command\u7684\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4, \u8bf7\u6c42\u6210\u529f\u7387\u7b49\u6570\u636e\u3002(\u5b9e\u65f6\u76d1\u63a7, \u5386\u53f2\u7194\u65ad\u6570\u636e\u65e0\u6cd5\u67e5\u770b)"),(0,l.kt)("p",null,"\u4f46\u662f\u53ea\u4f7f\u7528Hystrix Dashboard\u7684\u8bdd, \u4f60\u53ea\u80fd\u770b\u5230\u5355\u4e2a\u5e94\u7528\u5185\u7684\u670d\u52a1\u4fe1\u606f, \u8fd9\u660e\u663e\u4e0d\u591f. \u6211\u4eec\u9700\u8981\u4e00\u4e2a\u5de5\u5177\u80fd\u8ba9\u6211\u4eec\u6c47\u603b\u7cfb\u7edf\u5185\u591a\u4e2a\u670d\u52a1\u7684\u6570\u636e\u5e76\u663e\u793a\u5230Hystrix Dashboard\u4e0a, \u8fd9\u4e2a\u5de5\u5177\u5c31\u662fTurbine."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Hystrix-Dashboard \u53ef\u4ee5\u76f4\u63a5 app \u4e2d\u96c6\u6210, \u76d1\u63a7\u5176\u6240\u5728\u7684\u90a3\u4e2a app; turbine \u65b0\u542f\u4e86\u4e00\u4e2a\u72ec\u7acb\u9879\u76ee, \u4e13\u95e8\u8d1f\u8d23\u76d1\u63a7\u6240\u6709\u7684node;")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Netflix\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff08Turbine\uff09\u6765\u63d0\u4f9b\u628a\u591a\u4e2ahystrix.stream\u7684\u5185\u5bb9\u805a\u5408\u4e3a\u4e00\u4e2a\u6570\u636e\u6e90\u4f9bDashboard\u5c55\u793a")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},'\u6bcf\u4e2a\u4f7f\u7528\u4e86 hystrix \u7684 app \u4f1a\u53d1\u5e03\u4e00\u4e2a\u63a5\u53e3 http://app-uri/actuator/hystrix.stream (\u9700\u8981\u5f15\u5165 actuator, \u914d\u7f6e management.endpoints.web.exposure.include=hystrix.stream, \u76f4\u63a5\u914d\u7f6e\u4e3a "*" \u66b4\u9732\u5168\u90e8\u4ea6\u53ef), \u8fd4\u56de hystrix steam \u6570\u636e, \u5728 hystrix dashboard (http://dashboard-uri/hystrix) \u8f93\u5165\u524d\u9762\u7684steam\u5730\u5740\u5448\u73b0\u56fe\u5f62\u754c\u9762; \u67e5\u770b Hystrix Dashboard Wiki \u53ef\u77e5\u6653\u76d1\u63a7\u753b\u9762\u7684\u542b\u4e49')),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u8bbf\u95ee http://localhost:8001/turbine.stream \u51fa\u73b0stream\u6570\u636e\u754c\u9762(\u7eaf\u6570\u636e\u5b57\u7b26); \u8bbf\u95eehttp://localhost:8001/hystrix \u63a5\u7740\u8f93\u5165stream\u5730\u5740, \u5448\u73b0\u56fe\u5f62\u754c\u9762;"))),(0,l.kt)("h3",{id:"814-\u81ea\u5b9a\u4e49\u9694\u79bb\u7b56\u7565"},"8.1.4. \u81ea\u5b9a\u4e49\u9694\u79bb\u7b56\u7565"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class FeignHystrixConcurrencyStrategy extends HystrixConcurrencyStrategy {\n\n    private static final Logger log = LoggerFactory.getLogger(FeignHystrixConcurrencyStrategy.class);\n\n    private HystrixConcurrencyStrategy delegate;\n\n    public FeignHystrixConcurrencyStrategy() {\n        try {\n            this.delegate = HystrixPlugins.getInstance().getConcurrencyStrategy();\n            if (this.delegate instanceof FeignHystrixConcurrencyStrategy) {\n                // Welcome to singleton hell...\n                return;\n            }\n\n            HystrixCommandExecutionHook commandExecutionHook =\n                    HystrixPlugins.getInstance().getCommandExecutionHook();\n\n            HystrixEventNotifier eventNotifier = HystrixPlugins.getInstance().getEventNotifier();\n            HystrixMetricsPublisher metricsPublisher = HystrixPlugins.getInstance().getMetricsPublisher();\n            HystrixPropertiesStrategy propertiesStrategy =\n                    HystrixPlugins.getInstance().getPropertiesStrategy();\n            this.logCurrentStateOfHystrixPlugins(eventNotifier, metricsPublisher, propertiesStrategy);\n\n            HystrixPlugins.reset();\n            HystrixPlugins instance = HystrixPlugins.getInstance();\n            instance.registerConcurrencyStrategy(this);\n            instance.registerCommandExecutionHook(commandExecutionHook);\n            instance.registerEventNotifier(eventNotifier);\n            instance.registerMetricsPublisher(metricsPublisher);\n            instance.registerPropertiesStrategy(propertiesStrategy);\n        } catch (Exception e) {\n            log.error("Failed to register Sleuth Hystrix Concurrency Strategy", e);\n        }\n    }\n\n    private void logCurrentStateOfHystrixPlugins(HystrixEventNotifier eventNotifier,\n                                                 HystrixMetricsPublisher metricsPublisher,\n                                                 HystrixPropertiesStrategy propertiesStrategy) {\n        if (log.isDebugEnabled()) {\n            log.debug("Current Hystrix plugins configuration is [" + "concurrencyStrategy ["\n                    + this.delegate + "]," + "eventNotifier [" + eventNotifier + "]," + "metricPublisher ["\n                    + metricsPublisher + "]," + "propertiesStrategy [" + propertiesStrategy + "]," + "]");\n            log.debug("Registering Sleuth Hystrix Concurrency Strategy.");\n        }\n    }\n\n    @Override\n    public <T> Callable<T> wrapCallable(Callable<T> callable) {\n        RequestAttributes requestAttributes = RequestContextHolder.getRequestAttributes();\n        return new WrappedCallable<>(callable, requestAttributes);\n    }\n\n    @Override\n    public ThreadPoolExecutor getThreadPool(HystrixThreadPoolKey threadPoolKey,\n                                            HystrixProperty<Integer> corePoolSize,\n                                            HystrixProperty<Integer> maximumPoolSize,\n                                            HystrixProperty<Integer> keepAliveTime,\n                                            TimeUnit unit, BlockingQueue<Runnable> workQueue) {\n        return this.delegate.getThreadPool(threadPoolKey, corePoolSize, maximumPoolSize, keepAliveTime,\n                unit, workQueue);\n    }\n\n    @Override\n    public ThreadPoolExecutor getThreadPool(HystrixThreadPoolKey threadPoolKey,\n                                            HystrixThreadPoolProperties threadPoolProperties) {\n        return this.delegate.getThreadPool(threadPoolKey, threadPoolProperties);\n    }\n\n    @Override\n    public BlockingQueue<Runnable> getBlockingQueue(int maxQueueSize) {\n        return this.delegate.getBlockingQueue(maxQueueSize);\n    }\n\n    @Override\n    public <T> HystrixRequestVariable<T> getRequestVariable(HystrixRequestVariableLifecycle<T> rv) {\n        return this.delegate.getRequestVariable(rv);\n    }\n\n    static class WrappedCallable<T> implements Callable<T> {\n        private final Callable<T> target;\n        private final RequestAttributes requestAttributes;\n\n        WrappedCallable(Callable<T> target, RequestAttributes requestAttributes) {\n            this.target = target;\n            this.requestAttributes = requestAttributes;\n        }\n\n        @Override\n        public T call() throws Exception {\n            try {\n                RequestContextHolder.setRequestAttributes(requestAttributes);\n                return target.call();\n            } finally {\n                RequestContextHolder.resetRequestAttributes();\n            }\n        }\n    }\n}\n')),(0,l.kt)("h2",{id:"82-spring-cloud-alibaba-sentinel"},"8.2. spring cloud alibaba sentinel"),(0,l.kt)("p",null,"\u56fd\u5185\u4f7f\u7528\u591a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"# \u542f\u52a8\u63a7\u5236\u53f0\n# -Dcsp.sentinel.dashboard.server=consoleIp:port \u6307\u5b9a\u63a7\u5236\u53f0\u5730\u5740\u548c\u7aef\u53e3, \u5c06\u63a7\u5236\u53f0\u81ea\u8eab\u4fe1\u606f\u6ce8\u518c\u5230 dashboard\n# \u82e5\u542f\u52a8\u591a\u4e2a\u5e94\u7528\uff0c\u5219\u9700\u8981\u901a\u8fc7 -Dcsp.sentinel.api.port=xxxx \u6307\u5b9a\u5ba2\u6237\u7aef\u76d1\u63a7 API \u7684\u7aef\u53e3\uff08\u9ed8\u8ba4\u662f 8719)\njava -Dserver.port=18888 -Dcsp.sentinel.dashboard.server=localhost:18888 -Dproject.name=sentinel-dashboard -Dsentinel.dashboard.auth.username=rain -Dsentinel.dashboard.auth.password=rain -Dserver.servlet.session.timeout=7200 -jar sentinel-dashboard-1.8.6.jar\n\n\n")),(0,l.kt)("h2",{id:"83-resilience4j"},"8.3. resilience4j"),(0,l.kt)("p",null,"\u56fd\u5916\u4f7f\u7528\u591a, \u57fa\u4e8eJava 8\u5f00\u53d1\u7684\uff0c\u5e76\u4e14\u53ea\u4f7f\u7528\u4e86vavr\u5e93 "),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://segmentfault.com/a/1190000019617975"},"https://segmentfault.com/a/1190000019617975")),(0,l.kt)("h1",{id:"9-\u670d\u52a1\u7f51\u5173"},"9. \u670d\u52a1\u7f51\u5173"),(0,l.kt)("p",null,"zuul, spring-cloud gateway"),(0,l.kt)("p",null,"\u7528\u4e8e\u8def\u7531. \u524d\u7aef\u8bf7\u6c42\u901a\u8fc7\u7f51\u5173, \u8f6c\u53d1\u7ed9\u540e\u7aef\u5177\u4f53\u7684 service, \u96c6\u4e2d\u8fdb\u884c\u7edf\u4e00\u7684\u964d\u7ea7, \u9650\u6d41, \u8ba4\u8bc1\u6388\u6743"),(0,l.kt)("h2",{id:"91-\u7f51\u5173\u9009\u578b"},"9.1. \u7f51\u5173\u9009\u578b"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://codeantenna.com/a/HYlbT1VZT7"},"https://codeantenna.com/a/HYlbT1VZT7")),(0,l.kt)("p",null,"API \u7f51\u5173\u7684\u597d\u5904: "),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7b80\u5316\u5ba2\u6237\u7aef\u8c03\u7528\u590d\u6742\u5ea6 (\u4e5f\u5c31\u662f\u8def\u7531\u529f\u80fd): \u5728\u5fae\u670d\u52a1\u67b6\u6784\u6a21\u5f0f\u4e0b\u540e\u7aef\u670d\u52a1\u7684\u5b9e\u4f8b\u6570\u4e00\u822c\u662f\u52a8\u6001\u7684\uff0c\u5bf9\u4e8e\u5ba2\u6237\u7aef\u800c\u8a00\u5f88\u96be\u53d1\u73b0\u52a8\u6001\u6539\u53d8\u7684\u670d\u52a1\u5b9e\u4f8b\u7684\u8bbf\u95ee\u5730\u5740\u4fe1\u606f;")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u6570\u636e\u8f6c\u6362\u4ee5\u53ca\u805a\u5408: API Gateway\u53ef\u4ee5\u5bf9\u901a\u7528\u6027\u7684\u54cd\u5e94\u6570\u636e\u8fdb\u884c\u88c1\u526a\u4ee5\u9002\u5e94\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u4f7f\u7528\u9700\u6c42\u3002\u540c\u65f6\u8fd8\u53ef\u4ee5\u5c06\u591a\u4e2aAPI\u8c03\u7528\u903b\u8f91\u8fdb\u884c\u805a\u5408\uff0c\u4ece\u800c\u51cf\u5c11\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u6570\uff0c\u4f18\u5316\u5ba2\u6237\u7aef\u7528\u6237\u4f53\u9a8c")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u96c6\u4e2d\u505a\u4e00\u4e9b\u529f\u80fd: \u9274\u6743, \u9650\u6d41, \u76d1\u63a7, \u65e5\u5fd7")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u9057\u7559\u7cfb\u7edf\u7684\u5fae\u670d\u52a1\u5316\u6539\u9020"))),(0,l.kt)("p",null,"Zuul 1.x \u6784\u5efa\u4e8e Servlet 2.5\uff0c\u517c\u5bb9 3.x\uff0c\u4f7f\u7528\u7684\u662f\u963b\u585e\u5f0f\u7684 API\uff0c\u4e0d\u652f\u6301\u957f\u8fde\u63a5\uff0c\u6bd4\u5982 websockets\u3002\u4f46\u662f 2.x \u7248\u672c\u5df2\u7ecf\u652f\u6301\u5f02\u6b65\u65e0\u963b\u585e api (\u57fa\u4e8enetty)"),(0,l.kt)("p",null,"Spring Cloud Gateway\u6784\u5efa\u4e8e Spring 5+\uff0c\u57fa\u4e8e Spring Boot 2.x \u54cd\u5e94\u5f0f\u7684\u3001\u975e\u963b\u585e\u5f0f\u7684 API\u3002\u540c\u65f6\uff0c\u5b83\u652f\u6301 websockets\uff0c\u548c Spring \u6846\u67b6\u7d27\u5bc6\u96c6\u6210\u3002\u63a8\u8350"),(0,l.kt)("h2",{id:"92-\u7f51\u5173\u9ad8\u53ef\u7528"},"9.2. \u7f51\u5173\u9ad8\u53ef\u7528"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://blog.csdn.net/yangwenpei116/article/details/104250006/"},"https://blog.csdn.net/yangwenpei116/article/details/104250006/"),"\n",(0,l.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/SimpleWu/p/11004902.html"},"https://www.cnblogs.com/SimpleWu/p/11004902.html"),"\nTODO"),(0,l.kt)("h2",{id:"93-nodejs"},"9.3. nodejs"),(0,l.kt)("h2",{id:"94-kong"},"9.4. kong"),(0,l.kt)("p",null,"\u9700\u8981 lua \u811a\u672c\u5f00\u53d1"),(0,l.kt)("h2",{id:"95-openresty"},"9.5. openResty"),(0,l.kt)("p",null,"\u5c31\u662f nginx + lua"),(0,l.kt)("h2",{id:"96-zuul"},"9.6. zuul"),(0,l.kt)("p",null,"\u8fdb\u5165 maintenance"),(0,l.kt)("p",null,"zuul2 \u672c\u6765\u6709\u6539\u8fdb, \u4f46\u662f\u7528\u7684\u4e0d\u591a"),(0,l.kt)("h3",{id:"961-\u4ec0\u4e48\u662fzuul"},"9.6.1. \u4ec0\u4e48\u662fzuul"),(0,l.kt)("p",null,"\u5728Spring Cloud\u4f53\u7cfb\u4e2d\uff0c Spring Cloud Zuul\u5c31\u662f\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u53cd\u5411\u4ee3\u7406\u3001\u6743\u9650\u8ba4\u8bc1\u7684\u4e00\u4e2aAPI gateway\u3002(\u63d0\u4f9b\u52a8\u6001\u8def\u7531\uff0c\u76d1\u63a7\uff0c\u5f39\u6027\uff0c\u5b89\u5168\u7b49\u7684\u8fb9\u7f18\u670d\u52a1\u3002Zuul\u662fNetflix\u51fa\u54c1\u7684\u4e00\u4e2a\u57fa\u4e8eJVM\u8def\u7531\u548c\u670d\u52a1\u7aef\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u3002)"),(0,l.kt)("h3",{id:"962-\u57fa\u672c\u4f7f\u7528"},"9.6.2. \u57fa\u672c\u4f7f\u7528"),(0,l.kt)("p",null,"\u4e00\u822c\u662f\u914d\u5408\u6ce8\u518c\u4e2d\u5fc3\u4e00\u8d77\u4f7f\u7528, \u5728 eureka \u7684\u914d\u5408\u4e0b, \u53ea\u9700\u8981\u5728\u67d0\u4e2a eureka client \u4e0b\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"@EnableZuulProxy")," (\u53ef\u770b\u4f5c @EnableZuulServer \u7684\u589e\u5f3a), \u5373\u53ef\u4ee3\u7406\u6240\u6709 eureka \u4e0a\u7684\u670d\u52a1, \u652f\u6301\u8d1f\u8f7d\u5747\u8861"),(0,l.kt)("p",null,"\u7f51\u5173\u7684\u9ed8\u8ba4\u8def\u7531\u89c4\u5219: \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cZuul\u4f1a\u4ee3\u7406\u6240\u6709\u6ce8\u518c\u5230Eureka Server\u7684\u5fae\u670d\u52a1\uff0c\u5e76\u4e14Zuul\u7684\u8def\u7531\u89c4\u5219\u5982\u4e0b\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"http://ZUUL_HOST:ZUUL_PORT/serviceId/**")," \u4f1a\u88ab\u8f6c\u53d1\u5230 serviceId \u5bf9\u5e94\u7684 path\u3002"),(0,l.kt)("p",null,"\u81ea\u5b9a\u4e49\u8def\u7531\u89c4\u5219\uff1a ",(0,l.kt)("inlineCode",{parentName:"p"},"http://ZUUL_HOST:ZUUL_PORT/zuul.routes.xxx.path/**")," \u4f1a\u88ab\u8f6c\u53d1\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"zuul.routes.xxx.url/**")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"http://www.ityouknow.com/springcloud/2018/01/20/spring-cloud-zuul.html"},"http://www.ityouknow.com/springcloud/2018/01/20/spring-cloud-zuul.html"),"\n",(0,l.kt)("a",{parentName:"p",href:"http://www.ityouknow.com/springcloud/2018/02/02/spring-cloud-sleuth-zipkin.html"},"http://www.ityouknow.com/springcloud/2018/02/02/spring-cloud-sleuth-zipkin.html")),(0,l.kt)("h2",{id:"97-spring-cloud-gateway"},"9.7. spring-cloud-gateway"),(0,l.kt)("h3",{id:"971-\u7b80\u5355\u4ecb\u7ecd"},"9.7.1. \u7b80\u5355\u4ecb\u7ecd"),(0,l.kt)("p",null,"Spring Cloud Gateway requires the Netty runtime provided by Spring Boot and Spring Webflux. It does not work in a traditional Servlet Container or built as a WAR (\u4f7f\u7528 netty+webflux \u5b9e\u73b0\u56e0\u6b64\u4e0d\u9700\u8981\u518d\u5f15\u5165 web \u6a21\u5757, \u4e0d\u80fd\u4f7f\u7528 servlet container)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"\u5de5\u4f5c\u6d41\u7a0b: \u8bf7\u6c42\u8fdb\u6765, \u5982\u679c\u5728 Gateway Handler Mapping \u4e2d\u901a\u8fc7\u914d\u7f6e\u7684\u4e00\u4e9b\u65ad\u8a00, \u627e\u5230\u4e0e\u8bf7\u6c42\u76f8\u5339\u914d\u7684\u8def\u7531\uff0c\u5c06\u5176\u53d1\u9001\u5230 Gateway Web Handler, Handler \u518d\u901a\u8fc7\u6307\u5b9a\u7684\u8fc7\u6ee4\u5668\u94fe\u6765\u5c06\u8bf7\u6c42\u53d1\u9001\u5230\u5b9e\u9645\u7684\u670d\u52a1\u6267\u884c\u4e1a\u52a1\u903b\u8f91\uff0c\u7136\u540e\u8fd4\u56de\u3002\n\n  \u8fc7\u6ee4\u5668\u94fe\u6761\u4e2d, \u7ecf\u8fc7 PreFilter \u2014> \u5fae\u670d\u52a1 \u2014> PostFilter \u7684\u65b9\u6cd5\uff0c\u6700\u7ec8\u8fd4\u56de\u54cd\u5e94\n\n")),(0,l.kt)("h3",{id:"972-\u548c\u6ce8\u518c\u4e2d\u5fc3\u914d\u5408"},"9.7.2. \u548c\u6ce8\u518c\u4e2d\u5fc3\u914d\u5408"),(0,l.kt)("p",null,"\u548c \u6ce8\u518c\u4e2d\u5fc3 \u4e00\u8d77\u4f7f\u7528 (\u52a8\u6001\u8def\u7531), \u9700\u8981\u6253\u5f00\u5f00\u5173, \u9ed8\u8ba4\u7684\u81ea\u52a8\u4ee3\u7406\u8bf7\u6c42\u683c\u5f0f: http://\u7f51\u5173\u5730\u5740/\u670d\u52a1\u4e2d\u5fc3\u6ce8\u518c serviceId/\u5177\u4f53\u7684path, \u5982: http://localhost:8888/EUREKA-SINGLE-CLIENT/hah (service name \u53ef\u4ee5\u914d\u7f6e\u5c0f\u5199), \u5982\u679c\u8def\u7531\u7684service\u6709\u591a\u4e2a\u8282\u70b9, \u4f1a\u81ea\u52a8\u8d1f\u8f7d\u5747\u8861"),(0,l.kt)("h3",{id:"973-\u8def\u7531"},"9.7.3. \u8def\u7531"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"\nroute: \u5c06 request \u8f6c\u53d1\u5230\u5177\u4f53\u7684\u67d0\u4e2a service  (id, uri, predicates, [filter])\n\n  \u642d\u914d predicate \u4f7f\u7528\n    \n  route\u6709\u4e24\u79cd\u914d\u7f6e\u65b9\u5f0f, \u901a\u8fc7yml,\u6216\u8005 \u901a\u8fc7@bean\u81ea\u5b9a\u4e49 RouteLocator; \n  \n  \u4e00\u4e2a\u8bf7\u6c42\u6ee1\u8db3\u591a\u4e2a\u8def\u7531\u7684\u8c13\u8bcd\u6761\u4ef6\u65f6\uff0c\u8bf7\u6c42\u53ea\u4f1a\u88ab\u9996\u4e2a\u6210\u529f\u5339\u914d\u7684\u8def\u7531\u8f6c\u53d1 (\u5c31\u8fd1\u5339\u914d); \n  \n  \u6ce8\u518c\u5230 registration center \u540e, \u901a\u8fc7\u914d\u7f6e, \u53ef\u4ee5\u81ea\u52a8\u8def\u7531\u6240\u6709\u5df2\u6ce8\u518c\u7684\u670d\u52a1\n\n")),(0,l.kt)("h3",{id:"974-predcates-\u4ecb\u7ecd"},"9.7.4. predcates \u4ecb\u7ecd"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"\n\n  predicate: \u5c31\u662fJava8\u4e2d\u5f15\u5165\u7684\u7684 Predicate, \u8f93\u5165\u662f ServerWebExchange, \u53ef\u4ee5\u83b7\u53d6 request, header, params\n\n    \u6240\u6709 predicate \u8fd4\u56detrue, \u5219\u5f53\u524d route matched \n\n")),(0,l.kt)("h4",{id:"9741-\u6709\u54ea\u4e9b\u5185\u7f6e-route-predicate-factory"},"9.7.4.1. \u6709\u54ea\u4e9b\u5185\u7f6e route predicate factory"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},'\n\nCookie\n  Cookie=chocolate, ch.p    ","\u524d\u9762\u7684\u4e3aname\uff0c\u9017\u53f7\u540e\u9762\u7684\u4e3a\u503c\n\nHeader\n  Header=X-Request-Id, \\d+  ","\u524d\u9762\u7684\u4e3aname\uff0c\u9017\u53f7\u540e\u9762\u7684\u4e3a\u503c\n\nHost    \u901a\u8fc7\u6307\u5b9a host (\u8fd8\u662f\u5c5e\u4e8eHeader\u9a8c\u8bc1) \u6765\u5339\u914d(\u591a\u4e2ahost \u7528 "," \u5206\u9694, \u652f\u6301 `**` \u901a\u914d\u7b26, \u5982 `**.github.io`)\n  Host=**.somehost.org,**.anotherhost.org\n\nMethod\n  Method=GET,post\n\nQuery\n  Query=aaa\uff0c\u8bf7\u6c42\u53c2\u6570\u5fc5\u987b\u6709name\u4e3aaaa\u7684\u53c2\u6570\n  Query=aaa, 111\uff1a\u8bf7\u6c42\u53c2\u6570\u5fc5\u987b\u6709name\u4e3aaaa\u7684\u53c2\u6570\uff0c\u4e14aaa\u53c2\u6570\u7684\u503c\u4e3a111\uff1b\n\nAfter\n  After=2021-03-17T15:47:51.534+08:00[Asia/Shanghai]\uff0c\u65e5\u671f\u65f6\u95f4\uff0c\u5728\u8be5\u65e5\u671f\u4ee5\u540e\u8bf7\u6c42\u624d\u88ab\u5339\u914d\n    \u65f6\u95f4\u53ef\u4ee5\u4f7f\u7528java.time.ZonedDateTime\u4e2d\u7684ZonedDateTime.now()\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\n\nBefore\n  Before=2022-03-17T15:47:51.534+08:00[Asia/Shanghai]\uff0c\u65e5\u671f\u65f6\u95f4\uff0c\u5728\u8be5\u65e5\u671f\u4e4b\u524d\u624d\u88ab\u5339\u914d\n\nBetween\n  Between=2021-03-17T15:47:51.534+08:00[Asia/Shanghai],2022-03-17T15:47:51.534+08:00[Asia/Shanghai]\uff0c\u4f7f\u7528\u4e24\u4e2a\u53c2\u6570\u7528\u9017\u53f7\u5206\u9694\uff0c\u5728\u4e24\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u8bf7\u6c42\u624d\u88ab\u5339\u914d\n\nRemoteAddr\uff1a\u901a\u8fc7\u8bf7\u6c42ip\u5339\u914d\n  RemoteAddr=192.168.1.1/24\n\nPath    \u901a\u8fc7\u8bf7\u6c42\u8def\u5f84\u5339\u914d, \n  Path=/red/{segment},/blue/{segment}  \n    \u652f\u6301 "/foo/{segment}" \u6a21\u677f\u5360\u4f4d\u7b26\u7684\u5f62\u5f0f \u5728 filter \u4e2d\u53ef\u4ee5\u4f7f\u7528\u5360\u4f4d\u7b26\u4e2d\u7684\u53d8\u91cf\n    \u5982\u679c\u8bf7\u6c42\u8def\u5f84\u662f\uff1a/red/1\u6216/red/blue\u6216/blue/green\uff0c\u5219\u6b64\u8def\u7531\u5339\u914d\u3002\n  Path=/gateway/**  \n    \u652f\u6301\u6a21\u7cca\u5339\u914d\n\nWeight  \u6743\u91cd\u8def\u7531\u5de5\u5382\u6709\u4e24\u4e2a\u53c2\u6570\uff1agroup\u548cWeight\uff08int\uff09\u3002\u6bcf\u7ec4\u8ba1\u7b97\u91cd\u91cf\n  Weight=group1, 2\n')),(0,l.kt)("h4",{id:"9742-\u65ad\u8a00\u5728\u4ee3\u7801\u4e2d\u914d\u7f6e"},"9.7.4.2. \u65ad\u8a00\u5728\u4ee3\u7801\u4e2d\u914d\u7f6e"),(0,l.kt)("h4",{id:"9743-\u65ad\u8a00\u5728yml\u4e2d\u914d\u7f6e"},"9.7.4.3. \u65ad\u8a00\u5728yml\u4e2d\u914d\u7f6e"),(0,l.kt)("p",null,"\u4e24\u79cd\u914d\u7f6e\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},"# \u952e\u503c\u5bf9\u65b9\u5f0f, \u7b80\u6d01\nspring:\n  cloud:\n    gateway:\n      routes:\n      - id: cookie_route\n        uri: https://example.org\n        predicates:\n        - Cookie=mycookie,mycookievalue\n\n# \u5b8c\u5168\u5c55\u5f00\u7684\u65b9\u5f0f, \u6807\u51c6\u65b9\u5f0f\nspring:\n  cloud:\n    gateway:\n      routes:\n      - id: cookie_route\n        uri: https://example.org\n        predicates:\n        - name: Cookie\n          args:\n            name: mycookie\n            regexp: mycookievalue\n")),(0,l.kt)("h3",{id:"975-filter-\u4ecb\u7ecd"},"9.7.5. filter \u4ecb\u7ecd"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},'\n\nfilter: \u53ef\u4ee5\u4fee\u6539\u8bf7\u6c42\u548c\u54cd\u5e94, \u751f\u547d\u5468\u671f\u5206\u4e3a "pre" \u548c "post"\n\n  filter \u5206\u4e3a: GatewayFilter \u4e0e GlobalFilter\u3002\n    \n    GlobalFilter \u4f1a\u5e94\u7528\u5230\u6240\u6709\u7684\u8def\u7531\u4e0a(\u65e0\u9700\u914d\u7f6e)\uff0c\n    \n    GatewayFilter \u5c06\u5e94\u7528\u5230\u5355\u4e2a\u8def\u7531\u6216\u8005\u4e00\u4e2a\u5206\u7ec4\u7684\u8def\u7531\u4e0a(\u9700\u8981\u8ddfRoute\u7ed1\u5b9a\u4f7f\u7528\uff0c\u4e0d\u80fd\u5728application.yml\u6587\u4ef6\u4e2d\u914d\u7f6e\u4f7f\u7528)\n      \n      GatewayFilter  \u4ea6\u53ef \u901a\u8fc7 AbstractGatewayFilterFactory, \u5728\u5185\u90e8\u5b9e\u73b0, \u4e0d\u5199\u5355\u72ec\u7684 Java\u7c7b(\u8fd9\u79cd\u65b9\u5f0f\u540c\u6837\u8981\u914d\u7f6e route)\n\n\n\u96c6\u6210\u4e86 Hystrix, \u81ea\u52a8\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861, \u96c6\u6210\u4e86 Spring Cloud DiscoveryClient, \n\n\n\u4f7f\u7528\u573a\u666f: \u9274\u6743\u3001\u9650\u6d41\u3001\u65e5\u5fd7\u8f93\u51fa\n\n\n\u751f\u547d\u5468\u671f:\n\n  PRE\uff1a \u8fd9\u79cd\u8fc7\u6ee4\u5668\u5728\u88ab\u4ee3\u7406\u7684\u5fae\u670d\u52a1\uff08Proxied Service\uff09\u6267\u884c\u4e4b\u524d\u8c03\u7528\u3002\n  \n    \u6211\u4eec\u53ef\u5229\u7528\u8fd9\u79cd\u8fc7\u6ee4\u5668\u5b9e\u73b0\u8eab\u4efd\u9a8c\u8bc1\u3001\u5728\u96c6\u7fa4\u4e2d\u9009\u62e9\u8bf7\u6c42\u7684\u5fae\u670d\u52a1\u3001\u8bb0\u5f55\u8c03\u8bd5\u4fe1\u606f\u7b49\u3002\n\n  POST\uff1a\u8fd9\u79cd\u8fc7\u6ee4\u5668\u5728\u88ab\u4ee3\u7406\u7684\u5fae\u670d\u52a1\uff08Proxied Service\uff09\u6267\u884c\u5b8c\u6210\u540e\u6267\u884c\u3002\n  \n    \u8fd9\u79cd\u8fc7\u6ee4\u5668\u53ef\u7528\u6765\u4e3a\u54cd\u5e94\u6dfb\u52a0\u6807\u51c6\u7684 HTTP Header\u3001\u6536\u96c6\u7edf\u8ba1\u4fe1\u606f\u548c\u6307\u6807\u3001\u5c06\u54cd\u5e94\u4ece\u5fae\u670d\u52a1\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7b49\u3002\n\n\n')),(0,l.kt)("h4",{id:"9751-\u6709\u54ea\u4e9b-\u5185\u7f6e-filter"},"9.7.5.1. \u6709\u54ea\u4e9b \u5185\u7f6e filter"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://docs.spring.io/spring-cloud-gateway/docs/2.2.5.RELEASE/reference/html/#gatewayfilter-factories"},"https://docs.spring.io/spring-cloud-gateway/docs/2.2.5.RELEASE/reference/html/#gatewayfilter-factories")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"AddRequestHeader\nAddResponseHeader\n  AddRequestHeader=X-Request-red, blue\n\nDedupeResponseHeader\n  - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin\n\nAddRequestParameter\n  AddRequestParameter=red, blue\n\nAddRequestFilter\n\nRedirectTo    \u91cd\u5b9a\u5411, \u9700\u8981\u4e24\u4e2a\u53c2\u6570\uff0cstatus\u548curl\u3002status\u53c2\u6570\u5e94\u8be5\u662f300\u7cfb\u5217\u91cd\u5b9a\u5411HTTP\u4ee3\u7801\uff0c\u4f8b\u5982301\u3002url\u53c2\u6570\u5e94\u8be5\u662f\u6709\u6548\u7684url\n   RedirectTo=302, https://acme.org\n\nSetPath \u53ef\u4ee5\u4f7f\u7528 Path \u4e2d\u7684\u5360\u4f4d\u7b26\u53d8\u91cf (\u901a\u8fc7\u6a21\u677f\u8bbe\u7f6e\u8def\u5f84)\n  SetPath=/app/{path}   {path} \u662f Path predicate \u91cc\u7684\u5360\u4f4d\u7b26\n\n\nRewritePath   \u91cd\u5199\u8bf7\u6c42\u8def\u5f84\n  RewritePath=/test, /app/test    \u8bbf\u95ee\u7f51\u5173localhost:8888/test, \u8bf7\u6c42\u4f1a\u8f6c\u53d1\u5230localhost:8001/app/test\n  RewritePath=(?<oldPath>^/), /app$\\{oldPath}  \n    \u5f53\u8bf7\u6c42\u7f51\u5173localhost:8888/test\u65f6\uff0c\u5339\u914d\u6240\u6709\u4ee5/\u5f00\u5934\u7684\u8def\u5f84\uff0c\u7136\u540e\u5728\u524d\u9762\u52a0\u4e0a/app,\u6240\u4ee5\u73b0\u5728\u8bf7\u6c42\u53d8\u6210\u4e86localhost:8888/app/test\u3002\u7136\u540e\u8f6c\u53d1\u65f6\u7684url\u53d8\u6210\u4e86localhost:8001/app/test \n    (\u5728yml\u6587\u6863\u4e2d $ \u8981\u5199\u6210 $\\ )\n\nPrefixPath  \u5728\u8f6c\u53d1\u540e\u7684\u8bf7\u6c42\u8def\u5f84\u524d\u52a0\u4e0a\u81ea\u5b9a\u4e49\u7684\u8def\u5f84\n  PrefixPath=/app   \u8bbf\u95ee\u7f51\u5173 localhost:8888/test, \u4f1a\u88ab\u8f6c\u53d1\u6210 \u76ee\u6807\u5730\u5740 localhost:1234/app/test\n\nStripPrefix   \u53bb\u9664Path \u4e2d\u7684\u524d\u7f00 (\u6307\u5b9a\u7ea7\u6570)\n  StripPrefix=1   \u90a3\u4e48 /service1/hello  --\x3e /hello\n")),(0,l.kt)("h4",{id:"9752-\u8fc7\u6ee4\u5668\u7684\u914d\u7f6e\u65b9\u6cd5-\u4ee3\u7801"},"9.7.5.2. \u8fc7\u6ee4\u5668\u7684\u914d\u7f6e\u65b9\u6cd5-\u4ee3\u7801"),(0,l.kt)("h4",{id:"9753-\u8fc7\u6ee4\u5668\u914d\u7f6e\u65b9\u6cd5-yml"},"9.7.5.3. \u8fc7\u6ee4\u5668\u914d\u7f6e\u65b9\u6cd5-yml"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},"\nspring:\n  cloud:\n    gateway:\n      routes:\n      - id: add_request_header_route\n        uri: https://example.org\n        filters:\n        - AddRequestHeader=X-Request-red, blue\n")),(0,l.kt)("h4",{id:"9754-\u81ea\u5b9a\u4e49\u5168\u5c40-filter"},"9.7.5.4. \u81ea\u5b9a\u4e49\u5168\u5c40 filter"),(0,l.kt)("p",null,"\u63a5\u53e3 GlobalFilter (\u5b9a\u4e49\u5168\u5c40 filter, \u9700\u8981 ",(0,l.kt)("inlineCode",{parentName:"p"},"@component"),"), \u5f71\u54cd\u6240\u6709 route; Ordered \u63a5\u53e3\u5b9a\u4e49\u987a\u5e8f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'// \u5b9e\u73b0\u6388\u6743\u3001\u65e5\u5fd7\u7b49\u529f\u80fd\n@Component\npublic class AuthorizeFilter implements GlobalFilter, Ordered {\n    private static final Logger log = LoggerFactory.getLogger(AuthorizeFilter.class);\n    private static final String AUTHORIZE_TOKEN = "token";\n \n    @Override\n    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain){\n        String token = exchange.getRequest().getQueryParams()\n          .getFirst(AUTHORIZE_TOKEN);\n \n        if ( StringUtils.isBlank( token )) {\n            log.info( "token is empty ..." );\n            exchange.getResponse().setStatusCode( HttpStatus.UNAUTHORIZED );\n            return exchange.getResponse().setComplete();\n        }\n        return chain.filter(exchange);\n    }\n \n    @Override\n    public int getOrder() {\n        return 0;\n    }\n}\n\n\nor\n\n// \u7edf\u8ba1\u65f6\u95f4\n@Component\nclass TimeRecordGlobalFilter implements GlobalFilter, Ordered {\n    private static final String TIME_BEGIN = "time begin";\n\n    @Override\n    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n      // log.info("custom global filter");\n        // return chain.filter(exchange);\n\n\n        exchange.getAttributes().put(TIME_BEGIN, System.currentTimeMillis());\n        return chain.filter(exchange).then(Mono.fromRunnable(() -> {\n            Long timeBegin = exchange.getAttribute(TIME_BEGIN);\n            if (timeBegin == null) {\n                throw new RuntimeException(">>> Error when get begin time");\n            }\n            System.out.println(">>> " + exchange.getRequest().getURI().getRawPath()\n                    + ": " + (System.currentTimeMillis() - timeBegin) + "ms");\n        }));\n    }\n\n    @Override\n    public int getOrder() {\n        //\u53ef\u4ee5\u4e3a\u8d1f\u6570, \u5c0f\u5373\u9996\u5148\u8fdb\u5165\n        return 0;\n    }\n}\n')),(0,l.kt)("h4",{id:"9755-\u81ea\u5b9a\u4e49\u666e\u901a-gateway-filter"},"9.7.5.5. \u81ea\u5b9a\u4e49\u666e\u901a gateway filter"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},'\u4e24\u79cd\u65b9\u5f0f:\n\n  GatewayFilter, Ordered ( \u65e0\u9700 @component)\n\n    \u9700\u8981\u5728 route \u4e2d\u4f7f\u7528\u4ee3\u7801\u786c\u7f16\u7801\u914d\u7f6e `xxx.filters(new MyFilter(), \u4e0d\u80fd\u5728application.yml\u6587\u4ef6\u4e2d\u914d\u7f6e\u4f7f\u7528\n\n    // \u7edf\u8ba1\u67d0\u4e2a\u6216\u8005\u67d0\u79cd\u8def\u7531\u7684\u5904\u7406\u65f6\u957f\n      public class CustomerGatewayFilter implements GatewayFilter, Ordered {\n          private static final Logger log = LoggerFactory.getLogger( CustomerGatewayFilter.class );\n          private static final String COUNT_START_TIME = "countStartTime";\n      \n          @Override\n          public Mono<Void> filter(ServerWebExchange exch, GatewayFilterChain chain) {\n              return chain.filter(exch).then(\n                  Mono.fromRunnable(() -> {\n                    long startTime = exch.getAttribute(COUNT_START_TIME);\n                    long endTime=(Instant.now().toEpochMilli() - startTime);\n                    log.info(exch.getRequest().getURI().getRawPath() + ": " + endTime + "ms");\n                })\n              );\n          }\n      \n          @Override\n          public int getOrder() {\n              return 0;\n        }\n      }\n\n  \u5982\u679c\u5e0c\u671b\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6eGateway Filter, \u5219\u901a\u8fc7\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668\u5de5\u5382\u5b9e\u73b0; \n\n    \u7ee7\u627f\u62bd\u8c61\u7c7b AbstractGatewayFilterFactory (\u5b9e\u73b0 apply(config), config \u4e3a\u81ea\u5b9a\u4e49\u53c2\u6570)\n\n    @Component\n    public class CustomerGatewayFilterFactory extends AbstractGatewayFilterFactory<CustomerGatewayFilterFactory.Config> {\n    \n        private static final Logger log = LoggerFactory.getLogger( CustomerGatewayFilterFactory.class );\n        private static final String COUNT_START_TIME = "countStartTime";\n    \n        @Override\n        public List<String> shortcutFieldOrder() {\n            return Arrays.asList("enabled");\n        }\n    \n        public CustomerGatewayFilterFactory() {\n            super(Config.class);\n            log.info("Loaded GatewayFilterFactory [CustomerGatewayFilterFactory]");\n        }\n    \n        @Override\n        public GatewayFilter apply(Config config) {\n            return (exchange, chain) -> {\n                if (!config.isEnabled()) {\n                  return chain.filter(exchange);\n                }\n                exchange.getAttributes().put(COUNT_START_TIME, \n                                            System.currentTimeMillis());\n              \n              return chain.filter(exchange).then(\n                    Mono.fromRunnable(() -> {\n                        Long startTime = exchange.getAttribute(COUNT_START_TIME);\n                        if (startTime != null) {\n                            StringBuilder sb = new StringBuilder(\n                              exchange.getRequest().getURI().getRawPath()\n                            ).append(": ")\n                            .append(System.currentTimeMillis() - startTime)\n                            .append("ms");\n    \n                            sb.append(" params:")\n                              .append(exchange.getRequest().getQueryParams());\n    \n                            log.info(sb.toString());\n                        }}));\n            };\n        }\n    \n        public static class Config {\n            //\u63a7\u5236\u662f\u5426\u5f00\u542f\u7edf\u8ba1\n            private boolean enabled;\n            public Config() {}\n            // getter setter \u7701\u7565\n        }\n    }\n\n\n    \u914d\u7f6e:\n\n    spring:\n      cloud:\n        gateway:\n          routes:\n            - id: elapse_route\n              uri: lb://account-service\n              filters:\n              - Customer=true\n              predicates:\n              - Method=GET\n\n      or\n\n      - id: custom-filter-factory\n        uri: http://localhost:8080\n        predicates:\n          - Path=/service/**\n        filters:\n          - RewritePath=/service(?<segment>/?.*), $\\{segment}\n          #\u7b80\u5355\u914d\u7f6e, \u4f46\u662f\u8fd9\u6837\u5c31\u9700\u8981\u989d\u5916\u91cd\u5199\u8986\u76d6\u65b9\u6cd5 shortcutFieldOrder()\n          #- Logging=My Custom Message, true, true\n          - name: Logging\n            args:\n              baseMessage: My Custom Message helloxxxx\n              preLogger: true\n              postLogger: true\n')),(0,l.kt)("p",null,"\u53e6\u5916\u4e00\u4e2a\u4f8b\u5b50"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'// \u9274\u6743\n@Component\npublic class AuthorizeGatewayFilterFactory extends AbstractGatewayFilterFactory<AuthorizeGatewayFilterFactory.Config> {\n\n    private static final Log logger = LogFactory.getLog(AuthorizeGatewayFilterFactory.class);\n\n    private static final String AUTHORIZE_TOKEN = "token";\n    private static final String AUTHORIZE_UID = "uid";\n\n    @Autowired\n    private StringRedisTemplate stringRedisTemplate;\n\n    public AuthorizeGatewayFilterFactory() {\n        super(Config.class);\n        logger.info("Loaded GatewayFilterFactory [Authorize]");\n    }\n\n    @Override\n    public List<String> shortcutFieldOrder() {\n        return Arrays.asList("enabled");\n    }\n\n    @Override\n    public GatewayFilter apply(AuthorizeGatewayFilterFactory.Config config) {\n        return (exchange, chain) -> {\n            if (!config.isEnabled()) {\n                return chain.filter(exchange);\n            }\n\n            ServerHttpRequest request = exchange.getRequest();\n            HttpHeaders headers = request.getHeaders();\n            String token = headers.getFirst(AUTHORIZE_TOKEN);\n            String uid = headers.getFirst(AUTHORIZE_UID);\n            if (token == null) {\n                token = request.getQueryParams().getFirst(AUTHORIZE_TOKEN);\n            }\n            if (uid == null) {\n                uid = request.getQueryParams().getFirst(AUTHORIZE_UID);\n            }\n\n            ServerHttpResponse response = exchange.getResponse();\n            if (StringUtils.isEmpty(token) || StringUtils.isEmpty(uid)) {\n                response.setStatusCode(HttpStatus.UNAUTHORIZED);\n                return response.setComplete();\n            }\n            String authToken = stringRedisTemplate.opsForValue().get(uid);\n            if (authToken == null || !authToken.equals(token)) {\n                response.setStatusCode(HttpStatus.UNAUTHORIZED);\n                return response.setComplete();\n            }\n            return chain.filter(exchange);\n        };\n    }\n\n    public static class Config {\n        // \u63a7\u5236\u662f\u5426\u5f00\u542f\u8ba4\u8bc1\n        private boolean enabled;\n\n        public Config() {}\n\n        public boolean isEnabled() {\n            return enabled;\n        }\n\n        public void setEnabled(boolean enabled) {\n            this.enabled = enabled;\n        }\n    }\n}\n\n\u914d\u7f6e:\n\nspring:\n  cloud:\n    gateway:\n      routes:\n      - id: user-service\n        uri: http://localhost:8077/api/user/list\n        predicates:\n        - Path=/user/list\n        filters:\n        # \u5173\u952e\u5728\u4e0b\u9762\u4e00\u53e5\uff0c\u503c\u4e3atrue\u5219\u5f00\u542f\u8ba4\u8bc1\uff0cfalse\u5219\u4e0d\u5f00\u542f\n        # \u8fd9\u79cd\u914d\u7f6e\u65b9\u5f0f\u548cspring cloud gateway\u5185\u7f6e\u7684GatewayFilterFactory\u4e00\u81f4\n        - Authorize=true\n\n')),(0,l.kt)("h3",{id:"976-gateway-\u914d\u7f6e\u65b9\u6cd5"},"9.7.6. gateway \u914d\u7f6e\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-props"},"# enable gateway, default to true\nspring.cloud.gateway.enabled=true\n\n# route all services that registered in eureka server, default to false\nspring.cloud.gateway.discovery.locator.enabled=true\n\n\n# \u5177\u4f53\u7684\u8def\u7531\u914d\u7f6e\n\n# , spring.cloud.gateway.routes \u662f\u4e00\u4e2a list\n# \u6bd4\u5982\n# route \u7684 id\nspring.cloud.gateway.routes[0].id=demo-route\n# Destination uri\n# if you visit localhost:8080/hah then the request would be forward to cn.bing.com/hah\n# \u8d1f\u8f7d\u5747\u8861 How to apply the filters to every node of one service? -> lb://spring-cloud-producer, \u683c\u5f0f\u4e3a\uff1alb://\u5e94\u7528\u6ce8\u518c\u670d\u52a1\u540d\nspring.cloud.gateway.routes[0].uri=cn.bing.com\n\n# \u662f\u4e00\u4e2a map, spring.cloud.gateway.routes[0].predicates\n# \u8fd8\u6709\u5f88\u591a, \u5982 After=2019-07-04T05:50:53.346Z, Method...\nspring.cloud.gateway.routes[0].predicates[0].name=Path\nspring.cloud.gateway.routes[0].predicates[0].args\n\n# add parameter xxx=yyy\nspring.cloud.gateway.routes[0].filters.AddRequestParameter=xxx, yyy\n\n")),(0,l.kt)("p",null,"\u66f4\u63a8\u8350 yaml \u7684\u914d\u7f6e:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},'spring:\n  application:\n    name: spring-cloud-gateway-demo\n  cloud:\n    gateway:\n      discovery:\n        locator:\n          # route all services that registered in eureka server, default to false\n          enabled: true\n          # \u81ea\u52a8\u4ee3\u7406\u53ef\u4ee5\u4f7f\u7528\u5c0f\u5199\u7684 service name\n          lower-case-service-id: true\n      # enable gateway, default to true\n      enabled: true\n      # config route rule\n      routes:\n        - id: demo-route\n          # Destination uri, if you visit localhost:8080/Path then the request would be forward to cn.bing.com/Path\n          uri: http://localhost:8090\n          predicates:\n            - Path=/hah/**\n            - Method=GET\n            #- After=2019-07-04T05:50:53.346Z\n          filters:\n            # add parameter xxx=yyy\n            - AddRequestParameter=xxx, yyy\n        # How to apply the filters to every node of one service? -> lb://spring-cloud-producer, \u683c\u5f0f\u4e3a\uff1alb://\u5e94\u7528\u6ce8\u518c\u670d\u52a1\u540d, \u8fd9\u91cc\u5176\u5b9e\u9ed8\u8ba4\u4f7f\u7528\u4e86\u5168\u5c40\u8fc7\u6ee4\u5668 LoadBalancerClient\n        - id: apply_filter_to_all_node_route\n          uri: lb://eureka-single-client\n        # PrefixPath Filter: add prefix to path, eg: - PrefixPath=/mypath\n        # StripPrefix Filter: split path, eg: /name/bar/foo -> /foo\n        # \u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a\u529f\u80fd\u6765\u505a\u7279\u6b8a\u4e1a\u52a1\u7684\u8f6c\u53d1\u3002\n        - id: split_request_path\n          uri: http://eureka-single-client\n          predicates:\n            - Path=/name/**\n            filters:\n              # element num to be split\n              - StripPrefix=2\n        # Retry GatewayFilter:\n        - id: retry_test\n            uri: lb://spring-cloud-producer\n            predicates:\n              - Path=/retry\n            filters:\n              - name: Retry\n                args:\n                  #  retry times, default to 3\n                  retries: 3\n                  # http response status, ref to org.springframework.http.HttpStatus\n                  statuses: BAD_GATEWAY\n                  # which http method should retry, default to GET\n                  methods: GET\n        #3  hystrix \u4e0d\u5e26 fallback \u7684\u914d\u7f6e\n        - id: hystrix_route\n          uri: http://example.org\n          filters:\n            # gateway \u5c06\u4f7f\u7528 myCommandName \u4f5c\u4e3a\u540d\u79f0\u751f\u6210 HystrixCommand \u5bf9\u8c61\u6765\u8fdb\u884c\u7194\u65ad\u7ba1\u7406\n            - Hystrix=myCommandName\n        # hystrix \u5e26 fallback \u7684\u914d\u7f6e\n        - id: hystrix_route\n          uri: lb://spring-cloud-producer\n          predicates:\n            - Path=/consumingserviceendpoint\n          filters:\n            - name: Hystrix\n              args:\n                name: fallbackcmd\n                # \u5f53\u8c03\u7528 Hystrix \u7684 fallback \u88ab\u8c03\u7528\u65f6\uff0c\u8bf7\u6c42\u5c06\u8f6c\u53d1\u5230/incaseoffailureuset\u8fd9\u4e2a URI\u3002\n                fallbackUri: forward:/incaseoffailureusethis\n        # RequestRateLimiter Filter, work with redis\n        # \u914d\u5408 redis\n        - id: request_rate_limiter_route\n          uri: http://example.org\n          filters:\n            - name: RequestRateLimiter\n              args:\n                # Handing 10 request every second\n                redis-rate-limiter.replenishRate: 10\n                # Finishing 20 request every second\n                redis-rate-limiter.burstCapacity: 20\n                # reference bean with beanName using SpEL grammar\n                key-resolver: "#{@userKeyResolver}"\n          predicates:\n            - Method=GET\n\nserver:\n  port: 8888\n')),(0,l.kt)("p",null,"\u901a\u8fc7\u4ee3\u7801\u786c\u7f16\u7801\u914d\u7f6e\u8def\u7531:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Configuration\nclass GatewayConfig {\n\n    @Bean\n    public RouteLocator routeLocator(RouteLocatorBuilder builder) {\n        // return builder.routes()\n        //         .route("baidu_guonei", predicateSpec -> predicateSpec\n        //                 .path("/guonei").uri("http://news.baidu.com/guonei"))\n        //         .route("baidu_guoji", predicateSpec -> predicateSpec\n        //                 .path("/guoji").uri("http://news.baidu.com/guoji"))\n        //         .build();\n\n        return builder.routes()\n                .route("baidu_guonei", predicateSpec -> predicateSpec\n                        .path("/**").uri("http://news.baidu.com"))\n                .build();\n    }\n}\n')),(0,l.kt)("h3",{id:"977-\u7f51\u5173\u76d1\u63a7"},"9.7.7. \u7f51\u5173\u76d1\u63a7"),(0,l.kt)("p",null,"spring-boot-starter-actuator"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},"management:\n  endpoints:\n    web:\n      exposure:\n        include: health,info,gateway\n")),(0,l.kt)("h3",{id:"978-\u8d85\u65f6\u914d\u7f6e"},"9.7.8. \u8d85\u65f6\u914d\u7f6e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},"# \u5168\u5c40\u8d85\u65f6\nspring:\n  cloud:\n    gateway:\n      # Http\u8d85\u65f6\uff08\u54cd\u5e94\u548c\u8fde\u63a5\uff09\u53ef\u4ee5\u4e3a\u6240\u6709\u8def\u7531\u914d\u7f6e\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u7279\u5b9a\u8def\u7531\u91cd\u5199\u3002\n      httpclient:\n        connect-timeout: 1000 # \u9ed8\u8ba4\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u6307\u5b9a\u8fde\u63a5\u8d85\u65f6\n        response-timeout: 5s # \u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684\u914d\u7f6e\u65b9\u5f0f\n\n\n\n# \u5355\u4e2a\u8def\u7531\u8d85\u65f6\n\n- id: per_route_timeouts\n  uri: https://example.org\n  predicates:\n    - name: Path\n      args:\n        pattern: /delay/{timeout}\n  metadata:\n    response-timeout: 200\n    connect-timeout: 200\n")),(0,l.kt)("h3",{id:"979-\u8de8\u57df\u914d\u7f6e"},"9.7.9. \u8de8\u57df\u914d\u7f6e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},"\nspring:\n  cloud:\n    gateway:\n      globalcors:\n        cors-configurations:\n          # \u5728\u5f53\u524d\u9875\u9762, \u5141\u8bb8\u6240\u6709 \u6765\u81ea \u6307\u5b9a url \u7684 get \u65b9\u6cd5\n          '[/**]':\n            allowedOrigins: \"https://docs.spring.io\"\n            allowedMethods:\n              - GET\n")),(0,l.kt)("h1",{id:"10-\u8c03\u7528\u94fe\u8def\u8ffd\u8e2a"},"10. \u8c03\u7528\u94fe\u8def\u8ffd\u8e2a"),(0,l.kt)("p",null,"\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e0b, \u67d0\u4e2a\u524d\u7aef\u8bf7\u6c42\u53ef\u80fd\u5bf9\u5e94\u591a\u4e2a\u540e\u7aefservice, \u5982\u4f55\u5b9a\u4f4d\u8fd9\u4e9bservice\u5462?"),(0,l.kt)("h2",{id:"101-sleuth-\u548c-zipkin"},"10.1. sleuth \u548c zipkin"),(0,l.kt)("h3",{id:"1011-\u5206\u5e03\u5f0f\u8ffd\u8e2a"},"10.1.1. \u5206\u5e03\u5f0f\u8ffd\u8e2a"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://toutiao.io/posts/eaiifaf/preview"},"https://toutiao.io/posts/eaiifaf/preview")),(0,l.kt)("p",null,"spring-cloud-sleuth  +  Zipkin (from twitter, ",(0,l.kt)("a",{parentName:"p",href:"https://zipkin.io/pages/quickstart.html"},"https://zipkin.io/pages/quickstart.html"),")"),(0,l.kt)("p",null,"\u5206\u5e03\u5f0f\u670d\u52a1\u8ffd\u8e2a\u7406\u8bba\u57fa\u7840\u6765\u81ea ",(0,l.kt)("a",{parentName:"p",href:"https://research.google.com/pubs/pub36356.html"},"Google \u7684\u4e00\u7bc7\u8bba\u6587")),(0,l.kt)("p",null,'spring-cloud-sleuth: \u63d0\u4f9b\u94fe\u8def\u8ffd\u8e2a, \u8bb0\u5f55\u6210\u529f\u4e0e\u5426, \u8017\u65f6; \u4e00\u4e2a\u5b8c\u6574\u7684\u8bf7\u6c42\u54cd\u5e94\u94fe\u8def\u8bb0\u5f55\u4e3a\u4e00\u4e2a "trace", \u53ef\u80fd\u5305\u542b\u591a\u4e2a service\u8c03\u7528, \u79f0\u4e3a "span", \u591a\u4e2a\u6709\u5e8f\u7684 span \u7ec4\u6210\u4e00\u4e2a trace (\u901a\u8fc7 parent id \u8054\u7cfb\u8d77\u6765); \u5982\u679c\u4ec5\u4ec5\u5f15\u5165 sleuth, \u8ddf\u8e2a\u65e5\u5fd7\u53ea\u4f1a\u6253\u5230\u63a7\u5236\u53f0 (\u5f15\u5165\u5373\u53ef, \u81ea\u52a8\u8bb0\u5f55, \u5982\u679c\u53ea\u5f15\u5165\u4e86 sleuth, \u90a3\u4e48\u9ed8\u8ba4\u6253\u5230 \u63a7\u5236\u53f0); \u4f5c\u4e3a zipkin \u7684\u4fe1\u606f\u6536\u96c6\u5668, \u53ea\u662f\u4e00\u4e2a\u5f00\u6e90\u5b9e\u73b0\u4e4b\u4e00'),(0,l.kt)("p",null,"Zipkin: \u5229\u7528 zipkin \u7684\u5b58\u50a8\u6765\u5b58\u50a8\u4fe1\u606f\uff0c\u5229\u7528zipkin ui\u6765\u5c55\u793a\u6570\u636e\u3002"),(0,l.kt)("h3",{id:"1012-spring-cloud-sleuth"},"10.1.2. spring-cloud-sleuth"),(0,l.kt)("p",null,"Trace\uff1a\u7531\u4e00\u7ec4 Trace Id \u76f8\u540c\u7684 Span \u4e32\u8054\u5f62\u6210\u4e00\u4e2a\u6811\u72b6\u7ed3\u6784\u3002\u4e3a\u4e86\u5b9e\u73b0\u8bf7\u6c42\u8ddf\u8e2a\uff0c\u5f53\u8bf7\u6c42\u5230\u8fbe\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u5165\u53e3\u7aef\u70b9\u65f6\uff0c\u53ea\u9700\u8981\u670d\u52a1\u8ddf\u8e2a\u6846\u67b6\u4e3a\u8be5\u8bf7\u6c42\u521b\u5efa\u4e00\u4e2a\u552f\u4e00\u7684\u6807\u8bc6\uff08\u5373TraceId\uff09"),(0,l.kt)("p",null,"Span\uff1a\u4ee3\u8868\u4e86\u4e00\u7ec4\u57fa\u672c\u7684\u5de5\u4f5c\u5355\u5143\u3002\u4e3a\u4e86\u7edf\u8ba1\u5404\u5904\u7406\u5355\u5143\u7684\u5ef6\u8fdf\uff0c\u5f53\u8bf7\u6c42\u5230\u8fbe\u5404\u4e2a\u670d\u52a1\u7ec4\u4ef6\u7684\u65f6\u5019, \u901a\u8fc7SpanId \u7684\u5f00\u59cb\u548c\u7ed3\u675f\u65f6\u95f4\u6233\uff0c\u5c31\u80fd\u7edf\u8ba1\u8be5 span \u7684\u8c03\u7528\u65f6\u95f4, spanId \u4e5f\u7528\u6765\u533a\u5206\u6811\u7ed3\u6784\u4e2d\u540c\u5c42\u7ea7\u8282\u70b9\u7684\u5148\u540e\u8c03\u7528\u5173\u7cfb"),(0,l.kt)("h3",{id:"1013-zipkin-\u4f7f\u7528"},"10.1.3. zipkin \u4f7f\u7528"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"zipkin \u7684\u4f7f\u7528\u5206\u4e3a\u4e24\u90e8\u5206"),(0,l.kt)("p",{parentName:"li"},"\u6bcf\u4e2a service \u9700\u8981\u5f15\u5165 zipkin client (spring-cloud-starter-zipkin, \u5df2\u7ecf\u5305\u542b sleuth), \u914d\u7f6e zipkin server \u5730\u5740\u548c\u91c7\u6837\u6bd4\u4f8b (\u9ed8\u8ba4\u62bd\u6837 0.1 \u5373 10%)"),(0,l.kt)("p",{parentName:"li"},"\u7b2c\u4e8c\u90e8\u5206 zipkin server (",(0,l.kt)("inlineCode",{parentName:"p"},"zipkin-server, zipkin-autoconfigure-ui"),"), \u914d\u5408 ",(0,l.kt)("inlineCode",{parentName:"p"},"@EnableZipkinServer"),", \u6700\u65b0\u7248\u7684 spring cloud \u5df2\u7ecf\u65e0\u9700\u6784\u5efa zipkin server \u4e86, \u53ea\u9700\u8981\u542f\u52a8 jar \u5305 (zipkin-server-xxx-exec.jar, from zipkin.io) \u5373\u53ef")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c zipkin \u548c spring cloud stream, kafka \u90fd\u5728 classpath, \u9ed8\u8ba4\u4f1a\u5c06\u8ddf\u8e2a\u8bb0\u5f55\u6253\u5230 kafka, ",(0,l.kt)("inlineCode",{parentName:"p"},"spring.zipkin.sender.type=web")," \u624d\u4f1a\u6253\u5230\u670d\u52a1\u5668\u65e5\u5fd7"),(0,l.kt)("p",{parentName:"li"},"\u8ffd\u8e2a\u65e5\u5fd7\u6253\u5230 kafka \u66f4\u597d, \u76f8\u6bd4\u4f7f\u7528  http \u8fde zipkin server, \u4f1a \u66f4\u52a0\u7a33\u5b9a(\u56e0\u4e3a\u6d88\u606f\u4e2d\u95f4\u4ef6\u80fd\u591f\u6297\u4f4f\u77ed\u65f6\u95f4\u7684\u5927\u65e5\u5fd7\u91cf), \u4f1a\u66f4\u89e3\u8026\u5408")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u6570\u636e\u5e93\u652f\u6301 In-Memory (\u9ed8\u8ba4, \u6d4b\u8bd5\u7528)\u3001MySql, Cassandra \u4ee5\u53ca Elasticsearch (\u751f\u4ea7\u63a8\u8350)"))),(0,l.kt)("p",null,"\u94fe\u8def\u8ddf\u8e2a\u6709\u81ea\u5df1\u7684\u7ebf\u7a0b\u6c60, \u5bf9\u4e1a\u52a1\u7ebf\u7a0b\u4e0d\u4f1a\u6709\u592a\u5927\u7684\u5f71\u54cd"),(0,l.kt)("p",null,"\u91cd\u8981\u7684\u914d\u7f6e:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},"spring:\n  zipkin:\n  # \u6307\u5b9a\u4e86Zipkin\u670d\u52a1\u5668\u7684\u5730\u5740\n    base-url: http://localhost:9000\n  sleuth:\n    sampler:\n    # \u91c7\u6837\u6bd4\u4f8b\u8bbe\u7f6e\u4e3a1.0\uff0c\u4e5f\u5c31\u662f\u5168\u90e8\u90fd\u9700\u8981\u3002\u9ed8\u8ba4\u7684\u91c7\u6837\u6bd4\u4f8b\u4e3a: 0.1(\u537310%)\n      percentage: 1.0\n      \n")),(0,l.kt)("h3",{id:"1014-\u4f7f\u7528\u6848\u4f8b"},"10.1.4. \u4f7f\u7528\u6848\u4f8b"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://www.extlight.com/sleuth-basic.html"},"https://www.extlight.com/sleuth-basic.html")),(0,l.kt)("h2",{id:"102-skywalking"},"10.2. skyWalking"),(0,l.kt)("p",null,"//todo"),(0,l.kt)("h1",{id:"11-\u4e1a\u52a1\u65e5\u5fd7\u6536\u96c6"},"11. \u4e1a\u52a1\u65e5\u5fd7\u6536\u96c6"),(0,l.kt)("p",null,"elk (elasticSearch, logstash, kibana) + kafka"),(0,l.kt)("p",null,"\u901a\u8fc7 logstash"),(0,l.kt)("h2",{id:"111-\u65e5\u5fd7\u600e\u4e48\u641c\u7d22-elasticsearch"},"11.1. \u65e5\u5fd7\u600e\u4e48\u641c\u7d22 elasticSearch"),(0,l.kt)("p",null,"\u5e95\u5c42\u662f\u4f7f\u7528\u7684 lucene \u5e93, \u5b9e\u73b0\u5168\u6587\u641c\u7d22\u5f15\u64ce"),(0,l.kt)("h2",{id:"112-\u65e5\u5fd7\u600e\u4e48\u6536\u96c6"},"11.2. \u65e5\u5fd7\u600e\u4e48\u6536\u96c6"),(0,l.kt)("p",null,"logstash"),(0,l.kt)("p",null,"\u53c8\u6709\u65b0\u7684\u66ff\u4ee3\u65b9\u6848:  ",(0,l.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/richaaaard/p/6109595.html"},"filebeat")),(0,l.kt)("h2",{id:"113-\u65e5\u5fd7\u600e\u4e48\u5c55\u793a"},"11.3. \u65e5\u5fd7\u600e\u4e48\u5c55\u793a"),(0,l.kt)("p",null,"Kibana"),(0,l.kt)("p",null,"kibana\u867d\u7075\u6d3b\uff0c\u4f46\u9700\u5b66\u4e60lucene\u8bed\u6cd5\uff0c\u64cd\u4f5c\u7e41\u9501"),(0,l.kt)("h1",{id:"12-\u8fd0\u7ef4\u76d1\u63a7"},"12. \u8fd0\u7ef4\u76d1\u63a7"),(0,l.kt)("p",null,"\u865a\u62df\u673a / \u5bb9\u5668 CPU \u3001Network \u3001Mem \u7b49\u57fa\u7840\u6307\u6807, "),(0,l.kt)("p",null,"K8s \u3001\u7269\u7406\u673a\u3001\u865a\u62df\u673a\u7b49\u7ba1\u7406"),(0,l.kt)("p",null,"\u505a\u597d\u76d1\u63a7\u7684\u771f\u6b63\u96be\u70b9\u4e0d\u5728\u4e8e\u6280\u672f\u9009\u578b\uff0c\u800c\u5728\u4e8e\u76d1\u63a7\u70b9\u8986\u76d6\u3001\u62a5\u8b66\u9608\u503c\u8c03\u6559\u3001\u503c\u73ed\u5e94\u6025\u8fd9\u4e00\u6574\u5957\u6d41\u7a0b\u3002"),(0,l.kt)("h2",{id:"121-prometheusthanos"},"12.1. prometheus/thanos"),(0,l.kt)("p",null," prometheus \u4e0d\u80fd\u96c6\u7fa4\u90e8\u7f72\uff0c\u5355\u70b9\u6709\u74f6\u9888"),(0,l.kt)("h1",{id:"13-\u6d88\u606f\u603b\u7ebf"},"13. \u6d88\u606f\u603b\u7ebf"),(0,l.kt)("h2",{id:"131-spring-cloud-bus"},"13.1. Spring-Cloud-Bus"),(0,l.kt)("p",null,"\u662f\u4e00\u4e2a\u6574\u5408\u6d88\u606f\u4e2d\u95f4\u4ef6\u8fdb\u5165\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u6846\u67b6\uff0c\u5229\u7528\u4e86MQ\u7684\u5e7f\u64ad\u673a\u5236\u5728\u5206\u5e03\u5f0f\u7684\u7cfb\u7edf\u4e2d\u4f20\u64ad\u6d88\u606f\uff0c\u76ee\u524d\u4ec5\u4ec5\u652f\u6301 Kafka \u548c RabbitMQ \u3002"),(0,l.kt)("p",null,"\u5728\u5e94\u7528\u4e4b\u95f4\u4f20\u9012\u72b6\u6001\u53d8\u5316 \u6bd4\u5982\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49\u4e8b\u4ef6, \u4e3b\u52a8\u5237\u65b0\u7f13\u5b58"),(0,l.kt)("p",null,"\u548c spring cloud stream \u533a\u522b: bus \u4e00\u822c\u7528\u4e8e\u57fa\u7840\u8bbe\u65bd\u7684\u5f00\u53d1, \u5982\u7ba1\u7406\u914d\u7f6e\u7684\u52a8\u6001\u5237\u65b0, stream \u7528\u4e8e\u4e1a\u52a1\u529f\u80fd\u7684\u5f00\u53d1."),(0,l.kt)("p",null,"\u5229\u7528 bus \u7684\u673a\u5236\u53ef\u4ee5\u505a\u5f88\u591a\u7684\u4e8b\u60c5:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u914d\u7f6e\u4e2d\u5fc3\u5ba2\u6237\u7aef\u505a\u52a8\u6001\u5237\u65b0, \u4e5f\u5c31\u662f\u5168\u5c40\u5e7f\u64ad (\u53ef\u4ee5\u907f\u514d\u52a8\u6001\u5237\u65b0\u914d\u7f6e\u65f6, \u5bf9\u9ad8\u53ef\u7528\u90e8\u7f72\u7684\u6bcf\u4e2a service instance \u6267\u884c refresh post \u8bf7\u6c42), \u4ee5\u53ca\u70ed\u90e8\u7f72")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5b9a\u70b9\u901a\u77e5/\u5c40\u90e8\u5237\u65b0  (\u5c31\u662f\u6307\u5b9a\u66f4\u65b0\u67d0\u4e2a\u5177\u4f53 service), ",(0,l.kt)("inlineCode",{parentName:"p"},"http://config-server-address/actuator/bus-refresh/{destination}"),", \u901a\u8fc7 destination \u6307\u5b9a\u9700\u8981\u66f4\u65b0\u7684 service \u6216\u8005\u67d0\u4e2a instance"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c\u5e0c\u671b\u53ea\u662f\u901a\u77e5 serviceA \u7684\u6240\u6709 instance, destination \u5373\u4e3a serviceA")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c\u53ea\u662f\u5e0c\u671b\u901a\u77e5 serviceA \u7684\u67d0\u4e2a instance (\u8fd9\u4e2a\u5b9e\u4f8b\u7aef\u53e3\u4e3a 8000), destination \u4e3a serviceA:8000"))))),(0,l.kt)("p",null,"\u548c\u914d\u7f6e\u4e2d\u5fc3\u914d\u5408\u7684\u539f\u7406\u56fe: (\u4e0d\u591f\u597d)"),(0,l.kt)("p",null,"1\u3001\u63d0\u4ea4\u4ee3\u7801\u89e6\u53d1post\u7ed9\u5ba2\u6237\u7aefA\u53d1\u9001bus/refresh\n2\u3001\u5ba2\u6237\u7aefA\u63a5\u6536\u5230\u8bf7\u6c42\u4eceServer\u7aef\u66f4\u65b0\u914d\u7f6e\u5e76\u4e14\u53d1\u9001\u7ed9Spring Cloud Bus\n3\u3001Spring Cloud bus\u63a5\u5230\u6d88\u606f\u5e76\u901a\u77e5\u7ed9\u5176\u5b83\u5ba2\u6237\u7aef (\u524d\u63d0\u662f\u6240\u6709\u8282\u70b9\u90fd\u8ba2\u9605\u4e8c\u4e86\u540c\u4e00\u4e2a topic, \u9ed8\u8ba4\u662f springCloudBus)\n4\u3001\u5176\u5b83\u5ba2\u6237\u7aef\u63a5\u6536\u5230\u901a\u77e5\uff0c\u8bf7\u6c42Server\u7aef\u83b7\u53d6\u6700\u65b0\u914d\u7f6e\n5\u3001\u5168\u90e8\u5ba2\u6237\u7aef\u5747\u83b7\u53d6\u5230\u6700\u65b0\u7684\u914d\u7f6e"),(0,l.kt)("p",null,"\u66f4\u65b0git\u4e2d\u7684\u6570\u636e\u540e, \u8bbf\u95eeclient, \u4efb\u7136\u662f\u65e7\u7684\u6570\u636e, \u8fd9\u65f6\u5019, \u5411\u4efb\u610fclient\u5b9e\u4f8b\u53d1\u9001\u4e00\u4e2a /actuator/bus-refresh \u7684post\u8bf7\u6c42 ",(0,l.kt)("inlineCode",{parentName:"p"},"curl -X POST http://...."),", \u7136\u540e\u8bbf\u95ee\u4efb\u610fclient, \u6570\u636e\u5747\u4e3alatest\u7684\u4e86"),(0,l.kt)("p",null,"\u4f46\u8fd9\u79cd\u65b9\u5f0f\u5e76\u4e0d\u4f18\u96c5\u3002\u539f\u56e0\u5982\u4e0b\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u6253\u7834\u4e86\u5fae\u670d\u52a1\u7684\u804c\u8d23\u5355\u4e00\u6027\u3002\u5fae\u670d\u52a1\u672c\u8eab\u662f\u4e1a\u52a1\u6a21\u5757\uff0c\u5b83\u672c\u4e0d\u5e94\u8be5\u627f\u62c5\u914d\u7f6e\u5237\u65b0\u7684\u804c\u8d23\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7834\u574f\u4e86\u5fae\u670d\u52a1\u5404\u8282\u70b9\u7684\u5bf9\u7b49\u6027\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u6709\u4e00\u5b9a\u7684\u5c40\u9650\u6027\u3002\u4f8b\u5982\uff0c\u5fae\u670d\u52a1\u5728\u8fc1\u79fb\u65f6\uff0c\u5b83\u7684\u7f51\u7edc\u5730\u5740\u5e38\u5e38\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u6b64\u65f6\u5982\u679c\u60f3\u8981\u505a\u5230\u81ea\u52a8\u5237\u65b0\uff0c\u90a3\u5c31\u4e0d\u5f97\u4e0d\u4fee\u6539 WebHook \u7684\u914d\u7f6e (\u5373 refresh post \u53d1\u9001\u7ed9\u7684\u5bf9\u8c61\u5730\u5740\u4f1a\u53d8\u5316, \u4e0d\u5f97\u4e0d\u4fee\u6539))"))),(0,l.kt)("p",null,"\u73b0\u5728\u5c06\u67b6\u6784\u6a21\u5f0f\u6539\u6210\u8fd9\u6837: (client\u5f15\u5165mq\u652f\u6301\u6d88\u606f\u603b\u7ebf, server\u7aef\u4e5f\u8981\u5f15\u5165\u6d88\u606f\u603b\u7ebf), \u6539\u4e3a\u5411 config server \u53d1\u9001 refresh \u8bf7\u6c42"),(0,l.kt)("p",null,"\u548c spring cloud config \u6574\u5408\u8be6\u7ec6\u6b65\u9aa4: \u5728 config server \u548c\u6bcf\u4e2a client \u5f15\u5165 spring cloud starter bus amqp (kafka \u5219\u5c31\u662f spring cloud starter bus kafka ), \u6709\u5982\u4e0b\u7684\u9ed8\u8ba4\u914d\u7f6e, \u5982\u679c\u81ea\u5b9a\u4e49\u9700\u8981\u4fee\u6539"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-props"},"spring.rabbitmq.host=localhost\nspring.rabbitmq.username=guest\nspring.rabbitmq.password=guest\nspring.rabbitmq.port=5672\n")),(0,l.kt)("p",null,"config server \u8fd8\u9700 \u5f15\u5165 ",(0,l.kt)("inlineCode",{parentName:"p"},"spring boot starter actuator")," \u7136\u540e\u914d\u7f6e\u5982\u4e0b\u4ee5\u66b4\u9732 refresh \u7aef\u70b9"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-props"},"# \u5982\u679c\u662f yml \u5219\u9700\u8981\u52a0\u5355\u5f15\u53f7\n# health,info,bus-refresh\nmanagement.endpoints.web.exposure.include=*\n")),(0,l.kt)("p",null,"\u600e\u4e48\u9a8c\u8bc1\u751f\u6548\u4e86\u5462? git repo \u4e2d application.yml \u4e2d\u914d\u7f6e common.aaa=hah, \u542f\u52a8 eureka, serviceA, serviceB, config server, \u4fee\u6539 common.aaa, \u7136\u540e commit/push, \u5411 config server \u53d1\u9001 ",(0,l.kt)("inlineCode",{parentName:"p"},"curl -X POST http://config-server-address/actuator/bus-refresh"),", \u7136\u540e\u5206\u522b\u901a\u8fc7\u4e24\u4e2a service \u83b7\u53d6 common.aaa (\u6ce8\u610f\u7c7b\u4e0a\u52a0\u4e0a ",(0,l.kt)("inlineCode",{parentName:"p"},"@refreshScope"),"), \u53d1\u73b0\u5df2\u7ecf\u66f4\u65b0\u4e86."),(0,l.kt)("p",null,"\u8ddf\u8e2a\u603b\u7ebf\u4e8b\u4ef6: \u53ea\u9700\u8bbe\u7f6espring.cloud.bus.trace.enabled=true\uff0c\u8fd9\u6837\u5728/bus/refresh\u7aef\u70b9\u88ab\u8bf7\u6c42\u540e\uff0c\u8bbf\u95ee/trace\u7aef\u70b9\u5c31\u53ef\u83b7\u5f97\u7c7b\u4f3c\u5982\u4e0b\u7684\u7ed3\u679c\uff1a..."),(0,l.kt)("h2",{id:"132-alibaba-nacos-\u4f5c\u4e3a\u6d88\u606f\u603b\u7ebf"},"13.2. alibaba nacos \u4f5c\u4e3a\u6d88\u606f\u603b\u7ebf"),(0,l.kt)("h1",{id:"14-spring-cloud-stream-\u6d88\u606f\u9a71\u52a8"},"14. spring-cloud-stream \u6d88\u606f\u9a71\u52a8"),(0,l.kt)("p",null,"\u662f\u4e00\u4e2a\u6784\u5efa\u6d88\u606f\u9a71\u52a8\u5fae\u670d\u52a1\u7684\u6846\u67b6, \u5c06\u9879\u76ee\u548c\u5177\u4f53\u7684\u67d0\u4e2a\u6d88\u606f\u4e2d\u95f4\u4ef6\u89e3\u8026(\u5982 rabbitqm, Kafka), \u5c4f\u853d\u5e95\u5c42\u6d88\u606f\u4e2d\u95f4\u4ef6\u7ec6\u8282, \u5c31\u50cf\u4f7f\u7528 jdbc \u7684 api \u4e4b\u540e, \u4e0d\u5fc5\u5173\u5fc3\u4f7f\u7528\u54ea\u79cd\u5177\u4f53\u7684\u6570\u636e\u5e93"),(0,l.kt)("p",null,"\u76ee\u524d\u4ec5\u4ec5\u652f\u6301 rabbitmq, kafka"),(0,l.kt)("p",null,"\u539f\u7406: \u5e94\u7528\u901a\u8fc7 spring cloud stream \u63d0\u4f9b\u7684 input Chanel (app \u901a\u8fc7\u5b83\u4ece mq \u4e2d\u63a5\u6536\u6d88\u606f) \u548c output Chanel (\u5411 mq \u53d1\u9001\u6d88\u606f) \u6765\u548c binder \u4ea4\u4e92. \u6709\u591a\u79cd\u5177\u4f53\u7684 binder \u5b9e\u73b0, \u5206\u522b\u5bf9\u5e94\u4e0d\u540c\u7684 mq; "),(0,l.kt)("p",null,"\u9075\u5faa\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f, \u901a\u8fc7 topic \u8fdb\u884c\u5e7f\u64ad (topic \u76f8\u5f53\u4e8e rabbit \u4e2d\u7684 exchange, Kafka \u4e2d\u7684 topic),"),(0,l.kt)("p",null,"\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"@Input"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"@output")," \u8868\u793a\u8f93\u5165\u8f93\u51fa\u901a\u9053, \u6d88\u8d39\u8005\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"@streamListener")," \u76d1\u542c\u961f\u5217\u8fdb\u884c\u6d88\u606f\u63a5\u6536(\u7528\u5728\u65b9\u6cd5\u4e0a), ",(0,l.kt)("inlineCode",{parentName:"p"},"@enableBinding")," \u5b9e\u73b0 Chanel \u548c exchange \u7684\u7ed1\u5b9a (\u53d1\u9001\u548c\u63a5\u53d7\u7684\u7c7b\u4e0a\u90fd\u6709, \u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"Souce.class")," \u53d1\u9001\u6e90\u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"Sink.class"),"\u63a5\u6536\u533a\u5206)"),(0,l.kt)("p",null,"\u4f7f\u7528\u7ec6\u8282 (\u4ee5 rabbit \u4e3a\u4f8b): \u5f15\u5165 ",(0,l.kt)("inlineCode",{parentName:"p"},"spring-cloud-starter-stream-rabbit"),", "),(0,l.kt)("p",null,"\u89e3\u51b3\u6d88\u606f\u91cd\u590d\u6d88\u8d39:"),(0,l.kt)("p",null,"\u6d88\u606f\u6301\u4e45\u5316:"),(0,l.kt)("p",null,"\u52a8\u6001\u521b\u5efa\u901a\u9053"),(0,l.kt)("h1",{id:"15-spring-cloud-data-flow"},"15. spring-cloud-data-flow"),(0,l.kt)("h1",{id:"16-\u5206\u5e03\u5f0f\u4e8b\u52a1"},"16. \u5206\u5e03\u5f0f\u4e8b\u52a1"),(0,l.kt)("h2",{id:"161-seata"},"16.1. seata"),(0,l.kt)("h3",{id:"seata-\u57fa\u672c\u4ecb\u7ecd"},"Seata \u57fa\u672c\u4ecb\u7ecd"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"\u652f\u6301 XA, AT, TCC, SAGA \u6a21\u5f0f\n    AT \u6a21\u5f0f\u662f\u65e0\u4fb5\u5165\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\uff0c\u9002\u7528\u4e8e\u4e0d\u5e0c\u671b\u5bf9\u4e1a\u52a1\u8fdb\u884c\u6539\u9020\u7684\u573a\u666f\uff0c\u51e0\u4e4e0\u5b66\u4e60\u6210\u672c\u3002\n    XA\n    TCC \u6a21\u5f0f\u662f\u9ad8\u6027\u80fd\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\uff0c\u9002\u7528\u4e8e\u6838\u5fc3\u7cfb\u7edf\u7b49\u5bf9\u6027\u80fd\u6709\u5f88\u9ad8\u8981\u6c42\u7684\u573a\u666f\u3002\n    Saga \u6a21\u5f0f\u662f\u957f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\uff0c\u9002\u7528\u4e8e\u4e1a\u52a1\u6d41\u7a0b\u957f\u4e14\u9700\u8981\u4fdd\u8bc1\u4e8b\u52a1\u6700\u7ec8\u4e00\u81f4\u6027\u7684\u4e1a\u52a1\u7cfb\u7edf\uff0cSaga \u6a21\u5f0f\u4e00\u9636\u6bb5\u5c31\u4f1a\u63d0\u4ea4\u672c\u5730\u4e8b\u52a1\uff0c\u65e0\u9501\uff0c\u957f\u6d41\u7a0b\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4fdd\u8bc1\u6027\u80fd\uff0c\u591a\u7528\u4e8e\u6e20\u9053\u5c42\u3001\u96c6\u6210\u5c42\u4e1a\u52a1\u7cfb\u7edf\u3002\u4e8b\u52a1\u53c2\u4e0e\u8005\u53ef\u80fd\u662f\u5176\u5b83\u516c\u53f8\u7684\u670d\u52a1\u6216\u8005\u662f\u9057\u7559\u7cfb\u7edf\u7684\u670d\u52a1\uff0c\u65e0\u6cd5\u8fdb\u884c\u6539\u9020\u548c\u63d0\u4f9b TCC \u8981\u6c42\u7684\u63a5\u53e3\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 Saga \u6a21\u5f0f\n\n\n\u57fa\u672c\u7ec4\u4ef6:\n- seata server, \u670d\u52a1\u540e\u7aef, \u7528\u6765\u505a\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5168\u5c40\u7ba1\u7406\n- \u4e8b\u52a1\u53d1\u8d77\u8005, \u5c31\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1\u662f\u4ece\u54ea\u91cc\u53d1\u8d77\u7684\n    \u6bd4\u5982\u4e00\u4e2a\u63a5\u53e3A\u4f1a\u8c03\u7528\u5176\u4ed6\u670d\u52a1 B, C, \u90a3 a \u5c31\u662f\u4e8b\u52a1\u53d1\u8d77\u8005\n- \u4e8b\u52a1\u53c2\u4e0e\u8005 \u5373\u4e0a\u9762\u7684 B, C\n\n\n\u5168\u5c40\u4e8b\u52a1ID XID\n\n\n")),(0,l.kt)("h2",{id:"162-\u672c\u5730\u6d88\u606f\u8868"},"16.2. \u672c\u5730\u6d88\u606f\u8868"),(0,l.kt)("h1",{id:"17-spring-cloud-alibaba-\u914d\u5408-dubbo"},"17. spring cloud alibaba \u914d\u5408 dubbo"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/babycomeon/p/11546737.html"},"https://www.cnblogs.com/babycomeon/p/11546737.html")," rpc + restful \u4f18\u96c5\u7684\u5b9e\u73b0"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://www.bilibili.com/video/BV1B5411h71j"},"https://www.bilibili.com/video/BV1B5411h71j")),(0,l.kt)("h1",{id:"18-\u5b9e\u9645\u8bbe\u8ba1\u6848\u4f8b-\u7968\u52a1\u7f51\u7ad9"},"18. \u5b9e\u9645\u8bbe\u8ba1\u6848\u4f8b \u7968\u52a1\u7f51\u7ad9"),(0,l.kt)("p",null,"\u7968\u52a1\u7c7b\u7f51\u7ad9 (\u6bd4\u5982\u732b\u773c\u7535\u5f71)"),(0,l.kt)("h2",{id:"181-\u4e1a\u52a1\u67b6\u6784"},"18.1. \u4e1a\u52a1\u67b6\u6784"),(0,l.kt)("p",null,"\u68b3\u7406\u529f\u80fd"),(0,l.kt)("p",null,"\u4f7f\u7528\u8005: \u9762\u5411\u6d77\u91cf\u7684\u4e92\u8054\u7f51\u7528\u6237"),(0,l.kt)("p",null,"\u5212\u5206\u7684\u6a21\u5757: \u652f\u4ed8, \u7528\u6237, \u5546\u54c1, \u8ba2\u5355, \u6392\u671f... (\u4ee5\u4e1a\u52a1\u5212\u5206\u6a21\u5757)"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u7528\u6237: \u6ce8\u518c, \u767b\u5f55, \u6ce8\u9500"),(0,l.kt)("li",{parentName:"ul"},"\u5546\u54c1: \u641c\u7d22, \u8be6\u60c5, \u6392\u671f, \u9009\u5ea7"),(0,l.kt)("li",{parentName:"ul"},"\u8ba2\u5355: \u751f\u6210, \u53d6\u6d88"),(0,l.kt)("li",{parentName:"ul"},"\u652f\u4ed8: \u5fae\u4fe1/\u652f\u4ed8\u5b9d\u652f\u4ed8"),(0,l.kt)("li",{parentName:"ul"},"\u6392\u671f"),(0,l.kt)("li",{parentName:"ul"},"\u57fa\u7840\u6a21\u5757 (\u5982 \u533a\u57df, \u56fe\u7247)")),(0,l.kt)("h2",{id:"182-\u5e94\u7528\u67b6\u6784"},"18.2. \u5e94\u7528\u67b6\u6784"),(0,l.kt)("p",null,"\u5212\u5206\u804c\u8d23, \u62c6\u5206\u6a21\u5757, \u6bcf\u4e2a module \u6709\u81ea\u5df1\u72ec\u7acb\u7684 git \u4ed3\u5e93, \u72ec\u7acb\u7684\u8d1f\u8d23\u56e2\u961f"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u524d\u7aef\u5e94\u7528")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u53cd\u5411\u4ee3\u7406\u7ec4\u4ef6 (nginx)")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7f51\u5173")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u6d88\u8d39\u8005app (\u6d88\u8d39\u5e94\u7528) , \u5982 \u7528\u6237\u6d88\u8d39, \u8ba2\u5355\u6d88\u8d39...")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u751f\u4ea7\u8005app (\u670d\u52a1\u5e94\u7528), \u5982 \u7528\u6237\u670d\u52a1, \u8ba2\u5355\u670d\u52a1...")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5fae\u670d\u52a1\u57fa\u7840\u670d\u52a1"),(0,l.kt)("p",{parentName:"li"},"\u5982 \u6ce8\u518c\u4e2d\u5fc3, \u914d\u7f6e\u4e2d\u5fc3, \u94fe\u8def\u8ddf\u8e2a\u4e2d\u5fc3, \u9650\u6d41\u4e2d\u5fc3")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u57fa\u7840\u516c\u5171\u6a21\u5757, \u73af\u5883\u652f\u6301\u7ec4\u4ef6"),(0,l.kt)("p",{parentName:"li"},"\u5982 \u7f13\u5b58, \u6301\u7eed\u96c6\u6210, \u90e8\u7f72, \u6570\u636e\u5e93, \u65e5\u5fd7, \u6d88\u606f ... redis, jenkins, MySQL, nexus, elk, rabbitmq, kafka, nginx"))),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"\u4e3a\u4ec0\u4e48\u540e\u53f0\u8981\u5206 \u6d88\u8d39\u8005\u5e94\u7528 \u548c \u670d\u52a1\u63d0\u4f9b\u8005\u5e94\u7528"),"? \u6bd4\u5982 \u7528\u6237\u6a21\u5757\u4f1a\u5206\u4e3a \u7528\u6237\u6d88\u8d39\u6a21\u5757\u548c\u7528\u6237\u670d\u52a1\u6a21\u5757"),(0,l.kt)("p",null,"\u5982\u679c\u4e0d\u533a\u5206\u6d88\u8d39\u8005module \u548c service provider  module \u4f1a\u9020\u6210:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u8c03\u7528\u5173\u7cfb\u6df7\u4e71 (\u4f1a\u76f8\u4e92\u8c03\u7528)")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u67d0\u4e2amodule\u5d29\u4e86, \u4f1a\u8fde\u7d2f\u5176\u4ed6module"))),(0,l.kt)("p",null,"\u6bcf\u4e2a\u4e1a\u52a1\u6a21\u5757\u533a\u5206\u4e3a provider \u548c consumer \u540e, \u524d\u7aef\u53ea\u548c\u6240\u6709 consumer \u4ea4\u4e92"),(0,l.kt)("p",null,"\u4f1a\u6709\u54ea\u4e9b\u597d\u5904:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u8c03\u7528\u5173\u7cfb\u6e05\u6670, \u6ca1\u6709\u76f8\u4e92\u8c03\u7528")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u6d88\u9664\u4e86 \u67d0\u4e2a module \u5d29\u4e86\u5e26\u6765\u7684\u7ea7\u8054\u5f71\u54cd "),(0,l.kt)("p",{parentName:"li"},"\u6bd4\u5982 user service consumer \u6302\u4e86, \u8fd8\u6709 user service provider , \u5176\u4ed6\u7684 consumer \u8fd8\u80fd\u6b63\u5e38\u5de5\u4f5c"),(0,l.kt)("p",{parentName:"li"},"(consumer \u76f4\u63a5\u9762\u5411 \u5916\u754c, \u51fa\u9519\u51e0\u7387\u5927, provider \u548c\u6570\u636e\u5e93\u6253\u4ea4\u9053, \u51fa\u9519\u51e0\u7387\u5c0f)"))),(0,l.kt)("h2",{id:"183-\u6280\u672f\u67b6\u6784"},"18.3. \u6280\u672f\u67b6\u6784"),(0,l.kt)("p",null,"\u5728\u5e94\u7528\u67b6\u6784\u57fa\u7840\u4e0a\u843d\u5730\u5177\u4f53\u7684\u6280\u672f"),(0,l.kt)("p",null,"\u6846\u67b6\u7ec4\u4ef6: spring boot, mybatis, MySQL"),(0,l.kt)("p",null,"\u6280\u672f\u70b9: spring cloud\u6280\u672f\u6808, elk+kafka (\u65e5\u5fd7), elasticSearch (\u641c\u7d22), rabbitmq (\u5206\u5e03\u5f0f\u4e8b\u52a1), redis(\u7f13\u5b58, setnx\u5206\u5e03\u5f0f\u9501), mycat (\u5206\u5e93\u5206\u8868), docker+Jenkins (\u6301\u7eed\u96c6\u6210)"),(0,l.kt)("h2",{id:"184-\u6570\u636e\u5e93\u67b6\u6784"},"18.4. \u6570\u636e\u5e93\u67b6\u6784"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u57fa\u7840\u5e93: \u533a\u57df\u8868, \u56fe\u7247\u8868"),(0,l.kt)("li",{parentName:"ul"},"\u8282\u76ee\u5e93: \u8282\u76ee\u8868, \u63d0\u4f9b\u65b9\u8868, \u7c7b\u578b\u8868"),(0,l.kt)("li",{parentName:"ul"},"\u8ba2\u5355\u5e93: \u8ba2\u5355\u8868, \u8ba2\u5355\u8054\u7cfb\u4eba\u8868; \u8ba2\u5355\u8868\u5206\u5e93\u5206\u8868 order1, order2, order3"),(0,l.kt)("li",{parentName:"ul"},"\u652f\u4ed8\u5e93: \u4ea4\u6613\u8868"),(0,l.kt)("li",{parentName:"ul"},"\u6392\u671f\u5e93: \u6392\u671f\u8868, \u5ea7\u4f4d\u8868, \u6392\u671f\u5ea7\u4f4d\u8868"),(0,l.kt)("li",{parentName:"ul"},"\u7528\u6237\u5e93: \u7528\u6237\u8868, \u8054\u7cfb\u4eba\u8868")),(0,l.kt)("h2",{id:"185-\u9879\u76ee\u7ba1\u7406"},"18.5. \u9879\u76ee\u7ba1\u7406"),(0,l.kt)("p",null,"git"),(0,l.kt)("p",null,"sonarQube \u4ee3\u7801\u7f3a\u9677, \u89c4\u8303"),(0,l.kt)("p",null,"scrum \u654f\u6377\u5f00\u53d1, \u591a\u4e2a\u5de5\u671f, \u5c42\u5c42\u8fed\u4ee3, \u6301\u7eed\u4ea4\u4ed8"),(0,l.kt)("h1",{id:"19-\u6848\u4f8b-\u5728\u7ebf\u6559\u80b2"},"19. \u6848\u4f8b \u5728\u7ebf\u6559\u80b2"),(0,l.kt)("h2",{id:"191-\u884c\u4e1a\u80cc\u666f-and-\u5546\u4e1a\u6a21\u5f0f"},"19.1. \u884c\u4e1a\u80cc\u666f and \u5546\u4e1a\u6a21\u5f0f"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"c2c , \u7cfb\u7edf\u4f5c\u4e3a\u4ea4\u6613\u5e73\u53f0, \u6709\u89c6\u9891\u63d0\u4f9b\u8005 (\u53ef\u80fd\u662f\u4e2a\u4eba\u63d0\u4f9b\u8005, \u6216\u8005\u662f\u4e13\u4e1a\u7684\u8bfe\u7a0b\u5236\u4f5c\u516c\u53f8), \u89c6\u9891\u5b66\u4e60\u8005, \u5982 51cto, \u817e\u8baf\u8bfe\u5802"),(0,l.kt)("li",{parentName:"ul"},"b2c, \u7cfb\u7edf\u81ea\u5df1\u5236\u4f5c\u8bfe\u7a0b, \u4e0a\u4f20\u7cfb\u7edf, \u7ed9\u5b66\u4e60\u8005\u5b66\u4e60, "),(0,l.kt)("li",{parentName:"ul"},"\u5782\u76f4\u9886\u57df, \u4e13\u4f9b\u4e00\u4e2a\u65b9\u5411\u7684\u5b66\u4e60\u8bfe\u7a0b, \u5982 \u7f51\u6613\u4e91\u8bfe\u5802\u7684\u5fae\u4e13\u4e1a"),(0,l.kt)("li",{parentName:"ul"},"\u76f4\u64ad/\u4e92\u52a8 (\u4e00\u5bf9\u591a\u6a21\u5f0f), \u4e3a\u8001\u5e08\u63d0\u4f9b\u76f4\u64ad\u670d\u52a1"),(0,l.kt)("li",{parentName:"ul"},"1 \u5bf9 1 \u6a21\u5f0f, \u5982vipkid, \u5b66\u800c\u601d"),(0,l.kt)("li",{parentName:"ul"},"\u514d\u8d39\u589e\u503c, \u901a\u8fc7\u63d0\u4f9b\u514d\u8d39\u8bfe\u7a0b, \u5438\u5f15\u7528\u6237, \u901a\u8fc7\u63d0\u4f9b\u4e00\u4e9b\u589e\u503c\u670d\u52a1\u8d5a\u94b1, \u5982\u5236\u4f5c\u5b66\u4f4d\u8bc1\u4e66")),(0,l.kt)("h1",{id:"20-\u6848\u4f8b-\u805a\u5408\u652f\u4ed8"},"20. \u6848\u4f8b \u805a\u5408\u652f\u4ed8"),(0,l.kt)("h2",{id:"201-\u805a\u5408\u652f\u4ed8\u6982\u5ff5"},"20.1. \u805a\u5408\u652f\u4ed8\u6982\u5ff5"),(0,l.kt)("p",null,"\u5bf9\u63a5 \u5fae\u4fe1, \u652f\u4ed8\u5b9d, \u94f6\u8054, \u63d0\u4f9b\u7edf\u4e00\u7684\u652f\u4ed8\u5165\u53e3"),(0,l.kt)("p",null,"\u4e3b\u8981\u505a\u6cd5/\u5546\u4e1a\u6a21\u5f0f\u6709\u8fd9\u4e48\u51e0\u79cd: "),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u63d0\u4f9b\u7ebf\u4e0a\u805a\u5408\u6536\u94f6\u53f0(\u5f00\u653e api)  "),(0,l.kt)("li",{parentName:"ul"},"\u7ebf\u4e0b\u63d0\u4f9b\u4e00\u7801\u591a\u4ed8(\u6d88\u8d39\u8005\u626b\u4e00\u4e2a\u4e8c\u7ef4\u7801\u5c31\u80fd\u5fae\u4fe1\u652f\u4ed8\u5b9d...), \u6216\u8005\u53cd\u8fc7\u6765\u5546\u5bb6\u626b\u7801\u6d88\u8d39\u8005\u5b8c\u6210\u652f\u4ed8"),(0,l.kt)("li",{parentName:"ul"},"\u4ee5 SaaS \u670d\u52a1\u4ea4\u4ed8\u7ed9\u5546\u6237\u4f7f\u7528, \u63d0\u4f9b \u8ba2\u5355\u7ba1\u7406, /\u95e8\u5e97\u7ba1\u7406/\u8d22\u52a1\u6570\u636e\u7edf\u8ba1\u7b49\u57fa\u7840\u670d\u52a1, \u4ee5\u652f\u4ed8\u4e3a\u5165\u53e3, \u63d0\u4f9b \u652f\u4ed8\u9875\u5e7f\u544a\u8425\u9500/\u91d1\u878d\u8d37\u6b3e...\u7b49\u670d\u52a1")),(0,l.kt)("h2",{id:"202-\u96c6\u5408\u652f\u4ed8\u9879\u76ee\u67b6\u6784"},"20.2. \u96c6\u5408\u652f\u4ed8\u9879\u76ee\u67b6\u6784"),(0,l.kt)("p",null,"\u5305\u62ec\u8fd9\u4e9b\u5b50\u7cfb\u7edf: \u5b98\u7f51/\u5f00\u653e\u5e73\u53f0, \u5546\u6237\u7cfb\u7edf, \u8fd0\u8425\u7cfb\u7edf"),(0,l.kt)("p",null,"\u67b6\u6784:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u7528\u6237\u5c42: app, h5, pc"),(0,l.kt)("li",{parentName:"ul"},"cdn: \u5206\u53d1\u9759\u6001\u8d44\u6e90, \u5982 js, css, \u56fe\u7247, \u89c6\u9891"),(0,l.kt)("li",{parentName:"ul"},"load balance: 4 \u5c42\u8d1f\u8f7d\u5747\u8861, 7 \u5c42\u8d1f\u8f7d\u5747\u8861"),(0,l.kt)("li",{parentName:"ul"},"UI \u5c42: \u524d\u7aef\u9875\u9762"),(0,l.kt)("li",{parentName:"ul"},"\u63a5\u5165\u5c42: \u7f51\u5173, oauth2"),(0,l.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5c42: \u57fa\u7840\u670d\u52a1, \u4e1a\u52a1\u670d\u52a1"),(0,l.kt)("li",{parentName:"ul"},"\u6570\u636e\u5c42: MySQL,  \u7f13\u5b58, \u961f\u5217, \u7d22\u5f15(es), \u6587\u4ef6\u5b58\u50a8")),(0,l.kt)("h2",{id:"203-\u652f\u4ed8\u4e1a\u52a1\u6d41\u7a0b"},"20.3. \u652f\u4ed8\u4e1a\u52a1\u6d41\u7a0b"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5546\u6237\u6ce8\u518c"),(0,l.kt)("li",{parentName:"ol"},"\u540e\u53f0\u5ba1\u6838 (\u67e5\u8d44\u8d28, \u8425\u4e1a\u6267\u7167...)")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u5219\u653e\u884c"),(0,l.kt)("li",{parentName:"ul"},"\u4e0d\u901a\u8fc7\u5219\u901a\u77e5\u7533\u8bf7\u5546\u6237")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5546\u6237\u8d2d\u4e70\u5957\u9910, \u521b\u5efa\u5e94\u7528(\u5373\u5728\u805a\u5408\u652f\u4ed8\u5e73\u53f0\u521b\u5efa\u4e00\u4e2a\u4e1a\u52a1\u6807\u8bc6, \u8868\u793a\u652f\u4ed8\u670d\u52a1\u8981\u7528\u5230\u4ec0\u4e48\u4e1a\u52a1), \u586b\u5199\u652f\u4ed8\u6e20\u9053\u53c2\u6570(\u82e5\u5546\u6237\u6d89\u53ca\u5230\u81ea\u5df1\u5f00\u53d1\u5e94\u7528, \u8fd8\u9700\u8981\u96c6\u6210)"),(0,l.kt)("li",{parentName:"ol"},"\u5546\u6237\u6d4b\u8bd5/\u4e0a\u7ebf"),(0,l.kt)("li",{parentName:"ol"},"\u6d88\u8d39\u8005\u6d88\u8d39\u652f\u4ed8\u7ed9\u5546\u6237")),(0,l.kt)("h1",{id:"21-\u6848\u4f8b-\u5e7f\u544a\u7cfb\u7edf"},"21. \u6848\u4f8b \u5e7f\u544a\u7cfb\u7edf"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://www.modb.pro/db/32755"},"https://www.modb.pro/db/32755"),"\n",(0,l.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/zhangpan1244/category/1522751.html"},"https://www.cnblogs.com/zhangpan1244/category/1522751.html")),(0,l.kt)("h2",{id:"211-\u5e7f\u544a\u6982\u5ff5"},"21.1. \u5e7f\u544a\u6982\u5ff5"),(0,l.kt)("p",null,"ad system: \u7ec8\u7aef\u6839\u636e\u6761\u4ef6\u6570\u636e\u8bf7\u6c42\u5e7f\u544a\u7cfb\u7edf, \u8fd4\u56de\u5408\u9002\u7684\u5e7f\u544a\u6570\u636e, \u5c55\u793a\u7ed9\u6d4f\u89c8\u8005"),(0,l.kt)("p",null,"\u89d2\u8272: \u5e73\u53f0\u65b9, \u5e7f\u544a\u4e3b, \u5a92\u4f53\u65b9, \u5e7f\u544a\u6d88\u8d39\u8005"),(0,l.kt)("p",null,"\u56e0\u4e3a\u5a92\u4f53\u6570\u91cf\u4f1a\u4e0d\u65ad\u589e\u957f\uff0c\u56e0\u6b64\u5e7f\u544a\u6295\u653e\u7cfb\u7edf\u662f\u5177\u6709\u9ad8\u5e76\u53d1\u3001\u4f4e\u5ef6\u8fdf\u7684\u7279\u70b9"),(0,l.kt)("p",null,"\u529f\u80fd:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5e7f\u544a\u4e3b\u7684\u5e7f\u544a\u6295\u653e, \u5982",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7528\u6237\u8d26\u6237, \u5982\u5b9d\u9a6c\u516c\u53f8"),(0,l.kt)("li",{parentName:"ul"},"\u63a8\u5e7f\u8ba1\u5212, \u5982\u5e7f\u544a\u4e3b\u5236\u5b9a\u4e86\u4e00\u4e2a\u8ba1\u5212, \u5b9d\u9a6c x6 \u63a8\u5e7f\u8ba1\u5212, \u8fd9\u4e2a\u63a8\u5e7f\u8ba1\u5212\u5305\u542b\u591a\u4e2a\u63a8\u5e7f\u5355\u5143"),(0,l.kt)("li",{parentName:"ul"},"\u63a8\u5e7f\u5355\u5143, \u7528\u6765\u505a\u9650\u5236\u52a8\u4f5c, \u8bf7\u6c42\u547d\u4e2d\u4e00\u4e2a\u63a8\u5e7f\u5355\u5143\u540e, \u4f1a\u8fd4\u56de\u4e00\u4e2a/\u591a\u4e2a\u521b\u610f\u7269\u6599",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5173\u952e\u8bcd\u63a8\u5e7f\u5355\u5143, \u5982, \u53ea\u6709\u5305\u542b\u6307\u5b9a\u5173\u952e\u8bcd\u7684\u8bf7\u6c42\u624d\u4f1a\u547d\u4e2d\u8fd9\u4e2a\u5e7f\u544a\u5355\u5143"),(0,l.kt)("li",{parentName:"ul"},"\u5730\u57df\u63a8\u5e7f\u5355\u5143, \u5982\u53ea\u6709\u6765\u81ea\u6307\u5b9a\u533a\u57df\u7684\u8bf7\u6c42\u624d\u4f1a\u547d\u4e2d\u5e7f\u544a\u5355\u5143"),(0,l.kt)("li",{parentName:"ul"},"\u5174\u8da3\u63a8\u5e7f\u5355\u5143, "),(0,l.kt)("li",{parentName:"ul"},"\u4eba\u7fa4\u63a8\u5e7f\u5355\u5143"))),(0,l.kt)("li",{parentName:"ul"},"\u521b\u610f\u7269\u6599, \u6587\u672c, \u56fe\u7247, \u89c6\u9891..., \u6bcf\u4e2a\u521b\u610f\u90fd\u53ef\u4ee5\u6dfb\u52a0\u5230\u4e00\u4e2a/\u591a\u4e2a\u63a8\u5e7f\u5355\u5143\u4e0a"))),(0,l.kt)("li",{parentName:"ul"},"\u5a92\u4f53\u65b9\u7684\u5e7f\u544a\u66dd\u5149 (\u6392\u5e8f: \u5e73\u53f0\u65b9\u6536\u76ca\u4f9d\u6b21\u51cf\u5c11, \u5e7f\u544a\u4e3b\u6536\u76ca\u4e00\u6b21\u589e\u52a0); ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"cpt \u6309\u65f6\u95f4\u6536\u8d39 cost per time (",(0,l.kt)("a",{parentName:"li",href:"https://zhuanlan.zhihu.com/p/146391463"},"https://zhuanlan.zhihu.com/p/146391463")," \u6982\u5ff5\u68b3\u7406, ",(0,l.kt)("a",{parentName:"li",href:"https://zhuanlan.zhihu.com/p/25265028"},"https://zhuanlan.zhihu.com/p/25265028")," \u6295\u653e\u7ecf\u9a8c)"),(0,l.kt)("li",{parentName:"ul"},"cpm \u6309\u5343\u6b21\u5c55\u73b0\u6536\u8d39 cost per mille"),(0,l.kt)("li",{parentName:"ul"},"cpc \u6309\u70b9\u51fb\u6536\u8d39 cost per click",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8d85\u6295: \u5bf9\u4e8eCPC\u5e7f\u544a\u6765\u8bf4\uff0c\u5373\u4f7f\u8ba1\u8d39\u7cfb\u7edf\u53ca\u65f6\u53d1\u51fa\u4e0b\u7ebf\u53cd\u9988\uff0c\u4f46\u90a3\u4e9b\u5df2\u7ecf\u6295\u653e\u51fa\u53bb\u3001\u5c1a\u672a\u4ea7\u751f\u70b9\u51fb\u7684\u5e7f\u544a\u4ecd\u7136\u4f1a\u53ef\u80fd\u4ea7\u751f\u8d85\u6295\u3002\u56e0\u6b64\u8d85\u6295\u53ea\u80fd\u63a7\u5236\u5728\u4e00\u5b9a\u8303\u56f4\u4e4b\u5185\uff0c\u5e76\u4e0d\u80fd\u5b8c\u5168\u675c\u7edd"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://www.infoq.cn/article/using-kafka-streams-api-for-predictive-budgeting/"},"\u57fa\u4e8eKafka Streams\u6784\u5efa\u5e7f\u544a\u6d88\u8017\u9884\u6d4b\u7cfb\u7edf")),(0,l.kt)("li",{parentName:"ul"},"\u5bf9\u9884\u7b97\u5c06\u8fd1\u7684\u5e7f\u544a\u8ba1\u5212\uff0c\u6295\u653e\u7cfb\u7edf\u4e5f\u5e94\u8be5\u964d\u4f4e\u6295\u653e\u9891\u7387\uff0c\u4f7f\u9884\u7b97\u6781\u53ef\u80fd\u5e73\u6ed1\u5730\u8fbe\u5230\u4e0a\u9650\u3002"))),(0,l.kt)("li",{parentName:"ul"},"cpa \u6309\u884c\u4e3a\u6536\u8d39 \u5982\u6ce8\u518c.\u4e0b\u8f7d")))),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u4e4b\u6240\u4ee5\u6709\u4e0d\u540c\u7684\u7ed3\u7b97\u65b9\u5f0f\uff0c\u5176\u5b9e\u4e5f\u662f\u968f\u7740\u5e7f\u544a\u5e02\u573a\u7684\u53d1\u5c55\u9010\u6e10\u884d\u751f\u51fa\u6765\u7684\uff0c\u6700\u5f00\u59cb\u6d41\u91cf\u7a00\u7f3a\uff0c\u5e73\u53f0\u5360\u4f18\u52bf\uff0c\u518d\u5230\u4eca\u5929\u9010\u6e10\u6210\u4e86\u4e70\u65b9\u5e02\u573a\uff0c\u5e7f\u544a\u4e3b\u4f5c\u4e3a\u9700\u6c42\u65b9\u7684\u8c08\u5224\u6743\u53d8\u5927\u3002\n\u6309CPA\u7ed3\u7b97\u65f6\u5bf9\u5e7f\u544a\u4e3b\u6700\u6709\u5229\uff0c\u4f46\u662f\u5bf9\u5e73\u53f0\u6700\u4e0d\u5229\u3002\u7ed3\u7b97\u65b9\u5f0f\u6f14\u8fdb\u5230\u4eca\u5929\uff0c\u5176\u5b9e\u4e5f\u662f\u4e00\u79cd\u5e73\u8861\uff0c\u6240\u4ee5\u5904\u4e8e\u5e73\u8861\u70b9\u9644\u8fd1\u7684CPM\u548cCPC\u662f\u6700\u5e38\u89c1\u7684\u7ed3\u7b97\u65b9\u5f0f\u3002")),(0,l.kt)("h2",{id:"212-\u7cfb\u7edf\u7ec4\u6210"},"21.2. \u7cfb\u7edf\u7ec4\u6210"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6295\u653e\u7cfb\u7edf, \u6700\u524d\u7aef, \u7ed9\u5e7f\u544a\u4e3b\u4f7f\u7528; ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4f1a\u5458\u7eed\u8d39\u3001\u5e7f\u544a\u5e93\u7ba1\u7406\u3001\u8bbe\u5b9a\u63a8\u5e7f\u6761\u4ef6\u3001\u8bbe\u7f6e\u5e7f\u544a\u51fa\u4ef7\u3001\u67e5\u770b\u6295\u653e\u6548\u679c"))),(0,l.kt)("li",{parentName:"ul"},"\u68c0\u7d22\u7cfb\u7edf, \u8d1f\u8d23\u627f\u63a5C\u7aef\u7684\u6d41\u91cf\u8bf7\u6c42\uff0c\u4ece\u6d77\u91cf\u5e7f\u544a\u5e93\u4e2d\u7b5b\u9009\u51fa\u6700\u5408\u9002\u7684\u524dN\u4e2a\u5e7f\u544a\uff0c\u5e76\u5728\u51e0\u5341\u6beb\u79d2\u5185\u8fd4\u56de\u7ed3\u679c\uff0c\u5b83\u662f\u4e00\u4e2a\u591a\u7ea7\u7b5b\u9009\u548c\u6392\u5e8f\u7684\u8fc7\u7a0b\u3002",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5a92\u4f53\u65b9\u4f7f\u7528, \u6bd4\u5982 app, \u5730\u94c1\u901a\u9053\u5927\u5c4f, \u7f51\u9875\u8fb9\u680f "),(0,l.kt)("li",{parentName:"ul"},"\u5173\u6ce8\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4"),(0,l.kt)("li",{parentName:"ul"},"\u5012\u6392\u7d22\u5f15: \u4e3b\u8981\u7528\u4e8e\u5404\u4e2a\u5e7f\u544a\u9650\u5236\u7ef4\u5ea6\u7684\u68c0\u7d22; \u5982, \u5bf9\u4e8e table(unit_id, province, city), \u6839\u636e\u5730\u57df province/city \u627e\u5230 unitID;",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u521d\u671f\u8003\u8651\u5b58\u5728 redis, \u5e7f\u544a\u6570\u636e\u591a\u4e86, \u4e0a elasticsearch  "))),(0,l.kt)("li",{parentName:"ul"},"\u7d22\u5f15\u7ef4\u62a4\u65b9\u5f0f: \u5168\u91cf\u7d22\u5f15 + \u589e\u91cf\u7d22\u5f15; \u68c0\u7d22\u7cfb\u7edf\u542f\u52a8, \u52a0\u8f7d\u5168\u91cf\u7d22\u5f15(\u542f\u52a8\u65f6\u95f4\u70b9\u524d\u7684\u6570\u636e\u5168\u90e8\u5bfc\u51fa\u5230\u6587\u4ef6\u4e2d\u6210\u4e3a\u5168\u91cf\u7d22\u5f15), \u4e4b\u540e\u68c0\u7d22\u7cfb\u7edf\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4e0d\u65ad\u6dfb\u52a0\u589e\u91cf\u7d22\u5f15(\u5404\u4e2a\u8868\u7684\u5199\u64cd\u4f5c)"))),(0,l.kt)("li",{parentName:"ul"},"\u8ba1\u8d39\u7cfb\u7edf, \u6838\u5fc3\u4efb\u52a1\u662f\u4fdd\u8bc1\u5e7f\u544a\u6295\u653e\u5728\u9884\u7b97\u8303\u56f4\u4e4b\u5185\uff0c\u5c3d\u53ef\u80fd\u5730\u907f\u514d\u53d1\u751f\u8d85\u6295 \u5f3a\u8c03\u6570\u636e\u5b9e\u65f6\u6027",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5e7f\u544a\u4e3b\u9700\u8981\u9884\u5148\u5145\u503c\u4e00\u5b9a\u7684\u9884\u7b97, \u6263\u5149\u4e86\u5c31\u4e0d\u7ed9\u4ed6\u5c55\u73b0\u5e7f\u544a\u4e86"),(0,l.kt)("li",{parentName:"ul"},"\u9762\u5411C\u7aef/\u5a92\u4f53\u65b9\uff0c\u8d1f\u8d23\u5b9e\u65f6\u6263\u8d39\uff0c\u548c\u6536\u5165\u76f4\u63a5\u6302\u94a9\uff0c\u53ef\u7528\u6027\u8981\u6c42\u9ad8"))),(0,l.kt)("li",{parentName:"ul"},"\u7ed3\u7b97\u7cfb\u7edf, \u7ed3\u7b97\u7cfb\u7edf\u63d0\u4f9b\u7684\u662f\u5e7f\u544a\u5e73\u53f0\u4e0e\u5e7f\u544a\u4e3b\u4e4b\u95f4\u8d39\u7528\u7ed3\u7b97\u670d\u52a1\uff0c\u5f3a\u8c03\u6570\u636e\u51c6\u786e\u5ea6, \u5305\u62ec\u5145\u503c\u3001\u51bb\u7ed3\u3001\u6263\u8d39\u7b49\u3002",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4e00\u822c\u4f1a\u4ee5\u79bb\u7ebf\u6570\u636e\u4e3a\u57fa\u7840\u8fdb\u884c\u8ba1\u7b97\uff0c\u9996\u5148\uff0c\u8fd9\u6837\u53ef\u4ee5\u4ee5\u8f83\u5c11\u7684\u6210\u672c\u4fdd\u8bc1\u6570\u636e\u5b8c\u6574\u6027\uff0c\u56e0\u4e3a\u5982\u679c\u50cf\u8ba1\u8d39\u7cfb\u7edf\u90a3\u6837\u4e00\u6765\u5b9e\u65f6\u6d41\u8ba1\u7b97\uff0c\u5c31\u4e0d\u53ef\u907f\u514d\u5730\u8981\u9762\u4e34\u670d\u52a1\u53ef\u7528\u6027\u95ee\u9898"),(0,l.kt)("li",{parentName:"ul"},"\u7ed3\u7b97\u7cfb\u7edf\u4e0e\u8ba1\u8d39\u7cfb\u7edf\u867d\u7136\u90fd\u63d0\u4f9b\u4e86\u8d39\u7528\u8ba1\u7b97\u7684\u529f\u80fd\uff0c\u4f46\u4fa7\u91cd\u70b9\u4e0d\u540c\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u901a\u5e38\u4f1a\u5f15\u5165\u201c\u53cd\u4f5c\u5f0a\u201d\u7684\u529f\u80fd\uff08\u6bd4\u5982\u4e00\u4e2a\u7528\u6237\u77ed\u65f6\u95f4\u5185\u591a\u6b21\u70b9\u51fb\uff0c\u53ea\u6536\u53d6\u4e00\u6b21\u70b9\u51fb\u7684\u8d39\u7528\uff09"))),(0,l.kt)("li",{parentName:"ul"},"\u66dd\u5149\u68c0\u6d4b\u7cfb\u7edf, \u7ed9\u4e24\u62e8\u4eba\u770b\u7684, \u5305\u542b\u6709\u6211\u4eec\u81ea\u8eab\u7684\u68c0\u6d4b\u7cfb\u7edf\u548c\u7b2c\u4e09\u65b9\u7684\u76d1\u6d4b\u7cfb\u7edf (\u53ef\u80fd\u5e7f\u544a\u4e3b\u4e0d\u4fe1\u4efb\u5e73\u53f0, \u9700\u8981\u8bf7\u7b2c\u4e09\u65b9\u53c2\u4e0e\u76d1\u63a7, \u5bf9\u6bd4\u7b2c\u4e09\u65b9\u548c\u6211\u4eec\u81ea\u5df1\u7684\u76d1\u6d4b, \u5dee\u522b\u4e0d\u5927\u624d\u4f1a\u5fc3\u7518\u60c5\u613f\u4ed8\u8d39  )"),(0,l.kt)("li",{parentName:"ul"},"\u8fd0\u8425\u540e\u53f0, \u7ed9\u8fd0\u8425\u4eba\u5458\u67e5\u770b\u6548\u679c\u62a5\u8868\u7cfb\u7edf, \u5982\u5c55\u793a\u4e86\u591a\u5c11, \u66dd\u5149\u4e86\u591a\u5c11, \u6709\u591a\u5c11\u5e7f\u544a\u8bf7\u6c42\u6ca1\u6709\u68c0\u7d22\u5230\u5e7f\u544a\u6570\u636e, \u518d\u5c31\u662f",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6838\u5fc3\u529f\u80fd\u5305\u62ec\u5e7f\u544a\u4f4d\u7ba1\u7406\u3001\u5e7f\u544a\u7b56\u7565\u7ba1\u7406\u3001\u4ee5\u53ca\u5404\u79cd\u8fd0\u8425\u5de5\u5177"))),(0,l.kt)("li",{parentName:"ul"},"AB\u5b9e\u9a8c\u5e73\u53f0, \u5e7f\u544a\u4e1a\u52a1\u7684\u7a33\u5b9a\u5668\uff0c\u4efb\u4f55\u5e7f\u544a\u7b56\u7565\u4e0a\u7684\u8c03\u6574\u5747\u53ef\u4ee5\u901a\u8fc7\u6b64\u5e73\u53f0\u8fdb\u884c\u7070\u5ea6\u5b9e\u9a8c\uff0c\u89c2\u5bdf\u6536\u5165\u6307\u6807\u7684\u53d8\u5316"),(0,l.kt)("li",{parentName:"ul"},"\u5927\u6570\u636e\u5e73\u53f0: \u6574\u4e2a\u5e7f\u544a\u7cfb\u7edf\u7684\u5e95\u76d8\uff0c\u9700\u8981\u805a\u5408\u5404\u79cd\u5f02\u6784\u6570\u636e\u6e90\uff0c\u5b8c\u6210\u79bb\u7ebf\u548c\u5b9e\u65f6\u6570\u636e\u5206\u6790\u548c\u7edf\u8ba1\uff0c\u4ea7\u51fa\u4e1a\u52a1\u62a5\u8868\uff0c\u751f\u4ea7\u6a21\u578b\u7279\u5f81\u7b49")),(0,l.kt)("p",null,"\u62d3\u5c55:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6dfb\u52a0\u66f4\u591a\u7684\u5e7f\u544a\u68c0\u7d22\u7ef4\u5ea6, \u5982\u5730\u57df, \u5174\u8da3"),(0,l.kt)("li",{parentName:"ul"},"\u7528\u6237\u753b\u50cf"),(0,l.kt)("li",{parentName:"ul"},"ai")),(0,l.kt)("h2",{id:"213-\u5e7f\u544a\u7684\u6838\u5fc3\u4e1a\u52a1\u6d41\u7a0b"},"21.3. \u5e7f\u544a\u7684\u6838\u5fc3\u4e1a\u52a1\u6d41\u7a0b"),(0,l.kt)("p",null,"\u7cbe\u51c6\u5b9a\u5411\u4ee5\u53ca\u5b9e\u65f6\u7ade\u4ef7\u662f\u76ee\u524d\u6700\u4e3b\u6d41\u7684\u4e1a\u52a1\u5f62\u6001, \u968f\u7740\u5e73\u53f0\u6d41\u91cf\u4ee5\u53ca\u5e7f\u544a\u4e3b\u89c4\u6a21\u8fdb\u4e00\u6b65\u589e\u5927\uff0c\u5f80\u5f80\u4f1a\u4ece\u300c\u81ea\u8425\u578b\u7ade\u4ef7\u7f51\u7edc\u300d\u9010\u6e10\u5411\u300c\u8054\u76df\u5e7f\u544a\u4ee5\u53caRTB\u5b9e\u65f6\u7ade\u4ef7\u300d\u65b9\u5411\u53d1\u5c55\uff0c\u7c7b\u4f3c\u4e8e\u963f\u91cc\u5988\u5988\u3001\u817e\u8baf\u5e7f\u70b9\u901a\u3001\u5934\u6761\u5de8\u91cf\u5f15\u64ce"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5e7f\u544a\u4e3b\u5148\u901a\u8fc7\u6295\u653e\u5e73\u53f0\u53d1\u5e03\u5e7f\u544a\uff0c\u53ef\u8bbe\u7f6e\u4e00\u7cfb\u5217\u7684\u5b9a\u5411\u6761\u4ef6\uff0c\u6bd4\u5982\u6295\u653e\u57ce\u5e02\u3001\u6295\u653e\u65f6\u95f4\u6bb5\u3001\u4eba\u7fa4\u6807\u7b7e\u3001\u51fa\u4ef7\u7b49"),(0,l.kt)("li",{parentName:"ol"},"\u6295\u653e\u52a8\u4f5c\u5b8c\u6210\u540e\uff0c\u5e7f\u544a\u4f1a\u88ab\u5b58\u653e\u5230\u5e7f\u544a\u5e93\u3001\u540c\u65f6\u8fdb\u5165\u7d22\u5f15\u5e93\uff0c\u4ee5\u4fbf\u80fd\u88ab\u5e7f\u544a\u68c0\u7d22\u7cfb\u7edf\u68c0\u7d22\u3002"),(0,l.kt)("li",{parentName:"ol"},"C\u7aef\u8bf7\u6c42\u8fc7\u6765\u540e\uff0c\u5e7f\u544a\u68c0\u7d22\u7cfb\u7edf\u4f1a\u5b8c\u6210\u53ec\u56de\u3001\u7b97\u6cd5\u7b56\u7565\u3001\u7ade\u4ef7\u6392\u5e8f\u7b49\u4e00\u7cfb\u5217\u7684\u903b\u8f91\uff0c\u6700\u7ec8\u7b5b\u9009\u51faTop N\u4e2a\u5e7f\u544a\uff0c\u5b9e\u73b0\u5e7f\u544a\u7684\u5343\u4eba\u5343\u9762")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5a92\u4f53\u65b9\u9700\u8981\u5148\u884c\u5728\u5e7f\u544a\u68c0\u7d22\u7cfb\u7edf\u4e2d\u6ce8\u518c, \u8bf7\u6c42\u65f6, \u643a\u5e26\u8fd9\u4e9b\u53c2\u6570: \u5a92\u4f53\u65b9\u6807\u8bc6, \u5339\u914d\u4fe1\u606f (\u5730\u57df/\u5174\u8da3/\u5173\u952e\u5b57, \u903b\u8f91\u64cd\u4f5c\u7b26 and/or), \u57fa\u672c\u4fe1\u606f(\u8bf7\u6c42 id, \u8bbe\u5907\u4fe1\u606f, \u5e7f\u544a\u4f4d\u4fe1\u606f...)"),(0,l.kt)("li",{parentName:"ul"},"\u54cd\u5e94: \u5e7f\u544a\u521b\u610f(\u4e00\u4e2a\u6216\u591a\u4e2a)")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u7528\u6237\u70b9\u51fb\u5e7f\u544a\u540e\uff0c\u4f1a\u89e6\u53d1\u5e7f\u544a\u6263\u8d39\u6d41\u7a0b\uff0c\u8fd9\u65f6\u5019\u5e73\u53f0\u624d\u7b97\u771f\u6b63\u83b7\u5f97\u6536\u76ca")),(0,l.kt)("h2",{id:"214-\u6280\u672f\u96be\u70b9"},"21.4. \u6280\u672f\u96be\u70b9"),(0,l.kt)("h3",{id:"2141-\u5e7f\u544a\u6570\u636e\u7684\u5b58\u50a8"},"21.4.1. \u5e7f\u544a\u6570\u636e\u7684\u5b58\u50a8"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"OLTP\u573a\u666f, \u5b58\u50a8\u5728\u652f\u6301\u4e8b\u52a1\u7684 db \u4e2d\uff0c\u5305\u62ec\u5e7f\u544a\u5e93\u3001\u521b\u610f\u5e93\u3001\u4f1a\u5458\u5e93\u3001\u5e7f\u544a\u4ea7\u54c1\u5e93\u3001\u5e7f\u544a\u7b56\u7565\u5e93\u7b49\uff0c\u8fd9\u4e9b\u90fd\u5b58\u50a8\u5728MySQL\u4e2d\uff0c\u6570\u636e\u89c4\u6a21\u8f83\u5927\u7684\u5e7f\u544a\u5e93\u548c\u521b\u610f\u5e93\uff0c\u6309\u7167\u5e7f\u544a\u4e3bID Hash\u505a\u5206\u5e93\u5206\u8868\u3002"),(0,l.kt)("li",{parentName:"ul"},"OLAP\u573a\u666f\uff0c\u6d89\u53ca\u5230\u975e\u5e38\u591a\u7684\u62a5\u8868\uff0c\u805a\u5408\u7ef4\u5ea6\u591a\uff0c\u5355\u8868\u7684\u8bb0\u5f55\u6570\u53ef\u80fd\u8fbe\u5230\u767e\u4ebf\u7ea7\u522b\uff0c\u5e95\u5c42\u91c7\u7528HDFS\u548cHBase\u5b58\u50a8\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u9762\u5411\u5e7f\u544a\u68c0\u7d22\u573a\u666f\u7684\u7d22\u5f15\u6570\u636e\uff0c\u5305\u62ec\u6b63\u6392\u7d22\u5f15\u548c\u5012\u6392\u7d22\u5f15\uff0c\u91c7\u7528Redis\u548cES\u6765\u5b58\u50a8"),(0,l.kt)("li",{parentName:"ul"},"\u5e7f\u544a\u7684\u540c\u6b65\u95ee\u9898\u3002\u5e7f\u544a\u6295\u653e\u5b8c\u6210\u540e\uff0c\u9996\u5148\u4f1a\u5b58\u50a8\u5728MySQL\u6570\u636e\u5e93\u4e2d\uff0c\u63a5\u4e0b\u6765\u9700\u8981\u628a\u5e7f\u544a\u5b9e\u65f6\u4f20\u8f93\u5230\u68c0\u7d22\u7cfb\u7edf\u4e2d\uff0c\u5b8c\u6210\u6b63\u6392\u7d22\u5f15\u4ee5\u53ca\u5012\u6392\u7d22\u5f15\u7684\u66f4\u65b0",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5404\u4e2a\u4e1a\u52a1\u7cfb\u7edf\u5728\u63a8\u5e7f\u3001\u4f59\u989d\u7b49\u4fe1\u606f\u53d8\u66f4\u65f6\uff0c\u53d1MQ\u6d88\u606f\uff0c\u7d22\u5f15\u66f4\u65b0\u670d\u52a1\u8ba2\u9605MQ\u6765\u611f\u77e5\u53d8\u5316\uff0c\u5b8c\u6210\u589e\u91cf\u540c\u6b65"),(0,l.kt)("li",{parentName:"ul"},"\u53d8\u66f4\u7684\u6d88\u606f\u4f53\u4e2d\uff0c\u4e0d\u4f20\u9012\u5b9e\u9645\u53d8\u66f4\u7684\u5b57\u6bb5\uff0c\u4ec5\u901a\u77e5\u6709\u53d8\u5316\u7684\u5e7f\u544aID\uff0c\u7d22\u5f15\u66f4\u65b0\u670d\u52a1\u5b9e\u65f6\u8bfb\u53d6\u6700\u65b0\u6570\u636e\u5b8c\u6210\u66f4\u65b0\uff0c\u8fd9\u6837\u53ef\u4ee5\u6709\u6548\u7684\u89e3\u51b3\u6d88\u606f\u4e71\u5e8f\u5f15\u8d77\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898"),(0,l.kt)("li",{parentName:"ul"},"\u5f53\u66f4\u65b0\u7d22\u5f15\u7684\u5e76\u53d1\u8fbe\u5230\u4e00\u5b9a\u91cf\u7ea7\u540e\uff0c\u53ef\u901a\u8fc7\u5408\u5e76\u76f8\u540c\u5e7f\u544a\u7684\u53d8\u66f4\u3001\u6216\u8005\u5c06\u5012\u6392\u548c\u6b63\u6392\u66f4\u65b0\u5206\u79bb\u7684\u65b9\u5f0f\u6765\u63d0\u5347\u6574\u4f53\u7684\u66f4\u65b0\u901f\u5ea6\u3002")))),(0,l.kt)("h3",{id:"2142-\u5e7f\u544a\u6570\u636e\u68c0\u7d22"},"21.4.2. \u5e7f\u544a\u6570\u636e\u68c0\u7d22"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u91c7\u7528Redis\u7f13\u5b58\uff0c\u7f13\u5b58\u53ef\u6309\u4e1a\u52a1\u89c4\u5212\u591a\u5957\uff0c\u8fdb\u884c\u5206\u6d41\u3002\u7cbe\u7b80RPC\u8fd4\u56de\u7ed3\u679c\u6216\u8005Redis\u7f13\u5b58\u5bf9\u8c61\u7684\u7ed3\u6784\uff0c\u53bb\u6389\u4e0d\u5fc5\u8981\u7684\u5b57\u6bb5\uff0c\u51cf\u5c11IO\u6570\u636e\u5305\u5927\u5c0f\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u70ed\u70b9\u6570\u636e\u5efa\u7acb\u672c\u5730\u7d22\u5f15 (\u5373\u5185\u5b58 map, \u4f7f\u7528 concurrentmap)\uff0c\u6bd4\u5982\u5e7f\u544a\u4f4d\u7684\u914d\u7f6e\u4fe1\u606f\u4ee5\u53ca\u7b56\u7565\u914d\u7f6e\u4fe1\u606f\uff0c\u5728\u670d\u52a1\u542f\u52a8\u65f6\u5c31\u53ef\u4ee5\u9884\u52a0\u8f7d\u5230\u672c\u5730\uff0c\u7136\u540e\u5b9a\u65f6\u8fdb\u884c\u540c\u6b65\u3002(\u542f\u52a8\u65f6, \u52a0\u8f7d\u5168\u91cf\u7d22\u5f15, \u8fd0\u884c\u4e2d, \u4e0d\u65ad\u52a0\u8f7d\u589e\u91cf\u7d22\u5f15)"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u589e\u91cf\u7d22\u5f15: \u8ba2\u9605 MySQL \u7684 binglog "))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u91c7\u7528\u591a\u7ebf\u7a0b\u5e76\u884c\u5316\u67d0\u4e9b\u5b50\u6d41\u7a0b\uff0c\u6bd4\u5982\u591a\u8def\u53ec\u56de\u903b\u8f91\u3001\u591a\u6a21\u578b\u6253\u5206\u903b\u8f91")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u548c\u4e3b\u6d41\u7a0b\u65e0\u5173\u7684\u903b\u8f91\u5f02\u6b65\u6267\u884c\uff0c\u6bd4\u5982\u6263\u8d39\u4fe1\u606f\u7f13\u5b58\u3001\u53ec\u56de\u7ed3\u679c\u7f13\u5b58\u7b49")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u975e\u6838\u5fc3\u6d41\u7a0b\u8bbe\u7f6e\u8d85\u65f6\u7194\u65ad\u8d70\u964d\u7ea7\u903b\u8f91\uff0c\u6bd4\u5982\u6ea2\u4ef7\u7b56\u7565\uff08\u4e0d\u6ea2\u4ef7\u53ea\u662f\u5c11\u8d5a\u4e86\uff0c\u4e0d\u5f71\u54cd\u5e7f\u544a\u68c0\u7d22\u53ec\u56de\uff09\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"GC\u4f18\u5316\uff0c\u5305\u62ecJVM\u5806\u5185\u5b58\u7684\u8bbe\u7f6e\u3001\u5783\u573e\u6536\u96c6\u5668\u7684\u9009\u62e9\u3001GC\u9891\u6b21\u4f18\u5316\u548cGC\u8017\u65f6\u4f18\u5316\u3002"))),(0,l.kt)("h3",{id:"2143-\u8ba1\u8d39\u5e73\u53f0\u7684\u6280\u672f\u65b9\u6848"},"21.4.3. \u8ba1\u8d39\u5e73\u53f0\u7684\u6280\u672f\u65b9\u6848"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6263\u8d39\u6d41\u7a0b\u505a\u4e86\u5f02\u6b65\u5316\u5904\u7406\uff0c\u5f53\u6536\u5230\u5b9e\u65f6\u6263\u8d39\u8bf7\u6c42\u540e\uff0c\u7cfb\u7edf\u5148\u5c06\u6263\u8d39\u65f6\u7528\u5230\u7684\u4fe1\u606f\u7f13\u5b58\u5230Redis\uff0c\u7136\u540e\u53d1\u9001MQ\u6d88\u606f\uff0c\u8fd9\u4e24\u6b65\u5b8c\u6210\u540e\u6263\u8d39\u52a8\u4f5c\u5c31\u7b97\u7ed3\u675f\u4e86, \u5229\u7528MQ\u7684\u53ef\u9760\u6027\u6295\u9012\u548c\u91cd\u8bd5\u673a\u5236\u786e\u4fdd\u6574\u4e2a\u6263\u8d39\u6d41\u7a0b\u7684\u6700\u7ec8\u4e00\u81f4\u6027"),(0,l.kt)("li",{parentName:"ul"},"\u4e3a\u4e86\u63d0\u9ad8\u53ef\u7528\u6027\uff0c\u9488\u5bf9Redis\u548cMQ\u4e0d\u53ef\u7528\u7684\u60c5\u51b5\u5747\u91c7\u7528\u4e86\u964d\u7ea7\u65b9\u6848\u3002Redis\u4e0d\u53ef\u7528\u65f6\uff0c\u5207\u6362\u5230TiKV(\u5206\u5e03\u5f0f\u952e\u503c\u5bf9\u5b58\u50a8\u6570\u636e\u5e93)\u8fdb\u884c\u6301\u4e45\u5316\uff1bMQ\u6295\u9012\u5931\u8d25\u65f6\uff0c\u6539\u6210\u7ebf\u7a0b\u6c60\u5f02\u6b65\u5904\u7406\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u6bcf\u6b21\u6709\u6548\u70b9\u51fb\u90fd\u9700\u8981\u751f\u62101\u6761\u6263\u8d39\u8ba2\u5355\uff0c\u9762\u4e34\u5927\u6570\u636e\u91cf\u7684\u5b58\u50a8\u95ee\u9898\u3002\u76ee\u524d\u6211\u4eec\u91c7\u7528\u7684\u662fMySQL\u5206\u5e93\u5206\u8868; \u540e\u671f\u8003\u8651\u4f7f\u7528HBase\u7b49\u5206\u5e03\u5f0f\u5b58\u50a8"),(0,l.kt)("li",{parentName:"ul"},"\u8ba2\u5355\u548c\u7ed3\u7b97\u7cfb\u7edf\u6570\u636e\u540c\u6b65, \u901a\u8fc7Hive\u4efb\u52a1\u5b8c\u6210\u5bf9\u8d26\u548c\u76d1\u63a7\u3002")),(0,l.kt)("h2",{id:"215-\u5e7f\u544a\u8868\u8bbe\u8ba1"},"21.5. \u5e7f\u544a\u8868\u8bbe\u8ba1"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MjM5MDc3OTMzMQ==&action=getalbum&album_id=1557571829207187456&scene=173&from_msgid=2649744188&from_itemidx=1&count=3#wechat_redirect"},"https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MjM5MDc3OTMzMQ==&action=getalbum&album_id=1557571829207187456&scene=173&from_msgid=2649744188&from_itemidx=1&count=3#wechat_redirect")),(0,l.kt)("h2",{id:"216-mysql-\u7684-binlog-\u5b9e\u73b0\u589e\u91cf\u7d22\u5f15"},"21.6. MySQL \u7684 binlog \u5b9e\u73b0\u589e\u91cf\u7d22\u5f15"),(0,l.kt)("h3",{id:"2161-java-\u7ec4\u4ef6\u5b9e\u73b0\u76d1\u63a7"},"21.6.1. java \u7ec4\u4ef6\u5b9e\u73b0\u76d1\u63a7"),(0,l.kt)("p",null,"mysql-binlog-connector-java"),(0,l.kt)("p",null,"\u76f8\u5173: "),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/zendesk/maxwell"},"https://github.com/zendesk/maxwell"),"  a mysql-to-json kafka producer \u8fd9\u4e2a\u4e5f\u4e0d\u9519, \u53ef\u4ee5\u901a\u8fc7 kafka \u5b9e\u73b0\u5206\u53d1"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/apache/nifi"},"https://github.com/apache/nifi"),"  process and distribute data"),(0,l.kt)("h3",{id:"2162-binlog-\u914d\u7f6e-sql"},"21.6.2. binlog \u914d\u7f6e SQL"),(0,l.kt)("p",null,"MySQL \u914d\u7f6e\u6587\u4ef6\u4e2d:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"log_bin , binlog switch, ",(0,l.kt)("inlineCode",{parentName:"p"},"show variables like 'log_bin'"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"binlog_format , binglog format, ",(0,l.kt)("inlineCode",{parentName:"p"},"show variables like 'binlog_format'  ")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"ROW , binlog \u4f1a\u8bb0\u5f55\u6bcf\u884c\u6570\u636e\u4fee\u6539\u7684\u7ec6\u8282, \u5982\u524d\u540e\u7684\u503c, \u4e0d\u8bb0\u5f55 SQL;"),(0,l.kt)("p",{parentName:"li"},"binlog \u5de8\u5927"),(0,l.kt)("p",{parentName:"li"},"\u6570\u636e\u4e00\u5b9a\u53ef\u4ee5\u88ab\u6062\u590d")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"statement , \u8bb0\u5f55\u5199\u64cd\u4f5c\u7684 SQL, "),(0,l.kt)("p",{parentName:"li"},"binlog \u4e0d\u5927"),(0,l.kt)("p",{parentName:"li"},"SQL \u4e2d\u67d0\u4e9b\u6d89\u53ca\u5230\u4e0a\u4e0b\u6587\u7684 \u51fd\u6570/\u89e6\u53d1\u5668 \u5728\u6062\u590d\u6570\u636e\u7684\u65f6\u5019\u53ef\u80fd\u51fa\u73b0\u95ee\u9898")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"mixed, \u4e24\u8005\u7684\u6df7\u5408"))))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"show master logs; -- check binlog list\n\n-- \u5e38\u7528\nshow master status; -- check number of the last binlog file and view the position where the last event ended\n\nflush logs; -- generate a new binlog with a new number\n\nreset master; -- clear all binlogs\n\n\n\n/*\n-- Event_type \u5217 (\u5e38\u7528\u7684Binlog event)\nquery_event \u6570\u636e\u65e0\u5173\u7684\u64cd\u4f5c, \u5982drop table, truncate table...\ntable_map_event \u8bb0\u5f55\u540e\u7eed\u64cd\u4f5c\u6d89\u53ca\u5230\u7684\u8868\u4fe1\u606f, \u5982dbname, tblname\nxid_event \u6807\u8bb0\u4e8b\u52a1\u63d0\u4ea4\n\nwrite_rows_event \u63d2\u5165\u64cd\u4f5c\nupdate_rows_event \u66f4\u65b0\ndelete_rows_event \u5220\u9664\n\n*/\nshow binlog events; -- view the first binlog\n\nshow binlog events in 'binlog.00030'; -- view specified binlog\n\nshow binlog events in 'binlog.00030' from 931 ; -- view specified binlog start from specified position\n\nshow binlog events in 'binlog.00030' from 931 limit 2; -- view specified binlog start from specified position and limit 2 lines\n\nshow binlog events in 'binlog.00030' from 931 limit 1, 2; -- view specified binlog start from specified position and limit 2 lines\n\n\n\n\n\n")),(0,l.kt)("h1",{id:"22-\u6848\u4f8b-\u7535\u5546\u7c7b\u7f51\u7ad9"},"22. \u6848\u4f8b \u7535\u5546\u7c7b\u7f51\u7ad9"),(0,l.kt)("h2",{id:"221-\u5f00\u53d1\u73af\u5883\u642d\u5efa"},"22.1. \u5f00\u53d1\u73af\u5883\u642d\u5efa"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"# \u6211\u662f\u7528\u7684 respberrypi, MySQL \u955c\u50cf\u9700\u8981\u4f7f\u7528 hypriot/rpi-mysql\ndocker run -d --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root -v /mydata/mysql/log:/var/log/mysql -v /mydata/mysql/data:/var/lib/mysql -v /mydata/mysql/conf:/etc/mysql hypriot/rpi-mysql\n\n# nacos\n# docker run -d --name nacos -p 8848:8848 -e MODE=standalone -v ~/docker_data/nacos/logs:/home/nacos/logs -v ~/docker_data/nacos/init.d/custom.properties:/home/nacos/init.d/custom.properties  nacos/nacos-server\ndocker run -d --name nacos -p 8848:8848 -e MODE=standalone -v ~/docker_data/nacos/logs:/home/nacos/logs  nacos/nacos-server\n\n# \u5148\u521b\u5efa /mydata/redis/conf/redis.conf, \u5426\u5219 \u6587\u4ef6\u6302\u8f7d\u65f6 redis.conf \u88ab\u8bc6\u522b\u4e3a \u76ee\u5f55\nmkdir -p /docker-data/reids/conf\ntouch  /docker-data/reids/conf/redis.conf\nsudo docker run -d --name redis -p 6379:6379 -v /mydata/redis/data:/data -v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf redis /etc/redis/redis.conf\n# redis \u53ef\u89c6\u5316\u7ba1\u7406\u754c\u9762\ndocker run -d --name redis-cmder -p 8079:8081 --link redis:re -e REDIS_HOSTS=re:6379 rediscommander/redis-commander\n")),(0,l.kt)("h2",{id:"222-\u884c\u4e1a\u672f\u8bed"},"22.2. \u884c\u4e1a\u672f\u8bed"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"spu (standard product unit) \u6807\u51c6\u5316\u4ea7\u54c1\u5355\u5143, \u662f\u4e00\u7ec4\u5546\u54c1\u7279\u6027\u7684\u96c6\u5408, \u662f\u5546\u54c1\u4fe1\u606f\u805a\u5408\u7684\u6700\u5c0f\u5355\u4f4d, \u901a\u4fd7\u8bf4\u5c31\u662f\u5546\u54c1\u540d\u79f0, \u5982 iPhone X,  Mi 8 , \u7c7b\u6bd4 Java \u4e2d\u7684 class"),(0,l.kt)("li",{parentName:"ul"},"sku (stock keeping unit) \u5e93\u5b58\u5355\u5143, \u662f\u5e93\u5b58\u8ba1\u91cf\u7684\u57fa\u672c\u5355\u4f4d, \u662f\u9500\u552e\u5c5e\u6027\u7684\u96c6\u5408(\u989c\u8272, \u5185\u5b58..., \u5176\u4ed6\u5c5e\u6027\u5c5e\u4e8e\u901a\u7528\u5c5e\u6027\u5982\u7f51\u7edc, \u50cf\u7d20..\u53ef\u4ee5\u76f4\u63a5\u548c spu \u5173\u8054), \u5982 iPhone X 64G \u9ed1\u8272, Mi8+64G+\u9ed1\u8272, \u7c7b\u6bd4 Java \u4e2d\u7684 \u5b9e\u4f8b\u5bf9\u8c61, \u540c\u4e2a spu \u6709\u591a\u4e2a\u4e0d\u540c sku; \u53ef\u4ee5\u51b3\u5b9a\u4ef7\u683c")),(0,l.kt)("h2",{id:"223-\u4e1a\u52a1\u6d41\u7a0b\u5206\u6790"},"22.3. \u4e1a\u52a1\u6d41\u7a0b\u5206\u6790"),(0,l.kt)("h3",{id:"2231-\u5546\u54c1\u65b0\u589e"},"22.3.1. \u5546\u54c1\u65b0\u589e"),(0,l.kt)("h3",{id:"2232-\u5546\u54c1\u4e0a\u67b6"},"22.3.2. \u5546\u54c1\u4e0a\u67b6"),(0,l.kt)("p",null,"\u7ed9\u5b9a\u4e00\u4e2a spu id, \u5c06\u76f8\u5173\u6570\u636e\u5b58\u5165 es, \u4ee5\u4fbf\u68c0\u7d22"),(0,l.kt)("p",null,"\u54ea\u4e9b\u6570\u636e\u8fdb\u5165 es?"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"spu, \u5546\u54c1\u89c4\u683c(\u666e\u901a\u5c5e\u6027)\u68c0\u7d22\u65f6\u9700\u8981, \u5206\u7c7b\u68c0\u7d22\u65f6\u4e5f\u9700\u8981"),(0,l.kt)("li",{parentName:"ul"},"sku, \u8fdb\u5165\u5546\u54c1\u4e3b\u9875, \u9009\u62e9\u989c\u8272, \u5c4f\u5e55 \u662f\u9700\u8981\u68c0\u7d22, \u6b64\u5916\u8fd8\u8981\u68c0\u7d22 sku\u6807\u9898, \u4ef7\u683c, \u9500\u91cf  ")),(0,l.kt)("h2",{id:"224-elasticsearch-\u6570\u636e\u5efa\u6a21\u5206\u6790"},"22.4. elasticsearch \u6570\u636e\u5efa\u6a21\u5206\u6790"),(0,l.kt)("p",null,"\u5546\u54c1\u4e0a\u67b6: spu \u76f8\u5173\u4fe1\u606f\u4f1a\u88ab\u5b58\u50a8\u5230 es, \u5982 \u989c\u8272, \u5185\u5b58, ram, \u6807\u9898"),(0,l.kt)("p",null,"\u6bd4\u8f83\u5206\u6790:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e \u6a21\u578b 1: \u82e5\u6709 100\u4e07\u5546\u54c1, \u6bcf\u4e2a\u5546\u54c1\u57fa\u672c\u5c5e\u6027\u5360\u7528\u5b58\u50a8 2kb, 1000000 ",(0,l.kt)("em",{parentName:"li"}," 0.002mb == 2000mb == 2000 ")," 0.001 G == 2G, \u5c31\u662f\u52a0\u4e00\u4e2a\u5185\u5b58\u6761\u7684\u4e8b\u513f, \u5b8c\u5168\u53ef\u4ee5\u63a5\u53d7"),(0,l.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e \u6a21\u578b 2: \u5047\u5982\u67d0\u4e2a\u4eba\u641c\u7d22\u5c0f\u7c73, \u5411 es \u53d1\u9001\u4e00\u4e2a\u8bf7\u6c42, \u53ef\u80fd\u4f1a\u51fa\u73b0\u5f88\u591a spu, \u5982 \u624b\u673a/\u7535\u5668/\u8def\u7531\u5668/\u5e8a\u57ab..., \u5047\u8bbe\u6709 4000 \u4e2a spu, \u63a5\u4e0b\u6765\u6839\u636e spuId \u67e5\u5bf9\u5e94 \u57fa\u7840\u5c5e\u6027\u663e\u793a\u5728\u8fc7\u6ee4\u680f\u4f4d, 4000spuId ",(0,l.kt)("em",{parentName:"li"}," \u6bcf\u4e2aid \u662f Long \u7c7b\u578b 8 \u4e2a\u5b57\u8282 == 4000 ")," 8 byte == 32000 byte == 32 kb. \u5373\u4e00\u4e2a\u8bf7\u6c42\u81f3\u5c11\u4f1a\u5411 es \u53d1\u9001 32kb \u6570\u636e, \u5047\u8bbe 10000 \u4eba\u5e76\u53d1\u68c0\u7d22\u5c0f\u7c73, 10000*32kb === 320mb, \u767e\u4e07\u4eba\u5e76\u53d1\u5c31\u76f4\u63a5\u662f 32G \u4e86, \u8fd9\u5b8c\u5168\u4e0d\u53ef\u63a5\u53d7")),(0,l.kt)("p",null,"\u6240\u4ee5\u9009\u62e9\u6a21\u578b 1, \u4ee5\u7a7a\u95f4\u6362\u65f6\u95f4"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'// \u6a21\u578b 1: \u53ea\u6709\u4e00\u4e2a\u7d22\u5f15\n// \u65b9\u4fbf\u68c0\u7d22, \u4f46\u662f\u6709\u6570\u636e\u5197\u4f59, \u5982 \u540c\u4e00\u4e2a spu \u4e0b\u4e0d\u540c\u7684 spu \u5546\u54c1\u7684 attr \u90fd\u76f8\u540c\n{\n  "spuId": 11, // \u5982 iPhone X\n  "skuId": 1, // 64G, \u9ed1\u8272\n  "skuTitle": "iPhone x 64G \u9ed1\u8272",\n  "price": 1000,\n  "saleCount": 20000,\n  "attrs": [\n    {"\u5c3a\u5bf8": 4.5},\n    {"CPU": "\u9ad8\u901a"},\n    {"\u5206\u8fa8\u7387": "\u9ad8\u6e05"}\n  ] \n}\n\n// \u6a21\u578b 2: \u5206\u4e3a\u4e24\u4e2a\u7d22\u5f15\n// \u6ca1\u6709\u6570\u636e\u5197\u4f59, \u4f46\u662f\u68c0\u7d22\u65f6\u66f4\u8017\u65f6, \u56e0\u4e3a\u6570\u636e\u4f20\u8f93\u91cf\u5927\u5927\u589e\u52a0\u4e86\n// sku \u7d22\u5f15\n{\n  "spuId": 11, // \u5982 iPhone X\n  "skuId": 1, // 64G, \u9ed1\u8272\n  "skuTitle": "iPhone x 64G \u9ed1\u8272",\n  "price": 1000,\n  "saleCount": 20000\n}\n// attr \u7d22\u5f15\n{\n  "spuId": 11, // \u5982 iPhone X\n  "attrs": [\n    {"\u5c3a\u5bf8": 4.5},\n    {"CPU": "\u9ad8\u901a"},\n    {"\u5206\u8fa8\u7387": "\u9ad8\u6e05"}\n  ] \n}\n')),(0,l.kt)("p",null,"\u6700\u7ec8 product index \u5bfc\u5165\u662f\u8fd9\u6837\u7684:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'PUT product\n{\n   "mapping":{\n       "properties":{\n           "skuId":{\n               "type":"long"\n           },\n           "spuId":{\n            "type":"keyword"// \u7c7b\u4f3c text, \u4e0d\u5206\u8bcd\n           },\n           "skuTitle":{\n               "type":"text", //\u5206\u8bcd\n               "analyzer":"ik_smart"\n           },\n           "skuPrice":{\n               "type":"keyword"\n           },\n           "skuImg":{// \u56fe\u7247\u94fe\u63a5\n               "type":"keyword",\n               "index":false, // // \u4e0d\u53ef\u68c0\u7d22\n               "doc_values":false // \u4e0d\u9700\u8981 \u805a\u5408\u64cd\u4f5c, \u7701\u7a7a\u95f4, \u9ed8\u8ba4 true\n           },\n           "saleCount":{// \u9500\u91cf\n               "type":"long"\n           },\n           "hasStock":{\n               "type":"boolean"\n           },\n           "hotScore":{\n               "type":"long"\n           },\n           "brandId":{\n            "type":"long"\n           },\n           "categoryId":{\n               "type":"long"\n           },\n           "brandName":{\n               "type":"keyword",\n               "index":false,\n               "doc_values":false\n           },\n           "brandImg":{\n               "type":"keyword",\n               "index":false,\n               "doc_values":false\n           },\n           "categoryName":{\n               "type":"keyword",\n               "index":false,\n               "doc_values":false\n           },\n           "attrs":{\n               "type":"nested" , // \u8fd9\u5c5e\u6027\u662f\u5d4c\u5165\u5f0f\u7684, \u8868\u793a attrs \u662f\u4e00\u4e2a \u5bf9\u8c61 or \u5bf9\u8c61\u7ec4\u6210\u7684\u6570\u7ec4\n               // \u5982\u679c\u4e0d\u6307\u5b9a\u7684\u8bdd es \u4f1a\u5c06\u8fd9\u4e2a\u5c5e\u6027\u6241\u5e73\u5316\u5904\u7406, \u5c06\u5bf9\u8c61\u5185\u7684\u5c5e\u6027\u62bd\u53d6\u5230\u5916\u5c42\u5f62\u6210\u591a\u4e2a\u8fd9\u6837\u7684\u5c5e\u6027 attrs.attrId,  attrs.attrName, ....\n               "properties":{\n                   "attrId":{\n                       "type":"long"\n                   },\n                   "attrName":{\n                       "type":"keyword",\n                       "index":false,\n                       "doc_values":false\n                   },\n                   "attrValue":{\n                        "type":"keyword"\n                   }\n               }\n           }\n       }\n   }\n}\n')),(0,l.kt)("h2",{id:"225-\u7f13\u5b58\u5206\u6790"},"22.5. \u7f13\u5b58\u5206\u6790"),(0,l.kt)("p",null,"\u54ea\u4e9b\u6570\u636e\u9002\u5408\u653e\u5165\u7f13\u5b58? (\u4e0d\u7ecf\u5e38\u6539\u53d8, \u8bbf\u95ee\u91cf\u5927, \u4e00\u81f4\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u6570\u636e), \u5931\u6548\u65f6\u95f4\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u5b9a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5546\u54c1\u5206\u7c7b, \u5546\u54c1\u5217\u8868")),(0,l.kt)("p",null,"\u7f13\u5b58\u4e00\u81f4\u6027\u65b9\u6848:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u7528\u6237\u76f8\u5173\u7684\u6570\u636e(\u8ba2\u5355\u6570\u636e, \u4e2a\u4eba\u4fe1\u606f...), \u5e76\u53d1\u8bfb\u5199\u51e0\u7387\u5f88\u5c0f, \u57fa\u672c\u4e0a\u6ca1\u6709\u7f13\u5b58\u4e0d\u4e00\u81f4\u95ee\u9898, \u91c7\u7528\u8bbe\u7f6e\u7f13\u5b58\u8fc7\u671f\u7684\u7b56\u7565"),(0,l.kt)("li",{parentName:"ul"},"\u9996\u9875\u83dc\u5355, \u5546\u54c1\u4ecb\u7ecd\u8fd9\u7c7b\u6570\u636e, \u80fd\u591f\u5bb9\u5fcd\u4e00\u5b9a\u7684\u4e0d\u4e00\u81f4, \u4f7f\u7528 canal\u8ba2\u9605 binlog \u7684\u65b9\u5f0f"),(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u52a0\u8bfb\u5199\u9501, \u4fdd\u8bc1\u5e76\u53d1\u8bfb\u5199")),(0,l.kt)("h2",{id:"226-\u90e8\u7f72\u67b6\u6784\u5206\u6790"},"22.6. \u90e8\u7f72\u67b6\u6784\u5206\u6790"),(0,l.kt)("p",null,"client(browser...) --\x3e nginx --\x3e \u7f51\u5173\u96c6\u7fa4 --\x3e services"),(0,l.kt)("h2",{id:"227-\u5f02\u6b65\u5904\u7406\u5206\u6790"},"22.7. \u5f02\u6b65\u5904\u7406\u5206\u6790"),(0,l.kt)("p",null,"\u4e00\u4e2a\u662f\u53ef\u4ee5\u901a\u8fc7 completableFuture "),(0,l.kt)("p",null,"\u4e00\u4e2a\u662f\u901a\u8fc7 mq"),(0,l.kt)("h3",{id:"2271-mq"},"22.7.1. mq"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5f02\u6b65: \u5904\u7406\u6ce8\u518c\u6d41\u7a0b (\u5f02\u6b65\u53d1\u9001\u77ed\u4fe1)")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u89e3\u8026: \u4e0b\u5355\u540e\u7684\u51fa\u5e93\u64cd\u4f5c, \u901a\u8fc7 mq \u8c03\u7528\u51cf\u5e93\u5b58\u63a5\u53e3, \u4f7f\u5f97\u8ba2\u5355\u7cfb\u7edf\u548c\u5e93\u5b58\u7cfb\u7edf\u89e3\u8026")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u6d41\u91cf\u63a7\u5236: \u5bf9\u4e8e\u77ac\u65f6\u5927\u91cf\u8bf7\u6c42, \u5148\u5806\u79ef\u5728 mq, \u540e\u9762\u6162\u6162\u5904\u7406"))),(0,l.kt)("h1",{id:"23-\u6848\u4f8b-\u7269\u8054\u7f51\u5e73\u53f0"},"23. \u6848\u4f8b \u7269\u8054\u7f51\u5e73\u53f0"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/jetlinks/jetlinks-community"},"https://github.com/jetlinks/jetlinks-community"),"\n",(0,l.kt)("a",{parentName:"p",href:"https://open.iot.10086.cn/"},"https://open.iot.10086.cn/")))}k.isMDXComponent=!0},54297:function(e,t,n){t.Z=n.p+"assets/images/spring-cloud-arch-e17e65bdfb94199c9480a2db1ad04d98.png"}}]);