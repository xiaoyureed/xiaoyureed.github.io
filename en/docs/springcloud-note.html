<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-springcloud-note">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Spring Cloud ç¬”è®°ğŸŒˆ | Xiaoyureed&#x27;s ç½‘ç»œ Wiki </title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xiaoyureed.github.io/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://xiaoyureed.github.io/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://xiaoyureed.github.io/en/docs/springcloud-note"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Spring Cloud ç¬”è®°ğŸŒˆ | Xiaoyureed&#x27;s ç½‘ç»œ Wiki "><meta data-rh="true" name="description" content="https://github.com/macrozheng/mall-swarm"><meta data-rh="true" property="og:description" content="https://github.com/macrozheng/mall-swarm"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xiaoyureed.github.io/en/docs/springcloud-note"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/en/docs/springcloud-note" hreflang="en"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/springcloud-note" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/springcloud-note" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="Xiaoyureed&#39;s ç½‘ç»œ Wiki  RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="Xiaoyureed&#39;s ç½‘ç»œ Wiki  Atom Feed"><link rel="stylesheet" href="/en/assets/css/styles.c6a654bf.css">
<link rel="preload" href="/en/assets/js/runtime~main.b94328d8.js" as="script">
<link rel="preload" href="/en/assets/js/main.fc98d8e0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.png" alt="xiaoyureed Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.png" alt="xiaoyureed Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Xiaoyureed</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/en/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/xiaoyureed" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/FreeMarker-note">FreeMarker Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/SpringBoot-note">Spring Boot å¤‡å¿˜</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/agile-development-user-story-scrum">æ•æ·å¼€å‘ Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/android">Android å¼€å‘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/autohotkey">Autohotkey è„šæœ¬</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/blockchain">blockchainåŒºå—é“¾</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/c-sharp-and-dot-net">C# &amp; .NET</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/chatgpt">Chatgpt Usage Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cloud-native-platform">äº‘æœåŠ¡å¹³å°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cpp">CPP and C å¤‡å¿˜</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cross-gfw">Cross The GFW</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cs-note">Computer Science Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/css-pre-processor">å‡ ç§CSSé¢„å¤„ç†å™¨æ¯”è¾ƒé€‰å‹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/data-structure-and-algorithm">Data Structure and Algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/design-pattern-note">Design Pattern ç¬”è®°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/dev-resources">å¼€å‘è€…èµ„æº</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/devops">DevOps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/distributed-system">Distributed System åˆ†å¸ƒå¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/docker-note-virtual-dev-env">Docker Note &amp; Other Virtual Develop Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/effective-java-reading-note">Effective Java é˜…è¯»ç¬”è®°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/elk-elastic-log">Distributed log collectionåˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/english-note">è‹±è¯­å­¦ä¹ ğŸ”¥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/extjs-note">Extjs ç¬”è®°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/flutter">flutter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/games-development-introduce">æ¸¸æˆå¼€å‘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/git-note">Git å¤‡å¿˜ ğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/github-starts">Github æ˜Ÿæ ‡â­ï¸</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/golang-note">Golang ç¬”è®°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/gps-gis-tracing">åŸºäºåœ°ç†ä½ç½®å¼€å‘æŠ€æœ¯</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/gradle">gradle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/greasy-monkey">æ²¹çŒ´æ’ä»¶&amp;ç¼–å†™è„šæœ¬ğŸ’</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/groovy-note">groovy note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/health">Health å…³çˆ±ç¨‹åºå‘˜å¥åº·ğŸ¥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/how-to-test-java-app">How to Test Java App</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/html-note">HTML å¤‡å¿˜</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/idea-note">InteliJ idea tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/interview-system-design">ç»å…¸çš„ç³»ç»Ÿè®¾è®¡æ€è·¯</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/iot">Iot ç‰©è”ç½‘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/java-code-clean">Java Clean Code Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/java-concurrent">Java ConcurrentğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/java-memory-model-jmm-jvm">JMM and GCğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/java-note">Java Core ç¬”è®°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/jquery-note">JQuery notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/js-tutorial">JavaScript tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/kotlin">kotlin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/kubernetes-k8s">kubernetes-k8s â˜ï¸</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/linux-note">é¸Ÿå“¥çš„ Linux ç§æˆ¿èœé˜…è¯»ç¬”è®°</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/mac">Mac å¼€å‘ç¯å¢ƒ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/machine-learning-ml">machine-learning-ml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/maven-note">Maven NotesğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/message-queue">Message QueueğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/money">Investment Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/mongodb-note">MongoDB NotesğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/monitor-system-grafana-prometheus-influxdb-hbase">monitor-system-grafana-prometheusç›‘æ§ğŸ–¥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/mvc-mvvm">MVC to MVVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/mybatis-note">MyBatis Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/netty-note">netty</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/nlp-natural-language-processing">nlp-natural-language-processingğŸ‘„</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/nodejs-yarn-npm">Nodejs, Yarn, Npm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/oracle">Oracle å¤‡å¿˜</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-audio-video">Audio and Video development Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-big-data-introduce">å¤§æ•°æ®å¼€å‘ Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-cache">Cache ç¼“å­˜ğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-computational-ad">è®¡ç®—å¹¿å‘Š Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-crawler-spider">ç½‘ç»œçˆ¬è™« Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-db-design-note">å…³ç³»å‹æ•°æ®åº“è¡¨è®¾è®¡ğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-desktop-develop">æ¡Œé¢åº”ç”¨å¼€å‘ Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-http">HTTP protocol Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-reactive-programming">å“åº”å¼ç¼–ç¨‹ Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-rest-api">RESTful api åŠ å…¶ä»–webServiceæŠ€æœ¯</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-rpc">RPC Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-rule-engine-note">è§„åˆ™å¼•æ“ Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/php-note">PHP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/play-framework">Playæ¡†æ¶</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/postgres-note">Postgres noteğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/process-workflow-bpm-engine">å·¥ä½œæµå¼•æ“</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/protect-your-app-authentication-oauth2-jwt-https">Protect Your App å®‰å…¨ä¿æŠ¤è®¤è¯é‰´æƒğŸ”‘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/python-note">PythonğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/quant-money">é‡åŒ–äº¤æ˜“</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/quarkus">Quarkus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/react-note">ReactğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/real-time-communication-protocol">å®æ—¶é€šä¿¡ Real-time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/redis-note">RedisğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/regex">Regular Expression æ­£åˆ™ğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/rust-note">Rust ç¬”è®°ğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/saas-paas-iaas-as-a-service">SaaS Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/serverless">Serverless</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/service-mesh">service mesh æœåŠ¡ç½‘æ ¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/servlet">Servlet Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/shell-bash-note">shell-bashè„šæœ¬æ”¶é›†</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/spring-note">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/en/docs/springcloud-note">Spring Cloud ç¬”è®°ğŸŒˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/springmvc-note">Spring MVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/task-schedule-note">Task Schedule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/tcp-ip-note">TCP IP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/tomcat-jetty-nginx">Tomcat Jetty Nginx ç­‰ web å®¹å™¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/vertx">Vertx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/video-creator">æ‹æ‘„</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/webassembly">webassembly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/webpack-esbuild-vite-rollup">å‰ç«¯æ‰“åŒ…æ„å»ºå·¥å…·</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/windows-sub-system-on-linux">WSL ä½¿ç”¨</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Spring Cloud ç¬”è®°ğŸŒˆ</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Spring Cloud ç¬”è®°ğŸŒˆ</h1></header><div align="center"><p><a href="https://github.com/macrozheng/mall-swarm" target="_blank" rel="noopener noreferrer">https://github.com/macrozheng/mall-swarm</a>
TODO</p><p>Spring Cloudæ˜¯ä¸€ç³»åˆ—æ¡†æ¶çš„æœ‰åºé›†åˆ, å®ƒåˆ©ç”¨Spring Bootç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ï¼Œå¦‚æœåŠ¡å‘ç°æ³¨å†Œã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯æ€»çº¿ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€æ•°æ®ç›‘æ§ç­‰;
<a href="http://projects.spring.io/spring-cloud/#quick-start" target="_blank" rel="noopener noreferrer">å®˜ç½‘</a>;
<a href="http://www.ityouknow.com/springcloud/2017/11/02/framework-and-springcloud.html" target="_blank" rel="noopener noreferrer">å¾®æœåŠ¡çš„æ¶æ„æ¼”åŒ–</a>
<a href="https://www.youtube.com/watch?v=aO3W-lYnw-o" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=aO3W-lYnw-o</a> (ä¸€ä¸ªå…¥é—¨ä»‹ç»)
<a href="https://github.com/xiaoyureed/springcloud-tutorial" target="_blank" rel="noopener noreferrer">demoåœ¨è¿™é‡Œ</a></p><p>spring cloud alibaba: nacos (æœåŠ¡æ³¨å†Œ, é…ç½®ä¸­å¿ƒ, bus),  sentinel (ç†”æ–­é™æµ), seata (åˆ†å¸ƒå¼äº‹åŠ¡)</p><p><a href="https://juejin.im/post/6870288195674718222" target="_blank" rel="noopener noreferrer">https://juejin.im/post/6870288195674718222</a> é€‰å‹ 2020</p><p><a href="https://github.com/macrozheng" target="_blank" rel="noopener noreferrer">https://github.com/macrozheng</a> ç”µå•†ç³»ç»Ÿtutorial</p><p><a href="https://github.com/zhoutaoo/SpringCloud" target="_blank" rel="noopener noreferrer">https://github.com/zhoutaoo/SpringCloud</a> demo</p><p><a href="https://docshome.gitbook.io/microservices/" target="_blank" rel="noopener noreferrer">https://docshome.gitbook.io/microservices/</a> ä»è®¾è®¡åˆ°éƒ¨ç½²</p><p><a href="https://github.com/maventalker/simplemall" target="_blank" rel="noopener noreferrer">https://github.com/maventalker/simplemall</a>
TODO</p><p><a href="https://github.com/chillzhuang/SpringBlade" target="_blank" rel="noopener noreferrer">https://github.com/chillzhuang/SpringBlade</a> å®ä¾‹</p></div><ul><li><a href="#1-spring-boot-%E5%92%8C-spring-cloud-%E6%90%AD%E9%85%8D%E9%80%89%E5%9E%8B">1. spring boot å’Œ spring cloud æ­é…é€‰å‹</a></li><li><a href="#2-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A0%B8%E5%BF%83%E8%A6%81%E7%B4%A0%E5%92%8C-spring-cloud-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">2. å¾®æœåŠ¡æ ¸å¿ƒè¦ç´ å’Œ spring cloud å·¥ä½œæµç¨‹</a></li><li><a href="#3-%E5%92%8Cdubbo-zookeeper%E5%AF%B9%E6%AF%94">3. å’Œdubbo-zookeeperå¯¹æ¯”</a></li><li><a href="#4-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83">4. é…ç½®ä¸­å¿ƒ</a><ul><li><a href="#41-spring-cloud-config">4.1. Spring-Cloud-Config</a></li><li><a href="#42-apolo">4.2. apolo</a></li><li><a href="#43-alibaba-nacos-%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83">4.3. alibaba nacos ä½œä¸ºé…ç½®ä¸­å¿ƒ</a></li></ul></li><li><a href="#5-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">5. æ³¨å†Œä¸­å¿ƒ</a><ul><li><a href="#51-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E9%80%89%E5%9E%8B">5.1. æ³¨å†Œä¸­å¿ƒé€‰å‹</a></li><li><a href="#52-eureka">5.2. eureka</a></li><li><a href="#53-consul">5.3. consul</a></li><li><a href="#54-zookeeper">5.4. zookeeper</a></li><li><a href="#55-nacos-%E4%BD%9C%E4%B8%BA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">5.5. nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒ</a></li><li><a href="#56-etcd">5.6. etcd</a></li></ul></li><li><a href="#6-%E6%9C%8D%E5%8A%A1%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8">6. æœåŠ¡ç›¸äº’è°ƒç”¨</a><ul><li><a href="#61-%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0%E8%B0%83%E7%94%A8%E6%A1%86%E6%9E%B6">6.1. æ‰‹åŠ¨å®ç°è°ƒç”¨æ¡†æ¶</a></li><li><a href="#62-feign">6.2. feign</a></li><li><a href="#63-openfeign">6.3. OpenFeign</a><ul><li><a href="#631-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">6.3.1. åŸºæœ¬ä½¿ç”¨</a></li><li><a href="#632-%E8%B6%85%E6%97%B6%E7%BB%BC%E5%90%88%E9%85%8D%E7%BD%AE">6.3.2. è¶…æ—¶ç»¼åˆé…ç½®</a></li><li><a href="#633-feign-client-interceptor">6.3.3. feign client interceptor</a></li><li><a href="#634-%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE">6.3.4. æ—¥å¿—é…ç½®</a></li></ul></li></ul></li><li><a href="#7-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">7. è´Ÿè½½å‡è¡¡</a><ul><li><a href="#71-%E9%9B%86%E4%B8%AD%E5%BC%8F%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">7.1. é›†ä¸­å¼è´Ÿè½½å‡è¡¡å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</a></li><li><a href="#72-ribbon">7.2. ribbon</a><ul><li><a href="#721-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-ribbon">7.2.1. å¦‚ä½•ä½¿ç”¨ ribbon</a></li><li><a href="#722-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95">7.2.2. è´Ÿè½½å‡è¡¡ç®—æ³•</a></li></ul></li><li><a href="#73-spring-cloud-loadbalancer">7.3. spring cloud loadBalancer</a></li></ul></li><li><a href="#8-%E7%86%94%E6%96%AD%E5%99%A8">8. ç†”æ–­å™¨</a><ul><li><a href="#81-hystrix">8.1. hystrix</a><ul><li><a href="#811-hystrix-%E5%8E%9F%E7%90%86">8.1.1. hystrix åŸç†</a></li><li><a href="#812-hystrix-%E9%99%8D%E7%BA%A7%E4%BD%BF%E7%94%A8">8.1.2. hystrix é™çº§ä½¿ç”¨</a><ul><li><a href="#8121-%E5%8D%95%E7%8B%AC%E4%BD%BF%E7%94%A8">8.1.2.1. å•ç‹¬ä½¿ç”¨</a></li><li><a href="#8122-%E9%85%8D%E5%90%88-openfeign">8.1.2.2. é…åˆ openFeign</a></li></ul></li><li><a href="#813-%E7%86%94%E6%96%AD%E7%9B%91%E6%8E%A7hystrix-dashboard%E5%92%8Cturbine">8.1.3. ç†”æ–­ç›‘æ§Hystrix-Dashboardå’ŒTurbine</a></li><li><a href="#814-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9A%94%E7%A6%BB%E7%AD%96%E7%95%A5">8.1.4. è‡ªå®šä¹‰éš”ç¦»ç­–ç•¥</a></li></ul></li><li><a href="#82-spring-cloud-alibaba-sentinel">8.2. spring cloud alibaba sentinel</a></li><li><a href="#83-resilience4j">8.3. resilience4j</a></li></ul></li><li><a href="#9-%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3">9. æœåŠ¡ç½‘å…³</a><ul><li><a href="#91-%E7%BD%91%E5%85%B3%E9%80%89%E5%9E%8B">9.1. ç½‘å…³é€‰å‹</a></li><li><a href="#92-%E7%BD%91%E5%85%B3%E9%AB%98%E5%8F%AF%E7%94%A8">9.2. ç½‘å…³é«˜å¯ç”¨</a></li><li><a href="#93-nodejs">9.3. nodejs</a></li><li><a href="#94-kong">9.4. kong</a></li><li><a href="#95-openresty">9.5. openResty</a></li><li><a href="#96-zuul">9.6. zuul</a><ul><li><a href="#961-%E4%BB%80%E4%B9%88%E6%98%AFzuul">9.6.1. ä»€ä¹ˆæ˜¯zuul</a></li><li><a href="#962-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">9.6.2. åŸºæœ¬ä½¿ç”¨</a></li></ul></li><li><a href="#97-spring-cloud-gateway">9.7. spring-cloud-gateway</a><ul><li><a href="#971-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D">9.7.1. ç®€å•ä»‹ç»</a></li><li><a href="#972-%E6%9C%89%E5%93%AA%E4%BA%9B%E5%86%85%E7%BD%AE-route-predicate-factory">9.7.2. æœ‰å“ªäº›å†…ç½® route predicate factory</a></li><li><a href="#973-%E6%9C%89%E5%93%AA%E4%BA%9B-%E5%86%85%E7%BD%AE-filter">9.7.3. æœ‰å“ªäº› å†…ç½® filter</a></li><li><a href="#974-%E8%87%AA%E5%AE%9A%E4%B9%89-filter">9.7.4. è‡ªå®šä¹‰ filter</a><ul><li><a href="#9741-gateway-filter">9.7.4.1. gateway filter</a></li><li><a href="#9742-%E5%85%A8%E5%B1%80-filter">9.7.4.2. å…¨å±€ filter</a></li></ul></li><li><a href="#975-gateway-%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95">9.7.5. gateway é…ç½®æ–¹æ³•</a></li><li><a href="#976-%E7%BD%91%E5%85%B3%E7%9B%91%E6%8E%A7">9.7.6. ç½‘å…³ç›‘æ§</a></li></ul></li></ul></li><li><a href="#10-%E8%B0%83%E7%94%A8%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA">10. è°ƒç”¨é“¾è·¯è¿½è¸ª</a><ul><li><a href="#101-sleuth-%E5%92%8C-zipkin">10.1. sleuth å’Œ zipkin</a><ul><li><a href="#1011-%E5%88%86%E5%B8%83%E5%BC%8F%E8%BF%BD%E8%B8%AA">10.1.1. åˆ†å¸ƒå¼è¿½è¸ª</a></li><li><a href="#1012-spring-cloud-sleuth">10.1.2. spring-cloud-sleuth</a></li><li><a href="#1013-zipkin-%E4%BD%BF%E7%94%A8">10.1.3. zipkin ä½¿ç”¨</a></li><li><a href="#1014-%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B">10.1.4. ä½¿ç”¨æ¡ˆä¾‹</a></li></ul></li><li><a href="#102-skywalking">10.2. skyWalking</a></li></ul></li><li><a href="#11-%E4%B8%9A%E5%8A%A1%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86">11. ä¸šåŠ¡æ—¥å¿—æ”¶é›†</a><ul><li><a href="#111-%E6%97%A5%E5%BF%97%E6%80%8E%E4%B9%88%E6%90%9C%E7%B4%A2-elasticsearch">11.1. æ—¥å¿—æ€ä¹ˆæœç´¢ elasticSearch</a></li><li><a href="#112-%E6%97%A5%E5%BF%97%E6%80%8E%E4%B9%88%E6%94%B6%E9%9B%86">11.2. æ—¥å¿—æ€ä¹ˆæ”¶é›†</a></li><li><a href="#113-%E6%97%A5%E5%BF%97%E6%80%8E%E4%B9%88%E5%B1%95%E7%A4%BA">11.3. æ—¥å¿—æ€ä¹ˆå±•ç¤º</a></li></ul></li><li><a href="#12-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF">12. æ¶ˆæ¯æ€»çº¿</a><ul><li><a href="#121-spring-cloud-bus">12.1. Spring-Cloud-Bus</a></li><li><a href="#122-alibaba-nacos-%E4%BD%9C%E4%B8%BA%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF">12.2. alibaba nacos ä½œä¸ºæ¶ˆæ¯æ€»çº¿</a></li></ul></li><li><a href="#13-spring-cloud-stream-%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8">13. spring-cloud-stream æ¶ˆæ¯é©±åŠ¨</a></li><li><a href="#14-spring-cloud-data-flow">14. spring-cloud-data-flow</a></li><li><a href="#15-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1-seata">15. åˆ†å¸ƒå¼äº‹åŠ¡ seata</a></li><li><a href="#16-spring-cloud-alibaba-%E9%85%8D%E5%90%88-dubbo">16. spring cloud alibaba é…åˆ dubbo</a></li><li><a href="#17-%E5%AE%9E%E9%99%85%E8%AE%BE%E8%AE%A1%E6%A1%88%E4%BE%8B-%E7%A5%A8%E5%8A%A1%E7%BD%91%E7%AB%99">17. å®é™…è®¾è®¡æ¡ˆä¾‹ ç¥¨åŠ¡ç½‘ç«™</a><ul><li><a href="#171-%E4%B8%9A%E5%8A%A1%E6%9E%B6%E6%9E%84">17.1. ä¸šåŠ¡æ¶æ„</a></li><li><a href="#172-%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84">17.2. åº”ç”¨æ¶æ„</a></li><li><a href="#173-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84">17.3. æŠ€æœ¯æ¶æ„</a></li><li><a href="#174-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9E%B6%E6%9E%84">17.4. æ•°æ®åº“æ¶æ„</a></li><li><a href="#175-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86">17.5. é¡¹ç›®ç®¡ç†</a></li></ul></li><li><a href="#18-%E6%A1%88%E4%BE%8B-%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2">18. æ¡ˆä¾‹ åœ¨çº¿æ•™è‚²</a><ul><li><a href="#181-%E8%A1%8C%E4%B8%9A%E8%83%8C%E6%99%AF-and-%E5%95%86%E4%B8%9A%E6%A8%A1%E5%BC%8F">18.1. è¡Œä¸šèƒŒæ™¯ and å•†ä¸šæ¨¡å¼</a></li></ul></li><li><a href="#19-%E6%A1%88%E4%BE%8B-%E8%81%9A%E5%90%88%E6%94%AF%E4%BB%98">19. æ¡ˆä¾‹ èšåˆæ”¯ä»˜</a><ul><li><a href="#191-%E8%81%9A%E5%90%88%E6%94%AF%E4%BB%98%E6%A6%82%E5%BF%B5">19.1. èšåˆæ”¯ä»˜æ¦‚å¿µ</a></li><li><a href="#192-%E9%9B%86%E5%90%88%E6%94%AF%E4%BB%98%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84">19.2. é›†åˆæ”¯ä»˜é¡¹ç›®æ¶æ„</a></li><li><a href="#193-%E6%94%AF%E4%BB%98%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B">19.3. æ”¯ä»˜ä¸šåŠ¡æµç¨‹</a></li></ul></li><li><a href="#20-%E6%A1%88%E4%BE%8B-%E5%B9%BF%E5%91%8A%E7%B3%BB%E7%BB%9F">20. æ¡ˆä¾‹ å¹¿å‘Šç³»ç»Ÿ</a><ul><li><a href="#201-%E5%B9%BF%E5%91%8A%E6%A6%82%E5%BF%B5">20.1. å¹¿å‘Šæ¦‚å¿µ</a></li><li><a href="#202-%E7%B3%BB%E7%BB%9F%E7%BB%84%E6%88%90">20.2. ç³»ç»Ÿç»„æˆ</a></li><li><a href="#203-%E5%B9%BF%E5%91%8A%E7%9A%84%E6%A0%B8%E5%BF%83%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B">20.3. å¹¿å‘Šçš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹</a></li><li><a href="#204-%E6%8A%80%E6%9C%AF%E9%9A%BE%E7%82%B9">20.4. æŠ€æœ¯éš¾ç‚¹</a><ul><li><a href="#2041-%E5%B9%BF%E5%91%8A%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AD%98%E5%82%A8">20.4.1. å¹¿å‘Šæ•°æ®çš„å­˜å‚¨</a></li><li><a href="#2042-%E5%B9%BF%E5%91%8A%E6%95%B0%E6%8D%AE%E6%A3%80%E7%B4%A2">20.4.2. å¹¿å‘Šæ•°æ®æ£€ç´¢</a></li><li><a href="#2043-%E8%AE%A1%E8%B4%B9%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88">20.4.3. è®¡è´¹å¹³å°çš„æŠ€æœ¯æ–¹æ¡ˆ</a></li></ul></li><li><a href="#205-%E5%B9%BF%E5%91%8A%E8%A1%A8%E8%AE%BE%E8%AE%A1">20.5. å¹¿å‘Šè¡¨è®¾è®¡</a></li><li><a href="#206-mysql-%E7%9A%84-binlog-%E5%AE%9E%E7%8E%B0%E5%A2%9E%E9%87%8F%E7%B4%A2%E5%BC%95">20.6. MySQL çš„ binlog å®ç°å¢é‡ç´¢å¼•</a><ul><li><a href="#2061-java-%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0%E7%9B%91%E6%8E%A7">20.6.1. java ç»„ä»¶å®ç°ç›‘æ§</a></li><li><a href="#2062-binlog-%E9%85%8D%E7%BD%AE-sql">20.6.2. binlog é…ç½® SQL</a></li></ul></li></ul></li><li><a href="#21-%E6%A1%88%E4%BE%8B-%E7%94%B5%E5%95%86%E7%B1%BB%E7%BD%91%E7%AB%99">21. æ¡ˆä¾‹ ç”µå•†ç±»ç½‘ç«™</a><ul><li><a href="#211-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">21.1. å¼€å‘ç¯å¢ƒæ­å»º</a></li><li><a href="#212-%E8%A1%8C%E4%B8%9A%E6%9C%AF%E8%AF%AD">21.2. è¡Œä¸šæœ¯è¯­</a></li><li><a href="#213-%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90">21.3. ä¸šåŠ¡æµç¨‹åˆ†æ</a><ul><li><a href="#2131-%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E">21.3.1. å•†å“æ–°å¢</a></li><li><a href="#2132-%E5%95%86%E5%93%81%E4%B8%8A%E6%9E%B6">21.3.2. å•†å“ä¸Šæ¶</a></li></ul></li><li><a href="#214-elasticsearch-%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1%E5%88%86%E6%9E%90">21.4. elasticsearch æ•°æ®å»ºæ¨¡åˆ†æ</a></li><li><a href="#215-%E7%BC%93%E5%AD%98%E5%88%86%E6%9E%90">21.5. ç¼“å­˜åˆ†æ</a></li><li><a href="#216-%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84%E5%88%86%E6%9E%90">21.6. éƒ¨ç½²æ¶æ„åˆ†æ</a></li><li><a href="#217-%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86%E5%88%86%E6%9E%90">21.7. å¼‚æ­¥å¤„ç†åˆ†æ</a><ul><li><a href="#2171-mq">21.7.1. mq</a></li></ul></li></ul></li><li><a href="#22-%E6%A1%88%E4%BE%8B-%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0">22. æ¡ˆä¾‹ ç‰©è”ç½‘å¹³å°</a></li></ul><h1>spring boot å’Œ spring cloud æ­é…é€‰å‹</h1><p><a href="https://start.spring.io/actuator/info" target="_blank" rel="noopener noreferrer">https://start.spring.io/actuator/info</a> è¿”å›çš„ json å¯ä»¥çœ‹åˆ°å®˜æ–¹æ¨èçš„æ­é…</p><h1>å¾®æœåŠ¡æ ¸å¿ƒè¦ç´ å’Œ spring cloud å·¥ä½œæµç¨‹</h1><p>Spring Cloudä¸»è¦çš„è¦ç´ /ç»„ä»¶:</p><ul><li><p>service registry/find (client, server)</p></li><li><p>distributed configuration management (server , client)</p></li><li><p>http/rpc, load balance</p></li><li><p>circuit breaker</p></li><li><p>gateway</p></li></ul><p>ä»¥åŠå®ƒçš„è®¿é—®æµç¨‹:</p><ul><li><p>å¤–éƒ¨æˆ–è€…å†…éƒ¨çš„éSpring Cloudé¡¹ç›®éƒ½ç»Ÿä¸€é€šè¿‡APIç½‘å…³ï¼ˆZuulï¼‰æ¥è®¿é—®å†…éƒ¨æœåŠ¡.</p></li><li><p>ç½‘å…³æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä»æ³¨å†Œä¸­å¿ƒï¼ˆEurekaï¼‰è·å–å¯ç”¨æœåŠ¡</p></li><li><p>ç”±Ribbonè¿›è¡Œå‡è¡¡è´Ÿè½½åï¼Œåˆ†å‘åˆ°åç«¯çš„å…·ä½“å®ä¾‹</p></li><li><p>å¾®æœåŠ¡ä¹‹é—´é€šè¿‡Feignè¿›è¡Œé€šä¿¡å¤„ç†ä¸šåŠ¡</p></li><li><p>Hystrixè´Ÿè´£å¤„ç†æœåŠ¡è¶…æ—¶ç†”æ–­</p></li><li><p>Turbineç›‘æ§æœåŠ¡é—´çš„è°ƒç”¨å’Œç†”æ–­ç›¸å…³æŒ‡æ ‡</p></li></ul><h1>å’Œdubbo-zookeeperå¯¹æ¯”</h1><p>dubboæ˜¯ç”¨æ¥è·¨ç³»ç»Ÿé€šä¿¡çš„ï¼Œæ˜¯ä¸€ä¸ª rpc æ¡†æ¶ã€‚</p><p>zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»ŸèŠ‚ç‚¹ç®¡ç†, å¯ä»¥åšæ³¨å†Œä¸­å¿ƒ</p><p>ä¸€ä¸ªç³»ç»Ÿç”¨ä½œå®¢æˆ·ç«¯ï¼Œä¸€ä¸ªç³»ç»Ÿåˆ™å……å½“æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯è¦æŠŠè‡ªå·±çš„æ¥å£å®šä¹‰æä¾›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°†æ¥å£å®šä¹‰åœ¨springä¸­çš„beanã€‚å®¢æˆ·ç«¯å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªbeanï¼Œå°±å¥½åƒè¿™äº›æ¥å£çš„å®ç°ä¹Ÿæ˜¯åœ¨è‡ªå·±ä»£ç é‡Œä¸€æ ·ã€‚
å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯åŠ¨çš„æ—¶å€™éƒ½ä¼šæŠŠè‡ªå·±çš„æœºå™¨IPæ³¨å†Œåˆ°zookeeperä¸Šã€‚å®¢æˆ·ç«¯ä¼šæŠŠzkä¸Šçš„æœåŠ¡ç«¯ipæ‹‰åˆ°ç£ç›˜ä¸Šï¼Œå¹¶è®°å½•å“ªäº›ipæä¾›å“ªäº›æœåŠ¡ï¼ˆæœåŠ¡ç«¯å¯åŠ¨çš„æ—¶å€™æš´éœ²ç»™zkï¼‰ã€‚ç„¶åè°ƒç”¨çš„æ—¶å€™å®¢æˆ·ç«¯ä¼šæ ¹æ®ipè°ƒç”¨æœåŠ¡ç«¯çš„æœåŠ¡ï¼Œè¿™æ—¶å€™å³ä½¿zkæŒ‚æ‰ä¹Ÿæ²¡å…³ç³»ã€‚</p><p>springcloud æ˜¯ dubbo çš„è¶…é›†;</p><p>å¯ä»¥è‡ªå®šä¹‰åå­— , ä½ç½®;</p><h1>é…ç½®ä¸­å¿ƒ</h1><p>ä½¿ç”¨äº†é…ç½®ä¸­å¿ƒå, åœ¨å„ä¸ª config client éœ€è¦ç”¨ bootstrap application context, å¯¹åº”çš„ é…ç½®æ–‡ä»¶ bootstrap.yml, ç”¨äºé…ç½®ä¸ä¼šç»å¸¸å˜åŒ–çš„ é…ç½®, å¦‚ app name, config server addr</p><p>å…ˆäº application.yml è¯»å–, åº”ç”¨äºæ›´åŠ æ—©æœŸé…ç½®ä¿¡æ¯è¯»å–ï¼Œå¦‚å¯ä»¥ä½¿ç”¨æ¥é…ç½®application.ymlä¸­ä½¿ç”¨åˆ°å‚æ•°ç­‰</p><p>å¦‚ä½¿ç”¨ Spring Cloud Config Server çš„æ—¶å€™ï¼Œåœ¨ bootstrap.yml é‡Œé¢æŒ‡å®š spring.application.name å’Œ spring.cloud.config.server.git.uri</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">application</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cloud</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">bootstrap</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># ç¦ç”¨ bootstrap è¿‡ç¨‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8888</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">fail-fast</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">CONFIG_SERVER_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">password</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">retry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">initial-interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">max-interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">multiplier</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">max-attempts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="spring-cloud-config">Spring-Cloud-Config<a href="#spring-cloud-config" class="hash-link" aria-label="Direct link to Spring-Cloud-Config" title="Direct link to Spring-Cloud-Config">â€‹</a></h2><p>è¿›å…¥ maintenance</p><p>åŒ…å«äº†Clientå’ŒServerä¸¤ä¸ªéƒ¨åˆ†, serverè‡ªåŠ¨å°†å­˜å‚¨çš„é…ç½®æ–‡ä»¶å‘å¸ƒæˆRESTæ¥å£, clienté€šè¿‡æ¥å£è·å–æ•°æ®ã€å¹¶ä¾æ®æ­¤æ•°æ®åˆå§‹åŒ–è‡ªå·±çš„åº”ç”¨</p><p>å®¢æˆ·ç«¯å®Œå…¨é€æ˜(ä½†æ˜¯éœ€è¦åœ¨ client çš„ bootstrap.properties ä¸­é…ç½®serverç«¯ä¿¡æ¯, è‡³å°‘éœ€è¦ <code>spring.cloud.config.server.git.uri</code>, åŒæ—¶å¯ä»¥é…ç½®æœç´¢ç›®å½• <code>spring.cloud.config.search-paths</code>), server éœ€è¦å¼€å¯ <code>@enableConfigServer</code></p><p>Spring cloudä½¿ç”¨gitæˆ–svnå­˜æ”¾é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨git;</p><p>å’Œ eureka é…åˆå, config serverç«¯apiæ¥å£ä½¿ç”¨è§„åˆ™:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/{application}/{profile}[/{label}]          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # application -  [ä¸»æ–‡ä»¶å] </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # profile ä¸º æ–‡ä»¶åprofile åç¼€, æ²¡æœ‰åˆ™ä¸º default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # label(åˆ†æ”¯å)å¯é€‰,é»˜è®¤ä¸ºmaster, è¿”å›ç»“æ„åŒ–çš„json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/{application}-{profile}.yml                # ç›´æ¥è¿”å›property sourceæ–‡ä»¶å†…çš„æ–‡æœ¬å†…å®¹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/{application}-{profile}.properties         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/{label}/{application}-{profile}.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/{label}/{application}-{profile}.properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>git repo config file é»˜è®¤å‘½åè§„åˆ™: å¯¹äº git repo ä¸­çš„é…ç½®æ–‡ä»¶ &#x27;config-client-dev.yml&#x27;, config-client ä¸ºclientç«¯ spring.application.name çš„å€¼, dev ä¸º client æ¿€æ´»çš„ profiles</p><p>å¦‚æœå¸Œæœ›è‡ªå®šä¹‰ git repo config file å‘½å, å¯ä»¥åœ¨ config client é…ç½® <code>spring.cloud.config.name/profile/label/</code>, name æ˜¯ä¸»æ–‡ä»¶å, profile æ˜¯åç¼€å</p><p>client çš„åˆ·æ–°åŠŸèƒ½: æœ€å¥½é€šè¿‡ spring cloud bus å®ç°; ä½†æ˜¯åŸºæœ¬çš„ refresh ä¹Ÿå®ç°äº†, <code>curl -d{} http://localhost:8080/refresh</code> ä¹‹å client æ‰ä¼šä½¿ç”¨æ–°çš„é…ç½®, <a href="https://www.jianshu.com/p/8fcb88ea4458" target="_blank" rel="noopener noreferrer">å¦‚æœå¼€å¯äº† actuator , åˆ™ä¼šå‡ºç° 404</a>, éœ€è¦é…ç½® <code>management.endpoints.web.exposure.include=refresh,info,health</code> (é»˜è®¤å€¼åªæœ‰ info , health. å¦‚æœæ˜¯ yml , åˆ™å€¼éœ€è¦åŠ å•å¼•å·), ç„¶å <code>curl -d{} http://xxx:xxx/actuator/refresh</code>, æ¶‰åŠåˆ°åˆ·æ–°çš„ç±», éœ€è¦ <code>@RefreshScope</code> (to support config refresh; åŸç†æ˜¯ config server ä¿®æ”¹äº†é…ç½®, è¿™ä¸ª controller bean ä¼šé”€æ¯é‡æ–°ç”Ÿæˆ)</p><p>å¼•å…¥ é…ç½®ä¸­å¿ƒå, client ç«¯çš„ application.yml éœ€è¦ rename ä¸º bootstrap.yml, æœ€å…ˆè¯»å–, ä¼šè¢«åé¢è¯»å–çš„é…ç½®è¦†ç›–, æ‰€ä»¥ä¼˜å…ˆçº§ä½äº config server ä¸­çš„é…ç½®</p><p>config server ä¿®æ”¹é…ç½®å, commit(git ä»“åº“åœ¨æœ¬åœ°) æˆ–è€… push (git åº“åœ¨è¿œç¨‹) å client ç«¯å³å¯ç”Ÿæ•ˆ</p><p>å¤šæœåŠ¡å…¬ç”¨é…ç½®æ–‡ä»¶ (å…¬å…±é…ç½®æ–‡ä»¶): </p><ul><li><p>æ–¹æ³•1: åœ¨é…ç½®æ–‡ä»¶ä»“åº“å¢åŠ é…ç½®æ–‡ä»¶ application.properties ä½œä¸ºå…¬å…±æ–‡ä»¶å³å¯. serviceA æ— æ³•åœ¨è‡ªå·±çš„é…ç½®æ–‡ä»¶ (å¦‚ serviceA.properties, serviceA-dev.properties) æ‰¾åˆ°é…ç½®é¡¹, ä¼šåˆ° å…¬å…±æ–‡ä»¶ä¸­æ‰¾</p></li><li><p>æ–¹æ³•2: æ–°å»º common.properties ä½œä¸ºå…¬å…±æ–‡ä»¶, åˆ°æ¯ä¸ª client ç«¯ ä¿®æ”¹ <code>spring.cloud.config.name=ServiceA,common</code> é…ç½®å¤šä¸ªé…ç½®æ–‡ä»¶å</p></li></ul><p>é‡è¦çš„é…ç½®</p><div class="language-props codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-props codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># server </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server.port=8888</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># æœ¬åœ°çš„git repo å°±è¿™ä¹ˆè®¾ç½® file://${user.home}/config-repo(Linux) file:///${user.home}/config-repo (windows), æœ€æ–°ç‰ˆæœ¬æ— éœ€å¦‚æ­¤è®¾ç½®äº†</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># å¦‚æœæ˜¯ remote git repo, è¿˜éœ€è¦ username, password, basedir (clone to here), search-path(properties source è·¯å¾„)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.cloud.config.server.git.uri=${user.home}/Desktop/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.application.name=reservation-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ä¸€èˆ¬åœ¨ bootstrap.yml é…ç½®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># è¿˜æœ‰ label(master), profile(default to `default`), fail-first(default to false), name(file name in remote config repo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.cloud.config.uri=http://localhost:8888</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># config refresh required: curl -d{} http://localhost:8000/actuator/refresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">management.endpoints.web.exposure.include=refresh,info,health</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="apolo">apolo<a href="#apolo" class="hash-link" aria-label="Direct link to apolo" title="Direct link to apolo">â€‹</a></h2><p>æ¥è‡ªæºç¨‹</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="alibaba-nacos-ä½œä¸ºé…ç½®ä¸­å¿ƒ">alibaba nacos ä½œä¸ºé…ç½®ä¸­å¿ƒ<a href="#alibaba-nacos-ä½œä¸ºé…ç½®ä¸­å¿ƒ" class="hash-link" aria-label="Direct link to alibaba nacos ä½œä¸ºé…ç½®ä¸­å¿ƒ" title="Direct link to alibaba nacos ä½œä¸ºé…ç½®ä¸­å¿ƒ">â€‹</a></h2><ul><li><p>namespace å‘½åç©ºé—´</p><p>è‹¥ä¸é…ç½®, åˆ™ App é»˜è®¤è¯»å– public ä¸‹çš„é…ç½®; {spring.application.name}.yml/properties </p><p>å¸¸ç”¨çš„éš”ç¦»æ–¹æ¡ˆæœ‰ä¸¤ä¸ª: å¦‚ æ¯ä¸ª sub module æ‹¥æœ‰ä¸€ä¸ª namespace, æ¯ä¸ª namespace é‡Œé¢åˆ† dev.yml, prod.yml... ; æˆ–è€…æœ‰ä¸‰ä¸ª namespace: dev, prod, test. æ¯ä¸ª namespace ä¸‹æœ‰ sub-module1.yml, sub-module2.yml, sub-module3.yml...</p></li><li><p>data-id é…ç½®é›†, å¯å°†ä¸€ä¸ªé…ç½®æ–‡ä»¶åˆ†æ‹†ä¸ºå¤šä¸ªé…ç½®æ–‡ä»¶, æ¯ä¸ªé…ç½®é›†éƒ½æœ‰ä½äº extension-configs ä¸‹çš„ data-id, group, refresh(éœ€è¦ @NacosValue(value = &quot;${aa.bb}&quot;, autoRefreshed = true) é…åˆ)</p><p>è‹¥ä¸é…ç½®, é»˜è®¤è¯»å– {spring.application.name}.yml/properties</p><p>ä¸€èˆ¬é¡¹ç›®ä¸­çš„é…ç½®æ–‡ä»¶ä¼šæ‹†åˆ†ä¸ºå¤šä¸ªé…ç½®é›†, å¦‚ datasource.yml, mybatis.yml...</p><p>å¿…é¡»é…ç½®ä¸º æ–‡ä»¶å…¨å(å³åŒ…æ‹¬åç¼€, xml, json, properties, yml)</p></li><li><p>group é…ç½®çš„åˆ†ç»„</p><p>è‹¥ä¸é…ç½®, åŠ è½½æ—¶, é»˜è®¤æ¯æ¬¡éƒ½åŠ è½½æŸ namespace ä¸‹å±äº DEFAULT_GROUP åˆ†ç»„çš„é…ç½®æ–‡ä»¶</p><p>ä¸€èˆ¬ç”¨æ¥åŒºåˆ†ç¯å¢ƒ, å¦‚ dev , prod , test . åœºæ™¯: åŒåä¸€ä¸´æ—¶ä½¿ç”¨ åˆ†ç»„ 11-11 ä¸‹çš„é…ç½®æ–‡ä»¶, å¯ä»¥æ–¹ä¾¿çš„åˆ‡æ¢</p></li></ul><h1>æ³¨å†Œä¸­å¿ƒ</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ³¨å†Œä¸­å¿ƒé€‰å‹">æ³¨å†Œä¸­å¿ƒé€‰å‹<a href="#æ³¨å†Œä¸­å¿ƒé€‰å‹" class="hash-link" aria-label="Direct link to æ³¨å†Œä¸­å¿ƒé€‰å‹" title="Direct link to æ³¨å†Œä¸­å¿ƒé€‰å‹">â€‹</a></h2><p><a href="https://blog.csdn.net/fly910905/article/details/100023415" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/fly910905/article/details/100023415</a></p><p><a href="https://yq.aliyun.com/articles/599997" target="_blank" rel="noopener noreferrer">é˜¿é‡Œå·´å·´ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ zk ä½œä¸º registry center</a></p><p>Eureka, consul (golang), zookeeper; æ–°å‡ºçš„ nacos</p><p>eurekaå°±æ˜¯ä¸ªservletç¨‹åºï¼Œè·‘åœ¨servletå®¹å™¨ä¸­; Consulåˆ™æ˜¯goç¼–å†™è€Œæˆã€‚</p><p>cap æ”¯æŒä¸åŒ:</p><ul><li><p>Consulä¼˜å…ˆä¿è¯å¼ºä¸€è‡´æ€§(C), æœåŠ¡æ³¨å†Œç›¸æ¯”Eurekaä¼šç¨æ…¢ä¸€äº›ã€‚å› ä¸ºConsulçš„raftåè®®è¦æ±‚å¿…é¡»è¿‡åŠæ•°çš„èŠ‚ç‚¹éƒ½å†™å…¥æˆåŠŸæ‰è®¤ä¸ºæ³¨å†ŒæˆåŠŸ; LeaderæŒ‚æ‰æ—¶ï¼Œé‡æ–°é€‰ä¸¾æœŸé—´æ•´ä¸ªconsulä¸å¯ç”¨ã€‚ä¿è¯äº†å¼ºä¸€è‡´æ€§ä½†ç‰ºç‰²äº†å¯ç”¨æ€§ã€‚</p></li><li><p>Eurekaä¼˜å…ˆä¿è¯é«˜å¯ç”¨(A), ä½†æ˜¯ä¼šä¿è¯æœ€ç»ˆä¸€è‡´æ€§, æœåŠ¡æ³¨å†Œç›¸å¯¹è¦å¿«ï¼Œå› ä¸ºä¸éœ€è¦ç­‰æ³¨å†Œä¿¡æ¯replicateåˆ°å…¶ä»–èŠ‚ç‚¹; å½“æ•°æ®å‡ºç°ä¸ä¸€è‡´æ—¶ï¼Œè™½ç„¶A, Bä¸Šçš„æ³¨å†Œä¿¡æ¯ä¸å®Œå…¨ç›¸åŒï¼Œä½†æ¯ä¸ªEurekaèŠ‚ç‚¹ä¾ç„¶èƒ½å¤Ÿæ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ï¼Œè¿™ä¼šå‡ºç°æŸ¥è¯¢æœåŠ¡ä¿¡æ¯æ—¶å¦‚æœè¯·æ±‚AæŸ¥ä¸åˆ°ï¼Œä½†è¯·æ±‚Bå°±èƒ½æŸ¥åˆ°ã€‚å¦‚æ­¤ä¿è¯äº†å¯ç”¨æ€§ä½†ç‰ºç‰²äº†ä¸€è‡´æ€§</p></li><li><p>zookeeper ä¼˜å…ˆä¿è¯ c , client æ²¡æœ‰å¿ƒè·³, ç«‹å³åˆ é™¤è¯¥èŠ‚ç‚¹</p></li><li><p>nacos æ˜¯ç”¨äºæ›¿ä»£ eureka, ç‰¹æ€§å’Œ eureka ç±»ä¼¼, ä¿è¯ ap, ä¹Ÿæ”¯æŒæ§åˆ¶å°</p></li></ul><p>å¯¹å¤–æš´éœ²çš„æ¥å£æƒ…å†µä¸åŒ:</p><ul><li><p>consul å’Œ eureka æ”¯æŒ http</p></li><li><p>zookeeper åªæä¾›äº† client, éœ€è¦é€šè¿‡ client äº¤äº’</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="eureka">eureka<a href="#eureka" class="hash-link" aria-label="Direct link to eureka" title="Direct link to eureka">â€‹</a></h2><p>ç›®å‰ maintenance</p><p>é»˜è®¤ä¸‹, eureka client åŠ å…¥ class path å, åº”ç”¨ä¼šè‡ªåŠ¨æ³¨å†Œåˆ° eureka server (é»˜è®¤ defaultZone ä¸º http://localhost:8761/eureka); ä½œä¸º eureka server, eureka client ä¾èµ–ä¸éœ€è¦å¼•å…¥äº†</p><p>client ç«¯è¿æ¥ server, å¦‚æœè‡ªå®šä¹‰ eureka åœ°å€, client éœ€è¦é…ç½® <code>eureka.client.serviceUrl</code>(map ç±»å‹), å¢åŠ  defaultZone (å¤§å°å†™æ•æ„Ÿ, é»˜è®¤å€¼ä¸º localhost:8761/eureka) å±æ€§, ç”¨æ¥å®šä½ server åœ°å€, ç„¶å @EnableDiscoveryClient // compared with @EnableEurekaClient, more comprehensive</p><p>æä¾›æœåŠ¡æ³¨å†Œå’Œå‘ç°, Eurekaçš„å·¥ä½œè¿‡ç¨‹: </p><p>æ¯ä¸ª service éƒ½åŒ…å«ä¸€ä¸ª Eureka client ç»„ä»¶, å°† æœºå™¨ip, ç›‘å¬ç«¯å£ä¸ŠæŠ¥ç»™ Eureka server, Eureka server ä¸­ä¿å­˜æœ‰ä¸€ä¸ªæ³¨å†Œè¡¨, application name å’Œ ip ç«¯å£ ä¸€ä¸€å¯¹åº”, Eureka client ä¼šä» Eureka server æ‹‰å»æ³¨å†Œè¡¨ç¼“å­˜åœ¨æœ¬åœ°, </p><p>æ³¨å†Œä¸­å¿ƒæ˜¯æ¯”è¾ƒé‡è¦çš„åŸºç¡€ç»„ä»¶ï¼Œ ä»…ä»…ä½¿ç”¨â€œå•ç‚¹â€è¿˜ä¸å¤Ÿï¼Œ æ›´å¤šä½¿ç”¨â€œé›†ç¾¤â€ï¼ˆé€šè¿‡è¿è¡Œå¤šä¸ªå®ä¾‹ï¼Œå¹¶è¿›è¡Œäº’ç›¸æ³¨å†Œçš„æ–¹å¼æ¥å®ç°é«˜å¯ç”¨çš„éƒ¨ç½²ï¼‰; </p><p>è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶: æŸä¸€æ—¶åˆ»æœ‰å¤§é‡èŠ‚ç‚¹çš„å¿ƒè·³æ— æ³•è¢«æŸä¸ª eureka èŠ‚ç‚¹æ¥æ”¶åˆ°, eureka ä¼šè®¤ä¸ºå‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºæ•…éšœ (æ¯”å¦‚ å»¶æ—¶ å¡é¡¿ æ‹¥æŒ¤), eureka ä¸ä¼šç«‹å³æ¸…é™¤è¿™äº›èŠ‚ç‚¹, è€Œæ˜¯ä¼šä¿æŒä¸€æ®µæ—¶é—´ (ä¿è¯ ap, ç‰ºç‰²æ‰äº† cp), </p><p>æ§åˆ¶å°æ˜¾ç¤ºä¿¡æ¯ä¼˜åŒ–: é»˜è®¤ eureka æ§åˆ¶å° ui ä¸­, å·²æ³¨å†ŒèŠ‚ç‚¹ table çš„ status åˆ—ä¼šæ˜¾ç¤ºä¸»æœºå, <code>eureka.instance.instance-id</code> å¯ä»¥å®šåˆ¶æ˜¾ç¤ºçš„ å®ä¾‹å, ä¸€èˆ¬å’Œ application name ç›¸åŒæˆ–è€…æ˜¯ <code>${spring.cloud.client.ip-address}:${server.port}</code>, è¿˜æœ‰ <code>eureka.instance.prefer-ip-address=true</code>(è¶…é“¾æ¥æ˜¾ç¤º ip),  è¿™ä¸¤ä¸ªéƒ½æ˜¯é’ˆå¯¹ eureka client çš„é…ç½®</p><p>é‡è¦çš„é…ç½®</p><div class="language-props codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-props codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># server </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼, default  true, è‹¥å¸Œæœ›ä¿è¯ä¸€è‡´æ€§, ä¸è¦å¯ç”¨æ€§, å¯ä»¥å…³é—­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># If set this to true, the registration info cannot be changed if register/remove frequently</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka.server.enable-self-preservation: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Remove invalid service instance info every xxx ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ç»­æœŸæ—¶é—´ï¼Œå³æ‰«æå¤±æ•ˆæœåŠ¡çš„é—´éš”æ—¶é—´ï¼ˆç¼ºçœä¸º60*1000msï¼‰</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka.server.eviction-interval-timer-in-ms: 6000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># The time that server wait between two heartbeats, if the second heartbeat arrives late, then remove the instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Have to &gt; å®¢æˆ·ç«¯çš„ lease-renewal-interval-in-seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka.instance.lease-expiration-duration-in-seconds: 90 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># client </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># è®¾ç½®æ˜¯å¦å°†è‡ªå·±ä½œä¸ºå®¢æˆ·ç«¯æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼ˆç¼ºçœtrueï¼‰</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># å…¶å®æŸ¥çœ‹@EnableEurekaServeræ³¨è§£çš„æºç ï¼Œä¼šå‘ç°å®ƒé—´æ¥ç”¨åˆ°äº†@EnableDiscoveryClientï¼‰, so server ç«¯æ— éœ€å¼•å…¥ client ä¾èµ–</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka.client.register-with-eureka=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># éœ€è¦æ³¨å†Œåˆ°çš„åœ°å€ , serviceUrl æ˜¯ä¸€ä¸ª map, defaultZone æ— æ³•ä½¿ç”¨ &#x27;-&#x27;, yml æ–‡ä»¶ map ä¸º `{xxx: yyy}`, list ä¸º `- xxx: yyy`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># å¦‚æœå•ç‚¹å°±æ˜¯æ³¨å†Œåˆ°è‡ªå·±, é«˜å¯ç”¨å°±éœ€è¦é…ç½®ä¸ºæ³¨å†Œåˆ°åˆ«çš„ eureka èŠ‚ç‚¹, æ³¨å†Œåˆ°å¤šä¸ª eureka ç”¨ `,` åˆ†å¼€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka.client.serviceUrl.defaultZone=http://localhost:${server.port}/eureka/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ˜¯å¦åŒæ­¥å…¶ä»–å·²ç»æ³¨å†Œçš„ service æ•°æ®, å•ç‚¹éœ€è¦ false (default ä¸º true, é›†ç¾¤å¿…é¡»ä¸ºtrue, å¦åˆ™ ribbonä¸å¯ç”¨)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka.client.fetch-registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># depend on spring-boot-starter-actuator, default to true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka.client.health-check.enabled=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># fetch info from eureka server interval, default 30s (clients have an copy of registration info from server)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka.client.registry-fetch-interval-seconds=30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># the Frequency that client send heartbeat to server, default 30s (å¿ƒè·³æ—¶é—´ / æœåŠ¡ç»­çº¦é—´éš”æ—¶é—´)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka.instance.lease-renewal-interval-in-seconds=30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># server åœ¨å—åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åçš„ç­‰å¾…æ—¶é—´ (default to 90s), è¶…æ—¶åˆ™åˆ é™¤èŠ‚ç‚¹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka.instance.lease-expiration-duration-in-seconds=90</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># å®šåˆ¶ ui é¡µä¸­çš„ status åˆ—æ˜¾ç¤ºä»€ä¹ˆ (ä¸»æœºåç§°:æœåŠ¡åç§°ä¿®æ”¹)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka.instance.instance-id=xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ui é¡µä¸­çš„è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤º ip åœ°å€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eureka.instance.prefer-id-address=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>eureka é›†ç¾¤é…ç½®:</p><p>ä¿®æ”¹æœºå™¨ hosts</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1 eureka001.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1 eureka002.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1 eureka003.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸º eureka åŠ ä¸Šå®‰å…¨æ ¡éªŒ:</p><p>å¼•å…¥ <code>spring-boot-starter-security</code>, <code>security.user.name=ä½ çš„ç”¨æˆ·å</code> å’Œ <code>security.user.password=ä½ çš„å¯†ç </code></p><p><code>eureka.client.serviceUrl.defaultZone=http://${security.user.name}:${security.user.password}@127.0.0.1:${server.port}/eureka/</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="consul">consul<a href="#consul" class="hash-link" aria-label="Direct link to consul" title="Direct link to consul">â€‹</a></h2><p>åŠŸèƒ½æ¯” Eureka å¤š (è¿˜èƒ½åš é…ç½®ä¸­å¿ƒ, æ¶ˆæ¯æ€»çº¿bus), ä½œä¸ºæ³¨å†Œä¸­å¿ƒ, åŒºåˆ«åœ¨äº: Eurekaä¿è¯ AP (è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶å¯¼è‡´ ap), Consulä¸ºCPã€‚</p><p>ç›®å‰ï¼ŒConsul  å·²ç»å–ä»£ Eureka æˆä¸º Spring Cloud çš„ç¼ºçœæœåŠ¡æ³¨å†Œå‘ç°ç»„ä»¶</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="zookeeper">zookeeper<a href="#zookeeper" class="hash-link" aria-label="Direct link to zookeeper" title="Direct link to zookeeper">â€‹</a></h2><p>ä¸šç•Œä½¿ç”¨æš‚æ—¶ä¸å¤š, åŸç”Ÿä¸å¸¦ ui ç•Œé¢</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-ä½œä¸ºæ³¨å†Œä¸­å¿ƒ">nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒ<a href="#nacos-ä½œä¸ºæ³¨å†Œä¸­å¿ƒ" class="hash-link" aria-label="Direct link to nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒ" title="Direct link to nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒ">â€‹</a></h2><p>å®Œç¾æ›¿ä»£ eureka</p><p><a href="https://www.jianshu.com/p/6b6cf891ac6a" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/6b6cf891ac6a</a>  æ‰©å±•Ribbonæ”¯æŒNacosæƒé‡çš„ä¸‰ç§æ–¹å¼</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="etcd">etcd<a href="#etcd" class="hash-link" aria-label="Direct link to etcd" title="Direct link to etcd">â€‹</a></h2><p>TODO golang å®ç°</p><h1>æœåŠ¡ç›¸äº’è°ƒç”¨</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ‰‹åŠ¨å®ç°è°ƒç”¨æ¡†æ¶">æ‰‹åŠ¨å®ç°è°ƒç”¨æ¡†æ¶<a href="#æ‰‹åŠ¨å®ç°è°ƒç”¨æ¡†æ¶" class="hash-link" aria-label="Direct link to æ‰‹åŠ¨å®ç°è°ƒç”¨æ¡†æ¶" title="Direct link to æ‰‹åŠ¨å®ç°è°ƒç”¨æ¡†æ¶">â€‹</a></h2><p><a href="https://zhuanlan.zhihu.com/p/29348799" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/29348799</a>
<a href="https://github.com/xwjie/MyRestUtil" target="_blank" rel="noopener noreferrer">https://github.com/xwjie/MyRestUtil</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="feign">feign<a href="#feign" class="hash-link" aria-label="Direct link to feign" title="Direct link to feign">â€‹</a></h2><p>è¿›å…¥ maintenance, ä¸æ¨èä½¿ç”¨</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="openfeign">OpenFeign<a href="#openfeign" class="hash-link" aria-label="Direct link to OpenFeign" title="Direct link to OpenFeign">â€‹</a></h2><p>å£°æ˜å¼çš„rest client, åº•å±‚æ˜¯é€šè¿‡ ribbon å®ç°è´Ÿè½½å‡è¡¡ (ç›¸å½“äº RestTemplate + ribbon)</p><p>åŒ…å«äº† hystrix ä¾èµ–</p><ul><li><p>ä½¿ç”¨feignæ—¶é»˜è®¤æä¾›äº†Ribbon çš„load balancing</p></li><li><p>ä½¿ç”¨ Feign æ—¶ä¹Ÿå¼•å…¥äº† hystrix, é»˜è®¤ä¸å¼€å¯ (hystrix ä¸€èˆ¬æ˜¯ä½œç”¨åœ¨æœåŠ¡è°ƒç”¨å³å®¢æˆ·ç«¯è¿™ä¸€ç«¯, ä¹Ÿå°±æ˜¯å¸¸å¸¸å’ŒFeignä¸€èµ·ä½¿ç”¨)</p></li><li><p>ä¸€ä¸ªclient å°±æ˜¯ä¸€ä¸ªæ¥å£, feign é’ˆå¯¹è¿™ä¸ªæ¥å£å®ç°äº†ä»£ç†ç±» (åŠ¨æ€ä»£ç†)</p></li></ul><p><code> @EnableFeignClients</code></p><p><code>@FeignClient</code>(also support &#x27;url&#x27;, ç”¨äºæ—  eureka çš„æƒ…å†µ; fallback ä¸º class type , æ˜¯å½“å‰ client interface çš„å®ç°ç±», éœ€è¦ @component, åœ¨å®ç°çš„æ–¹æ³•ä¸­åšé™çº§å›è°ƒé€»è¾‘, configuration å½“å‰ feign client çš„é…ç½®ç±»,å¯ä»¥è‡ªå®šä¹‰Feignçš„Encoderã€Decoderã€LogLevelã€Contract ; path: å®šä¹‰å½“å‰FeignClientçš„ç»Ÿä¸€å‰ç¼€)</p><div class="language-props codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-props codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># enable hystrix support, default to false, ä¹Ÿå¯ä»¥ä½¿ç”¨ @EnableCircuitBreaker </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feign.hystrix.enabled: true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨<a href="#åŸºæœ¬ä½¿ç”¨" class="hash-link" aria-label="Direct link to åŸºæœ¬ä½¿ç”¨" title="Direct link to åŸºæœ¬ä½¿ç”¨">â€‹</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è¶…æ—¶ç»¼åˆé…ç½®">è¶…æ—¶ç»¼åˆé…ç½®<a href="#è¶…æ—¶ç»¼åˆé…ç½®" class="hash-link" aria-label="Direct link to è¶…æ—¶ç»¼åˆé…ç½®" title="Direct link to è¶…æ—¶ç»¼åˆé…ç½®">â€‹</a></h3><p>å„ç§è¶…æ—¶é…ç½®ï¼Œå¦‚æœéƒ½å­˜åœ¨ï¼Œåˆ™æ—¶é—´å°çš„é…ç½®ç”Ÿæ•ˆ</p><div class="language-props codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-props codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">æœ€å¸¸ç”¨çš„é…ç½®é…ç½®åŸåˆ™:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 å¼€å¯Feignçš„hystrixå¼€å…³</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 hystrixè¶…æ—¶æ—¶é•¿</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 é…ç½®ribbonçš„ConnectTimeoutæ—¶é•¿</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 é…ç½®ribbonçš„ReadTimeout æ—¶é•¿</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># hystrixå¯é…ç½®çš„éƒ¨åˆ† (feign é»˜è®¤ å…³é—­ hystrix)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hystrix.command.default.execution.timeout.enable=true //ä¸ºfalseåˆ™è¶…æ—¶æ§åˆ¶æœ‰ribbonæ§åˆ¶ï¼Œä¸ºtrueåˆ™hystrixè¶…æ—¶å’Œribbonè¶…æ—¶éƒ½æ˜¯ç”¨ï¼Œä½†æ˜¯è°å°è°ç”Ÿæ•ˆï¼Œé»˜è®¤ä¸ºtrue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=3000//ç†”æ–­å™¨çš„è¶…æ—¶æ—¶é•¿é»˜è®¤1ç§’ï¼Œæœ€å¸¸ä¿®æ”¹çš„å‚æ•°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circuitBreaker.requestVolumeThreshold=20 //è§¦å‘ç†”æ–­çš„æœ€å°è¯·æ±‚æ¬¡æ•°ï¼Œé»˜è®¤ä¸º20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circuitBreaker.sleepWindowInMilliseconds=5000 //ä¼‘çœ æ—¶é•¿ï¼Œé»˜è®¤ä¸º5ç§’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circuitBreaker.errorThresholdPercentage=50 //è§¦å‘ç†”æ–­çš„å¤±è´¥è¯·æ±‚æœ€å°å æ¯”ï¼Œé»˜è®¤50%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ribbonçš„å¯é…ç½®éƒ¨åˆ†</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ribbon.ReadTimeout=1000 //å¤„ç†è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º1ç§’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ribbon.ConnectTimeout=1000 //è¿æ¥å»ºç«‹çš„è¶…æ—¶æ—¶é•¿ï¼Œé»˜è®¤1ç§’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ribbon.MaxAutoRetries=1 //åŒä¸€å°å®ä¾‹çš„æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬é¦–æ¬¡è°ƒç”¨ï¼Œé»˜è®¤ä¸º1æ¬¡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ribbon.MaxAutoRetriesNextServer=0 //é‡è¯•è´Ÿè½½å‡è¡¡å…¶ä»–å®ä¾‹çš„æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œä¸åŒ…æ‹¬é¦–æ¬¡è°ƒç”¨ï¼Œé»˜è®¤ä¸º0æ¬¡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ribbon.OkToRetryOnAllOperations=false //æ˜¯å¦å¯¹æ‰€æœ‰æ“ä½œéƒ½é‡è¯•ï¼Œé»˜è®¤false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Feignçš„å¯é…ç½®éƒ¨åˆ†</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feign.hystrix.enabled=false //Feignæ˜¯å¦å¯ç”¨æ–­è·¯å™¨,é»˜è®¤ä¸ºfalse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># defaultä¸ºå…¨å±€é…ç½®ï¼Œå¦‚æœè¦å•ç‹¬é…ç½®æ¯ä¸ªæœåŠ¡ï¼Œæ”¹ä¸ºæœåŠ¡å</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feign.client.config.default.connectTimeout=10000 //Feignçš„è¿æ¥å»ºç«‹è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º10ç§’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feign.client.config.default.readTimeout=60000 //Feignçš„è¯·æ±‚å¤„ç†è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feign.client.config.default.retryer=feign.Retryer.Default //Feignä½¿ç”¨é»˜è®¤çš„è¶…æ—¶é…ç½®ï¼Œåœ¨è¯¥ç±»æºç ä¸­å¯è§ï¼Œé»˜è®¤å•æ¬¡è¯·æ±‚æœ€å¤§æ—¶é•¿1ç§’ï¼Œé‡è¯•5æ¬¡</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="feign-client-interceptor">feign client interceptor<a href="#feign-client-interceptor" class="hash-link" aria-label="Direct link to feign client interceptor" title="Direct link to feign client interceptor">â€‹</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class FeignBasicAuthRequestInterceptor implements RequestInterceptor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Logger logger = LoggerFactory.getLogger(FeignBasicAuthRequestInterceptor.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void apply(RequestTemplate requestTemplate) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .getRequestAttributes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpServletRequest request = attributes.getRequest();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Enumeration&lt;String&gt; headerNames = request.getHeaderNames();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (headerNames != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            while (headerNames.hasMoreElements()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String name = headerNames.nextElement();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String values = request.getHeader(name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                requestTemplate.header(name, values);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Enumeration&lt;String&gt; bodyNames = request.getParameterNames();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StringBuffer body =new StringBuffer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (bodyNames != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            while (bodyNames.hasMoreElements()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String name = bodyNames.nextElement();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String values = request.getParameter(name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                body.append(name).append(&quot;=&quot;).append(values).append(&quot;&amp;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(body.length()!=0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            body.deleteCharAt(body.length()-1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            requestTemplate.body(body.toString());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.info(&quot;feign interceptor body:{}&quot;,body.toString());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">é…ç½® è®©æ‰€æœ‰ FeignClientï¼Œä½¿ç”¨ FeignBasicAuthRequestInterceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feign:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        connectTimeout: 5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        readTimeout: 5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loggerLevel: basic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requestInterceptors: com.leparts.config.FeignBasicAuthR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ä¹Ÿå¯ä»¥é…ç½®è®© æŸä¸ª FeignClient ä½¿ç”¨è¿™ä¸ª FeignBasicAuthRequestInterceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feign:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      xxxx: # è¿œç¨‹æœåŠ¡å</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        connectTimeout: 5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        readTimeout: 5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loggerLevel: basic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requestInterceptors: com.leparts.config.FeignBasicAuthR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">åœ¨è½¬å‘Feignçš„è¯·æ±‚å¤´çš„æ—¶å€™, å¦‚æœå¼€å¯äº†Hystrix, Hystrixçš„é»˜è®¤éš”ç¦»ç­–ç•¥æ˜¯Thread(çº¿ç¨‹éš”ç¦»ç­–ç•¥), å› æ­¤è½¬å‘æ‹¦æˆªå™¨å†…æ˜¯æ— æ³•è·å–åˆ°è¯·æ±‚çš„è¯·æ±‚å¤´ä¿¡æ¯çš„ã€‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">å¯ä»¥è‡ªå®šä¹‰ hystrix éš”ç¦»ç­–ç•¥</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æ—¥å¿—é…ç½®">æ—¥å¿—é…ç½®<a href="#æ—¥å¿—é…ç½®" class="hash-link" aria-label="Direct link to æ—¥å¿—é…ç½®" title="Direct link to æ—¥å¿—é…ç½®">â€‹</a></h3><p>äº†è§£ http è¯·æ±‚ç»†èŠ‚</p><p>æ—¥å¿—çº§åˆ«:</p><ul><li><p>none: é»˜è®¤, ä¸æ˜¾ç¤ºæ—¥å¿—</p></li><li><p>basic ä»…ä»…è®°å½•è¯·æ±‚æ–¹æ³•, url, response status code, å“åº”æ—¶é—´</p></li><li><p>headers: å¢åŠ äº† header ä¿¡æ¯</p></li><li><p>full: å¢åŠ äº† è¯·æ±‚å“åº”ä½“</p></li></ul><p>é…ç½®ç±»ä¸­å¢åŠ </p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class FeignConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Logger.Level feignLoggerLevel() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Logger.Level.FULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç„¶åé…ç½®æ–‡ä»¶ä¸­, æŒ‡å®šç›‘æ§çš„ feign client æ¥å£ä»¥åŠæ—¥å¿—çº§åˆ« <code>logging.level.io.github.xiaoyu.xxx.ReservationResource=debug</code></p><h1>è´Ÿè½½å‡è¡¡</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="é›†ä¸­å¼è´Ÿè½½å‡è¡¡å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡">é›†ä¸­å¼è´Ÿè½½å‡è¡¡å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡<a href="#é›†ä¸­å¼è´Ÿè½½å‡è¡¡å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡" class="hash-link" aria-label="Direct link to é›†ä¸­å¼è´Ÿè½½å‡è¡¡å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡" title="Direct link to é›†ä¸­å¼è´Ÿè½½å‡è¡¡å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡">â€‹</a></h2><p>åœ¨ consumer å’Œ provider é—´ä½¿ç”¨ç‹¬ç«‹çš„è®¾æ–½, å¦‚ nginx, å°†è¯·æ±‚ä»¥æŸç§ç­–ç•¥è¿›è¡Œåˆ†å‘, å‘é€åˆ°å¤šä¸ª provider å®ä¾‹ </p><p>ä¸‹é¢éƒ½æ˜¯ client side LoadBalance</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ribbon">ribbon<a href="#ribbon" class="hash-link" aria-label="Direct link to ribbon" title="Direct link to ribbon">â€‹</a></h2><p>è¿›å…¥  maintenance, ä½†æ˜¯ spring cloud å®˜æ–¹è¿˜åœ¨ç”¨, åªæ˜¯æ—¥å¿—ä¸­ä¼šæ¨èä½¿ç”¨ spring cloud loadbalancer</p><p>æˆ–è€…å« è¿›ç¨‹å¼è´Ÿè½½å‡è¡¡, å°±æ˜¯ å°† è´Ÿè½½å‡è¡¡é€»è¾‘é›†æˆåˆ°consumer, consumerä»æ³¨å†Œä¸­å¿ƒçš„ client ç«¯è·çŸ¥æœ‰é‚£äº›åœ°å€å¯ä»¥ç”¨,ç„¶åè‡ªå·±å†ä»è¿™äº›åœ°å€ä¸­é€‰æ‹©å‡ºä¸€ä¸ªåˆé€‚çš„ provider</p><p>Ribbon: (client side) load balancing; ribbonå¯ä»¥å°†è¯·æ±‚å‡åŒ€çš„åˆ†é…åˆ°å„ä¸ªæœºå™¨ä¸Š, å¿…é¡»å’Œ æ³¨å†Œä¸­å¿ƒä¸€èµ·ä½¿ç”¨ (eureka client ä¾èµ–åŒ…å«äº† ribbon ä¾èµ–)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å¦‚ä½•ä½¿ç”¨-ribbon">å¦‚ä½•ä½¿ç”¨ ribbon<a href="#å¦‚ä½•ä½¿ç”¨-ribbon" class="hash-link" aria-label="Direct link to å¦‚ä½•ä½¿ç”¨ ribbon" title="Direct link to å¦‚ä½•ä½¿ç”¨ ribbon">â€‹</a></h3><p>ä¸€ç§æ–¹æ³•æ˜¯ <code>@LoadBalanced </code> + restTemplate:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableDiscoveryClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class RibbonDemoApplication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private RestTemplate restTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping(&quot;/hello&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String hello() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Spring Cloud Ribbonæœ‰ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œå®ƒèƒ½å¤Ÿåœ¨è¿™é‡Œè¿›è¡Œå®é™…è°ƒç”¨çš„æ—¶å€™ï¼Œè‡ªåŠ¨çš„</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // å»é€‰å–æœåŠ¡å®ä¾‹ï¼Œå¹¶å°†å®é™…è¦è¯·æ±‚çš„IPåœ°å€å’Œç«¯å£æ›¿æ¢è¿™é‡Œçš„æœåŠ¡å</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return restTemplate.getForObject(&quot;http://eureka-single-client/hah&quot;, String.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication.run(RibbonDemoApplication.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @LoadBalanced  // ribbon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RestTemplate restTemplate() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new RestTemplate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¿˜æœ‰ä¸€ç§å°±æ˜¯ é…åˆ openFeign: (æ¨è)</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@FeignClient(&quot;reservation-service&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // also support &#x27;url&#x27; ( outside eureka)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interface ReservationResources {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(&quot;/reservations&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CollectionModel&lt;Reservation&gt; reservations();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(&quot;/message&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String message();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è´Ÿè½½å‡è¡¡ç®—æ³•">è´Ÿè½½å‡è¡¡ç®—æ³•<a href="#è´Ÿè½½å‡è¡¡ç®—æ³•" class="hash-link" aria-label="Direct link to è´Ÿè½½å‡è¡¡ç®—æ³•" title="Direct link to è´Ÿè½½å‡è¡¡ç®—æ³•">â€‹</a></h3><p>ribbon æä¾›çš„è´Ÿè½½å‡è¡¡ç®—æ³•</p><ul><li><p>é»˜è®¤ä½¿ç”¨Round Robinè½®è¯¢ç®—æ³• (è¯·æ±‚å°†ä¾æ¬¡åˆ†å‘åˆ°1~nå°æœºå™¨, å¦‚æœè¿˜æ²¡åˆ†å‘å®Œ, å†æ¬¡ä»ç¬¬ä¸€å°æœºå™¨å¼€å§‹å¾ªç¯); </p><p>ç®—æ³•å®ç°: æ¯æ¬¡è®¡ç®—å‡º instance index åéƒ½å¯¹å…¶è¿›è¡Œè®°å½•, ä¸‹ä¸€æ¬¡è¯·æ±‚è¿‡æ¥åœ¨ä¸Šæ¬¡ index åŸºç¡€ä¸Šå¢åŠ ä¸€, å¦‚æœä¸‹æ ‡è¶…å‡º instance ä¸ªæ•°, ä½¿ç”¨ instance count å–ä½™</p></li><li><p>å“åº”æ—¶é—´æƒé‡ç®—æ³•, å³æ ¹æ®æ¯ä¸ª provider çš„ response time ä¸ºè¯¥ provider å®ä¾‹åˆ†é…ä¸€ä¸ªæƒé‡, response time è¶Šé•¿, æƒé‡è¶Šå°, è¢«é€‰ä¸­çš„å‡ ç‡è¶Šä½</p></li><li><p>éšæœº</p></li><li><p>æœ€å°‘å¹¶å‘æ•°ç­–ç•¥: é€‰æ‹©è¿™æ ·çš„ provider, å®ƒçš„æ­£åœ¨å¤„ç†çš„å¹¶å‘æ•°æœ€å°‘, å¹¶ä¸”è¿™ä¸ª provider æ²¡æœ‰å¤„äºç†”æ–­ä¸­</p></li></ul><p>å¦‚ä½•æ›¿æ¢ ribbon æä¾›çš„ç®—æ³•, åšä¸ªæ€§åŒ–é…ç½®? </p><p>è‡ªå®šä¹‰ä¸€ä¸ª é…ç½®ç±», å°† é€‰å®šçš„ è§„åˆ™ bean æ³¨å…¥ spring, <code>@RibbonClient(name = &quot;target-service&quot;, configuration = {RibbonRuleConfig.class})</code> (æ„æ€æ˜¯å¯¹åä¸º target-service çš„æœåŠ¡ç«¯ä»¥ RibbonRuleConfig ä¸­é…ç½®çš„ç­–ç•¥åšè´Ÿè½½å‡è¡¡, å³ service å’Œ rule çš„æ˜ å°„)</p><p>è‡ªå®šä¹‰ ribbon é…ç½®ç±»ä¸è¦æ”¾åœ¨ <code>@componentScan</code> æ‰«çš„ package ä¸‹, å¦åˆ™è¿™ä¸ªè‡ªå®šä¹‰é…ç½®ä¸­çš„ rule bean ä¼šè¢«æ‰€æœ‰ ribbon client å…±äº«</p><p>åˆ†æ <code>RoundRobinRule</code> æºç :</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public Server choose(ILoadBalancer lb, Object key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (lb == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.warn(&quot;no load balancer&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Server server = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int count = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ä» loadBalancer è·å– allServer, é‡è¯• 10 æ¬¡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while (server == null &amp;&amp; count++ &lt; 10) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;Server&gt; reachableServers = lb.getReachableServers();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;Server&gt; allServers = lb.getAllServers();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int upCount = reachableServers.size();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int serverCount = allServers.size();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ((upCount == 0) || (serverCount == 0)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.warn(&quot;No up servers available from load balancer: &quot; + lb);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int nextServerIndex = incrementAndGetModulo(serverCount);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server = allServers.get(nextServerIndex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (server == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            /* Transient. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Thread.yield();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (server.isAlive() &amp;&amp; (server.isReadyToServe())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return (server);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Next.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (count &gt;= 10) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.warn(&quot;No available alive servers after 10 tries from load balancer: &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                + lb);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return server;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  * Inspired by the implementation of {@link AtomicInteger#incrementAndGet()}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  * @param modulo The modulo to bound the value of the counter.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  * @return The next value.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private int incrementAndGetModulo(int modulo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // cas + è‡ªæ—‹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // nextServerCyclicCounter æ˜¯ä¸Šæ¬¡é€‰ä¸­çš„ instance index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (;;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int current = nextServerCyclicCounter.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int next = (current + 1) % modulo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (nextServerCyclicCounter.compareAndSet(current, next))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return next;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="spring-cloud-loadbalancer">spring cloud loadBalancer<a href="#spring-cloud-loadbalancer" class="hash-link" aria-label="Direct link to spring cloud loadBalancer" title="Direct link to spring cloud loadBalancer">â€‹</a></h2><p>Spring Cloud Load Balancerå¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼Œè€Œæ˜¯spring-cloud-commonså…¶ä¸­çš„ä¸€ä¸ªæ¨¡å—
é¡¹ç›®ä¸­ç”¨äº†Eurekaä»¥åŠç›¸å…³çš„ starterï¼Œæƒ³å®Œå…¨å‰”é™¤Ribbonçš„ç›¸å…³ä¾èµ–åŸºæœ¬æ˜¯ä¸å¯èƒ½çš„ï¼ŒSpring ç¤¾åŒºçš„äººä¹Ÿæ˜¯çœ‹åˆ°äº†è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥ç»™å‡ºçš„åšæ³•æ˜¯: é€šè¿‡é…ç½®<code>spring.cloud.loadbalancer.ribbon.enabled=false</code>å»å…³é—­Ribbon, è‡ªåŠ¨å°±å¯ç”¨äº† Spring-Cloud-LoadBalancer, æˆä¸ºé»˜è®¤çš„è´Ÿè½½å‡è¡¡å™¨ã€‚ (<a href="https://www.yht7.com/news/92837" target="_blank" rel="noopener noreferrer">https://www.yht7.com/news/92837</a>)</p><h1>ç†”æ–­å™¨</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hystrix">hystrix<a href="#hystrix" class="hash-link" aria-label="Direct link to hystrix" title="Direct link to hystrix">â€‹</a></h2><p>è¿›å…¥ maintenance, ä½†æ˜¯è®¾è®¡ç†å¿µå€¼å¾—å­¦ä¹ </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hystrix-åŸç†">hystrix åŸç†<a href="#hystrix-åŸç†" class="hash-link" aria-label="Direct link to hystrix åŸç†" title="Direct link to hystrix åŸç†">â€‹</a></h3><p>Hystrix: éš”ç¦», ç†”æ–­(é˜²æ­¢æ•…éšœæ‰©æ•£, <a href="https://martinfowler.com/bliki/CircuitBreaker.html" target="_blank" rel="noopener noreferrer">circuit breaker</a>), é™çº§, é™æµ, å®æ—¶çš„ç›‘æ§</p><p>ä¸ºä»€ä¹ˆéœ€è¦ CircuitBreaker? é˜²æ­¢ cascading failure (æœåŠ¡é›ªå´©)</p><p>æœåŠ¡é›ªå´©æ•ˆåº”: åœ¨ä¸€ä¸ª micro service system é‡Œ, ä¼šæ¶‰åŠåˆ°æœåŠ¡çš„ çº§è”è°ƒç”¨, å¦‚æœä¸‹æ¸¸çš„ service å¼‚å¸¸, ä¸Šæ¸¸çš„ service ä¹Ÿä¼šå¡ä½(ç„¶åè¶…æ—¶å¼‚å¸¸), ä¸Šæ¸¸ service å¡ä½çš„è¯·æ±‚å¤šäº† çº¿ç¨‹ç­‰èµ„æºä¼šè€—å°½, è¿›è€Œè¿™ä¸ªä¸Šæ¸¸ service ä¹Ÿä¼šå¼‚å¸¸, ç”±äºè¿é”ååº”, æœ€åæ•´æ¡è°ƒç”¨é“¾ä¸Šçš„æœåŠ¡éƒ½ä¼šå¼‚å¸¸; <code>è€Œå®é™…ä¸Šä¸Šæ¸¸ service æ˜¯å¯ä»¥åœ¨ä¸‹æ¸¸ service æŒ‚æ‰åå•ç‹¬æä¾›æœåŠ¡çš„, æ¯”å¦‚ è®¢å•æœåŠ¡ å’Œ ç§¯åˆ†æœåŠ¡</code></p><p>hystrix æ˜¯ ç†”æ–­å™¨çš„ä¸€ä¸ªå®ç°, æ¶ˆè´¹ä¾§,æœåŠ¡ä¾§éƒ½å¯ä½¿ç”¨</p><p>ç†”æ–­å™¨ï¼ˆCircuitBreakerï¼‰: (ç†”æ–­å™¨æ¨¡å¼å°±åƒæ˜¯é‚£äº›å®¹æ˜“å¯¼è‡´é”™è¯¯çš„æ“ä½œçš„ä¸€ç§ä»£ç†ã€‚è¿™ç§ä»£ç†èƒ½å¤Ÿè®°å½•æœ€è¿‘è°ƒç”¨å‘ç”Ÿé”™è¯¯çš„æ¬¡æ•°ï¼Œç„¶åå†³å®šä½¿ç”¨å…è®¸æ“ä½œç»§ç»­ï¼Œæˆ–è€…ç«‹å³è¿”å›é”™è¯¯) ç†”æ–­å™¨å°±æ˜¯ä¿æŠ¤æœåŠ¡é«˜å¯ç”¨çš„æœ€åä¸€é“é˜²çº¿ã€‚</p><p>åŸç†: å½“å‰ service è°ƒç”¨å…¶ä»–ä¸åŒçš„ service, éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ thread pool (<code>éš”ç¦»</code>), é˜²æ­¢çº¿ç¨‹èµ„æºç”±äºæŸä¸ª service æ•…éšœè€Œè¢«è€—å°½; å°†å‡½æ•°è°ƒç”¨åŒ…è£…åœ¨ä¸€ä¸ª circuit breaker å¯¹è±¡ä¸­, å¯¹è°ƒç”¨å¤±è´¥æ¬¡æ•°è¿›è¡Œç›‘æ§, è¾¾åˆ°è®¾å®šçš„é˜ˆå€¼, ç›´æ¥è¿”å›é”™è¯¯è€Œä¸è®¿é—®åŸå§‹å‡½æ•° (<code>ç†”æ–­</code>), åŒæ—¶æœ‰ä¸€ä¸ªå›è°ƒå‡½æ•°, è¿›è¡Œé¢å¤–åŠ¨ä½œ(<code>é™çº§</code>)</p><p>ç†”æ–­åªæ˜¯ä½œç”¨åœ¨æœåŠ¡è°ƒç”¨è¿™ä¸€ç«¯(consumer ç»„ä»¶ç«¯)</p><p>Hystrixç‰¹æ€§:</p><ul><li><p>ç†”æ–­æœºåˆ¶ : å½“Hystrix Commandè¯·æ±‚åç«¯æœåŠ¡å¤±è´¥æ•°é‡è¶…è¿‡ä¸€å®šæ¯”ä¾‹(<code>é»˜è®¤50%</code>), æ–­è·¯å™¨ä¼šåˆ‡æ¢åˆ°å¼€è·¯çŠ¶æ€(Open). è¿™æ—¶æ‰€æœ‰è¯·æ±‚ä¼šç›´æ¥å¤±è´¥è€Œä¸ä¼šå‘é€åˆ°åç«¯æœåŠ¡, åœ¨ä¸€ä¸ª æ—¶é—´çª—å£æœŸå†… (é»˜è®¤ 5s) , fallback æˆä¸ºä¸»é€»è¾‘, å½“ä¼‘çœ æ—¶é—´çª—åˆ°æœŸ, , è‡ªåŠ¨åˆ‡æ¢åˆ°åŠå¼€è·¯çŠ¶æ€(HALF-OPEN). è¿™æ—¶ä¼šåˆ¤æ–­ä¸‹ä¸€æ¬¡è¯·æ±‚çš„è¿”å›æƒ…å†µ, å¦‚æœè¯·æ±‚æˆåŠŸ, æ–­è·¯å™¨åˆ‡å›é—­è·¯çŠ¶æ€(CLOSED), å¦åˆ™é‡æ–°åˆ‡æ¢åˆ°å¼€è·¯çŠ¶æ€(OPEN), æ—¶é—´çª—é‡æ–°è®¡æ—¶. </p></li><li><p>Fallback: é™çº§æ“ä½œ. </p><p>å¯¹äºæŸ¥è¯¢æ“ä½œ, å¯ä»¥å®ç°ä¸€ä¸ªfallbackæ–¹æ³•, å½“è¯·æ±‚åç«¯æœåŠ¡å‡ºç°å¼‚å¸¸çš„æ—¶å€™, å¯ä»¥ä½¿ç”¨fallbackæ–¹æ³•è¿”å›å€¼. fallbackæ–¹æ³•çš„è¿”å›å€¼ä¸€èˆ¬æ˜¯è®¾ç½®çš„é»˜è®¤å€¼æˆ–è€…æ¥è‡ªç¼“å­˜.</p><p>ä»€ä¹ˆæ—¶å€™éœ€è¦é™çº§? è¶…æ—¶, å¼‚å¸¸, ç†”æ–­, çº¿ç¨‹æ± /ä¿¡å·é‡ æ‰“æ»¡</p></li><li><p>èµ„æºéš”ç¦»: åœ¨Hystrixä¸­, ä¸»è¦é€šè¿‡çº¿ç¨‹æ± æ¥å®ç°èµ„æºéš”ç¦»; é€šå¸¸åœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬ä¼šæ ¹æ®è°ƒç”¨çš„è¿œç¨‹æœåŠ¡åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹æ± . ä¾‹å¦‚è°ƒç”¨äº§å“æœåŠ¡çš„Commandæ”¾å…¥Açº¿ç¨‹æ± , è°ƒç”¨è´¦æˆ·æœåŠ¡çš„Commandæ”¾å…¥Bçº¿ç¨‹æ± . è¿™æ ·åšçš„ä¸»è¦ä¼˜ç‚¹æ˜¯è¿è¡Œç¯å¢ƒè¢«éš”ç¦»å¼€äº†. è¿™æ ·å°±ç®—è°ƒç”¨æœåŠ¡çš„ä»£ç å­˜åœ¨bugæˆ–è€…ç”±äºå…¶ä»–åŸå› å¯¼è‡´è‡ªå·±æ‰€åœ¨çº¿ç¨‹æ± è¢«è€—å°½æ—¶, ä¸ä¼šå¯¹ç³»ç»Ÿçš„å…¶ä»–æœåŠ¡é€ æˆå½±å“. ä½†æ˜¯å¸¦æ¥çš„ä»£ä»·å°±æ˜¯ç»´æŠ¤å¤šä¸ªçº¿ç¨‹æ± ä¼šå¯¹ç³»ç»Ÿå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€. å¦‚æœæ˜¯å¯¹æ€§èƒ½æœ‰ä¸¥æ ¼è¦æ±‚è€Œä¸”ç¡®ä¿¡è‡ªå·±è°ƒç”¨æœåŠ¡çš„å®¢æˆ·ç«¯ä»£ç ä¸ä¼šå‡ºé—®é¢˜çš„è¯, å¯ä»¥ä½¿ç”¨Hystrixçš„ä¿¡å·æ¨¡å¼(Semaphores)æ¥éš”ç¦»èµ„æº.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hystrix-é™çº§ä½¿ç”¨">hystrix é™çº§ä½¿ç”¨<a href="#hystrix-é™çº§ä½¿ç”¨" class="hash-link" aria-label="Direct link to hystrix é™çº§ä½¿ç”¨" title="Direct link to hystrix é™çº§ä½¿ç”¨">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="å•ç‹¬ä½¿ç”¨">å•ç‹¬ä½¿ç”¨<a href="#å•ç‹¬ä½¿ç”¨" class="hash-link" aria-label="Direct link to å•ç‹¬ä½¿ç”¨" title="Direct link to å•ç‹¬ä½¿ç”¨">â€‹</a></h4><p>ä¸€ç§ä½¿ç”¨æ–¹æ³•: <code>@HystrixCommand(fallbackMethod = &quot;defaultHah&quot;)</code> , defaultHah æ–¹æ³•å¯ä»¥å¤šä¸€ä¸ªå‚æ•°è¡¨ç¤ºå¼‚å¸¸; ç„¶å <code>@EnableCircuitBreaker</code>/<code>@EnableHystrix</code> (åè€…åŒ…å«äº†å‰è€…)</p><p>ç†”æ–­æ¡ä»¶é…ç½®, å¯ä»¥åœ¨é…ç½®æ–‡ä»¶</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">circuitBreaker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ç¬¦åˆè¿™äº›æ¡ä»¶, æ‰“å¼€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># When calls to a particular service exceed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">requestVolumeThreshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># failure percentage is greater than</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">errorThresholdPercentage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 50%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rollingStats</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># in a rolling window defined by ..,  the circuit opens and the call is not made</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">timeInMilliseconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æ³¨è§£ä¸Šé…ç½®:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@HystrixCommand(fallbackMethod = &quot;fallback&quot;, commandProperties = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;3000&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping(&quot;/reservations/names&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public ResponseEntity&lt;Collection&lt;String&gt;&gt; names() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // è¶…æ—¶æˆ–è€…å¼‚å¸¸ éƒ½èµ° fallback æ–¹æ³•</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // if (enableErr) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     throw new RuntimeException(&quot;some error produced&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Thread.sleep(5 * 1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } catch (InterruptedException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new ResponseEntity&lt;&gt;(reservationResources.reservations().getContent().stream()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .map(Reservation::getName).collect(Collectors.toList()), HttpStatus.OK);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç±»çº§åˆ«çš„(å…¨å±€çš„)é™çº§: ç±»çº§åˆ«çš„æ³¨è§£ <code>@DefaultProperties(defaultFallback = &quot;defaultFallback&quot;)</code>, defaultFallback æ˜¯å½“å‰ç±»çš„ä¸€ä¸ªæ–¹æ³•</p><p>é…ç½®å‚æ•°åŠé»˜è®¤å€¼åœ¨ <code>HystrixCommandProperties</code> å¯ä»¥æŸ¥çœ‹</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@HystrixCommand(fallbackMethod = &quot;fallback&quot;, commandProperties = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;, value = &quot;true&quot;), // æ˜¯å¦å¼€å¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @HystrixProperty(name = &quot;circuitBreakerVolumeThreshold&quot;, value = &quot;10&quot;),// è¯·æ±‚æ¬¡æ•°, é»˜è®¤ 20 æ¬¡, è¶…è¿‡æ‰ä¼šæ‰“å¼€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @HystrixProperty(name = &quot;circuitBreaker.sleepWindowInMilliSeconds&quot;, value = &quot;5000&quot;),// ç¡çœ æ—¶é—´çª—å£ (è¿™æ®µæ—¶é—´åè¿›å…¥åŠå¼€çŠ¶æ€), é»˜è®¤ 5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;, value = &quot;60&quot;)// å¤±è´¥ç‡é™é¢, è¶…è¿‡åˆ™æ–­å¼€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @HystrixProperty(name = &quot;metrics.rollingStats.timeInMilliseconds&quot;, value = &quot;10000&quot;)// æ»šåŠ¨ç»Ÿè®¡æ—¶é—´çª—å£</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping(&quot;/reservations/names&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public ResponseEntity&lt;Collection&lt;String&gt;&gt; names() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // è¶…æ—¶æˆ–è€…å¼‚å¸¸ éƒ½èµ° fallback æ–¹æ³•</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // if (enableErr) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     throw new RuntimeException(&quot;some error produced&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Thread.sleep(5 * 1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } catch (InterruptedException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new ResponseEntity&lt;&gt;(reservationResources.reservations().getContent().stream()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .map(Reservation::getName).collect(Collectors.toList()), HttpStatus.OK);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="é…åˆ-openfeign">é…åˆ openFeign<a href="#é…åˆ-openfeign" class="hash-link" aria-label="Direct link to é…åˆ openFeign" title="Direct link to é…åˆ openFeign">â€‹</a></h4><p>ç¬¬äºŒç§ä½¿ç”¨æ–¹æ³•: ä¸€èˆ¬æ˜¯é…åˆ openFeign è¿›è¡Œé™çº§</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@FeignClient(value = &quot;reservation-service&quot;, fallback = ReservationResourcesFallback.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // also support &#x27;url&#x27; ( outside eureka)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interface ReservationResources {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(&quot;/reservations&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CollectionModel&lt;Reservation&gt; reservations();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(&quot;/message&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String message();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ReservationResourcesFallback implements ReservationResources {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CollectionModel&lt;Reservation&gt; reservations() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String message() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ç†”æ–­ç›‘æ§hystrix-dashboardå’Œturbine">ç†”æ–­ç›‘æ§Hystrix-Dashboardå’ŒTurbine<a href="#ç†”æ–­ç›‘æ§hystrix-dashboardå’Œturbine" class="hash-link" aria-label="Direct link to ç†”æ–­ç›‘æ§Hystrix-Dashboardå’ŒTurbine" title="Direct link to ç†”æ–­ç›‘æ§Hystrix-Dashboardå’ŒTurbine">â€‹</a></h3><p>Hystrix-dashboardæ˜¯ä¸€æ¬¾é’ˆå¯¹Hystrixè¿›è¡Œå®æ—¶ç›‘æ§çš„å·¥å…·, å„Hystrix Commandçš„è¯·æ±‚å“åº”æ—¶é—´, è¯·æ±‚æˆåŠŸç‡ç­‰æ•°æ®ã€‚(å®æ—¶ç›‘æ§, å†å²ç†”æ–­æ•°æ®æ— æ³•æŸ¥çœ‹)</p><p>ä½†æ˜¯åªä½¿ç”¨Hystrix Dashboardçš„è¯, ä½ åªèƒ½çœ‹åˆ°å•ä¸ªåº”ç”¨å†…çš„æœåŠ¡ä¿¡æ¯, è¿™æ˜æ˜¾ä¸å¤Ÿ. æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥å…·èƒ½è®©æˆ‘ä»¬æ±‡æ€»ç³»ç»Ÿå†…å¤šä¸ªæœåŠ¡çš„æ•°æ®å¹¶æ˜¾ç¤ºåˆ°Hystrix Dashboardä¸Š, è¿™ä¸ªå·¥å…·å°±æ˜¯Turbine.</p><ul><li><p>Hystrix-Dashboard å¯ä»¥ç›´æ¥ app ä¸­é›†æˆ, ç›‘æ§å…¶æ‰€åœ¨çš„é‚£ä¸ª app; turbine æ–°å¯äº†ä¸€ä¸ªç‹¬ç«‹é¡¹ç›®, ä¸“é—¨è´Ÿè´£ç›‘æ§æ‰€æœ‰çš„node;</p></li><li><p>Netflixæä¾›äº†ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ˆTurbineï¼‰æ¥æä¾›æŠŠå¤šä¸ªhystrix.streamçš„å†…å®¹èšåˆä¸ºä¸€ä¸ªæ•°æ®æºä¾›Dashboardå±•ç¤º</p></li><li><p>æ¯ä¸ªä½¿ç”¨äº† hystrix çš„ app ä¼šå‘å¸ƒä¸€ä¸ªæ¥å£ http://app-uri/actuator/hystrix.stream (éœ€è¦å¼•å…¥ actuator, é…ç½® management.endpoints.web.exposure.include=hystrix.stream, ç›´æ¥é…ç½®ä¸º &quot;*&quot; æš´éœ²å…¨éƒ¨äº¦å¯), è¿”å› hystrix steam æ•°æ®, åœ¨ hystrix dashboard (http://dashboard-uri/hystrix) è¾“å…¥å‰é¢çš„steamåœ°å€å‘ˆç°å›¾å½¢ç•Œé¢; æŸ¥çœ‹ Hystrix Dashboard Wiki å¯çŸ¥æ™“ç›‘æ§ç”»é¢çš„å«ä¹‰</p></li><li><p>è®¿é—® http://localhost:8001/turbine.stream å‡ºç°streamæ•°æ®ç•Œé¢(çº¯æ•°æ®å­—ç¬¦); è®¿é—®http://localhost:8001/hystrix æ¥ç€è¾“å…¥streamåœ°å€, å‘ˆç°å›¾å½¢ç•Œé¢;</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è‡ªå®šä¹‰éš”ç¦»ç­–ç•¥">è‡ªå®šä¹‰éš”ç¦»ç­–ç•¥<a href="#è‡ªå®šä¹‰éš”ç¦»ç­–ç•¥" class="hash-link" aria-label="Direct link to è‡ªå®šä¹‰éš”ç¦»ç­–ç•¥" title="Direct link to è‡ªå®šä¹‰éš”ç¦»ç­–ç•¥">â€‹</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FeignHystrixConcurrencyStrategy extends HystrixConcurrencyStrategy {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Logger log = LoggerFactory.getLogger(FeignHystrixConcurrencyStrategy.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private HystrixConcurrencyStrategy delegate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public FeignHystrixConcurrencyStrategy() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.delegate = HystrixPlugins.getInstance().getConcurrencyStrategy();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (this.delegate instanceof FeignHystrixConcurrencyStrategy) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // Welcome to singleton hell...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HystrixCommandExecutionHook commandExecutionHook =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    HystrixPlugins.getInstance().getCommandExecutionHook();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HystrixEventNotifier eventNotifier = HystrixPlugins.getInstance().getEventNotifier();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HystrixMetricsPublisher metricsPublisher = HystrixPlugins.getInstance().getMetricsPublisher();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HystrixPropertiesStrategy propertiesStrategy =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    HystrixPlugins.getInstance().getPropertiesStrategy();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.logCurrentStateOfHystrixPlugins(eventNotifier, metricsPublisher, propertiesStrategy);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HystrixPlugins.reset();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HystrixPlugins instance = HystrixPlugins.getInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            instance.registerConcurrencyStrategy(this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            instance.registerCommandExecutionHook(commandExecutionHook);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            instance.registerEventNotifier(eventNotifier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            instance.registerMetricsPublisher(metricsPublisher);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            instance.registerPropertiesStrategy(propertiesStrategy);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot;Failed to register Sleuth Hystrix Concurrency Strategy&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void logCurrentStateOfHystrixPlugins(HystrixEventNotifier eventNotifier,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                 HystrixMetricsPublisher metricsPublisher,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                 HystrixPropertiesStrategy propertiesStrategy) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (log.isDebugEnabled()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.debug(&quot;Current Hystrix plugins configuration is [&quot; + &quot;concurrencyStrategy [&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    + this.delegate + &quot;],&quot; + &quot;eventNotifier [&quot; + eventNotifier + &quot;],&quot; + &quot;metricPublisher [&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    + metricsPublisher + &quot;],&quot; + &quot;propertiesStrategy [&quot; + propertiesStrategy + &quot;],&quot; + &quot;]&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.debug(&quot;Registering Sleuth Hystrix Concurrency Strategy.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public &lt;T&gt; Callable&lt;T&gt; wrapCallable(Callable&lt;T&gt; callable) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RequestAttributes requestAttributes = RequestContextHolder.getRequestAttributes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new WrappedCallable&lt;&gt;(callable, requestAttributes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ThreadPoolExecutor getThreadPool(HystrixThreadPoolKey threadPoolKey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            HystrixProperty&lt;Integer&gt; corePoolSize,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            HystrixProperty&lt;Integer&gt; maximumPoolSize,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            HystrixProperty&lt;Integer&gt; keepAliveTime,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this.delegate.getThreadPool(threadPoolKey, corePoolSize, maximumPoolSize, keepAliveTime,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                unit, workQueue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ThreadPoolExecutor getThreadPool(HystrixThreadPoolKey threadPoolKey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            HystrixThreadPoolProperties threadPoolProperties) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this.delegate.getThreadPool(threadPoolKey, threadPoolProperties);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BlockingQueue&lt;Runnable&gt; getBlockingQueue(int maxQueueSize) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this.delegate.getBlockingQueue(maxQueueSize);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public &lt;T&gt; HystrixRequestVariable&lt;T&gt; getRequestVariable(HystrixRequestVariableLifecycle&lt;T&gt; rv) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this.delegate.getRequestVariable(rv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static class WrappedCallable&lt;T&gt; implements Callable&lt;T&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private final Callable&lt;T&gt; target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private final RequestAttributes requestAttributes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WrappedCallable(Callable&lt;T&gt; target, RequestAttributes requestAttributes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.target = target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.requestAttributes = requestAttributes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public T call() throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                RequestContextHolder.setRequestAttributes(requestAttributes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return target.call();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                RequestContextHolder.resetRequestAttributes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="spring-cloud-alibaba-sentinel">spring cloud alibaba sentinel<a href="#spring-cloud-alibaba-sentinel" class="hash-link" aria-label="Direct link to spring cloud alibaba sentinel" title="Direct link to spring cloud alibaba sentinel">â€‹</a></h2><p>å›½å†…ä½¿ç”¨å¤š</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="resilience4j">resilience4j<a href="#resilience4j" class="hash-link" aria-label="Direct link to resilience4j" title="Direct link to resilience4j">â€‹</a></h2><p>å›½å¤–ä½¿ç”¨å¤š, åŸºäºJava 8å¼€å‘çš„ï¼Œå¹¶ä¸”åªä½¿ç”¨äº†vavråº“ </p><p><a href="https://segmentfault.com/a/1190000019617975" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000019617975</a></p><h1>æœåŠ¡ç½‘å…³</h1><p>zuul, spring-cloud gateway</p><p>ç”¨äºè·¯ç”±. å‰ç«¯è¯·æ±‚é€šè¿‡ç½‘å…³, è½¬å‘ç»™åç«¯å…·ä½“çš„ service, é›†ä¸­è¿›è¡Œç»Ÿä¸€çš„é™çº§, é™æµ, è®¤è¯æˆæƒ</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç½‘å…³é€‰å‹">ç½‘å…³é€‰å‹<a href="#ç½‘å…³é€‰å‹" class="hash-link" aria-label="Direct link to ç½‘å…³é€‰å‹" title="Direct link to ç½‘å…³é€‰å‹">â€‹</a></h2><p><a href="https://codeantenna.com/a/HYlbT1VZT7" target="_blank" rel="noopener noreferrer">https://codeantenna.com/a/HYlbT1VZT7</a></p><p>API ç½‘å…³çš„å¥½å¤„: </p><ul><li><p>ç®€åŒ–å®¢æˆ·ç«¯è°ƒç”¨å¤æ‚åº¦ (ä¹Ÿå°±æ˜¯è·¯ç”±åŠŸèƒ½): åœ¨å¾®æœåŠ¡æ¶æ„æ¨¡å¼ä¸‹åç«¯æœåŠ¡çš„å®ä¾‹æ•°ä¸€èˆ¬æ˜¯åŠ¨æ€çš„ï¼Œå¯¹äºå®¢æˆ·ç«¯è€Œè¨€å¾ˆéš¾å‘ç°åŠ¨æ€æ”¹å˜çš„æœåŠ¡å®ä¾‹çš„è®¿é—®åœ°å€ä¿¡æ¯;</p></li><li><p>æ•°æ®è½¬æ¢ä»¥åŠèšåˆ: API Gatewayå¯ä»¥å¯¹é€šç”¨æ€§çš„å“åº”æ•°æ®è¿›è¡Œè£å‰ªä»¥é€‚åº”ä¸åŒå®¢æˆ·ç«¯çš„ä½¿ç”¨éœ€æ±‚ã€‚åŒæ—¶è¿˜å¯ä»¥å°†å¤šä¸ªAPIè°ƒç”¨é€»è¾‘è¿›è¡Œèšåˆï¼Œä»è€Œå‡å°‘å®¢æˆ·ç«¯çš„è¯·æ±‚æ•°ï¼Œä¼˜åŒ–å®¢æˆ·ç«¯ç”¨æˆ·ä½“éªŒ</p></li><li><p>é›†ä¸­åšä¸€äº›åŠŸèƒ½: é‰´æƒ, é™æµ, ç›‘æ§, æ—¥å¿—</p></li><li><p>é—ç•™ç³»ç»Ÿçš„å¾®æœåŠ¡åŒ–æ”¹é€ </p></li></ul><p>Zuul 1.x æ„å»ºäº Servlet 2.5ï¼Œå…¼å®¹ 3.xï¼Œä½¿ç”¨çš„æ˜¯é˜»å¡å¼çš„ APIï¼Œä¸æ”¯æŒé•¿è¿æ¥ï¼Œæ¯”å¦‚ websocketsã€‚ä½†æ˜¯ 2.x ç‰ˆæœ¬å·²ç»æ”¯æŒå¼‚æ­¥æ— é˜»å¡ api (åŸºäºnetty)</p><p>Spring Cloud Gatewayæ„å»ºäº Spring 5+ï¼ŒåŸºäº Spring Boot 2.x å“åº”å¼çš„ã€éé˜»å¡å¼çš„ APIã€‚åŒæ—¶ï¼Œå®ƒæ”¯æŒ websocketsï¼Œå’Œ Spring æ¡†æ¶ç´§å¯†é›†æˆã€‚æ¨è</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç½‘å…³é«˜å¯ç”¨">ç½‘å…³é«˜å¯ç”¨<a href="#ç½‘å…³é«˜å¯ç”¨" class="hash-link" aria-label="Direct link to ç½‘å…³é«˜å¯ç”¨" title="Direct link to ç½‘å…³é«˜å¯ç”¨">â€‹</a></h2><p><a href="https://blog.csdn.net/yangwenpei116/article/details/104250006/" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/yangwenpei116/article/details/104250006/</a>
<a href="https://www.cnblogs.com/SimpleWu/p/11004902.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/SimpleWu/p/11004902.html</a>
TODO</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nodejs">nodejs<a href="#nodejs" class="hash-link" aria-label="Direct link to nodejs" title="Direct link to nodejs">â€‹</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kong">kong<a href="#kong" class="hash-link" aria-label="Direct link to kong" title="Direct link to kong">â€‹</a></h2><p>éœ€è¦ lua è„šæœ¬å¼€å‘</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="openresty">openResty<a href="#openresty" class="hash-link" aria-label="Direct link to openResty" title="Direct link to openResty">â€‹</a></h2><p>å°±æ˜¯ nginx + lua</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="zuul">zuul<a href="#zuul" class="hash-link" aria-label="Direct link to zuul" title="Direct link to zuul">â€‹</a></h2><p>è¿›å…¥ maintenance</p><p>zuul2 æœ¬æ¥æœ‰æ”¹è¿›, ä½†æ˜¯ç”¨çš„ä¸å¤š</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ä»€ä¹ˆæ˜¯zuul">ä»€ä¹ˆæ˜¯zuul<a href="#ä»€ä¹ˆæ˜¯zuul" class="hash-link" aria-label="Direct link to ä»€ä¹ˆæ˜¯zuul" title="Direct link to ä»€ä¹ˆæ˜¯zuul">â€‹</a></h3><p>åœ¨Spring Cloudä½“ç³»ä¸­ï¼Œ Spring Cloud Zuulå°±æ˜¯æä¾›è´Ÿè½½å‡è¡¡ã€åå‘ä»£ç†ã€æƒé™è®¤è¯çš„ä¸€ä¸ªAPI gatewayã€‚(æä¾›åŠ¨æ€è·¯ç”±ï¼Œç›‘æ§ï¼Œå¼¹æ€§ï¼Œå®‰å…¨ç­‰çš„è¾¹ç¼˜æœåŠ¡ã€‚Zuulæ˜¯Netflixå‡ºå“çš„ä¸€ä¸ªåŸºäºJVMè·¯ç”±å’ŒæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ã€‚)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="åŸºæœ¬ä½¿ç”¨-1">åŸºæœ¬ä½¿ç”¨<a href="#åŸºæœ¬ä½¿ç”¨-1" class="hash-link" aria-label="Direct link to åŸºæœ¬ä½¿ç”¨" title="Direct link to åŸºæœ¬ä½¿ç”¨">â€‹</a></h3><p>ä¸€èˆ¬æ˜¯é…åˆæ³¨å†Œä¸­å¿ƒä¸€èµ·ä½¿ç”¨, åœ¨ eureka çš„é…åˆä¸‹, åªéœ€è¦åœ¨æŸä¸ª eureka client ä¸‹ä½¿ç”¨ <code>@EnableZuulProxy</code> (å¯çœ‹ä½œ @EnableZuulServer çš„å¢å¼º), å³å¯ä»£ç†æ‰€æœ‰ eureka ä¸Šçš„æœåŠ¡, æ”¯æŒè´Ÿè½½å‡è¡¡</p><p>ç½‘å…³çš„é»˜è®¤è·¯ç”±è§„åˆ™: é»˜è®¤æƒ…å†µä¸‹ï¼ŒZuulä¼šä»£ç†æ‰€æœ‰æ³¨å†Œåˆ°Eureka Serverçš„å¾®æœåŠ¡ï¼Œå¹¶ä¸”Zuulçš„è·¯ç”±è§„åˆ™å¦‚ä¸‹ï¼š<code>http://ZUUL_HOST:ZUUL_PORT/serviceId/**</code> ä¼šè¢«è½¬å‘åˆ° serviceId å¯¹åº”çš„ pathã€‚</p><p>è‡ªå®šä¹‰è·¯ç”±è§„åˆ™ï¼š <code>http://ZUUL_HOST:ZUUL_PORT/zuul.routes.xxx.path/**</code> ä¼šè¢«è½¬å‘åˆ° <code>zuul.routes.xxx.url/**</code></p><p><a href="http://www.ityouknow.com/springcloud/2018/01/20/spring-cloud-zuul.html" target="_blank" rel="noopener noreferrer">http://www.ityouknow.com/springcloud/2018/01/20/spring-cloud-zuul.html</a>
<a href="http://www.ityouknow.com/springcloud/2018/02/02/spring-cloud-sleuth-zipkin.html" target="_blank" rel="noopener noreferrer">http://www.ityouknow.com/springcloud/2018/02/02/spring-cloud-sleuth-zipkin.html</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="spring-cloud-gateway">spring-cloud-gateway<a href="#spring-cloud-gateway" class="hash-link" aria-label="Direct link to spring-cloud-gateway" title="Direct link to spring-cloud-gateway">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ç®€å•ä»‹ç»">ç®€å•ä»‹ç»<a href="#ç®€å•ä»‹ç»" class="hash-link" aria-label="Direct link to ç®€å•ä»‹ç»" title="Direct link to ç®€å•ä»‹ç»">â€‹</a></h3><p>Spring Cloud Gateway requires the Netty runtime provided by Spring Boot and Spring Webflux. It does not work in a traditional Servlet Container or built as a WAR (ä½¿ç”¨ netty+webflux å®ç°å› æ­¤ä¸éœ€è¦å†å¼•å…¥ web æ¨¡å—, ä¸èƒ½ä½¿ç”¨ servlet container)</p><p>åŒ…æ‹¬ä¸‰ä¸ªå¤§çš„è¦ç´ :</p><ul><li><p>route: å°† request è½¬å‘åˆ°å…·ä½“çš„æŸä¸ª service , åŒ…å« (id, destination Uri, collection)</p><p>routeæœ‰ä¸¤ç§é…ç½®æ–¹å¼, é€šè¿‡yml,æˆ–è€… é€šè¿‡@beanè‡ªå®šä¹‰ RouteLocator; </p><p>ä¸€ä¸ªè¯·æ±‚æ»¡è¶³å¤šä¸ªè·¯ç”±çš„è°“è¯æ¡ä»¶æ—¶ï¼Œè¯·æ±‚åªä¼šè¢«é¦–ä¸ªæˆåŠŸåŒ¹é…çš„è·¯ç”±è½¬å‘ (å°±è¿‘åŒ¹é…); </p><p>æ³¨å†Œåˆ° registration center å, é€šè¿‡é…ç½®, å¯ä»¥è‡ªåŠ¨è·¯ç”±æ‰€æœ‰å·²æ³¨å†Œçš„æœåŠ¡</p></li></ul><ul><li><p>predicate: å°±æ˜¯Java8ä¸­å¼•å…¥çš„çš„ Predicate, è¾“å…¥æ˜¯ ServerWebExchange, å¯ä»¥è·å– request, header, params</p><p>æ‰€æœ‰ predicate è¿”å›true, åˆ™å½“å‰ route matched </p></li><li><p>filter: GatewayFilter å®ä¾‹, å¯ä»¥ä¿®æ”¹è¯·æ±‚å’Œå“åº”, ç”Ÿå‘½å‘¨æœŸåˆ†ä¸º &quot;pre&quot; å’Œ &quot;post&quot;</p><p>filter åˆ†ä¸º: GatewayFilter ä¸ GlobalFilterã€‚GlobalFilter ä¼šåº”ç”¨åˆ°æ‰€æœ‰çš„è·¯ç”±ä¸Š(æ— éœ€é…ç½®)ï¼Œè€Œ GatewayFilter å°†åº”ç”¨åˆ°å•ä¸ªè·¯ç”±æˆ–è€…ä¸€ä¸ªåˆ†ç»„çš„è·¯ç”±ä¸Š(éœ€è¦è·ŸRouteç»‘å®šä½¿ç”¨ï¼Œä¸èƒ½åœ¨application.ymlæ–‡ä»¶ä¸­é…ç½®ä½¿ç”¨),GatewayFilter  äº¦å¯ é€šè¿‡ AbstractGatewayFilterFactory, åœ¨å†…éƒ¨å®ç°, ä¸å†™å•ç‹¬çš„ Javaç±»(è¿™ç§æ–¹å¼åŒæ ·è¦é…ç½® route)</p><p>é›†æˆäº† Hystrix, è‡ªåŠ¨è¿›è¡Œè´Ÿè½½å‡è¡¡, é›†æˆäº† Spring Cloud DiscoveryClient, </p></li></ul><p>å·¥ä½œæµç¨‹: è¯·æ±‚è¿›æ¥, å¦‚æœåœ¨ Gateway Handler Mapping ä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ° Gateway Web Handler, Handler å†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚</p><p>å’Œ æ³¨å†Œä¸­å¿ƒ ä¸€èµ·ä½¿ç”¨ (åŠ¨æ€è·¯ç”±), éœ€è¦æ‰“å¼€å¼€å…³, é»˜è®¤çš„è‡ªåŠ¨ä»£ç†è¯·æ±‚æ ¼å¼: http://ç½‘å…³åœ°å€/æœåŠ¡ä¸­å¿ƒæ³¨å†Œ serviceId/å…·ä½“çš„path, å¦‚: http://localhost:8888/EUREKA-SINGLE-CLIENT/hah (service name å¯ä»¥é…ç½®å°å†™), å¦‚æœè·¯ç”±çš„serviceæœ‰å¤šä¸ªèŠ‚ç‚¹, ä¼šè‡ªåŠ¨è´Ÿè½½å‡è¡¡</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æœ‰å“ªäº›å†…ç½®-route-predicate-factory">æœ‰å“ªäº›å†…ç½® route predicate factory<a href="#æœ‰å“ªäº›å†…ç½®-route-predicate-factory" class="hash-link" aria-label="Direct link to æœ‰å“ªäº›å†…ç½® route predicate factory" title="Direct link to æœ‰å“ªäº›å†…ç½® route predicate factory">â€‹</a></h3><ul><li><p>Before, After, Between: é€šè¿‡æ—¶é—´åŒ¹é…; æŸä¸ªæ—¶é—´ç‚¹å‰, æŸä¸ªæ—¶é—´ç‚¹å, æŸæ®µæ—¶é—´å†… çš„requestæ‰åŒ¹é…</p><p>æ—¶é—´å­—ç¬¦ä¸²æ€ä¹ˆè·å¾—: Java8 çš„æ—¶é—´ api, ZonedDateTime.now() ...</p></li><li><p>Cookie: é€šè¿‡éªŒè¯æŒ‡å®šcookie çš„å€¼æ¥åŒ¹é…; æ¥å—2ä¸ªå‚æ•°, Cookie çš„name, cookie çš„å€¼</p></li><li><p>Header: é€šè¿‡éªŒè¯æŒ‡å®š Header çš„å€¼æ¥åŒ¹é…; æ¥å—2ä¸ªå‚æ•°(headerName, regexPattern)</p></li><li><p>Host: é€šè¿‡æŒ‡å®š host (è¿˜æ˜¯å±äºHeaderéªŒè¯) æ¥åŒ¹é…(å¤šä¸ªhost ç”¨ &quot;.&quot; åˆ†éš”, æ”¯æŒ <code>**</code> é€šé…ç¬¦, å¦‚ <code>**.github.io</code>)</p></li><li><p>Method: é€šè¿‡httpæ–¹æ³•åŒ¹é…</p></li><li><p>Path: é€šè¿‡è¯·æ±‚è·¯å¾„åŒ¹é…, æ”¯æŒ &quot;/foo/{segment}&quot; çš„å½¢å¼, æ”¯æŒæ¨¡æ¿å ä½ç¬¦ <code>{xxx}</code>, åœ¨ filter ä¸­å¯ä»¥ä½¿ç”¨å ä½ç¬¦ä¸­çš„å˜é‡</p></li><li><p>Query: é€šè¿‡è¯·æ±‚å‚æ•°åŒ¹é…, 2ä¸ªå‚æ•°(paramName, paramValue(å‚æ•°å€¼, æˆ–è€…æ˜¯regex)), å‚æ•°2å¯é€‰</p></li><li><p>RemoteAddr: é€šè¿‡è¯·æ±‚ipåŒ¹é…, å¦‚ &quot;192.168.1.1/24&quot;</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æœ‰å“ªäº›-å†…ç½®-filter">æœ‰å“ªäº› å†…ç½® filter<a href="#æœ‰å“ªäº›-å†…ç½®-filter" class="hash-link" aria-label="Direct link to æœ‰å“ªäº› å†…ç½® filter" title="Direct link to æœ‰å“ªäº› å†…ç½® filter">â€‹</a></h3><p><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.5.RELEASE/reference/html/#gatewayfilter-factories" target="_blank" rel="noopener noreferrer">https://docs.spring.io/spring-cloud-gateway/docs/2.2.5.RELEASE/reference/html/#gatewayfilter-factories</a></p><ul><li>AddRequestFilter</li><li>SetPath å¯ä»¥ä½¿ç”¨ Path ä¸­çš„å ä½ç¬¦å˜é‡</li><li>RewritePath</li><li>PrefixPath</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è‡ªå®šä¹‰-filter">è‡ªå®šä¹‰ filter<a href="#è‡ªå®šä¹‰-filter" class="hash-link" aria-label="Direct link to è‡ªå®šä¹‰ filter" title="Direct link to è‡ªå®šä¹‰ filter">â€‹</a></h3><ul><li><p>æ¥å£ GlobalFilter (å®šä¹‰å…¨å±€ filter, éœ€è¦ <code>@component</code>), å½±å“æ‰€æœ‰ route; Ordered æ¥å£å®šä¹‰é¡ºåº</p></li><li><p>GatewayFilter (æ™®é€šfilter, éœ€è¦åœ¨ route ä¸­ä½¿ç”¨ä»£ç ç¡¬ç¼–ç é…ç½® <code>xxx.filters(new MyFilter())</code> æ— éœ€ component), Ordered é¡ºåº</p><ul><li><p>å¦‚æœå¸Œæœ›åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®Gateway Filter, è‡ªå®šä¹‰è¿‡æ»¤å™¨å·¥å‚å®ç°; </p><p>AbstractGatewayFilterFactory (ç»§æ‰¿æŠ½è±¡ç±»å®ç° apply(config), config ä¸ºè‡ªå®šä¹‰å‚æ•°)</p></li></ul></li></ul><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> custom</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">filter</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">factory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">predicates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Path=/service/</span><span class="token important">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">filters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> RewritePath=/service(</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">&lt;segment</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">.</span><span class="token important">*)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> $\</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">segment</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#ç®€å•é…ç½®, ä½†æ˜¯è¿™æ ·å°±éœ€è¦é¢å¤–é‡å†™è¦†ç›–æ–¹æ³• shortcutFieldOrder()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#- Logging=My Custom Message, true, true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">baseMessage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> My Custom Message helloxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">preLogger</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">postLogger</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-filter">gateway filter<a href="#gateway-filter" class="hash-link" aria-label="Direct link to gateway filter" title="Direct link to gateway filter">â€‹</a></h4><p>å®ç°è‡ªå®šä¹‰çš„Gateway Filteræˆ‘ä»¬éœ€è¦GatewayFilterã€Orderedä¸¤ä¸ªæ¥å£</p><p>å®šä¹‰å¥½MyFilterä»¥åï¼Œå…¶éœ€è¦è·ŸRouteç»‘å®šä½¿ç”¨ï¼Œä¸èƒ½åœ¨application.ymlæ–‡ä»¶ä¸­é…ç½®ä½¿ç”¨</p><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ›´å¸Œæœ›åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®Gateway Filter,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è¿‡æ»¤å™¨å·¥å‚å®ç°ã€‚
è‡ªå®šä¹‰è¿‡æ»¤å™¨å·¥å‚éœ€è¦ç»§æ‰¿AbstractGatewayFilterFactory</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="å…¨å±€-filter">å…¨å±€ filter<a href="#å…¨å±€-filter" class="hash-link" aria-label="Direct link to å…¨å±€ filter" title="Direct link to å…¨å±€ filter">â€‹</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class TimeRecordGlobalFilter implements GlobalFilter, Ordered {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String TIME_BEGIN = &quot;time begin&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        exchange.getAttributes().put(TIME_BEGIN, System.currentTimeMillis());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return chain.filter(exchange).then(Mono.fromRunnable(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Long timeBegin = exchange.getAttribute(TIME_BEGIN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (timeBegin == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new RuntimeException(&quot;&gt;&gt;&gt; Error when get begin time&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(&quot;&gt;&gt;&gt; &quot; + exchange.getRequest().getURI().getRawPath()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    + &quot;: &quot; + (System.currentTimeMillis() - timeBegin) + &quot;ms&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int getOrder() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //å¯ä»¥ä¸ºè´Ÿæ•°, å°å³é¦–å…ˆè¿›å…¥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ™®é€š filter, åœ¨ä»£ç ä¸­é… route ä½¿ç”¨:</p><p>æ™®é€š filter, åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AuthorizeGatewayFilterFactory extends AbstractGatewayFilterFactory&lt;AuthorizeGatewayFilterFactory.Config&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Log logger = LogFactory.getLog(AuthorizeGatewayFilterFactory.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String AUTHORIZE_TOKEN = &quot;token&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String AUTHORIZE_UID = &quot;uid&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private StringRedisTemplate stringRedisTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public AuthorizeGatewayFilterFactory() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super(Config.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.info(&quot;Loaded GatewayFilterFactory [Authorize]&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;String&gt; shortcutFieldOrder() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Arrays.asList(&quot;enabled&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public GatewayFilter apply(AuthorizeGatewayFilterFactory.Config config) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (exchange, chain) -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!config.isEnabled()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return chain.filter(exchange);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ServerHttpRequest request = exchange.getRequest();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HttpHeaders headers = request.getHeaders();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String token = headers.getFirst(AUTHORIZE_TOKEN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String uid = headers.getFirst(AUTHORIZE_UID);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (token == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                token = request.getQueryParams().getFirst(AUTHORIZE_TOKEN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (uid == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                uid = request.getQueryParams().getFirst(AUTHORIZE_UID);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ServerHttpResponse response = exchange.getResponse();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (StringUtils.isEmpty(token) || StringUtils.isEmpty(uid)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return response.setComplete();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String authToken = stringRedisTemplate.opsForValue().get(uid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (authToken == null || !authToken.equals(token)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return response.setComplete();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return chain.filter(exchange);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static class Config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // æ§åˆ¶æ˜¯å¦å¼€å¯è®¤è¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private boolean enabled;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public Config() {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public boolean isEnabled() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return enabled;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void setEnabled(boolean enabled) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.enabled = enabled;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">é…ç½®:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cloud:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gateway:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      routes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - id: user-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uri: http://localhost:8077/api/user/list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        predicates:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Path=/user/list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # å…³é”®åœ¨ä¸‹é¢ä¸€å¥ï¼Œå€¼ä¸ºtrueåˆ™å¼€å¯è®¤è¯ï¼Œfalseåˆ™ä¸å¼€å¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # è¿™ç§é…ç½®æ–¹å¼å’Œspring cloud gatewayå†…ç½®çš„GatewayFilterFactoryä¸€è‡´</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Authorize=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-é…ç½®æ–¹æ³•">gateway é…ç½®æ–¹æ³•<a href="#gateway-é…ç½®æ–¹æ³•" class="hash-link" aria-label="Direct link to gateway é…ç½®æ–¹æ³•" title="Direct link to gateway é…ç½®æ–¹æ³•">â€‹</a></h3><div class="language-props codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-props codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># enable gateway, default to true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.cloud.gateway.enabled=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># route all services that registered in eureka server, default to false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.cloud.gateway.discovery.locator.enabled=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># å…·ä½“çš„è·¯ç”±é…ç½®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># , spring.cloud.gateway.routes æ˜¯ä¸€ä¸ª list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ¯”å¦‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># route çš„ id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.cloud.gateway.routes[0].id=demo-route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Destination uri</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># if you visit localhost:8080/hah then the request would be forward to cn.bing.com/hah</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># è´Ÿè½½å‡è¡¡ How to apply the filters to every node of one service? -&gt; lb://spring-cloud-producer, æ ¼å¼ä¸ºï¼šlb://åº”ç”¨æ³¨å†ŒæœåŠ¡å</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.cloud.gateway.routes[0].uri=cn.bing.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ˜¯ä¸€ä¸ª map, spring.cloud.gateway.routes[0].predicates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># è¿˜æœ‰å¾ˆå¤š, å¦‚ After=2019-07-04T05:50:53.346Z, Method...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.cloud.gateway.routes[0].predicates[0].name=Path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.cloud.gateway.routes[0].predicates[0].args</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># add parameter xxx=yyy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.cloud.gateway.routes[0].filters.AddRequestParameter=xxx, yyy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ›´æ¨è yaml çš„é…ç½®:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">application</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> spring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cloud</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gateway</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cloud</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">gateway</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">discovery</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">locator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># route all services that registered in eureka server, default to false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># è‡ªåŠ¨ä»£ç†å¯ä»¥ä½¿ç”¨å°å†™çš„ service name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">lower-case-service-id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># enable gateway, default to true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># config route rule</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">routes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> demo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># Destination uri, if you visit localhost:8080/Path then the request would be forward to cn.bing.com/Path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">predicates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Path=/hah/</span><span class="token important">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Method=GET</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">#- After=2019-07-04T05:50:53.346Z</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">filters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># add parameter xxx=yyy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AddRequestParameter=xxx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> yyy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># How to apply the filters to every node of one service? -&gt; lb://spring-cloud-producer, æ ¼å¼ä¸ºï¼šlb://åº”ç”¨æ³¨å†ŒæœåŠ¡å, è¿™é‡Œå…¶å®é»˜è®¤ä½¿ç”¨äº†å…¨å±€è¿‡æ»¤å™¨ LoadBalancerClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apply_filter_to_all_node_route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lb</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">single</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># PrefixPath Filter: add prefix to path, eg: - PrefixPath=/mypath</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># StripPrefix Filter: split path, eg: /name/bar/foo -&gt; /foo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># å¯ä»¥åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½æ¥åšç‰¹æ®Šä¸šåŠ¡çš„è½¬å‘ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> split_request_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//eureka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">single</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">predicates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Path=/name/</span><span class="token important">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">filters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic"># element num to be split</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> StripPrefix=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Retry GatewayFilter:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> retry_test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lb</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//spring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cloud</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">producer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">predicates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Path=/retry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">filters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Retry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">#  retry times, default to 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token key atrule" style="color:#00a4db">retries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic"># http response status, ref to org.springframework.http.HttpStatus</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token key atrule" style="color:#00a4db">statuses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BAD_GATEWAY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic"># which http method should retry, default to GET</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token key atrule" style="color:#00a4db">methods</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GET</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#3  hystrix ä¸å¸¦ fallback çš„é…ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hystrix_route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//example.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">filters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># gateway å°†ä½¿ç”¨ myCommandName ä½œä¸ºåç§°ç”Ÿæˆ HystrixCommand å¯¹è±¡æ¥è¿›è¡Œç†”æ–­ç®¡ç†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Hystrix=myCommandName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># hystrix å¸¦ fallback çš„é…ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hystrix_route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lb</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//spring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cloud</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">producer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">predicates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Path=/consumingserviceendpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">filters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Hystrix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fallbackcmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># å½“è°ƒç”¨ Hystrix çš„ fallback è¢«è°ƒç”¨æ—¶ï¼Œè¯·æ±‚å°†è½¬å‘åˆ°/incaseoffailureusetè¿™ä¸ª URIã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">fallbackUri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> forward</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/incaseoffailureusethis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># RequestRateLimiter Filter, work with redis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># é…åˆ redis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> request_rate_limiter_route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//example.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">filters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RequestRateLimiter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># Handing 10 request every second</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">redis-rate-limiter.replenishRate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># Finishing 20 request every second</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">redis-rate-limiter.burstCapacity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># reference bean with beanName using SpEL grammar</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">key-resolver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#{@userKeyResolver}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">predicates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Method=GET</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8888</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é€šè¿‡ä»£ç ç¡¬ç¼–ç é…ç½®è·¯ç”±:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class GatewayConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RouteLocator routeLocator(RouteLocatorBuilder builder) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // return builder.routes()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //         .route(&quot;baidu_guonei&quot;, predicateSpec -&gt; predicateSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //                 .path(&quot;/guonei&quot;).uri(&quot;http://news.baidu.com/guonei&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //         .route(&quot;baidu_guoji&quot;, predicateSpec -&gt; predicateSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //                 .path(&quot;/guoji&quot;).uri(&quot;http://news.baidu.com/guoji&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //         .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return builder.routes()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .route(&quot;baidu_guonei&quot;, predicateSpec -&gt; predicateSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .path(&quot;/**&quot;).uri(&quot;http://news.baidu.com&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ç½‘å…³ç›‘æ§">ç½‘å…³ç›‘æ§<a href="#ç½‘å…³ç›‘æ§" class="hash-link" aria-label="Direct link to ç½‘å…³ç›‘æ§" title="Direct link to ç½‘å…³ç›‘æ§">â€‹</a></h3><p>spring-boot-starter-actuator</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">management</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">endpoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">web</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">exposure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">include</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> health</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">gateway</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>è°ƒç”¨é“¾è·¯è¿½è¸ª</h1><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹, æŸä¸ªå‰ç«¯è¯·æ±‚å¯èƒ½å¯¹åº”å¤šä¸ªåç«¯service, å¦‚ä½•å®šä½è¿™äº›serviceå‘¢?</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sleuth-å’Œ-zipkin">sleuth å’Œ zipkin<a href="#sleuth-å’Œ-zipkin" class="hash-link" aria-label="Direct link to sleuth å’Œ zipkin" title="Direct link to sleuth å’Œ zipkin">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="åˆ†å¸ƒå¼è¿½è¸ª">åˆ†å¸ƒå¼è¿½è¸ª<a href="#åˆ†å¸ƒå¼è¿½è¸ª" class="hash-link" aria-label="Direct link to åˆ†å¸ƒå¼è¿½è¸ª" title="Direct link to åˆ†å¸ƒå¼è¿½è¸ª">â€‹</a></h3><p><a href="https://toutiao.io/posts/eaiifaf/preview" target="_blank" rel="noopener noreferrer">https://toutiao.io/posts/eaiifaf/preview</a></p><p>spring-cloud-sleuth  +  Zipkin (from twitter, <a href="https://zipkin.io/pages/quickstart.html" target="_blank" rel="noopener noreferrer">https://zipkin.io/pages/quickstart.html</a>)</p><p>åˆ†å¸ƒå¼æœåŠ¡è¿½è¸ªç†è®ºåŸºç¡€æ¥è‡ª <a href="https://research.google.com/pubs/pub36356.html" target="_blank" rel="noopener noreferrer">Google çš„ä¸€ç¯‡è®ºæ–‡</a></p><p>spring-cloud-sleuth: æä¾›é“¾è·¯è¿½è¸ª, è®°å½•æˆåŠŸä¸å¦, è€—æ—¶; ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚å“åº”é“¾è·¯è®°å½•ä¸ºä¸€ä¸ª &quot;trace&quot;, å¯èƒ½åŒ…å«å¤šä¸ª serviceè°ƒç”¨, ç§°ä¸º &quot;span&quot;, å¤šä¸ªæœ‰åºçš„ span ç»„æˆä¸€ä¸ª trace (é€šè¿‡ parent id è”ç³»èµ·æ¥); å¦‚æœä»…ä»…å¼•å…¥ sleuth, è·Ÿè¸ªæ—¥å¿—åªä¼šæ‰“åˆ°æ§åˆ¶å° (å¼•å…¥å³å¯, è‡ªåŠ¨è®°å½•, å¦‚æœåªå¼•å…¥äº† sleuth, é‚£ä¹ˆé»˜è®¤æ‰“åˆ° æ§åˆ¶å°); ä½œä¸º zipkin çš„ä¿¡æ¯æ”¶é›†å™¨, åªæ˜¯ä¸€ä¸ªå¼€æºå®ç°ä¹‹ä¸€</p><p>Zipkin: åˆ©ç”¨ zipkin çš„å­˜å‚¨æ¥å­˜å‚¨ä¿¡æ¯ï¼Œåˆ©ç”¨zipkin uiæ¥å±•ç¤ºæ•°æ®ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="spring-cloud-sleuth">spring-cloud-sleuth<a href="#spring-cloud-sleuth" class="hash-link" aria-label="Direct link to spring-cloud-sleuth" title="Direct link to spring-cloud-sleuth">â€‹</a></h3><p>Traceï¼šç”±ä¸€ç»„ Trace Id ç›¸åŒçš„ Span ä¸²è”å½¢æˆä¸€ä¸ªæ ‘çŠ¶ç»“æ„ã€‚ä¸ºäº†å®ç°è¯·æ±‚è·Ÿè¸ªï¼Œå½“è¯·æ±‚åˆ°è¾¾åˆ†å¸ƒå¼ç³»ç»Ÿçš„å…¥å£ç«¯ç‚¹æ—¶ï¼Œåªéœ€è¦æœåŠ¡è·Ÿè¸ªæ¡†æ¶ä¸ºè¯¥è¯·æ±‚åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ï¼ˆå³TraceIdï¼‰</p><p>Spanï¼šä»£è¡¨äº†ä¸€ç»„åŸºæœ¬çš„å·¥ä½œå•å…ƒã€‚ä¸ºäº†ç»Ÿè®¡å„å¤„ç†å•å…ƒçš„å»¶è¿Ÿï¼Œå½“è¯·æ±‚åˆ°è¾¾å„ä¸ªæœåŠ¡ç»„ä»¶çš„æ—¶å€™, é€šè¿‡SpanId çš„å¼€å§‹å’Œç»“æŸæ—¶é—´æˆ³ï¼Œå°±èƒ½ç»Ÿè®¡è¯¥ span çš„è°ƒç”¨æ—¶é—´, spanId ä¹Ÿç”¨æ¥åŒºåˆ†æ ‘ç»“æ„ä¸­åŒå±‚çº§èŠ‚ç‚¹çš„å…ˆåè°ƒç”¨å…³ç³»</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="zipkin-ä½¿ç”¨">zipkin ä½¿ç”¨<a href="#zipkin-ä½¿ç”¨" class="hash-link" aria-label="Direct link to zipkin ä½¿ç”¨" title="Direct link to zipkin ä½¿ç”¨">â€‹</a></h3><ul><li><p>zipkin çš„ä½¿ç”¨åˆ†ä¸ºä¸¤éƒ¨åˆ†</p><p>æ¯ä¸ª service éœ€è¦å¼•å…¥ zipkin client (spring-cloud-starter-zipkin, å·²ç»åŒ…å« sleuth), é…ç½® zipkin server åœ°å€å’Œé‡‡æ ·æ¯”ä¾‹ (é»˜è®¤æŠ½æ · 0.1 å³ 10%)</p><p>ç¬¬äºŒéƒ¨åˆ† zipkin server (<code>zipkin-server, zipkin-autoconfigure-ui</code>), é…åˆ <code>@EnableZipkinServer</code>, æœ€æ–°ç‰ˆçš„ spring cloud å·²ç»æ— éœ€æ„å»º zipkin server äº†, åªéœ€è¦å¯åŠ¨ jar åŒ… (zipkin-server-xxx-exec.jar, from zipkin.io) å³å¯</p></li><li><p>å¦‚æœ zipkin å’Œ spring cloud stream, kafka éƒ½åœ¨ classpath, é»˜è®¤ä¼šå°†è·Ÿè¸ªè®°å½•æ‰“åˆ° kafka, <code>spring.zipkin.sender.type=web</code> æ‰ä¼šæ‰“åˆ°æœåŠ¡å™¨æ—¥å¿—</p><p>è¿½è¸ªæ—¥å¿—æ‰“åˆ° kafka æ›´å¥½, ç›¸æ¯”ä½¿ç”¨  http è¿ zipkin server, ä¼š æ›´åŠ ç¨³å®š(å› ä¸ºæ¶ˆæ¯ä¸­é—´ä»¶èƒ½å¤ŸæŠ—ä½çŸ­æ—¶é—´çš„å¤§æ—¥å¿—é‡), ä¼šæ›´è§£è€¦åˆ</p></li><li><p>æ•°æ®åº“æ”¯æŒ In-Memory (é»˜è®¤, æµ‹è¯•ç”¨)ã€MySql, Cassandra ä»¥åŠ Elasticsearch (ç”Ÿäº§æ¨è)</p></li></ul><p>é“¾è·¯è·Ÿè¸ªæœ‰è‡ªå·±çš„çº¿ç¨‹æ± , å¯¹ä¸šåŠ¡çº¿ç¨‹ä¸ä¼šæœ‰å¤ªå¤§çš„å½±å“</p><p>é‡è¦çš„é…ç½®:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">zipkin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šäº†ZipkinæœåŠ¡å™¨çš„åœ°å€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">base-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sleuth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sampler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># é‡‡æ ·æ¯”ä¾‹è®¾ç½®ä¸º1.0ï¼Œä¹Ÿå°±æ˜¯å…¨éƒ¨éƒ½éœ€è¦ã€‚é»˜è®¤çš„é‡‡æ ·æ¯”ä¾‹ä¸º: 0.1(å³10%)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">percentage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ä½¿ç”¨æ¡ˆä¾‹">ä½¿ç”¨æ¡ˆä¾‹<a href="#ä½¿ç”¨æ¡ˆä¾‹" class="hash-link" aria-label="Direct link to ä½¿ç”¨æ¡ˆä¾‹" title="Direct link to ä½¿ç”¨æ¡ˆä¾‹">â€‹</a></h3><p><a href="https://www.extlight.com/sleuth-basic.html" target="_blank" rel="noopener noreferrer">https://www.extlight.com/sleuth-basic.html</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="skywalking">skyWalking<a href="#skywalking" class="hash-link" aria-label="Direct link to skyWalking" title="Direct link to skyWalking">â€‹</a></h2><p>//todo</p><h1>ä¸šåŠ¡æ—¥å¿—æ”¶é›†</h1><p>elk (elasticSearch, logstash, kibana) + kafka</p><p>é€šè¿‡ logstash</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ—¥å¿—æ€ä¹ˆæœç´¢-elasticsearch">æ—¥å¿—æ€ä¹ˆæœç´¢ elasticSearch<a href="#æ—¥å¿—æ€ä¹ˆæœç´¢-elasticsearch" class="hash-link" aria-label="Direct link to æ—¥å¿—æ€ä¹ˆæœç´¢ elasticSearch" title="Direct link to æ—¥å¿—æ€ä¹ˆæœç´¢ elasticSearch">â€‹</a></h2><p>åº•å±‚æ˜¯ä½¿ç”¨çš„ lucene åº“, å®ç°å…¨æ–‡æœç´¢å¼•æ“</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ—¥å¿—æ€ä¹ˆæ”¶é›†">æ—¥å¿—æ€ä¹ˆæ”¶é›†<a href="#æ—¥å¿—æ€ä¹ˆæ”¶é›†" class="hash-link" aria-label="Direct link to æ—¥å¿—æ€ä¹ˆæ”¶é›†" title="Direct link to æ—¥å¿—æ€ä¹ˆæ”¶é›†">â€‹</a></h2><p>logstash</p><p>åˆæœ‰æ–°çš„æ›¿ä»£æ–¹æ¡ˆ:  <a href="https://www.cnblogs.com/richaaaard/p/6109595.html" target="_blank" rel="noopener noreferrer">filebeat</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ—¥å¿—æ€ä¹ˆå±•ç¤º">æ—¥å¿—æ€ä¹ˆå±•ç¤º<a href="#æ—¥å¿—æ€ä¹ˆå±•ç¤º" class="hash-link" aria-label="Direct link to æ—¥å¿—æ€ä¹ˆå±•ç¤º" title="Direct link to æ—¥å¿—æ€ä¹ˆå±•ç¤º">â€‹</a></h2><p>Kibana</p><p>kibanaè™½çµæ´»ï¼Œä½†éœ€å­¦ä¹ luceneè¯­æ³•ï¼Œæ“ä½œç¹é”</p><h1>æ¶ˆæ¯æ€»çº¿</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="spring-cloud-bus">Spring-Cloud-Bus<a href="#spring-cloud-bus" class="hash-link" aria-label="Direct link to Spring-Cloud-Bus" title="Direct link to Spring-Cloud-Bus">â€‹</a></h2><p>æ˜¯ä¸€ä¸ªæ•´åˆæ¶ˆæ¯ä¸­é—´ä»¶è¿›å…¥åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¡†æ¶ï¼Œåˆ©ç”¨äº†MQçš„å¹¿æ’­æœºåˆ¶åœ¨åˆ†å¸ƒå¼çš„ç³»ç»Ÿä¸­ä¼ æ’­æ¶ˆæ¯ï¼Œç›®å‰ä»…ä»…æ”¯æŒ Kafka å’Œ RabbitMQ ã€‚</p><p>åœ¨åº”ç”¨ä¹‹é—´ä¼ é€’çŠ¶æ€å˜åŒ– æ¯”å¦‚å¯ä»¥è‡ªå·±å®šä¹‰äº‹ä»¶, ä¸»åŠ¨åˆ·æ–°ç¼“å­˜</p><p>å’Œ spring cloud stream åŒºåˆ«: bus ä¸€èˆ¬ç”¨äºåŸºç¡€è®¾æ–½çš„å¼€å‘, å¦‚ç®¡ç†é…ç½®çš„åŠ¨æ€åˆ·æ–°, stream ç”¨äºä¸šåŠ¡åŠŸèƒ½çš„å¼€å‘.</p><p>åˆ©ç”¨ bus çš„æœºåˆ¶å¯ä»¥åšå¾ˆå¤šçš„äº‹æƒ…:</p><ul><li><p>é…ç½®ä¸­å¿ƒå®¢æˆ·ç«¯åšåŠ¨æ€åˆ·æ–°, ä¹Ÿå°±æ˜¯å…¨å±€å¹¿æ’­ (å¯ä»¥é¿å…åŠ¨æ€åˆ·æ–°é…ç½®æ—¶, å¯¹é«˜å¯ç”¨éƒ¨ç½²çš„æ¯ä¸ª service instance æ‰§è¡Œ refresh post è¯·æ±‚), ä»¥åŠçƒ­éƒ¨ç½²</p></li><li><p>å®šç‚¹é€šçŸ¥/å±€éƒ¨åˆ·æ–°  (å°±æ˜¯æŒ‡å®šæ›´æ–°æŸä¸ªå…·ä½“ service), <code>http://config-server-address/actuator/bus-refresh/{destination}</code>, é€šè¿‡ destination æŒ‡å®šéœ€è¦æ›´æ–°çš„ service æˆ–è€…æŸä¸ª instance</p><ul><li><p>å¦‚æœå¸Œæœ›åªæ˜¯é€šçŸ¥ serviceA çš„æ‰€æœ‰ instance, destination å³ä¸º serviceA</p></li><li><p>å¦‚æœåªæ˜¯å¸Œæœ›é€šçŸ¥ serviceA çš„æŸä¸ª instance (è¿™ä¸ªå®ä¾‹ç«¯å£ä¸º 8000), destination ä¸º serviceA:8000</p></li></ul></li></ul><p>å’Œé…ç½®ä¸­å¿ƒé…åˆçš„åŸç†å›¾: (ä¸å¤Ÿå¥½)</p><p>1ã€æäº¤ä»£ç è§¦å‘postç»™å®¢æˆ·ç«¯Aå‘é€bus/refresh
2ã€å®¢æˆ·ç«¯Aæ¥æ”¶åˆ°è¯·æ±‚ä»Serverç«¯æ›´æ–°é…ç½®å¹¶ä¸”å‘é€ç»™Spring Cloud Bus
3ã€Spring Cloud busæ¥åˆ°æ¶ˆæ¯å¹¶é€šçŸ¥ç»™å…¶å®ƒå®¢æˆ·ç«¯ (å‰ææ˜¯æ‰€æœ‰èŠ‚ç‚¹éƒ½è®¢é˜…äºŒäº†åŒä¸€ä¸ª topic, é»˜è®¤æ˜¯ springCloudBus)
4ã€å…¶å®ƒå®¢æˆ·ç«¯æ¥æ”¶åˆ°é€šçŸ¥ï¼Œè¯·æ±‚Serverç«¯è·å–æœ€æ–°é…ç½®
5ã€å…¨éƒ¨å®¢æˆ·ç«¯å‡è·å–åˆ°æœ€æ–°çš„é…ç½®</p><p>æ›´æ–°gitä¸­çš„æ•°æ®å, è®¿é—®client, ä»»ç„¶æ˜¯æ—§çš„æ•°æ®, è¿™æ—¶å€™, å‘ä»»æ„clientå®ä¾‹å‘é€ä¸€ä¸ª /actuator/bus-refresh çš„postè¯·æ±‚ <code>curl -X POST http://....</code>, ç„¶åè®¿é—®ä»»æ„client, æ•°æ®å‡ä¸ºlatestçš„äº†</p><p>ä½†è¿™ç§æ–¹å¼å¹¶ä¸ä¼˜é›…ã€‚åŸå› å¦‚ä¸‹ï¼š</p><ul><li><p>æ‰“ç ´äº†å¾®æœåŠ¡çš„èŒè´£å•ä¸€æ€§ã€‚å¾®æœåŠ¡æœ¬èº«æ˜¯ä¸šåŠ¡æ¨¡å—ï¼Œå®ƒæœ¬ä¸åº”è¯¥æ‰¿æ‹…é…ç½®åˆ·æ–°çš„èŒè´£ã€‚</p></li><li><p>ç ´åäº†å¾®æœåŠ¡å„èŠ‚ç‚¹çš„å¯¹ç­‰æ€§ã€‚</p></li><li><p>æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œå¾®æœåŠ¡åœ¨è¿ç§»æ—¶ï¼Œå®ƒçš„ç½‘ç»œåœ°å€å¸¸å¸¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ—¶å¦‚æœæƒ³è¦åšåˆ°è‡ªåŠ¨åˆ·æ–°ï¼Œé‚£å°±ä¸å¾—ä¸ä¿®æ”¹ WebHook çš„é…ç½® (å³ refresh post å‘é€ç»™çš„å¯¹è±¡åœ°å€ä¼šå˜åŒ–, ä¸å¾—ä¸ä¿®æ”¹))</p></li></ul><p>ç°åœ¨å°†æ¶æ„æ¨¡å¼æ”¹æˆè¿™æ ·: (clientå¼•å…¥mqæ”¯æŒæ¶ˆæ¯æ€»çº¿, serverç«¯ä¹Ÿè¦å¼•å…¥æ¶ˆæ¯æ€»çº¿), æ”¹ä¸ºå‘ config server å‘é€ refresh è¯·æ±‚</p><p>å’Œ spring cloud config æ•´åˆè¯¦ç»†æ­¥éª¤: åœ¨ config server å’Œæ¯ä¸ª client å¼•å…¥ spring cloud starter bus amqp (kafka åˆ™å°±æ˜¯ spring cloud starter bus kafka ), æœ‰å¦‚ä¸‹çš„é»˜è®¤é…ç½®, å¦‚æœè‡ªå®šä¹‰éœ€è¦ä¿®æ”¹</p><div class="language-props codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-props codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring.rabbitmq.host=localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.rabbitmq.username=guest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.rabbitmq.password=guest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.rabbitmq.port=5672</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>config server è¿˜éœ€ å¼•å…¥ <code>spring boot starter actuator</code> ç„¶åé…ç½®å¦‚ä¸‹ä»¥æš´éœ² refresh ç«¯ç‚¹</p><div class="language-props codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-props codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># å¦‚æœæ˜¯ yml åˆ™éœ€è¦åŠ å•å¼•å·</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># health,info,bus-refresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">management.endpoints.web.exposure.include=*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ€ä¹ˆéªŒè¯ç”Ÿæ•ˆäº†å‘¢? git repo ä¸­ application.yml ä¸­é…ç½® common.aaa=hah, å¯åŠ¨ eureka, serviceA, serviceB, config server, ä¿®æ”¹ common.aaa, ç„¶å commit/push, å‘ config server å‘é€ <code>curl -X POST http://config-server-address/actuator/bus-refresh</code>, ç„¶ååˆ†åˆ«é€šè¿‡ä¸¤ä¸ª service è·å– common.aaa (æ³¨æ„ç±»ä¸ŠåŠ ä¸Š <code>@refreshScope</code>), å‘ç°å·²ç»æ›´æ–°äº†.</p><p>è·Ÿè¸ªæ€»çº¿äº‹ä»¶: åªéœ€è®¾ç½®spring.cloud.bus.trace.enabled=trueï¼Œè¿™æ ·åœ¨/bus/refreshç«¯ç‚¹è¢«è¯·æ±‚åï¼Œè®¿é—®/traceç«¯ç‚¹å°±å¯è·å¾—ç±»ä¼¼å¦‚ä¸‹çš„ç»“æœï¼š...</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="alibaba-nacos-ä½œä¸ºæ¶ˆæ¯æ€»çº¿">alibaba nacos ä½œä¸ºæ¶ˆæ¯æ€»çº¿<a href="#alibaba-nacos-ä½œä¸ºæ¶ˆæ¯æ€»çº¿" class="hash-link" aria-label="Direct link to alibaba nacos ä½œä¸ºæ¶ˆæ¯æ€»çº¿" title="Direct link to alibaba nacos ä½œä¸ºæ¶ˆæ¯æ€»çº¿">â€‹</a></h2><h1>spring-cloud-stream æ¶ˆæ¯é©±åŠ¨</h1><p>æ˜¯ä¸€ä¸ªæ„å»ºæ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡çš„æ¡†æ¶, å°†é¡¹ç›®å’Œå…·ä½“çš„æŸä¸ªæ¶ˆæ¯ä¸­é—´ä»¶è§£è€¦(å¦‚ rabbitqm, Kafka), å±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶ç»†èŠ‚, å°±åƒä½¿ç”¨ jdbc çš„ api ä¹‹å, ä¸å¿…å…³å¿ƒä½¿ç”¨å“ªç§å…·ä½“çš„æ•°æ®åº“</p><p>ç›®å‰ä»…ä»…æ”¯æŒ rabbitmq, kafka</p><p>åŸç†: åº”ç”¨é€šè¿‡ spring cloud stream æä¾›çš„ input Chanel (app é€šè¿‡å®ƒä» mq ä¸­æ¥æ”¶æ¶ˆæ¯) å’Œ output Chanel (å‘ mq å‘é€æ¶ˆæ¯) æ¥å’Œ binder äº¤äº’. æœ‰å¤šç§å…·ä½“çš„ binder å®ç°, åˆ†åˆ«å¯¹åº”ä¸åŒçš„ mq; </p><p>éµå¾ªå‘å¸ƒè®¢é˜…æ¨¡å¼, é€šè¿‡ topic è¿›è¡Œå¹¿æ’­ (topic ç›¸å½“äº rabbit ä¸­çš„ exchange, Kafka ä¸­çš„ topic),</p><p>é€šè¿‡ <code>@Input</code>, <code>@output</code> è¡¨ç¤ºè¾“å…¥è¾“å‡ºé€šé“, æ¶ˆè´¹è€…ä½¿ç”¨ <code>@streamListener</code> ç›‘å¬é˜Ÿåˆ—è¿›è¡Œæ¶ˆæ¯æ¥æ”¶(ç”¨åœ¨æ–¹æ³•ä¸Š), <code>@enableBinding</code> å®ç° Chanel å’Œ exchange çš„ç»‘å®š (å‘é€å’Œæ¥å—çš„ç±»ä¸Šéƒ½æœ‰, ä½¿ç”¨ <code>Souce.class</code> å‘é€æºå’Œ <code>Sink.class</code>æ¥æ”¶åŒºåˆ†)</p><p>ä½¿ç”¨ç»†èŠ‚ (ä»¥ rabbit ä¸ºä¾‹): å¼•å…¥ <code>spring-cloud-starter-stream-rabbit</code>, </p><p>è§£å†³æ¶ˆæ¯é‡å¤æ¶ˆè´¹:</p><p>æ¶ˆæ¯æŒä¹…åŒ–:</p><p>åŠ¨æ€åˆ›å»ºé€šé“</p><h1>spring-cloud-data-flow</h1><h1>åˆ†å¸ƒå¼äº‹åŠ¡ seata</h1><h1>spring cloud alibaba é…åˆ dubbo</h1><p><a href="https://www.cnblogs.com/babycomeon/p/11546737.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/babycomeon/p/11546737.html</a> rpc + restful ä¼˜é›…çš„å®ç°</p><p><a href="https://www.bilibili.com/video/BV1B5411h71j" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1B5411h71j</a></p><h1>å®é™…è®¾è®¡æ¡ˆä¾‹ ç¥¨åŠ¡ç½‘ç«™</h1><p>ç¥¨åŠ¡ç±»ç½‘ç«™ (æ¯”å¦‚çŒ«çœ¼ç”µå½±)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ä¸šåŠ¡æ¶æ„">ä¸šåŠ¡æ¶æ„<a href="#ä¸šåŠ¡æ¶æ„" class="hash-link" aria-label="Direct link to ä¸šåŠ¡æ¶æ„" title="Direct link to ä¸šåŠ¡æ¶æ„">â€‹</a></h2><p>æ¢³ç†åŠŸèƒ½</p><p>ä½¿ç”¨è€…: é¢å‘æµ·é‡çš„äº’è”ç½‘ç”¨æˆ·</p><p>åˆ’åˆ†çš„æ¨¡å—: æ”¯ä»˜, ç”¨æˆ·, å•†å“, è®¢å•, æ’æœŸ... (ä»¥ä¸šåŠ¡åˆ’åˆ†æ¨¡å—)</p><ul><li>ç”¨æˆ·: æ³¨å†Œ, ç™»å½•, æ³¨é”€</li><li>å•†å“: æœç´¢, è¯¦æƒ…, æ’æœŸ, é€‰åº§</li><li>è®¢å•: ç”Ÿæˆ, å–æ¶ˆ</li><li>æ”¯ä»˜: å¾®ä¿¡/æ”¯ä»˜å®æ”¯ä»˜</li><li>æ’æœŸ</li><li>åŸºç¡€æ¨¡å— (å¦‚ åŒºåŸŸ, å›¾ç‰‡)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="åº”ç”¨æ¶æ„">åº”ç”¨æ¶æ„<a href="#åº”ç”¨æ¶æ„" class="hash-link" aria-label="Direct link to åº”ç”¨æ¶æ„" title="Direct link to åº”ç”¨æ¶æ„">â€‹</a></h2><p>åˆ’åˆ†èŒè´£, æ‹†åˆ†æ¨¡å—, æ¯ä¸ª module æœ‰è‡ªå·±ç‹¬ç«‹çš„ git ä»“åº“, ç‹¬ç«‹çš„è´Ÿè´£å›¢é˜Ÿ</p><ul><li><p>å‰ç«¯åº”ç”¨</p></li><li><p>åå‘ä»£ç†ç»„ä»¶ (nginx)</p></li><li><p>ç½‘å…³</p></li><li><p>æ¶ˆè´¹è€…app (æ¶ˆè´¹åº”ç”¨) , å¦‚ ç”¨æˆ·æ¶ˆè´¹, è®¢å•æ¶ˆè´¹...</p></li><li><p>ç”Ÿäº§è€…app (æœåŠ¡åº”ç”¨), å¦‚ ç”¨æˆ·æœåŠ¡, è®¢å•æœåŠ¡...</p></li><li><p>å¾®æœåŠ¡åŸºç¡€æœåŠ¡</p><p>å¦‚ æ³¨å†Œä¸­å¿ƒ, é…ç½®ä¸­å¿ƒ, é“¾è·¯è·Ÿè¸ªä¸­å¿ƒ, é™æµä¸­å¿ƒ</p></li><li><p>åŸºç¡€å…¬å…±æ¨¡å—, ç¯å¢ƒæ”¯æŒç»„ä»¶</p><p>å¦‚ ç¼“å­˜, æŒç»­é›†æˆ, éƒ¨ç½², æ•°æ®åº“, æ—¥å¿—, æ¶ˆæ¯ ... redis, jenkins, MySQL, nexus, elk, rabbitmq, kafka, nginx</p></li></ul><p><code>ä¸ºä»€ä¹ˆåå°è¦åˆ† æ¶ˆè´¹è€…åº”ç”¨ å’Œ æœåŠ¡æä¾›è€…åº”ç”¨</code>? æ¯”å¦‚ ç”¨æˆ·æ¨¡å—ä¼šåˆ†ä¸º ç”¨æˆ·æ¶ˆè´¹æ¨¡å—å’Œç”¨æˆ·æœåŠ¡æ¨¡å—</p><p>å¦‚æœä¸åŒºåˆ†æ¶ˆè´¹è€…module å’Œ service provider  module ä¼šé€ æˆ:</p><ul><li><p>è°ƒç”¨å…³ç³»æ··ä¹± (ä¼šç›¸äº’è°ƒç”¨)</p></li><li><p>æŸä¸ªmoduleå´©äº†, ä¼šè¿ç´¯å…¶ä»–module</p></li></ul><p>æ¯ä¸ªä¸šåŠ¡æ¨¡å—åŒºåˆ†ä¸º provider å’Œ consumer å, å‰ç«¯åªå’Œæ‰€æœ‰ consumer äº¤äº’</p><p>ä¼šæœ‰å“ªäº›å¥½å¤„:</p><ul><li><p>è°ƒç”¨å…³ç³»æ¸…æ™°, æ²¡æœ‰ç›¸äº’è°ƒç”¨</p></li><li><p>æ¶ˆé™¤äº† æŸä¸ª module å´©äº†å¸¦æ¥çš„çº§è”å½±å“ </p><p>æ¯”å¦‚ user service consumer æŒ‚äº†, è¿˜æœ‰ user service provider , å…¶ä»–çš„ consumer è¿˜èƒ½æ­£å¸¸å·¥ä½œ</p><p>(consumer ç›´æ¥é¢å‘ å¤–ç•Œ, å‡ºé”™å‡ ç‡å¤§, provider å’Œæ•°æ®åº“æ‰“äº¤é“, å‡ºé”™å‡ ç‡å°)</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æŠ€æœ¯æ¶æ„">æŠ€æœ¯æ¶æ„<a href="#æŠ€æœ¯æ¶æ„" class="hash-link" aria-label="Direct link to æŠ€æœ¯æ¶æ„" title="Direct link to æŠ€æœ¯æ¶æ„">â€‹</a></h2><p>åœ¨åº”ç”¨æ¶æ„åŸºç¡€ä¸Šè½åœ°å…·ä½“çš„æŠ€æœ¯</p><p>æ¡†æ¶ç»„ä»¶: spring boot, mybatis, MySQL</p><p>æŠ€æœ¯ç‚¹: spring cloudæŠ€æœ¯æ ˆ, elk+kafka (æ—¥å¿—), elasticSearch (æœç´¢), rabbitmq (åˆ†å¸ƒå¼äº‹åŠ¡), redis(ç¼“å­˜, setnxåˆ†å¸ƒå¼é”), mycat (åˆ†åº“åˆ†è¡¨), docker+Jenkins (æŒç»­é›†æˆ)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ•°æ®åº“æ¶æ„">æ•°æ®åº“æ¶æ„<a href="#æ•°æ®åº“æ¶æ„" class="hash-link" aria-label="Direct link to æ•°æ®åº“æ¶æ„" title="Direct link to æ•°æ®åº“æ¶æ„">â€‹</a></h2><ul><li>åŸºç¡€åº“: åŒºåŸŸè¡¨, å›¾ç‰‡è¡¨</li><li>èŠ‚ç›®åº“: èŠ‚ç›®è¡¨, æä¾›æ–¹è¡¨, ç±»å‹è¡¨</li><li>è®¢å•åº“: è®¢å•è¡¨, è®¢å•è”ç³»äººè¡¨; è®¢å•è¡¨åˆ†åº“åˆ†è¡¨ order1, order2, order3</li><li>æ”¯ä»˜åº“: äº¤æ˜“è¡¨</li><li>æ’æœŸåº“: æ’æœŸè¡¨, åº§ä½è¡¨, æ’æœŸåº§ä½è¡¨</li><li>ç”¨æˆ·åº“: ç”¨æˆ·è¡¨, è”ç³»äººè¡¨</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="é¡¹ç›®ç®¡ç†">é¡¹ç›®ç®¡ç†<a href="#é¡¹ç›®ç®¡ç†" class="hash-link" aria-label="Direct link to é¡¹ç›®ç®¡ç†" title="Direct link to é¡¹ç›®ç®¡ç†">â€‹</a></h2><p>git</p><p>sonarQube ä»£ç ç¼ºé™·, è§„èŒƒ</p><p>scrum æ•æ·å¼€å‘, å¤šä¸ªå·¥æœŸ, å±‚å±‚è¿­ä»£, æŒç»­äº¤ä»˜</p><h1>æ¡ˆä¾‹ åœ¨çº¿æ•™è‚²</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="è¡Œä¸šèƒŒæ™¯-and-å•†ä¸šæ¨¡å¼">è¡Œä¸šèƒŒæ™¯ and å•†ä¸šæ¨¡å¼<a href="#è¡Œä¸šèƒŒæ™¯-and-å•†ä¸šæ¨¡å¼" class="hash-link" aria-label="Direct link to è¡Œä¸šèƒŒæ™¯ and å•†ä¸šæ¨¡å¼" title="Direct link to è¡Œä¸šèƒŒæ™¯ and å•†ä¸šæ¨¡å¼">â€‹</a></h2><ul><li>c2c , ç³»ç»Ÿä½œä¸ºäº¤æ˜“å¹³å°, æœ‰è§†é¢‘æä¾›è€… (å¯èƒ½æ˜¯ä¸ªäººæä¾›è€…, æˆ–è€…æ˜¯ä¸“ä¸šçš„è¯¾ç¨‹åˆ¶ä½œå…¬å¸), è§†é¢‘å­¦ä¹ è€…, å¦‚ 51cto, è…¾è®¯è¯¾å ‚</li><li>b2c, ç³»ç»Ÿè‡ªå·±åˆ¶ä½œè¯¾ç¨‹, ä¸Šä¼ ç³»ç»Ÿ, ç»™å­¦ä¹ è€…å­¦ä¹ , </li><li>å‚ç›´é¢†åŸŸ, ä¸“ä¾›ä¸€ä¸ªæ–¹å‘çš„å­¦ä¹ è¯¾ç¨‹, å¦‚ ç½‘æ˜“äº‘è¯¾å ‚çš„å¾®ä¸“ä¸š</li><li>ç›´æ’­/äº’åŠ¨ (ä¸€å¯¹å¤šæ¨¡å¼), ä¸ºè€å¸ˆæä¾›ç›´æ’­æœåŠ¡</li><li>1 å¯¹ 1 æ¨¡å¼, å¦‚vipkid, å­¦è€Œæ€</li><li>å…è´¹å¢å€¼, é€šè¿‡æä¾›å…è´¹è¯¾ç¨‹, å¸å¼•ç”¨æˆ·, é€šè¿‡æä¾›ä¸€äº›å¢å€¼æœåŠ¡èµšé’±, å¦‚åˆ¶ä½œå­¦ä½è¯ä¹¦</li></ul><h1>æ¡ˆä¾‹ èšåˆæ”¯ä»˜</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="èšåˆæ”¯ä»˜æ¦‚å¿µ">èšåˆæ”¯ä»˜æ¦‚å¿µ<a href="#èšåˆæ”¯ä»˜æ¦‚å¿µ" class="hash-link" aria-label="Direct link to èšåˆæ”¯ä»˜æ¦‚å¿µ" title="Direct link to èšåˆæ”¯ä»˜æ¦‚å¿µ">â€‹</a></h2><p>å¯¹æ¥ å¾®ä¿¡, æ”¯ä»˜å®, é“¶è”, æä¾›ç»Ÿä¸€çš„æ”¯ä»˜å…¥å£</p><p>ä¸»è¦åšæ³•/å•†ä¸šæ¨¡å¼æœ‰è¿™ä¹ˆå‡ ç§: </p><ul><li>æä¾›çº¿ä¸Šèšåˆæ”¶é“¶å°(å¼€æ”¾ api)  </li><li>çº¿ä¸‹æä¾›ä¸€ç å¤šä»˜(æ¶ˆè´¹è€…æ‰«ä¸€ä¸ªäºŒç»´ç å°±èƒ½å¾®ä¿¡æ”¯ä»˜å®...), æˆ–è€…åè¿‡æ¥å•†å®¶æ‰«ç æ¶ˆè´¹è€…å®Œæˆæ”¯ä»˜</li><li>ä»¥ SaaS æœåŠ¡äº¤ä»˜ç»™å•†æˆ·ä½¿ç”¨, æä¾› è®¢å•ç®¡ç†, /é—¨åº—ç®¡ç†/è´¢åŠ¡æ•°æ®ç»Ÿè®¡ç­‰åŸºç¡€æœåŠ¡, ä»¥æ”¯ä»˜ä¸ºå…¥å£, æä¾› æ”¯ä»˜é¡µå¹¿å‘Šè¥é”€/é‡‘èè´·æ¬¾...ç­‰æœåŠ¡</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="é›†åˆæ”¯ä»˜é¡¹ç›®æ¶æ„">é›†åˆæ”¯ä»˜é¡¹ç›®æ¶æ„<a href="#é›†åˆæ”¯ä»˜é¡¹ç›®æ¶æ„" class="hash-link" aria-label="Direct link to é›†åˆæ”¯ä»˜é¡¹ç›®æ¶æ„" title="Direct link to é›†åˆæ”¯ä»˜é¡¹ç›®æ¶æ„">â€‹</a></h2><p>åŒ…æ‹¬è¿™äº›å­ç³»ç»Ÿ: å®˜ç½‘/å¼€æ”¾å¹³å°, å•†æˆ·ç³»ç»Ÿ, è¿è¥ç³»ç»Ÿ</p><p>æ¶æ„:</p><ul><li>ç”¨æˆ·å±‚: app, h5, pc</li><li>cdn: åˆ†å‘é™æ€èµ„æº, å¦‚ js, css, å›¾ç‰‡, è§†é¢‘</li><li>load balance: 4 å±‚è´Ÿè½½å‡è¡¡, 7 å±‚è´Ÿè½½å‡è¡¡</li><li>UI å±‚: å‰ç«¯é¡µé¢</li><li>æ¥å…¥å±‚: ç½‘å…³, oauth2</li><li>æœåŠ¡å±‚: åŸºç¡€æœåŠ¡, ä¸šåŠ¡æœåŠ¡</li><li>æ•°æ®å±‚: MySQL,  ç¼“å­˜, é˜Ÿåˆ—, ç´¢å¼•(es), æ–‡ä»¶å­˜å‚¨</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ”¯ä»˜ä¸šåŠ¡æµç¨‹">æ”¯ä»˜ä¸šåŠ¡æµç¨‹<a href="#æ”¯ä»˜ä¸šåŠ¡æµç¨‹" class="hash-link" aria-label="Direct link to æ”¯ä»˜ä¸šåŠ¡æµç¨‹" title="Direct link to æ”¯ä»˜ä¸šåŠ¡æµç¨‹">â€‹</a></h2><ol><li>å•†æˆ·æ³¨å†Œ</li><li>åå°å®¡æ ¸ (æŸ¥èµ„è´¨, è¥ä¸šæ‰§ç…§...)</li></ol><ul><li>é€šè¿‡åˆ™æ”¾è¡Œ</li><li>ä¸é€šè¿‡åˆ™é€šçŸ¥ç”³è¯·å•†æˆ·</li></ul><ol><li>å•†æˆ·è´­ä¹°å¥—é¤, åˆ›å»ºåº”ç”¨(å³åœ¨èšåˆæ”¯ä»˜å¹³å°åˆ›å»ºä¸€ä¸ªä¸šåŠ¡æ ‡è¯†, è¡¨ç¤ºæ”¯ä»˜æœåŠ¡è¦ç”¨åˆ°ä»€ä¹ˆä¸šåŠ¡), å¡«å†™æ”¯ä»˜æ¸ é“å‚æ•°(è‹¥å•†æˆ·æ¶‰åŠåˆ°è‡ªå·±å¼€å‘åº”ç”¨, è¿˜éœ€è¦é›†æˆ)</li><li>å•†æˆ·æµ‹è¯•/ä¸Šçº¿</li><li>æ¶ˆè´¹è€…æ¶ˆè´¹æ”¯ä»˜ç»™å•†æˆ·</li></ol><h1>æ¡ˆä¾‹ å¹¿å‘Šç³»ç»Ÿ</h1><p><a href="https://www.modb.pro/db/32755" target="_blank" rel="noopener noreferrer">https://www.modb.pro/db/32755</a>
<a href="https://www.cnblogs.com/zhangpan1244/category/1522751.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/zhangpan1244/category/1522751.html</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å¹¿å‘Šæ¦‚å¿µ">å¹¿å‘Šæ¦‚å¿µ<a href="#å¹¿å‘Šæ¦‚å¿µ" class="hash-link" aria-label="Direct link to å¹¿å‘Šæ¦‚å¿µ" title="Direct link to å¹¿å‘Šæ¦‚å¿µ">â€‹</a></h2><p>ad system: ç»ˆç«¯æ ¹æ®æ¡ä»¶æ•°æ®è¯·æ±‚å¹¿å‘Šç³»ç»Ÿ, è¿”å›åˆé€‚çš„å¹¿å‘Šæ•°æ®, å±•ç¤ºç»™æµè§ˆè€…</p><p>è§’è‰²: å¹³å°æ–¹, å¹¿å‘Šä¸», åª’ä½“æ–¹, å¹¿å‘Šæ¶ˆè´¹è€…</p><p>å› ä¸ºåª’ä½“æ•°é‡ä¼šä¸æ–­å¢é•¿ï¼Œå› æ­¤å¹¿å‘ŠæŠ•æ”¾ç³»ç»Ÿæ˜¯å…·æœ‰é«˜å¹¶å‘ã€ä½å»¶è¿Ÿçš„ç‰¹ç‚¹</p><p>åŠŸèƒ½:</p><ul><li>å¹¿å‘Šä¸»çš„å¹¿å‘ŠæŠ•æ”¾, å¦‚<ul><li>ç”¨æˆ·è´¦æˆ·, å¦‚å®é©¬å…¬å¸</li><li>æ¨å¹¿è®¡åˆ’, å¦‚å¹¿å‘Šä¸»åˆ¶å®šäº†ä¸€ä¸ªè®¡åˆ’, å®é©¬ x6 æ¨å¹¿è®¡åˆ’, è¿™ä¸ªæ¨å¹¿è®¡åˆ’åŒ…å«å¤šä¸ªæ¨å¹¿å•å…ƒ</li><li>æ¨å¹¿å•å…ƒ, ç”¨æ¥åšé™åˆ¶åŠ¨ä½œ, è¯·æ±‚å‘½ä¸­ä¸€ä¸ªæ¨å¹¿å•å…ƒå, ä¼šè¿”å›ä¸€ä¸ª/å¤šä¸ªåˆ›æ„ç‰©æ–™<ul><li>å…³é”®è¯æ¨å¹¿å•å…ƒ, å¦‚, åªæœ‰åŒ…å«æŒ‡å®šå…³é”®è¯çš„è¯·æ±‚æ‰ä¼šå‘½ä¸­è¿™ä¸ªå¹¿å‘Šå•å…ƒ</li><li>åœ°åŸŸæ¨å¹¿å•å…ƒ, å¦‚åªæœ‰æ¥è‡ªæŒ‡å®šåŒºåŸŸçš„è¯·æ±‚æ‰ä¼šå‘½ä¸­å¹¿å‘Šå•å…ƒ</li><li>å…´è¶£æ¨å¹¿å•å…ƒ, </li><li>äººç¾¤æ¨å¹¿å•å…ƒ</li></ul></li><li>åˆ›æ„ç‰©æ–™, æ–‡æœ¬, å›¾ç‰‡, è§†é¢‘..., æ¯ä¸ªåˆ›æ„éƒ½å¯ä»¥æ·»åŠ åˆ°ä¸€ä¸ª/å¤šä¸ªæ¨å¹¿å•å…ƒä¸Š</li></ul></li><li>åª’ä½“æ–¹çš„å¹¿å‘Šæ›å…‰ (æ’åº: å¹³å°æ–¹æ”¶ç›Šä¾æ¬¡å‡å°‘, å¹¿å‘Šä¸»æ”¶ç›Šä¸€æ¬¡å¢åŠ ); <ul><li>cpt æŒ‰æ—¶é—´æ”¶è´¹ cost per time (<a href="https://zhuanlan.zhihu.com/p/146391463" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/146391463</a> æ¦‚å¿µæ¢³ç†, <a href="https://zhuanlan.zhihu.com/p/25265028" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/25265028</a> æŠ•æ”¾ç»éªŒ)</li><li>cpm æŒ‰åƒæ¬¡å±•ç°æ”¶è´¹ cost per mille</li><li>cpc æŒ‰ç‚¹å‡»æ”¶è´¹ cost per click<ul><li>è¶…æŠ•: å¯¹äºCPCå¹¿å‘Šæ¥è¯´ï¼Œå³ä½¿è®¡è´¹ç³»ç»ŸåŠæ—¶å‘å‡ºä¸‹çº¿åé¦ˆï¼Œä½†é‚£äº›å·²ç»æŠ•æ”¾å‡ºå»ã€å°šæœªäº§ç”Ÿç‚¹å‡»çš„å¹¿å‘Šä»ç„¶ä¼šå¯èƒ½äº§ç”Ÿè¶…æŠ•ã€‚å› æ­¤è¶…æŠ•åªèƒ½æ§åˆ¶åœ¨ä¸€å®šèŒƒå›´ä¹‹å†…ï¼Œå¹¶ä¸èƒ½å®Œå…¨æœç»</li><li><a href="https://www.infoq.cn/article/using-kafka-streams-api-for-predictive-budgeting/" target="_blank" rel="noopener noreferrer">åŸºäºKafka Streamsæ„å»ºå¹¿å‘Šæ¶ˆè€—é¢„æµ‹ç³»ç»Ÿ</a></li><li>å¯¹é¢„ç®—å°†è¿‘çš„å¹¿å‘Šè®¡åˆ’ï¼ŒæŠ•æ”¾ç³»ç»Ÿä¹Ÿåº”è¯¥é™ä½æŠ•æ”¾é¢‘ç‡ï¼Œä½¿é¢„ç®—æå¯èƒ½å¹³æ»‘åœ°è¾¾åˆ°ä¸Šé™ã€‚</li></ul></li><li>cpa æŒ‰è¡Œä¸ºæ”¶è´¹ å¦‚æ³¨å†Œ.ä¸‹è½½</li></ul></li></ul><blockquote><p>ä¹‹æ‰€ä»¥æœ‰ä¸åŒçš„ç»“ç®—æ–¹å¼ï¼Œå…¶å®ä¹Ÿæ˜¯éšç€å¹¿å‘Šå¸‚åœºçš„å‘å±•é€æ¸è¡ç”Ÿå‡ºæ¥çš„ï¼Œæœ€å¼€å§‹æµé‡ç¨€ç¼ºï¼Œå¹³å°å ä¼˜åŠ¿ï¼Œå†åˆ°ä»Šå¤©é€æ¸æˆäº†ä¹°æ–¹å¸‚åœºï¼Œå¹¿å‘Šä¸»ä½œä¸ºéœ€æ±‚æ–¹çš„è°ˆåˆ¤æƒå˜å¤§ã€‚
æŒ‰CPAç»“ç®—æ—¶å¯¹å¹¿å‘Šä¸»æœ€æœ‰åˆ©ï¼Œä½†æ˜¯å¯¹å¹³å°æœ€ä¸åˆ©ã€‚ç»“ç®—æ–¹å¼æ¼”è¿›åˆ°ä»Šå¤©ï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€ç§å¹³è¡¡ï¼Œæ‰€ä»¥å¤„äºå¹³è¡¡ç‚¹é™„è¿‘çš„CPMå’ŒCPCæ˜¯æœ€å¸¸è§çš„ç»“ç®—æ–¹å¼ã€‚</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç³»ç»Ÿç»„æˆ">ç³»ç»Ÿç»„æˆ<a href="#ç³»ç»Ÿç»„æˆ" class="hash-link" aria-label="Direct link to ç³»ç»Ÿç»„æˆ" title="Direct link to ç³»ç»Ÿç»„æˆ">â€‹</a></h2><ul><li>æŠ•æ”¾ç³»ç»Ÿ, æœ€å‰ç«¯, ç»™å¹¿å‘Šä¸»ä½¿ç”¨; <ul><li>ä¼šå‘˜ç»­è´¹ã€å¹¿å‘Šåº“ç®¡ç†ã€è®¾å®šæ¨å¹¿æ¡ä»¶ã€è®¾ç½®å¹¿å‘Šå‡ºä»·ã€æŸ¥çœ‹æŠ•æ”¾æ•ˆæœ</li></ul></li><li>æ£€ç´¢ç³»ç»Ÿ, è´Ÿè´£æ‰¿æ¥Cç«¯çš„æµé‡è¯·æ±‚ï¼Œä»æµ·é‡å¹¿å‘Šåº“ä¸­ç­›é€‰å‡ºæœ€åˆé€‚çš„å‰Nä¸ªå¹¿å‘Šï¼Œå¹¶åœ¨å‡ åæ¯«ç§’å†…è¿”å›ç»“æœï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤šçº§ç­›é€‰å’Œæ’åºçš„è¿‡ç¨‹ã€‚<ul><li>åª’ä½“æ–¹ä½¿ç”¨, æ¯”å¦‚ app, åœ°é“é€šé“å¤§å±, ç½‘é¡µè¾¹æ  </li><li>å…³æ³¨è¯·æ±‚å“åº”æ—¶é—´</li><li>å€’æ’ç´¢å¼•: ä¸»è¦ç”¨äºå„ä¸ªå¹¿å‘Šé™åˆ¶ç»´åº¦çš„æ£€ç´¢; å¦‚, å¯¹äº table(unit_id, province, city), æ ¹æ®åœ°åŸŸ province/city æ‰¾åˆ° unitID;<ul><li>åˆæœŸè€ƒè™‘å­˜åœ¨ redis, å¹¿å‘Šæ•°æ®å¤šäº†, ä¸Š elasticsearch  </li></ul></li><li>ç´¢å¼•ç»´æŠ¤æ–¹å¼: å…¨é‡ç´¢å¼• + å¢é‡ç´¢å¼•; æ£€ç´¢ç³»ç»Ÿå¯åŠ¨, åŠ è½½å…¨é‡ç´¢å¼•(å¯åŠ¨æ—¶é—´ç‚¹å‰çš„æ•°æ®å…¨éƒ¨å¯¼å‡ºåˆ°æ–‡ä»¶ä¸­æˆä¸ºå…¨é‡ç´¢å¼•), ä¹‹åæ£€ç´¢ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ä¸æ–­æ·»åŠ å¢é‡ç´¢å¼•(å„ä¸ªè¡¨çš„å†™æ“ä½œ)</li></ul></li><li>è®¡è´¹ç³»ç»Ÿ, æ ¸å¿ƒä»»åŠ¡æ˜¯ä¿è¯å¹¿å‘ŠæŠ•æ”¾åœ¨é¢„ç®—èŒƒå›´ä¹‹å†…ï¼Œå°½å¯èƒ½åœ°é¿å…å‘ç”Ÿè¶…æŠ• å¼ºè°ƒæ•°æ®å®æ—¶æ€§<ul><li>å¹¿å‘Šä¸»éœ€è¦é¢„å…ˆå……å€¼ä¸€å®šçš„é¢„ç®—, æ‰£å…‰äº†å°±ä¸ç»™ä»–å±•ç°å¹¿å‘Šäº†</li><li>é¢å‘Cç«¯/åª’ä½“æ–¹ï¼Œè´Ÿè´£å®æ—¶æ‰£è´¹ï¼Œå’Œæ”¶å…¥ç›´æ¥æŒ‚é’©ï¼Œå¯ç”¨æ€§è¦æ±‚é«˜</li></ul></li><li>ç»“ç®—ç³»ç»Ÿ, ç»“ç®—ç³»ç»Ÿæä¾›çš„æ˜¯å¹¿å‘Šå¹³å°ä¸å¹¿å‘Šä¸»ä¹‹é—´è´¹ç”¨ç»“ç®—æœåŠ¡ï¼Œå¼ºè°ƒæ•°æ®å‡†ç¡®åº¦, åŒ…æ‹¬å……å€¼ã€å†»ç»“ã€æ‰£è´¹ç­‰ã€‚<ul><li>ä¸€èˆ¬ä¼šä»¥ç¦»çº¿æ•°æ®ä¸ºåŸºç¡€è¿›è¡Œè®¡ç®—ï¼Œé¦–å…ˆï¼Œè¿™æ ·å¯ä»¥ä»¥è¾ƒå°‘çš„æˆæœ¬ä¿è¯æ•°æ®å®Œæ•´æ€§ï¼Œå› ä¸ºå¦‚æœåƒè®¡è´¹ç³»ç»Ÿé‚£æ ·ä¸€æ¥å®æ—¶æµè®¡ç®—ï¼Œå°±ä¸å¯é¿å…åœ°è¦é¢ä¸´æœåŠ¡å¯ç”¨æ€§é—®é¢˜</li><li>ç»“ç®—ç³»ç»Ÿä¸è®¡è´¹ç³»ç»Ÿè™½ç„¶éƒ½æä¾›äº†è´¹ç”¨è®¡ç®—çš„åŠŸèƒ½ï¼Œä½†ä¾§é‡ç‚¹ä¸åŒã€‚</li><li>é€šå¸¸ä¼šå¼•å…¥â€œåä½œå¼Šâ€çš„åŠŸèƒ½ï¼ˆæ¯”å¦‚ä¸€ä¸ªç”¨æˆ·çŸ­æ—¶é—´å†…å¤šæ¬¡ç‚¹å‡»ï¼Œåªæ”¶å–ä¸€æ¬¡ç‚¹å‡»çš„è´¹ç”¨ï¼‰</li></ul></li><li>æ›å…‰æ£€æµ‹ç³»ç»Ÿ, ç»™ä¸¤æ‹¨äººçœ‹çš„, åŒ…å«æœ‰æˆ‘ä»¬è‡ªèº«çš„æ£€æµ‹ç³»ç»Ÿå’Œç¬¬ä¸‰æ–¹çš„ç›‘æµ‹ç³»ç»Ÿ (å¯èƒ½å¹¿å‘Šä¸»ä¸ä¿¡ä»»å¹³å°, éœ€è¦è¯·ç¬¬ä¸‰æ–¹å‚ä¸ç›‘æ§, å¯¹æ¯”ç¬¬ä¸‰æ–¹å’Œæˆ‘ä»¬è‡ªå·±çš„ç›‘æµ‹, å·®åˆ«ä¸å¤§æ‰ä¼šå¿ƒç”˜æƒ…æ„¿ä»˜è´¹  )</li><li>è¿è¥åå°, ç»™è¿è¥äººå‘˜æŸ¥çœ‹æ•ˆæœæŠ¥è¡¨ç³»ç»Ÿ, å¦‚å±•ç¤ºäº†å¤šå°‘, æ›å…‰äº†å¤šå°‘, æœ‰å¤šå°‘å¹¿å‘Šè¯·æ±‚æ²¡æœ‰æ£€ç´¢åˆ°å¹¿å‘Šæ•°æ®, å†å°±æ˜¯<ul><li>æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬å¹¿å‘Šä½ç®¡ç†ã€å¹¿å‘Šç­–ç•¥ç®¡ç†ã€ä»¥åŠå„ç§è¿è¥å·¥å…·</li></ul></li><li>ABå®éªŒå¹³å°, å¹¿å‘Šä¸šåŠ¡çš„ç¨³å®šå™¨ï¼Œä»»ä½•å¹¿å‘Šç­–ç•¥ä¸Šçš„è°ƒæ•´å‡å¯ä»¥é€šè¿‡æ­¤å¹³å°è¿›è¡Œç°åº¦å®éªŒï¼Œè§‚å¯Ÿæ”¶å…¥æŒ‡æ ‡çš„å˜åŒ–</li><li>å¤§æ•°æ®å¹³å°: æ•´ä¸ªå¹¿å‘Šç³»ç»Ÿçš„åº•ç›˜ï¼Œéœ€è¦èšåˆå„ç§å¼‚æ„æ•°æ®æºï¼Œå®Œæˆç¦»çº¿å’Œå®æ—¶æ•°æ®åˆ†æå’Œç»Ÿè®¡ï¼Œäº§å‡ºä¸šåŠ¡æŠ¥è¡¨ï¼Œç”Ÿäº§æ¨¡å‹ç‰¹å¾ç­‰</li></ul><p>æ‹“å±•:</p><ul><li>æ·»åŠ æ›´å¤šçš„å¹¿å‘Šæ£€ç´¢ç»´åº¦, å¦‚åœ°åŸŸ, å…´è¶£</li><li>ç”¨æˆ·ç”»åƒ</li><li>ai</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å¹¿å‘Šçš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹">å¹¿å‘Šçš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹<a href="#å¹¿å‘Šçš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹" class="hash-link" aria-label="Direct link to å¹¿å‘Šçš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹" title="Direct link to å¹¿å‘Šçš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹">â€‹</a></h2><p>ç²¾å‡†å®šå‘ä»¥åŠå®æ—¶ç«ä»·æ˜¯ç›®å‰æœ€ä¸»æµçš„ä¸šåŠ¡å½¢æ€, éšç€å¹³å°æµé‡ä»¥åŠå¹¿å‘Šä¸»è§„æ¨¡è¿›ä¸€æ­¥å¢å¤§ï¼Œå¾€å¾€ä¼šä»ã€Œè‡ªè¥å‹ç«ä»·ç½‘ç»œã€é€æ¸å‘ã€Œè”ç›Ÿå¹¿å‘Šä»¥åŠRTBå®æ—¶ç«ä»·ã€æ–¹å‘å‘å±•ï¼Œç±»ä¼¼äºé˜¿é‡Œå¦ˆå¦ˆã€è…¾è®¯å¹¿ç‚¹é€šã€å¤´æ¡å·¨é‡å¼•æ“</p><ol><li>å¹¿å‘Šä¸»å…ˆé€šè¿‡æŠ•æ”¾å¹³å°å‘å¸ƒå¹¿å‘Šï¼Œå¯è®¾ç½®ä¸€ç³»åˆ—çš„å®šå‘æ¡ä»¶ï¼Œæ¯”å¦‚æŠ•æ”¾åŸå¸‚ã€æŠ•æ”¾æ—¶é—´æ®µã€äººç¾¤æ ‡ç­¾ã€å‡ºä»·ç­‰</li><li>æŠ•æ”¾åŠ¨ä½œå®Œæˆåï¼Œå¹¿å‘Šä¼šè¢«å­˜æ”¾åˆ°å¹¿å‘Šåº“ã€åŒæ—¶è¿›å…¥ç´¢å¼•åº“ï¼Œä»¥ä¾¿èƒ½è¢«å¹¿å‘Šæ£€ç´¢ç³»ç»Ÿæ£€ç´¢ã€‚</li><li>Cç«¯è¯·æ±‚è¿‡æ¥åï¼Œå¹¿å‘Šæ£€ç´¢ç³»ç»Ÿä¼šå®Œæˆå¬å›ã€ç®—æ³•ç­–ç•¥ã€ç«ä»·æ’åºç­‰ä¸€ç³»åˆ—çš„é€»è¾‘ï¼Œæœ€ç»ˆç­›é€‰å‡ºTop Nä¸ªå¹¿å‘Šï¼Œå®ç°å¹¿å‘Šçš„åƒäººåƒé¢</li></ol><ul><li>åª’ä½“æ–¹éœ€è¦å…ˆè¡Œåœ¨å¹¿å‘Šæ£€ç´¢ç³»ç»Ÿä¸­æ³¨å†Œ, è¯·æ±‚æ—¶, æºå¸¦è¿™äº›å‚æ•°: åª’ä½“æ–¹æ ‡è¯†, åŒ¹é…ä¿¡æ¯ (åœ°åŸŸ/å…´è¶£/å…³é”®å­—, é€»è¾‘æ“ä½œç¬¦ and/or), åŸºæœ¬ä¿¡æ¯(è¯·æ±‚ id, è®¾å¤‡ä¿¡æ¯, å¹¿å‘Šä½ä¿¡æ¯...)</li><li>å“åº”: å¹¿å‘Šåˆ›æ„(ä¸€ä¸ªæˆ–å¤šä¸ª)</li></ul><ol><li>ç”¨æˆ·ç‚¹å‡»å¹¿å‘Šåï¼Œä¼šè§¦å‘å¹¿å‘Šæ‰£è´¹æµç¨‹ï¼Œè¿™æ—¶å€™å¹³å°æ‰ç®—çœŸæ­£è·å¾—æ”¶ç›Š</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æŠ€æœ¯éš¾ç‚¹">æŠ€æœ¯éš¾ç‚¹<a href="#æŠ€æœ¯éš¾ç‚¹" class="hash-link" aria-label="Direct link to æŠ€æœ¯éš¾ç‚¹" title="Direct link to æŠ€æœ¯éš¾ç‚¹">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å¹¿å‘Šæ•°æ®çš„å­˜å‚¨">å¹¿å‘Šæ•°æ®çš„å­˜å‚¨<a href="#å¹¿å‘Šæ•°æ®çš„å­˜å‚¨" class="hash-link" aria-label="Direct link to å¹¿å‘Šæ•°æ®çš„å­˜å‚¨" title="Direct link to å¹¿å‘Šæ•°æ®çš„å­˜å‚¨">â€‹</a></h3><ul><li>OLTPåœºæ™¯, å­˜å‚¨åœ¨æ”¯æŒäº‹åŠ¡çš„ db ä¸­ï¼ŒåŒ…æ‹¬å¹¿å‘Šåº“ã€åˆ›æ„åº“ã€ä¼šå‘˜åº“ã€å¹¿å‘Šäº§å“åº“ã€å¹¿å‘Šç­–ç•¥åº“ç­‰ï¼Œè¿™äº›éƒ½å­˜å‚¨åœ¨MySQLä¸­ï¼Œæ•°æ®è§„æ¨¡è¾ƒå¤§çš„å¹¿å‘Šåº“å’Œåˆ›æ„åº“ï¼ŒæŒ‰ç…§å¹¿å‘Šä¸»ID Hashåšåˆ†åº“åˆ†è¡¨ã€‚</li><li>OLAPåœºæ™¯ï¼Œæ¶‰åŠåˆ°éå¸¸å¤šçš„æŠ¥è¡¨ï¼Œèšåˆç»´åº¦å¤šï¼Œå•è¡¨çš„è®°å½•æ•°å¯èƒ½è¾¾åˆ°ç™¾äº¿çº§åˆ«ï¼Œåº•å±‚é‡‡ç”¨HDFSå’ŒHBaseå­˜å‚¨ã€‚</li><li>é¢å‘å¹¿å‘Šæ£€ç´¢åœºæ™¯çš„ç´¢å¼•æ•°æ®ï¼ŒåŒ…æ‹¬æ­£æ’ç´¢å¼•å’Œå€’æ’ç´¢å¼•ï¼Œé‡‡ç”¨Rediså’ŒESæ¥å­˜å‚¨</li><li>å¹¿å‘Šçš„åŒæ­¥é—®é¢˜ã€‚å¹¿å‘ŠæŠ•æ”¾å®Œæˆåï¼Œé¦–å…ˆä¼šå­˜å‚¨åœ¨MySQLæ•°æ®åº“ä¸­ï¼Œæ¥ä¸‹æ¥éœ€è¦æŠŠå¹¿å‘Šå®æ—¶ä¼ è¾“åˆ°æ£€ç´¢ç³»ç»Ÿä¸­ï¼Œå®Œæˆæ­£æ’ç´¢å¼•ä»¥åŠå€’æ’ç´¢å¼•çš„æ›´æ–°<ul><li>å„ä¸ªä¸šåŠ¡ç³»ç»Ÿåœ¨æ¨å¹¿ã€ä½™é¢ç­‰ä¿¡æ¯å˜æ›´æ—¶ï¼Œå‘MQæ¶ˆæ¯ï¼Œç´¢å¼•æ›´æ–°æœåŠ¡è®¢é˜…MQæ¥æ„ŸçŸ¥å˜åŒ–ï¼Œå®Œæˆå¢é‡åŒæ­¥</li><li>å˜æ›´çš„æ¶ˆæ¯ä½“ä¸­ï¼Œä¸ä¼ é€’å®é™…å˜æ›´çš„å­—æ®µï¼Œä»…é€šçŸ¥æœ‰å˜åŒ–çš„å¹¿å‘ŠIDï¼Œç´¢å¼•æ›´æ–°æœåŠ¡å®æ—¶è¯»å–æœ€æ–°æ•°æ®å®Œæˆæ›´æ–°ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„è§£å†³æ¶ˆæ¯ä¹±åºå¼•èµ·çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜</li><li>å½“æ›´æ–°ç´¢å¼•çš„å¹¶å‘è¾¾åˆ°ä¸€å®šé‡çº§åï¼Œå¯é€šè¿‡åˆå¹¶ç›¸åŒå¹¿å‘Šçš„å˜æ›´ã€æˆ–è€…å°†å€’æ’å’Œæ­£æ’æ›´æ–°åˆ†ç¦»çš„æ–¹å¼æ¥æå‡æ•´ä½“çš„æ›´æ–°é€Ÿåº¦ã€‚</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å¹¿å‘Šæ•°æ®æ£€ç´¢">å¹¿å‘Šæ•°æ®æ£€ç´¢<a href="#å¹¿å‘Šæ•°æ®æ£€ç´¢" class="hash-link" aria-label="Direct link to å¹¿å‘Šæ•°æ®æ£€ç´¢" title="Direct link to å¹¿å‘Šæ•°æ®æ£€ç´¢">â€‹</a></h3><ul><li><p>é‡‡ç”¨Redisç¼“å­˜ï¼Œç¼“å­˜å¯æŒ‰ä¸šåŠ¡è§„åˆ’å¤šå¥—ï¼Œè¿›è¡Œåˆ†æµã€‚ç²¾ç®€RPCè¿”å›ç»“æœæˆ–è€…Redisç¼“å­˜å¯¹è±¡çš„ç»“æ„ï¼Œå»æ‰ä¸å¿…è¦çš„å­—æ®µï¼Œå‡å°‘IOæ•°æ®åŒ…å¤§å°ã€‚</p></li><li><p>çƒ­ç‚¹æ•°æ®å»ºç«‹æœ¬åœ°ç´¢å¼• (å³å†…å­˜ map, ä½¿ç”¨ concurrentmap)ï¼Œæ¯”å¦‚å¹¿å‘Šä½çš„é…ç½®ä¿¡æ¯ä»¥åŠç­–ç•¥é…ç½®ä¿¡æ¯ï¼Œåœ¨æœåŠ¡å¯åŠ¨æ—¶å°±å¯ä»¥é¢„åŠ è½½åˆ°æœ¬åœ°ï¼Œç„¶åå®šæ—¶è¿›è¡ŒåŒæ­¥ã€‚(å¯åŠ¨æ—¶, åŠ è½½å…¨é‡ç´¢å¼•, è¿è¡Œä¸­, ä¸æ–­åŠ è½½å¢é‡ç´¢å¼•)</p><ul><li>å¢é‡ç´¢å¼•: è®¢é˜… MySQL çš„ binglog </li></ul></li><li><p>é‡‡ç”¨å¤šçº¿ç¨‹å¹¶è¡ŒåŒ–æŸäº›å­æµç¨‹ï¼Œæ¯”å¦‚å¤šè·¯å¬å›é€»è¾‘ã€å¤šæ¨¡å‹æ‰“åˆ†é€»è¾‘</p></li><li><p>å’Œä¸»æµç¨‹æ— å…³çš„é€»è¾‘å¼‚æ­¥æ‰§è¡Œï¼Œæ¯”å¦‚æ‰£è´¹ä¿¡æ¯ç¼“å­˜ã€å¬å›ç»“æœç¼“å­˜ç­‰</p></li><li><p>éæ ¸å¿ƒæµç¨‹è®¾ç½®è¶…æ—¶ç†”æ–­èµ°é™çº§é€»è¾‘ï¼Œæ¯”å¦‚æº¢ä»·ç­–ç•¥ï¼ˆä¸æº¢ä»·åªæ˜¯å°‘èµšäº†ï¼Œä¸å½±å“å¹¿å‘Šæ£€ç´¢å¬å›ï¼‰ã€‚</p></li><li><p>GCä¼˜åŒ–ï¼ŒåŒ…æ‹¬JVMå †å†…å­˜çš„è®¾ç½®ã€åƒåœ¾æ”¶é›†å™¨çš„é€‰æ‹©ã€GCé¢‘æ¬¡ä¼˜åŒ–å’ŒGCè€—æ—¶ä¼˜åŒ–ã€‚</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è®¡è´¹å¹³å°çš„æŠ€æœ¯æ–¹æ¡ˆ">è®¡è´¹å¹³å°çš„æŠ€æœ¯æ–¹æ¡ˆ<a href="#è®¡è´¹å¹³å°çš„æŠ€æœ¯æ–¹æ¡ˆ" class="hash-link" aria-label="Direct link to è®¡è´¹å¹³å°çš„æŠ€æœ¯æ–¹æ¡ˆ" title="Direct link to è®¡è´¹å¹³å°çš„æŠ€æœ¯æ–¹æ¡ˆ">â€‹</a></h3><ul><li>æ‰£è´¹æµç¨‹åšäº†å¼‚æ­¥åŒ–å¤„ç†ï¼Œå½“æ”¶åˆ°å®æ—¶æ‰£è´¹è¯·æ±‚åï¼Œç³»ç»Ÿå…ˆå°†æ‰£è´¹æ—¶ç”¨åˆ°çš„ä¿¡æ¯ç¼“å­˜åˆ°Redisï¼Œç„¶åå‘é€MQæ¶ˆæ¯ï¼Œè¿™ä¸¤æ­¥å®Œæˆåæ‰£è´¹åŠ¨ä½œå°±ç®—ç»“æŸäº†, åˆ©ç”¨MQçš„å¯é æ€§æŠ•é€’å’Œé‡è¯•æœºåˆ¶ç¡®ä¿æ•´ä¸ªæ‰£è´¹æµç¨‹çš„æœ€ç»ˆä¸€è‡´æ€§</li><li>ä¸ºäº†æé«˜å¯ç”¨æ€§ï¼Œé’ˆå¯¹Rediså’ŒMQä¸å¯ç”¨çš„æƒ…å†µå‡é‡‡ç”¨äº†é™çº§æ–¹æ¡ˆã€‚Redisä¸å¯ç”¨æ—¶ï¼Œåˆ‡æ¢åˆ°TiKV(åˆ†å¸ƒå¼é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“)è¿›è¡ŒæŒä¹…åŒ–ï¼›MQæŠ•é€’å¤±è´¥æ—¶ï¼Œæ”¹æˆçº¿ç¨‹æ± å¼‚æ­¥å¤„ç†ã€‚</li><li>æ¯æ¬¡æœ‰æ•ˆç‚¹å‡»éƒ½éœ€è¦ç”Ÿæˆ1æ¡æ‰£è´¹è®¢å•ï¼Œé¢ä¸´å¤§æ•°æ®é‡çš„å­˜å‚¨é—®é¢˜ã€‚ç›®å‰æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯MySQLåˆ†åº“åˆ†è¡¨; åæœŸè€ƒè™‘ä½¿ç”¨HBaseç­‰åˆ†å¸ƒå¼å­˜å‚¨</li><li>è®¢å•å’Œç»“ç®—ç³»ç»Ÿæ•°æ®åŒæ­¥, é€šè¿‡Hiveä»»åŠ¡å®Œæˆå¯¹è´¦å’Œç›‘æ§ã€‚</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å¹¿å‘Šè¡¨è®¾è®¡">å¹¿å‘Šè¡¨è®¾è®¡<a href="#å¹¿å‘Šè¡¨è®¾è®¡" class="hash-link" aria-label="Direct link to å¹¿å‘Šè¡¨è®¾è®¡" title="Direct link to å¹¿å‘Šè¡¨è®¾è®¡">â€‹</a></h2><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MjM5MDc3OTMzMQ==&amp;action=getalbum&amp;album_id=1557571829207187456&amp;scene=173&amp;from_msgid=2649744188&amp;from_itemidx=1&amp;count=3#wechat_redirect" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MjM5MDc3OTMzMQ==&amp;action=getalbum&amp;album_id=1557571829207187456&amp;scene=173&amp;from_msgid=2649744188&amp;from_itemidx=1&amp;count=3#wechat_redirect</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mysql-çš„-binlog-å®ç°å¢é‡ç´¢å¼•">MySQL çš„ binlog å®ç°å¢é‡ç´¢å¼•<a href="#mysql-çš„-binlog-å®ç°å¢é‡ç´¢å¼•" class="hash-link" aria-label="Direct link to MySQL çš„ binlog å®ç°å¢é‡ç´¢å¼•" title="Direct link to MySQL çš„ binlog å®ç°å¢é‡ç´¢å¼•">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-ç»„ä»¶å®ç°ç›‘æ§">java ç»„ä»¶å®ç°ç›‘æ§<a href="#java-ç»„ä»¶å®ç°ç›‘æ§" class="hash-link" aria-label="Direct link to java ç»„ä»¶å®ç°ç›‘æ§" title="Direct link to java ç»„ä»¶å®ç°ç›‘æ§">â€‹</a></h3><p>mysql-binlog-connector-java</p><p>ç›¸å…³: </p><p><a href="https://github.com/zendesk/maxwell" target="_blank" rel="noopener noreferrer">https://github.com/zendesk/maxwell</a>  a mysql-to-json kafka producer è¿™ä¸ªä¹Ÿä¸é”™, å¯ä»¥é€šè¿‡ kafka å®ç°åˆ†å‘</p><p><a href="https://github.com/apache/nifi" target="_blank" rel="noopener noreferrer">https://github.com/apache/nifi</a>  process and distribute data</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="binlog-é…ç½®-sql">binlog é…ç½® SQL<a href="#binlog-é…ç½®-sql" class="hash-link" aria-label="Direct link to binlog é…ç½® SQL" title="Direct link to binlog é…ç½® SQL">â€‹</a></h3><p>MySQL é…ç½®æ–‡ä»¶ä¸­:</p><ul><li><p>log_bin , binlog switch, <code>show variables like &#x27;log_bin&#x27;</code></p></li><li><p>binlog_format , binglog format, <code>show variables like &#x27;binlog_format&#x27;  </code></p><ul><li><p>ROW , binlog ä¼šè®°å½•æ¯è¡Œæ•°æ®ä¿®æ”¹çš„ç»†èŠ‚, å¦‚å‰åçš„å€¼, ä¸è®°å½• SQL;</p><p>binlog å·¨å¤§</p><p>æ•°æ®ä¸€å®šå¯ä»¥è¢«æ¢å¤</p></li><li><p>statement , è®°å½•å†™æ“ä½œçš„ SQL, </p><p>binlog ä¸å¤§</p><p>SQL ä¸­æŸäº›æ¶‰åŠåˆ°ä¸Šä¸‹æ–‡çš„ å‡½æ•°/è§¦å‘å™¨ åœ¨æ¢å¤æ•°æ®çš„æ—¶å€™å¯èƒ½å‡ºç°é—®é¢˜</p></li><li><p>mixed, ä¸¤è€…çš„æ··åˆ</p></li></ul></li></ul><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> master logs</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- check binlog list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- å¸¸ç”¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> master </span><span class="token keyword" style="color:#00009f">status</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- check number of the last binlog file and view the position where the last event ended</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flush logs</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- generate a new binlog with a new number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reset master</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- clear all binlogs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Event_type åˆ— (å¸¸ç”¨çš„Binlog event)</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">query_event æ•°æ®æ— å…³çš„æ“ä½œ, å¦‚drop table, truncate table...</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">table_map_event è®°å½•åç»­æ“ä½œæ¶‰åŠåˆ°çš„è¡¨ä¿¡æ¯, å¦‚dbname, tblname</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">xid_event æ ‡è®°äº‹åŠ¡æäº¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="display:inline-block;color:#999988;font-style:italic"></span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">write_rows_event æ’å…¥æ“ä½œ</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">update_rows_event æ›´æ–°</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">delete_rows_event åˆ é™¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="display:inline-block;color:#999988;font-style:italic"></span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> binlog events</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- view the first binlog</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> binlog events </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;binlog.00030&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- view specified binlog</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> binlog events </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;binlog.00030&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">931</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- view specified binlog start from specified position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> binlog events </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;binlog.00030&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">931</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- view specified binlog start from specified position and limit 2 lines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> binlog events </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;binlog.00030&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">931</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- view specified binlog start from specified position and limit 2 lines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>æ¡ˆä¾‹ ç”µå•†ç±»ç½‘ç«™</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å¼€å‘ç¯å¢ƒæ­å»º">å¼€å‘ç¯å¢ƒæ­å»º<a href="#å¼€å‘ç¯å¢ƒæ­å»º" class="hash-link" aria-label="Direct link to å¼€å‘ç¯å¢ƒæ­å»º" title="Direct link to å¼€å‘ç¯å¢ƒæ­å»º">â€‹</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># æˆ‘æ˜¯ç”¨çš„ respberrypi, MySQL é•œåƒéœ€è¦ä½¿ç”¨ hypriot/rpi-mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run -d --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root -v /mydata/mysql/log:/var/log/mysql -v /mydata/mysql/data:/var/lib/mysql -v /mydata/mysql/conf:/etc/mysql hypriot/rpi-mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># nacos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># docker run -d --name nacos -p 8848:8848 -e MODE=standalone -v ~/docker_data/nacos/logs:/home/nacos/logs -v ~/docker_data/nacos/init.d/custom.properties:/home/nacos/init.d/custom.properties  nacos/nacos-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run -d --name nacos -p 8848:8848 -e MODE=standalone -v ~/docker_data/nacos/logs:/home/nacos/logs  nacos/nacos-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># å…ˆåˆ›å»º /mydata/redis/conf/redis.conf, å¦åˆ™ æ–‡ä»¶æŒ‚è½½æ—¶ redis.conf è¢«è¯†åˆ«ä¸º ç›®å½•</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /docker-data/reids/conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">touch  /docker-data/reids/conf/redis.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo docker run -d --name redis -p 6379:6379 -v /mydata/redis/data:/data -v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf redis /etc/redis/redis.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># redis å¯è§†åŒ–ç®¡ç†ç•Œé¢</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run -d --name redis-cmder -p 8079:8081 --link redis:re -e REDIS_HOSTS=re:6379 rediscommander/redis-commander</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="è¡Œä¸šæœ¯è¯­">è¡Œä¸šæœ¯è¯­<a href="#è¡Œä¸šæœ¯è¯­" class="hash-link" aria-label="Direct link to è¡Œä¸šæœ¯è¯­" title="Direct link to è¡Œä¸šæœ¯è¯­">â€‹</a></h2><ul><li>spu (standard product unit) æ ‡å‡†åŒ–äº§å“å•å…ƒ, æ˜¯ä¸€ç»„å•†å“ç‰¹æ€§çš„é›†åˆ, æ˜¯å•†å“ä¿¡æ¯èšåˆçš„æœ€å°å•ä½, é€šä¿—è¯´å°±æ˜¯å•†å“åç§°, å¦‚ iPhone X,  Mi 8 , ç±»æ¯” Java ä¸­çš„ class</li><li>sku (stock keeping unit) åº“å­˜å•å…ƒ, æ˜¯åº“å­˜è®¡é‡çš„åŸºæœ¬å•ä½, æ˜¯é”€å”®å±æ€§çš„é›†åˆ(é¢œè‰², å†…å­˜..., å…¶ä»–å±æ€§å±äºé€šç”¨å±æ€§å¦‚ç½‘ç»œ, åƒç´ ..å¯ä»¥ç›´æ¥å’Œ spu å…³è”), å¦‚ iPhone X 64G é»‘è‰², Mi8+64G+é»‘è‰², ç±»æ¯” Java ä¸­çš„ å®ä¾‹å¯¹è±¡, åŒä¸ª spu æœ‰å¤šä¸ªä¸åŒ sku; å¯ä»¥å†³å®šä»·æ ¼</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ä¸šåŠ¡æµç¨‹åˆ†æ">ä¸šåŠ¡æµç¨‹åˆ†æ<a href="#ä¸šåŠ¡æµç¨‹åˆ†æ" class="hash-link" aria-label="Direct link to ä¸šåŠ¡æµç¨‹åˆ†æ" title="Direct link to ä¸šåŠ¡æµç¨‹åˆ†æ">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å•†å“æ–°å¢">å•†å“æ–°å¢<a href="#å•†å“æ–°å¢" class="hash-link" aria-label="Direct link to å•†å“æ–°å¢" title="Direct link to å•†å“æ–°å¢">â€‹</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å•†å“ä¸Šæ¶">å•†å“ä¸Šæ¶<a href="#å•†å“ä¸Šæ¶" class="hash-link" aria-label="Direct link to å•†å“ä¸Šæ¶" title="Direct link to å•†å“ä¸Šæ¶">â€‹</a></h3><p>ç»™å®šä¸€ä¸ª spu id, å°†ç›¸å…³æ•°æ®å­˜å…¥ es, ä»¥ä¾¿æ£€ç´¢</p><p>å“ªäº›æ•°æ®è¿›å…¥ es?</p><ul><li>spu, å•†å“è§„æ ¼(æ™®é€šå±æ€§)æ£€ç´¢æ—¶éœ€è¦, åˆ†ç±»æ£€ç´¢æ—¶ä¹Ÿéœ€è¦</li><li>sku, è¿›å…¥å•†å“ä¸»é¡µ, é€‰æ‹©é¢œè‰², å±å¹• æ˜¯éœ€è¦æ£€ç´¢, æ­¤å¤–è¿˜è¦æ£€ç´¢ skuæ ‡é¢˜, ä»·æ ¼, é”€é‡  </li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="elasticsearch-æ•°æ®å»ºæ¨¡åˆ†æ">elasticsearch æ•°æ®å»ºæ¨¡åˆ†æ<a href="#elasticsearch-æ•°æ®å»ºæ¨¡åˆ†æ" class="hash-link" aria-label="Direct link to elasticsearch æ•°æ®å»ºæ¨¡åˆ†æ" title="Direct link to elasticsearch æ•°æ®å»ºæ¨¡åˆ†æ">â€‹</a></h2><p>å•†å“ä¸Šæ¶: spu ç›¸å…³ä¿¡æ¯ä¼šè¢«å­˜å‚¨åˆ° es, å¦‚ é¢œè‰², å†…å­˜, ram, æ ‡é¢˜</p><p>æ¯”è¾ƒåˆ†æ:</p><ul><li>å¯¹äº æ¨¡å‹ 1: è‹¥æœ‰ 100ä¸‡å•†å“, æ¯ä¸ªå•†å“åŸºæœ¬å±æ€§å ç”¨å­˜å‚¨ 2kb, 1000000 <em> 0.002mb == 2000mb == 2000 </em> 0.001 G == 2G, å°±æ˜¯åŠ ä¸€ä¸ªå†…å­˜æ¡çš„äº‹å„¿, å®Œå…¨å¯ä»¥æ¥å—</li><li>å¯¹äº æ¨¡å‹ 2: å‡å¦‚æŸä¸ªäººæœç´¢å°ç±³, å‘ es å‘é€ä¸€ä¸ªè¯·æ±‚, å¯èƒ½ä¼šå‡ºç°å¾ˆå¤š spu, å¦‚ æ‰‹æœº/ç”µå™¨/è·¯ç”±å™¨/åºŠå«..., å‡è®¾æœ‰ 4000 ä¸ª spu, æ¥ä¸‹æ¥æ ¹æ® spuId æŸ¥å¯¹åº” åŸºç¡€å±æ€§æ˜¾ç¤ºåœ¨è¿‡æ»¤æ ä½, 4000spuId <em> æ¯ä¸ªid æ˜¯ Long ç±»å‹ 8 ä¸ªå­—èŠ‚ == 4000 </em> 8 byte == 32000 byte == 32 kb. å³ä¸€ä¸ªè¯·æ±‚è‡³å°‘ä¼šå‘ es å‘é€ 32kb æ•°æ®, å‡è®¾ 10000 äººå¹¶å‘æ£€ç´¢å°ç±³, 10000*32kb === 320mb, ç™¾ä¸‡äººå¹¶å‘å°±ç›´æ¥æ˜¯ 32G äº†, è¿™å®Œå…¨ä¸å¯æ¥å—</li></ul><p>æ‰€ä»¥é€‰æ‹©æ¨¡å‹ 1, ä»¥ç©ºé—´æ¢æ—¶é—´</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// æ¨¡å‹ 1: åªæœ‰ä¸€ä¸ªç´¢å¼•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ–¹ä¾¿æ£€ç´¢, ä½†æ˜¯æœ‰æ•°æ®å†—ä½™, å¦‚ åŒä¸€ä¸ª spu ä¸‹ä¸åŒçš„ spu å•†å“çš„ attr éƒ½ç›¸åŒ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;spuId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚ iPhone X</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;skuId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 64G, é»‘è‰²</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;skuTitle&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;iPhone x 64G é»‘è‰²&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;saleCount&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;attrs&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;å°ºå¯¸&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4.5</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;CPU&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;é«˜é€š&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;åˆ†è¾¨ç‡&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;é«˜æ¸…&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ¨¡å‹ 2: åˆ†ä¸ºä¸¤ä¸ªç´¢å¼•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ²¡æœ‰æ•°æ®å†—ä½™, ä½†æ˜¯æ£€ç´¢æ—¶æ›´è€—æ—¶, å› ä¸ºæ•°æ®ä¼ è¾“é‡å¤§å¤§å¢åŠ äº†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// sku ç´¢å¼•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;spuId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚ iPhone X</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;skuId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 64G, é»‘è‰²</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;skuTitle&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;iPhone x 64G é»‘è‰²&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;saleCount&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// attr ç´¢å¼•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;spuId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚ iPhone X</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;attrs&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;å°ºå¯¸&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4.5</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;CPU&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;é«˜é€š&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;åˆ†è¾¨ç‡&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;é«˜æ¸…&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æœ€ç»ˆ product index å¯¼å…¥æ˜¯è¿™æ ·çš„:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PUT product</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">&quot;mapping&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token property" style="color:#36acaa">&quot;properties&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;skuId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;long&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;spuId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;keyword&quot;</span><span class="token comment" style="color:#999988;font-style:italic">// ç±»ä¼¼ text, ä¸åˆ†è¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;skuTitle&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;text&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//åˆ†è¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;analyzer&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;ik_smart&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;skuPrice&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;keyword&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;skuImg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token comment" style="color:#999988;font-style:italic">// å›¾ç‰‡é“¾æ¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;keyword&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// // ä¸å¯æ£€ç´¢</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;doc_values&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸éœ€è¦ èšåˆæ“ä½œ, çœç©ºé—´, é»˜è®¤ true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;saleCount&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token comment" style="color:#999988;font-style:italic">// é”€é‡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;long&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;hasStock&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;boolean&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;hotScore&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;long&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;brandId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;long&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;categoryId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;long&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;brandName&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;keyword&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;doc_values&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;brandImg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;keyword&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;doc_values&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;categoryName&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;keyword&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;doc_values&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">&quot;attrs&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;nested&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™å±æ€§æ˜¯åµŒå…¥å¼çš„, è¡¨ç¤º attrs æ˜¯ä¸€ä¸ª å¯¹è±¡ or å¯¹è±¡ç»„æˆçš„æ•°ç»„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœä¸æŒ‡å®šçš„è¯ es ä¼šå°†è¿™ä¸ªå±æ€§æ‰å¹³åŒ–å¤„ç†, å°†å¯¹è±¡å†…çš„å±æ€§æŠ½å–åˆ°å¤–å±‚å½¢æˆå¤šä¸ªè¿™æ ·çš„å±æ€§ attrs.attrId,  attrs.attrName, ....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token property" style="color:#36acaa">&quot;properties&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token property" style="color:#36acaa">&quot;attrId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;long&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token property" style="color:#36acaa">&quot;attrName&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;keyword&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token property" style="color:#36acaa">&quot;doc_values&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token property" style="color:#36acaa">&quot;attrValue&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;keyword&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç¼“å­˜åˆ†æ">ç¼“å­˜åˆ†æ<a href="#ç¼“å­˜åˆ†æ" class="hash-link" aria-label="Direct link to ç¼“å­˜åˆ†æ" title="Direct link to ç¼“å­˜åˆ†æ">â€‹</a></h2><p>å“ªäº›æ•°æ®é€‚åˆæ”¾å…¥ç¼“å­˜? (ä¸ç»å¸¸æ”¹å˜, è®¿é—®é‡å¤§, ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„æ•°æ®), å¤±æ•ˆæ—¶é—´æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®š</p><ul><li>å•†å“åˆ†ç±», å•†å“åˆ—è¡¨</li></ul><p>ç¼“å­˜ä¸€è‡´æ€§æ–¹æ¡ˆ:</p><ul><li>å¯¹äºç”¨æˆ·ç›¸å…³çš„æ•°æ®(è®¢å•æ•°æ®, ä¸ªäººä¿¡æ¯...), å¹¶å‘è¯»å†™å‡ ç‡å¾ˆå°, åŸºæœ¬ä¸Šæ²¡æœ‰ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜, é‡‡ç”¨è®¾ç½®ç¼“å­˜è¿‡æœŸçš„ç­–ç•¥</li><li>é¦–é¡µèœå•, å•†å“ä»‹ç»è¿™ç±»æ•°æ®, èƒ½å¤Ÿå®¹å¿ä¸€å®šçš„ä¸ä¸€è‡´, ä½¿ç”¨ canalè®¢é˜… binlog çš„æ–¹å¼</li><li>é€šè¿‡åŠ è¯»å†™é”, ä¿è¯å¹¶å‘è¯»å†™</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="éƒ¨ç½²æ¶æ„åˆ†æ">éƒ¨ç½²æ¶æ„åˆ†æ<a href="#éƒ¨ç½²æ¶æ„åˆ†æ" class="hash-link" aria-label="Direct link to éƒ¨ç½²æ¶æ„åˆ†æ" title="Direct link to éƒ¨ç½²æ¶æ„åˆ†æ">â€‹</a></h2><p>client(browser...) --&gt; nginx --&gt; ç½‘å…³é›†ç¾¤ --&gt; services</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å¼‚æ­¥å¤„ç†åˆ†æ">å¼‚æ­¥å¤„ç†åˆ†æ<a href="#å¼‚æ­¥å¤„ç†åˆ†æ" class="hash-link" aria-label="Direct link to å¼‚æ­¥å¤„ç†åˆ†æ" title="Direct link to å¼‚æ­¥å¤„ç†åˆ†æ">â€‹</a></h2><p>ä¸€ä¸ªæ˜¯å¯ä»¥é€šè¿‡ completableFuture </p><p>ä¸€ä¸ªæ˜¯é€šè¿‡ mq</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mq">mq<a href="#mq" class="hash-link" aria-label="Direct link to mq" title="Direct link to mq">â€‹</a></h3><ul><li><p>å¼‚æ­¥: å¤„ç†æ³¨å†Œæµç¨‹ (å¼‚æ­¥å‘é€çŸ­ä¿¡)</p></li><li><p>è§£è€¦: ä¸‹å•åçš„å‡ºåº“æ“ä½œ, é€šè¿‡ mq è°ƒç”¨å‡åº“å­˜æ¥å£, ä½¿å¾—è®¢å•ç³»ç»Ÿå’Œåº“å­˜ç³»ç»Ÿè§£è€¦</p></li><li><p>æµé‡æ§åˆ¶: å¯¹äºç¬æ—¶å¤§é‡è¯·æ±‚, å…ˆå †ç§¯åœ¨ mq, åé¢æ…¢æ…¢å¤„ç†</p></li></ul><h1>æ¡ˆä¾‹ ç‰©è”ç½‘å¹³å°</h1><p><a href="https://github.com/jetlinks/jetlinks-community" target="_blank" rel="noopener noreferrer">https://github.com/jetlinks/jetlinks-community</a>
<a href="https://open.iot.10086.cn/" target="_blank" rel="noopener noreferrer">https://open.iot.10086.cn/</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/docs/tags/springcloud">springcloud</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/xiaoyureed/xiaoyureed.github.io/tree/main/docs/springcloud-note.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/spring-note"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Spring</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/springmvc-note"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Spring MVC</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#spring-cloud-config" class="table-of-contents__link toc-highlight">Spring-Cloud-Config</a></li><li><a href="#apolo" class="table-of-contents__link toc-highlight">apolo</a></li><li><a href="#alibaba-nacos-ä½œä¸ºé…ç½®ä¸­å¿ƒ" class="table-of-contents__link toc-highlight">alibaba nacos ä½œä¸ºé…ç½®ä¸­å¿ƒ</a></li><li><a href="#æ³¨å†Œä¸­å¿ƒé€‰å‹" class="table-of-contents__link toc-highlight">æ³¨å†Œä¸­å¿ƒé€‰å‹</a></li><li><a href="#eureka" class="table-of-contents__link toc-highlight">eureka</a></li><li><a href="#consul" class="table-of-contents__link toc-highlight">consul</a></li><li><a href="#zookeeper" class="table-of-contents__link toc-highlight">zookeeper</a></li><li><a href="#nacos-ä½œä¸ºæ³¨å†Œä¸­å¿ƒ" class="table-of-contents__link toc-highlight">nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒ</a></li><li><a href="#etcd" class="table-of-contents__link toc-highlight">etcd</a></li><li><a href="#æ‰‹åŠ¨å®ç°è°ƒç”¨æ¡†æ¶" class="table-of-contents__link toc-highlight">æ‰‹åŠ¨å®ç°è°ƒç”¨æ¡†æ¶</a></li><li><a href="#feign" class="table-of-contents__link toc-highlight">feign</a></li><li><a href="#openfeign" class="table-of-contents__link toc-highlight">OpenFeign</a><ul><li><a href="#åŸºæœ¬ä½¿ç”¨" class="table-of-contents__link toc-highlight">åŸºæœ¬ä½¿ç”¨</a></li><li><a href="#è¶…æ—¶ç»¼åˆé…ç½®" class="table-of-contents__link toc-highlight">è¶…æ—¶ç»¼åˆé…ç½®</a></li><li><a href="#feign-client-interceptor" class="table-of-contents__link toc-highlight">feign client interceptor</a></li><li><a href="#æ—¥å¿—é…ç½®" class="table-of-contents__link toc-highlight">æ—¥å¿—é…ç½®</a></li></ul></li><li><a href="#é›†ä¸­å¼è´Ÿè½½å‡è¡¡å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡" class="table-of-contents__link toc-highlight">é›†ä¸­å¼è´Ÿè½½å‡è¡¡å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</a></li><li><a href="#ribbon" class="table-of-contents__link toc-highlight">ribbon</a><ul><li><a href="#å¦‚ä½•ä½¿ç”¨-ribbon" class="table-of-contents__link toc-highlight">å¦‚ä½•ä½¿ç”¨ ribbon</a></li><li><a href="#è´Ÿè½½å‡è¡¡ç®—æ³•" class="table-of-contents__link toc-highlight">è´Ÿè½½å‡è¡¡ç®—æ³•</a></li></ul></li><li><a href="#spring-cloud-loadbalancer" class="table-of-contents__link toc-highlight">spring cloud loadBalancer</a></li><li><a href="#hystrix" class="table-of-contents__link toc-highlight">hystrix</a><ul><li><a href="#hystrix-åŸç†" class="table-of-contents__link toc-highlight">hystrix åŸç†</a></li><li><a href="#hystrix-é™çº§ä½¿ç”¨" class="table-of-contents__link toc-highlight">hystrix é™çº§ä½¿ç”¨</a><ul><li><a href="#å•ç‹¬ä½¿ç”¨" class="table-of-contents__link toc-highlight">å•ç‹¬ä½¿ç”¨</a></li><li><a href="#é…åˆ-openfeign" class="table-of-contents__link toc-highlight">é…åˆ openFeign</a></li></ul></li><li><a href="#ç†”æ–­ç›‘æ§hystrix-dashboardå’Œturbine" class="table-of-contents__link toc-highlight">ç†”æ–­ç›‘æ§Hystrix-Dashboardå’ŒTurbine</a></li><li><a href="#è‡ªå®šä¹‰éš”ç¦»ç­–ç•¥" class="table-of-contents__link toc-highlight">è‡ªå®šä¹‰éš”ç¦»ç­–ç•¥</a></li></ul></li><li><a href="#spring-cloud-alibaba-sentinel" class="table-of-contents__link toc-highlight">spring cloud alibaba sentinel</a></li><li><a href="#resilience4j" class="table-of-contents__link toc-highlight">resilience4j</a></li><li><a href="#ç½‘å…³é€‰å‹" class="table-of-contents__link toc-highlight">ç½‘å…³é€‰å‹</a></li><li><a href="#ç½‘å…³é«˜å¯ç”¨" class="table-of-contents__link toc-highlight">ç½‘å…³é«˜å¯ç”¨</a></li><li><a href="#nodejs" class="table-of-contents__link toc-highlight">nodejs</a></li><li><a href="#kong" class="table-of-contents__link toc-highlight">kong</a></li><li><a href="#openresty" class="table-of-contents__link toc-highlight">openResty</a></li><li><a href="#zuul" class="table-of-contents__link toc-highlight">zuul</a><ul><li><a href="#ä»€ä¹ˆæ˜¯zuul" class="table-of-contents__link toc-highlight">ä»€ä¹ˆæ˜¯zuul</a></li><li><a href="#åŸºæœ¬ä½¿ç”¨-1" class="table-of-contents__link toc-highlight">åŸºæœ¬ä½¿ç”¨</a></li></ul></li><li><a href="#spring-cloud-gateway" class="table-of-contents__link toc-highlight">spring-cloud-gateway</a><ul><li><a href="#ç®€å•ä»‹ç»" class="table-of-contents__link toc-highlight">ç®€å•ä»‹ç»</a></li><li><a href="#æœ‰å“ªäº›å†…ç½®-route-predicate-factory" class="table-of-contents__link toc-highlight">æœ‰å“ªäº›å†…ç½® route predicate factory</a></li><li><a href="#æœ‰å“ªäº›-å†…ç½®-filter" class="table-of-contents__link toc-highlight">æœ‰å“ªäº› å†…ç½® filter</a></li><li><a href="#è‡ªå®šä¹‰-filter" class="table-of-contents__link toc-highlight">è‡ªå®šä¹‰ filter</a><ul><li><a href="#gateway-filter" class="table-of-contents__link toc-highlight">gateway filter</a></li><li><a href="#å…¨å±€-filter" class="table-of-contents__link toc-highlight">å…¨å±€ filter</a></li></ul></li><li><a href="#gateway-é…ç½®æ–¹æ³•" class="table-of-contents__link toc-highlight">gateway é…ç½®æ–¹æ³•</a></li><li><a href="#ç½‘å…³ç›‘æ§" class="table-of-contents__link toc-highlight">ç½‘å…³ç›‘æ§</a></li></ul></li><li><a href="#sleuth-å’Œ-zipkin" class="table-of-contents__link toc-highlight">sleuth å’Œ zipkin</a><ul><li><a href="#åˆ†å¸ƒå¼è¿½è¸ª" class="table-of-contents__link toc-highlight">åˆ†å¸ƒå¼è¿½è¸ª</a></li><li><a href="#spring-cloud-sleuth" class="table-of-contents__link toc-highlight">spring-cloud-sleuth</a></li><li><a href="#zipkin-ä½¿ç”¨" class="table-of-contents__link toc-highlight">zipkin ä½¿ç”¨</a></li><li><a href="#ä½¿ç”¨æ¡ˆä¾‹" class="table-of-contents__link toc-highlight">ä½¿ç”¨æ¡ˆä¾‹</a></li></ul></li><li><a href="#skywalking" class="table-of-contents__link toc-highlight">skyWalking</a></li><li><a href="#æ—¥å¿—æ€ä¹ˆæœç´¢-elasticsearch" class="table-of-contents__link toc-highlight">æ—¥å¿—æ€ä¹ˆæœç´¢ elasticSearch</a></li><li><a href="#æ—¥å¿—æ€ä¹ˆæ”¶é›†" class="table-of-contents__link toc-highlight">æ—¥å¿—æ€ä¹ˆæ”¶é›†</a></li><li><a href="#æ—¥å¿—æ€ä¹ˆå±•ç¤º" class="table-of-contents__link toc-highlight">æ—¥å¿—æ€ä¹ˆå±•ç¤º</a></li><li><a href="#spring-cloud-bus" class="table-of-contents__link toc-highlight">Spring-Cloud-Bus</a></li><li><a href="#alibaba-nacos-ä½œä¸ºæ¶ˆæ¯æ€»çº¿" class="table-of-contents__link toc-highlight">alibaba nacos ä½œä¸ºæ¶ˆæ¯æ€»çº¿</a></li><li><a href="#ä¸šåŠ¡æ¶æ„" class="table-of-contents__link toc-highlight">ä¸šåŠ¡æ¶æ„</a></li><li><a href="#åº”ç”¨æ¶æ„" class="table-of-contents__link toc-highlight">åº”ç”¨æ¶æ„</a></li><li><a href="#æŠ€æœ¯æ¶æ„" class="table-of-contents__link toc-highlight">æŠ€æœ¯æ¶æ„</a></li><li><a href="#æ•°æ®åº“æ¶æ„" class="table-of-contents__link toc-highlight">æ•°æ®åº“æ¶æ„</a></li><li><a href="#é¡¹ç›®ç®¡ç†" class="table-of-contents__link toc-highlight">é¡¹ç›®ç®¡ç†</a></li><li><a href="#è¡Œä¸šèƒŒæ™¯-and-å•†ä¸šæ¨¡å¼" class="table-of-contents__link toc-highlight">è¡Œä¸šèƒŒæ™¯ and å•†ä¸šæ¨¡å¼</a></li><li><a href="#èšåˆæ”¯ä»˜æ¦‚å¿µ" class="table-of-contents__link toc-highlight">èšåˆæ”¯ä»˜æ¦‚å¿µ</a></li><li><a href="#é›†åˆæ”¯ä»˜é¡¹ç›®æ¶æ„" class="table-of-contents__link toc-highlight">é›†åˆæ”¯ä»˜é¡¹ç›®æ¶æ„</a></li><li><a href="#æ”¯ä»˜ä¸šåŠ¡æµç¨‹" class="table-of-contents__link toc-highlight">æ”¯ä»˜ä¸šåŠ¡æµç¨‹</a></li><li><a href="#å¹¿å‘Šæ¦‚å¿µ" class="table-of-contents__link toc-highlight">å¹¿å‘Šæ¦‚å¿µ</a></li><li><a href="#ç³»ç»Ÿç»„æˆ" class="table-of-contents__link toc-highlight">ç³»ç»Ÿç»„æˆ</a></li><li><a href="#å¹¿å‘Šçš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹" class="table-of-contents__link toc-highlight">å¹¿å‘Šçš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹</a></li><li><a href="#æŠ€æœ¯éš¾ç‚¹" class="table-of-contents__link toc-highlight">æŠ€æœ¯éš¾ç‚¹</a><ul><li><a href="#å¹¿å‘Šæ•°æ®çš„å­˜å‚¨" class="table-of-contents__link toc-highlight">å¹¿å‘Šæ•°æ®çš„å­˜å‚¨</a></li><li><a href="#å¹¿å‘Šæ•°æ®æ£€ç´¢" class="table-of-contents__link toc-highlight">å¹¿å‘Šæ•°æ®æ£€ç´¢</a></li><li><a href="#è®¡è´¹å¹³å°çš„æŠ€æœ¯æ–¹æ¡ˆ" class="table-of-contents__link toc-highlight">è®¡è´¹å¹³å°çš„æŠ€æœ¯æ–¹æ¡ˆ</a></li></ul></li><li><a href="#å¹¿å‘Šè¡¨è®¾è®¡" class="table-of-contents__link toc-highlight">å¹¿å‘Šè¡¨è®¾è®¡</a></li><li><a href="#mysql-çš„-binlog-å®ç°å¢é‡ç´¢å¼•" class="table-of-contents__link toc-highlight">MySQL çš„ binlog å®ç°å¢é‡ç´¢å¼•</a><ul><li><a href="#java-ç»„ä»¶å®ç°ç›‘æ§" class="table-of-contents__link toc-highlight">java ç»„ä»¶å®ç°ç›‘æ§</a></li><li><a href="#binlog-é…ç½®-sql" class="table-of-contents__link toc-highlight">binlog é…ç½® SQL</a></li></ul></li><li><a href="#å¼€å‘ç¯å¢ƒæ­å»º" class="table-of-contents__link toc-highlight">å¼€å‘ç¯å¢ƒæ­å»º</a></li><li><a href="#è¡Œä¸šæœ¯è¯­" class="table-of-contents__link toc-highlight">è¡Œä¸šæœ¯è¯­</a></li><li><a href="#ä¸šåŠ¡æµç¨‹åˆ†æ" class="table-of-contents__link toc-highlight">ä¸šåŠ¡æµç¨‹åˆ†æ</a><ul><li><a href="#å•†å“æ–°å¢" class="table-of-contents__link toc-highlight">å•†å“æ–°å¢</a></li><li><a href="#å•†å“ä¸Šæ¶" class="table-of-contents__link toc-highlight">å•†å“ä¸Šæ¶</a></li></ul></li><li><a href="#elasticsearch-æ•°æ®å»ºæ¨¡åˆ†æ" class="table-of-contents__link toc-highlight">elasticsearch æ•°æ®å»ºæ¨¡åˆ†æ</a></li><li><a href="#ç¼“å­˜åˆ†æ" class="table-of-contents__link toc-highlight">ç¼“å­˜åˆ†æ</a></li><li><a href="#éƒ¨ç½²æ¶æ„åˆ†æ" class="table-of-contents__link toc-highlight">éƒ¨ç½²æ¶æ„åˆ†æ</a></li><li><a href="#å¼‚æ­¥å¤„ç†åˆ†æ" class="table-of-contents__link toc-highlight">å¼‚æ­¥å¤„ç†åˆ†æ</a><ul><li><a href="#mq" class="table-of-contents__link toc-highlight">mq</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.b94328d8.js"></script>
<script src="/en/assets/js/main.fc98d8e0.js"></script>
</body>
</html>