<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-mongodb-note">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">MongoDB Notes🌈 - Xiaoyureed 的网络 Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xiaoyureed.github.io/en/img/logo.webp"><meta data-rh="true" name="twitter:image" content="https://xiaoyureed.github.io/en/img/logo.webp"><meta data-rh="true" property="og:url" content="https://xiaoyureed.github.io/en/docs/mongodb-note"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="xiaoyureed"><meta data-rh="true" name="keywords" content="blog, java, spring, microservice, python, rust, typescript, react, web"><meta data-rh="true" name="keywords" content=" 半路转行的编程爱好者, 写过 Python, Rust, 现在主攻 Java 分布式系统"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MongoDB Notes🌈 - Xiaoyureed 的网络 Wiki"><meta data-rh="true" name="description" content="https://university.mongodb.com/ 官方课程"><meta data-rh="true" property="og:description" content="https://university.mongodb.com/ 官方课程"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xiaoyureed.github.io/en/docs/mongodb-note"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/en/docs/mongodb-note" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/mongodb-note" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/mongodb-note" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://5SAMPKXTP9-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Xiaoyureed 的网络 Wiki" href="/en/opensearch.xml">


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f6da56a47f5085d1e0fedae39b8de00a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/en/rss.xml" title="xiaoyureed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/atom.xml" title="xiaoyureed Atom Feed">
<link rel="alternate" type="application/json" href="/en/feed.json" title="xiaoyureed JSON Feed">

<link rel="icon" href="/en/img/logo.webp">
<link rel="manifest" href="/en/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)">
<meta name="description" content="Xiaoyureed 的个人博客"><link rel="stylesheet" href="/en/assets/css/styles.261d8673.css">
<link rel="preload" href="/en/assets/js/runtime~main.97306ba3.js" as="script">
<link rel="preload" href="/en/assets/js/main.8d84d9e1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><a href="/docs/rust-note" target="_blank">Rust 指北, 欢迎查看...</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">kuizuo</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">菜单</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/archive">博客</a></li><li><a class="dropdown__link" href="/en/docs/intro">教程</a></li><li><a class="dropdown__link" href="/en/resource">Links</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/en/"><img src="/en/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.webp" alt="xiaoyureed" class="themedImage_ToTc themedImage--dark_i4oU"><b>kuizuo</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/SpringBoot-note">Spring Boot 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/autohotkey">Autohotkey 脚本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/blockchain">blockchain区块链</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/c-sharp-and-dot-net">C# &amp; .NET</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/chatgpt">Chatgpt Usage Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cpp">CPP and C 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cross-gfw">Cross The GFW</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cs-note">Computer Science Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/css-pre-processor">几种CSS预处理器比较选型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/data-structure-and-algorithm">Data Structure and Algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/design-pattern-note">Design Pattern 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/dev-resources">开发者资源</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/distributed-system">Distributed System 分布式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/docker-note-virtual-dev-env">Docker Note &amp; Other Virtual Develop Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/effective-java-reading-note">Effective Java 阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/elk-elastic-log">Distributed log collection分布式日志收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/english-note">英语学习🔥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/extjs-note">Extjs 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/git-note">Git 备忘 🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/golang-note">Golang 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/gps-gis-tracing">基于地理位置开发技术</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/gradle">Gradle note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/greasy-monkey">油猴插件&amp;编写脚本🐒</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/groovy-note">groovy note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/health">Health 关爱程序员健康🏥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/how-to-test-java-app">How to Test Java App</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/interview-system-design">系统设计 System design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/iot">Iot 物联网</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/java-code-clean">Java Clean Code Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/java-concurrent">Java Concurrent🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/java-memory-model-jmm-jvm">JMM and GC🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/java-note">Java Core 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/js-tutorial">JavaScript tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/kotlin">kotlin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/kubernetes-k8s">kubernetes-k8s ☁️</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/linux-note">鸟哥的 Linux 私房菜阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/low-code-platform">关于低代码平台的调研</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/mac">Mac 开发环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/machine-learning-ml">machine-learning-ml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/marketing-seo">Marketing SEO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/maven-note">Maven Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/message-queue">Message Queue🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/money">Investment Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/en/docs/mongodb-note">MongoDB Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/monitor-system-grafana-prometheus-influxdb-hbase-time-serials-database">monitor-system-grafana-prometheus监控🖥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/mvc-mvvm">MVC to MVVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/mybatis-note">MyBatis Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/netty-note">netty</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/nlp-natural-language-processing">nlp-natural-language-processing👄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/nodejs-yarn-npm">Nodejs, Yarn, Npm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/oracle">Oracle 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-audio-video">Audio and Video development Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-big-data-introduce">大数据开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-cache">Cache 缓存🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-computational-ad">计算广告 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-crawler-spider">网络爬虫 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-db-design-note">关系型数据库表设计🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-desktop-develop">桌面应用开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-http-restful">HTTP protocol Intro &amp; RESTful</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-reactive-programming">响应式编程 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-rpc">RPC Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-rule-engine-note">规则引擎 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/php-note">PHP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/postgres-note">Postgres note🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/process-workflow-bpm-engine">工作流引擎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/protect-your-app-authentication-oauth2-jwt-https">Protect Your App 安全保护认证鉴权🔑</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/python-note">Python🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/quant-money">量化交易</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/quarkus">Quarkus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/react-note">React🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/real-time-communication-protocol">实时通信 Real-time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/redis-note">Redis🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/regex">Regular Expression 正则🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/rust-note">Rust 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/scala-akka-play-framework">Scala 语言</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/serverless">Serverless</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/service-mesh">service mesh 服务网格</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/servlet">Servlet Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/shell-bash-note">shell-bash脚本收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/spring-note">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/springcloud-note">Spring Cloud 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/springmvc-note">Spring MVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/task-schedule-note">Task Schedule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/tcp-ip-note-p2p">TCP IP, p2p</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/tomcat-jetty-nginx">Tomcat Jetty Nginx 等 web 容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/vertx">Vertx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/video-creator">拍摄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/vue">Vue Brief Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/webassembly">webassembly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/webpack-esbuild-vite-rollup">前端打包构建工具</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MongoDB Notes🌈</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>MongoDB Notes🌈</h1></header><div align="center">https://university.mongodb.com/ 官方课程<p><a href="https://mongoing.com/" target="_blank" rel="noopener noreferrer">https://mongoing.com/</a> 中文社区
<a href="https://docs.mongoing.com/" target="_blank" rel="noopener noreferrer">https://docs.mongoing.com/</a> 文档</p><p><a href="https://www.mongodb.com/cloud" target="_blank" rel="noopener noreferrer">https://www.mongodb.com/cloud</a> 免费版云服务</p><p><a href="https://zhuanlan.zhihu.com/p/24377636" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/24377636</a>
<a href="https://zhuanlan.zhihu.com/p/26483750" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/26483750</a>
<a href="https://www.zhihu.com/question/20059632/answer/14981332" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/20059632/answer/14981332</a>
<a href="https://www.zhihu.com/question/19882468/answer/18329680" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/19882468/answer/18329680</a></p></div><ul><li><a href="#1-what-is-mongodb">1. what is mongodb</a><ul><li><a href="#11-%E7%89%B9%E6%80%A7">1.1. 特性</a></li><li><a href="#12-%E5%92%8C-mysql-%E6%A6%82%E5%BF%B5%E5%AF%B9%E6%AF%94">1.2. 和 MySQL 概念对比</a></li><li><a href="#13-%E5%92%8C-es-%E5%AF%B9%E6%AF%94">1.3. 和 es 对比</a></li><li><a href="#14-rdbms-%E5%92%8C-nosql">1.4. rdbms 和 nosql</a></li></ul></li><li><a href="#2-why-mongodb">2. why mongodb</a><ul><li><a href="#21-%E7%89%B9%E7%82%B9">2.1. 特点</a></li><li><a href="#22-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">2.2. 使用场景</a></li></ul></li><li><a href="#3-how">3. how</a><ul><li><a href="#31-%E5%AE%89%E8%A3%85">3.1. 安装</a><ul><li><a href="#311-docker-%E5%AE%89%E8%A3%85">3.1.1. docker 安装</a></li><li><a href="#312-%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%AE%89%E8%A3%85">3.1.2. 压缩包安装</a></li></ul></li><li><a href="#32-%E4%BD%BF%E7%94%A8">3.2. 使用</a><ul><li><a href="#321-%E5%92%8C-spring-boot-%E9%9B%86%E6%88%90">3.2.1. 和 spring boot 集成</a></li><li><a href="#322-%E4%BD%BF%E7%94%A8-%E5%91%BD%E4%BB%A4%E8%A1%8C">3.2.2. 使用 命令行</a></li></ul></li></ul></li><li><a href="#4-%E7%B4%A2%E5%BC%95">4. 索引</a><ul><li><a href="#41-%E7%B4%A2%E5%BC%95%E4%BB%8B%E7%BB%8D">4.1. 索引介绍</a></li><li><a href="#42-%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E6%93%8D%E4%BD%9C%E7%B4%A2%E5%BC%95">4.2. 在命令行中操作索引</a></li><li><a href="#43-%E7%B4%A2%E5%BC%95%E8%AF%84%E4%BC%B0%E4%BC%98%E5%8C%96">4.3. 索引评估优化</a></li></ul></li><li><a href="#5-%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4-shard-cluster">5. 分片集群 Shard Cluster</a><ul><li><a href="#51-%E6%9E%B6%E6%9E%84%E5%9B%BE">5.1. 架构图</a></li><li><a href="#52-%E5%88%86%E7%89%87%E6%9C%BA%E5%88%B6">5.2. 分片机制</a></li><li><a href="#53-%E5%89%AF%E6%9C%AC%E9%9B%86">5.3. 副本集</a></li><li><a href="#54-mongo-%E4%B8%AD%E7%9A%84-cap-%E6%94%AF%E6%8C%81">5.4. mongo 中的 cap 支持</a></li></ul></li></ul><h1>1. what is mongodb</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11-特性">1.1. 特性<a href="#11-特性" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>基于分布式文件存储的数据库。由C++语言编写</p><p>nosql (非关系数据库)</p><p>文档型 - mongo 本质是 key-value 存储, key需要唯一, value会以json的形式存储(json 的 field 可以不同), 而关系型通过一条条记录(具有相同 column)来存储数据</p><p>高性能计算，提供基于内存的快速数据查询</p><p>容易扩展，利用数据分片可以实现分布式存储, 副本集可以实现高可用集群</p><p>丰富的功能集，支持二级索引、强大的聚合管道功能，为开发者量身定做的功能，如数据自动老化、固定集合</p><p>存储方式为虚拟内存+持久化存储，Mongo将数据写入内存中，再由虚拟内存管理器将其持久化到硬盘中，因此写操作会比关系型数据库快很多</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12-和-mysql-概念对比">1.2. 和 MySQL 概念对比<a href="#12-和-mysql-概念对比" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><ul><li><p>数据库 (databases): 和 MySQL类似, 一台mongodb服务器可以包含多个数据库</p></li><li><p>集合 (collections): 类似MySQL中的表, 可以包含多个文档, 这些文档有相关性, 结构可以不同</p><p>  不同之处就在于集合的结构(schema)是动态的，不需要预先声明一个严格的表结构。</p><p>  更重要的是，默认情况下 MongoDB 并不会对写入的数据做任何schema的校验。</p></li><li><p>文档 (documents):  就是一个 json, 多个 field 组成, 是 mongo 独有的概念,类似 MySQL的 row</p></li><li><p>字段 (field ): json 中的某个 key, 类似 MySQL的 column</p><p>  支持嵌套的文档、数组</p><p>  MongoDB中字段的类型是固定的、区分大小写、并且文档中的字段也是有序的</p></li><li><p>_id 主键:  默认使用一个_id 字段来保证文档的唯一性</p><p>  若 insert 时不指定, 会自动生成 id, 由客户端(Driver)生成</p></li><li><p>reference 引用: 类似 MySQL的外键</p><p>  但是没有任何强制约束, 只是用于查询使用</p></li><li><p>view 视图: 视图是基于表/集合之上进行动态查询的一层对象，可以是虚拟的，也可以是物理的(物化视图), 类似 MySQL</p></li><li><p>index 索引: 与SQL 的索引相同</p></li><li><p><code>$lookup</code>: 聚合操作符，可以用于实现类似 SQL-join 连接的功能</p></li><li><p>transaction 事务，从 MongoDB 4.0 版本开始</p></li><li><p>aggregation 聚合: 类似 MySQL 的分组操作</p><p>  MongoDB 提供了强大的聚合计算框架，group by 是其中的一类聚合操作</p></li><li><p>mapreduce: </p></li><li><p>Projection (投影): 类似传统的SQL语法中，可以限定返回的字段</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13-和-es-对比">1.3. 和 es 对比<a href="#13-和-es-对比" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p><a href="https://www.zhihu.com/question/274485040/answer/1242910052" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/274485040/answer/1242910052</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="14-rdbms-和-nosql">1.4. rdbms 和 nosql<a href="#14-rdbms-和-nosql" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>关系型 vs. 非关系型</p><ul><li><p>rdbms 数据都是结构化的 (有严格的行/列约束), nosql 没有预定义的约束</p></li><li><p>rdbms 支持 sql</p><p>  mongodb 在 client 使用sql: mongobooster、studio3t</p></li><li><p>rdbms 支持事务 , nosql 不支持</p><p>  nosql 放弃事务，追求高性能、高可扩展</p><p>  最初 mongo 仅仅支持 单文档的事务, 4.0后, mongodb 支持多文档的事务 (事务中的操作可以跨副本集, 跨分片)</p><p>  在事务的隔离性上，MongoDB 支持快照(snapshot)的隔离级别，可以避免脏读、不可重复读和幻读。</p></li><li><p>rdbms 有严格的一致性, nosql 仅仅最终一致性</p></li></ul><h1>2. why mongodb</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21-特点">2.1. 特点<a href="#21-特点" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>可以和关系型数据库(MySQL)对比着看:</p><p>优点:</p><ul><li><p>没有schema约束, 可以迅速开发, 不必定义字段名, 字段类型等等</p></li><li><p>速度更快, mongo存储方式是 先写内存, 然后刷入磁盘</p><p>  用于缓存, 不过一般不这么干, redis 就够了</p></li><li><p>MongoDB自带复制、分片等高可用方案</p></li><li><p>支持二维空间/地理位置索引, 可以存储经纬度</p></li><li><p>GridFS, 将文件存储在MongoDB集合中</p></li><li><p>文档可以嵌套, 解决了 MySQL 中多表 join损失性能的问题</p></li></ul><p>缺点: </p><ul><li><p>没有数据完整性检查, 现在已经有了 (Mongoose 可以解决一切约束缺失问题)</p><p>  MongoDB 支持模式验证</p></li><li><p>没有强制的外键约束</p></li><li><p>事务支持 (MongoDB 目前只支持单文档事务，需要复杂事务支持的场景暂时不适合)</p></li><li><p>开源协议问题 (AGPLv3切换到SSPL)</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22-使用场景">2.2. 使用场景<a href="#22-使用场景" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><ol><li><p>适合 日志系统, 爬虫爬取的原始数据</p></li><li><p>适合数据规模巨大的系统 (自带分片, 复制功能, 分布式, 高可用实现方便)</p></li><li><p>o2o app, 用于地理位置存储 (查询附近的人, 距离、或者订餐系统、配送系统等)</p></li><li><p>作为文件存储系统</p></li><li><p>解决 MySQL 多表 join 的性能问题</p><blockquote><p>如将原本在 MySQL中需要 join 的查询数据, 作为一个文档, 存入 MongoDB</p></blockquote></li></ol><blockquote><p>应用不需要事务及复杂 join 支持?
新应用，需求会变，数据模型无法确定，想快速迭代开发？
应用需要2000-3000以上的读写QPS（更高也可以）？
应用需要TB甚至 PB 级别数据存储? 应用发展迅速，需要能快速水平扩展?
应用要求存储的数据不丢失?
应用需要99.999%高可用?
应用需要大量的地理位置查询、文本查询？</p></blockquote><p>如果上述有1个 Yes，可以考虑 MongoDB，2个及以上的 Yes，选择MongoDB绝不会后悔</p><h1>3. how</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31-安装">3.1. 安装<a href="#31-安装" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="311-docker-安装">3.1.1. docker 安装<a href="#311-docker-安装" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p><a href="https://www.jianshu.com/p/576a156f6877" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/576a156f6877</a>
<a href="https://www.cnblogs.com/yunquan/p/11174265.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/yunquan/p/11174265.html</a></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># https://hub.docker.com/_/mongo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 由于添加了 env params, 往 admin 数据库 的 system.users 集合中 插入了记录, 开启了 auth</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run -d -p 27017:27017 --name mongodb -e MONGO_INITDB_ROOT_USERNAME=mongoadmin -e MONGO_INITDB_ROOT_PASSWORD=mongoadmin mongo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># check -&gt; http://localhost:8081/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run --restart=always --name mongo-express --link mongodb:mongodb -d -p 8081:8081 -e ME_CONFIG_OPTIONS_EDITORTHEME=&quot;3024-night&quot; -e ME_CONFIG_BASICAUTH_USERNAME=&quot;mongoexpress&quot; -e ME_CONFIG_BASICAUTH_PASSWORD=&quot;mongoexpress&quot; -e ME_CONFIG_MONGODB_ADMINUSERNAME=&quot;mongoadmin&quot; -e ME_CONFIG_MONGODB_ADMINPASSWORD=&quot;mongoadmin&quot; -e ME_CONFIG_MONGODB_SERVER=&quot;mongodb&quot; mongo-express</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="312-压缩包安装">3.1.2. 压缩包安装<a href="#312-压缩包安装" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>下载 zip 包, 新建文件夹 <code>data</code> 用来存储数据; 新建 <code>daemon_start.sh</code> 作为server启动脚本:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">cd D:\\program_green\\mongodb\\mongodb-win32-x86_64-2008plus-ssl-4.0.11\\bin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">./mongod.exe --dbpath D:\\program_green\\mongodb\\data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>新建 <code>client_start.sh</code> 为client脚本:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">cd D:\\program_green\\mongodb\\mongodb-win32-x86_64-2008plus-ssl-4.0.11\\bin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">./mongo localhost:27017</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>mongoDB默认占用端口为27017</p><p>默认mongo启动是以test用户, 即 <code>mongo localhost:27017/test</code>, 可以以别的用户启动 <code>mongo localhost:27017/admin</code></p><p>数据建模时的区别可以参考: <a href="https://www.yiibai.com/mongodb/mongodb_data_modeling.html" target="_blank" rel="noopener noreferrer">https://www.yiibai.com/mongodb/mongodb_data_modeling.html</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32-使用">3.2. 使用<a href="#32-使用" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="321-和-spring-boot-集成">3.2.1. 和 spring boot 集成<a href="#321-和-spring-boot-集成" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>spring boot data mongodb</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">use demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#需要创建非 admin 的 user, 否则 spring boot 会报认证异常</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.createUser({&quot;user&quot;: &quot;tiger&quot;, &quot;pwd&quot;: &quot;tiger&quot;, &quot;roles&quot;: [{&quot;role&quot;: &quot;readWrite&quot;, &quot;db&quot;: &quot;demo&quot;}]})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>spring boot 配置: ...uri: <code>mongodb://tiger:tiger@172.24.208.103:27017/demo</code></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="322-使用-命令行">3.2.2. 使用 命令行<a href="#322-使用-命令行" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 进入</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 远程连接使用 mongo username:password@ip:port/dbname</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 不带 username 也可进入, 但是不是同一个系统</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mongo --username mongoadmin --password</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    使用 -u -p 亦可</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 显示当前db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查看所有</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">show dbs  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 使用/创建数据库, 默认是使用 test 数据库</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 必须插入数据才会显示出来</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">use DATABASE_NAME</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 数据库名不存在自动创建新数据库</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 全局所有用户</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.system.users.find().pretty()</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 当前 db 用户</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">show users</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 添加 user</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.createUser(</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       user: &quot;wenqiang&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       pwd: &quot;1438438&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       roles: [&quot;readWrite&quot;]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#or</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.createUser(</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       user: &quot;wenqiang&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       pwd: &quot;1438438&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       roles: [{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           &quot;role&quot;:&quot;readWrite&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           &quot;db&quot;: &quot;demo-db&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 创建管理员，赋予root权限</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.createUser({user:&quot;admin&quot;,pwd:&quot;xiiasdfiik34&quot;,roles:[{role: &#x27;root&#x27;, db: &#x27;admin&#x27;}]})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.createUser({user:&quot;pmsfile_prod&quot;,pwd:&quot;pmsplatformP@ssword0&quot;,roles:[{role: &#x27;readWrite&#x27;, db: &#x27;pmsfile&#x27;}]})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.createUser({user:&quot;pmsplatform&quot;,pwd:&quot;pmsplatformP@ssword0&quot;,roles:[{role: &#x27;readWrite&#x27;, db: &#x27;pmsfile&#x27;}]})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.updateUser(&quot;pmsplatform_file&quot;, {roles: [{role: &quot;readWrite&quot;, db: &quot;admin&quot;}]})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 删除 user</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.dropUser(&#x27;username&#x27;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 登录认证新user</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.auth(&quot;mutianwei&quot;, &quot;123568&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 显示表(集合)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">show collections</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查询当前 db 的集合</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.getCollectionNames()</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 创建 collections</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.createCollection(&quot;logs&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># create document</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.logs.insert( { name: &quot;wangwenqiang&quot;, age: 3} )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查询 所有 document</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.logs.find([json参数])</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.集合名称.find().limit(条数)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 统计条数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.集合名称.count([json 参数])</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 更新 document</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># age &gt; 25 的 user 的 status 设置为 c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.users.update(</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    { age: { $gt: 25 } },</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    { $set: { status: &#x27;C&#x27; } },</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    { multi: true }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.book.update(</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   {&quot;_id&quot; : ObjectId(&quot;5c61301c15338f68639e6802&quot;)},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   {&quot;$inc&quot;: {&quot;viewCount&quot;: 3} }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 删除 document</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.book.remove({&quot;_id&quot;:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     ObjectId(&quot;5c612b2f15338f68639e67d5&quot;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 删除集合中全部数据</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.集合名称.remove({})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># projection (只查询显示指定字段, 1 表示显示, 0 表示不显示, 默认 0)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.book.find({&quot;author&quot;: &quot;James&quot;}, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    {&quot;_id&quot;: 1, &quot;title&quot;: 1, &quot;author&quot;: 1})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 分页</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.book.find({})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    .sort({&quot;viewCount&quot; : -1})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    .skip(10).limit(5)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>4. 索引</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41-索引介绍">4.1. 索引介绍<a href="#41-索引介绍" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>使用 wiredTiger 作为默认的引擎。</p><p>使用了 B树的结构 (mysql  用的是 b+ 树) - <a href="https://zhuanlan.zhihu.com/p/107228878" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/107228878</a> //todo</p><p>============= 索引分类</p><p>除了普通索引之外，MongoDB 支持的类型还包括：</p><ul><li><p>哈希(HASH)索引，哈希是另一种快速检索的数据结构，MongoDB 的 HASH 类型分片键会使用哈希索引。</p></li><li><p>地理空间索引，用于支持快速的地理空间查询，如寻找附近1公里的商家。</p><p>  其球面（Spherical）和平面（Flat）两种模式，</p></li><li><p>文本索引，用于支持快速的全文检索</p></li><li><p>模糊索引(Wildcard Index)，一种基于匹配规则的灵活式索引，在4.2版本开始引入。</p></li></ul><p>唯一索引、</p><p>二级索引、</p><p>TTL索引(通过创建TTL索引，实现自动删除过期记录的功能, 比如保存日志)</p><p>MongoDB集合在创建时默认就基于_id字段创建了唯一索引，数据插入时会检查_id字段的唯一性</p><p>在内存足够的情况下，索引会被加载到Cache中，如果执行的查询是索引覆盖的（Query Optimization），其性能甚至可以媲美Redis等内存数据库等</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42-在命令行中操作索引">4.2. 在命令行中操作索引<a href="#42-在命令行中操作索引" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 为集合声明一个普通的索引：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 数字 1 代表升序，如果是降序则是 -1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.book.ensureIndex({author: 1})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 复合式(compound)的索引 (对 type, published 添加联合索引)，如下：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 只有对于复合式索引时，索引键的顺序才变得有意义</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.book.ensureIndex({type: 1, published: 1})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 如果索引的字段是数组类型，该索引就自动成为数组(multikey)索引：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># MongoDB 可以在复合索引上包含数组的字段，但最多只能包含一个</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.book.ensureIndex({tags: 1})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以通过一些参数化选项来为索引赋予一定的特性，包括：</p><ul><li><p>unique=true，表示一个唯一性索引</p></li><li><p>expireAfterSeconds=3600，表示这是一个TTL索引，并且数据将在1小时后老化</p></li><li><p>sparse=true，表示稀疏的索引，仅索引非空(non-null)字段的文档</p></li><li><p>partialFilterExpression: { rating: { $gt: 5 }，条件式索引，即满足计算条件的文档才进行索引</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43-索引评估优化">4.3. 索引评估优化<a href="#43-索引评估优化" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p><a href="https://docs.mongodb.com/manual/reference/explain-results/index.html" target="_blank" rel="noopener noreferrer">https://docs.mongodb.com/manual/reference/explain-results/index.html</a></p><p>使用 explain() 命令可以用于查询计划分析</p><p>hint() 强制查询走某个索引</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">db.test.explain().find( { a : 5 } )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &quot;queryPlanner&quot; : {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # 通过 winningPlan 可以知道是否高效: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # 未能命中索引的结果，会显示COLLSCAN</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # 命中索引的结果，使用IXSCAN</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #出现了内存排序，显示为 SORT</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;winningPlan&quot; : { </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      &quot;stage&quot; : &quot;FETCH&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      &quot;inputStage&quot; : {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;stage&quot; : &quot;IXSCAN&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;keyPattern&quot; : {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &quot;a&quot; : 5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;indexName&quot; : &quot;a_1&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;isMultiKey&quot; : false,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;direction&quot; : &quot;forward&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        &quot;indexBounds&quot; : {&quot;a&quot; : [&quot;[5.0, 5.0]&quot;]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>5. 分片集群 Shard Cluster</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51-架构图">5.1. 架构图<a href="#51-架构图" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">        application            </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                 </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">       </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                 v      v       v</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">            </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">                                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">            </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    mongos  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   mongos   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   mongos   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">             </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">            </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                                                                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                        </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">       </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">       </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">                  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   config primary    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                        </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">       </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">       </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                        v       v      v       v      v                  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                                                                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                             </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                             </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  config secondary  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    primary       </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  primary        </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                 </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                             </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  config secondary  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> secondary  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    secondary   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      secondary  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">secondary   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">     </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                             </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                             </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">        config server replSet </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">               shard0                             shard1                                             </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                                                                                                     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                                                                                                     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">                                                                                                     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>数据分片 shards </p><p>  存储真正的集群数据, 可以是一个单独的 Mongod实例，也可以是一个副本集</p><p>  生产环境下, Shard一般是一个 Replica Set，以防止该数据片的单点故障</p><p>  对于分片集合(sharded collection)来说，每个分片上都存储了集合的一部分数据(按照分片键切分)，如果集合没有分片，那么该集合的数据都存储在数据库的 Primary Shard中</p></li><li><p>配置服务器 config server </p><p>  保存集群的元数据（metadata），包含各个Shard的路由规则，配置服务器由一个副本集(ReplicaSet)组成</p></li><li><p>查询路由 mongos</p><p>  Mongos是 Sharded Cluster 的访问入口，其本身并不持久化数据 。</p><p>  Mongos启动后，会从 Config Server 加载元数据，开始提供服务，并将用户的请求正确路由到对应的Shard。</p><p>  Sharding 集群可以部署多个 Mongos 以分担客户端请求的压力</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52-分片机制">5.2. 分片机制<a href="#52-分片机制" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>基于分片切分后的数据块称为 chunk，一个分片后的集合会包含多个 chunk，每个 chunk 位于哪个分片(Shard) 则记录在 Config Server(配置服务器)上。</p><p>Mongos 在操作分片集合时，会自动根据分片键找到对应的 chunk，并向该 chunk 所在的分片发起操作请求。</p><p>===============数据如何切分:</p><ul><li><p>范围分片: 按照分片字段从小到大, 分成多个范围段, 每段就是一个 shard</p><p>  如: 集合根据x字段 (整型) 来分片，x的取值范围为<!-- -->[minKey, maxKey]<!-- -->, 将整个取值范围划分为多个chunk，每个chunk（默认配置为64MB）包含其中一小段的数据</p><p>  能很好的满足范围查询的需求, 如 想查询x的值在<!-- -->[-30, 10]<!-- -->之间的所有文档，这时 Mongos 直接能将请求路由到 Chunk2</p><p>  范围分片的缺点在于，如果 ShardKey 有明显递增（或者递减）趋势，则新插入的文档多会分布到同一个chunk，无法扩展写的能力，比如使用_id作为 ShardKey，而MongoDB自动生成的id高位是时间戳，是持续递增的。</p></li><li><p>哈希分片: 根据用户的 ShardKey 先计算出hash值（64bit整型），再根据hash值按照范围分片的策略将文档分布到不同的 chunk。</p><p>  由于 hash值的计算是随机的，因此 Hash 分片具有很好的离散性，可以将数据随机分发到不同的 chunk 上</p><p>  但不能高效的服务范围查询，所有的范围查询要查询多个 chunk 才能找出满足条件的文档。</p></li></ul><p>================如何保证每个 shard 上,  chunk 都是均衡的呢</p><ul><li><p>全预分配，chunk 的数量和 shard 都是预先定义好的，比如 10个shard，存储1000个chunk，那么每个shard 分别拥有100个chunk。</p></li><li><p>非预分配</p><p>  这种情况则比较复杂，一般当一个 chunk 太大时会产生分裂(split)，不断分裂的结果会导致不均衡；</p><p>  或者动态扩容增加分片时，也会出现不均衡的状态。 这种不均衡的状态由集群均衡器进行检测，一旦发现了不均衡则执行 chunk数据的搬迁达到均衡。</p><p>  数据均衡器运行于 Primary Config Server(配置服务器的主节点)上</p><p>  MongoDB 的数据迁移对集群性能存在一定影响，这点无法避免，目前的规避手段只能是将均衡窗口对齐到业务闲时段。</p></li></ul><p>============如何判断 chunk 是否均衡</p><p>对于数据的不均衡是根据两个分片上的 Chunk 个数差异来判定的, 有规定的阈值表,(规定了对于多大规模的 shard, chunk 个数差异不得大于多少)</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="53-副本集">5.3. 副本集<a href="#53-副本集" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>副本集可以作为 Shard Cluster 中的一个Shard(片)之外，对于规模较小的业务来说，也可以使用一个单副本集的方式进行部署, 之后随业务量变大缓慢过度到 shard cluster (<a href="https://docs.mongodb.com/manual/tutorial/convert-replica-set-to-replicated-shard-cluster/" target="_blank" rel="noopener noreferrer">https://docs.mongodb.com/manual/tutorial/convert-replica-set-to-replicated-shard-cluster/</a>)</p><p>MongoDB 的副本集采取了一主多从的结构，即一个Primary Node + N* Secondary Node的方式，数据从主节点写入，并复制到多个备节点。</p><p>利用副本集，我们可以实现：：</p><ul><li><p>数据库高可用，</p><p>  主节点宕机后，由备节点自动选举成为新的主节点；</p></li><li><p>读写分离，</p><p>  读请求可以分流到备节点，减轻主节点的单点压力。</p><p>  读写分离只能增加集群&quot;读&quot;的能力，对于写负载非常高的情况却无能为力。对此需求，使用分片集群并增加分片，或者提升数据库节点的磁盘IO、CPU能力可以取得一定效果。</p></li></ul><p>=====================选举</p><p>通过 Raft 算法来完成主节点的选举，这个环节在初始化的时候会自动完成，如下面的命令：</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">config = {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    _id : &quot;my_replica_set&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    members : [</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        {_id : 0, host : &quot;rs1.example.net:27017&quot;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        {_id : 1, host : &quot;rs2.example.net:27017&quot;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        {_id : 2, host : &quot;rs3.example.net:27017&quot;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># initiate 命令用于实现副本集的初始化：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rs.initiate(config)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 在选举完成后，通过 isMaster()命令就可以看到选举的结果</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db.isMaster()</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;hosts&quot; : [</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;192.168.100.1:27030&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;192.168.100.2:27030&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;192.168.100.3:27030&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;setName&quot; : &quot;myReplSet&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;setVersion&quot; : 1,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;ismaster&quot; : true,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;secondary&quot; : false,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;primary&quot; : &quot;192.168.100.1:27030&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;me&quot; : &quot;192.168.100.1:27030&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;electionId&quot; : ObjectId(&quot;7fffffff0000000000000001&quot;),</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;ok&quot; : 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>主节点的选举需要满足&quot;大多数&quot;原则, 为了避免出现平票的情况，副本集的部署一般采用是基数个节点，比如3个</p><p>=================心跳 failover</p><p>副本集中的每个节点上都会定时向其他节点发送心跳，以此来感知其他节点的变化，比如是否失效、或者角色发生了变化。</p><p>默认情况下，节点会每2秒向其他节点发出心跳，这其中包括了主节点。 如果备节点在10秒内没有收到主节点的响应就会主动发起选举</p><p>利用心跳，MongoDB 副本集实现了自动故障转移的功能 failover (即 primary node 挂了, 自动选举某个 slave node 作为新的 primary node )</p><p>=================主备节点的数据复制 oplog</p><p>主节点和备节点的数据是通过日志(oplog)复制来实现的，这很类似于 mysql 的 binlog</p><p>在每一个副本集的节点中，都会存在一个名为local.oplog.rs的特殊集合。 当 Primary 上的写操作完成后，会向该集合中写入一条oplog; 而 Secondary 则持续从 Primary 拉取新的 oplog 并在本地进行回放以达到同步的目的</p><ul><li>oplog 必须保证有序，通过 optime 来保证。</li><li>oplog 必须包含能够进行数据回放的完整信息。</li><li>oplog 必须是幂等的，即多次回放同一条日志产生的结果相同。</li><li>oplog 集合是固定大小的，为了避免对空间占用太大，旧的 oplog 记录会被滚动式的清理</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&quot;ts&quot; : Timestamp(1446011584, 2),</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&quot;h&quot; : NumberLong(&quot;1687359108795812092&quot;),</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&quot;v&quot; : 2,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&quot;op&quot; : &quot;i&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&quot;ns&quot; : &quot;test.nosql&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&quot;o&quot; : { &quot;_id&quot; : ObjectId(&quot;563062c0b085733f34ab4129&quot;), &quot;name&quot; : &quot;mongodb&quot;, &quot;score&quot; : &quot;100&quot; }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ts 操作的 optime，该字段不仅仅包含了操作的时间戳(timestamp)，还包含一个自增的计数器值。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># h 操作的全局唯一表示</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># v oplog 的版本信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># op 操作类型，比如 i=insert,u=update..</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ns 操作集合，形式为 database.collection</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># o 指具体的操作内容，对于一个 insert 操作，则包含了整个文档的内容</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="54-mongo-中的-cap-支持">5.4. mongo 中的 cap 支持<a href="#54-mongo-中的-cap-支持" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>参考 <a href="https://docs.mongodb.com/manual/applications/replication/" target="_blank" rel="noopener noreferrer">https://docs.mongodb.com/manual/applications/replication/</a></p><p>mongo 的 shard cluster 需要 在 一致性 和 可用性 两者权衡, 所以允许客户端为其操作设定一定的级别或者偏好，包括这些配置项：</p><ul><li><p>read preference</p><p>  读取偏好，可指定读主节点、读备节点，或者是优先读主、优先读备、取最近的节点</p><p>  设置为 primary，此时读写都在主节点上。 这保证了数据的一致性，但一旦主节点宕机会导致失败(可用性降低)</p><p>  设置为 secondaryPrefered，此时写主，优先读备，可用性提高了，但数据存在延迟(出现不一致)</p></li><li><p>write concern</p><p>  写关注，指定写入结果达到什么状态时才返回，可以为无应答(none)、应答(ack)，或者是大多数节点完成了数据复制等等</p><p>  将读写关注都设置为 majority(意思是 大多数)，一致性提升了，但可用性也同时降低了(节点失效会导致大多数写失败)</p></li><li><p>read concern</p><p>  读关注，指定读取的数据版本处于怎样的状态，可以为读本地、读大多数节点写入，或者是线性读(linearizable)等等。</p></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/docs/tags/mongodb">mongodb</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/docs/tags/nosql">nosql</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/docs/tags/db">db</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/money"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Investment Intro</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/monitor-system-grafana-prometheus-influxdb-hbase-time-serials-database"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">monitor-system-grafana-prometheus监控🖥</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#11-特性" class="table-of-contents__link toc-highlight">1.1. 特性</a></li><li><a href="#12-和-mysql-概念对比" class="table-of-contents__link toc-highlight">1.2. 和 MySQL 概念对比</a></li><li><a href="#13-和-es-对比" class="table-of-contents__link toc-highlight">1.3. 和 es 对比</a></li><li><a href="#14-rdbms-和-nosql" class="table-of-contents__link toc-highlight">1.4. rdbms 和 nosql</a></li><li><a href="#21-特点" class="table-of-contents__link toc-highlight">2.1. 特点</a></li><li><a href="#22-使用场景" class="table-of-contents__link toc-highlight">2.2. 使用场景</a></li><li><a href="#31-安装" class="table-of-contents__link toc-highlight">3.1. 安装</a><ul><li><a href="#311-docker-安装" class="table-of-contents__link toc-highlight">3.1.1. docker 安装</a></li><li><a href="#312-压缩包安装" class="table-of-contents__link toc-highlight">3.1.2. 压缩包安装</a></li></ul></li><li><a href="#32-使用" class="table-of-contents__link toc-highlight">3.2. 使用</a><ul><li><a href="#321-和-spring-boot-集成" class="table-of-contents__link toc-highlight">3.2.1. 和 spring boot 集成</a></li><li><a href="#322-使用-命令行" class="table-of-contents__link toc-highlight">3.2.2. 使用 命令行</a></li></ul></li><li><a href="#41-索引介绍" class="table-of-contents__link toc-highlight">4.1. 索引介绍</a></li><li><a href="#42-在命令行中操作索引" class="table-of-contents__link toc-highlight">4.2. 在命令行中操作索引</a></li><li><a href="#43-索引评估优化" class="table-of-contents__link toc-highlight">4.3. 索引评估优化</a></li><li><a href="#51-架构图" class="table-of-contents__link toc-highlight">5.1. 架构图</a></li><li><a href="#52-分片机制" class="table-of-contents__link toc-highlight">5.2. 分片机制</a></li><li><a href="#53-副本集" class="table-of-contents__link toc-highlight">5.3. 副本集</a></li><li><a href="#54-mongo-中的-cap-支持" class="table-of-contents__link toc-highlight">5.4. mongo 中的 cap 支持</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">历史</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/en/archive">Archive</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social Media</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/about">About Me</a></li><li class="footer__item"><a href="https://github.com/xiaoyureed" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/xiaoyuhfq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/3fPgwd3naN" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/en/friends">Friends</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/en/resource">Links</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p><a href="http://beian.miit.gov.cn/">闽ICP备2020017848号-2</a></p><p>Copyright © 2020 – PRESENT kuizuo Built with Docusaurus.</p></div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.97306ba3.js"></script>
<script src="/en/assets/js/main.8d84d9e1.js"></script>
</body>
</html>