<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-SpringBoot-note">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Spring Boot 备忘 | Xiaoyureed&#x27;s 网络 Wiki </title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xiaoyureed.github.io/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://xiaoyureed.github.io/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://xiaoyureed.github.io/en/docs/SpringBoot-note"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Spring Boot 备忘 | Xiaoyureed&#x27;s 网络 Wiki "><meta data-rh="true" name="description" content="https://github.com/YunaiV/SpringBoot-Labs"><meta data-rh="true" property="og:description" content="https://github.com/YunaiV/SpringBoot-Labs"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xiaoyureed.github.io/en/docs/SpringBoot-note"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/en/docs/SpringBoot-note" hreflang="en"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/SpringBoot-note" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://xiaoyureed.github.io/docs/SpringBoot-note" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="Xiaoyureed&#39;s 网络 Wiki  RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="Xiaoyureed&#39;s 网络 Wiki  Atom Feed"><link rel="stylesheet" href="/en/assets/css/styles.8eda099e.css">
<link rel="preload" href="/en/assets/js/runtime~main.71354b01.js" as="script">
<link rel="preload" href="/en/assets/js/main.be3ba4f3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.png" alt="xiaoyureed Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.png" alt="xiaoyureed Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Xiaoyureed</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/en/blog">Blog</a><a href="https://github.com/xiaoyureed" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/FreeMarker-note">FreeMarker Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/en/docs/SpringBoot-note">Spring Boot 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/agile-development-user-story-scrum">敏捷开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/android">Android 开发</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/autohotkey">Autohotkey 脚本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/blockchain">blockchain区块链</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/c-sharp-and-dot-net">C# &amp; .NET</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/chatgpt">Chatgpt Usage Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cloud-native-platform">云服务平台</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cpp">CPP and C 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cross-gfw">Cross The GFW</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cs-note">Computer Science Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/css-pre-processor">几种CSS预处理器比较选型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/data-structure-and-algorithm">Data Structure and Algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/design-pattern-note">Design Pattern 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/dev-resources">开发者资源</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/devops">DevOps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/distributed-system">Distributed System 分布式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/docker-note-virtual-dev-env">Docker Note &amp; Other Virtual Develop Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/effective-java-reading-note">Effective Java 阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/elk-elastic-log">Distributed log collection分布式日志收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/english-note">英语学习🔥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/extjs-note">Extjs 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/flutter">flutter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/games-development-introduce">游戏开发</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/git-note">Git 备忘 🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/github-starts">Github 星标⭐️</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/golang-note">Golang 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/gps-gis-tracing">基于地理位置开发技术</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/gradle">gradle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/greasy-monkey">油猴插件&amp;编写脚本🐒</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/groovy-note">groovy note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/health">Health 关爱程序员健康🏥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/how-to-test-java-app">How to Test Java App</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/html-note">HTML 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/idea-note">InteliJ idea tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/interview-system-design">经典的系统设计思路</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/iot">Iot 物联网</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/java-code-clean">Java Clean Code Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/java-concurrent">Java Concurrent🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/java-memory-model-jmm-jvm">JMM and GC🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/java-note">Java Core 笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/jquery-note">JQuery notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/js-tutorial">JavaScript tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/kotlin">kotlin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/kubernetes-k8s">kubernetes-k8s ☁️</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/linux-note">鸟哥的 Linux 私房菜阅读笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/mac">Mac 开发环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/machine-learning-ml">machine-learning-ml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/maven-note">Maven Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/message-queue">Message Queue🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/money">Investment Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/mongodb-note">MongoDB Notes🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/monitor-system-grafana-prometheus-influxdb-hbase">monitor-system-grafana-prometheus监控🖥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/mvc-mvvm">MVC to MVVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/mybatis-note">MyBatis Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/netty-note">netty</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/nlp-natural-language-processing">nlp-natural-language-processing👄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/nodejs-yarn-npm">Nodejs, Yarn, Npm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/oracle">Oracle 备忘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-audio-video">Audio and Video development Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-big-data-introduce">大数据开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-cache">Cache 缓存🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-computational-ad">计算广告 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-crawler-spider">网络爬虫 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-db-design-note">关系型数据库表设计🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-desktop-develop">桌面应用开发 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-http">HTTP protocol Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-reactive-programming">响应式编程 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-rest-api">RESTful api 及 其他webService技术</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-rpc">RPC Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/outline-about-rule-engine-note">规则引擎 Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/php-note">PHP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/play-framework">Play框架</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/postgres-note">Postgres note🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/process-workflow-bpm-engine">工作流引擎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/protect-your-app-authentication-oauth2-jwt-https">Protect Your App 安全保护认证鉴权🔑</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/python-note">Python🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/quant-money">量化交易</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/quarkus">Quarkus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/react-note">React🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/real-time-communication-protocol">实时通信 Real-time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/redis-note">Redis🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/regex">Regular Expression 正则🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/rust-note">Rust 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/saas-paas-iaas-as-a-service">SaaS Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/serverless">Serverless</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/service-mesh">service mesh 服务网格</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/servlet">Servlet Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/shell-bash-note">shell-bash脚本收集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/spring-note">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/springcloud-note">Spring Cloud 笔记🌈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/springmvc-note">Spring MVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/task-schedule-note">Task Schedule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/tcp-ip-note">TCP IP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/tomcat-jetty-nginx">Tomcat Jetty Nginx 等 web 容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/vertx">Vertx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/video-creator">拍摄</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/webassembly">webassembly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/webpack-esbuild-vite-rollup">前端打包构建工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/windows-sub-system-on-linux">WSL 使用</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Spring Boot 备忘</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Spring Boot 备忘</h1></header><div align="center"><p><a href="https://github.com/YunaiV/SpringBoot-Labs" target="_blank" rel="noopener noreferrer">https://github.com/YunaiV/SpringBoot-Labs</a></p><p>记录springboot学习中的问题, 总结;
<a href="https://github.com/h2pl" target="_blank" rel="noopener noreferrer">https://github.com/h2pl</a> web 项目
<a href="https://github.com/dreamhead/moco" target="_blank" rel="noopener noreferrer">https://github.com/dreamhead/moco</a> mock 框架</p><p><a href="https://github.com/cloudfavorites/favorites-web" target="_blank" rel="noopener noreferrer">https://github.com/cloudfavorites/favorites-web</a> 单体应用实例 hibernate jpa</p><p><a href="https://github.com/xkcoding/spring-boot-demo" target="_blank" rel="noopener noreferrer">https://github.com/xkcoding/spring-boot-demo</a> springboot demos</p></div><ul><li><a href="#1-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">1. 常用命令</a></li><li><a href="#2-%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC">2. 部署脚本</a></li><li><a href="#3-%E5%B7%A5%E5%85%B7%E7%B1%BB">3. 工具类</a><ul><li><a href="#31-bean-%E5%A4%8D%E5%88%B6-%E5%85%8B%E9%9A%86">3.1. bean 复制 克隆</a></li><li><a href="#32-%E5%AD%97%E7%AC%A6%E4%B8%B2">3.2. 字符串</a></li><li><a href="#33-%E7%BC%96%E8%A7%A3%E7%A0%81">3.3. 编解码</a></li><li><a href="#34-commons-lang3">3.4. commons-lang3</a></li><li><a href="#35-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C">3.5. 文件操作</a></li><li><a href="#36-commons-collections4">3.6. commons-collections4</a></li></ul></li><li><a href="#4-%E5%92%8C-react-%E4%B8%80%E8%B5%B7%E6%89%93%E5%8C%85">4. 和 react 一起打包</a></li><li><a href="#5-spring-boot%E4%B8%AD%E7%9A%84%E6%B3%A8%E8%A7%A3">5. Spring Boot中的注解</a><ul><li><a href="#51-configurationproperties-%E5%92%8C-value">5.1. @ConfigurationProperties 和 @Value</a></li><li><a href="#52-enableconfigurationproperties">5.2. @EnableConfigurationProperties</a></li><li><a href="#53-enableautoconfiguration">5.3. @EnableAutoConfiguration</a></li><li><a href="#54-componentscan">5.4. @ComponentScan</a></li><li><a href="#55-springbootapplication">5.5. @SpringBootApplication</a></li><li><a href="#56-component%E5%92%8Cbean%E5%92%8Cconfigration%E5%8C%BA%E5%88%AB">5.6. @Component和@Bean和@Configration区别</a></li><li><a href="#57-import%E5%92%8Cimportresource%E5%92%8Cpropertysource%E6%AF%94%E8%BE%83">5.7. @Import和@ImportResource和@PropertySource比较</a></li></ul></li><li><a href="#6-context-%E4%B8%8A%E4%B8%8B%E6%96%87-%E6%89%8B%E5%8A%A8%E6%B3%A8%E5%86%8Cbean">6. context 上下文 手动注册bean</a></li><li><a href="#7-%E5%AE%9E%E7%8E%B0%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8">7. 实现事件驱动</a></li><li><a href="#8-%E4%BC%98%E9%9B%85%E5%81%9C%E6%9C%BA-%E5%85%B3%E6%9C%BA">8. 优雅停机 关机</a></li><li><a href="#9-%E9%9D%99%E6%80%81%E6%B3%A8%E5%85%A5">9. 静态注入</a><ul><li><a href="#91-set%E6%B3%A8%E5%85%A5">9.1. set注入</a></li><li><a href="#92-postconstruct-%E6%B3%A8%E5%85%A5">9.2. @PostConstruct 注入</a></li><li><a href="#93-%E9%80%9A%E8%BF%87-applicationcontext">9.3. 通过 ApplicationContext</a></li></ul></li><li><a href="#10-%E4%BD%BF%E7%94%A8starter">10. 使用starter</a><ul><li><a href="#101-%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8Bor%E5%8E%9F%E7%90%86">10.1. 加载过程or原理</a></li><li><a href="#102-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%B1%BB%E4%BC%9A%E7%94%A8%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B3%A8%E8%A7%A3">10.2. 自动配置类会用到的一些注解</a></li><li><a href="#103-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%B1%BB%E7%9A%84%E5%AE%9E%E4%BE%8B">10.3. 自动配置类的实例</a><ul><li><a href="#1031-spring-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">10.3.1. spring 动态代理</a></li></ul></li><li><a href="#104-conditional">10.4. @Conditional</a></li><li><a href="#105-%E5%B0%81%E8%A3%85%E7%BB%84%E5%90%88%E6%9D%A1%E4%BB%B6">10.5. 封装组合条件</a></li><li><a href="#106-%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84-starter">10.6. 创建自己的 starter</a></li><li><a href="#107-%E5%8F%8D%E7%88%AC%E8%99%AB-starter">10.7. 反爬虫 starter</a></li></ul></li><li><a href="#11-%E7%9B%91%E6%8E%A7-and-%E5%AE%89%E5%85%A8">11. 监控 and 安全</a><ul><li><a href="#111-spring-boot-actuator-%E7%9B%91%E6%8E%A7">11.1. spring-boot-actuator 监控</a></li><li><a href="#112-spring-boot-admin-%E7%9B%91%E6%8E%A7%E7%95%8C%E9%9D%A2">11.2. spring boot admin 监控界面</a></li><li><a href="#113-spring-boot-starter-security">11.3. spring-boot-starter-security</a><ul><li><a href="#1131-security%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D">11.3.1. security组件介绍</a></li><li><a href="#1132-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8-%E5%92%8C-%E9%85%8D%E7%BD%AE%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81">11.3.2. 基本使用 和 配置用户名密码</a></li><li><a href="#1133-%E7%A6%81%E7%94%A8%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81">11.3.3. 禁用基本认证</a></li><li><a href="#1134-%E9%85%8D%E7%BD%AE%E4%B8%AD-websecurity-%E5%92%8C-httpsecurity-%E5%8C%BA%E5%88%AB">11.3.4. 配置中 WebSecurity 和 HttpSecurity 区别</a></li><li><a href="#1135-%E9%85%8D%E7%BD%AE%E8%B7%A8%E5%9F%9F">11.3.5. 配置跨域</a></li></ul></li><li><a href="#114-oauth2">11.4. oauth2</a></li></ul></li><li><a href="#12-%E6%97%A5%E5%BF%97">12. 日志</a><ul><li><a href="#121-log4j2-marker-%E5%86%99%E5%85%A5%E5%88%B0%E6%8C%87%E5%AE%9A%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6">12.1. Log4j2-Marker 写入到指定日志文件</a></li><li><a href="#122-logback">12.2. logback</a></li></ul></li><li><a href="#13-%E6%95%B0%E6%8D%AE%E5%B1%82">13. 数据层</a><ul><li><a href="#131-canal-%E8%AE%A2%E9%98%85">13.1. canal 订阅</a></li><li><a href="#132-mybatis-%E8%87%AA%E5%8A%A8%E5%BB%BA%E8%A1%A8%E6%8F%92%E4%BB%B6">13.2. mybatis 自动建表插件</a></li><li><a href="#133-mybatis-crud-%E5%A2%9E%E5%BC%BA%E6%8F%92%E4%BB%B6">13.3. mybatis crud 增强插件</a></li><li><a href="#134-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6">13.4. 数据库迁移版本控制</a><ul><li><a href="#1341-liquibase">13.4.1. liquibase</a></li><li><a href="#1342-flyway">13.4.2. Flyway</a></li></ul></li><li><a href="#135-%E6%95%B0%E6%8D%AE%E5%BA%93-url-%E5%92%8C%E9%A9%B1%E5%8A%A8">13.5. 数据库 url 和驱动</a></li><li><a href="#136-graphql%E9%9B%86%E6%88%90">13.6. graphql集成</a></li><li><a href="#137-%E5%90%AF%E5%8A%A8%E6%89%A7%E8%A1%8C-sql">13.7. 启动执行 SQL</a><ul><li><a href="#1371-sql-%E5%88%86%E9%9A%94%E7%AC%A6%E7%9A%84%E5%9D%91">13.7.1. SQL 分隔符的坑</a></li><li><a href="#1372-spring-datasource-%E8%87%AA%E5%B8%A6">13.7.2. spring datasource 自带</a></li><li><a href="#1373-%E4%BD%BF%E7%94%A8-jpa">13.7.3. 使用 jpa</a><ul><li><a href="#13731-springboot-%E6%8E%A5%E5%85%A5-jpa">13.7.3.1. springboot 接入 jpa</a></li><li><a href="#13732-jpa-querydsl-%E5%A4%9A%E8%A1%A8%E8%81%94%E6%9F%A5">13.7.3.2. jpa queryDsl 多表联查</a></li><li><a href="#13733-jpa-%E6%94%AF%E6%8C%81-java8-time">13.7.3.3. jpa 支持 java8 time</a></li></ul></li><li><a href="#1374-datasourceinitializer">13.7.4. DataSourceInitializer</a></li><li><a href="#1375-maven-antrun-pluginn">13.7.5. maven-antrun-pluginn</a></li></ul></li><li><a href="#138-%E6%95%B4%E5%90%88-spring-jdbc">13.8. 整合 spring jdbc</a></li><li><a href="#139-%E6%95%B4%E5%90%88-hibernate">13.9. 整合 hibernate</a><ul><li><a href="#1391-jpa%E6%B3%A8%E8%A7%A3%E6%80%BB%E7%BB%93">13.9.1. jpa注解总结</a></li><li><a href="#1392-%E5%AE%A1%E8%AE%A1-createddate">13.9.2. 审计 createdDate</a></li><li><a href="#1393-%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%94%9F-sql">13.9.3. 执行原生 SQL</a></li><li><a href="#1394-%E5%8A%A8%E6%80%81-sql">13.9.4. 动态 SQL</a></li><li><a href="#1395-spring-data-rest-%E9%85%8D%E5%90%88-spring-data-jpa">13.9.5. spring-data-rest 配合 spring-data-jpa</a></li></ul></li><li><a href="#1310-%E6%95%B4%E5%90%88-mybatis-plus">13.10. 整合 mybatis-plus</a></li><li><a href="#1311-%E6%95%B4%E5%90%88-mybatis">13.11. 整合 mybatis</a><ul><li><a href="#13111-%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE">13.11.1. 基本配置</a></li><li><a href="#13112-%E4%BD%BF%E7%94%A8-%E6%8B%A6%E6%88%AA%E5%99%A8-interceptor-plugins">13.11.2. 使用 拦截器 interceptor plugins</a><ul><li><a href="#131121-principle-of-plugins">13.11.2.1. principle of plugins</a></li><li><a href="#131122-use-scenarios">13.11.2.2. use scenarios</a></li><li><a href="#131123-how-to-use-plugins">13.11.2.3. how to use plugins</a></li></ul></li><li><a href="#13113-typehandler">13.11.3. typehandler</a></li><li><a href="#13114-%E5%85%A8%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91">13.11.4. 全注解开发</a></li><li><a href="#13115-%E5%8A%A8%E6%80%81%E5%AE%9A%E6%97%B6%E5%88%B7%E6%96%B0-sql-mapper-%E5%AE%9E%E7%8E%B0%E7%83%AD%E5%8A%A0%E8%BD%BD">13.11.5. 动态定时刷新 SQL mapper 实现热加载</a></li><li><a href="#13116-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E6%89%93%E5%8C%85%E7%9B%AE%E5%BD%95-and-%E5%BC%80%E5%90%AF%E5%8D%A0%E4%BD%8D%E7%AC%A6%E8%BF%87%E6%BB%A4">13.11.6. 自定义资源文件打包目录 and 开启占位符过滤</a></li></ul></li><li><a href="#1312-springboot-%E4%BA%8B%E5%8A%A1">13.12. springboot 事务</a><ul><li><a href="#13121-%E4%BA%8B%E5%8A%A1%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">13.12.1. 事务基本使用</a></li><li><a href="#13122-spring-%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E5%A4%B1%E6%95%88%E7%9A%84%E5%9D%91">13.12.2. spring 事务传播失效的坑</a></li><li><a href="#13123-transactional-%E6%B3%A8%E8%A7%A3">13.12.3. Transactional 注解</a></li></ul></li><li><a href="#1313-%E7%BC%93%E5%AD%98">13.13. 缓存</a><ul><li><a href="#13131-springboot-starter-cache">13.13.1. springboot-starter-cache</a></li><li><a href="#13132-caffeine">13.13.2. caffeine</a></li></ul></li><li><a href="#1314-%E9%85%8D%E5%90%88-h2-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9B%E8%A1%8C%E5%BC%80%E5%8F%91">13.14. 配合 h2 数据库进行开发</a><ul><li><a href="#13141-h2-%E5%92%8C-spring-data-jpa-%E9%85%8D%E5%90%88">13.14.1. h2 和 spring data jpa 配合</a></li><li><a href="#13142-%E5%92%8C-mybatis-plus-%E9%85%8D%E5%90%88">13.14.2. 和 mybatis-plus 配合</a></li></ul></li><li><a href="#1315-%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90">13.15. 多数据源</a><ul><li><a href="#13151-%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE-%E5%85%A8%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91">13.15.1. 基本配置 全注解开发</a></li><li><a href="#13152-abstractroutingdatasource-%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE%E6%BA%90%E5%88%87%E6%8D%A2">13.15.2. AbstractRoutingDataSource 动态数据源切换</a></li></ul></li><li><a href="#1316-%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B-databaseidprovider">13.16. 多数据库类型 databaseIdProvider</a></li><li><a href="#1317-spring-kafka">13.17. spring kafka</a></li></ul></li><li><a href="#14-web-%E7%9B%B8%E5%85%B3">14. web 相关</a><ul><li><a href="#141-%E5%8A%A0%E8%A7%A3%E5%AF%86">14.1. 加解密</a></li><li><a href="#142-springboot-%E5%8F%91%E9%80%81-https-%E6%88%96%E8%80%85-http-%E5%AE%A2%E6%88%B7%E7%AB%AF-client">14.2. springboot 发送 https 或者 http 客户端 client</a><ul><li><a href="#1421-%E5%8F%91%E9%80%81-http-client">14.2.1. 发送 http client</a></li><li><a href="#1422-%E5%8F%91%E9%80%81-https-client">14.2.2. 发送 https client</a></li></ul></li><li><a href="#143-requestcontextholder">14.3. RequestContextHolder</a></li><li><a href="#144-%E8%A7%A3%E5%86%B3-api-%E7%89%88%E6%9C%AC%E5%85%B1%E5%AD%98">14.4. 解决 api 版本共存</a><ul><li><a href="#1441-requestmappinghandlermapping">14.4.1. RequestMappingHandlerMapping</a></li><li><a href="#1442-request-matcher">14.4.2. request matcher</a></li><li><a href="#1443-request-condition">14.4.3. request condition</a></li></ul></li><li><a href="#145-%E6%8E%A5%E6%94%B6%E5%8F%82%E6%95%B0%E7%9B%B8%E5%85%B3%E7%9A%84%E6%B3%A8%E8%A7%A3">14.5. 接收参数相关的注解</a></li><li><a href="#146-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A5%E6%94%B6%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B">14.6. 自定义接收参数类型</a></li><li><a href="#147-%E8%BF%94%E5%9B%9E%E5%9B%BE%E7%89%87">14.7. 返回图片</a></li><li><a href="#148-rest-api-%E6%96%87%E6%A1%A3">14.8. rest api 文档</a><ul><li><a href="#1481-knife4j">14.8.1. knife4j</a></li><li><a href="#1482-springdoc-openapi">14.8.2. springdoc-openapi</a></li><li><a href="#1483-swagger3">14.8.3. swagger3</a></li><li><a href="#1484-%E9%9B%86%E6%88%90swagger2">14.8.4. 集成swagger2</a></li></ul></li><li><a href="#149-%E8%BF%87%E6%BB%A4%E5%99%A8-%E5%92%8C-%E6%8B%A6%E6%88%AA%E5%99%A8">14.9. 过滤器 和 拦截器</a><ul><li><a href="#1491-%E5%8C%BA%E5%88%AB">14.9.1. 区别</a></li><li><a href="#1492-%E4%BD%BF%E7%94%A8-filter">14.9.2. 使用 filter</a></li><li><a href="#1493-%E4%BD%BF%E7%94%A8-interceptor">14.9.3. 使用 interceptor</a><ul><li><a href="#14931-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%8B%A6%E6%88%AA%E5%99%A8">14.9.3.1. 基本使用拦截器</a></li><li><a href="#14932-%E5%9F%BA%E4%BA%8E-url-%E6%8B%A6%E6%88%AA">14.9.3.2. 基于 url 拦截</a></li><li><a href="#14933-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E6%8B%A6%E6%88%AA">14.9.3.3. 基于注解拦截</a></li></ul></li></ul></li><li><a href="#1410-servlet-druid-%E7%9B%91%E6%8E%A7">14.10. servlet Druid 监控</a></li><li><a href="#1411-aop-%E6%95%B4%E5%90%88%E4%BD%BF%E7%94%A8">14.11. aop 整合使用</a><ul><li><a href="#14111-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">14.11.1. 基本使用</a></li><li><a href="#14112-%E5%88%87%E5%85%A5%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F">14.11.2. 切入点表达式</a></li></ul></li><li><a href="#1412-controlleradvice-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">14.12. @controllerAdvice 异常处理</a></li><li><a href="#1413-httpservletrequest-%E7%9A%84%E8%BE%93%E5%85%A5%E6%B5%81%E5%8F%AA%E8%83%BD%E8%AF%BB%E5%8F%96%E4%B8%80%E6%AC%A1%E7%9A%84%E9%97%AE%E9%A2%98">14.13. HttpServletRequest 的输入流只能读取一次的问题</a></li><li><a href="#1414-%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86">14.14. 路由处理</a><ul><li><a href="#14141-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84-%E6%9A%B4%E9%9C%B2%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90">14.14.1. 静态资源映射 暴露静态资源</a></li><li><a href="#14142-%E6%B7%BB%E5%8A%A0-view-controller">14.14.2. 添加 view controller</a></li></ul></li><li><a href="#1415-spring-boot-starter-thymeleaf">14.15. spring-boot-starter-thymeleaf</a></li></ul></li><li><a href="#15-%E8%BF%90%E7%BB%B4%E9%83%A8%E7%BD%B2">15. 运维部署</a><ul><li><a href="#151-%E6%94%AF%E6%8C%81-https-ssl">15.1. 支持 https ssl</a><ul><li><a href="#1511-nginx-%E9%85%8D%E7%BD%AE-https">15.1.1. nginx 配置 https</a></li><li><a href="#1512-%E6%94%AF%E6%8C%81-https-%E8%AE%BF%E9%97%AE">15.1.2. 支持 https 访问</a></li><li><a href="#1513-http-%E8%AF%B7%E6%B1%82%E8%87%AA%E5%8A%A8%E8%BD%AC%E4%B8%BA-https">15.1.3. http 请求自动转为 https</a></li><li><a href="#1514-%E5%90%8C%E6%97%B6%E6%94%AF%E6%8C%81-http-https">15.1.4. 同时支持 http https</a></li></ul></li><li><a href="#152-%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2">15.2. 容器化部署</a></li><li><a href="#153-nginx-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">15.3. nginx 反向代理</a></li><li><a href="#154-%E5%86%85%E5%B5%8C-tomcat-%E8%B0%83%E4%BC%98">15.4. 内嵌 tomcat 调优</a></li><li><a href="#155-%E9%85%8D%E7%BD%AE-war-%E5%8C%85%E9%83%A8%E7%BD%B2%E5%88%B0-tomcat">15.5. 配置 war 包部署到 Tomcat</a></li></ul></li><li><a href="#16-spring-boot-%E4%B8%AD%E7%9A%84%E5%B9%B6%E5%8F%91">16. spring boot 中的并发</a><ul><li><a href="#161-%E4%BD%BF%E7%94%A8%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B">16.1. 使用异步编程</a><ul><li><a href="#1611-%E9%85%8D%E7%BD%AE%E7%BA%BF%E7%A8%8B%E6%B1%A0">16.1.1. 配置线程池</a></li><li><a href="#1612-%E6%9C%89%E8%BF%94%E5%9B%9E%E5%80%BC-%E6%B2%A1%E6%9C%89%E8%BF%94%E5%9B%9E%E5%80%BC">16.1.2. 有返回值 没有返回值</a></li><li><a href="#1613-async%E5%A4%B1%E6%95%88">16.1.3. @Async失效</a></li></ul></li></ul></li><li><a href="#17-%E5%AE%9E%E7%8E%B0%E4%B9%90%E8%A7%82%E9%94%81%E6%82%B2%E8%A7%82%E9%94%81">17. 实现乐观锁悲观锁</a></li><li><a href="#18-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81">18. 移动端消息推送</a></li><li><a href="#19-%E5%8D%B3%E6%97%B6%E9%80%9A%E4%BF%A1-im%E7%B3%BB%E7%BB%9F">19. 即时通信 IM系统</a></li><li><a href="#20-%E8%BE%85%E5%8A%A9%E5%B7%A5%E5%85%B7">20. 辅助工具</a><ul><li><a href="#201-lombok-notice">20.1. lombok notice</a></li><li><a href="#202-devtools">20.2. devtools</a></li><li><a href="#203-maven-wrapper">20.3. maven wrapper</a></li></ul></li><li><a href="#21-%E6%A0%A1%E9%AA%8C">21. 校验</a><ul><li><a href="#211-%E6%A0%A1%E9%AA%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">21.1. 校验配置文件</a></li><li><a href="#212-%E6%A0%A1%E9%AA%8C%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0">21.2. 校验请求参数</a></li><li><a href="#213-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C">21.3. 自定义校验</a></li><li><a href="#214-validated%E5%92%8Cvalid">21.4. @Validated和@Valid</a></li></ul></li><li><a href="#22-runner-%E8%8E%B7%E5%8F%96%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0">22. runner 获取命令行参数</a><ul><li><a href="#221-%E8%8E%B7%E5%8F%96%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0">22.1. 获取命令行参数</a></li><li><a href="#222-applicationrunner-or-commandlinerunner">22.2. <code>ApplicationRunner</code> or <code>CommandLineRunner</code></a></li></ul></li><li><a href="#23-%E5%BC%80%E5%8F%91%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%BA%94%E7%94%A8">23. 开发命令行应用</a></li><li><a href="#24-%E6%95%B4%E5%90%88-grpc">24. 整合 grpc</a></li><li><a href="#25-%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6">25. 任务调度</a><ul><li><a href="#251-%E6%95%B4%E5%90%88-xxl-job-%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E5%B9%B3%E5%8F%B0">25.1. 整合 XXL-JOB 任务调度平台</a></li><li><a href="#252-%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1">25.2. 异步任务</a></li><li><a href="#253-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1">25.3. 定时任务</a><ul><li><a href="#2531-springboot-%E5%86%85%E7%BD%AE">25.3.1. springboot 内置</a></li><li><a href="#2532-%E9%9B%86%E6%88%90-quartz">25.3.2. 集成 Quartz</a></li></ul></li></ul></li><li><a href="#26-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-and-%E7%8E%AF%E5%A2%83">26. 配置文件 and 环境</a><ul><li><a href="#261-%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">26.1. 读取配置文件</a><ul><li><a href="#2611-%E5%87%A0%E7%A7%8D%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E6%96%B9%E6%B3%95">26.1.1. 几种读取配置文件的方法</a></li><li><a href="#2612-%E6%B3%A8%E5%85%A5%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B">26.1.2. 注入复杂类型</a></li></ul></li><li><a href="#262-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BC%98%E5%85%88%E7%BA%A7">26.2. 配置文件优先级</a></li><li><a href="#263-%E8%AF%BB%E5%8F%96%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF">26.3. 读取环境信息</a></li><li><a href="#264-%E4%B8%A4%E7%A7%8D%E5%BC%95%E5%85%A5-springboot-%E6%96%B9%E5%BC%8F">26.4. 两种引入 springboot 方式</a></li></ul></li><li><a href="#27-%E5%BA%8F%E5%88%97%E5%8C%96-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">27. 序列化 反序列化</a><ul><li><a href="#271-%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4-json">27.1. 日期时间 json</a></li><li><a href="#272-jackson-%E4%BD%BF%E7%94%A8">27.2. jackson 使用</a><ul><li><a href="#2721-jsoncomponent">27.2.1. @JsonComponent</a></li><li><a href="#2722-jackson-%E5%9C%A8-springboot-%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE">27.2.2. Jackson 在 springboot 中的配置</a></li><li><a href="#2723-jackson%E6%B3%A8%E8%A7%A3">27.2.3. jackson注解</a></li><li><a href="#2724-objectmapper-%E5%AE%9A%E5%88%B6">27.2.4. objectmapper 定制</a></li><li><a href="#2725-objectmapper-%E4%BD%BF%E7%94%A8">27.2.5. objectmapper 使用</a></li></ul></li></ul></li><li><a href="#28-%E6%8E%A5%E5%85%A5%E7%AC%AC%E4%B8%89%E6%96%B9%E6%94%AF%E4%BB%98">28. 接入第三方支付</a></li><li><a href="#29-%E6%8B%BE%E9%81%97">29. 拾遗</a><ul><li><a href="#291-bean-%E6%87%92%E5%8A%A0%E8%BD%BD">29.1. bean 懒加载</a></li></ul></li></ul><h1>1. 常用命令</h1><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">du -sh *.jar # jar size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 打包时没有指定主类，执行可以用java -cp {xxx.jar} {主类名称（绝对路径）}。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># -cp 指定类运行所依赖其他类的路径，通常是类库和jar包, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 等价 -classpath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 多个jar包之间连接符：window上分号“;”.Linux下使用“:”</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># win</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -cp .;d:\work\other.jar;d:\work\my.jar packname.mainclassname </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -cp .:/hone/myuser/work/other.jar:/hone/myuser/work/my.jar packname.mainclassname </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 表达式支持通配符</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -cp .;c:\work\my.jar;c:\work\*.jar packname.mainclassname </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 打包时指定了主类，执行可以直接用java -jar {xxx.jar}。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 会用到目录META-INF\MANIFEST.MF文件，在该文件中，有一个叫Main－Class的参数，它说明了java -jar命令执行的类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># java -jar方式不可以指定附加依赖jar包。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -jar *.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 依赖多个 jar 不使用通配符也可以这样执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># -D 设置系统属性, 通过System.getProperty(&quot;conf1&quot;);获得这个值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -Djava.ext.dirs=lib MyClass </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 跳过测试</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># -D 表示 maven 中的 properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mvn -Dmaven.test.skip=true clean package # skip unit test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mvn -DskipTests clean package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mvn clean package -Pxxx # 指定要激活 maven profile 的 id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -Dserver.port=8010 -jar xxx.jar # specific server port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -jar *.jar --server.port=8010 # 同上</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指定 profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -jar *.jar --spring.properties.active=dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -jar -Dspring.profiles.active=dev demo-0.0.1-SNAPSHOT.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mvn spring-boot:run -Drun.profiles=dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>2. 部署脚本</h1><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#本脚本基本无需改动，注意要点均已用中文说明</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 请将本脚本放到Linux系统的path路径下，最好是/bin目录下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 请给本脚本设备可执行权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 启动示例         springboot-starter xxx.jar start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. 重启示例         springboot-starter xxx.jar restart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 5. 停止示例         springboot-starter xxx.jar stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 6. 查看状态示例     springboot-starter xxx.jar status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 获取 java 命令的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JAVA_CMD=`which java`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ -z &quot;${JAVA_CMD}&quot; ];then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;Please install the Java environment&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  exit 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 输出本命令的使用方法 并退出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">usage() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Usage: springboot-starter [app_name].jar [start|stop|restart|status]&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 判断是否输入了两个参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ $# -lt 2 ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 脚本名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APP_NAME=$1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 操作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OPERATION=$2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 运行模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MODEL=$3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ -z &quot;$MODEL&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MODEL=&quot;production&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 其它参数处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OTHER_ARGS=&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ $# -gt 3 ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shift 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shift $#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for ARG in $*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  OTHER_ARGS=&quot;$OTHER_ARGS $ARG&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 脚本所在目录，绝对路径表示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BASE_PATH=$(cd `dirname $APP_NAME`;pwd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 去掉所有目录后的脚本名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APP_NAME=${APP_NAME##*/}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 脚本的路径，绝对路径表示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APP_PATH=$BASE_PATH&quot;/&quot;$APP_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 判断目标程序是否已经启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">is_running(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ## 尝试获取已经运行程序的PID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PID=`ps -ef|grep ${APP_PATH}|grep -v grep|awk &#x27;{print $2}&#x27;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if [ -z &quot;${PID}&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 启动程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  is_running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if [ $? -eq &quot;1&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;${APP_NAME} is already running. pid is ${PID} .&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ## 启动 jar 包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;${APP_NAME} starting ...... &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nohup ${JAVA_CMD} -jar ${OTHER_ARGS} -Dspring.profiles.active=${MODEL} ${APP_PATH} &gt; /dev/null 2&gt;&amp;1 &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;nohup ${JAVA_CMD} -jar ${OTHER_ARGS} -Dspring.profiles.active=${MODEL} ${APP_PATH} &gt; /dev/null 2&gt;&amp;1 &amp;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sleep 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;${APP_NAME} started  completed &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 停止程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stop(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  is_running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if [ $? -eq &quot;1&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;PID is ${PID}, ${APP_NAME} stopping ...... &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kill ${PID}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if [ $? -ne &quot;0&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        echo &quot;kill ${PID} failed，execute kill -9 ${PID}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kill -9 ${PID}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sleep 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;${APP_NAME} stopped completed &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;${APP_NAME} is not running&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 输出程序运行状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">status(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  is_running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if [ $? -eq &quot;1&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;${APP_NAME} is running. pid is ${PID}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;${APP_NAME} is NOT running.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 重启程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">restart(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case &quot;$OPERATION&quot; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;start&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;stop&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stop ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;status&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;restart&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    restart ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  *)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    usage ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">esac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>3. 工具类</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="31-bean-复制-克隆">3.1. bean 复制 克隆<a href="#31-bean-复制-克隆" class="hash-link" aria-label="Direct link to 3.1. bean 复制 克隆" title="Direct link to 3.1. bean 复制 克隆">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">beancopier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://github.com/mapstruct/mapstruct</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="32-字符串">3.2. 字符串<a href="#32-字符串" class="hash-link" aria-label="Direct link to 3.2. 字符串" title="Direct link to 3.2. 字符串">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// &gt;&gt;&gt; springboot 自带</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RandomStringUtils 生成随机字符串, 随机数字</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">StringUtils.isEmpty() 并非严格的空</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="33-编解码">3.3. 编解码<a href="#33-编解码" class="hash-link" aria-label="Direct link to 3.3. 编解码" title="Direct link to 3.3. 编解码">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// &gt;&gt;&gt; springboot 自带</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static String getMD5(String str) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String base = str + &quot;/&quot; + salt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String md5 = DigestUtils.md5DigestAsHex(base.getBytes());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return md5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="34-commons-lang3">3.4. commons-lang3<a href="#34-commons-lang3" class="hash-link" aria-label="Direct link to 3.4. commons-lang3" title="Direct link to 3.4. commons-lang3">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="35-文件操作">3.5. 文件操作<a href="#35-文件操作" class="hash-link" aria-label="Direct link to 3.5. 文件操作" title="Direct link to 3.5. 文件操作">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// springboot 原生 文件下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@GetMapping(&quot;/download&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public ResponseEntity&lt;Resource&gt; download(HttpServletResponse httpServletResponse,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            @RequestParam(&quot;id&quot;) String objId) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final MongoSysFileServiceImpl.DownloadFileVo downloadFileVo = sysFileService.downloadFile(objId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (downloadFileVo == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new RuntimeException(&quot;指定文件不存在, objId = &quot; + objId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ResponseEntity.ok()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .contentType(MediaType.parseMediaType(&quot;application/octet-stream&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .header(HttpHeaders.CONTENT_DISPOSITION, &quot;attachment; filename=\&quot;&quot; + downloadFileVo.getFilename() + &quot;\&quot;&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .body(new InputStreamResource(downloadFileVo.getIs()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//上传</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> @PostMapping(value = &quot;upload&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public R&lt;SysFile&gt; upload(@RequestPart(&quot;file&quot;) MultipartFile file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 上传并返回访问地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final MongoSysFileServiceImpl.UploadFileResp uploadFileResp = sysFileService.uploadFile(file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SysFile sysFile = new SysFile();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sysFile.setObjId(uploadFileResp.getObjId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sysFile.setName(uploadFileResp.getGeneratedName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return R.ok(sysFile);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (Exception e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.error(&quot;上传文件失败&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return R.fail(e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//feign client 远程调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@PostMapping(value = &quot;/upload&quot;, consumes = MediaType.MULTIPART_FORM_DATA_VALUE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public R&lt;SysFile&gt; upload(@RequestPart(value = &quot;file&quot;) MultipartFile file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 传递 文件 , 同时传递请求参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@PostMapping(&quot;/add&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public AjaxResult add( EstimateFile estimateFile, @RequestPart(&quot;files&quot;) MultipartFile[] files)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    { //@RequestPart(&quot;estimateFile&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return toAjax(estimateFileService.insertEstimateFile(estimateFile, files));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="36-commons-collections4">3.6. commons-collections4<a href="#36-commons-collections4" class="hash-link" aria-label="Direct link to 3.6. commons-collections4" title="Direct link to 3.6. commons-collections4">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">isSubCollection(smallColl, bigColl)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * 1、除非元素为null，否则向集合添加元素</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CollectionUtils.addIgnoreNull(personList,null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// &gt;&gt;&gt; 合并</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * 2、将两个已排序的集合a和b合并为一个已排序的列表，以便保留元素的自然顺序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CollectionUtils.collate(Iterable&lt;? extends O&gt; a, Iterable&lt;? extends O&gt; b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * 3、将两个已排序的集合a和b合并到一个已排序的列表中，以便保留根据Comparator c的元素顺序。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CollectionUtils.collate(Iterable&lt;? extends O&gt; a, Iterable&lt;? extends O&gt; b, Comparator&lt;? super O&gt; c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// &gt;&gt;&gt; 判空</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * 5、如果参数是null，则返回不可变的空集合，否则返回参数本身。（很实用 ,最终返回List EMPTY_LIST = new EmptyList&lt;&gt;()）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CollectionUtils.emptyIfNull(Collection&lt;T&gt; collection)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * 6、空安全检查指定的集合是否为空</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CollectionUtils.isEmpty(Collection&lt;?&gt; coll)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * 7、 空安全检查指定的集合是否为空。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CollectionUtils.isNotEmpty(Collection&lt;?&gt; coll)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// &gt;&gt; 判断是否包含 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * 4、返回该个集合中是否含有至少有一个元素</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CollectionUtils.containsAny(Collection&lt;?&gt; coll1, T... coll2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// &gt;&gt;&gt; 翻转</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * 8、反转给定数组的顺序。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CollectionUtils.reverseArray(Object[] array);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * 9、差集   or   chaList.removeAll(listB);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    or          listA.stream().filter(item -&gt; !listB.contains(item)).collect(toList());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CollectionUtils.subtract(Iterable&lt;? extends O&gt; a, Iterable&lt;? extends O&gt; b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * 10、并集    or     先 bingList.removeAll(listB), 再bingList.addAll(listB); ((先做差集再做添加所有）)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CollectionUtils.union(Iterable&lt;? extends O&gt; a, Iterable&lt;? extends O&gt; b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * 11、交集   也可用 jiaoList.retainAll(listB); 返回 Boolean, 会改变原有集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    or          listA.stream().filter(item -&gt; listB.contains(item)).collect(toList())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CollectionUtils.intersection(Collection a, Collection b) // 返回新集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    *12、 交集的补集（析取）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CollectionUtils.disjunction(Collection a, Collection b)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>4. 和 react 一起打包</h1><p><a href="https://github.com/arpan-banerjee7/demo-spring-react-maven-plugin" target="_blank" rel="noopener noreferrer">https://github.com/arpan-banerjee7/demo-spring-react-maven-plugin</a></p><p>TODO</p><h1>5. Spring Boot中的注解</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="51-configurationproperties-和-value">5.1. @ConfigurationProperties 和 @Value<a href="#51-configurationproperties-和-value" class="hash-link" aria-label="Direct link to 5.1. @ConfigurationProperties 和 @Value" title="Direct link to 5.1. @ConfigurationProperties 和 @Value">​</a></h2><p>@Value 是core container的feature。不支持宽松绑定，不支持Meta-data。但支持spELl。
@ConfigurationProperties 则支持宽松绑定，支持Meta-data。但不支持spELl。</p><p>@ConfigurationProperties一般只用来处理环境信息，不用来注入自定义属性（这段不知道翻译得准不准，原文如下：Even if the configuration above will create a regular bean for FooProperties, we recommend that @ConfigurationProperties only deal with the environment and in particular does not inject other beans from the context. Having said that, The @EnableConfigurationProperties annotation is also automatically applied to your project so that any existing bean annotated with @ConfigurationProperties will be configured from the Environment.）   </p><p>配置文件：  </p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">myProps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#自定义的属性和值    </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">simpleProp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> simplePropValue    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">arrayProps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">5</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">listProp1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> abc    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> abcValue    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> efg    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> efgValue    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">listProp2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> config2Value1    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> config2Vavlue2    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mapProps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">key1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> value1    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">key2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> value2  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>创建一个bean来接受信息：(这里不推荐这么用, 应该使用 @value 老老实实属性写全)</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// @Component    // 这个注解可选</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConfigurationProperties(prefix=&quot;myProps&quot;) //接收application.yml中的myProps下面的属性   (prefix 必须, 不可为&quot;&quot;, 需要在配置类中 enable config props class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 此时 idea 提示 spring boot config annotation processor not configured, 是因为他以为你要为配置文件指定自定义属性, 需要生成提示 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 可以https://docs.spring.io/spring-boot/docs/2.3.4.RELEASE/reference/html/appendix-configuration-metadata.html#configuration-metadata-annotation-processor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MyProps {    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String simpleProp;    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String[] arrayProps;    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;Map&lt;String, String&gt;&gt; listProp1 = new ArrayList&lt;&gt;(); //接收prop1里面的属性值    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;String&gt; listProp2 = new ArrayList&lt;&gt;(); //接收prop2里面的属性值    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Map&lt;String, String&gt; mapProps = new HashMap&lt;&gt;(); //接收prop1里面的属性值    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>除了可以使用@ConfigurationProperties注解一个类，还可以在@Bean方法上使用；需要绑定属性到不受你控制的第三方组件时，这种方式非常有用。  </p><p>为了从环境属性配置一个bean，将@ConfigurationProperties添加到它的bean注册过程,任何以foo为前缀的属性定义都会被映射到FooComponent上：  </p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@ConfigurationProperties(prefix = &quot;foo&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public FooComponent fooComponent() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于无法转换的属性, 比如本来是一个 Boolean 类型, 但是配置文件中配置的是 string 类型, ignoreInvalidFields 可以决定是否抛出异常, 默认为 false, 表示要抛出异常</p><p>对于配置文件中多余的属性, ignoreUnknownFields 决定是否抛出异常, 默认 true, 表示不抛出异常</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="52-enableconfigurationproperties">5.2. @EnableConfigurationProperties<a href="#52-enableconfigurationproperties" class="hash-link" aria-label="Direct link to 5.2. @EnableConfigurationProperties" title="Direct link to 5.2. @EnableConfigurationProperties">​</a></h2><p>配置哪些类是用来接受配置文件信息的bean,当@EnableConfigurationProperties注解应用到你的@Configuration时，任何被@ConfigurationProperties注解的beans将自动被Environment属性配置  , configBean 无需 @component</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@EnableConfigurationProperties({LiquibaseProperties.class, ApplicationProperties.class})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当一个 @ConfigurationProperties bean 像如上这样注册，这个bean就有了一个名字，规范是这样：<code>&lt;prefix&gt;-&lt;fqn&gt;</code>, 即：前缀-全限定名，如：  </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">myProps-com.xy.PropertiesBean</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>enableXXX 类注解原理就是 定义一个注解, 在注解上通过 @import 引入一个配置类</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="53-enableautoconfiguration">5.3. @EnableAutoConfiguration<a href="#53-enableautoconfiguration" class="hash-link" aria-label="Direct link to 5.3. @EnableAutoConfiguration" title="Direct link to 5.3. @EnableAutoConfiguration">​</a></h2><p>根据添加的jar依赖猜测你想如何配置Spring，如果发现应用了你不想要的特定自动配置类，你可以使用 @EnableAutoConfiguration 注解的exclude属性来禁用它们  </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@EnableAutoConfiguration(exclude = {MetricFilterAutoConfiguration.class, MetricRepositoryAutoConfiguration.class})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用一般是@EnableAutoConfiguration加到一个主@configration类上，主配置类一般就是app的启动类  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="54-componentscan">5.4. @ComponentScan<a href="#54-componentscan" class="hash-link" aria-label="Direct link to 5.4. @ComponentScan" title="Direct link to 5.4. @ComponentScan">​</a></h2><p>扫描所有Spring组件，通过@autowired注入使用  </p><p>如果使用上面建议的结构组织代码（将应用类放到根包下），你可以添加 @ComponentScan 注解而不需要任何参数。你的所有应用程序组件（ @Component , @Service , @Repository , @Controller 等）将被自动注册为Spring Beans。  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="55-springbootapplication">5.5. @SpringBootApplication<a href="#55-springbootapplication" class="hash-link" aria-label="Direct link to 5.5. @SpringBootApplication" title="Direct link to 5.5. @SpringBootApplication">​</a></h2><p>@SpringBootApplication 注解等价于以默认属性使用 @Configuration ， @EnableAutoConfiguration 和 @ComponentScan   </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="56-component和bean和configration区别">5.6. @Component和@Bean和@Configration区别<a href="#56-component和bean和configration区别" class="hash-link" aria-label="Direct link to 5.6. @Component和@Bean和@Configration区别" title="Direct link to 5.6. @Component和@Bean和@Configration区别">​</a></h2><p>@Configuration 注解本质上还是 @Component, </p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Target({ElementType.TYPE})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Retention(RetentionPolicy.RUNTIME)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Documented</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public @interface Configuration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @AliasFor(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        annotation = Component.class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String value() default &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean proxyBeanMethods() default true;// 默认为 true, config bean 中的方法被 cglib 代理, 表示 在同个 config bean 中嵌套调用方法, 返回的对象默认从 ioc container 中获取, 不会新创建对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>@Configuration一般和@bean合用, @component和@bean不能合用</p><p>Spring Boot提倡基于Java的配置，通常简易启动类作为主配置类，其他配置类通过@import导入到主配置类；@ComponentScan也会扫描配置类  ,如果不得不使用基于xml的配置，仍旧可以从一个@configration类开始，通过@ImportResource 注解加载XML配置文件。  </p><p>@Component被用在要被自动扫描和装配的类上，Spring 注解@Component等效于@Service,@Controller,@Repository；@Bean只能用于方法(方法名作为ioc容器中的bean name)和注解上。用@Configuration注解该类，等价 与XML中配置beans；用@Bean标注方法等价于XML中配置bean。  </p><p>在项目中，本工程的bean注册，使用@Component，通过web service取得的bean，通过@Bean标注在获取方法上注册；</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="57-import和importresource和propertysource比较">5.7. @Import和@ImportResource和@PropertySource比较<a href="#57-import和importresource和propertysource比较" class="hash-link" aria-label="Direct link to 5.7. @Import和@ImportResource和@PropertySource比较" title="Direct link to 5.7. @Import和@ImportResource和@PropertySource比较">​</a></h2><ul><li>前两者都需要和@configuration配合使用(Both @Import @ImportResource work with @Configuration), 表示导入额外的配置<ul><li>@import 导入某个配置类, 这个配置类可以不用标注 @configuration (一般会配合自定义注解使用: 自定义注解上通过 @import 导入多个未标注@configuration 的配置类使得这些配置类生效)</li></ul></li><li>@ImportResource用来引入外置的配置文件, 如@ImportResource({&quot;classpath:datasource.xml&quot;}), 一般用来导入Spring的配置文件，让配置文件里面功能生效</li><li>@Import引入另外的@configuration类</li><li>@PropertySource用于加载另外的属性配置文件, 如@PropertySource(value = {&quot;classpath:person.properties&quot;}), 一般和@ConfigurationProperties(prefix = &quot;person&quot;)一起用
springboot默认只会加载application.properties中的属性,</li></ul><p>例子:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Import(AnotherConfig.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ImportResource(“classpath:/com/acme/properties-config.xml”)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@PropertySource(“classpath:some.properties”)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AppConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// blah…</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>6. context 上下文 手动注册bean</h1><p><a href="https://blog.csdn.net/qq_36628536/article/details/113753368" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/qq_36628536/article/details/113753368</a> 介绍</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// plan 1: (此种方式注册的bean在调用时将由spring进行创建，相当于延迟加载bean)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ApplicationContextUtil implements ApplicationContextAware {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static ApplicationContext applicationContext;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setApplicationContext(ApplicationContext context) throws BeansException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        applicationContext=context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *  动态注入bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param requiredType 注入类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param beanName bean名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static Object registerBean(Class&lt;?&gt; requiredType,String beanName){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //将applicationContext转换为ConfigurableApplicationContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConfigurableApplicationContext configurableApplicationContext = (ConfigurableApplicationContext) applicationContext;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //获取BeanFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DefaultListableBeanFactory defaultListableBeanFactory = (DefaultListableBeanFactory) configurableApplicationContext.getAutowireCapableBeanFactory();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //创建bean信息.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        BeanDefinitionBuilder beanDefinitionBuilder = BeanDefinitionBuilder.genericBeanDefinition(requiredType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //动态注册bean.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        defaultListableBeanFactory.registerBeanDefinition(beanName, beanDefinitionBuilder.getBeanDefinition());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //获取动态注册的bean.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return configurableApplicationContext.getBean(requiredType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">｝</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// plan 2: (此种方式允许手动创建单例bean实例并注册，注意必须是单例的，在spring调用时，会将手动创建的bean直接注入到调用方)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ApplicationContextUtil implements ApplicationContextAware {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static ApplicationContext applicationContext;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setApplicationContext(ApplicationContext context) throws BeansException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        applicationContext=context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *  动态注入单例bean实例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param beanName bean名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param singletonObject 单例bean实例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return 注入实例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static Object registerSingletonBean(String beanName,Object singletonObject){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //将applicationContext转换为ConfigurableApplicationContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConfigurableApplicationContext configurableApplicationContext = (ConfigurableApplicationContext) applicationContext;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //获取BeanFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DefaultListableBeanFactory defaultListableBeanFactory = (DefaultListableBeanFactory) configurableApplicationContext.getAutowireCapableBeanFactory();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //动态注册bean.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        defaultListableBeanFactory.registerSingleton(beanName,singletonObject);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //获取动态注册的bean.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return configurableApplicationContext.getBean(beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">｝</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>7. 实现事件驱动</h1><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ApplicationEvent：表示事件本身，自定义事件需要继承该类，用来定义事件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ApplicationEventPublisher：事件发送器，主要用来发布事件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ApplicationListener：事件监听器接口，监听类实现ApplicationListener 里onApplicationEvent方法即可，也可以在方法上增加@EventListener以实现事件监听。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 默认情况下事件是同步的。即事件被publish后会等待Listener的处理。如果发布事件处的业务存在事务，监听器处理也会在相同的事务中。如果需要异步处理事件，可以onApplicationEvent方法上加@Aync支持异步或在有@EventListener的注解方法上加上@Aync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ProductEvent extends ApplicationEvent {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ProductEvent(Product product) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super(product);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ProductServiceImpl implements IproductService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ApplicationEventPublisher publisher;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Transactional(rollbackFor = Exception.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void saveProduct(Product product) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        productMapper.saveProduct(product); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //事件发布</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        publisher.publishEvent(product);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@AllArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ProductListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final NotifyService notifyServcie;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Async // 需要@EnableAsync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @EventListener(ProductEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void notify(ProductEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Product product = (Product) event.getSource();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        notifyServcie.notify(product, &quot;product&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 等效 @eventListner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class RegisterListener implements ApplicationListener&lt;UserRegisterEvent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 实现监听</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param userRegisterEvent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onApplicationEvent(UserRegisterEvent userRegisterEvent) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //获取注册用户对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UserBean user = userRegisterEvent.getUser();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //../省略逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //输出注册用户信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;注册信息，用户名：&quot;+user.getName()+&quot;，密码：&quot;+user.getPassword());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>8. 优雅停机 关机</h1><p>，1、利用底层JVM Runtime.getRuntime().addShutdownHook() 添加自己的钩子函数。</p><p>2、利用Spring 现有机制，Spring会在关机时发送ContextClosedEvent给到监听器，我们只需要把关闭函数放在监听器里即可。</p><p>优雅关机的过程应该是通知注册中心-&gt;暂停接收新请求-&gt;旧请求执行完毕-&gt;其余的清理动作</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 这里采用方式 2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 监听器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private static class GracefulShutdown implements TomcatConnectorCustomizer,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ApplicationListener&lt;ContextClosedEvent&gt;, Ordered {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Logger log = LoggerFactory.getLogger(GracefulShutdown.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private volatile Connector connector;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 控制GracefulShutdown listener优先级是最高的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int order = Ordered.HIGHEST_PRECEDENCE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void customize(Connector connector) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.connector = connector;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onApplicationEvent(ContextClosedEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.info(&quot;eureka client shutting down&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        eurekaClient.shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.info(&quot;Completed shut down eureka client&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Tomcat暂停接收request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.connector.pause();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.info(&quot;connector pause&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 关闭Tomcat线程池        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Executor executor = this.connector.getProtocolHandler().getExecutor();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (executor instanceof ThreadPoolExecutor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ThreadPoolExecutor threadPoolExecutor = (ThreadPoolExecutor) executor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                threadPoolExecutor.shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.info(&quot;connector executor shutting down&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (!threadPoolExecutor.awaitTermination(10, TimeUnit.SECONDS)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    logger.warn(&quot;Tomcat thread pool did not shut down gracefully within &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            + &quot;10 seconds. Proceeding with forceful shutdown&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.info(&quot;completed shut down connector executor&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            catch (InterruptedException ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Thread.currentThread().interrupt();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int getOrder() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this.order;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// springboot 配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 用于优雅关闭tomcat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public GracefulShutdown gracefulShutdown(EurekaClient eurekaClient) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new GracefulShutdown(eurekaClient);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 用于优雅关闭tomcat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public WebServerFactoryCustomizer tomcatCustomizer(GracefulShutdown gracefulShutdown) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return factory -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (factory instanceof TomcatServletWebServerFactory) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ((TomcatServletWebServerFactory) factory)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .addConnectorCustomizers(gracefulShutdown);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>9. 静态注入</h1><p>为静态属性注入值, 使用通过 XXXClass.xxx 使用</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="91-set注入">9.1. set注入<a href="#91-set注入" class="hash-link" aria-label="Direct link to 9.1. set注入" title="Direct link to 9.1. set注入">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Component(value = &quot;MongoConfig&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConfigurationProperties(prefix = &quot;mongo.config&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MongoConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> private static String chat_username;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> @Value(&quot;${mongo.config.username}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public void setChat_username(String chat_username) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> MongoConfig.chat_username = chat_username;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="92-postconstruct-注入">9.2. @PostConstruct 注入<a href="#92-postconstruct-注入" class="hash-link" aria-label="Direct link to 9.2. @PostConstruct 注入" title="Direct link to 9.2. @PostConstruct 注入">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ADUserUtils {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private  ADConfig adc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private  static ADConfig adc1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostConstruct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void init() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.adc1 = adc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static List&lt;User&gt; getADUsers() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        adc1.readConf();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="93-通过-applicationcontext">9.3. 通过 ApplicationContext<a href="#93-通过-applicationcontext" class="hash-link" aria-label="Direct link to 9.3. 通过 ApplicationContext" title="Direct link to 9.3. 通过 ApplicationContext">​</a></h2><p>得到静态的 context, 然后通过 getBean(xxx.class) ...</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@MapperScan({&quot;io.github.xiaoyureed.mockitomybatisplusdemo.mapper&quot;})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MockitoDemoApplication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static ConfigurableApplicationContext context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context = SpringApplication.run(MockitoDemoApplication.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>10. 使用starter</h1><p>servlet request wrapper</p><p><a href="https://blog.csdn.net/weixin_43935907/article/details/98476935" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/weixin_43935907/article/details/98476935</a>
<a href="https://www.cnblogs.com/JAYIT/p/10943155.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/JAYIT/p/10943155.html</a>
<a href="https://www.cnblogs.com/exmyth/p/10332328.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/exmyth/p/10332328.html</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="101-加载过程or原理">10.1. 加载过程or原理<a href="#101-加载过程or原理" class="hash-link" aria-label="Direct link to 10.1. 加载过程or原理" title="Direct link to 10.1. 加载过程or原理">​</a></h2><p>@SpringBootApplication包含了@EnableAutoConfiguration，这个注解又包含@Import(AutoConfigurationImportSelector.class)。</p><p>spring boot启动时，会调用AutoConfigurationImportSelector的回调函数，让其解析所有包下的&quot;META-INF/spring.factories&quot; (位于项目结构的 <code>resources/META-INF/spring.factories</code> 下), 并把key为&quot;...EnableAutoConfiguration&quot;对应的value里的类都加载为Bean，而那些类基本都是注解了@Configuration的配置类。这便是spring boot能自动配置的原因。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="102-自动配置类会用到的一些注解">10.2. 自动配置类会用到的一些注解<a href="#102-自动配置类会用到的一些注解" class="hash-link" aria-label="Direct link to 10.2. 自动配置类会用到的一些注解" title="Direct link to 10.2. 自动配置类会用到的一些注解">​</a></h2><p><a href="https://my.oschina.net/u/566591/blog/2250290" target="_blank" rel="noopener noreferrer">https://my.oschina.net/u/566591/blog/2250290</a></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration  表明是一个配置类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableAutoConfiguration(exclude = {DataSourceAutoConfiguration.class}) 使用starter的时候排除自动配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnClass  当classpath下发现该类的情况下进行自动配置 (name, value 任选其一)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnMissingClass 没有这个类时应用标注的配置类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionOnMissingBean 在spring容器中没找到 bean 时 (如果不指定, 默认 方法返回值类型/当前类)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnBean  当容器中有指定的Bean的条件下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 默认是检查bean的类型, 看看容器中是否有同类型 bean 存在, 不看 bean name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 开启按照 bean name 检查: 属性 name = {xxx&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># @ConditionalOnBean(name = {&quot;hah&quot;, &quot;hoo&quot;}): &quot;and&quot; 关系, 有 hah, 且有 hoo, return true. 任何一个缺失都return false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># @ConditionalOnMissingBean(name = {&quot;hah&quot;, &quot;hoo&quot;}): &quot;and &quot; 关系, 没hah 且 没 hoo, return true. 任何一个出现, return false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableConfigurationProperties(XxxProperties.class)  使 @ConfigurationProperties(prefix=&quot;aaa.bbb&quot;) 注解生效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnProperty:指定的属性有指定的值时</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ConditionalOnProperty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name/value (value 用于指定某配置一定要出现), havingValue 指定配置文件中的属性, 为 null返回 false, 不匹配返回false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchIfMissing 配置项如果缺失, 是否匹配, 默认 false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 优先级比 onBean, onClass 这些都高</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnProperty(prefix = &quot;spring.aop&quot;, name = &quot;auto&quot;, havingValue = &quot;true&quot;, matchIfMissing = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnSingleCandidate: (和 @ConditionalOnBean 类似)当指定的Bean在容器中只有一个，或者在有多个Bean的情况下，用来指定首选的Bean </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnExpression:基于SpEL表达式作为判断条件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnResource(resources = {&quot;/xxx.yml&quot;}):类路径下是否有指定的资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnJava(javaversion.eight):基于JVM/Java版本作为判断条件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnJndi:在JNDI存在的条件下查找指定的位置, 必须存在一个.否则,返回不匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnNotWebApplication:当前项目不是Web项目的条件下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnWebApplication:当前项目是Web项目的条件下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@AutoConfigureAfter(A.class) 配置类将在 A.class 之后加载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@AutoConfigureBefore   ... 之前加载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@AutoConfigureOrder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="103-自动配置类的实例">10.3. 自动配置类的实例<a href="#103-自动配置类的实例" class="hash-link" aria-label="Direct link to 10.3. 自动配置类的实例" title="Direct link to 10.3. 自动配置类的实例">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1031-spring-动态代理">10.3.1. spring 动态代理<a href="#1031-spring-动态代理" class="hash-link" aria-label="Direct link to 10.3.1. spring 动态代理" title="Direct link to 10.3.1. spring 动态代理">​</a></h3><p><a href="https://lolico.me/2020/05/03/SpringBoot2-AOP-uses-cglib-proxy-by-default/" target="_blank" rel="noopener noreferrer">https://lolico.me/2020/05/03/SpringBoot2-AOP-uses-cglib-proxy-by-default/</a></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//SpringBoot1.5.x中的这个自动配置类会发现默认是使用jdk动态代理，那么为什么在SpringBoot2.x中改为默认使用Cglib了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration(proxyBeanMethods = false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnProperty(prefix = &quot;spring.aop&quot;, name = &quot;auto&quot;, havingValue = &quot;true&quot;, matchIfMissing = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AopAutoConfiguration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Configuration(proxyBeanMethods = false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ConditionalOnClass(Advice.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static class AspectJAutoProxyingConfiguration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Configuration(proxyBeanMethods = false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @EnableAspectJAutoProxy(proxyTargetClass = false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @ConditionalOnProperty(prefix = &quot;spring.aop&quot;, name = &quot;proxy-target-class&quot;, havingValue = &quot;false&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                matchIfMissing = false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        static class jdkDynamicAutoProxyConfiguration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Configuration(proxyBeanMethods = false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @EnableAspectJAutoProxy(proxyTargetClass = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @ConditionalOnProperty(prefix = &quot;spring.aop&quot;, name = &quot;proxy-target-class&quot;, havingValue = &quot;true&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                matchIfMissing = true) // 能够看出AOP默认使用Cglib代理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        static class CglibAutoProxyConfiguration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="104-conditional">10.4. @Conditional<a href="#104-conditional" class="hash-link" aria-label="Direct link to 10.4. @Conditional" title="Direct link to 10.4. @Conditional">​</a></h2><p>自动配置相关注解底层都是通过 @Conditional(OnClassCondition.class) 实现的</p><p>通过它, 可以自己定制条件</p><p><a href="https://my.oschina.net/u/566591/blog/2250290" target="_blank" rel="noopener noreferrer">https://my.oschina.net/u/566591/blog/2250290</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="105-封装组合条件">10.5. 封装组合条件<a href="#105-封装组合条件" class="hash-link" aria-label="Direct link to 10.5. 封装组合条件" title="Direct link to 10.5. 封装组合条件">​</a></h2><p>继承 AllNestedConditions 封装多条件 (and 关系)</p><p>AnyNestedCondition (or 关系)</p><p>NoneNestedConditions (none 关系)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="106-创建自己的-starter">10.6. 创建自己的 starter<a href="#106-创建自己的-starter" class="hash-link" aria-label="Direct link to 10.6. 创建自己的 starter" title="Direct link to 10.6. 创建自己的 starter">​</a></h2><p><a href="https://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/htmlsingle/#boot-features-custom-starter" target="_blank" rel="noopener noreferrer">官方文档</a></p><p><a href="https://github.com/SpringForAll/spring-boot-starter-swagger" target="_blank" rel="noopener noreferrer">spring-boot-swagger 示例</a></p><ul><li><p>创建一个starter 项目</p><p>  命名规则: spring boot 官方 starter 命名为 &quot;spring-boot-starter-xxx&quot;, 自定义的starter 命名 &quot;xxx-spring-boot-starter&quot;;</p><p>  引入 <code>spring-boot-configuration-processor</code> (编译时生成 spring-configuration-metadata.json ，在IDE中编辑配置文件时，会出现提示), 标注为 optional: true 避免依赖传递</p><p>  引入 <code>spring boot starter</code> (相关注解需要), 标注为 optional true,  idea 中 spring boot app 创建时自动导入了</p><p>  继承 <code>spring-boot-starter-parent</code>, <a href="https://stackoverflow.com/questions/21317006/spring-boot-parent-pom-when-you-already-have-a-parent-pom/21318359#21318359" target="_blank" rel="noopener noreferrer">如果想不通过继承方式使用, 可以 dependencyManagement <code>spring boot dependencies</code>, 参考</a></p><p>  如果是生成的 spring boot 项目, 删除 启动类, 然后替换 spring boot maven 插件 为 <code>maven-compile-plugin</code> (因为没有启动类, repackage 会报错), 设置 properties 下 maven.compiler.source, maven.compiler.target, java.version</p></li><li><p>创建一个 @ConfigurationProperties 类用于保存你的配置信息, 在 @EnableConfigurationProperties(...) 类上指定, (或者标注 component 然后配置componentScan 或者直接 @configurationPropertiesScan)</p><p>  （如果你的项目不使用配置信息则可以跳过这一步，不过这种情况非常少见）</p></li><li><p>创建一个AutoConfiguration，引用定义好的配置信息；在AutoConfiguration中实现所有starter应该完成的操作，并且把这个类加入classpath:/META-INF/spring.factories配置文件中进行声明</p><p>  自动配置类不应启用组件扫描以查找其他组件 (即 若生成的是spring boot 骨架, 应去掉启动类)。应该使用 @import 来导入其他配置类</p></li><li><p>打包发布</p><p>  如果 starter 就是本地自己使用, 可以不打包不发布, 直接在另外的项目中引入</p></li></ul><p>spring.factories 示例:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">org.springframework.boot.autoconfigure.EnableAutoConfiguration = \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.mycorp.libx.autoconfigure.LibXAutoConfiguration,\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.mycorp.libx.autoconfigure.LibXWebAutoConfiguration</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="107-反爬虫-starter">10.7. 反爬虫 starter<a href="#107-反爬虫-starter" class="hash-link" aria-label="Direct link to 10.7. 反爬虫 starter" title="Direct link to 10.7. 反爬虫 starter">​</a></h2><p><a href="https://www.cnblogs.com/zouhao/p/12175653.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/zouhao/p/12175653.html</a> </p><p>TODO</p><h1>11. 监控 and 安全</h1><p>密码加密 Argon2</p><p>Spring Vault，它为HashiCorp Vault添加抽象 -&gt; 密码存储</p><p>OWASP ZAP 渗透测试报告</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="111-spring-boot-actuator-监控">11.1. spring-boot-actuator 监控<a href="#111-spring-boot-actuator-监控" class="hash-link" aria-label="Direct link to 11.1. spring-boot-actuator 监控" title="Direct link to 11.1. spring-boot-actuator 监控">​</a></h2><p><a href="https://www.cnblogs.com/zwqh/p/11851300.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/zwqh/p/11851300.html</a>
<a href="https://www.jianshu.com/p/8bfac9289c7e" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/8bfac9289c7e</a></p><p>spring boot 的 sub project, 提供产品级别的监控</p><p>spring cloud 中, refresh 的 post 端点被 actuator 接管, 配置 <code>management.endpoints.web.exposure.include=health,info</code> (默认) 需要添加 &#x27;refresh&#x27;, 最终需要 <code>curl -d{} http://xxx:xxx/actuator/refresh</code></p><p><a href="https://github.com/Netflix/Hystrix/issues/1566" target="_blank" rel="noopener noreferrer">hystrix.stream 也被接管</a>, 配置添加 &#x27;hystrix.stream&#x27;, 监控流为 <code>http://xxx:xxx/actuator/hystrix.stream</code></p><p><a href="https://www.jianshu.com/p/d5943e303a1f" target="_blank" rel="noopener noreferrer">actuator 翻译</a>
<a href="https://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/html/production-ready-features.html#production-ready" target="_blank" rel="noopener noreferrer">actuator 官方文档</a></p><p>自己写监控, 可以:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ConfigurableApplicationContext context = SpringApplication.run(PaymentServiceApp.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConfigurableEnvironment        env     = context.getEnvironment();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 或者 直接 @autowired Environment env</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ui展示: <a href="https://github.com/codecentric/spring-boot-admin" target="_blank" rel="noopener noreferrer">https://github.com/codecentric/spring-boot-admin</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="112-spring-boot-admin-监控界面">11.2. spring boot admin 监控界面<a href="#112-spring-boot-admin-监控界面" class="hash-link" aria-label="Direct link to 11.2. spring boot admin 监控界面" title="Direct link to 11.2. spring boot admin 监控界面">​</a></h2><p><a href="https://www.jianshu.com/p/483adafc6b3a" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/483adafc6b3a</a> //todo</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="113-spring-boot-starter-security">11.3. spring-boot-starter-security<a href="#113-spring-boot-starter-security" class="hash-link" aria-label="Direct link to 11.3. spring-boot-starter-security" title="Direct link to 11.3. spring-boot-starter-security">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1131-security组件介绍">11.3.1. security组件介绍<a href="#1131-security组件介绍" class="hash-link" aria-label="Direct link to 11.3.1. security组件介绍" title="Direct link to 11.3.1. security组件介绍">​</a></h3><p>[ref]<!-- -->](<a href="https://www.cnblogs.com/demingblog/p/10874753.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/demingblog/p/10874753.html</a>)</p><p>spring security 是安全认证框架, 基于 Servlet filter, 核心就是一组过滤器链; 可在 Web 请求级和方法调用级处理身份确认和授权 </p><p>如果是 普通的 spring 项目, 使用 shiro 更简单</p><p>================================= 核心组件</p><p>SecurityContext - 用户 auth 通过后, authentication 信息存储在这里, 可以在任意地方使用 <code>SecurityContextHolder.getContext().set/getAuthentication</code></p><p>SecurityContextHolder - 在任意地方可以获取 SecurityContext </p><p>Authentication - 认证信息对象, 表示认证后的用户</p><p>UserDetails - 认证用户的详细信息</p><p>UserDetailsService - 可以用来获取UserDetails。我们会自定义一个CustomUserDetailsService来实现UserDetailsService接口, 通过 username 查询到 userDetails, 如果没查到 , <code>UsernameNotFoundException</code></p><p>AuthenticationManager - 作用就是校验Authentication, 校验失败抛出 <code>BadCredentialsException</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1132-基本使用-和-配置用户名密码">11.3.2. 基本使用 和 配置用户名密码<a href="#1132-基本使用-和-配置用户名密码" class="hash-link" aria-label="Direct link to 11.3.2. 基本使用 和 配置用户名密码" title="Direct link to 11.3.2. 基本使用 和 配置用户名密码">​</a></h3><p>配合 starter  (spring-boot-starter-security), 可以零配置使用. 引入后依赖</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-starter-security</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.security</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-security-test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如下配置即可</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">application</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> spring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">security</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">security</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 如果不配置, 默认为 user/控制台日志中看到默认密码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#   前端调用, 需要 basic auth 认证</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>支持两种验证方式:</p><ul><li><p>可以通过 form 表单来认证 (默认)</p><p>  适合页面验证</p></li><li><p>可以通过 HttpBasic 来认证 (basic auth)</p><p>  适合 api 接口的验证, 当然也适合页面</p></li></ul><p>用户名密码也可以在这里:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableWebSecurity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WebSecurityConfig extends WebSecurityConfigurerAdapter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public UserDetailsService userDetailsService() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UserDetails user =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             User.withDefaultPasswordEncoder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .username(&quot;user&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .password(&quot;password&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .roles(&quot;USER&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new InMemoryUserDetailsManager(user);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1133-禁用基本认证">11.3.3. 禁用基本认证<a href="#1133-禁用基本认证" class="hash-link" aria-label="Direct link to 11.3.3. 禁用基本认证" title="Direct link to 11.3.3. 禁用基本认证">​</a></h3><p>如果既想使用security又不想每次输入用户名密码，可以直接在Application文件中禁用自动配置 (方法 1)</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@EnableAutoConfiguration(exclude = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration.class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者 在代码中配置 (方法 2)</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableWebSecurity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WebSecurityConfig extends WebSecurityConfigurerAdapter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    是因为覆盖了父类方法, 父类中的方法内容如下:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http.authorizeRequests((requests) -&gt; requests.anyRequest().authenticated()); // 所有 请求都需要认证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http.formLogin(); // 支持表单认证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http.httpBasic(); // 支持 basic auth 认证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void configure(HttpSecurity http) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 这里为空, 表示无需 任何认证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//        super.configure(http);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1134-配置中-websecurity-和-httpsecurity-区别">11.3.4. 配置中 WebSecurity 和 HttpSecurity 区别<a href="#1134-配置中-websecurity-和-httpsecurity-区别" class="hash-link" aria-label="Direct link to 11.3.4. 配置中 WebSecurity 和 HttpSecurity 区别" title="Direct link to 11.3.4. 配置中 WebSecurity 和 HttpSecurity 区别">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 影响全局安全性的配置（忽略资源，设置调试模式，通过实现自定义防火墙定义拒绝请求）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void configure(WebSecurity web) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .ignoring()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .antMatchers(&quot;/resources/**&quot;) // 忽略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .antMatchers(&quot;/publics/**&quot;); // 忽略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//资源级别 配置基于Web的安全性, 粒度更细</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">protected void configure(HttpSecurity http) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .authorizeRequests()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .antMatchers(&quot;/&quot;, &quot;/home&quot;).permitAll()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .antMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .antMatchers(&quot;/publics/**&quot;).hasRole(&quot;USER&quot;) // no effect, 因为  WebSecurity 中配置了 忽略 publics/** 下的验证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .anyRequest().authenticated()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .and()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .formLogin().loginPage(&quot;/login&quot;).permitAll()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .and()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .logout().permitAll();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>================================ 实现方法级别的权限控制</p><p><code>@EnableGlobalMethodSecurity(prePostEnabled =true)</code> 使用表达式实现方法级别的安全性   ,  4个注解可用</p><ul><li><p>@PreAuthorize 在方法调用之前,基于表达式的计算结果来限制对方法的访问</p></li><li><p>@PostAuthorize 允许方法调用,但是如果表达式计算结果为false,将抛出一个安全性异常</p></li><li><p>@PostFilter 允许方法调用,但必须按照表达式来过滤方法的结果</p></li><li><p>@PreFilter 允许方法调用,但必须在进入方法之前过滤输入值</p></li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//表示如果用户具有admin角色，就能访问listAllUsers方法，如果方法前不加@preAuthorize注解，意味着所有用户都能访问listAllUsers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@PreAuthorize(&quot;hasRole(‘admin‘)&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping(value = &quot;/user/&quot;, method = RequestMethod.GET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ResponseBody</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">publicList listAllUsers() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ……</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此外还有 :</p><p>@EnableGlobalMethodSecurity(securedEnabled=true) 开启@Secured 注解过滤权限</p><p>@EnableGlobalMethodSecurity(jsr250Enabled=true)开启@RolesAllowed 注解过滤权限</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1135-配置跨域">11.3.5. 配置跨域<a href="#1135-配置跨域" class="hash-link" aria-label="Direct link to 11.3.5. 配置跨域" title="Direct link to 11.3.5. 配置跨域">​</a></h3><p><a href="https://lolico.me/2020/04/26/Spring-Security-CORS/" target="_blank" rel="noopener noreferrer">https://lolico.me/2020/04/26/Spring-Security-CORS/</a>
TODO</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="114-oauth2">11.4. oauth2<a href="#114-oauth2" class="hash-link" aria-label="Direct link to 11.4. oauth2" title="Direct link to 11.4. oauth2">​</a></h2><p>spring security oauth2</p><p>check outline-about-authentication-oauth2.md</p><h1>12. 日志</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="121-log4j2-marker-写入到指定日志文件">12.1. Log4j2-Marker 写入到指定日志文件<a href="#121-log4j2-marker-写入到指定日志文件" class="hash-link" aria-label="Direct link to 12.1. Log4j2-Marker 写入到指定日志文件" title="Direct link to 12.1. Log4j2-Marker 写入到指定日志文件">​</a></h2><p><a href="https://www.jianshu.com/p/1ff824bc997a?utm_campaign" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/1ff824bc997a?utm_campaign</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="122-logback">12.2. logback<a href="#122-logback" class="hash-link" aria-label="Direct link to 12.2. logback" title="Direct link to 12.2. logback">​</a></h2><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--应用名称--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">APPLICATION_NAME</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">roncoo-pay-app-notify</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 文件输出格式 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">PATTERN</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">%-12(%d{yyyy-MM-dd HH:mm:ss.SSS}) |-%-5level [%thread] %c [%L] -| %msg%n</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 文件路径 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">FILE_PATH</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">/home/roncoo/opensource/pay/logs</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 控制台 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">appender</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">CONSOLE</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">ch.qos.logback.core.ConsoleAppender</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">encoder</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">pattern</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">${PATTERN}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">pattern</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">encoder</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">appender</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--日志文件策略--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">appender</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">LOGGER_FILE</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">ch.qos.logback.core.rolling.RollingFileAppender</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">file</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">${FILE_PATH}/${APPLICATION_NAME}/${APPLICATION_NAME}.log</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">file</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">rollingPolicy</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">ch.qos.logback.core.rolling.TimeBasedRollingPolicy</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">fileNamePattern</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">${FILE_PATH}/${APPLICATION_NAME}/${APPLICATION_NAME}.%d{yyyy-MM-dd}.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">fileNamePattern</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">MaxHistory</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">100</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">MaxHistory</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">rollingPolicy</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">layout</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">ch.qos.logback.classic.PatternLayout</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">pattern</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">${PATTERN}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">pattern</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">layout</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">appender</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">logger</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">com.roncoo.pay</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">level</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">debug</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- LOG &quot;com.baeldung*&quot; at TRACE level --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">logger</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">com.baeldung</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">level</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">trace</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">additivity</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">false</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">appender-ref</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">ref</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">RollingFile</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">appender-ref</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">ref</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">Console</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">logger</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 所有日志都打印 info 级别 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">root</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">level</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">info</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">appender-ref</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">ref</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">CONSOLE</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">appender-ref</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">ref</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">LOGGER_FILE</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">root</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>13. 数据层</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="131-canal-订阅">13.1. canal 订阅<a href="#131-canal-订阅" class="hash-link" aria-label="Direct link to 13.1. canal 订阅" title="Direct link to 13.1. canal 订阅">​</a></h2><p><a href="https://github.com/zendesk/maxwell" target="_blank" rel="noopener noreferrer">https://github.com/zendesk/maxwell</a> 类似</p><p><a href="https://github.com/alibaba/otter" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/otter</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="132-mybatis-自动建表插件">13.2. mybatis 自动建表插件<a href="#132-mybatis-自动建表插件" class="hash-link" aria-label="Direct link to 13.2. mybatis 自动建表插件" title="Direct link to 13.2. mybatis 自动建表插件">​</a></h2><p><a href="https://github.com/zyf970617/mybatis-auto-create-table" target="_blank" rel="noopener noreferrer">https://github.com/zyf970617/mybatis-auto-create-table</a></p><p><a href="https://blog.csdn.net/yuru974882032/article/details/106749299" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/yuru974882032/article/details/106749299</a></p><p><a href="https://gitee.com/sunchenbin/mybatis-enhance" target="_blank" rel="noopener noreferrer">https://gitee.com/sunchenbin/mybatis-enhance</a></p><p><a href="https://gitee.com/baomidou/mybatis-mate-examples?_from=gitee_search" target="_blank" rel="noopener noreferrer">https://gitee.com/baomidou/mybatis-mate-examples?_from=gitee_search</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="133-mybatis-crud-增强插件">13.3. mybatis crud 增强插件<a href="#133-mybatis-crud-增强插件" class="hash-link" aria-label="Direct link to 13.3. mybatis crud 增强插件" title="Direct link to 13.3. mybatis crud 增强插件">​</a></h2><p>mybatis plus</p><p>tk.mybatis</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="134-数据库迁移版本控制">13.4. 数据库迁移版本控制<a href="#134-数据库迁移版本控制" class="hash-link" aria-label="Direct link to 13.4. 数据库迁移版本控制" title="Direct link to 13.4. 数据库迁移版本控制">​</a></h2><p>两者差别不大，因功能多，个人“稍微”倾向 Liquibase; 一般我的倾向是小项目，整体变动不大的用Flyway，而大应用和企业应用用Liquibase更合适</p><p><a href="https://github.com/bytebase/bytebase" target="_blank" rel="noopener noreferrer">https://github.com/bytebase/bytebase</a> 新的更为全面的数据库 schema 管理工具</p><blockquote><p><a href="https://fastzhong.com/posts/db-migration/" target="_blank" rel="noopener noreferrer">https://fastzhong.com/posts/db-migration/</a></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1341-liquibase">13.4.1. liquibase<a href="#1341-liquibase" class="hash-link" aria-label="Direct link to 13.4.1. liquibase" title="Direct link to 13.4.1. liquibase">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1342-flyway">13.4.2. Flyway<a href="#1342-flyway" class="hash-link" aria-label="Direct link to 13.4.2. Flyway" title="Direct link to 13.4.2. Flyway">​</a></h3><h2 class="anchor anchorWithStickyNavbar_LWe7" id="135-数据库-url-和驱动">13.5. 数据库 url 和驱动<a href="#135-数据库-url-和驱动" class="hash-link" aria-label="Direct link to 13.5. 数据库 url 和驱动" title="Direct link to 13.5. 数据库 url 和驱动">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MySQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jdbc:mysql://122.191.199.51:60000/js_phaseii_db?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jdbc:mysql://localhost:3306/ry-cloud?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.mysql.cj.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oracle:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1.使用service_name,配置方式: jdbc:oracle:thin:@//:1521/helowin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.使用SID，配置方式：         jdbc:oracle:thin:@//:1521/helowin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.使用SID，配置方式：         jdbc:oracle:thin:@:1521:helowin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="136-graphql集成">13.6. graphql集成<a href="#136-graphql集成" class="hash-link" aria-label="Direct link to 13.6. graphql集成" title="Direct link to 13.6. graphql集成">​</a></h2><p><a href="https://www.awaimai.com/2876.html" target="_blank" rel="noopener noreferrer">https://www.awaimai.com/2876.html</a></p><p><a href="https://juejin.cn/post/6982083422567006245" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6982083422567006245</a> 入门
<a href="https://graphql.cn/learn/queries/" target="_blank" rel="noopener noreferrer">https://graphql.cn/learn/queries/</a> 官网文档</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="137-启动执行-sql">13.7. 启动执行 SQL<a href="#137-启动执行-sql" class="hash-link" aria-label="Direct link to 13.7. 启动执行 SQL" title="Direct link to 13.7. 启动执行 SQL">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1371-sql-分隔符的坑">13.7.1. SQL 分隔符的坑<a href="#1371-sql-分隔符的坑" class="hash-link" aria-label="Direct link to 13.7.1. SQL 分隔符的坑" title="Direct link to 13.7.1. SQL 分隔符的坑">​</a></h3><p>默认分隔符是 分号, 若SQL 中有执行过程/函数, 需要 <code>spring.datasource.separator=|</code> </p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">exists</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">getChildrenProductName</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">getChildrenProductName</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">orgid </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DECLARE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">oTemp</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DECLARE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">oTempChild</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DECLARE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">oTempName</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DECLARE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">oTempChildName</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DECLARE</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> oTemp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">orgid </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CHAR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> oTempChild </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">orgid </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CHAR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> oTempName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;$&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> oTempChildName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHILE</span><span class="token plain"> oTempChild </span><span class="token operator" style="color:#393A34">IS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> oTempName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">oTempName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;,&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">oTempChildName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> oTemp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CONCAT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">oTemp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;,&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">oTempChild</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> GROUP_CONCAT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">product_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">partnum</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> oTempChildName </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> product p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">left</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> bom b </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PartID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PartID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> FIND_IN_SET</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ParentPartID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">oTempChild</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> GROUP_CONCAT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PartID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> oTempChild </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> product p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">left</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> bom b </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PartID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PartID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> FIND_IN_SET</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ParentPartID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">oTempChild</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">END</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WHILE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">RETURN</span><span class="token plain"> oTempName</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">END</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">|</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1372-spring-datasource-自带">13.7.2. spring datasource 自带<a href="#1372-spring-datasource-自带" class="hash-link" aria-label="Direct link to 13.7.2. spring datasource 自带" title="Direct link to 13.7.2. spring datasource 自带">​</a></h3><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">datasource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   数据源基本配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver-class-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.mysql.cj.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3306/mybatis</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">useUnicode=true</span><span class="token important">&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.alibaba.druid.pool.DruidDataSource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   数据源其他配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">initialSize</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">minIdle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxActive</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxWait</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">timeBetweenEvictionRunsMillis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">minEvictableIdleTimeMillis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">validationQuery</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SELECT 1 FROM DUAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">testWhileIdle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">testOnBorrow</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">testOnReturn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">poolPreparedStatements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   配置监控统计拦截的filters，去掉后监控界面sql无法统计，&#x27;wall&#x27;用于防火墙</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">filters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stat</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">wall</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">log4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxPoolPreparedStatementPerConnectionSize</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">useGlobalDataSourceStat</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">connectionProperties</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">sql/department.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">sql/employee.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">initialization-mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ALWAYS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1373-使用-jpa">13.7.3. 使用 jpa<a href="#1373-使用-jpa" class="hash-link" aria-label="Direct link to 13.7.3. 使用 jpa" title="Direct link to 13.7.3. 使用 jpa">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="13731-springboot-接入-jpa">13.7.3.1. springboot 接入 jpa<a href="#13731-springboot-接入-jpa" class="hash-link" aria-label="Direct link to 13.7.3.1. springboot 接入 jpa" title="Direct link to 13.7.3.1. springboot 接入 jpa">​</a></h4><p>1、SpringBoot根据脚本初始化</p><p>结构初始化脚本文件由spring.datasource.schema属性指定，数据初始化脚本由文件spring.datasource.data属性指定。</p><p>这两个脚本是否执行的开关由spring.datasource.initialization-mode决定：always-一定执行，embedded-只对内存数据库执行(默认)，never-不执行。</p><p>2、JPA根据类结构初始化</p><p>　　@Entity注解的类将会被初始化一张数据库表。</p><p>　　是否执行的开关由spring.jpa.hibernate.ddl-auto属性控制，可为create/update/create-drop/none/validate，其中none和validate为不执行。</p><p>3、初始化时对于另一个属性spring.jpa.generate-dll在理解上的困惑</p><p>　　按照它的描述，spring.jpa.generate-dll是jpa层面对数据表生成策略的控制，而spring.jpa.hibernate.ddl-auto是jpa实现hibernate层面上对数据表生成策略的控制。</p><p>　　实践也验证了文章里所说的，spring.jpa.generate-dll比spring.jpa.hibernate.ddl-auto有更强的控制力度，即使spring.jpa.hibernate.ddl-auto为none，只要spring.jpa.generate-dll为true，也会根据@Entity注解的实体类生成对应数据表。</p><p>　　按照文章的建议，为了避免混淆和不好理解，这两者最好不要混用，只对JPA实现层面的控制属性spring.jpa.hibernate.ddl-auto进行设置即可。</p><p>4、让SpringBoot根据脚本和让JPA根据实体类进行初始化，两者之中选择一个即可。</p><p>5 spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect 虽然 不同的数据库方言会自动选择, 但是若想使用特定引擎类型需要指定方言, 不加这句则不会默认创建MyISAM引擎的数据库</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">jpa:hibernate:ddl-auto: update是hibernate的配置属性，其主要作用是：自动创建、更新、验证数据库表结构。该参数的几种配置如下：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1.·create：每次加载hibernate时都会删除上一次的生成的表，然后根据你的model类再重新来生成新表，哪怕两次没有任何改变也要这样执行，这就是导致数据库表数据丢失的一个重要原因。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.·create-drop：每次加载hibernate时根据model类生成表，但是sessionFactory一关闭,表就自动删除。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.·update：最常用的属性，第一次加载hibernate时根据model类会自动建立起表的结构（前提是先建立好数据库），以后加载hibernate时根据model类自动更新表结构，即使表结构改变了但表中的行仍然存在不会删除以前的行。要注意的是当部署到服务器后，表结构是不会被马上建立起来的，是要等应用第一次运行起来后才会。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4.·validate：每次加载hibernate时，验证创建数据库表结构，只会和数据库中的表进行比较，不会创建新表，但是会插入新值。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">我在初次创建时会设为create,创建好后改为validate.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="13732-jpa-querydsl-多表联查">13.7.3.2. jpa queryDsl 多表联查<a href="#13732-jpa-querydsl-多表联查" class="hash-link" aria-label="Direct link to 13.7.3.2. jpa queryDsl 多表联查" title="Direct link to 13.7.3.2. jpa queryDsl 多表联查">​</a></h4><p><a href="https://zhongpan.tech/2020/07/20/034-best-practice-of-multi-table-joint-query-in-spring-data-jpa/" target="_blank" rel="noopener noreferrer">https://zhongpan.tech/2020/07/20/034-best-practice-of-multi-table-joint-query-in-spring-data-jpa/</a>
<a href="https://www.baeldung.com/querydsl-with-jpa-tutorial" target="_blank" rel="noopener noreferrer">https://www.baeldung.com/querydsl-with-jpa-tutorial</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="13733-jpa-支持-java8-time">13.7.3.3. jpa 支持 java8 time<a href="#13733-jpa-支持-java8-time" class="hash-link" aria-label="Direct link to 13.7.3.3. jpa 支持 java8 time" title="Direct link to 13.7.3.3. jpa 支持 java8 time">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">https://stackoverflow.com/questions/54840769/how-to-persist-localdate-with-jpa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://www.baeldung.com/jpa-java-time</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1374-datasourceinitializer">13.7.4. DataSourceInitializer<a href="#1374-datasourceinitializer" class="hash-link" aria-label="Direct link to 13.7.4. DataSourceInitializer" title="Direct link to 13.7.4. DataSourceInitializer">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CustomizeDataSourceInitializer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value(&quot;classpath:testSql/test_farms.sql&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Resource functionScriptFarms;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value(&quot;classpath:testSql/test_miners.sql&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Resource functionScriptMiners;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value(&quot;classpath:testSql/test_pool_config.sql&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Resource functionScriptPoolConfig;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DataSourceInitializer dataSourceInitializer(final DataSource dataSource) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final DataSourceInitializer initializer = new DataSourceInitializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 设置数据源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        initializer.setDataSource(dataSource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        initializer.setDatabasePopulator(databasePopulator());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return initializer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private DatabasePopulator databasePopulator() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final ResourceDatabasePopulator populator = new ResourceDatabasePopulator();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        populator.addScripts(functionScriptFarms);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        populator.addScripts(functionScriptMiners);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        populator.addScripts(functionScriptPoolConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return populator;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1375-maven-antrun-pluginn">13.7.5. maven-antrun-pluginn<a href="#1375-maven-antrun-pluginn" class="hash-link" aria-label="Direct link to 13.7.5. maven-antrun-pluginn" title="Direct link to 13.7.5. maven-antrun-pluginn">​</a></h3><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">profile</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">refresh-db</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.maven.plugins</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">maven-antrun-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">file</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">src/main/resources/application.properties</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">sql</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">driver</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">${jdbc.driver}</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">url</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">${jdbc.url}</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">userid</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">${jdbc.username}</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">password</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">${jdbc.password}</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onerror</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">continue</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">encoding</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">${project.build.sourceEncoding}</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">classpath</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">refid</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">maven.test.classpath</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">transaction</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">src/main/resources/sql/h2/schema.sql</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">transaction</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">src/test/resources/data/h2/import-data.sql</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">sql</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">profile</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="138-整合-spring-jdbc">13.8. 整合 spring jdbc<a href="#138-整合-spring-jdbc" class="hash-link" aria-label="Direct link to 13.8. 整合 spring jdbc" title="Direct link to 13.8. 整合 spring jdbc">​</a></h2><p><a href="https://www.cnblogs.com/liyihua/p/12333967.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/liyihua/p/12333967.html</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="139-整合-hibernate">13.9. 整合 hibernate<a href="#139-整合-hibernate" class="hash-link" aria-label="Direct link to 13.9. 整合 hibernate" title="Direct link to 13.9. 整合 hibernate">​</a></h2><p>即 spring data jpa</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1391-jpa注解总结">13.9.1. jpa注解总结<a href="#1391-jpa注解总结" class="hash-link" aria-label="Direct link to 13.9.1. jpa注解总结" title="Direct link to 13.9.1. jpa注解总结">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// anno on class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@DynamicInsert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@DynamicUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EntityListeners(AuditingEntityListener.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//anno on field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// uuid as primary key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GenericGenerator(name = &quot;generator&quot;, strategy = &quot;uuid&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GeneratedValue(generator = &quot;generator&quot;, strategy = GenerationType.TABLE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Column(name = &quot;id&quot;, length = 32)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1392-审计-createddate">13.9.2. 审计 createdDate<a href="#1392-审计-createddate" class="hash-link" aria-label="Direct link to 13.9.2. 审计 createdDate" title="Direct link to 13.9.2. 审计 createdDate">​</a></h3><p><a href="https://blog.csdn.net/a972669015/article/details/104778172" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/a972669015/article/details/104778172</a>
TODO</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1393-执行原生-sql">13.9.3. 执行原生 SQL<a href="#1393-执行原生-sql" class="hash-link" aria-label="Direct link to 13.9.3. 执行原生 SQL" title="Direct link to 13.9.3. 执行原生 SQL">​</a></h3><p><a href="https://github.com/cloudfavorites/favorites-web" target="_blank" rel="noopener noreferrer">https://github.com/cloudfavorites/favorites-web</a></p><p><a href="https://www.cnblogs.com/myknow/p/9559011.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/myknow/p/9559011.html</a>
<a href="https://segmentfault.com/a/1190000022338883" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000022338883</a>
<a href="https://liuyanzhao.com/8069.html" target="_blank" rel="noopener noreferrer">https://liuyanzhao.com/8069.html</a>
TODO</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1394-动态-sql">13.9.4. 动态 SQL<a href="#1394-动态-sql" class="hash-link" aria-label="Direct link to 13.9.4. 动态 SQL" title="Direct link to 13.9.4. 动态 SQL">​</a></h3><p><a href="https://www.cnblogs.com/kongxianghai/p/7575988.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/kongxianghai/p/7575988.html</a></p><p>插入和修改可以在类实体上标注
@DynamicInsert和@DynamicUpdate
运行时动态生成非空字段的 插入和 更新语句</p><p>动态查询则需要用 Criteria API</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1395-spring-data-rest-配合-spring-data-jpa">13.9.5. spring-data-rest 配合 spring-data-jpa<a href="#1395-spring-data-rest-配合-spring-data-jpa" class="hash-link" aria-label="Direct link to 13.9.5. spring-data-rest 配合 spring-data-jpa" title="Direct link to 13.9.5. spring-data-rest 配合 spring-data-jpa">​</a></h3><p><a href="http://docs.jcohy.com/docs/spring-data-rest/3.2.8.RELEASE/html5/zh-cn/" target="_blank" rel="noopener noreferrer">http://docs.jcohy.com/docs/spring-data-rest/3.2.8.RELEASE/html5/zh-cn/</a>
<a href="https://docs.spring.io/spring-data/rest/docs/3.4.5/reference/html/#Project" target="_blank" rel="noopener noreferrer">https://docs.spring.io/spring-data/rest/docs/3.4.5/reference/html/#Project</a></p><p><a href="https://docs.spring.io/spring-data/jpa/docs/2.4.5/reference/html/#repositories" target="_blank" rel="noopener noreferrer">https://docs.spring.io/spring-data/jpa/docs/2.4.5/reference/html/#repositories</a></p><p>spring data rest 可以直接将 repository 发布为 rest service, 和 spring data jpa (自动生成 crud api) 配合</p><p>目前支持Spring Data JPA、Spring Data MongoDB、Spring Data Neo4j、Spring Data GemFire、Spring Data Cassandra的 repository 自动转换成REST服务</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-starter-data-jpa</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-starter-data-rest</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RepositoryRestResource // publish repository as rest service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interface ReservationRepository extends JpaRepository&lt;Reservation, Long&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * customized rest service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * http://localhost:8080/reservations/search/by-name?name=hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RestResource(path = &quot;by-name&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Optional&lt;Reservation&gt; findByName(String name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在分布式下, 在 feign client 接收 spring data rest 发布的 service 需要和 hateoas (spring-boot-starter-hateoas) 配合:(<a href="https://docs.spring.io/spring-hateoas/docs/current/reference/html/#migrate-to-1.0.changes" target="_blank" rel="noopener noreferrer">hateoas 版本更新, 接受数据的实体有改变</a>)</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@FeignClient(&quot;reservation-service&quot;) // also support &#x27;url&#x27; ( outside eureka)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interface ReservationResources {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(&quot;/reservations&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CollectionModel&lt;Reservation&gt; reservations();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(&quot;/message&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String message();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1310-整合-mybatis-plus">13.10. 整合 mybatis-plus<a href="#1310-整合-mybatis-plus" class="hash-link" aria-label="Direct link to 13.10. 整合 mybatis-plus" title="Direct link to 13.10. 整合 mybatis-plus">​</a></h2><p>mybatis-plus-boot-starter</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface IAccountService extends IService&lt;Account&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AccountService extends ServiceImpl&lt;AccountMapper, Account&gt; implements IAccountService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@mapper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 或者启动类 @MapperScan(&quot;io.github.xiaoyureed.workflow.mapper&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface AccountMapper extends BaseMapper&lt;Account&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>AccountMapper.xml</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&lt;!</span><span class="token doctype doctype-tag" style="color:#999988;font-style:italic">DOCTYPE</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype name" style="color:#999988;font-style:italic">mapper</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype name" style="color:#999988;font-style:italic">PUBLIC</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype string" style="color:#e3116c;font-style:italic">&quot;-//mybatis.org/DTD Mapper 3.0&quot;</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype string" style="color:#e3116c;font-style:italic">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mapper</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">namespace</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">io.github.xiaoyureed.workflow.mapper.AccountMapper</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mapper</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1311-整合-mybatis">13.11. 整合 mybatis<a href="#1311-整合-mybatis" class="hash-link" aria-label="Direct link to 13.11. 整合 mybatis" title="Direct link to 13.11. 整合 mybatis">​</a></h2><ul><li>依赖：mybatis-spring-boot-starter</li><li>@Mapper标注创建的xxxMapper接口；或者 在 启动类上 标注 @mapperscan(basepackage...)</li><li>@Select(&quot;SELECT * FROM USER WHERE NAME = #{name}&quot;)标注方法，还有@insert等；方法参数@Param(&quot;name&quot;)标注</li><li>通过@Autowired注入使用</li></ul><p>也可以直接引入 mybatisplus-spring-boot-starter 通过 mybatis plus 使用</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13111-基本配置">13.11.1. 基本配置<a href="#13111-基本配置" class="hash-link" aria-label="Direct link to 13.11.1. 基本配置" title="Direct link to 13.11.1. 基本配置">​</a></h3><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">datasource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3306/mall</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">useUnicode=true</span><span class="token important">&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mybatis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># config-location属性和configuration属性不能同时指定</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#config-location: classpath:mybatis.xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type-aliases-package</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> me.zingon.pagehelper.model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mapper-locations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">mapper/</span><span class="token important">*.xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#mapper-locations: {&quot;classpath:mapper/*.xml&quot;, &quot;classpath*:com/**/mapper/*.xml&quot;}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">configuration</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">map-underscore-to-camel-case</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">default-fetch-size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">default-statement-timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13112-使用-拦截器-interceptor-plugins">13.11.2. 使用 拦截器 interceptor plugins<a href="#13112-使用-拦截器-interceptor-plugins" class="hash-link" aria-label="Direct link to 13.11.2. 使用 拦截器 interceptor plugins" title="Direct link to 13.11.2. 使用 拦截器 interceptor plugins">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="131121-principle-of-plugins">13.11.2.1. principle of plugins<a href="#131121-principle-of-plugins" class="hash-link" aria-label="Direct link to 13.11.2.1. principle of plugins" title="Direct link to 13.11.2.1. principle of plugins">​</a></h4><p>基于插件机制，基本上可以控制SQL执行的各个阶段，如执行阶段，参数处理阶段，语法构建阶段，结果集处理阶段，具体可以根据项目业务来实现对应业务逻辑。</p><p>设计模式：代理模式、责任链模式</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="131122-use-scenarios">13.11.2.2. use scenarios<a href="#131122-use-scenarios" class="hash-link" aria-label="Direct link to 13.11.2.2. use scenarios" title="Direct link to 13.11.2.2. use scenarios">​</a></h4><ul><li>paging 拦截StatementHandler类的prepare方法，改变要执行的SQL语句为分页语句即可；</li><li>Assign default values to fields before SQL execution</li><li>SQL performance monitor 通过拦截Executor类的update, query等方法，用日志记录每个方法执行的时间</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="131123-how-to-use-plugins">13.11.2.3. how to use plugins<a href="#131123-how-to-use-plugins" class="hash-link" aria-label="Direct link to 13.11.2.3. how to use plugins" title="Direct link to 13.11.2.3. how to use plugins">​</a></h4><p>实现 Interceptor 接口, 标注@Intercepts(@Signature) , 参考 <a href="https://www.jianshu.com/p/0a72bb1f6a21" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/0a72bb1f6a21</a></p><p>scenario 1: 直接给自定义拦截器添加一个 @Component注解 , 启动时不会自动调用自定义拦截器的setProperties方法
scenario 2: 无需 @component ,只需要 @bean ConfigurationCustomizer 中 addInterceptor , 不会自动调用setProperties方法 --- mybatis plus  中的配置方法
scenario 3: 无需 @component ,需要 @bean SqlSessionFactoryBean 中 setPlugins --- (app 启动时, setProperties被自动调用)</p><p><a href="https://github.com/miaoxinwei/mybatis-crypt/blob/master/src/main/java/org/apache/ibatis/plugin/CryptInterceptor.java" target="_blank" rel="noopener noreferrer">https://github.com/miaoxinwei/mybatis-crypt/blob/master/src/main/java/org/apache/ibatis/plugin/CryptInterceptor.java</a> 日志脱敏<br>
<!-- -->TODO</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 在mybatis中可被拦截的类型有四种(按照拦截顺序):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Executor：执行 SQL 语句。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ParameterHandler：处理参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ResultHandler：处理结果集。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * StatementHandler：Sql语法构建。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 每个类型可以被拦截的方法:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     拦截的类   拦截的方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Executor   update, query, flushStatements, commit, rollback,getTransaction, close, isClosed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ParameterHandler   getParameterObject, setParameters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     StatementHandler   prepare, parameterize, batch, update, query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ResultSetHandler   handleResultSets, handleOutputParameters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //标识该类是一个拦截器；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Intercepts({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //指明自定义拦截器需要拦截哪一个类型，哪一个方法(方法有重载, 所以还需要 指明 args 才能确定是哪个方法)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @Signature(type = Executor.class, method = &quot;update&quot;, args = {MappedStatement.class, Object.class}),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @Signature(type = Executor.class, method = &quot;query&quot;, args = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static class SqlInterceptor implements Interceptor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public Object intercept(Invocation invocation) throws Throwable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            Object target = invocation.getTarget(); //被代理对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            Method method = invocation.getMethod(); //代理方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            Object[] args = invocation.getArgs(); //方法参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Object[] args = invocation.getArgs();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Object param = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MappedStatement mappedStatement = (MappedStatement) args[0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (args.length &gt; 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                param = args[1];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String sql = sql(mappedStatement, param);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return invocation.proceed();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private String sql(MappedStatement statement, Object param) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            BoundSql boundSql = statement.getBoundSql(param);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //将原始sql中的空白字符（\s包括换行符，制表符，空格符）替换为&quot; &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String sql = boundSql.getSql().replaceAll(&quot;[\\s]+&quot;, &quot; &quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (param == null || parameterMappings.size() == 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return sql;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            org.apache.ibatis.session.Configuration configuration = statement.getConfiguration();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TypeHandlerRegistry typeHandlerRegistry = configuration.getTypeHandlerRegistry();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (typeHandlerRegistry.hasTypeHandler(param.getClass())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sql = sql.replaceFirst(&quot;\\?&quot;, getParameterValue(param));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                MetaObject metaObject = configuration.newMetaObject(param);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (ParameterMapping parameterMapping : parameterMappings) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    String propertyName = parameterMapping.getProperty();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (metaObject.hasGetter(propertyName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Object obj = metaObject.getValue(propertyName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sql = sql.replaceFirst(&quot;\\?&quot;, getParameterValue(obj));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    } else if (boundSql.hasAdditionalParameter(propertyName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Object obj = boundSql.getAdditionalParameter(propertyName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sql = sql.replaceFirst(&quot;\\?&quot;, getParameterValue(obj));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return sql;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private String getParameterValue(Object obj) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String value = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (obj instanceof String) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                value = &quot;&#x27;&quot; + obj.toString() + &quot;&#x27;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else if (obj instanceof Date) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                DateFormat formatter = DateFormat.getDateTimeInstance(DateFormat.DEFAULT, DateFormat.DEFAULT, Locale.CHINA);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                value = &quot;&#x27;&quot; + formatter.format(obj) + &quot;&#x27;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (obj != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    value = obj.toString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    value = &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         * 生成代理对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         * 可选</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         * 我们可以决定是否要进行拦截, 如果拦截, 就返回代理后的对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *       * 如果不拦截, 则返回原始对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *  每经过一个拦截器对象都会调用插件的plugin方法，也就是说，该方法会调用4次。根据@Intercepts注解来决定是否进行拦截处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public Object plugin(Object target) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //返回四大接口对象的代理对象, 表示始终会执行拦截</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Plugin.wrap(target, this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 控制是否拦截</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 若类上加了 @Signature 指明了 拦截类型, 这一步就省了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            if (target instanceof StatementHandler) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                return Plugin.wrap(target, this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            return target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         * 可选</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         * 用于在 Mybatis 配置文件中指定一些属性的。类似 spring 中有 @value,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         * 一般不用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void setProperties(Properties properties) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13113-typehandler">13.11.3. typehandler<a href="#13113-typehandler" class="hash-link" aria-label="Direct link to 13.11.3. typehandler" title="Direct link to 13.11.3. typehandler">​</a></h3><p><a href="https://blog.csdn.net/m0_37735176/article/details/103107759" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/m0_37735176/article/details/103107759</a>
<a href="https://www.cnblogs.com/haoliyou/p/13743698.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/haoliyou/p/13743698.html</a>
<a href="https://www.cnblogs.com/dyf-stu/p/10162301.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/dyf-stu/p/10162301.html</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13114-全注解开发">13.11.4. 全注解开发<a href="#13114-全注解开发" class="hash-link" aria-label="Direct link to 13.11.4. 全注解开发" title="Direct link to 13.11.4. 全注解开发">​</a></h3><p><a href="https://zhuanlan.zhihu.com/p/94554180" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/94554180</a>
TODO</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13115-动态定时刷新-sql-mapper-实现热加载">13.11.5. 动态定时刷新 SQL mapper 实现热加载<a href="#13115-动态定时刷新-sql-mapper-实现热加载" class="hash-link" aria-label="Direct link to 13.11.5. 动态定时刷新 SQL mapper 实现热加载" title="Direct link to 13.11.5. 动态定时刷新 SQL mapper 实现热加载">​</a></h3><p><a href="https://veevv.com/2015/09/30/mybatis-mapper-xml-reloader/" target="_blank" rel="noopener noreferrer">https://veevv.com/2015/09/30/mybatis-mapper-xml-reloader/</a></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class XMLMapperReloader implements ApplicationContextAware {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ConfigurableApplicationContext context = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private HashMap&lt;String, Long&gt; fileMapping = new HashMap&lt;String, Long&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Scanner scanner = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String packageSearchPath = &quot;classpath:com/xx/xx/dao/*/*.xml&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ScheduledExecutorService service = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.context = (ConfigurableApplicationContext) applicationContext;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public XMLMapperReloader(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        service = Executors.newScheduledThreadPool(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        service.scheduleAtFixedRate(new Task(), 5, 5, TimeUnit.SECONDS);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    class Task implements Runnable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void run() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                scanner = new Scanner();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                scanner.refreshMapper();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @SuppressWarnings({ &quot;rawtypes&quot; })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    class Scanner {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private Resource[] mapperLocations;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void refreshMapper() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SqlSessionFactory factory = context.getBean(SqlSessionFactory.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Configuration configuration = factory.getConfiguration();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // step.1 扫描文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    this.scanMapperXml();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                } catch (IOException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // step.2 判断是否有文件发生了变化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (this.isChanged()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    System.out.println(&quot;==============检测到mapper有改变, 开始刷新...===============&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // step.2.1 清理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    this.removeConfig(configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // step.2.2 重新加载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    for (Resource configLocation : mapperLocations) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            XMLMapperBuilder xmlMapperBuilder = new XMLMapperBuilder(configLocation.getInputStream(), configuration, configLocation.toString(), configuration.getSqlFragments());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            xmlMapperBuilder.parse();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        } catch (IOException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    System.out.println(&quot;==============mapper刷新完毕===============&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private void scanMapperXml() throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.mapperLocations = new PathMatchingResourcePatternResolver().getResources(packageSearchPath);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private void removeConfig(Configuration configuration) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Class&lt;?&gt; classConfig = configuration.getClass();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clearMap(classConfig, configuration, &quot;mappedStatements&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clearMap(classConfig, configuration, &quot;caches&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clearMap(classConfig, configuration, &quot;resultMaps&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clearMap(classConfig, configuration, &quot;parameterMaps&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clearMap(classConfig, configuration, &quot;keyGenerators&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clearMap(classConfig, configuration, &quot;sqlFragments&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clearSet(classConfig, configuration, &quot;loadedResources&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private void clearMap(Class&lt;?&gt; classConfig, Configuration configuration, String fieldName) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Field field = classConfig.getDeclaredField(fieldName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            field.setAccessible(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map mapConfig = (Map) field.get(configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mapConfig.clear();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private void clearSet(Class&lt;?&gt; classConfig, Configuration configuration, String fieldName) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Field field = classConfig.getDeclaredField(fieldName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            field.setAccessible(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Set setConfig = (Set) field.get(configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            setConfig.clear();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private boolean isChanged() throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            boolean flag = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (Resource resource : mapperLocations) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String resourceName = resource.getFilename();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                boolean addFlag = !fileMapping.containsKey(resourceName);// 此为新增标识</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 修改文件:判断文件内容是否有变化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Long compareFrame = fileMapping.get(resourceName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                long lastFrame = resource.contentLength() + resource.lastModified();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                boolean modifyFlag = null != compareFrame &amp;&amp; compareFrame.longValue() != lastFrame;// 此为修改标识</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 新增或是修改时,存储文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if(addFlag || modifyFlag) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    fileMapping.put(resourceName, Long.valueOf(lastFrame));// 文件内容帧值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    flag = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return flag;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getPackageSearchPath() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return packageSearchPath;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setPackageSearchPath(String packageSearchPath) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.packageSearchPath = packageSearchPath;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13116-自定义资源文件打包目录-and-开启占位符过滤">13.11.6. 自定义资源文件打包目录 and 开启占位符过滤<a href="#13116-自定义资源文件打包目录-and-开启占位符过滤" class="hash-link" aria-label="Direct link to 13.11.6. 自定义资源文件打包目录 and 开启占位符过滤" title="Direct link to 13.11.6. 自定义资源文件打包目录 and 开启占位符过滤">​</a></h3><p>mapper.xml 和 dao interface 放在一起: (开启资源文件过滤)</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-maven-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- maven 默认仅仅 将src/main/resources 下的文件打包到 jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            若 mapper.xml 不在标准目录下, 需要指定资源过滤处理 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">resources</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">resource</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">directory</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">src/main/java</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">directory</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">includes</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">include</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">**/*.*</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">include</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">includes</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 打包到哪里? 可省略, 默认 jar 根目录 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- &lt;targetPath&gt;META-INF/plexus&lt;/targetPath&gt; --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 是否开启资源文件占位符过滤 (如 ${project.version}), 默认 false --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- &lt;filtering&gt;false&lt;/filtering&gt; --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">resource</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 可省略 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">resource</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">directory</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">src/main/resources</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">directory</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">includes</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">include</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">**/*.*</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">include</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">includes</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">resource</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 添加额外的配置文件, 用来解析资源文件中的占位符 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">filters</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">filter</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">src/main/filters/filter.properties</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">filter</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">filters</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">resources</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1312-springboot-事务">13.12. springboot 事务<a href="#1312-springboot-事务" class="hash-link" aria-label="Direct link to 13.12. springboot 事务" title="Direct link to 13.12. springboot 事务">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13121-事务基本使用">13.12.1. 事务基本使用<a href="#13121-事务基本使用" class="hash-link" aria-label="Direct link to 13.12.1. 事务基本使用" title="Direct link to 13.12.1. 事务基本使用">​</a></h3><p>Spring boot是默认启动事务的，只需要在类或者方法上添加@Transactional注解即可</p><p>不生效, 可能是:</p><p>1、首先要看数据库引擎是否支持注解，mysql默认引擎INNODB是支持的，但MYISAM是不支持的；</p><p>2、注解只能被应用到public方法上, 其它方法上不会报错，但不生效；</p><p>3、默认情况下只会对运行期异常(java.lang.RuntimeException及其子类)和 Error 进行回滚；</p><p>4、如果是其它异常, 手动指定<code>@Transactional(rollbackFor={Exception.class})</code></p><p>如果还是不生效, 手动回滚: <code>TransactionAspectSupport.currentTransactionStatus().setRollbackOnly()</code></p><p><a href="https://blog.csdn.net/laoxilaoxi_/article/details/99896738" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/laoxilaoxi_/article/details/99896738</a> 使用 cglib or jdk 动态代理 <code>@EnableTransactionManagement(proxyTargetClass = true)// 使用cglib</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13122-spring-事务传播失效的坑">13.12.2. spring 事务传播失效的坑<a href="#13122-spring-事务传播失效的坑" class="hash-link" aria-label="Direct link to 13.12.2. spring 事务传播失效的坑" title="Direct link to 13.12.2. spring 事务传播失效的坑">​</a></h3><p>同一个 service bean 中的 事务方法互相调用, 如 a() 调用 b(), 只会使用 a() 的 事务, b 的无效, 因为事务本质是基于动态代理, 在同个 bean 中的方法互调, 发生在主动调用方 a() 的代理对象中, 所以只有 a() 的事务生效</p><p>如果 a(), b() 处于不同 service bean 中, 则 事务传播生效.</p><p>解决:</p><p>引入 starter aop, 会引入 aspectJ, @enableAspectJAutoProxy(exposeProxy=true) 开启 aspectJ 并暴露代理对象, 在互调的部分, 使用代理对象互调</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public void a() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // b()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // c()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OrderService thisService = (OrderService) Aopcontext.currentProxy()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    thisService.b()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    thisService.c()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13123-transactional-注解">13.12.3. Transactional 注解<a href="#13123-transactional-注解" class="hash-link" aria-label="Direct link to 13.12.3. Transactional 注解" title="Direct link to 13.12.3. Transactional 注解">​</a></h3><p>事务超时</p><p>@transaction(timeout=...) unit: s</p><p>隔离级别</p><p>@transaction(isolation=...)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1313-缓存">13.13. 缓存<a href="#1313-缓存" class="hash-link" aria-label="Direct link to 13.13. 缓存" title="Direct link to 13.13. 缓存">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13131-springboot-starter-cache">13.13.1. springboot-starter-cache<a href="#13131-springboot-starter-cache" class="hash-link" aria-label="Direct link to 13.13.1. springboot-starter-cache" title="Direct link to 13.13.1. springboot-starter-cache">​</a></h3><p>引入 redis starter, cache starter</p><p>配置文件中配置类型为 redis</p><p>注解:</p><ul><li>@cacheable({&quot;xxxCache&quot;}, sync=true) 缓存数据, 方法上, 指定缓存分区, sync 加锁防止缓存击穿</li><li>@cacheEvic(value=&quot;xxx&quot;, allEntries=true) 删除缓存, allEntries 表示删除分区 cache 下的全部缓存对</li><li>@cacheput 更新</li><li>caching 组合多个操作  </li><li>@cacheconfig 在类级别共享缓存配置</li><li>@enablecaching 开启缓存</li></ul><p>自定义配置</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 自定义缓存 key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 自定义 json 序列化, 不用默认的 jdk 序列化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 自定义过期时间, 默认-1 永不过期</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>优势是简单方便,</p><p>对于读模式:</p><ul><li>缓存穿透 (查询一个 null 数据), 配置 cache-null-value=true 缓存 null 数据</li><li>缓存击穿 (大量并发同时请求一个快过期的key): </li><li>雪崩(大量key 同时过期), 配置 time-to-live 过期时间, </li></ul><p>对于写模式: 没有很好的内置解决方法, 可以通过:</p><ul><li>读写加锁</li><li>canal 中间件</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13132-caffeine">13.13.2. caffeine<a href="#13132-caffeine" class="hash-link" aria-label="Direct link to 13.13.2. caffeine" title="Direct link to 13.13.2. caffeine">​</a></h3><p>Caffeine是使用Java8对Guava缓存的重写版本，在Spring Boot 2.0中将取代Guava</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1314-配合-h2-数据库进行开发">13.14. 配合 h2 数据库进行开发<a href="#1314-配合-h2-数据库进行开发" class="hash-link" aria-label="Direct link to 13.14. 配合 h2 数据库进行开发" title="Direct link to 13.14. 配合 h2 数据库进行开发">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13141-h2-和-spring-data-jpa-配合">13.14.1. h2 和 spring data jpa 配合<a href="#13141-h2-和-spring-data-jpa-配合" class="hash-link" aria-label="Direct link to 13.14.1. h2 和 spring data jpa 配合" title="Direct link to 13.14.1. h2 和 spring data jpa 配合">​</a></h3><p>无需任何配置文件</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableDiscoveryClient // compared with @EnableEurekaClient, more comprehensive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ReservationServiceApplication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication.run(ReservationServiceApplication.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ApplicationRunner initData(ReservationRepository reservationRepository) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return args -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Stream.of(&quot;ehllo&quot;, &quot;hello&quot;, &quot;llhoe&quot;, &quot;jojo&quot;, &quot;猕猴桃&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .forEach(name -&gt; reservationRepository.save(new Reservation(null, name)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            reservationRepository.findAll().forEach(System.out::println);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RepositoryRestResource // publish repository as rest service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 比如查询所有 /reservations, 查某个 /reservations/1, 搜索 /reservations/search ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interface ReservationRepository extends JpaRepository&lt;Reservation, Long&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * customized rest service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * http://localhost:8080/reservations/search/by-name?name=hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RestResource(path = &quot;by-name&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Optional&lt;Reservation&gt; findByName(String name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RefreshScope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ConfigRefreshTestController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final String message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final DiscoveryClient discoveryClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ConfigRefreshTestController(@Value(&quot;${message: defaultMsg}&quot;) String message,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                       @Autowired DiscoveryClient discoveryClient) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.message = message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.discoveryClient = discoveryClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(value = &quot;/message&quot;, method = RequestMethod.GET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String readMessage() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this.message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(&quot;/eureka-services&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;List&lt;String&gt;&gt; eurekaServices() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new ResponseEntity&lt;&gt;(discoveryClient.getServices(), HttpStatus.OK);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * entity: 预定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Entity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@AllArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@NoArgsConstructor // if removed, jpa error may be produced</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Reservation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GeneratedValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13142-和-mybatis-plus-配合">13.14.2. 和 mybatis-plus 配合<a href="#13142-和-mybatis-plus-配合" class="hash-link" aria-label="Direct link to 13.14.2. 和 mybatis-plus 配合" title="Direct link to 13.14.2. 和 mybatis-plus 配合">​</a></h3><p><a href="https://mp.baomidou.com/guide/quick-start.html" target="_blank" rel="noopener noreferrer">h2 和 mybatis-plus 配合</a>:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># DataSource Config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">datasource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver-class-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> org.h2.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">db/schema</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">h2.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">db/data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">h2.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">h2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">mem</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>@MapperScan(&quot;mapper package&quot;)</code></p><p>mapper extends BaseMapper</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1315-多数据源">13.15. 多数据源<a href="#1315-多数据源" class="hash-link" aria-label="Direct link to 13.15. 多数据源" title="Direct link to 13.15. 多数据源">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13151-基本配置-全注解开发">13.15.1. 基本配置 全注解开发<a href="#13151-基本配置-全注解开发" class="hash-link" aria-label="Direct link to 13.15.1. 基本配置 全注解开发" title="Direct link to 13.15.1. 基本配置 全注解开发">​</a></h3><p>启动类需要排除自动配置@SpringBootApplication(exclude = {DataSourceAutoConfiguration.class})</p><div class="language-props codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-props codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server.port=8335</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 配置第一个数据源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.hikari.db1.jdbc-url=jdbc:mysql://127.0.0.1:3306/erp?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.hikari.db1.username=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.hikari.db1.password=153963</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.hikari.db1.driver-class-name=com.mysql.cj.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 配置第二个数据源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.hikari.db2.jdbc-url=jdbc:mysql://127.0.0.1:3306/erp2?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.hikari.db2.username=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.hikari.db2.password=153963</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.hikari.db2.driver-class-name=com.mysql.cj.jdbc.Driver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@MapperScan(basePackages = &quot;top.snailclimb.db1.dao&quot;, sqlSessionTemplateRef = &quot;db1SqlSessionTemplate&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class DataSource1Config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 生成数据源.  @Primary 注解声明为默认数据源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(name = &quot;db1DataSource&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ConfigurationProperties(prefix = &quot;spring.datasource.hikari.db1&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Primary // 声明为默认数据源, 防止 dao 层的类忘记指定 @Qualifier(&quot;db1SqlSessionTemplate&quot;), 可以使用默认的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DataSource testDataSource() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return DataSourceBuilder.create().build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 创建 SqlSessionFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(name = &quot;db1SqlSessionFactory&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SqlSessionFactory testSqlSessionFactory(@Qualifier(&quot;db1DataSource&quot;) DataSource dataSource) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bean.setDataSource(dataSource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 若有 mapper.xml , 需要指定位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 若是全注解开发, 无需指定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //  bean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(&quot;classpath:mybatis/mapper/db1/*.xml&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return bean.getObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 配置事务管理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(name = &quot;db1TransactionManager&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DataSourceTransactionManager testTransactionManager(@Qualifier(&quot;db1DataSource&quot;) DataSource dataSource) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new DataSourceTransactionManager(dataSource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SqlSessionTemplate是线程安全的，可以被多个DAO所共享使用。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(name = &quot;db1SqlSessionTemplate&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SqlSessionTemplate testSqlSessionTemplate(@Qualifier(&quot;db1SqlSessionFactory&quot;) SqlSessionFactory sqlSessionFactory) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new SqlSessionTemplate(sqlSessionFactory);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@MapperScan(basePackages = &quot;top.snailclimb.db2.dao&quot;, sqlSessionTemplateRef = &quot;db2SqlSessionTemplate&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class DataSource2Config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(name = &quot;db2DataSource&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ConfigurationProperties(prefix = &quot;spring.datasource.hikari.db2&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DataSource testDataSource() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return DataSourceBuilder.create().build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(name = &quot;db2SqlSessionFactory&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SqlSessionFactory testSqlSessionFactory(@Qualifier(&quot;db2DataSource&quot;) DataSource dataSource) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bean.setDataSource(dataSource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //bean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(&quot;classpath:mybatis/mapper/db2/*.xml&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return bean.getObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(name = &quot;db2TransactionManager&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DataSourceTransactionManager testTransactionManager(@Qualifier(&quot;db2DataSource&quot;) DataSource dataSource) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new DataSourceTransactionManager(dataSource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(name = &quot;db2SqlSessionTemplate&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SqlSessionTemplate testSqlSessionTemplate(@Qualifier(&quot;db2SqlSessionFactory&quot;) SqlSessionFactory sqlSessionFactory) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new SqlSessionTemplate(sqlSessionFactory);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dao 开发:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Qualifier(&quot;db1SqlSessionTemplate&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface UserDao {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 通过名字查询用户信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mybatis中#{}和${}符号的区别 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    使用#{}意味着使用的预编译的语句，即 preparedStatement, 替换占位符时, 会为参数添加引号作为 string 传入, 防止注入攻击</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    也不是说${}一无是处，比如在MyBatis动态排序时使用order by +${动态参数}，使用${}而不是#{}, 动态参数可以传入不定个数的字段.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Select(&quot;SELECT * FROM user WHERE name = #{name}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    User findUserByName(String name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Qualifier(&quot;db2SqlSessionTemplate&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface MoneyDao {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 通过id 查看工资详情</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Select(&quot;SELECT * FROM money WHERE id = #{id}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Money findMoneyById(@Param(&quot;id&quot;) int id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13152-abstractroutingdatasource-动态数据源切换">13.15.2. AbstractRoutingDataSource 动态数据源切换<a href="#13152-abstractroutingdatasource-动态数据源切换" class="hash-link" aria-label="Direct link to 13.15.2. AbstractRoutingDataSource 动态数据源切换" title="Direct link to 13.15.2. AbstractRoutingDataSource 动态数据源切换">​</a></h3><p><a href="https://blog.csdn.net/qq_37502106/article/details/91044952" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/qq_37502106/article/details/91044952</a>
<a href="https://www.cnblogs.com/wyb628/p/7240061.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/wyb628/p/7240061.html</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1316-多数据库类型-databaseidprovider">13.16. 多数据库类型 databaseIdProvider<a href="#1316-多数据库类型-databaseidprovider" class="hash-link" aria-label="Direct link to 13.16. 多数据库类型 databaseIdProvider" title="Direct link to 13.16. 多数据库类型 databaseIdProvider">​</a></h2><p><a href="https://www.cnblogs.com/valten/p/12083128.html#" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/valten/p/12083128.html#</a> 配置 MySQL Oracle 共同使用</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class DataSourceConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value(&quot;${mybatis.mapper-locations}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String mapperLocations;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(name = &quot;dataSource&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ConfigurationProperties(&quot;spring.datasource.hikari&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DataSource dataSource() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return DataSourceBuilder.create().build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public JdbcTemplate jdbcTemplate() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new JdbcTemplate(dataSource());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //如果配置了 databaseIdProvider，MyBatis 会加载所有的不带 databaseId 或匹配当前 databaseId 的语句；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // databaseId 是 mybatis 的内置参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //如果带或者不带的语句都有，则不带的会被忽略。新增，修改和删除都有这个属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;!-- mybatis动态sql的两个内置参数 , 可以直接在 mapper.xml 中使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           _parameter:代表整个参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                单个参数：_parameter就是这个参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                多个参数：参数会被封装为一个map:_parameter就是代表这个map             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           _databaseId:如果配置了databaseIdProvider标签</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _databaseId 就是代表当前数据库的别名Oracle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;!-- List&lt;Employee&gt; getEmpsTestInnerParameter(Employee employee); --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;select id=&quot;getEmpsTestInnerParameter&quot; resultType=&quot;com.hand.mybatis.bean.Employee&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          SELECT * FROM emp </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &lt;if test=&quot;_parameter!=null&quot;&gt;      _parameter相当于传入的参数employee,判断employee是否为空，若不为空则执行where条件 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           where ename=#{_parameter.eName}   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &lt;/if&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/select&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DatabaseIdProvider databaseIdProvider() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DatabaseIdProvider databaseIdProvider = new VendorDatabaseIdProvider();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Properties p = new Properties();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p.setProperty(&quot;Oracle&quot;, &quot;oracle&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p.setProperty(&quot;MySQL&quot;, &quot;mysql&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p.setProperty(&quot;PostgreSQL&quot;, &quot;postgresql&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p.setProperty(&quot;DB2&quot;, &quot;db2&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p.setProperty(&quot;SQL Server&quot;, &quot;sqlserver&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        databaseIdProvider.setProperties(p);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return databaseIdProvider;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SqlSessionFactoryBean sqlSessionFactoryBean(@Qualifier(&quot;dataSource&quot;) DataSource dataSource) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SqlSessionFactoryBean factoryBean = new SqlSessionFactoryBean();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factoryBean.setDataSource(dataSource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factoryBean.setDatabaseIdProvider(databaseIdProvider());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factoryBean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(mapperLocations));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return factoryBean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># application.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 切换对应的环境 postgresql mysql</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">profiles</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">active</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgresql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># mybatis配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mybatis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mapper-locations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">mapper/</span><span class="token important">**/*.xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type-aliases-package</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.valten.</span><span class="token important">**.model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># showSql 控制台打印sql日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">logging</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">level</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">com</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">valten</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">dao</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># application-mysql.yml#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 数据源配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">datasource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hikari</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">jdbc-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3306/test</span><span class="token punctuation" style="color:#393A34">?</span><span class="token important">&amp;useSSL=false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">driver-class-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.mysql.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># application-postgresql.yml#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8002</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 数据源配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">datasource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hikari</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">jdbc-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">postgresql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">5432/test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">driver-class-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> org.postgresql.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--oracle--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.oracle</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">ojdbc6</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">11.2.0.3</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--postgresql--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.postgresql</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">postgresql</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">9.4.1212</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 集成mybatis --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.mybatis.spring.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mybatis-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.3.1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--fastjson--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.alibaba</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">fastjson</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.2.16</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- druid数据库连接池组件 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.alibaba</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">druid-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.1.10</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1317-spring-kafka">13.17. spring kafka<a href="#1317-spring-kafka" class="hash-link" aria-label="Direct link to 13.17. spring kafka" title="Direct link to 13.17. spring kafka">​</a></h2><p><a href="https://docs.spring.io/spring-kafka/docs/current/reference/html/#receiving-messages" target="_blank" rel="noopener noreferrer">https://docs.spring.io/spring-kafka/docs/current/reference/html/#receiving-messages</a></p><p><a href="https://www.youtube.com/watch?v=SqVfCyfCJqw&amp;t=9s" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=SqVfCyfCJqw&amp;t=9s</a></p><h1>14. web 相关</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="141-加解密">14.1. 加解密<a href="#141-加解密" class="hash-link" aria-label="Direct link to 14.1. 加解密" title="Direct link to 14.1. 加解密">​</a></h2><p><a href="https://github.com/yinjihuan/monkey-api-encrypt" target="_blank" rel="noopener noreferrer">https://github.com/yinjihuan/monkey-api-encrypt</a> api 加解密 </p><p><a href="https://www.baeldung.com/java-aes-encryption-decryption" target="_blank" rel="noopener noreferrer">https://www.baeldung.com/java-aes-encryption-decryption</a> 加密科普</p><p><a href="https://www.cnblogs.com/loong-hon/p/11225407.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/loong-hon/p/11225407.html</a></p><p><a href="https://www.javatt.com/p/22814" target="_blank" rel="noopener noreferrer">https://www.javatt.com/p/22814</a>
<a href="https://blog.csdn.net/github_36086968/article/details/103424945" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/github_36086968/article/details/103424945</a>
<a href="https://jueee.github.io/2021/01/2021-01-06-SpringBoot%E5%AE%9E%E7%8E%B0API%E6%8E%A5%E5%8F%A3%E6%95%B0%E6%8D%AEAES%E5%8A%A0%E5%AF%86/" target="_blank" rel="noopener noreferrer">https://jueee.github.io/2021/01/2021-01-06-SpringBoot%E5%AE%9E%E7%8E%B0API%E6%8E%A5%E5%8F%A3%E6%95%B0%E6%8D%AEAES%E5%8A%A0%E5%AF%86/</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="142-springboot-发送-https-或者-http-客户端-client">14.2. springboot 发送 https 或者 http 客户端 client<a href="#142-springboot-发送-https-或者-http-客户端-client" class="hash-link" aria-label="Direct link to 14.2. springboot 发送 https 或者 http 客户端 client" title="Direct link to 14.2. springboot 发送 https 或者 http 客户端 client">​</a></h2><p><a href="https://blog.csdn.net/defonds/article/details/86594441" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/defonds/article/details/86594441</a> (<a href="https://prasans.info/making-https-call-using-apache-httpclient/" target="_blank" rel="noopener noreferrer">https://prasans.info/making-https-call-using-apache-httpclient/</a>)
<a href="https://www.cnblogs.com/lfstudy/p/13793625.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/lfstudy/p/13793625.html</a>
<a href="https://www.cnblogs.com/dbei/articles/12746191.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/dbei/articles/12746191.html</a>
<a href="https://segmentfault.com/a/1190000014456939" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000014456939</a> 使用 resttemplate</p><p><a href="https://square.github.io/okhttp/" target="_blank" rel="noopener noreferrer">https://square.github.io/okhttp/</a>
<a href="https://square.github.io/okhttp/https/" target="_blank" rel="noopener noreferrer">https://square.github.io/okhttp/https/</a></p><p>支持异步回调 Retrofit: <a href="https://www.jianshu.com/p/4d67fe493ebf" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/4d67fe493ebf</a>
<a href="https://www.zhihu.com/question/36963964" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/36963964</a>
<a href="https://www.jianshu.com/p/5bc866b9cbb9" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/5bc866b9cbb9</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1421-发送-http-client">14.2.1. 发送 http client<a href="#1421-发送-http-client" class="hash-link" aria-label="Direct link to 14.2.1. 发送 http client" title="Direct link to 14.2.1. 发送 http client">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1422-发送-https-client">14.2.2. 发送 https client<a href="#1422-发送-https-client" class="hash-link" aria-label="Direct link to 14.2.2. 发送 https client" title="Direct link to 14.2.2. 发送 https client">​</a></h3><p>okhttp</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class JavaConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(name = &quot;myRestTemplate&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RestTemplate restTemplate() throws KeyStoreException, NoSuchAlgorithmException, KeyManagementException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TrustStrategy acceptingTrustStrategy = (X509Certificate[] chain, String authType) -&gt; true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SSLContext sslContext = org.apache.http.ssl.SSLContexts.custom()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .loadTrustMaterial(null, acceptingTrustStrategy)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SSLConnectionSocketFactory csf = new SSLConnectionSocketFactory(sslContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CloseableHttpClient httpClient = HttpClients.custom()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setSSLSocketFactory(csf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpComponentsClientHttpRequestFactory requestFactory =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new HttpComponentsClientHttpRequestFactory();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requestFactory.setHttpClient(httpClient);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requestFactory.setConnectTimeout(60 * 1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requestFactory.setReadTimeout(60 * 1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RestTemplate restTemplate = new RestTemplate(requestFactory);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        restTemplate.getMessageConverters().set(1, new StringHttpMessageConverter(StandardCharsets.UTF_8));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return restTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="143-requestcontextholder">14.3. RequestContextHolder<a href="#143-requestcontextholder" class="hash-link" aria-label="Direct link to 14.3. RequestContextHolder" title="Direct link to 14.3. RequestContextHolder">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .getRequestAttributes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpServletRequest request = attributes.getRequest();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="144-解决-api-版本共存">14.4. 解决 api 版本共存<a href="#144-解决-api-版本共存" class="hash-link" aria-label="Direct link to 14.4. 解决 api 版本共存" title="Direct link to 14.4. 解决 api 版本共存">​</a></h2><p><a href="https://blog.csdn.net/j903829182/article/details/81836551" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/j903829182/article/details/81836551</a>, <a href="https://www.cnblogs.com/huanshilang/p/12097048.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/huanshilang/p/12097048.html</a> 放在 url
TODO</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1441-requestmappinghandlermapping">14.4.1. RequestMappingHandlerMapping<a href="#1441-requestmappinghandlermapping" class="hash-link" aria-label="Direct link to 14.4.1. RequestMappingHandlerMapping" title="Direct link to 14.4.1. RequestMappingHandlerMapping">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1442-request-matcher">14.4.2. request matcher<a href="#1442-request-matcher" class="hash-link" aria-label="Direct link to 14.4.2. request matcher" title="Direct link to 14.4.2. request matcher">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private RequestMatcher matcherHtml = new AntPathRequestMatcher(&quot;/**&quot;, &quot;GET&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">把ServletRequest转化成HttpServletRequest,强转即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">调用matches方法进行匹配 boolean matches(HttpServletRequest request)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1443-request-condition">14.4.3. request condition<a href="#1443-request-condition" class="hash-link" aria-label="Direct link to 14.4.3. request condition" title="Direct link to 14.4.3. request condition">​</a></h3><p>在 spring mvc 中，通过DispatchServlet接收客户端发起的一个请求之后，会通过 HanderMapping 来获取对应的请求处理器；而 HanderMapping 如何找到可以处理这个请求的处理器呢，这就需要 RequestCondition 来决定了</p><p>最终的实现类可能是针对以下情况之一：路径匹配，头部匹配，请求参数匹配，可产生MIME匹配，可消费MIME匹配，请求方法匹配，或者是以上各种情况的匹配条件的一个组合</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface RequestCondition&lt;T&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 一个http接口上有多个条件规则时，用于合并</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //比如类上指定了@RequestMapping的 url 为 root - 而方法上指定的@RequestMapping的 url 为 method - 那么在获取这个接口的 url 匹配规则时，类上扫描一次，方法上扫描一次，这个时候就需要把这两个合并成一个，表示这个接口匹配root/method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    T combine(T other);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 判断是否成功，失败返回 null；否则，则返回匹配成功的条件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 举个例子来讲，如果当前请求匹配条件是一个路径匹配条件，包含多个路径匹配模板，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 并且其中有些模板和指定请求request匹配，那么返回的新建的请求匹配条件将仅仅</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 包含和指定请求request匹配的那些路径模板。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Nullable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    T getMatchingCondition(HttpServletRequest request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 多个都满足条件时，用来指定具体选择哪一个。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int compareTo(T other, HttpServletRequest request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>AbstractRequestCondition 实现了equals,hashCode和toString 通用方法, 还通过protected抽象方法约定了实现类其他的一些内部通用逻辑</p><p>具体实现类:</p><ul><li>PatternsRequestCondition	路径匹配条件</li><li>RequestMethodsRequestCondition	请求方法(get post delete..)匹配条件</li><li>ParamsRequestCondition	请求参数匹配条件</li><li>HeadersRequestCondition	头部信息匹配条件</li><li>ConsumesRequestCondition	可消费MIME匹配条件</li><li>ProducesRequestCondition	可生成MIME匹配条件</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="145-接收参数相关的注解">14.5. 接收参数相关的注解<a href="#145-接收参数相关的注解" class="hash-link" aria-label="Direct link to 14.5. 接收参数相关的注解" title="Direct link to 14.5. 接收参数相关的注解">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RequestParam 可以用于从query parameters, form data, 和parts in multipart requests中获取参数。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">即GET请求和POST（application/x-www-form-urlencoded ，multipart/form-data）请求的参数都可以使用@RequestParam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequestPart 用在multipart/form-data表单提交请求的方法上，支持的请求方法的方式MultipartFile，属于Spring的MultipartResolver类。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 前三种支持 application/x-www-form-urlencoded;charset=UTF-8’ 格式 (表单提交), 是浏览器默认的编码格式。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// multipart/form-data 格式 区别: 不会对参数编码，使用的boundary(分割线)，相当于&amp;，boundary的值是----Web**AJv3。 文件上传必须要这种格式, 也可用于键值对参数，最后连接成一串字符传输 (ref: https://www.jianshu.com/p/53b5bd0f1d44)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @requestParam 注解方法参数, 可省略, 可以有多个</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ApiOperation(&quot;查询用户&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostMapping(&quot;/detailByParam&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void detailByParam(@RequestParam (value = &quot;id&quot;) Integer id,@RequestParam(value = &quot;roleName&quot;) String roleName,@RequestParam(value = &quot;roleDes&quot;) String roleDes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;&gt;&gt;&gt;id=&quot;+id+&quot;,roleName=&quot;+roleName+&quot;,roleDes=&quot;+roleDes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // &gt;&gt;&gt;id=1,roleName=admin,roleDes=拥有admin权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ApiOperation(&quot;查询用户&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostMapping(&quot;/detailByParam&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void detailByParam(@RequestParam Map&lt;String, String&gt; params) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;&gt;&gt;&gt;id=&quot;+params.get(&quot;id&quot;)+&quot;,roleName=&quot;+params.get(&quot;roleName&quot;)+&quot;,roleDes=&quot;+params.get(&quot;roleDes&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // &gt;&gt;&gt;id=1,roleName=admin,roleDes=拥有admin权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ApiOperation(&quot;查询用户&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostMapping(&quot;/detailByParam&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void detailByParam(@RequestBody String params) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;&gt;&gt;&gt;&quot;+params);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // &gt;&gt;&gt;id=1&amp;roleName=admin&amp;roleDes=%E6%8B%A5%E6%9C%89admin%E6%9D%83%E9%99%90</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 参数用 &amp; 隔离开, 对于Get请求，是将参数转换?key=value&amp;key=value格式，连接到url后</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 如果参数值中需要&amp;，则必须对其进行编码。编码格式就是application/x-www-form-urlencoded（将键值对的参数用&amp;连接起来，如果有空格，将空格转换为+加号；有特殊符号，将特殊符号转换为ASCII HEX值）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 仅支持 application/json  格式, 不支持 application/x-www-form-urlencoded;charset=UTF-8’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ApiOperation(&quot;查询用户&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostMapping(&quot;/detailByParam&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void detailByParam(@RequestBody GetRoleParam getRoleParam) {// @RequestBody 注解参数, 不可省略, 最多只能一个</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;&gt;&gt;&gt;&quot;+getRoleParam); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="146-自定义接收参数类型">14.6. 自定义接收参数类型<a href="#146-自定义接收参数类型" class="hash-link" aria-label="Direct link to 14.6. 自定义接收参数类型" title="Direct link to 14.6. 自定义接收参数类型">​</a></h2><p>若果只是一个两个类型需要转换, 直接实现  org.springframework.core.convert.converter.Converter 然后标注 component 即可 (包含连个泛型, 第一个是请求中原始类型如 Integer, 第二个泛型是 希望转换后的类型如 enum),</p><p>对 get/post 请求都有效</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 例子</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class StringToDateConverter implements Converter&lt;String, Date&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private SimpleDateFormat simpleDateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Date convert(String s) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Date parse = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            parse = simpleDateFormat.parse(s);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (ParseException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return parse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 实例案例: 枚举转换</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class QueryRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private GenderEnum gender;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@GetMapping(&quot;/get&quot;)//gender 只能接收到 MALE 、FEMALE 这样的参数，除此以外，均会报类型不匹配的错误信息，此时是无法处理 0 、1 这样的参数的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public Dict testGet(QueryRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log.info(&quot;【get-request】= {}&quot;, JSONUtil.toJsonStr(request));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Dict.create().set(&quot;get-request&quot;, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@PostMapping(&quot;/post&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public Dict testPost(@RequestBody QueryRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log.info(&quot;【post-request】= {}&quot;, JSONUtil.toJsonStr(request));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Dict.create().set(&quot;post-request&quot;, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 增加一个转换器即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class IntegerCodeToGenderEnumConverter implements Converter&lt;Integer, GenderEnum&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Map&lt;Integer, GenderEnum&gt; enumMap = Maps.newHashMap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public IntegerCodeToGenderEnumConverter() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (GenderEnum genderEnum : GenderEnum.values()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enumMap.put(genderEnum.getCode(), genderEnum);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public GenderEnum convert(Integer source) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GenderEnum genderEnum = enumMap.get(source);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ObjectUtil.isNull(genderEnum)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new IllegalArgumentException(&quot;无法匹配对应的枚举类型&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return genderEnum;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当我们的枚举类特别多的时候, 不使用上面直接使用 Converter 的这种方法，我们引入 ConverterFactory 来解决这个问题</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//通用枚举接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface BaseEnum {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 获取枚举编码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return 编码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Integer getCode();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Getter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public enum GenderEnum implements BaseEnum {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 男</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MALE(0),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 女</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FEMALE(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 性别编码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Integer code;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GenderEnum(int code) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.code = code;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class IntegerToEnumConverter&lt;T extends BaseEnum&gt; implements Converter&lt;Integer, T&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Map&lt;Integer, T&gt; enumMap = Maps.newHashMap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public IntegerToEnumConverter(Class&lt;T&gt; enumType) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        T[] enums = enumType.getEnumConstants();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (T e : enums) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enumMap.put(e.getCode(), e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public T convert(Integer source) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        T t = enumMap.get(source);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ObjectUtil.isNull(t)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new IllegalArgumentException(&quot;无法匹配对应的枚举类型&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//创建对应的自定义 ConverterFactory 工厂类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class IntegerCodeToEnumConverterFactory implements ConverterFactory&lt;Integer, BaseEnum&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Map&lt;Class, Converter&gt; CONVERTERS = Maps.newHashMap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 获取一个从 Integer 转化为 T 的转换器，T 是一个泛型，有多个实现</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param targetType 转换后的类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return 返回一个转化器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public &lt;T extends BaseEnum&gt; Converter&lt;Integer, T&gt; getConverter(Class&lt;T&gt; targetType) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Converter&lt;Integer, T&gt; converter = CONVERTERS.get(targetType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (converter == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            converter = new IntegerToEnumConverter&lt;&gt;(targetType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CONVERTERS.put(targetType, converter);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return converter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 注册工厂</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WebMvcConfig implements WebMvcConfigurer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 枚举类的转换器工厂 addConverterFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void addFormatters(FormatterRegistry registry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry.addConverterFactory(new IntegerCodeToEnumConverterFactory());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry.addConverterFactory(new StringCodeToEnumConverterFactory());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="147-返回图片">14.7. 返回图片<a href="#147-返回图片" class="hash-link" aria-label="Direct link to 14.7. 返回图片" title="Direct link to 14.7. 返回图片">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping(value = &quot;/image&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ImageController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(value = &quot;/get&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ResponseBody</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void getImage(HttpServletResponse response) throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        File file = new File(&quot;D:/test.jpg&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FileInputStream inputStream = new FileInputStream(file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] bytes = new byte[inputStream.available()];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response.setContentType(&quot;image/jpeg&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OutputStream out = response.getOutputStream();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       out.write(result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       out.flush();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       //关闭响应输出流</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       out.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping(value = &quot;/image&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ImageController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(value = &quot;/get&quot;,produces = MediaType.IMAGE_JPEG_VALUE) //如果是网页的话，produces = MediaType.TEXT_HTML</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ResponseBody</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public byte[] getImage() throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        File file = new File(&quot;D:/test.jpg&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FileInputStream inputStream = new FileInputStream(file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] bytes = new byte[inputStream.available()];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inputStream.read(bytes, 0, inputStream.available());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return bytes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="148-rest-api-文档">14.8. rest api 文档<a href="#148-rest-api-文档" class="hash-link" aria-label="Direct link to 14.8. rest api 文档" title="Direct link to 14.8. rest api 文档">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1481-knife4j">14.8.1. knife4j<a href="#1481-knife4j" class="hash-link" aria-label="Direct link to 14.8.1. knife4j" title="Direct link to 14.8.1. knife4j">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1482-springdoc-openapi">14.8.2. springdoc-openapi<a href="#1482-springdoc-openapi" class="hash-link" aria-label="Direct link to 14.8.2. springdoc-openapi" title="Direct link to 14.8.2. springdoc-openapi">​</a></h3><p><a href="https://springdoc.org/" target="_blank" rel="noopener noreferrer">https://springdoc.org/</a></p><p><a href="https://www.baeldung.com/spring-rest-openapi-documentation" target="_blank" rel="noopener noreferrer">https://www.baeldung.com/spring-rest-openapi-documentation</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1483-swagger3">14.8.3. swagger3<a href="#1483-swagger3" class="hash-link" aria-label="Direct link to 14.8.3. swagger3" title="Direct link to 14.8.3. swagger3">​</a></h3><p>访问 /swagger-ui.html or /swagger-ui/index.html (springdoc.swagger-ui.path=/swagger-ui.html)</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">io.springfox</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">springfox-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@EnableOpenApi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@MapperScan(basePackages = {&quot;cn.ruiyeclub.dao&quot;})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Swagger3Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication.run(Swagger3Application.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Swagger3Config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Docket createRestApi() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new Docket(DocumentationType.OAS_30)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .apiInfo(apiInfo())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .select()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .apis(RequestHandlerSelectors.withMethodAnnotation(ApiOperation.class))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .paths(PathSelectors.any())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 协议使用 http; 默认是 https</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .protocols(Stream.of(&quot;http&quot;).collect(Collectors.toSet()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ApiInfo apiInfo() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new ApiInfoBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .title(&quot;Swagger3接口文档&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .version(&quot;1.0&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1484-集成swagger2">14.8.4. 集成swagger2<a href="#1484-集成swagger2" class="hash-link" aria-label="Direct link to 14.8.4. 集成swagger2" title="Direct link to 14.8.4. 集成swagger2">​</a></h3><p><a href="http://springfox.github.io/springfox/docs/snapshot/#springfox-spring-mvc-and-spring-boot" target="_blank" rel="noopener noreferrer">http://springfox.github.io/springfox/docs/snapshot/#springfox-spring-mvc-and-spring-boot</a></p><ul><li>swagger2配置类，和APP启动类同级，@Configuration，@EnableSwagger2</li><li>访问：http://localhost:8080/swagger-ui.html</li><li>配置mvc时候， 如果继承了WebMvcConfigurationSupport， 需要重新注入资源文件， 否则访问不到swagger-ui.html;(<a href="https://blog.csdn.net/zjcjava/article/details/78064264" target="_blank" rel="noopener noreferrer">ref</a>)</li><li>分环境开启 <ul><li>在配置类上标注 @Profile({&quot;dev&quot;,&quot;test&quot;})</li><li>或者 在new Docket里添加.Enable(true/false)方法</li></ul></li><li>springfox.documentation.swagger-ui.enabled=false 生产 env 下 close</li></ul><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 会引入 谷歌的 guava --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 版本可省略 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">io.springfox</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">springfox-swagger2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2.6.1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">io.springfox</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">springfox-swagger-ui</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2.6.1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableSwagger2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Swagger2Config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 添加 swagger 静态资源处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 一般我们会设置 mvc 中, spring.resources.add-mappings=false, 对静态资源默认不处理, 这是需要为 swagger 添加例外 (还会设置 spring.mvc.throw-exception-if-no-handler-found=true 没找到 Handler时直接抛出异常)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//    public WebMvcConfigurer swaggerPassConfigure() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//        return new WebMvcConfigurer() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            public void addResourceHandlers(ResourceHandlerRegistry registry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                registry.addResourceHandler(&quot;swagger-ui.html&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                        .addResourceLocations(&quot;classpath:/META-INF/resources/&quot;, &quot;/static&quot;, &quot;/public&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                registry.addResourceHandler(&quot;/webjars/**&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                        .addResourceLocations(&quot;classpath:/META-INF/resources/webjars/&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Docket api() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ParameterBuilder ticketPar = new ParameterBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;Parameter&gt; pars = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ticketPar.name(&quot;Access-Token&quot;).description(&quot;Rest接口权限认证token,无需鉴权可为空&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .modelRef(new ModelRef(&quot;string&quot;)).parameterType(&quot;header&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //header中的ticket参数非必填，传空也可以</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .required(false).build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //根据每个方法名也知道当前方法在设置什么参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pars.add(ticketPar.build());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new Docket(DocumentationType.SWAGGER_2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .apiInfo(apiInfo())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .select()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 根据包名扫描controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 自行修改为自己的包路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .apis(RequestHandlerSelectors.basePackage(&quot;com.tgpms&quot;)) // 多包配置: https://www.jianshu.com/p/78309feb5d5a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 扫描所有controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // .apis(RequestHandlerSelectors.any()) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 指定扫描部分注解标注的 controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // .apis(RequestHandlerSelectors.withMethodAnnotation(Api.class/ApiOperation.class))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .paths(PathSelectors.any()) // .paths() 这个是包路径下的路径,PathSelectors.any()是包下所有路径                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 全局设置请求参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .globalOperationParameters(pars);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //生成全局通用参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // private List&lt;RequestParameter&gt; getGlobalRequestParameters() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     List&lt;RequestParameter&gt; parameters = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     parameters.add(new RequestParameterBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .name(&quot;appid&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .description(&quot;平台id&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .required(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .in(ParameterType.QUERY)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .query(q -&gt; q.model(m -&gt; m.scalarModel(ScalarType.STRING)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .required(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .build());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     parameters.add(new RequestParameterBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .name(&quot;udid&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .description(&quot;设备的唯一id&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .required(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .in(ParameterType.QUERY)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .query(q -&gt; q.model(m -&gt; m.scalarModel(ScalarType.STRING)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .required(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .build());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     parameters.add(new RequestParameterBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .name(&quot;version&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .description(&quot;客户端的版本号&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .required(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .in(ParameterType.QUERY)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .query(q -&gt; q.model(m -&gt; m.scalarModel(ScalarType.STRING)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .required(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //             .build());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //      return parameters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // //生成通用响应信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // private List&lt;Response&gt; getGlobalResonseMessage() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     List&lt;Response&gt; responseList = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     responseList.add(new ResponseBuilder().code(&quot;404&quot;).description(&quot;找不到资源&quot;).build());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //      return responseList;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ApiInfo apiInfo() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new ApiInfoBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .title(&quot;online exam by springboot&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .description(&quot;在线考试系统 by 梁山广 at 2020&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .termsOfServiceUrl(&quot;https://github.com/19920625lsg/spring-boot-online-exam&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .version(&quot;1.0&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .contact(new Contact(&quot;liangshanguang&quot;, &quot;https://github.com/19920625lsg/spring-boot-online-exam&quot;, &quot;liangshanguang2@gmail.com&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Api(&quot;测试用例1&quot;) on controller class, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ApiOperation(value = &quot;apiOperationSwaggerTest&quot;, notes = &quot;apiOperationSwagger测试&quot;) on controller class method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ApiParam(name = &quot;id&quot;, value = &quot;id入参&quot;, required = true) on method params</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ApiModel(description = &quot;测试实体类&quot;, value = &quot;测试实体类&quot;) on data model class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ApiModelProperty(name = &quot;userName&quot;, value = &quot;用户名&quot;, required = false, exmaple = &quot;小明&quot;) on data module class field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ApiImplicitParams({@ApiImplicitParam(name = &quot;id&quot;, value = &quot;id入参&quot;, required = true, dataType = &quot;Integer&quot;, paramType = &quot;query&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        @ApiImplicitParam(name = &quot;brand&quot;, value = &quot;brand&quot;, required = true, dataType = &quot;BRAND&quot;, paramType = &quot;body&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }) on controller class method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ApiImplicitParams：用在请求的方法上，表示一组参数说明</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ApiImplicitParam：用在@ApiImplicitParams注解中，指定一个请求参数的各个方面</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name：参数名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value：参数的汉字说明、解释</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        required：参数是否必须传</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        paramType：参数放在哪个地方</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            · header --&gt; 请求参数的获取：@RequestHeader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            · query --&gt; 请求参数的获取：@RequestParam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            · path（用于restful接口）--&gt; 请求参数的获取：@PathVariable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            · body（不常用）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            · form（不常用）    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dataType：参数类型，默认String，其它值dataType=&quot;Integer&quot;       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        defaultValue：参数的默认值</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="149-过滤器-和-拦截器">14.9. 过滤器 和 拦截器<a href="#149-过滤器-和-拦截器" class="hash-link" aria-label="Direct link to 14.9. 过滤器 和 拦截器" title="Direct link to 14.9. 过滤器 和 拦截器">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1491-区别">14.9.1. 区别<a href="#1491-区别" class="hash-link" aria-label="Direct link to 14.9.1. 区别" title="Direct link to 14.9.1. 区别">​</a></h3><p>servlet filter和spring mvc Interceptor区别：</p><ul><li><p>Filter 是基于 函数回调的，而 Interceptor 则是基于 Java 反射 和 动态代理。</p></li><li><p>Filter 依赖于 Servlet 容器, 和servlet容器隔的近，而 Interceptor 依赖springmvc, 和应用隔的近, 在最里层。所以filter 先进入, 最后退出</p></li><li><p>Filter 对几乎 所有的请求 起作用，而 Interceptor 只对 Controller 请求起作用。</p></li><li><p>拦截器可以获取IOC容器中的各个bean，而过滤器就不行，这点很重要，在拦截器里注入一个service，可以调用业务逻辑。</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1492-使用-filter">14.9.2. 使用 filter<a href="#1492-使用-filter" class="hash-link" aria-label="Direct link to 14.9.2. 使用 filter" title="Direct link to 14.9.2. 使用 filter">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">scenario 1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">直接实现Filter接口，并使用@Component, 拦截所有路径 &quot;/*&quot;, 这种方式可以注入 bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scenario 2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">实现Filter接口，用@WebFilter注解，指定拦截路径以及一些参数，同时需要在启动类使用@ServletComponentScan扫描带@WebFilter、@WebServlet、@WebListener, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">这种方式无法注入 bean, 除非 和 @component 一起使用, 但是需要配置覆盖 bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#启用覆盖同名bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.main.allow-bean-definition-overriding=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scenario 3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MyFilterConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MyFilter myFilter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public FilterRegistrationBean&lt;MyFilter&gt; thirdFilter() { // 泛型指定 filter 类型, so 多个 filter 每个都要一个 bean 方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FilterRegistrationBean&lt;MyFilter&gt; filterRegistrationBean = new FilterRegistrationBean&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filterRegistrationBean.setOrder(2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filterRegistrationBean.setFilter(myFilter);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filterRegistrationBean.setUrlPatterns(new ArrayList&lt;&gt;(Arrays.asList(&quot;/api/*&quot;)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return filterRegistrationBean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">和 这里的 filter 不同, 这里是为了过滤 扫描</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ComponentScan(value=&quot;com.wxj&quot;,excludeFilters= {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Filter(type=FilterType.ANNOTATION,classes= {Controller.class})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1493-使用-interceptor">14.9.3. 使用 interceptor<a href="#1493-使用-interceptor" class="hash-link" aria-label="Direct link to 14.9.3. 使用 interceptor" title="Direct link to 14.9.3. 使用 interceptor">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="14931-基本使用拦截器">14.9.3.1. 基本使用拦截器<a href="#14931-基本使用拦截器" class="hash-link" aria-label="Direct link to 14.9.3.1. 基本使用拦截器" title="Direct link to 14.9.3.1. 基本使用拦截器">​</a></h4><p><a href="https://www.baeldung.com/spring-mvc-handlerinterceptor" target="_blank" rel="noopener noreferrer">https://www.baeldung.com/spring-mvc-handlerinterceptor</a></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">实现 HandlerInterceptor 接口,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class InterfaceAuthCheckInterceptor implements HandlerInterceptor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private Logger logger = LoggerFactory.getLogger(getClass());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StringRedisTemplate stringRedisTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 配置      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class InterceptorConfig implements WebMvcConfigurer { // WebMvcConfigurerAdapter 过时, WebMvcConfigurationSupport, 对于 classpath:/META/resources/，classpath:/resources/，classpath:/static/，classpath:/public/）不生效, 所以选择WebMvcConfigurer 最好</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @autowire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .... interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void addInterceptors(InterceptorRegistry registry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 多个拦截器组成一个拦截器链, 加入的顺序就是拦截器执行的顺序, 也可使用 @order(-1/0/1...)指定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // addPathPatterns 用于添加拦截规则, 默认拦截所有 即 /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // excludePathPatterns 用户排除拦截</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry.addInterceptor(interceptor).addPathPatterns(&quot;/api/**&quot;).exclude(&quot;...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="14932-基于-url-拦截">14.9.3.2. 基于 url 拦截<a href="#14932-基于-url-拦截" class="hash-link" aria-label="Direct link to 14.9.3.2. 基于 url 拦截" title="Direct link to 14.9.3.2. 基于 url 拦截">​</a></h4><p>一种方式是 在配置中 registry.addInterceptor(interceptor).addPathPatterns(&quot;/api/**&quot;).exclude(&quot;...&quot;);</p><p>一种是直接在 prehandle() 中处理 String path = request.getServletPath(), path.matches(Const.NO_INTERCEPTOR_PATH 就是基于正则匹配的url </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="14933-基于注解拦截">14.9.3.3. 基于注解拦截<a href="#14933-基于注解拦截" class="hash-link" aria-label="Direct link to 14.9.3.3. 基于注解拦截" title="Direct link to 14.9.3.3. 基于注解拦截">​</a></h4><p>interceptor 也属于 aop, </p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class AuthorityInterceptor extends HandlerInterceptorAdapter{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 如果不是映射到方法直接通过</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!(handler instanceof HandlerMethod)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ①:START 方法注解级拦截器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HandlerMethod handlerMethod = (HandlerMethod) handler;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Method method = handlerMethod.getMethod();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 判断接口是否需要登录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        LoginRequired methodAnnotation = method.getAnnotation(LoginRequired.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 有 @LoginRequired 注解，需要认证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (methodAnnotation != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 这写你拦截需要干的事儿，比如取缓存，SESSION，权限判断等</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(&quot;====================================&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1410-servlet-druid-监控">14.10. servlet Druid 监控<a href="#1410-servlet-druid-监控" class="hash-link" aria-label="Direct link to 14.10. servlet Druid 监控" title="Direct link to 14.10. servlet Druid 监控">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class DruidConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DataSource druid(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return  new DruidDataSource();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //配置Druid的监控</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //1、配置一个管理后台的Servlet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ServletRegistrationBean statViewServlet(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ServletRegistrationBean bean = new ServletRegistrationBean(new StatViewServlet(), &quot;/druid/*&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String,String&gt; initParams = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        initParams.put(&quot;loginUsername&quot;,&quot;admin&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        initParams.put(&quot;loginPassword&quot;,&quot;123456&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        initParams.put(&quot;allow&quot;,&quot;&quot;);//默认就是允许所有访问</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        initParams.put(&quot;deny&quot;,&quot;192.168.15.21&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bean.setInitParameters(initParams);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //2、配置一个web监控的filter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public FilterRegistrationBean webStatFilter(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FilterRegistrationBean bean = new FilterRegistrationBean();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bean.setFilter(new WebStatFilter());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String,String&gt; initParams = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        initParams.put(&quot;exclusions&quot;,&quot;*.js,*.css,/druid/*&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bean.setInitParameters(initParams);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bean.setUrlPatterns(Arrays.asList(&quot;/*&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return  bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1411-aop-整合使用">14.11. aop 整合使用<a href="#1411-aop-整合使用" class="hash-link" aria-label="Direct link to 14.11. aop 整合使用" title="Direct link to 14.11. aop 整合使用">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="14111-基本使用">14.11.1. 基本使用<a href="#14111-基本使用" class="hash-link" aria-label="Direct link to 14.11.1. 基本使用" title="Direct link to 14.11.1. 基本使用">​</a></h3><p>通知执行顺序: around &gt; before &gt; around &gt; after &gt; afterReturning</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 只需要spring-boot-starter-aop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//@EnableAspectJAutoProxy// 无需, 自动开启,引入依赖后</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component //必须</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Aspect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ReqCheckAop {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ObjectMapper objectMapper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Pointcut(&quot;execution(org.springframework.http.ResponseEntity&lt;Resp&gt; io.github.xiaoyureed.demo..*.*(..))&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void pointcut() {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Around(&quot;pointcut()&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object reqCheck(ProceedingJoinPoint jp) throws Throwable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object[] args = jp.getArgs();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;&gt;&gt;&gt; req = &quot; + objectMapper.writeValueAsString(args[0]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return jp.proceed();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="14112-切入点表达式">14.11.2. 切入点表达式<a href="#14112-切入点表达式" class="hash-link" aria-label="Direct link to 14.11.2. 切入点表达式" title="Direct link to 14.11.2. 切入点表达式">​</a></h3><p>用来指定增强哪些方法</p><p><a href="https://www.cnblogs.com/ityangshuai/p/11923696.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/ityangshuai/p/11923696.html</a></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.execution(xxx)  用于确定方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    表达式格式(就是方法签名)：修饰符  返回值  包.类.方法(参数列表) throws 异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1.1 修饰符 （可选），一般不使用 ----------- 接空格</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            public        公共修饰符</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            *            任意修饰符</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1.2 返回值， 复杂类型需要全限定名称，常用 ----------- 接空格</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String        返回字符串</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            *            返回任意</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1.3 包    ，常用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            com.xiaoyu.spring.learn.service            指定service包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            com.xiaoyu.spring.learn.crm.*.service                crm项目下的任意子模块（子文件夹）的service包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            com.xiaoyu.spring.learn.service..            service目录包含的所有目录（包括次级子目录等等）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            com.xiaoyu.spring.learn.crm.*.service..                crm下所有的子模块中service目录包含的所有目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1.4 类，常用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            UserService                指定类名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            User*                    以User开头类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            *Service                    以Service结尾类（常用）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            *                        任意类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1.5 方法，常用 与 1.4类相似</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            addUser                    指定方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            add*                        add开头方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            *User                    以User结尾方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            *                        任意方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1.6 参数列表，常用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ()                        没有参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (int)                        一个参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (int,int)                    两个参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (..)                        参数任意</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1.7 异常 ，具体异常（可选）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    多表达式：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;aop:pointcut experssion=&quot;exection(表达式1)  || exection(表达式2) &quot;&gt;    ：表达式1或 表达式2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    综合案例：execution(* com.xiaoyu.spring.learn.crm.*.service..*.*(..))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        含义：    返回值任意，crm项目下的任意子目录中的的service目录下的所有目录中的任意类的任意方法，参数任意。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- within(): 只能指定 包.类; 再下面的粒度就没办法了, 所以相当于 execution() 的简化版</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    within(com.xiaoyu.spring.learn.aop..*)匹配aop 包/子包下的所有类的所有方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    指定注解类亦可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    within(@org.springframework.web.bind.annotation.RestController *) 匹配 被 指定注解标注的所有类的所有方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- this(): 用于向通知方法中传入代理对象的引用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    如:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Before(&quot;before() &amp;&amp; this(proxy)&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void beforeAdvide(JoinPoint point, Object proxy){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- target(): 用于向通知方法中传入目标对象的引用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- args() ：用于将参数传入到通知方法中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    如:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Before(&quot;before() &amp;&amp; args(age,username)&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void beforeAdvide(JoinPoint point, int age, String username){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    如 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Pointcut(&quot;execution(public * com.example.demo.aop.AopController.xxxMethod(int)) &amp;&amp; args(point))&quot;) 会将拦截到的方法的 int 类型参数 传递到 aop 方法中, 使用 point 接受即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- @within ：用于匹配在类一级使用了注解的类，其所有方法都将被匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Pointcut(&quot;@within(com.cjm.annotation.AdviceAnnotation)&quot;) － 所有被@AdviceAnnotation标注的类都将匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    常用:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Pointcut(&quot;@annotation(AopLog) || @within(AopLog)&quot;) - 被 aopLog 标注的类 or 方法被拦截</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- @target ：和@within的功能类似，但必须要指定注解的保留策略为RUNTIME。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    存疑?@target() 指定目标类型, 所有这个类型的类都会被匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @target(com.xiaoyu.spring.learn.aop.user.IUserDAO)匹配 IUserDAO 的所有实现类, 类中的方法都会被代理, 包括未在接口中声明的方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- @args() 指定一个注解, 表示要拦截方法的参数需要带有这个注解</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- @bean(id值) 对指定的目标对象的类进行匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- @annotation(参数中注解参数名称) 匹配被指定注解标注的方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    如: 下面表示 -&gt; 匹配 web 包/子包下所有类的所有方法 且方法被 @CheckReqNo 标注 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Around(&quot;within(io.github.xiaoyureed.web..*) &amp;&amp; @annotation(checkReqNo)&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void xxx(JoinPoint jp, CheckReqNo checkReqNo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-  可以使用 &amp;&amp;, ||, ! 运算符来定义切点表达式</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1412-controlleradvice-异常处理">14.12. @controllerAdvice 异常处理<a href="#1412-controlleradvice-异常处理" class="hash-link" aria-label="Direct link to 14.12. @controllerAdvice 异常处理" title="Direct link to 14.12. @controllerAdvice 异常处理">​</a></h2><p>全局异常处理 全局数据绑定 全局请求数据预处理</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@ControllerAdvice //@ControllerAdvice注解 可以通过 assignableTypes 指定特定的类，让异常处理类只处理特定类抛出的异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MyGlobalExceptionHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 直接返回 web 页面</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ExceptionHandler(Exception.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ModelAndView customException(Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ModelAndView mv = new ModelAndView();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mv.addObject(&quot;message&quot;, e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mv.setViewName(&quot;myerror&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return mv;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 返回 json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @exception..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @respbody // 如果类上使用的是@RestControllerAdvice, 那么 返回 json 无需 @ResponseBody, 只需要 @ExceptionHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public respseentiyt xxx(Exception ex) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 绑定 md 到每个 controler 中的方法参数中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ModelAttribute(name = &quot;md&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Map&lt;String,Object&gt; mydata() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        map.put(&quot;age&quot;, 99);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        map.put(&quot;gender&quot;, &quot;男&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // controller 中这么使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping(&quot;/hello&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String hello(Model model) {// 或者 @ModelAttribute(&quot;md&quot;) Map&lt;String, Object&gt; md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, Object&gt; map = model.asMap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(map);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int i = 1 / 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;hello controller advice&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 请求数据预处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 如此, 请求参数就可以传递这样的参数: a.name=xxx, b.name=yyy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // controller 中这样获取 @ModelAttribute(&quot;b&quot;) Book book, @ModelAttribute(&quot;a&quot;) Author author</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @InitBinder(&quot;b&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void b(WebDataBinder binder) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        binder.setFieldDefaultPrefix(&quot;b.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @InitBinder(&quot;a&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void a(WebDataBinder binder) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        binder.setFieldDefaultPrefix(&quot;a.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>处理异常的其他方法:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@ExceptionHandler(value = Exception.class)// 拦截所有异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;ErrorResponse&gt; exceptionHandler(Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (e instanceof IllegalArgumentException) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ResponseEntity.status(400).body(illegalArgumentResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (e instanceof ResourceNotFoundException) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ResponseEntity.status(404).body(resourseNotFoundResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@GetMapping(&quot;/resourceNotFoundException2&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void throwException3() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new ResponseStatusException(HttpStatus.NOT_FOUND, &quot;Sorry, the resourse not found!&quot;, new ResourceNotFoundException());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1413-httpservletrequest-的输入流只能读取一次的问题">14.13. HttpServletRequest 的输入流只能读取一次的问题<a href="#1413-httpservletrequest-的输入流只能读取一次的问题" class="hash-link" aria-label="Direct link to 14.13. HttpServletRequest 的输入流只能读取一次的问题" title="Direct link to 14.13. HttpServletRequest 的输入流只能读取一次的问题">​</a></h2><p><a href="https://www.cnblogs.com/JAYIT/p/10943155.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/JAYIT/p/10943155.html</a></p><p>还是推荐使用 aop 去切 controller 更方便一点</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1414-路由处理">14.14. 路由处理<a href="#1414-路由处理" class="hash-link" aria-label="Direct link to 14.14. 路由处理" title="Direct link to 14.14. 路由处理">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="14141-静态资源映射-暴露静态资源">14.14.1. 静态资源映射 暴露静态资源<a href="#14141-静态资源映射-暴露静态资源" class="hash-link" aria-label="Direct link to 14.14.1. 静态资源映射 暴露静态资源" title="Direct link to 14.14.1. 静态资源映射 暴露静态资源">​</a></h3><p>暴露图片资源</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ImageConfig implements WebMvcConfigure {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void addResourceHandlers(ResourceHandlerRegistry registry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry.addResourceHandler(&quot;/images/**&quot;) //addResourceLocations指的是文件放置的目录，addResoureHandler指的是对外暴露的访问路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .addResourceLocations(&quot;file:./localdata/images/&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>分环境暴露配置文件</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 配置文件访问地址 (注意每个访问路径后面的路径加 / !!!)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ## windows系统下访问路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// uploadWindow: E:\common\file\root\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ## windows系统下访问路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// uploadLinux: /user/img/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">protected void addResourceHandlers(ResourceHandlerRegistry registry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String os = System.getProperty(&quot;os.name&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //如果是Windows系统</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (os.toLowerCase().startsWith(&quot;win&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry.addResourceHandler(&quot;/app_file/**&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // /app_file/**表示在磁盘filePathWindow目录下的所有资源会被解析为以下的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .addResourceLocations(&quot;file:&quot; + filePathWindow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {  //linux 和mac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry.addResourceHandler(&quot;/app_file/**&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .addResourceLocations(&quot;file:&quot; + filePathLinux) ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    super.addResourceHandlers(registry);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>还有个例子, --&gt; swagger 静态资源处理 (放行 相关的静态页面)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="14142-添加-view-controller">14.14.2. 添加 view controller<a href="#14142-添加-view-controller" class="hash-link" aria-label="Direct link to 14.14.2. 添加 view controller" title="Direct link to 14.14.2. 添加 view controller">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MvcConfig implements WebMvcConfigurer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 添加 view controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 将 url path 和 template 对应, 无需添加任何的 controller 代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void addViewControllers(ViewControllerRegistry registry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry.addViewController(&quot;/home&quot;).setViewName(&quot;home&quot;);// 等价 访问 /home , controller 返回 &quot;home&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry.addViewController(&quot;/&quot;).setViewName(&quot;home&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry.addViewController(&quot;/hello&quot;).setViewName(&quot;hello&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry.addViewController(&quot;/login&quot;).setViewName(&quot;login&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry.addViewController(&quot;/admin-page&quot;).setViewName(&quot;admin-page&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1415-spring-boot-starter-thymeleaf">14.15. spring-boot-starter-thymeleaf<a href="#1415-spring-boot-starter-thymeleaf" class="hash-link" aria-label="Direct link to 14.15. spring-boot-starter-thymeleaf" title="Direct link to 14.15. spring-boot-starter-thymeleaf">​</a></h2><p>thymeleaf 和 spring security 配合使用 <code>sec</code> 标签: <a href="https://www.jianshu.com/p/bb3a3b388c4e" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/bb3a3b388c4e</a></p><p>springboot默认  static/public 中放静态页面，而templates中放动态页面即 thymeleaf 模板</p><p>静态页面: 直接在static放一个hello.html,然后直接输入http://localhost:8080/hello.html 便能成功访问 (关闭这个特性需要 spring.resources.add-mappings: false), 也可以通过controller跳转 <code>return &quot;hello.html&quot;;</code></p><p>动态页面: 需要 <code>spring-boot-starter-thymeleaf</code>, 静态页面的return默认是跳转到/static/index.html，当在pom.xml中引入了thymeleaf组件，动态跳转会覆盖默认的静态跳转，默认就会跳转到/templates/index.html，注意看两者return代码也有区别，动态没有html后缀, 如果在使用动态页面时还想跳转到/static/index.html，可以使用重定向return &quot;redirect:/index.html&quot;</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping(&quot;/Hi&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String sayHello() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;hello&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping(&quot;/Hi&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public ModelAndView sayHello() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ModelAndView modelAndView = new ModelAndView();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    modelAndView.setViewName(&quot;hello&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    modelAndView.addObject(&quot;key&quot;, 12345);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //System.out.println(&quot;test&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return modelAndView;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping(&quot;/Hi&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public String sayHello(Map&lt;String,obj&gt; map) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    map.put(&quot;stu&quot;, new Stu())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return &quot;hello&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>配置:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#spring配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mvc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">servlet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">load-on-startup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">datasource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver-class-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.mysql.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3306/springbootssm</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">serverTimezone=GMT%2B8</span><span class="token important">&amp;useUnicode=true&amp;characterEncoding=utf-</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">thymeleaf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#关闭缓存</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HTML5 </span><span class="token comment" style="color:#999988;font-style:italic">#设置模板类型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">encoding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> utf</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#设置编码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prefix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/templates/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">suffix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">type=text/html </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>15. 运维部署</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="151-支持-https-ssl">15.1. 支持 https ssl<a href="#151-支持-https-ssl" class="hash-link" aria-label="Direct link to 15.1. 支持 https ssl" title="Direct link to 15.1. 支持 https ssl">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1511-nginx-配置-https">15.1.1. nginx 配置 https<a href="#1511-nginx-配置-https" class="hash-link" aria-label="Direct link to 15.1.1. nginx 配置 https" title="Direct link to 15.1.1. nginx 配置 https">​</a></h3><p>Let&#x27;s Encrypt 或者阿里云, 腾讯云 支持 面粉 ssl 证书 , 一年有效期, 过期再次申请 </p><p><a href="https://segmentfault.com/a/1190000016760251" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000016760251</a> 使用 lets encrypt 配置 nginx</p><p><a href="https://www.cnblogs.com/to-red/p/12450616.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/to-red/p/12450616.html</a>
<a href="https://www.cnblogs.com/chnmig/p/10343890.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/chnmig/p/10343890.html</a>
<a href="https://blog.csdn.net/fenglin0429/article/details/81347634" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/fenglin0429/article/details/81347634</a>
<a href="https://www.nonelonely.com/article/1584965619600" target="_blank" rel="noopener noreferrer">https://www.nonelonely.com/article/1584965619600</a> nginx 配置 http  转https, 代理 springboot
<a href="https://ask.csdn.net/questions/701009" target="_blank" rel="noopener noreferrer">https://ask.csdn.net/questions/701009</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1512-支持-https-访问">15.1.2. 支持 https 访问<a href="#1512-支持-https-访问" class="hash-link" aria-label="Direct link to 15.1.2. 支持 https 访问" title="Direct link to 15.1.2. 支持 https 访问">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 假设如下的 api, 希望支持 https 访问, 现在仅仅只是http访问。http://localhost:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TestApplication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication.run(TestApplication.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(value = &quot;/&quot;,produces = &quot;text/plain;charset=UTF-8&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String index(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;Hello Spring Boot!&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//生成ssl证书, 系统的当前用户目录下会生成一个keystore.p12文件, 将keystore.p12文件拷贝到我们项目的根路径下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 1.-storetype 指定密钥仓库类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 2.-keyalg 生证书的算法名称，RSA是一种非对称加密算法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 3.-keysize 证书大小</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 4.-keystore 生成的证书文件的存储路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 5.-validity 证书的有效期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keytool -genkey -alias tomcat  -storetype PKCS12 -keyalg RSA -keysize 2048  -keystore keystore.p12 -validity 3650</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 修改配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server.ssl.key-store=keystore.p12 //路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server.ssl.key-store-password=123456 //生成ssl证书时设置的密钥库的口令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server.ssl.keyStoreType=PKCS12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server.ssl.keyAlias = tomcat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//此时工程已经支持https访问。 https://localhost:8080/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1513-http-请求自动转为-https">15.1.3. http 请求自动转为 https<a href="#1513-http-请求自动转为-https" class="hash-link" aria-label="Direct link to 15.1.3. http 请求自动转为 https" title="Direct link to 15.1.3. http 请求自动转为 https">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 配置访问http  urL 时自动转到https。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 配置后, 访问 https://localhost:8081/ 正常, 访问 http://localhost:8080/，我们可以看到页面的url变成了https://localhost:8081/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public EmbeddedServletContainerFactory servletContainer() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TomcatEmbeddedServletContainerFactory tomcat = new TomcatEmbeddedServletContainerFactory() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            protected void postProcessContext(Context context) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SecurityConstraint constraint = new SecurityConstraint();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                constraint.setUserConstraint(&quot;CONFIDENTIAL&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SecurityCollection collection = new SecurityCollection();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                collection.addPattern(&quot;/*&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                constraint.addCollection(collection);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                context.addConstraint(constraint);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tomcat.addAdditionalTomcatConnectors(httpConnector());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return tomcat;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Connector httpConnector() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Connector connector = new Connector(&quot;org.apache.coyote.http11.Http11NioProtocol&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        connector.setScheme(&quot;http&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Connector监听的http的端口号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        connector.setPort(8080);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        connector.setSecure(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //监听到http的端口号后转向到的https的端口号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        connector.setRedirectPort(8081); // 需要设置 server.port=8081</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return connector;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1514-同时支持-http-https">15.1.4. 同时支持 http https<a href="#1514-同时支持-http-https" class="hash-link" aria-label="Direct link to 15.1.4. 同时支持 http https" title="Direct link to 15.1.4. 同时支持 http https">​</a></h3><p>用http请求时不再转换成https请求</p><p>只需要将代码中的connector.setSecure(false)中的false改成true就可以了</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="152-容器化部署">15.2. 容器化部署<a href="#152-容器化部署" class="hash-link" aria-label="Direct link to 15.2. 容器化部署" title="Direct link to 15.2. 容器化部署">​</a></h2><p><a href="https://rovo98.github.io/posts/39885a36/" target="_blank" rel="noopener noreferrer">https://rovo98.github.io/posts/39885a36/</a> SpringBoot + Docker + Nginx 负载均衡实现
TODO</p><p><a href="https://github.com/GoogleContainerTools/jib" target="_blank" rel="noopener noreferrer">https://github.com/GoogleContainerTools/jib</a> 为 java 程序构造 docker 镜像 (<a href="https://www.cnblogs.com/felordcn/p/13201163.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/felordcn/p/13201163.html</a>)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="153-nginx-反向代理">15.3. nginx 反向代理<a href="#153-nginx-反向代理" class="hash-link" aria-label="Direct link to 15.3. nginx 反向代理" title="Direct link to 15.3. nginx 反向代理">​</a></h2><p><a href="https://cloud.tencent.com/developer/article/1332603" target="_blank" rel="noopener noreferrer">https://cloud.tencent.com/developer/article/1332603</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="154-内嵌-tomcat-调优">15.4. 内嵌 tomcat 调优<a href="#154-内嵌-tomcat-调优" class="hash-link" aria-label="Direct link to 15.4. 内嵌 tomcat 调优" title="Direct link to 15.4. 内嵌 tomcat 调优">​</a></h2><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">compression</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#SpringBoot 默认是不开启 gzip 压缩的，需要我们手动开启</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#optional, 在 spring2.0+的版本中，默认值已经有了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mime-types</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> application/json</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">application/xml</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">text/html</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">text/plain</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">text/css</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">application/x</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">javascript</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#默认情况下，仅会压缩 2048 字节以上的内容, 指定超过多少就压缩</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">min-response-size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tomcat</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 排队数, 等待队列长度：队列做缓冲池用，但也不能无限长，消耗内存，出入队列也耗cpu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">accept-count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">max-connections</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#最大可被连接数，默认为10000 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#最大工作线程数, 默认 200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 4核8G内存单进程调度线程数800-1000，超过这个并发数之后，将会花费巨大的时间在cpu调度上。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">max-threads</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">800</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">min-spare-threads</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#最小工作线程数, 默认 10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 连接超时 30s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">connection-timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Maximum size, in bytes, of the HTTP message header</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">max-http-header-size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Maximum size, in bytes, of the HTTP post content.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过 java code 配置:</p><p>修改keepalivetimeout和maxKeepAliveRequests开启长连接</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//当Spring容器内没有TomcatEmbeddedServletContainerFactory这个bean时，会吧此bean加载进spring容器中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class  WebServerConfiguration implements WebServerFactoryCustomizer&lt;ConfigurableWebServerFactory&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void customize(ConfigurableWebServerFactory configurableWebServerFactory) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //使用对应工厂类提供给我们的接口定制化我们的tomcat connector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ((TomcatServletWebServerFactory)configurableWebServerFactory).addConnectorCustomizers(new TomcatConnectorCustomizer() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            public void customize(Connector connector) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Http11NioProtocol protocol = (Http11NioProtocol) connector.getProtocolHandler();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //定制化keepalivetimeout,设置30秒内没有请求则服务端自动断开keepalive链接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                protocol.setKeepAliveTimeout(30000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //当客户端发送超过10000个请求则自动断开keepalive链接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                protocol.setMaxKeepAliveRequests(10000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 设置其他....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 或者这样配置, 效果等同   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WebServerConfiguration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ConfigurableServletWebServerFactory webServerFactory() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TomcatServletWebServerFactory factory = new TomcatServletWebServerFactory();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factory.setPort(11359);//端口号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factory.setUriEncoding(Charset.forName(&quot;utf-8&quot;));//编码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factory.addConnectorCustomizers(new MyTomcatConnectorCustomizer());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return factory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    class MyTomcatConnectorCustomizer implements TomcatConnectorCustomizer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void customize(Connector connector) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // TODO Auto-generated method stub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Http11NioProtocol handler = (Http11NioProtocol)connector.getProtocolHandler();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            handler.setAcceptCount(2000);//排队数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            handler.setMaxConnections(5000);//最大连接数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            handler.setMaxThreads(2000);//线程池的最大线程数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            handler.setMinSpareThreads(100);//最小线程数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            handler.setConnectionTimeout(30000);//超时时间                    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="155-配置-war-包部署到-tomcat">15.5. 配置 war 包部署到 Tomcat<a href="#155-配置-war-包部署到-tomcat" class="hash-link" aria-label="Direct link to 15.5. 配置 war 包部署到 Tomcat" title="Direct link to 15.5. 配置 war 包部署到 Tomcat">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ServletInitializer extends SpringBootServletInitializer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected SpringApplicationBuilder configure(SpringApplicationBuilder application) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return application.sources(Application.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ComponentScan(basePackageClasses = Application.class, useDefaultFilters = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ServletContextConfig extends WebMvcConfigurationSupport{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 配置servlet处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configurer.enable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者直接一步到位:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@SpringbootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Application extends SpringBootServletInitializer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected SpringApplicationBuilder configure(SpringApplicationBuilder application) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return application.sources(Application.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>16. spring boot 中的并发</h1><p><a href="https://www.e4developer.com/2018/03/30/introduction-to-concurrency-in-spring-boot/" target="_blank" rel="noopener noreferrer">https://www.e4developer.com/2018/03/30/introduction-to-concurrency-in-spring-boot/</a> //todo
<a href="https://blog.csdn.net/qq_40606397/article/details/104945855" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/qq_40606397/article/details/104945855</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="161-使用异步编程">16.1. 使用异步编程<a href="#161-使用异步编程" class="hash-link" aria-label="Direct link to 16.1. 使用异步编程" title="Direct link to 16.1. 使用异步编程">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1611-配置线程池">16.1.1. 配置线程池<a href="#1611-配置线程池" class="hash-link" aria-label="Direct link to 16.1.1. 配置线程池" title="Direct link to 16.1.1. 配置线程池">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 配置线程池</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableAsync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AsyncConfiguration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(&quot;doSomethingExecutor&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Executor doSomethingExecutor() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 核心线程数：线程池创建时候初始化的线程数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executor.setCorePoolSize(10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 最大线程数：线程池最大的线程数，只有在缓冲队列满了之后才会申请超过核心线程数的线程</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executor.setMaxPoolSize(20);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 缓冲队列：用来缓冲执行任务的队列</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executor.setQueueCapacity(500);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 允许线程的空闲时间60秒：当超过了核心线程之外的线程在空闲时间到达之后会被销毁</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executor.setKeepAliveSeconds(60);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 线程池名的前缀：设置好了之后可以方便我们定位处理任务所在的线程池</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executor.setThreadNamePrefix(&quot;do-something-&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 缓冲队列满了之后的拒绝策略：由调用线程处理（一般是主线程）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.DiscardPolicy());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executor.initialize();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return executor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1612-有返回值-没有返回值">16.1.2. 有返回值 没有返回值<a href="#1612-有返回值-没有返回值" class="hash-link" aria-label="Direct link to 16.1.2. 有返回值 没有返回值" title="Direct link to 16.1.2. 有返回值 没有返回值">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 使用 没有返回值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AsyncService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 指定使用beanname为doSomethingExecutor的线程池</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Async(&quot;doSomethingExecutor&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String doSomething(String message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;do something, message={}&quot;, message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Thread.sleep(1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (InterruptedException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot;do something error: &quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AsyncController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private AsyncService asyncService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping(&quot;/open/something&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String something() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int count = 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; count; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            asyncService.doSomething(&quot;index = &quot; + i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;success&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 使用 有返回值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AsyncController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private AsyncService asyncService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @SneakyThrows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ApiOperation(&quot;异步 有返回值&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping(&quot;/open/somethings&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String somethings() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CompletableFuture&lt;String&gt; createOrder = asyncService.doSomething1(&quot;create order&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CompletableFuture&lt;String&gt; reduceAccount = asyncService.doSomething2(&quot;reduce account&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CompletableFuture&lt;String&gt; saveLog = asyncService.doSomething3(&quot;save log&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 等待所有任务都执行完</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CompletableFuture.allOf(createOrder, reduceAccount, saveLog).join();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取每个任务的返回结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String result = createOrder.get() + reduceAccount.get() + saveLog.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AsyncService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Async(&quot;doSomethingExecutor&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CompletableFuture&lt;String&gt; doSomething1(String message) throws InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;do something1: {}&quot;, message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Thread.sleep(1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return CompletableFuture.completedFuture(&quot;do something1: &quot; + message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Async(&quot;doSomethingExecutor&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CompletableFuture&lt;String&gt; doSomething2(String message) throws InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;do something2: {}&quot;, message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Thread.sleep(1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return CompletableFuture.completedFuture(&quot;; do something2: &quot; + message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Async(&quot;doSomethingExecutor&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CompletableFuture&lt;String&gt; doSomething3(String message) throws InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;do something3: {}&quot;, message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Thread.sleep(1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return CompletableFuture.completedFuture(&quot;; do something3: &quot; + message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1613-async失效">16.1.3. @Async失效<a href="#1613-async失效" class="hash-link" aria-label="Direct link to 16.1.3. @Async失效" title="Direct link to 16.1.3. @Async失效">​</a></h3><ul><li>异步方法使用static关键词修饰</li><li>异步类不是一个Spring容器的bean（一般使用注解@Component和@Service，并且能被Spring扫描到）；</li><li>SpringBoot应用中没有添加@EnableAsync注解；</li><li>在同一个类中，一个方法调用另外一个有@Async注解的方法，注解不会生效。原因是@Async注解的方法，是在代理类中执行的。</li></ul><blockquote><p>异步方法使用注解@Async的返回值只能为void或者Future及其子类，当返回结果为其他类型时，方法还是会异步执行，但是返回值都是null</p></blockquote><h1>17. 实现乐观锁悲观锁</h1><p><a href="https://www.cnblogs.com/cloudfloating/p/11461530.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/cloudfloating/p/11461530.html</a> </p><p>TODO</p><h1>18. 移动端消息推送</h1><p><a href="https://juejin.im/post/6844903838495801357" target="_blank" rel="noopener noreferrer">https://juejin.im/post/6844903838495801357</a>
<a href="https://crossoverjie.top/2018/09/25/netty/million-sms-push/" target="_blank" rel="noopener noreferrer">https://crossoverjie.top/2018/09/25/netty/million-sms-push/</a>
<a href="https://juejin.im/post/6844903478200909837" target="_blank" rel="noopener noreferrer">https://juejin.im/post/6844903478200909837</a>
TODO</p><h1>19. 即时通信 IM系统</h1><p><a href="https://github.com/tywo45" target="_blank" rel="noopener noreferrer">https://github.com/tywo45</a></p><h1>20. 辅助工具</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="201-lombok-notice">20.1. lombok notice<a href="#201-lombok-notice" class="hash-link" aria-label="Direct link to 20.1. lombok notice" title="Direct link to 20.1. lombok notice">​</a></h2><ul><li><p>@data &lt;=&gt; @Setter、@Getter、@RequiredArgsConstructor、@ToString、@EqualsAndHashCode, </p><p>  若存在继承, 需要为 son 指定 @EqualsAndHashCode(callSuper = true)</p><p>  @RequiredArgsConstructor 表示为不可变 field 生成 constructor, 也就是为 final 的成员或者@notnull成员生成 constructor, 其他普通的 field 不会作为构造参数,</p><p>  @RequiredArgsConstructor(staticName=&quot;of&quot;),  staticname=of 表示这个类不能用构造方法构造出来，必须通过 XxxClass.of(...)方法才能构造出来</p></li><li><p>推荐通用的组合是 @data, @all... , @no...</p></li><li><p>和 Java8 配合良好, jdk升级很麻烦, 需要 delombok</p></li><li><p>@builder 构造对象时底层用的是全参数构造器, 需要 @AllArgsConstructor一起用, 无法单独使用, 若果一定要用, 好的组合是 @NoArgsConstructor @AllArgsConstructor @Builder @Data</p></li><li><p>代替@AutoWired注解: @RequiredArgsConstructor(onConstructor =@__(@Autowired))标注在类上, 那么注入成员的时候, 可以省掉 @autowired 注解</p></li><li><p>替代@tostring注解 可以使用 lang3 的 <code>ToStringBuilder.reflectionToString(this)</code></p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="202-devtools">20.2. devtools<a href="#202-devtools" class="hash-link" aria-label="Direct link to 20.2. devtools" title="Direct link to 20.2. devtools">​</a></h2><p>开发者组件, 修改了 thymeleaf 后, 重新编译修改的文件, 页面即可更新, 不必重启整个 app, 但是若修改了 Java config , 还是要重启</p><div class="language-props codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-props codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring.thymeleaf.cache=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.devtools.restart.enabled=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... additional-paths=src/main/java // 监听目录  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="203-maven-wrapper">20.3. maven wrapper<a href="#203-maven-wrapper" class="hash-link" aria-label="Direct link to 20.3. maven wrapper" title="Direct link to 20.3. maven wrapper">​</a></h2><p>wrapper：maven的包装器，通过mvnw命令替代mvn，简化mvn操作, 不需要在操作系统上安装Maven</p><p>受到 gradle wrappe 启发</p><p>/.mvn/wrapper/maven-wrapper.jar 是其主体程序</p><p>/.mvn/wrapper/maven-wrapper.properties 可指定 maven 版本及下载路径</p><p>mvnw, mvnw.cmd 命令行程序</p><p>mvnw第一次运行会检测$USER_HOME/.m2/wrapper/dists 目录下是否有maven-wrapper.properties中指定的Maven版本，如果没有就自动下载</p><h1>21. 校验</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="211-校验配置文件">21.1. 校验配置文件<a href="#211-校验配置文件" class="hash-link" aria-label="Direct link to 21.1. 校验配置文件" title="Direct link to 21.1. 校验配置文件">​</a></h2><p>任何添加@ConfigurationProperties的类，class上加 <code>@Validated</code> annotation, app都会进行属性校验, 确保引入了 JSR-303 javax.validation 规范的实现;
使用校验规范JSR-303 javax.validation中的注解即可实现校验（介绍见这里<a href="https://www.ibm.com/developerworks/cn/java/j-lo-jsr303/%EF%BC%89" target="_blank" rel="noopener noreferrer">https://www.ibm.com/developerworks/cn/java/j-lo-jsr303/）</a></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@ConfigurationProperties(prefix=&quot;connection&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Validated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FooProperties {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @NotNull</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private InetAddress remoteAddress;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Valid // 这里是为了激活 Security类中的注解校验</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final Security security = new Security();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... getters and setters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static class Security {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @NotEmpty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public String username;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ... getters and setters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>@Validated 也可以可以加到 @Bean 方法上 来触发校验;</p><p>也可以使用自定的Spring Validator，bean id是 configurationPropertiesValidator 即可</p><p>spring-boot-actuator 模块有一个端点，对外暴露了所有的 @ConfigurationProperties beans。浏览器中访问 /configprops 即可</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="212-校验请求参数">21.2. 校验请求参数<a href="#212-校验请求参数" class="hash-link" aria-label="Direct link to 21.2. 校验请求参数" title="Direct link to 21.2. 校验请求参数">​</a></h2><p><a href="https://blog.csdn.net/mzh_cn/article/details/80637015" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/mzh_cn/article/details/80637015</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="213-自定义校验">21.3. 自定义校验<a href="#213-自定义校验" class="hash-link" aria-label="Direct link to 21.3. 自定义校验" title="Direct link to 21.3. 自定义校验">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="214-validated和valid">21.4. @Validated和@Valid<a href="#214-validated和valid" class="hash-link" aria-label="Direct link to 21.4. @Validated和@Valid" title="Direct link to 21.4. @Validated和@Valid">​</a></h2><p>@Valid是 JSR-303 规范, hibernate-validation实现了这一规范</p><p>@Validated来自于spring, 是 spring 对于 @Valid 的实现, 提供&quot;validation groups&quot;功能(创建空接口作为分组), valid则不具备;(<a href="https://stackoverflow.com/questions/36173332/difference-between-valid-and-validated-in-spring" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/36173332/difference-between-valid-and-validated-in-spring</a>) , 一旦controler 中使用 @Validated(group={...}), 那么实体类字段上的注解若指定 group 则约束生效, 不指定分组的不生效. 反之, 若 @validated 没有指定分组, 则 实体类字段指定了 group 的不生效, 不指定group 的字段生效</p><h1>22. runner 获取命令行参数</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="221-获取命令行参数">22.1. 获取命令行参数<a href="#221-获取命令行参数" class="hash-link" aria-label="Direct link to 22.1. 获取命令行参数" title="Direct link to 22.1. 获取命令行参数">​</a></h2><p>注入一个<code>org.springframework.boot.ApplicationArguments </code>bean</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MyBean {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public MyBean(ApplicationArguments args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean debug = args.containsOption(&quot;debug&quot;);//option参数即“--”开头的参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;String&gt; files = args.getNonOptionArgs();// if run with &quot;--debug logfile.txt&quot; 那么结果是 debug=true, files=[&quot;logfile.txt&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>另外的注入方法:</p><p>Spring Boot will also register a <code>CommandLinePropertySource</code> with the Spring <code>Environment</code>. This allows you to also inject single application arguments using the <code>@Value</code> annotation.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="222-applicationrunner-or-commandlinerunner">22.2. <code>ApplicationRunner</code> or <code>CommandLineRunner</code><a href="#222-applicationrunner-or-commandlinerunner" class="hash-link" aria-label="Direct link to 222-applicationrunner-or-commandlinerunner" title="Direct link to 222-applicationrunner-or-commandlinerunner">​</a></h2><p><code>ApplicationRunner</code> or <code>CommandLineRunner</code>接口都有run()待实现(在SpringApplication.run(…​)完成之前调用)但是参数不同, 具体如下:</p><ul><li><p>ApplicationRunner接口, <code>void run(ApplicationArguments args)</code></p></li><li><p>CommandLineRunner接口, <code>void run(String... args)</code></p></li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MyBean implements CommandLineRunner {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void run(String... args) {//可以获取命令行参数, 作为String[]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 这里的内容会在app完全启动前最后一步执行, 即SpringApplication.run(…​)完成之前, 也会在ApplicationReadyEvent之前</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 另一种方法:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//java -jar commandline-app-0.0.1-SNAPSHOT.jar iamnonoption --app.name=CmdRulez --app.hosts=abc,def,ghi --app.name=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">implements ApplicationRunner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void run(ApplicationArguments args) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取非 --xxx=yyy 的参数集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;# NonOptionArgs: &quot; + args.getNonOptionArgs().size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;NonOptionArgs:&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        args.getNonOptionArgs().forEach(System.out::println);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取 --xxx=yy 的参数中的 key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;# OptionArgs: &quot; + args.getOptionNames().size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;OptionArgs:&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        args.getOptionNames().forEach(optionName -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(optionName + &quot;=&quot; + args.getOptionValues(optionName));// 获取 value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果有多个CommandLineRunner or ApplicationRunner beans 被定义, 这时候涉及到调用数序问题, 两种方式:</p><ul><li><p>实现<code>org.springframework.core.Ordered</code>接口</p></li><li><p>使用<code>org.springframework.core.annotation.Order</code>注解 eg: @Order(num), num为Int, 0优先级最高</p></li></ul><h1>23. 开发命令行应用</h1><p>加入开发一个工具 ab.jar, 希望这么使用:</p><ul><li>java -jar ab.jar 使用提示</li><li>java -jar ab.jar  --spring.profiles.active=hello-world,receiver 激活不同的 profile</li></ul><p>配置中指定一个默认 激活 profile</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active: usage_message</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 工具使用提示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Profile(&quot;usage_message&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public CommandLineRunner usage() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return args -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;This app uses Spring Profiles to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            control its behavior.\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;Sample usage: java -jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rabbit-tutorials.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            --spring.profiles.active=hello-world,sender&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 若出传递了参数, 则 usage_message 就被覆盖, 这个 bean 被注册</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Profile(&quot;!usage_message&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public CommandLineRunner tutorial() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new RabbitAmqpTutorialsRunner();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 传递不同的参数, 不同的 profile 会激活</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Profile(&quot;receiver&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public Tut1Receiver receiver() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new Tut1Receiver();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Profile(&quot;sender&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public Tut1Sender sender() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new Tut1Sender();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 具体操作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class RabbitAmqpTutorialsRunner implements CommandLineRunner {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value(&quot;${tutorial.client.duration:0}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int duration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ConfigurableApplicationContext ctx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void run(String... arg0) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;Ready ... running for &quot; + duration + &quot;ms&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Thread.sleep(duration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ctx.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>24. 整合 grpc</h1><p><a href="https://github.com/ChinaSilence/spring-boot-starter-grpc" target="_blank" rel="noopener noreferrer">https://github.com/ChinaSilence/spring-boot-starter-grpc</a></p><h1>25. 任务调度</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="251-整合-xxl-job-任务调度平台">25.1. 整合 XXL-JOB 任务调度平台<a href="#251-整合-xxl-job-任务调度平台" class="hash-link" aria-label="Direct link to 25.1. 整合 XXL-JOB 任务调度平台" title="Direct link to 25.1. 整合 XXL-JOB 任务调度平台">​</a></h2><p><a href="https://www.tianheyu.top/archives/springboot-xxl-job-executor" target="_blank" rel="noopener noreferrer">https://www.tianheyu.top/archives/springboot-xxl-job-executor</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="252-异步任务">25.2. 异步任务<a href="#252-异步任务" class="hash-link" aria-label="Direct link to 25.2. 异步任务" title="Direct link to 25.2. 异步任务">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableAsync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AsyncConfig implements AsyncConfigurer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Executor getAsyncExecutor() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ThreadPoolTaskExecutor taskExecutor = new ThreadPoolTaskExecutor();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //核心线程数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        taskExecutor.setCorePoolSize(8);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //最大线程数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        taskExecutor.setMaxPoolSize(16);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //队列大小</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        taskExecutor.setQueueCapacity(100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 当最大池已满时,此策略为我们提供可伸缩队列，此策略保证不会丢失任务请求，但是可能会影响应用程序整体性能。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    executor.setThreadNamePrefix(&quot;My ThreadPoolTaskExecutor-&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        taskExecutor.initialize();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return taskExecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FutureService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //在需要执行的方法上加@Async表明该方法是个异步方法，如果加在类级别上，则表明类所有的方法都是异步方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Async</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Future&lt;String&gt; futureTest() throws InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;任务执行开始,需要：1000ms&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; 10; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Thread.sleep(100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(&quot;do:&quot; + i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;完成任务&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new AsyncResult&lt;&gt;(Thread.currentThread().getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Async</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CompletableFuture&lt;List&lt;String&gt;&gt; completableFutureTask(String start) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 打印日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.warn(Thread.currentThread().getName() + &quot;start this task!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 找到特定字符/字符串开头的电影</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;String&gt; results =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            movies.stream().filter(movie -&gt; movie.startsWith(start)).collect(Collectors.toList());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 模拟这是一个耗时的任务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Thread.sleep(1000L);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (InterruptedException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //返回一个已经用给定值完成的新的CompletableFuture。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return CompletableFuture.completedFuture(results);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="253-定时任务">25.3. 定时任务<a href="#253-定时任务" class="hash-link" aria-label="Direct link to 25.3. 定时任务" title="Direct link to 25.3. 定时任务">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2531-springboot-内置">25.3.1. springboot 内置<a href="#2531-springboot-内置" class="hash-link" aria-label="Direct link to 25.3.1. springboot 内置" title="Direct link to 25.3.1. springboot 内置">​</a></h3><p>SpringBoot为我们内置了@Scheduled定时任务 (spring task), @EnableScheduling 开启</p><p>@Scheduled注解各参数详解: (<a href="https://www.jianshu.com/p/1defb0f22ed1" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/1defb0f22ed1</a>)</p><ul><li>cron</li><li>zone</li><li>fixedDelay 上次完毕到下次开始(ms)</li><li>fixedDelayString=&quot;${time.fixedDelay}&quot; 同上</li><li>fixedRate 上次开始到下次开始</li><li>initialDelay 首次延迟</li></ul><p>自定义线程池:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//默认情况下，@Scheduled任务都在Spring创建的大小为1的默认线程池中执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SchedulerConfig implements SchedulingConfigurer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final int POOL_SIZE = 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void configureTasks(ScheduledTaskRegistrar scheduledTaskRegistrar) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ThreadPoolTaskScheduler threadPoolTaskScheduler = new ThreadPoolTaskScheduler();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        threadPoolTaskScheduler.setPoolSize(POOL_SIZE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        threadPoolTaskScheduler.setThreadNamePrefix(&quot;my-scheduled-task-pool-&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        threadPoolTaskScheduler.initialize();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scheduledTaskRegistrar.setTaskScheduler(threadPoolTaskScheduler);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2532-集成-quartz">25.3.2. 集成 Quartz<a href="#2532-集成-quartz" class="hash-link" aria-label="Direct link to 25.3.2. 集成 Quartz" title="Direct link to 25.3.2. 集成 Quartz">​</a></h3><h1>26. 配置文件 and 环境</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="261-读取配置文件">26.1. 读取配置文件<a href="#261-读取配置文件" class="hash-link" aria-label="Direct link to 26.1. 读取配置文件" title="Direct link to 26.1. 读取配置文件">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2611-几种读取配置文件的方法">26.1.1. 几种读取配置文件的方法<a href="#2611-几种读取配置文件的方法" class="hash-link" aria-label="Direct link to 26.1.1. 几种读取配置文件的方法" title="Direct link to 26.1.1. 几种读取配置文件的方法">​</a></h3><ol><li><p>使用 @Value(&quot;${property}&quot;) 读取比较简单的配置信息</p></li><li><p>通过@ConfigurationProperties(prefix = &quot;library&quot;)读取并与 bean 绑定, 需要 加 @component(此时无需在配置类上添加 @EnableConfigurationProperties), 若不用 @component, 则必须 在任意一个配置类上添加 @EnableConfigurationProperties(...)</p></li><li><p>@ConfigurationProperties 配合 @bean 用在方法上, 方法调用空构造函数返回想要构造的对象</p></li><li><p>@PropertySource(&quot;classpath:website.properties&quot;) 读取指定 properties 文件</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2612-注入复杂类型">26.1.2. 注入复杂类型<a href="#2612-注入复杂类型" class="hash-link" aria-label="Direct link to 26.1.2. 注入复杂类型" title="Direct link to 26.1.2. 注入复杂类型">​</a></h3><p>对于 properties 格式的配置文件:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># application.properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#单个值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val=10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># List</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">list=1,2,3,4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">map={&#x27;name&#x27;:&#x27;chen&#x27;, &#x27;age&#x27;:&#x27;12&#x27;, &#x27;sex&#x27;:&#x27;男&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 用到了spel表达式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@PropertySource(&quot;classpath:xxx&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ConfigProps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //单个数值，可注入为int或String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value(&quot;${val}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int val;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //array 数组</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value(&quot;#{&#x27;${ips}&#x27;.split(&#x27;,&#x27;)}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;String&gt; iplist;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value(&quot;#{${map}}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Map&lt;String, String&gt; map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于 yml 格式的文件:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">custom:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ignored-token-path: /base/xx/login, /xx/**/, /xx/hfc/test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">然和配置接受类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration // 也可以用 @component, 若果不想用这类注解, 可以去掉, 取而代之在启动类上标注 @enableConfigProperties(xxx.class), 相当于加了 @Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConfigurationProperties(&quot;custom&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Custom {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String[] ignoredTokenPath;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">custom:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mail[0]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    username: xxx@xxx.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    password: axxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mail[1]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    username: xxx@xxx.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    password: axxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConfigurationProperties(&quot;custom&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Custom {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;MailInfo&gt; mail;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static class MailInfo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private String username;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private String password;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">directory:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  maps:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    11: /dciZhongShan/resourceWarn/agricultureLand</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConfigurationProperties(prefix = &quot;directory&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MapConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Map&lt;Integer, String&gt; maps;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="262-配置文件优先级">26.2. 配置文件优先级<a href="#262-配置文件优先级" class="hash-link" aria-label="Direct link to 26.2. 配置文件优先级" title="Direct link to 26.2. 配置文件优先级">​</a></h2><p>配置文件加载优先级: 命令行 &gt; ${user.dir}/config/xxx &gt; ${user.dir}/xxx (usr.dir 即为命令执行的当前目录) &gt; classpath:config/xxx &gt; classpath:xxx</p><p>--spring.profiles.active=prod,,,, --spring.config.location=target/application.properties</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="263-读取环境信息">26.3. 读取环境信息<a href="#263-读取环境信息" class="hash-link" aria-label="Direct link to 26.3. 读取环境信息" title="Direct link to 26.3. 读取环境信息">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author xiaoyu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * date: 2020/3/21</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SpringbootDemoApp {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * springboot在启动的时候需要检测当前项目是否是一个web项目，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 检测方式为判断classpath中是否有以下final变量中定义的两个参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String[] WEB_ENVIRONMENT_CLASSES =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new String[]{&quot;javax.servlet.Servlet&quot;, &quot;org.springframework.web.context.ConfigurableWebApplicationContext&quot;};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConfigurableApplicationContext context = SpringApplication.run(SpringbootDemoApp.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConfigurableEnvironment        env     = context.getEnvironment();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String[] activeProfiles = env.getActiveProfiles();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String   port           = env.getProperty(&quot;server.port&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;==============================&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;active profiles: &quot; + Arrays.toString(activeProfiles));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;local uri: http://localhost:&quot; + port);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;local area network uri: http://&quot; + localAreaNetwork() + &quot;:&quot; + port);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;==============================&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static String localAreaNetwork() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return InetAddress.getLocalHost().getHostAddress();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (UnknownHostException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return &quot;get local area network error&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private boolean deduceWebEnv() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //https://blog.csdn.net/txba6868/article/details/80732475</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DemoController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * file upload 文件上传</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(value = &quot;/upload&quot;, method = RequestMethod.POST)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;String&gt; upload(HttpServletRequest request) throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MultipartHttpServletRequest req = (MultipartHttpServletRequest) request;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MultipartFile aa = req.getFile(&quot;aa&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MultipartFile bb = req.getFile(&quot;bb&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        aa.transferTo(Paths.get(System.getProperty(&quot;user.home&quot;) + &quot;/tmp&quot;).toFile());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok(&quot;ok&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="264-两种引入-springboot-方式">26.4. 两种引入 springboot 方式<a href="#264-两种引入-springboot-方式" class="hash-link" aria-label="Direct link to 26.4. 两种引入 springboot 方式" title="Direct link to 26.4. 两种引入 springboot 方式">​</a></h2><p>一种是通过 设置 parent 为 spring boot starter parent</p><p>一种是通过 dependencyManagement 加入 spring boot dependencies (需要 设置 maven  properties, <code>maven.compiler.source</code> 和 <code>maven.compiler.target</code> 防止编译使用 jdk 1.5)</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">         </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">         </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xsi:</span><span class="token tag attr-name" style="color:#00a4db">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--    &lt;parent&gt;--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--        &lt;version&gt;&lt;/version&gt;--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--        &lt;relativePath/&gt; &amp;lt;!&amp;ndash; lookup parent from repository &amp;ndash;&amp;gt;--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--    &lt;/parent&gt;--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">io.github.xiaoyureed</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">shopee</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">0.0.1-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">聚合服务</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">java.version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">java.version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">${java.version}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">${java.version}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">UTF-8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project.reporting.outputEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">UTF-8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project.reporting.outputEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">spring-boot.version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2.3.4.RELEASE</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">spring-boot.version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">spring-cloud.version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Hoxton.SR8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">spring-cloud.version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">spring-cloud-alibaba.version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2.2.1.RELEASE</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">spring-cloud-alibaba.version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">aliyun-spring-boot.version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">aliyun-spring-boot.version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependencyManagement</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-dependencies</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">${spring-boot.version}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">type</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">type</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-cloud-dependencies</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">${spring-cloud.version}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">type</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">type</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-cloud-alibaba-dependencies</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">${spring-cloud-alibaba.version}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">type</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">type</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">aliyun-spring-boot-dependencies</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">${aliyun-spring-boot.version}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">type</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">type</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.baomidou</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mybatis-plus-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.4.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mysql</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mysql-connector-java</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">8.0.21</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.elasticsearch.client</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">elasticsearch-rest-high-level-client</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">7.9.2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--            代码生成 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.baomidou</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mybatis-plus-generator</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.4.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- https://mvnrepository.com/artifact/org.apache.velocity/velocity-engine-core --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.velocity</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">velocity-engine-core</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2.2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- https://mvnrepository.com/artifact/org.apache.httpcomponents/httpcore --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--            common module need this--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.httpcomponents</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">httpcore</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.4.13</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.commons</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">commons-lang3</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.11</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependencyManagement</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">optional</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">optional</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用这种方式 spring boot maven plugin 可能失效, 需要手动配置</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-maven-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">phase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">package</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">phase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">repackage</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>27. 序列化 反序列化</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="271-日期时间-json">27.1. 日期时间 json<a href="#271-日期时间-json" class="hash-link" aria-label="Direct link to 27.1. 日期时间 json" title="Direct link to 27.1. 日期时间 json">​</a></h2><p><a href="https://www.cnblogs.com/carrychan/p/9883172.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/carrychan/p/9883172.html</a>
<a href="https://blog.csdn.net/z69183787/article/details/109356584" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/z69183787/article/details/109356584</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="272-jackson-使用">27.2. jackson 使用<a href="#272-jackson-使用" class="hash-link" aria-label="Direct link to 27.2. jackson 使用" title="Direct link to 27.2. jackson 使用">​</a></h2><p>springboot web starter 中包含了 Jackson-databind 依赖, 可以直接注入 objectmapper, 若自己定制:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2721-jsoncomponent">27.2.1. @JsonComponent<a href="#2721-jsoncomponent" class="hash-link" aria-label="Direct link to 27.2.1. @JsonComponent" title="Direct link to 27.2.1. @JsonComponent">​</a></h3><p>用于对特定属性定制序列化</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@AllArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class User {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Color favoriteColor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@JsonComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UserCombinedSerializer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static class UserJsonSerializer // 若只需要序列化, 不需要反序列化, 则只需要这个类 并在这个类标注 @JsonComponent. 外层类和下面的内部类类都不需要, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      extends JsonSerializer&lt;User&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void serialize(User user, JsonGenerator jsonGenerator, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          SerializerProvider serializerProvider) throws IOException, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          JsonProcessingException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            jsonGenerator.writeStartObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            jsonGenerator.writeStringField(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;favoriteColor&quot;, getColorAsWebColor(user.getFavoriteColor()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ... 其他属性...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            jsonGenerator.writeEndObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private static String getColorAsWebColor(Color color) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            int r = (int) Math.round(color.getRed() * 255.0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            int g = (int) Math.round(color.getGreen() * 255.0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            int b = (int) Math.round(color.getBlue() * 255.0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return String.format(&quot;#%02x%02x%02x&quot;, r, g, b);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static class UserJsonDeserializer </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      extends JsonDeserializer&lt;User&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public User deserialize(JsonParser jsonParser, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          DeserializationContext deserializationContext)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          throws IOException, JsonProcessingException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TreeNode treeNode = jsonParser.getCodec().readTree(jsonParser);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TextNode favoriteColor = (TextNode) treeNode.get(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;favoriteColor&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return new User(Color.web(favoriteColor.asText()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2722-jackson-在-springboot-中的配置">27.2.2. Jackson 在 springboot 中的配置<a href="#2722-jackson-在-springboot-中的配置" class="hash-link" aria-label="Direct link to 27.2.2. Jackson 在 springboot 中的配置" title="Direct link to 27.2.2. Jackson 在 springboot 中的配置">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring.jackson.date-format指定日期格式，比如yyyy-MM-dd HH:mm:ss，或者具体的格式化类的全限定名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.jackson.deserialization是否开启Jackson的反序列化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.jackson.generator是否开启json的generators.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.jackson.joda-date-time-format指定Joda date/time的格式，比如yyyy-MM-ddHH:mm:ss). 如果没有配置的话，dateformat会作为backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.jackson.locale指定json使用的Locale.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.jackson.mapper是否开启Jackson通用的特性.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.jackson.parser是否开启jackson的parser特性.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.jackson.property-naming-strategy指定PropertyNamingStrategy(CAMEL_CASE_TO_LOWER_CASE_WITH_UNDERSCORES)或者指定PropertyNamingStrategy子类的全限定类名.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.jackson.serialization是否开启jackson的序列化.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.jackson.serialization-inclusion指定序列化时属性的inclusion方式，具体查看JsonInclude.Include枚举.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.jackson.time-zone指定日期格式化时区，比如America/Los_Angeles或者GMT+10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2723-jackson注解">27.2.3. jackson注解<a href="#2723-jackson注解" class="hash-link" aria-label="Direct link to 27.2.3. jackson注解" title="Direct link to 27.2.3. jackson注解">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@JsonIgnore 此注解用于属性上，作用是进行JSON操作时忽略该属性。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@JsonIgnoreProperties(value = { &quot;intValue&quot; }) on type, 忽略指定属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@JsonIgnoreType on type 忽略所有属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //or @JsonIgnoreType on mixin type(empty type) to ignore fields of the type which we have no access to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //        mapper.addMixIn(String[].class, MyMixInForIgnoreType.class);//MyMixInForIgnoreType is empty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Note: Since version 2.5 – it seems that we can not use this method to ignore primitive data types, but we can use it for custom data types and arrays.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@JsonFormat 此注解用于属性上，作用是把Date类型直接转化为想要的格式，如@JsonFormat(pattern = “yyyy-MM-dd HH-mm-ss”)。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@JsonProperty 此注解用于属性上，作用是把该属性的名称序列化为另外一个名称，如把trueName属性序列化为name，@JsonProperty(“name”)。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@JsonValue 用于属性/get方法上, 一个类只能用一个, 相当于自定义序列化, 当加上@JsonValue注解，序列化是只返回这一个字段的值/方法的值作为当前对象的值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@JsonRawValue on json string field to serialize raw json string</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2724-objectmapper-定制">27.2.4. objectmapper 定制<a href="#2724-objectmapper-定制" class="hash-link" aria-label="Direct link to 27.2.4. objectmapper 定制" title="Direct link to 27.2.4. objectmapper 定制">​</a></h3><p><a href="https://www.kancloud.cn/ahutchen/spring-boot-reference-guide/333370" target="_blank" rel="noopener noreferrer">https://www.kancloud.cn/ahutchen/spring-boot-reference-guide/333370</a></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ObjectMapper objectMapper() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ObjectMapper objectMapper = new ObjectMapper();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &gt;&gt;&gt; serialization config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         //序列化的时候序列对象的所有属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //          JsonInclude.Include.NON_NULL 忽略 null 值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //          Include.NON_EMPTY 如果为null或者 空字符串和空集合都不会被序列化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        objectMapper.setSerializationInclusion(Include.ALWAYS);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //如果是空对象的时候,不抛异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        objectMapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 格式化输出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        objectMapper.configure(SerializationFeature.INDENT_OUTPUT, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mapper.enable(SerializationFeature.INDENT_OUTPUT);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 自定义时间格式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //取消时间的转化格式,默认是时间戳,可以取消,同时需要设置要表现的时间格式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        objectMapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, false);// 默认为true,会显示时间戳</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        objectMapper.setDateFormat(new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //  config filter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//        new SimpleBeanPropertyFilter.FilterExceptFilter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//        objectMapper.setFilterProvider()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &gt;&gt;&gt; deserialization config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //反序列化的时候如果多了其他属性,不抛出异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //@JsonValue 可以用在get方法或者属性字段上，一个类只能用一个，当加上@JsonValue注解是，序列化是只返回这一个字段的值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //@JsonRootName(value = &quot;user&quot;) to wrapper a root property for output json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //@JsonSerialize(using = CustomDateSerializer.class) on field to specify a customized serializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ex: class CustomDateSerializer extends StdSerializer&lt;Date&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return objectMapper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2725-objectmapper-使用">27.2.5. objectmapper 使用<a href="#2725-objectmapper-使用" class="hash-link" aria-label="Direct link to 27.2.5. objectmapper 使用" title="Direct link to 27.2.5. objectmapper 使用">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// &gt;&gt;&gt; 序列化数组</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Person person1 = new Person(1, &quot;zxc&quot;, new Date());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Person person2 = new Person(2, &quot;ldh&quot;, new Date());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;Person&gt; persons = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persons.add(person1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persons.add(person2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String personStr = objectMapper.writeValueAsString(persons);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//反序列化为List&lt;user&gt; 集合,1需要通过 TypeReference 来具体传递值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;Person&gt; persons2 = objectMapper.readValue(personStr, new TypeReference&lt;List&lt;Person&gt;&gt;() {});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//or </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//通过 JavaType 来进行处理返回</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JavaType javaType = objectMapper.getTypeFactory().constructParametricType(List.class, Person.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;Person&gt; persons3 = objectMapper.readValue(personStr, javaType);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>28. 接入第三方支付</h1><p><a href="https://github.com/Javen205/IJPay" target="_blank" rel="noopener noreferrer">https://github.com/Javen205/IJPay</a></p><p><a href="https://github.com/egzosn/pay-java-parent" target="_blank" rel="noopener noreferrer">https://github.com/egzosn/pay-java-parent</a>
<a href="https://github.com/egzosn/pay-spring-boot-starter-parent" target="_blank" rel="noopener noreferrer">https://github.com/egzosn/pay-spring-boot-starter-parent</a></p><p><a href="https://github.com/Pay-Group/best-pay-sdk" target="_blank" rel="noopener noreferrer">https://github.com/Pay-Group/best-pay-sdk</a></p><p><a href="https://github.com/iyangyuan/pay-spring-boot" target="_blank" rel="noopener noreferrer">https://github.com/iyangyuan/pay-spring-boot</a></p><p><a href="https://github.com/jeequan/jeepay" target="_blank" rel="noopener noreferrer">https://github.com/jeequan/jeepay</a></p><p><a href="https://github.com/roncoo/roncoo-pay" target="_blank" rel="noopener noreferrer">https://github.com/roncoo/roncoo-pay</a></p><p><a href="https://github.com/Exrick/xpay" target="_blank" rel="noopener noreferrer">https://github.com/Exrick/xpay</a> 个人收款</p><h1>29. 拾遗</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="291-bean-懒加载">29.1. bean 懒加载<a href="#291-bean-懒加载" class="hash-link" aria-label="Direct link to 29.1. bean 懒加载" title="Direct link to 29.1. bean 懒加载">​</a></h2><p>一般情况下，Spring容器在启动时会创建所有的Bean对象，使用@Lazy注解 (和 @Component 共同使用) 可以将Bean对象的创建延迟到第一次使用Bean的时候</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/docs/tags/framework">framework</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/docs/tags/java">java</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/xiaoyureed/xiaoyureed.github.io/tree/main/docs/SpringBoot-note.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/FreeMarker-note"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">FreeMarker Note</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/agile-development-user-story-scrum"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">敏捷开发 Intro</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#31-bean-复制-克隆" class="table-of-contents__link toc-highlight">3.1. bean 复制 克隆</a></li><li><a href="#32-字符串" class="table-of-contents__link toc-highlight">3.2. 字符串</a></li><li><a href="#33-编解码" class="table-of-contents__link toc-highlight">3.3. 编解码</a></li><li><a href="#34-commons-lang3" class="table-of-contents__link toc-highlight">3.4. commons-lang3</a></li><li><a href="#35-文件操作" class="table-of-contents__link toc-highlight">3.5. 文件操作</a></li><li><a href="#36-commons-collections4" class="table-of-contents__link toc-highlight">3.6. commons-collections4</a></li><li><a href="#51-configurationproperties-和-value" class="table-of-contents__link toc-highlight">5.1. @ConfigurationProperties 和 @Value</a></li><li><a href="#52-enableconfigurationproperties" class="table-of-contents__link toc-highlight">5.2. @EnableConfigurationProperties</a></li><li><a href="#53-enableautoconfiguration" class="table-of-contents__link toc-highlight">5.3. @EnableAutoConfiguration</a></li><li><a href="#54-componentscan" class="table-of-contents__link toc-highlight">5.4. @ComponentScan</a></li><li><a href="#55-springbootapplication" class="table-of-contents__link toc-highlight">5.5. @SpringBootApplication</a></li><li><a href="#56-component和bean和configration区别" class="table-of-contents__link toc-highlight">5.6. @Component和@Bean和@Configration区别</a></li><li><a href="#57-import和importresource和propertysource比较" class="table-of-contents__link toc-highlight">5.7. @Import和@ImportResource和@PropertySource比较</a></li><li><a href="#91-set注入" class="table-of-contents__link toc-highlight">9.1. set注入</a></li><li><a href="#92-postconstruct-注入" class="table-of-contents__link toc-highlight">9.2. @PostConstruct 注入</a></li><li><a href="#93-通过-applicationcontext" class="table-of-contents__link toc-highlight">9.3. 通过 ApplicationContext</a></li><li><a href="#101-加载过程or原理" class="table-of-contents__link toc-highlight">10.1. 加载过程or原理</a></li><li><a href="#102-自动配置类会用到的一些注解" class="table-of-contents__link toc-highlight">10.2. 自动配置类会用到的一些注解</a></li><li><a href="#103-自动配置类的实例" class="table-of-contents__link toc-highlight">10.3. 自动配置类的实例</a><ul><li><a href="#1031-spring-动态代理" class="table-of-contents__link toc-highlight">10.3.1. spring 动态代理</a></li></ul></li><li><a href="#104-conditional" class="table-of-contents__link toc-highlight">10.4. @Conditional</a></li><li><a href="#105-封装组合条件" class="table-of-contents__link toc-highlight">10.5. 封装组合条件</a></li><li><a href="#106-创建自己的-starter" class="table-of-contents__link toc-highlight">10.6. 创建自己的 starter</a></li><li><a href="#107-反爬虫-starter" class="table-of-contents__link toc-highlight">10.7. 反爬虫 starter</a></li><li><a href="#111-spring-boot-actuator-监控" class="table-of-contents__link toc-highlight">11.1. spring-boot-actuator 监控</a></li><li><a href="#112-spring-boot-admin-监控界面" class="table-of-contents__link toc-highlight">11.2. spring boot admin 监控界面</a></li><li><a href="#113-spring-boot-starter-security" class="table-of-contents__link toc-highlight">11.3. spring-boot-starter-security</a><ul><li><a href="#1131-security组件介绍" class="table-of-contents__link toc-highlight">11.3.1. security组件介绍</a></li><li><a href="#1132-基本使用-和-配置用户名密码" class="table-of-contents__link toc-highlight">11.3.2. 基本使用 和 配置用户名密码</a></li><li><a href="#1133-禁用基本认证" class="table-of-contents__link toc-highlight">11.3.3. 禁用基本认证</a></li><li><a href="#1134-配置中-websecurity-和-httpsecurity-区别" class="table-of-contents__link toc-highlight">11.3.4. 配置中 WebSecurity 和 HttpSecurity 区别</a></li><li><a href="#1135-配置跨域" class="table-of-contents__link toc-highlight">11.3.5. 配置跨域</a></li></ul></li><li><a href="#114-oauth2" class="table-of-contents__link toc-highlight">11.4. oauth2</a></li><li><a href="#121-log4j2-marker-写入到指定日志文件" class="table-of-contents__link toc-highlight">12.1. Log4j2-Marker 写入到指定日志文件</a></li><li><a href="#122-logback" class="table-of-contents__link toc-highlight">12.2. logback</a></li><li><a href="#131-canal-订阅" class="table-of-contents__link toc-highlight">13.1. canal 订阅</a></li><li><a href="#132-mybatis-自动建表插件" class="table-of-contents__link toc-highlight">13.2. mybatis 自动建表插件</a></li><li><a href="#133-mybatis-crud-增强插件" class="table-of-contents__link toc-highlight">13.3. mybatis crud 增强插件</a></li><li><a href="#134-数据库迁移版本控制" class="table-of-contents__link toc-highlight">13.4. 数据库迁移版本控制</a><ul><li><a href="#1341-liquibase" class="table-of-contents__link toc-highlight">13.4.1. liquibase</a></li><li><a href="#1342-flyway" class="table-of-contents__link toc-highlight">13.4.2. Flyway</a></li></ul></li><li><a href="#135-数据库-url-和驱动" class="table-of-contents__link toc-highlight">13.5. 数据库 url 和驱动</a></li><li><a href="#136-graphql集成" class="table-of-contents__link toc-highlight">13.6. graphql集成</a></li><li><a href="#137-启动执行-sql" class="table-of-contents__link toc-highlight">13.7. 启动执行 SQL</a><ul><li><a href="#1371-sql-分隔符的坑" class="table-of-contents__link toc-highlight">13.7.1. SQL 分隔符的坑</a></li><li><a href="#1372-spring-datasource-自带" class="table-of-contents__link toc-highlight">13.7.2. spring datasource 自带</a></li><li><a href="#1373-使用-jpa" class="table-of-contents__link toc-highlight">13.7.3. 使用 jpa</a><ul><li><a href="#13731-springboot-接入-jpa" class="table-of-contents__link toc-highlight">13.7.3.1. springboot 接入 jpa</a></li><li><a href="#13732-jpa-querydsl-多表联查" class="table-of-contents__link toc-highlight">13.7.3.2. jpa queryDsl 多表联查</a></li><li><a href="#13733-jpa-支持-java8-time" class="table-of-contents__link toc-highlight">13.7.3.3. jpa 支持 java8 time</a></li></ul></li><li><a href="#1374-datasourceinitializer" class="table-of-contents__link toc-highlight">13.7.4. DataSourceInitializer</a></li><li><a href="#1375-maven-antrun-pluginn" class="table-of-contents__link toc-highlight">13.7.5. maven-antrun-pluginn</a></li></ul></li><li><a href="#138-整合-spring-jdbc" class="table-of-contents__link toc-highlight">13.8. 整合 spring jdbc</a></li><li><a href="#139-整合-hibernate" class="table-of-contents__link toc-highlight">13.9. 整合 hibernate</a><ul><li><a href="#1391-jpa注解总结" class="table-of-contents__link toc-highlight">13.9.1. jpa注解总结</a></li><li><a href="#1392-审计-createddate" class="table-of-contents__link toc-highlight">13.9.2. 审计 createdDate</a></li><li><a href="#1393-执行原生-sql" class="table-of-contents__link toc-highlight">13.9.3. 执行原生 SQL</a></li><li><a href="#1394-动态-sql" class="table-of-contents__link toc-highlight">13.9.4. 动态 SQL</a></li><li><a href="#1395-spring-data-rest-配合-spring-data-jpa" class="table-of-contents__link toc-highlight">13.9.5. spring-data-rest 配合 spring-data-jpa</a></li></ul></li><li><a href="#1310-整合-mybatis-plus" class="table-of-contents__link toc-highlight">13.10. 整合 mybatis-plus</a></li><li><a href="#1311-整合-mybatis" class="table-of-contents__link toc-highlight">13.11. 整合 mybatis</a><ul><li><a href="#13111-基本配置" class="table-of-contents__link toc-highlight">13.11.1. 基本配置</a></li><li><a href="#13112-使用-拦截器-interceptor-plugins" class="table-of-contents__link toc-highlight">13.11.2. 使用 拦截器 interceptor plugins</a><ul><li><a href="#131121-principle-of-plugins" class="table-of-contents__link toc-highlight">13.11.2.1. principle of plugins</a></li><li><a href="#131122-use-scenarios" class="table-of-contents__link toc-highlight">13.11.2.2. use scenarios</a></li><li><a href="#131123-how-to-use-plugins" class="table-of-contents__link toc-highlight">13.11.2.3. how to use plugins</a></li></ul></li><li><a href="#13113-typehandler" class="table-of-contents__link toc-highlight">13.11.3. typehandler</a></li><li><a href="#13114-全注解开发" class="table-of-contents__link toc-highlight">13.11.4. 全注解开发</a></li><li><a href="#13115-动态定时刷新-sql-mapper-实现热加载" class="table-of-contents__link toc-highlight">13.11.5. 动态定时刷新 SQL mapper 实现热加载</a></li><li><a href="#13116-自定义资源文件打包目录-and-开启占位符过滤" class="table-of-contents__link toc-highlight">13.11.6. 自定义资源文件打包目录 and 开启占位符过滤</a></li></ul></li><li><a href="#1312-springboot-事务" class="table-of-contents__link toc-highlight">13.12. springboot 事务</a><ul><li><a href="#13121-事务基本使用" class="table-of-contents__link toc-highlight">13.12.1. 事务基本使用</a></li><li><a href="#13122-spring-事务传播失效的坑" class="table-of-contents__link toc-highlight">13.12.2. spring 事务传播失效的坑</a></li><li><a href="#13123-transactional-注解" class="table-of-contents__link toc-highlight">13.12.3. Transactional 注解</a></li></ul></li><li><a href="#1313-缓存" class="table-of-contents__link toc-highlight">13.13. 缓存</a><ul><li><a href="#13131-springboot-starter-cache" class="table-of-contents__link toc-highlight">13.13.1. springboot-starter-cache</a></li><li><a href="#13132-caffeine" class="table-of-contents__link toc-highlight">13.13.2. caffeine</a></li></ul></li><li><a href="#1314-配合-h2-数据库进行开发" class="table-of-contents__link toc-highlight">13.14. 配合 h2 数据库进行开发</a><ul><li><a href="#13141-h2-和-spring-data-jpa-配合" class="table-of-contents__link toc-highlight">13.14.1. h2 和 spring data jpa 配合</a></li><li><a href="#13142-和-mybatis-plus-配合" class="table-of-contents__link toc-highlight">13.14.2. 和 mybatis-plus 配合</a></li></ul></li><li><a href="#1315-多数据源" class="table-of-contents__link toc-highlight">13.15. 多数据源</a><ul><li><a href="#13151-基本配置-全注解开发" class="table-of-contents__link toc-highlight">13.15.1. 基本配置 全注解开发</a></li><li><a href="#13152-abstractroutingdatasource-动态数据源切换" class="table-of-contents__link toc-highlight">13.15.2. AbstractRoutingDataSource 动态数据源切换</a></li></ul></li><li><a href="#1316-多数据库类型-databaseidprovider" class="table-of-contents__link toc-highlight">13.16. 多数据库类型 databaseIdProvider</a></li><li><a href="#1317-spring-kafka" class="table-of-contents__link toc-highlight">13.17. spring kafka</a></li><li><a href="#141-加解密" class="table-of-contents__link toc-highlight">14.1. 加解密</a></li><li><a href="#142-springboot-发送-https-或者-http-客户端-client" class="table-of-contents__link toc-highlight">14.2. springboot 发送 https 或者 http 客户端 client</a><ul><li><a href="#1421-发送-http-client" class="table-of-contents__link toc-highlight">14.2.1. 发送 http client</a></li><li><a href="#1422-发送-https-client" class="table-of-contents__link toc-highlight">14.2.2. 发送 https client</a></li></ul></li><li><a href="#143-requestcontextholder" class="table-of-contents__link toc-highlight">14.3. RequestContextHolder</a></li><li><a href="#144-解决-api-版本共存" class="table-of-contents__link toc-highlight">14.4. 解决 api 版本共存</a><ul><li><a href="#1441-requestmappinghandlermapping" class="table-of-contents__link toc-highlight">14.4.1. RequestMappingHandlerMapping</a></li><li><a href="#1442-request-matcher" class="table-of-contents__link toc-highlight">14.4.2. request matcher</a></li><li><a href="#1443-request-condition" class="table-of-contents__link toc-highlight">14.4.3. request condition</a></li></ul></li><li><a href="#145-接收参数相关的注解" class="table-of-contents__link toc-highlight">14.5. 接收参数相关的注解</a></li><li><a href="#146-自定义接收参数类型" class="table-of-contents__link toc-highlight">14.6. 自定义接收参数类型</a></li><li><a href="#147-返回图片" class="table-of-contents__link toc-highlight">14.7. 返回图片</a></li><li><a href="#148-rest-api-文档" class="table-of-contents__link toc-highlight">14.8. rest api 文档</a><ul><li><a href="#1481-knife4j" class="table-of-contents__link toc-highlight">14.8.1. knife4j</a></li><li><a href="#1482-springdoc-openapi" class="table-of-contents__link toc-highlight">14.8.2. springdoc-openapi</a></li><li><a href="#1483-swagger3" class="table-of-contents__link toc-highlight">14.8.3. swagger3</a></li><li><a href="#1484-集成swagger2" class="table-of-contents__link toc-highlight">14.8.4. 集成swagger2</a></li></ul></li><li><a href="#149-过滤器-和-拦截器" class="table-of-contents__link toc-highlight">14.9. 过滤器 和 拦截器</a><ul><li><a href="#1491-区别" class="table-of-contents__link toc-highlight">14.9.1. 区别</a></li><li><a href="#1492-使用-filter" class="table-of-contents__link toc-highlight">14.9.2. 使用 filter</a></li><li><a href="#1493-使用-interceptor" class="table-of-contents__link toc-highlight">14.9.3. 使用 interceptor</a><ul><li><a href="#14931-基本使用拦截器" class="table-of-contents__link toc-highlight">14.9.3.1. 基本使用拦截器</a></li><li><a href="#14932-基于-url-拦截" class="table-of-contents__link toc-highlight">14.9.3.2. 基于 url 拦截</a></li><li><a href="#14933-基于注解拦截" class="table-of-contents__link toc-highlight">14.9.3.3. 基于注解拦截</a></li></ul></li></ul></li><li><a href="#1410-servlet-druid-监控" class="table-of-contents__link toc-highlight">14.10. servlet Druid 监控</a></li><li><a href="#1411-aop-整合使用" class="table-of-contents__link toc-highlight">14.11. aop 整合使用</a><ul><li><a href="#14111-基本使用" class="table-of-contents__link toc-highlight">14.11.1. 基本使用</a></li><li><a href="#14112-切入点表达式" class="table-of-contents__link toc-highlight">14.11.2. 切入点表达式</a></li></ul></li><li><a href="#1412-controlleradvice-异常处理" class="table-of-contents__link toc-highlight">14.12. @controllerAdvice 异常处理</a></li><li><a href="#1413-httpservletrequest-的输入流只能读取一次的问题" class="table-of-contents__link toc-highlight">14.13. HttpServletRequest 的输入流只能读取一次的问题</a></li><li><a href="#1414-路由处理" class="table-of-contents__link toc-highlight">14.14. 路由处理</a><ul><li><a href="#14141-静态资源映射-暴露静态资源" class="table-of-contents__link toc-highlight">14.14.1. 静态资源映射 暴露静态资源</a></li><li><a href="#14142-添加-view-controller" class="table-of-contents__link toc-highlight">14.14.2. 添加 view controller</a></li></ul></li><li><a href="#1415-spring-boot-starter-thymeleaf" class="table-of-contents__link toc-highlight">14.15. spring-boot-starter-thymeleaf</a></li><li><a href="#151-支持-https-ssl" class="table-of-contents__link toc-highlight">15.1. 支持 https ssl</a><ul><li><a href="#1511-nginx-配置-https" class="table-of-contents__link toc-highlight">15.1.1. nginx 配置 https</a></li><li><a href="#1512-支持-https-访问" class="table-of-contents__link toc-highlight">15.1.2. 支持 https 访问</a></li><li><a href="#1513-http-请求自动转为-https" class="table-of-contents__link toc-highlight">15.1.3. http 请求自动转为 https</a></li><li><a href="#1514-同时支持-http-https" class="table-of-contents__link toc-highlight">15.1.4. 同时支持 http https</a></li></ul></li><li><a href="#152-容器化部署" class="table-of-contents__link toc-highlight">15.2. 容器化部署</a></li><li><a href="#153-nginx-反向代理" class="table-of-contents__link toc-highlight">15.3. nginx 反向代理</a></li><li><a href="#154-内嵌-tomcat-调优" class="table-of-contents__link toc-highlight">15.4. 内嵌 tomcat 调优</a></li><li><a href="#155-配置-war-包部署到-tomcat" class="table-of-contents__link toc-highlight">15.5. 配置 war 包部署到 Tomcat</a></li><li><a href="#161-使用异步编程" class="table-of-contents__link toc-highlight">16.1. 使用异步编程</a><ul><li><a href="#1611-配置线程池" class="table-of-contents__link toc-highlight">16.1.1. 配置线程池</a></li><li><a href="#1612-有返回值-没有返回值" class="table-of-contents__link toc-highlight">16.1.2. 有返回值 没有返回值</a></li><li><a href="#1613-async失效" class="table-of-contents__link toc-highlight">16.1.3. @Async失效</a></li></ul></li><li><a href="#201-lombok-notice" class="table-of-contents__link toc-highlight">20.1. lombok notice</a></li><li><a href="#202-devtools" class="table-of-contents__link toc-highlight">20.2. devtools</a></li><li><a href="#203-maven-wrapper" class="table-of-contents__link toc-highlight">20.3. maven wrapper</a></li><li><a href="#211-校验配置文件" class="table-of-contents__link toc-highlight">21.1. 校验配置文件</a></li><li><a href="#212-校验请求参数" class="table-of-contents__link toc-highlight">21.2. 校验请求参数</a></li><li><a href="#213-自定义校验" class="table-of-contents__link toc-highlight">21.3. 自定义校验</a></li><li><a href="#214-validated和valid" class="table-of-contents__link toc-highlight">21.4. @Validated和@Valid</a></li><li><a href="#221-获取命令行参数" class="table-of-contents__link toc-highlight">22.1. 获取命令行参数</a></li><li><a href="#222-applicationrunner-or-commandlinerunner" class="table-of-contents__link toc-highlight">22.2. <code>ApplicationRunner</code> or <code>CommandLineRunner</code></a></li><li><a href="#251-整合-xxl-job-任务调度平台" class="table-of-contents__link toc-highlight">25.1. 整合 XXL-JOB 任务调度平台</a></li><li><a href="#252-异步任务" class="table-of-contents__link toc-highlight">25.2. 异步任务</a></li><li><a href="#253-定时任务" class="table-of-contents__link toc-highlight">25.3. 定时任务</a><ul><li><a href="#2531-springboot-内置" class="table-of-contents__link toc-highlight">25.3.1. springboot 内置</a></li><li><a href="#2532-集成-quartz" class="table-of-contents__link toc-highlight">25.3.2. 集成 Quartz</a></li></ul></li><li><a href="#261-读取配置文件" class="table-of-contents__link toc-highlight">26.1. 读取配置文件</a><ul><li><a href="#2611-几种读取配置文件的方法" class="table-of-contents__link toc-highlight">26.1.1. 几种读取配置文件的方法</a></li><li><a href="#2612-注入复杂类型" class="table-of-contents__link toc-highlight">26.1.2. 注入复杂类型</a></li></ul></li><li><a href="#262-配置文件优先级" class="table-of-contents__link toc-highlight">26.2. 配置文件优先级</a></li><li><a href="#263-读取环境信息" class="table-of-contents__link toc-highlight">26.3. 读取环境信息</a></li><li><a href="#264-两种引入-springboot-方式" class="table-of-contents__link toc-highlight">26.4. 两种引入 springboot 方式</a></li><li><a href="#271-日期时间-json" class="table-of-contents__link toc-highlight">27.1. 日期时间 json</a></li><li><a href="#272-jackson-使用" class="table-of-contents__link toc-highlight">27.2. jackson 使用</a><ul><li><a href="#2721-jsoncomponent" class="table-of-contents__link toc-highlight">27.2.1. @JsonComponent</a></li><li><a href="#2722-jackson-在-springboot-中的配置" class="table-of-contents__link toc-highlight">27.2.2. Jackson 在 springboot 中的配置</a></li><li><a href="#2723-jackson注解" class="table-of-contents__link toc-highlight">27.2.3. jackson注解</a></li><li><a href="#2724-objectmapper-定制" class="table-of-contents__link toc-highlight">27.2.4. objectmapper 定制</a></li><li><a href="#2725-objectmapper-使用" class="table-of-contents__link toc-highlight">27.2.5. objectmapper 使用</a></li></ul></li><li><a href="#291-bean-懒加载" class="table-of-contents__link toc-highlight">29.1. bean 懒加载</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discordapp.com/users/yuu#3743" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/xiaoyuhfq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/xiaoyureed" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Xiaoyureed, Inc. Built with ❤️ by xiaoyu.</div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.71354b01.js"></script>
<script src="/en/assets/js/main.be3ba4f3.js"></script>
</body>
</html>