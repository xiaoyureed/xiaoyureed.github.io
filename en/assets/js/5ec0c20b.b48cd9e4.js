"use strict";(self.webpackChunkwiki_1=self.webpackChunkwiki_1||[]).push([[5438],{3905:(e,n,t)=>{t.d(n,{Zo:()=>s,kt:()=>u});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=a.createContext({}),k=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},s=function(e){var n=k(e.components);return a.createElement(p.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),c=k(t),m=r,u=c["".concat(p,".").concat(m)]||c[m]||d[m]||l;return t?a.createElement(u,o(o({ref:n},s),{},{components:t})):a.createElement(u,o({ref:n},s))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,o=new Array(l);o[0]=m;var i={};for(var p in n)hasOwnProperty.call(n,p)&&(i[p]=n[p]);i.originalType=e,i[c]="string"==typeof e?e:r,o[1]=i;for(var k=2;k<l;k++)o[k]=t[k];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},6991:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>k});var a=t(7462),r=(t(7294),t(3905));const l={title:"Docker Note & Other Virtual Develop Environment",tags:["docker"],date:new Date("2017-12-14T11:22:42.000Z"),toc_min_heading_level:2,toc_max_heading_level:5},o=void 0,i={unversionedId:"docker-note-virtual-dev-env",id:"docker-note-virtual-dev-env",title:"Docker Note & Other Virtual Develop Environment",description:"https://edu.aliyun.com/roadmap/cloudnative?from=timeline",source:"@site/docs/docker-note-virtual-dev-env.md",sourceDirName:".",slug:"/docker-note-virtual-dev-env",permalink:"/en/docs/docker-note-virtual-dev-env",draft:!1,editUrl:"https://github.com/xiaoyureed/xiaoyureed.github.io/tree/main/docs/docker-note-virtual-dev-env.md",tags:[{label:"docker",permalink:"/en/docs/tags/docker"}],version:"current",frontMatter:{title:"Docker Note & Other Virtual Develop Environment",tags:["docker"],date:"2017-12-14T11:22:42.000Z",toc_min_heading_level:2,toc_max_heading_level:5},sidebar:"tutorialSidebar",previous:{title:"Distributed System \u5206\u5e03\u5f0f",permalink:"/en/docs/distributed-system"},next:{title:"Effective Java \u9605\u8bfb\u7b14\u8bb0",permalink:"/en/docs/effective-java-reading-note"}},p={},k=[{value:"\u57fa\u672c\u67b6\u6784",id:"\u57fa\u672c\u67b6\u6784",level:2},{value:"\u4f7f\u7528\u573a\u666f-\u5f97\u5230\u4ec0\u4e48\u597d\u5904",id:"\u4f7f\u7528\u573a\u666f-\u5f97\u5230\u4ec0\u4e48\u597d\u5904",level:2},{value:"\u5bb9\u5668\u5b9e\u73b0\u7684\u539f\u7406",id:"\u5bb9\u5668\u5b9e\u73b0\u7684\u539f\u7406",level:2},{value:"\u4f7f\u7528\u56fd\u5185\u955c\u50cf",id:"\u4f7f\u7528\u56fd\u5185\u955c\u50cf",level:2},{value:"\u955c\u50cf\u5b9e\u73b0\u539f\u7406",id:"\u955c\u50cf\u5b9e\u73b0\u539f\u7406",level:2},{value:"\u83b7\u53d6\u955c\u50cf",id:"\u83b7\u53d6\u955c\u50cf",level:2},{value:"\u8fd0\u884c\u955c\u50cf",id:"\u8fd0\u884c\u955c\u50cf",level:2},{value:"\u5217\u51fa\u955c\u50cf",id:"\u5217\u51fa\u955c\u50cf",level:2},{value:"\u5220\u9664\u672c\u5730\u955c\u50cf",id:"\u5220\u9664\u672c\u5730\u955c\u50cf",level:2},{value:"\u6700\u4f73\u5b9e\u8df5 \u4f18\u5316\u4f53\u79ef",id:"\u6700\u4f73\u5b9e\u8df5-\u4f18\u5316\u4f53\u79ef",level:2},{value:"\u901a\u8fc7 dockerfile \u6765 build \u955c\u50cf",id:"\u901a\u8fc7-dockerfile-\u6765-build-\u955c\u50cf",level:2},{value:"commit\u5bb9\u5668\u6210\u4e3a\u955c\u50cf-\u4e0d\u63a8\u8350",id:"commit\u5bb9\u5668\u6210\u4e3a\u955c\u50cf-\u4e0d\u63a8\u8350",level:2},{value:"\u4ece\u538b\u7f29\u5305\u5bfc\u5165",id:"\u4ece\u538b\u7f29\u5305\u5bfc\u5165",level:2},{value:"docker save \u548c docker load",id:"docker-save-\u548c-docker-load",level:2},{value:"run \u548c from",id:"run-\u548c-from",level:2},{value:"\u955c\u50cf\u7684\u6784\u5efa\u4e0a\u4e0b\u6587context",id:"\u955c\u50cf\u7684\u6784\u5efa\u4e0a\u4e0b\u6587context",level:2},{value:"COPY \u548c ADD",id:"copy-\u548c-add",level:2},{value:"WORKDIR \u6307\u5b9a\u5de5\u4f5c\u76ee\u5f55",id:"workdir-\u6307\u5b9a\u5de5\u4f5c\u76ee\u5f55",level:2},{value:"run cmd \u548c entrypoint \u5bb9\u5668\u542f\u52a8\u547d\u4ee4",id:"run-cmd-\u548c-entrypoint-\u5bb9\u5668\u542f\u52a8\u547d\u4ee4",level:2},{value:"ENV \u548c arg \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf",id:"env-\u548c-arg-\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf",level:2},{value:"VOLUME \u5b9a\u4e49\u533f\u540d\u6570\u636e\u5377",id:"volume-\u5b9a\u4e49\u533f\u540d\u6570\u636e\u5377",level:2},{value:"EXPOSE \u58f0\u660e\u7aef\u53e3",id:"expose-\u58f0\u660e\u7aef\u53e3",level:2},{value:"USER \u6307\u5b9a\u5f53\u524d\u7528\u6237",id:"user-\u6307\u5b9a\u5f53\u524d\u7528\u6237",level:2},{value:"HEALTHCHECK \u5065\u5eb7\u68c0\u67e5",id:"healthcheck-\u5065\u5eb7\u68c0\u67e5",level:2},{value:"ONBUILD \u7ed9\u522b\u4eba\u7528",id:"onbuild-\u7ed9\u522b\u4eba\u7528",level:2},{value:"Dockerfile\u7684\u591a\u9636\u6bb5\u6784\u5efa",id:"dockerfile\u7684\u591a\u9636\u6bb5\u6784\u5efa",level:2},{value:"\u67e5\u770b",id:"\u67e5\u770b",level:2},{value:"\u542f\u52a8",id:"\u542f\u52a8",level:2},{value:"-it \u7ef4\u6301\u4ea4\u4e92\u7ec8\u7aef",id:"-it-\u7ef4\u6301\u4ea4\u4e92\u7ec8\u7aef",level:3},{value:"-d \u540e\u53f0\u8fd0\u884c",id:"-d-\u540e\u53f0\u8fd0\u884c",level:3},{value:"--privileged=true \u8d4b\u4e88\u7279\u6743",id:"--privilegedtrue-\u8d4b\u4e88\u7279\u6743",level:3},{value:"\u7ec8\u6b62container",id:"\u7ec8\u6b62container",level:2},{value:"\u5220\u9664container",id:"\u5220\u9664container",level:2},{value:"\u8fdb\u5165\u5bb9\u5668",id:"\u8fdb\u5165\u5bb9\u5668",level:2},{value:"\u5bb9\u5668\u7684\u5bfc\u5165\u548c\u5bfc\u51fa",id:"\u5bb9\u5668\u7684\u5bfc\u5165\u548c\u5bfc\u51fa",level:2},{value:"\u62f7\u8d1d\u5bb9\u5668\u5185\u6587\u4ef6\u5230\u4e3b\u673a",id:"\u62f7\u8d1d\u5bb9\u5668\u5185\u6587\u4ef6\u5230\u4e3b\u673a",level:2},{value:"dockerhub",id:"dockerhub",level:2},{value:"\u79c1\u6709\u4ed3\u5e93",id:"\u79c1\u6709\u4ed3\u5e93",level:2},{value:"\u6570\u636e\u5377",id:"\u6570\u636e\u5377",level:2},{value:"\u6302\u8f7d\u4e3b\u673a\u76ee\u5f55",id:"\u6302\u8f7d\u4e3b\u673a\u76ee\u5f55",level:2},{value:"volume \u7684\u5171\u4eab",id:"volume-\u7684\u5171\u4eab",level:2},{value:"docker \u9ed8\u8ba4\u521d\u59cb\u521b\u5efa",id:"docker-\u9ed8\u8ba4\u521d\u59cb\u521b\u5efa",level:2},{value:"\u7f51\u5361",id:"\u7f51\u5361",level:2},{value:"network\u5206\u7c7b",id:"network\u5206\u7c7b",level:2},{value:"bridge \u7c7b\u578b",id:"bridge-\u7c7b\u578b",level:3},{value:"host \u7c7b\u578b",id:"host-\u7c7b\u578b",level:3},{value:"\u521b\u5efa\u56fa\u5b9aip",id:"\u521b\u5efa\u56fa\u5b9aip",level:2},{value:"\u67e5\u770bcontainer\u7684ip",id:"\u67e5\u770bcontainer\u7684ip",level:2},{value:"\u5916\u90e8\u8bbf\u95ee\u5bb9\u5668",id:"\u5916\u90e8\u8bbf\u95ee\u5bb9\u5668",level:2},{value:"\u5bb9\u5668\u4e92\u8054",id:"\u5bb9\u5668\u4e92\u8054",level:2},{value:"\u914d\u7f6edns \u548c \u4e3b\u673a\u540d hostname",id:"\u914d\u7f6edns-\u548c-\u4e3b\u673a\u540d-hostname",level:2},{value:"compose\u7b80\u4ecb",id:"compose\u7b80\u4ecb",level:2},{value:"\u547d\u4ee4\u4f7f\u7528",id:"\u547d\u4ee4\u4f7f\u7528",level:2},{value:"up",id:"up",level:3},{value:"run",id:"run",level:3},{value:"scale",id:"scale",level:3},{value:"start",id:"start",level:3},{value:"build",id:"build",level:3},{value:"config",id:"config",level:3},{value:"exec",id:"exec",level:3},{value:"images",id:"images",level:3},{value:"kill",id:"kill",level:3},{value:"down",id:"down",level:3},{value:"pause",id:"pause",level:3},{value:"unpause",id:"unpause",level:3},{value:"restart",id:"restart",level:3},{value:"stop",id:"stop",level:3},{value:"rm",id:"rm",level:3},{value:"logs",id:"logs",level:3},{value:"top",id:"top",level:3},{value:"version",id:"version",level:3},{value:"port",id:"port",level:3},{value:"ps",id:"ps",level:3},{value:"pull",id:"pull",level:3},{value:"push",id:"push",level:3},{value:"docker-compose.yml",id:"docker-composeyml",level:2},{value:"\u642d\u5efa\u6301\u7eed\u96c6\u6210\u7cfb\u7edf",id:"\u642d\u5efa\u6301\u7eed\u96c6\u6210\u7cfb\u7edf",level:2},{value:"docker\u548cspringboot",id:"docker\u548cspringboot",level:2},{value:"oracle11g",id:"oracle11g",level:2},{value:"\u4f7f\u7528 mysql \u955c\u50cf",id:"\u4f7f\u7528-mysql-\u955c\u50cf",level:2},{value:"\u4f7f\u7528postgres\u955c\u50cf",id:"\u4f7f\u7528postgres\u955c\u50cf",level:2},{value:"\u4f7f\u7528 rabbitmq\u955c\u50cf",id:"\u4f7f\u7528-rabbitmq\u955c\u50cf",level:2},{value:"redis\u955c\u50cf",id:"redis\u955c\u50cf",level:2},{value:"ubuntu\u955c\u50cf",id:"ubuntu\u955c\u50cf",level:2},{value:"zookeeper",id:"zookeeper",level:2},{value:"kafka",id:"kafka",level:2},{value:"rabbitmq",id:"rabbitmq",level:2},{value:"zipkin",id:"zipkin",level:2},{value:"nginx",id:"nginx",level:2},{value:"mongodb",id:"mongodb",level:2},{value:"gitlab",id:"gitlab",level:2},{value:"etcd",id:"etcd",level:2},{value:"influxdb",id:"influxdb",level:2},{value:"\u57fa\u672c\u4f7f\u7528",id:"\u57fa\u672c\u4f7f\u7528",level:2},{value:"vagrant \u8bbe\u7f6e ip",id:"vagrant-\u8bbe\u7f6e-ip",level:2},{value:"VirtualBox\u56db\u79cd\u7f51\u7edc\u6a21\u5f0f",id:"virtualbox\u56db\u79cd\u7f51\u7edc\u6a21\u5f0f",level:2}],s={toc:k},c="wrapper";function d(e){let{components:n,...t}=e;return(0,r.kt)(c,(0,a.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("div",{align:"center"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://edu.aliyun.com/roadmap/cloudnative?from=timeline"},"https://edu.aliyun.com/roadmap/cloudnative?from=timeline")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://yomxxx.github.io/2020/11/20/20201120-docker-web/"},"https://yomxxx.github.io/2020/11/20/20201120-docker-web/")," \u642d\u5efa\u524d\u7aef\u5f00\u53d1\u73af\u5883"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/yeasy/docker_practice"},"https://github.com/yeasy/docker_practice"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://vuepress.mirror.docker-practice.com/"},"https://vuepress.mirror.docker-practice.com/")),(0,r.kt)("p",null,"\u66ff\u4ee3\u54c1:\ncontainerd ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/containerd/containerd/"},"https://github.com/containerd/containerd/"),"\nPodman\nCRI-O ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cri-o/cri-o"},"https://github.com/cri-o/cri-o"),"\n\u53c2\u8003:\n",(0,r.kt)("a",{parentName:"p",href:"https://juejin.cn/post/7005393730131722247"},"https://juejin.cn/post/7005393730131722247"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://segmentfault.com/a/1190000040633750"},"https://segmentfault.com/a/1190000040633750"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://www.modb.pro/db/43692"},"https://www.modb.pro/db/43692")),(0,r.kt)("p",null,"Docker Note | reference: ",(0,r.kt)("a",{parentName:"p",href:"https://docker_practice.gitee.io/image/dockerfile/healthcheck.html"},"1"),", ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/"},"2"),", ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/docker-library/docs"},"3"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/zmx729618/article/details/72930474"},"https://blog.csdn.net/zmx729618/article/details/72930474")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://labs.play-with-docker.com/"},"docker online")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.katacoda.com/"},"\u5feb\u901f\u7684\u5b9e\u9a8c\u73af\u5883")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/wsargent/docker-cheat-sheet"},"https://github.com/wsargent/docker-cheat-sheet")," \u901f\u67e5\u8868"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/docker/kitematic"},"https://github.com/docker/kitematic")," \u53ef\u89c6\u5316\u7ba1\u7406gui")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1-%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"},"1. \u5e38\u7528\u6307\u4ee4")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#2-%E5%BC%80%E5%90%AF%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5"},"2. \u5f00\u542f\u8fdc\u7a0b\u8fde\u63a5")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#3-shipyard-ui%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2"},"3. shipyard ui\u7ba1\u7406\u754c\u9762")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#4-%E4%BB%8B%E7%BB%8D"},"4. \u4ecb\u7ecd"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#41-%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84"},"4.1. \u57fa\u672c\u67b6\u6784")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#42-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-%E5%BE%97%E5%88%B0%E4%BB%80%E4%B9%88%E5%A5%BD%E5%A4%84"},"4.2. \u4f7f\u7528\u573a\u666f-\u5f97\u5230\u4ec0\u4e48\u597d\u5904")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#43-%E5%AE%B9%E5%99%A8%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8E%9F%E7%90%86"},"4.3. \u5bb9\u5668\u5b9e\u73b0\u7684\u539f\u7406")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#5-%E5%AE%89%E8%A3%85"},"5. \u5b89\u88c5"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#51-%E4%BD%BF%E7%94%A8%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F"},"5.1. \u4f7f\u7528\u56fd\u5185\u955c\u50cf")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6-%E9%95%9C%E5%83%8F-image"},"6. \u955c\u50cf image"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#61-%E9%95%9C%E5%83%8F%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"},"6.1. \u955c\u50cf\u5b9e\u73b0\u539f\u7406")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#62-%E8%8E%B7%E5%8F%96%E9%95%9C%E5%83%8F"},"6.2. \u83b7\u53d6\u955c\u50cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#63-%E8%BF%90%E8%A1%8C%E9%95%9C%E5%83%8F"},"6.3. \u8fd0\u884c\u955c\u50cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#64-%E5%88%97%E5%87%BA%E9%95%9C%E5%83%8F"},"6.4. \u5217\u51fa\u955c\u50cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#65-%E5%88%A0%E9%99%A4%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F"},"6.5. \u5220\u9664\u672c\u5730\u955c\u50cf")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#7-%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F%E7%9A%84%E6%96%B9%E6%B3%95"},"7. \u5236\u4f5c\u955c\u50cf\u7684\u65b9\u6cd5"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#71-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E4%BC%98%E5%8C%96%E4%BD%93%E7%A7%AF"},"7.1. \u6700\u4f73\u5b9e\u8df5 \u4f18\u5316\u4f53\u79ef")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#72-%E9%80%9A%E8%BF%87-dockerfile-%E6%9D%A5-build-%E9%95%9C%E5%83%8F"},"7.2. \u901a\u8fc7 dockerfile \u6765 build \u955c\u50cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#73-commit%E5%AE%B9%E5%99%A8%E6%88%90%E4%B8%BA%E9%95%9C%E5%83%8F-%E4%B8%8D%E6%8E%A8%E8%8D%90"},"7.3. commit\u5bb9\u5668\u6210\u4e3a\u955c\u50cf-\u4e0d\u63a8\u8350")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#74-%E4%BB%8E%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%AF%BC%E5%85%A5"},"7.4. \u4ece\u538b\u7f29\u5305\u5bfc\u5165")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#75-docker-save-%E5%92%8C-docker-load"},"7.5. docker save \u548c docker load")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#8-dockerfile"},"8. Dockerfile"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#81-run-%E5%92%8C-from"},"8.1. run \u548c from")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#82-%E9%95%9C%E5%83%8F%E7%9A%84%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87context"},"8.2. \u955c\u50cf\u7684\u6784\u5efa\u4e0a\u4e0b\u6587context")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#83-copy-%E5%92%8C-add"},"8.3. COPY \u548c ADD")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#84-workdir-%E6%8C%87%E5%AE%9A%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95"},"8.4. WORKDIR \u6307\u5b9a\u5de5\u4f5c\u76ee\u5f55")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#85-run-cmd-%E5%92%8C-entrypoint-%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4"},"8.5. run cmd \u548c entrypoint \u5bb9\u5668\u542f\u52a8\u547d\u4ee4")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#86-env-%E5%92%8C-arg-%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"},"8.6. ENV \u548c arg \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#87-volume-%E5%AE%9A%E4%B9%89%E5%8C%BF%E5%90%8D%E6%95%B0%E6%8D%AE%E5%8D%B7"},"8.7. VOLUME \u5b9a\u4e49\u533f\u540d\u6570\u636e\u5377")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#88-expose-%E5%A3%B0%E6%98%8E%E7%AB%AF%E5%8F%A3"},"8.8. EXPOSE \u58f0\u660e\u7aef\u53e3")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#89-user-%E6%8C%87%E5%AE%9A%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7"},"8.9. USER \u6307\u5b9a\u5f53\u524d\u7528\u6237")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#810-healthcheck-%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5"},"8.10. HEALTHCHECK \u5065\u5eb7\u68c0\u67e5")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#811-onbuild-%E7%BB%99%E5%88%AB%E4%BA%BA%E7%94%A8"},"8.11. ONBUILD \u7ed9\u522b\u4eba\u7528")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#812-dockerfile%E7%9A%84%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E5%BB%BA"},"8.12. Dockerfile\u7684\u591a\u9636\u6bb5\u6784\u5efa")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#9-%E4%BD%BF%E7%94%A8%E5%AE%B9%E5%99%A8"},"9. \u4f7f\u7528\u5bb9\u5668"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#91-%E6%9F%A5%E7%9C%8B"},"9.1. \u67e5\u770b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#92-%E5%90%AF%E5%8A%A8"},"9.2. \u542f\u52a8"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#921--it-%E7%BB%B4%E6%8C%81%E4%BA%A4%E4%BA%92%E7%BB%88%E7%AB%AF"},"9.2.1. -it \u7ef4\u6301\u4ea4\u4e92\u7ec8\u7aef")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#922--d-%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C"},"9.2.2. -d \u540e\u53f0\u8fd0\u884c")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#923---privilegedtrue-%E8%B5%8B%E4%BA%88%E7%89%B9%E6%9D%83"},"9.2.3. --privileged=true \u8d4b\u4e88\u7279\u6743")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#93-%E7%BB%88%E6%AD%A2container"},"9.3. \u7ec8\u6b62container")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#94-%E5%88%A0%E9%99%A4container"},"9.4. \u5220\u9664container")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#95-%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8"},"9.5. \u8fdb\u5165\u5bb9\u5668")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#96-%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA"},"9.6. \u5bb9\u5668\u7684\u5bfc\u5165\u548c\u5bfc\u51fa")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#97-%E6%8B%B7%E8%B4%9D%E5%AE%B9%E5%99%A8%E5%86%85%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%BB%E6%9C%BA"},"9.7. \u62f7\u8d1d\u5bb9\u5668\u5185\u6587\u4ef6\u5230\u4e3b\u673a")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#10-%E8%AE%BF%E9%97%AE%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"},"10. \u8bbf\u95ee\u955c\u50cf\u4ed3\u5e93"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#101-dockerhub"},"10.1. dockerhub")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#102-%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93"},"10.2. \u79c1\u6709\u4ed3\u5e93")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#11-docker%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86"},"11. docker\u6570\u636e\u7ba1\u7406"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#111-%E6%95%B0%E6%8D%AE%E5%8D%B7"},"11.1. \u6570\u636e\u5377")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#112-%E6%8C%82%E8%BD%BD%E4%B8%BB%E6%9C%BA%E7%9B%AE%E5%BD%95"},"11.2. \u6302\u8f7d\u4e3b\u673a\u76ee\u5f55")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#113-volume-%E7%9A%84%E5%85%B1%E4%BA%AB"},"11.3. volume \u7684\u5171\u4eab")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#12-%E7%BD%91%E7%BB%9C%E4%BA%92%E8%81%94"},"12. \u7f51\u7edc\u4e92\u8054"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#121-docker-%E9%BB%98%E8%AE%A4%E5%88%9D%E5%A7%8B%E5%88%9B%E5%BB%BA"},"12.1. docker \u9ed8\u8ba4\u521d\u59cb\u521b\u5efa")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#122-%E7%BD%91%E5%8D%A1"},"12.2. \u7f51\u5361")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#123-network%E5%88%86%E7%B1%BB"},"12.3. network\u5206\u7c7b"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1231-bridge-%E7%B1%BB%E5%9E%8B"},"12.3.1. bridge \u7c7b\u578b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1232-host-%E7%B1%BB%E5%9E%8B"},"12.3.2. host \u7c7b\u578b")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#124-%E5%88%9B%E5%BB%BA%E5%9B%BA%E5%AE%9Aip"},"12.4. \u521b\u5efa\u56fa\u5b9aip")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#125-%E6%9F%A5%E7%9C%8Bcontainer%E7%9A%84ip"},"12.5. \u67e5\u770bcontainer\u7684ip")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#126-%E5%A4%96%E9%83%A8%E8%AE%BF%E9%97%AE%E5%AE%B9%E5%99%A8"},"12.6. \u5916\u90e8\u8bbf\u95ee\u5bb9\u5668")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#127-%E5%AE%B9%E5%99%A8%E4%BA%92%E8%81%94"},"12.7. \u5bb9\u5668\u4e92\u8054")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#128-%E9%85%8D%E7%BD%AEdns-%E5%92%8C-%E4%B8%BB%E6%9C%BA%E5%90%8D-hostname"},"12.8. \u914d\u7f6edns \u548c \u4e3b\u673a\u540d hostname")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13-docker-compose"},"13. docker-compose"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#131-compose%E7%AE%80%E4%BB%8B"},"13.1. compose\u7b80\u4ecb")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#132-%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8"},"13.2. \u547d\u4ee4\u4f7f\u7528"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1321-up"},"13.2.1. up")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1322-run"},"13.2.2. run")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1323-scale"},"13.2.3. scale")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1324-start"},"13.2.4. start")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1325-build"},"13.2.5. build")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1326-config"},"13.2.6. config")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1327-exec"},"13.2.7. exec")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1328-images"},"13.2.8. images")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1329-kill"},"13.2.9. kill")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13210-down"},"13.2.10. down")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13211-pause"},"13.2.11. pause")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13212-unpause"},"13.2.12. unpause")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13213-restart"},"13.2.13. restart")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13214-stop"},"13.2.14. stop")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13215-rm"},"13.2.15. rm")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13216-logs"},"13.2.16. logs")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13217-top"},"13.2.17. top")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13218-version"},"13.2.18. version")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13219-port"},"13.2.19. port")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13220-ps"},"13.2.20. ps")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13221-pull"},"13.2.21. pull")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#13222-push"},"13.2.22. push")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#133-docker-composeyml"},"13.3. docker-compose.yml")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#14-docker-machine"},"14. docker-machine")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#15-docker-swarmswarm-mode"},"15. docker-swarm,swarm-mode")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#16-docker%E5%AE%9E%E8%B7%B5"},"16. docker\u5b9e\u8df5"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#161-%E6%90%AD%E5%BB%BA%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E7%B3%BB%E7%BB%9F"},"16.1. \u642d\u5efa\u6301\u7eed\u96c6\u6210\u7cfb\u7edf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#162-docker%E5%92%8Cspringboot"},"16.2. docker\u548cspringboot")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#163-oracle11g"},"16.3. oracle11g")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#164-%E4%BD%BF%E7%94%A8-mysql-%E9%95%9C%E5%83%8F"},"16.4. \u4f7f\u7528 mysql \u955c\u50cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#165-%E4%BD%BF%E7%94%A8postgres%E9%95%9C%E5%83%8F"},"16.5. \u4f7f\u7528postgres\u955c\u50cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#166-%E4%BD%BF%E7%94%A8-rabbitmq%E9%95%9C%E5%83%8F"},"16.6. \u4f7f\u7528 rabbitmq\u955c\u50cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#167-redis%E9%95%9C%E5%83%8F"},"16.7. redis\u955c\u50cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#168-ubuntu%E9%95%9C%E5%83%8F"},"16.8. ubuntu\u955c\u50cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#169-zookeeper"},"16.9. zookeeper")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1610-kafka"},"16.10. kafka")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1611-rabbitmq"},"16.11. rabbitmq")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1612-zipkin"},"16.12. zipkin")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1613-nginx"},"16.13. nginx")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1614-mongodb"},"16.14. mongodb")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1615-gitlab"},"16.15. gitlab")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1616-etcd"},"16.16. etcd")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1617-influxdb"},"16.17. influxdb")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#17-vagrant"},"17. vagrant"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#171-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"},"17.1. \u57fa\u672c\u4f7f\u7528")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#172-vagrant-%E8%AE%BE%E7%BD%AE-ip"},"17.2. vagrant \u8bbe\u7f6e ip")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#173-virtualbox%E5%9B%9B%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F"},"17.3. VirtualBox\u56db\u79cd\u7f51\u7edc\u6a21\u5f0f")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#18-kali"},"18. kali")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#19-%E8%99%9A%E6%8B%9F%E7%BD%91%E5%8D%A1-macvlan"},"19. \u865a\u62df\u7f51\u5361 macvlan")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#20-multipass"},"20. Multipass"))),(0,r.kt)("h1",{id:"\u5e38\u7528\u6307\u4ee4"},"\u5e38\u7528\u6307\u4ee4"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'docker -v # \u7248\u672c\ndocker version # client, server \u7248\u672c\n\n# \u8fd9\u79cd\u65b9\u5f0f\u53ef\u80fd\u4e0d\u51c6\n# \u63a8\u8350 ps -ef | grep <container id> \u627e\u5230 \u627e\u5230\u5bb9\u5668\u5bf9\u5e94\u7684\u8fdb\u7a0b, \u7136\u540e\u901a\u8fc7 top <pid > \u67e5\u770b\u5b9e\u9645\u5185\u5b58, cpu \u5360\u7528\ndocker stats # \u76d1\u89c6\u5bb9\u5668 CPU \u5185\u5b58\u4f7f\u7528\u7387\n\n\n########## \u66f4\u65b0 \u5bb9\u5668\u542f\u52a8\u914d\u7f6e\n\n# \u5bb9\u5668\u968f docker \u81ea\u52a8\u542f\u52a8\ndocker update <container> --restart=always\ndocker update --restart=no <container-id>\n\n\n######################### prune \u547d\u4ee4 (\u6e05\u7406)\n\n\ndocker container prune\ndocker images prune\ndocker volume prune\ndocker network prune\ndocker system prune     # \u5220\u9664\u4ee5\u4e0a\u6240\u6709\u7a7a\u95f2\n\n\n\n####################### image \u76f8\u5173\n\n\n\n# \u62c9\u53d6 docker pull\ndocker pull <image>:<tag>  \n\n# \u67e5\u770b\u955c\u50cf\ndocker images \ndocker image ls [image_name][:tag]       #\u67e5\u770b\u6240\u6709/\u6307\u5b9a\u7684\u955c\u50cf\ndocker image ls -a                    #\u663e\u793a\u5305\u62ec\u4e2d\u95f4\u5c42\u955c\u50cf\u5728\u5185\u7684\u6240\u6709\u955c\u50cf\n# \u81ea\u5b9a\u4e49\u7ed3\u679c\u955c\u50cf\u67e5\u8be2\ndocker image ls --format "{{.ID}}: {{.Repository}}"    # \u5217\u51fa\u955c\u50cf\u7ed3\u679c\uff0c\u5e76\u4e14\u53ea\u5305\u542b\u955c\u50cfID\u548c\u4ed3\u5e93\u540d\ndocker image ls --format "table {{.ID}}\\t{{.Repository}}\\t{{.Tag}}" #\u5e26\u6807\u9898, \u4f46\u662f\u81ea\u5df1\u5b9a\u4e49\u5217\ndocker image ls -q                        # \u4ec5\u4ec5\u663e\u793aimage\u7684id\n\n# \u5220\u9664\u955c\u50cf\ndocker image rm <xxx>                           \u5220\u9664\u6307\u5b9a\u955c\u50cf(\u53ef\u4ee5\u662fid, name....)\ndocker image rm $(docker image ls -q redis)     \u548c\u5176\u4ed6\u547d\u4ee4\u914d\u5408\u5220\u9664\ndocker image rm $(docker image ls -q -f before=mongo:3.2) \u914d\u5408\ndocker image prune                              \u6279\u91cf\u6e05\u7406\u4e34\u65f6\u955c\u50cf\u6587\u4ef6\n\n\n\n# ###########################docker machine\u7684\u547d\u4ee4\n\ndocker-machine ls                                  #\u67e5\u770b\u8fd0\u884cdocker server\u7684\u865a\u62df\u673a\ndocker-machine create --driver=virtualbox default  #\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u673a\u7528\u4e8e\u8fd0\u884cdocker\ndocker-machine env [default]          #\u67e5\u770b\u73af\u5883\u53d8\u91cf(\u673a\u5668ip\u5728\u91cc\u9762\u53ef\u4ee5\u770b\u5230), \u9ed8\u8ba4\u67e5\u770b\u540d\u4e3adefault\u7684\u673a\u5668\n\n\n\n############################ docker ps\n\n\n\ndocker ps | less -S                 #\u67e5\u770b\u6240\u6709\u8fd0\u884c\u7684container, \u6bcf\u6761\u8bb0\u5f55\u53ea\u5360\u7528\u4e00\u884c\u663e\u793a\ndocker ps -q                # \u4ec5\u4ec5\u663e\u793a id \u5217, \u914d\u5408 filter \u6e05\u7406\u5bb9\u5668\u65f6\u975e\u5e38\u597d\u7528\ndocker ps -a                       # \u67e5\u770b\u6240\u6709(\u5305\u62ec\u505c\u6b62\u7684container)\ndocker ps -s            # \u663e\u793a\u5bb9\u5668\u6587\u4ef6\u5927\u5c0f (\u5982 211MB (virtual 1.83GB), \u4e00\u4e2a\u662f\u5bb9\u5668\u771f\u5b9e\u589e\u52a0\u7684\u5927\u5c0f\uff0c\u4e00\u4e2a\u662f\u6574\u4e2a\u5bb9\u5668\u7684\u865a\u62df\u5927\u5c0f, \u5bb9\u5668\u865a\u62df\u5927\u5c0f = \u5bb9\u5668\u771f\u5b9e\u589e\u52a0\u5927\u5c0f + \u5bb9\u5668\u955c\u50cf\u5927\u5c0f)\n\n\n###################### \u8fc7\u6ee4 filter\n\n\n# [-f] \u8fc7\u6ee4, \u7b49\u540c --filter\n# [--filter "until=24h"] \u5220\u966424h\u4ee5\u524d\u7684; [--filter "label!=keep"]\u53ea\u5220\u9664\u6807\u7b7e\u4e0d\u4e3akeep\u7684\n# \n# - \u9009\u9879\u540e\u8ddf\u7684\u90fd\u662f\u952e\u503c\u5bf9 key=value (\u53ef\u4e0d\u5e26\u5f15\u53f7\uff09\uff0c\u5982\u679c\u6709\u591a\u4e2a\u8fc7\u6ee4\u6761\u4ef6\uff0c\u5c31\u591a\u6b21\u4f7f\u7528 filter \u9009\u9879\n# - \u76f8\u540c\u6761\u4ef6\u4e4b\u95f4\u7684\u5173\u7cfb\u662f\u6216\uff0c\u4e0d\u540c\u6761\u4ef6\u4e4b\u95f4\u7684\u5173\u7cfb\u662f\u4e0e\n# - id \u548c name\uff0c\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u4f7f\u7528\u8d77\u6765\u975e\u5e38\u7075\u6d3b\u3002\n# \ndocker ps --filter id=a1b2c3 --filter name=bingohuang\ndocker ps --filter name=bingo --filter name=huang --filter status=running # \u4ee5\u4e0a\u8fc7\u6ee4\u6761\u4ef6\u4f1a\u627e\u51fa name \u5305\u542b bingo \u6216 huang \u5e76\u4e14 status \u4e3a running \u7684\u5bb9\u5668\u3002\n\ndocker ps --filter name=^/bingohuang$ # \u7cbe\u786e\u5339\u914d name \u4e3a bingohuang \u7684\u5bb9\u5668\u3002\u6ce8\u610f\uff0c\u5bb9\u5668\u5b9e\u9645\u540d\u79f0\uff0c\u5f00\u5934\u662f\u6709\u4e00\u4e2a\u6b63\u659c\u7ebf / \uff0c\u53ef\u7528 docker inspect \u4e00\u770b\u4fbf\u77e5\ndocker ps --filter name=.*bingohuang.* # \u5339\u914d name \u5305\u542b bingohuang \u7684\u5bb9\u5668\uff0c\u548c --filter name=bingohuang \u4e00\u4e2a\u6548\u679c\u3002\n\n# \u6e05\u7406\u540d\u79f0\u5305\u542b bingohuang\uff0c\u4e14\u72b6\u6001\u4e3a exited \u6216 dead \u7684\u5bb9\u5668\ndocker rm $(docker ps -q --filter name=.*bingohuang.* --filter status=exited --filter status=dead 2>/dev/null)\n\n\n\n\n\n# ########################## Format \u683c\u5f0f\u5316\u663e\u793a\n\n# \u57fa\u4e8e Go template\uff08https://golang.org/pkg/html/template/\uff09\u8bed\u6cd5\n\ndocker ps --format "{{.ID}}: {{.Command}}"\n\n# \u5982\u679c\u60f3\u5e26\u4e0a\u8868\u683c\u5217\u5934\uff0c\u9700\u8981\u518d template \u4e2d\u52a0\u4e0a table \u6307\u4ee4\uff1a\ndocker ps --format "table {{.ID}}\\t{{.Command}}"\n\n# \u652f\u6301\u7684\u5176\u4ed6\u5360\u4f4d\u7b26 \n# ID, Names, Image, Command, CreatedAt, RuningFor (\u5b58\u6d3b\u4e86\u591a\u4e45\u4e86), Ports, Status, Size, Mounts (volumns \u7684\u540d\u5b57), Networks\n# Labels (\u6240\u6709\u8d34\u4e0a\u7684\u6807\u7b7e\u540d\u5b57), Label (\u6307\u5b9a\u6807\u7b7e\u540d\u7684\u6807\u7b7e\u503c, \u683c\u5f0f: \'{{.Label "xxx_label_value"}}\'), \n\n\n\n\n\n\n# ########################## \u67e5\u770b\u5143\u4fe1\u606f\n\n\ndocker system df             #\u67e5\u770b\u955c\u50cf\u3001\u5bb9\u5668\u3001\u6570\u636e\u5377\u6240\u5360\u7528\u7684\u7a7a\u95f4, \u8fd0\u884c\u72b6\u51b5(\u901a\u8fc7\u8868\u683c\u7684\u5f62\u5f0f)(\u5e38\u7528) \ndocker info        # docker\u7684\u57fa\u672c\u4fe1\u606f(\u591a\u5c11container, \u591a\u5c11image, \u5404\u4e2acontainer\u72b6\u51b5 ,docker root dir)\ndocker network ls                   #\u67e5\u770bdocker\u7f51\u7edc\ndocker build -t <nginx:v3> <.>      #\u6839\u636eDockerfile\u6784\u5efa\u955c\u50cf\n    # -t \u6307\u5b9a\u955c\u50cf\u540d\u79f0\n    # . \u8868\u793a\u6784\u5efa\u4e0a\u4e0b\u6587 context \u4e3a\u5f53\u524d\u76ee\u5f55\ndocker top <id, container_name>\n\n\n\n######################## docker run/exec\n\n\n\ndocker run <IMAGE> env                              \u67e5\u770b\u955c\u50cf\u652f\u6301\u7684\u73af\u5883\u53d8\u91cf\ndocker run --name webserver -d -p <host_port>:<container_port> nginx       \u6307\u5b9acontainer\u540d\u5b57\u8fd0\u884c, \u7aef\u53e3\u6620\u5c04,  -p <\u5bbf\u4e3b\u7aef\u53e3>:<\u5bb9\u5668\u7aef\u53e3>\n    * `-d` \u540e\u53f0\u8fd0\u884c(\u4e0d\u52a0, \u5219\u524d\u53f0\u8fd0\u884c, \u65e5\u5fd7\u8f93\u51fa\u5230\u524d\u53f0, ctrl+c\u4e0d\u4f1a\u7ec8\u6b62container, \u4f46\u4f1a\u7ec8\u6b62\u65e5\u5fd7\u8f93\u51fa)\n    * `-p` \u6307\u5b9a\u7aef\u53e3\u6620\u5c04\n    * `--name` \u6307\u5b9acontainer\u540d\u5b57\ndocker run <image_name>:<tag> <cmd>                 \u8fd0\u884c\u6307\u5b9a\u955c\u50cf\u542f\u52a8\u5bb9\u5668, \u5e76\u6267\u884c\u4e00\u6761\u6307\u4ee4\ndocker run image_name apt-get install -y app_name \u8fd0\u884c\u955c\u50cf, \u5728\u5bb9\u5668\u4e2d\u5b89\u88c5\u65b0\u7684\u7a0b\u5e8f, \u5b8c\u6210\u540e\u9000\u51fa\n                                                    * -y : \u4e0d\u8981\u8fdb\u5165\u4ea4\u4e92\u6a21\u5f0f\ndocker exec -itd <container_name/id> <cmd>        \u8fdb\u5165\u5bb9\u5668, \u6267\u884c\u547d\u4ee4\u540e\u9000\u51fa\n                                                        * -d : \u540e\u53f0\u8fd0\u884c, \u53bb\u6389\u540e, cmd\u6267\u884c\u5b8c\u6210\u540e\u4f1a\u5446\u5728container\u5185\u90e8\ndocker run -it --rm <image_name>:<tag> bash         \u8fd0\u884c\u5e76\u8fdb\u5165\u6307\u5b9a\u5bb9\u5668\u5185\u90e8, \u6253\u5f00bash\n                                                        * -i\uff1a\u4ea4\u4e92\u5f0f\u64cd\u4f5c\n                                                        * -t \u7ec8\u7aef\n                                                        * --rm\uff1a\u5bb9\u5668\u9000\u51fa\u540e\u968f\u4e4b\u5c06\u5176\u5220\u9664\ndocker exec -it webserver bash                      \u8fdb\u5165\u67d0\u4e2a\u5bb9\u5668\u5185, \u5e76\u6267\u884c\u4e00\u6761\u547d\u4ee4, \u4ee5`exit` \u9000\u51fa\n                                                        * \u4e0d\u63a8\u8350 docker attach <xxx>, exit\u9000\u51fa, container\u4e5f\u968f\u4e4b\u7ec8\u6b62\n\ndocker cp <container_name/id>:<container_path> <host_path>      \u590d\u5236\u6587\u4ef6, \u4ececontainer\u5230\u672c\u673a\n\n\n\n\n# docker container\n\ndocker container ls \u6216 docker ps                    \u8fd0\u884c\u7740\u7684\u5bb9\u5668\n                                                        * -q : \u53ea\u8fd4\u56de\u5bb9\u5668id\ndocker container start <stoped_container>           \u542f\u52a8\u7ec8\u6b62\u72b6\u6001\u7684\u5bb9\u5668\ndocker container restart <xxx>                      \u91cd\u542f\ndocker-compose restart <service_name>               \u5fc5\u987b\u5728\u4e0a\u4e0b\u6587\u76ee\u5f55, \u662fservice name, \u800c\u975econtainer_name\n\ndocker stop <xxx>                                   \u505c\u6b62\u5bb9\u5668\ndocker container stop <xxx>\ndocker start/restart <xxx>                          \u542f\u52a8\ndocker kill $(docker ps -a -q)                      \u505c\u6b62\u6240\u6709\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\ndocker rm <xxx>                               \u5220\u9664\u5bb9\u5668\ndocker rm -fv <\u5bb9\u5668ID>               \u505c\u6b62\u3001\u5220\u9664\u5bb9\u5668\uff0c\u5e76\u6e05\u9664\u6570\u636e \ndocker container rm <xxx>\ndocker container prune                              \u5220\u9664\u6240\u6709\u7684\u505c\u6b62\u7684\u5bb9\u5668\n\n\n# docker inspect \u5bb9\u5668\u8be6\u7ec6\u4fe1\u606f(json\u683c\u5f0f)\n\ndocker inspect <container>                                              \u5bb9\u5668\u8be6\u7ec6\u4fe1\u606f(json\u683c\u5f0f, \u5927\u91cf\u4fe1\u606f \u5305\u62ecip)\ndocker inspect -f=\'{{.Name}}\' $(sudo docker ps -a -q)                   \u67e5\u770b\u6240\u6709\u5bb9\u5668name (\u53ef\u4ee5\u4e0d\u5e26\u7b49\u53f7)\ndocker inspect --format \'{{ .NetworkSettings.IPAddress }}\'  <container> \u83b7\u53d6\u6307\u5b9a\u5bb9\u5668ip\n                                                                            * \u7528 $(sudo docker ps -a -q) \u66ff\u6362<container> \u83b7\u53d6\u6240\u6709container\u7684ip\ndocker inspect <id,container_name> | grep "IPAddress"                   \u67e5\u770bip\n\n\n\n# docker commit \u63d0\u4ea4 docker history \u63d0\u4ea4\u5386\u53f2\n\n\ndocker commit \\                                                 # \u63d0\u4ea4\u4fee\u6539\u540e\u7684\u5bb9\u5668\u5f62\u6210\u65b0\u7684\u955c\u50cf\n        --author "Tao Wang <twang2218@gmail.com>" \\ # \u4fee\u6539\u4eba\n        --message "\u4fee\u6539\u4e86\u9ed8\u8ba4\u7f51\u9875" \\ # \u4fee\u6539\u8bf4\u660e\n        webserver \\ # \u4fee\u6539\u7684container\n        nginx:v2 # \u4ed3\u5e93\u540d:\u6807\u7b7e\u540d\n        \ndocker history nginx:v2                 \u67e5\u770b\u6307\u5b9a\u955c\u50cf\u7684\u5386\u53f2\u63d0\u4ea4\u8bb0\u5f55\n\ndocker rename <old\u5bb9\u5668\u540d>  <new\u5bb9\u5668\u540d> \u4fee\u6539\u5bb9\u5668\u540d\u79f0\n\n\n\n# docker log \u67e5\u770b\u65e5\u5fd7\n\ndocker logs <xxx>\ndocker container logs <xxx>            #  \u67e5\u770b\u6307\u5b9acontainer\u7684\u65e5\u5fd7(\u5168\u90e8)\ndocker logs -f -t --since="2017-05-31" --tail=10 <container>   # \u8ffd\u8e2a\u65e5\u5fd7\u6587\u4ef6\n    #* -f : \u67e5\u770b\u5b9e\u65f6\u65e5\u5fd7\n    #* -t : \u5e26\u4e0a\u65f6\u95f4\u6233\n    #* --since : \u6b64\u53c2\u6570\u6307\u5b9a\u4e86\u8f93\u51fa\u65e5\u5fd7\u5f00\u59cb\u65e5\u671f\n    #* --tail=10 : \u540e10\u884c\n\n\n\n# \u7f51\u7edc\u76f8\u5173\u547d\u4ee4\n\ndocker network create -d <network-type> --subnet=172.18.0.0/16 <my-network> # \u521b\u5efa\u7f51\u7edc\n    * -d \u7f51\u7edc\u7c7b\u578b, \u9ed8\u8ba4 bridge\n    * --subnet \u6307\u5b9a\u7f51\u6bb5\ndocker network rm my-net # \u5220\u9664\ndocker network connect my-net my-nginx # \u8fd0\u884c\u7740\u7684 container \u52a0\u5165\u7f51\u7edc\ndocker network disconnect my-net my-nginx # \u65ad\u5f00\u7f51\u7edc\n\ndocker run -itd --name <test1> --network bridge --ip 172.17.0.10 <centos:latest> </bin/bash >\n    * \u7528 --network \u53c2\u6570\uff0c\u53ef\u4ee5\u6307\u5b9a\u7f51\u7edc\u7c7b\u578b\n    * --ip 172.17.0.10\u6307\u5b9aip\n\n')),(0,r.kt)("h1",{id:"\u5f00\u542f\u8fdc\u7a0b\u8fde\u63a5"},"\u5f00\u542f\u8fdc\u7a0b\u8fde\u63a5"),(0,r.kt)("p",null,"\u7528\u4e8e\u5f00\u53d1\u73af\u5883, \u4e0d\u5b89\u5168"),(0,r.kt)("p",null,"\u539f\u751f docker: ",(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/yjt520557/article/details/99715097"},"https://blog.csdn.net/yjt520557/article/details/99715097")," \u6216\u8005 ",(0,r.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/weiyiming007/p/10168733.html"},"https://www.cnblogs.com/weiyiming007/p/10168733.html")),(0,r.kt)("p",null,"wsl \u4e0b\u7684 docker: ",(0,r.kt)("a",{parentName:"p",href:"https://www.jianshu.com/p/c7bc8fa1ee5f"},"https://www.jianshu.com/p/c7bc8fa1ee5f")," \u4fee\u6539 ",(0,r.kt)("inlineCode",{parentName:"p"},"/lib/systemd/system/docker.service")),(0,r.kt)("h1",{id:"shipyard-ui\u7ba1\u7406\u754c\u9762"},"shipyard ui\u7ba1\u7406\u754c\u9762"),(0,r.kt)("p",null,"web \u7ba1\u7406\u63a7\u5236\u53f0, \u7ba1\u7406\u5bb9\u5668, \u9ed8\u8ba4\u7528\u6237\u540d\u5bc6\u7801 admin/shipyard"),(0,r.kt)("p",null,"\u540c\u7c7b: docker-ui"),(0,r.kt)("h1",{id:"\u4ecb\u7ecd"},"\u4ecb\u7ecd"),(0,r.kt)("h2",{id:"\u57fa\u672c\u67b6\u6784"},"\u57fa\u672c\u67b6\u6784"),(0,r.kt)("p",null,"docker client\u548cdocker server: docker\u662fc/s\u67b6\u6784, client\u548cserver\u53ef\u4ee5\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e5f\u53ef\u4ee5\u4e0d\u518d\u540c\u4e00\u53f0\u673a\u5668"),(0,r.kt)("p",null,"Repository: \u5177\u4f53\u67d0\u4e2a\u955c\u50cf\u7684\u4ed3\u5e93, \u53ea\u5b58\u50a8\u67d0\u4e00\u4e2a\u9879\u76ee\u7684\u955c\u50cf(\u6bd4\u5982Tomcat\u4e0b\u9762\u6709\u5f88\u591a\u4e2a\u7248\u672c(\u7528tag\u8868\u793a)\u7684\u955c\u50cf\uff0c\u5b83\u4eec\u5171\u540c\u7ec4\u6210\u4e86Tomcat\u7684Repository\u3002)"),(0,r.kt)("p",null,"Registry: \u6240\u6709\u7684\u955c\u50cf, \u5b98\u65b9\u4e3aDocker Hub, \u4e5f\u53ef\u4ee5\u90e8\u7f72\u79c1\u6709registry(Registry\u4e0a\u6709\u5f88\u591a\u7684Repository\uff0cRedis\u3001Tomcat\u3001MySQL\u7b49\u7b49Repository\u7ec4\u6210\u4e86Registry\u3002)"),(0,r.kt)("h2",{id:"\u4f7f\u7528\u573a\u666f-\u5f97\u5230\u4ec0\u4e48\u597d\u5904"},"\u4f7f\u7528\u573a\u666f-\u5f97\u5230\u4ec0\u4e48\u597d\u5904"),(0,r.kt)("p",null,"\u4f20\u7edf\u865a\u62df\u673a\u5728\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u5148\u865a\u62df\u51fa\u4e00\u5957\u786c\u4ef6, \u786c\u4ef6\u4e0a\u518d\u8fd0\u884c\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5728\u8be5\u7cfb\u7edf\u4e0a\u518d\u8fd0\u884c\u6240\u9700\u5e94\u7528\u8fdb\u7a0b\uff1b"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u800c docker \u5bb9\u5668\u5185\u7684\u5e94\u7528\u8fdb\u7a0b\u76f4\u63a5\u8fd0\u884c\u4e8e\u5bbf\u4e3b\u7684\u5185\u6838\uff0c\u5bb9\u5668\u5185\u6ca1\u6709\u81ea\u5df1\u7684\u5185\u6838\uff0c\u800c\u4e14\u4e5f\u6ca1\u6709\u8fdb\u884c\u786c\u4ef6\u865a\u62df\u3002\u56e0\u6b64\u5bb9\u5668\u8981\u6bd4\u4f20\u7edf\u865a\u62df\u673a\u66f4\u4e3a\u8f7b\u4fbf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Docker\u7ed9\u5e94\u7528\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4ece\u5f00\u53d1\u5230\u4e0a\u7ebf  ",(0,r.kt)("inlineCode",{parentName:"p"},"\u7edf\u4e00\u7684\u73af\u5883"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0e\u6570\u636e\u5e93\u7a0b\u5e8f\u672c\u8eab\u5206\u79bb\u5f00\uff1a\u7528\u4e00\u4e2acontainer A\u4f5c\u4e3a\u6570\u636e\u5b58\u50a8\uff0c\u7136\u540e\u53e6\u4e00\u4e2acontainer B\u8fd0\u884c\u6570\u636e\u5e93\u3002\u5f53\u4f60\u60f3\u5347\u7ea7\u6570\u636e\u5e93\u65f6\uff0c\u7528\u65b0\u7684container C\u66ff\u6362\u6389container B\u5373\u53ef . ",(0,r.kt)("inlineCode",{parentName:"p"},"\u65b9\u4fbf\u7684\u8fc1\u79fb\u5e94\u7528"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4f7f\u7528docker build\u5b8c\u6210\u5355\u5143\u6d4b\u8bd5(\u521b\u5efa\u9694\u79bb\u7684\u73af\u5883\u8fdb\u884c\u6d4b\u8bd5, \u5982\u7528jenkins ci\u8fd9\u6837\u7684ci\u5de5\u5177\u542f\u52a8\u4e00\u4e2a\u7528\u4e8e\u6d4b\u8bd5\u7684container)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5c24\u5176\u9002\u5408\u5fae\u670d\u52a1"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u540e\u7aef\u5e94\u7528\u662f\u5fae\u670d\u52a1\u5316\u7684\uff0c\u6709\u5f88\u591a\u4e2a\u72ec\u7acb\u7684 java \u5e94\u7528\uff0c\u5f00\u53d1\u3001\u6d4b\u8bd5\u548c\u7ebf\u4e0a\u591a\u5957\u73af\u5883\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"docker \u4e4b\u524d\u7684\u90e8\u7f72\u65b9\u6848: \u6253 war \u5305\uff0c\u4e0a\u4f20\u5230 ecs\uff0c\u91cd\u542ftomcat; docker \u90e8\u7f72\u65b9\u6848\uff1a\u7f16\u8bd1\u673a\u5668\u4e0a\u7f16\u8bd1 jar \u5305\uff0c\u6253\u51fa docker-img\uff08\u628ajar\u5305\u653e\u8fdb\u53bb\uff09, push \u5230 docker registry\uff0c\u7ebf\u4e0a\u673a\u5668pull docker-img, \u7136\u540e docker stop\uff0c docker run\u3002"))))),(0,r.kt)("h2",{id:"\u5bb9\u5668\u5b9e\u73b0\u7684\u539f\u7406"},"\u5bb9\u5668\u5b9e\u73b0\u7684\u539f\u7406"),(0,r.kt)("p",null,"\u5bb9\u5668: \u662f\u4e00\u4e2a \u89c6\u56fe\u9694\u79bb, \u8d44\u6e90\u53ef\u9650\u5236, \u72ec\u7acb\u6587\u4ef6\u7cfb\u7edf\u7684\u8fdb\u7a0b\u96c6\u5408"),(0,r.kt)("p",null,"Linux \u63d0\u4f9b\u4e09\u5927\u6280\u672f"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"namespace \u5b9e\u73b0\u8d44\u6e90\u89c6\u56fe\u9694\u79bb, \u5982\u72ec\u7acb\u7684\u4e3b\u673a\u540d, \u53ef\u4ee5\u9650\u5236\u53ea\u80fd\u770b\u5230\u90e8\u5206\u5176\u4ed6\u8fdb\u7a0b"),(0,r.kt)("li",{parentName:"ul"},"cgroup \u63a7\u5236\u8d44\u6e90\u4f7f\u7528\u7387, \u5982\u53ef\u63a7\u5236cpu, \u5185\u5b58\u4f7f\u7528\u7387"),(0,r.kt)("li",{parentName:"ul"},"chroot \u521b\u5efa\u72ec\u7acb\u7684\u6587\u4ef6\u7cfb\u7edf , \u5982\u5427\u67d0\u4e2a\u76ee\u5f55\u8bbe\u7f6e\u4e3a\u5b50\u7cfb\u7edf\u7684\u6839\u76ee\u5f55")),(0,r.kt)("h1",{id:"\u5b89\u88c5"},"\u5b89\u88c5"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.runoob.com/docker/ubuntu-docker-install.html"},"https://www.runoob.com/docker/ubuntu-docker-install.html")),(0,r.kt)("p",null,"\u5b89\u88c5docker\u524d\u68c0\u67e5\u73af\u5883\u662f\u5426\u5339\u914d:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"uname -a")," \u67e5\u770b\u5185\u6838\u7248\u672c"),(0,r.kt)("li",{parentName:"ul"},"\u5347\u7ea7\u5185\u6838\u7248\u672c: \u5148\u901a\u8fc7",(0,r.kt)("inlineCode",{parentName:"li"},"sudo apt-get update")," \u66f4\u65b0atp-get, \u7136\u540e\u901a\u8fc7",(0,r.kt)("inlineCode",{parentName:"li"},"sudo atp-get install <\u6307\u5b9alinux\u5185\u6838>"),"\u5b89\u88c5, \u6700\u540e\u901a\u8fc7",(0,r.kt)("inlineCode",{parentName:"li"},"sudo update-grub"),"\u52a0\u8f7d\u65b0\u5185\u6838. \u8fd8\u9700\u8981\u91cd\u542f",(0,r.kt)("inlineCode",{parentName:"li"},"sudo reboot")),(0,r.kt)("li",{parentName:"ul"},"\u68c0\u67e5\u662f\u5426\u4ee5device mapper\u4f5c\u4e3a\u5b58\u50a8\u9a71\u52a8 ",(0,r.kt)("inlineCode",{parentName:"li"},"grep device-mapper /proc/devices"))),(0,r.kt)("p",null,"\u5b89\u88c5\u53c2\u8003: ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/install/centos/#install-using-the-convenience-script"},"https://docs.docker.com/engine/install/centos/#install-using-the-convenience-script")),(0,r.kt)("p",null,"\u6700\u7b80\u5355\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"curl -fsSL https://get.docker.com -o get-docker.sh && sudo sh get-docker.sh")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"sudo systemctl enable docker\nsudo systemctl start docker\ndocker run hello-world\n\n")),(0,r.kt)("h2",{id:"\u4f7f\u7528\u56fd\u5185\u955c\u50cf"},"\u4f7f\u7528\u56fd\u5185\u955c\u50cf"),(0,r.kt)("p",null,"ailiyun\u52a0\u901f",(0,r.kt)("a",{parentName:"p",href:"https://7lwsinal.mirror.aliyuncs.com"},"https://7lwsinal.mirror.aliyuncs.com")),(0,r.kt)("p",null,"\u4e34\u65f6\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker run hello-world --registry-mirror=https://docker.mirrors.ustc.edu.cn")),(0,r.kt)("p",null,"\u6301\u4e45\u4f7f\u7528, \u4fee\u6539 or \u65b0\u589e ",(0,r.kt)("inlineCode",{parentName:"p"},"vim /etc/docker/daemon.json"),", "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{ \n\n"registry-mirrors": ["https://docker.mirrors.ustc.edu.cn"] \n\n}\n\n\n{\n  "registry-mirrors": [\n    "https://registry.docker-cn.com",\n    "http://hub-mirror.c.163.com",\n    "https://docker.mirrors.ustc.edu.cn"\n  ]\n}\n\nsystemctl daemon-reload\nsystemctl restart docker\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/nihaorz/p/12131873.html"},"https://www.cnblogs.com/nihaorz/p/12131873.html")),(0,r.kt)("h1",{id:"\u955c\u50cf-image"},"\u955c\u50cf image"),(0,r.kt)("p",null,"\u53ef\u4ee5\u901a\u8fc7Dockerfile\u6784\u5efaimage\uff0c\u4e5f\u53ef\u4ee5\u5c06image\u8fd0\u884c\uff0c\u4f7f\u5176\u53d8\u6210container"),(0,r.kt)("h2",{id:"\u955c\u50cf\u5b9e\u73b0\u539f\u7406"},"\u955c\u50cf\u5b9e\u73b0\u539f\u7406"),(0,r.kt)("p",null,"docker \u955c\u50cf\u90fd\u662f\u5c42\u5c42\u53e0\u52a0\uff0c\u6bcf\u4e00\u5c42\u90fd\u53ef\u80fd\u88ab\u4e0d\u540c\u7684\u955c\u50cf\u5171\u4eab (\u5728Dockerfile\u4e2d\u6bcf\u4e00\u6b65\u90fd\u4f1a\u4ea7\u751f\u4e00\u5c42layer\uff0c\u6bcf\u4e00\u6b65\u7684\u7ed3\u679c\u4ea7\u51fa\u53d8\u6210\u6587\u4ef6)"),(0,r.kt)("p",null,"Docker \u4f7f\u7528 Union FS \u5c06\u8fd9\u4e9b\u4e0d\u540c\u7684\u5c42\u7ed3\u5408\u5230\u4e00\u4e2a\u955c\u50cf\u4e2d\u53bb\u3002"),(0,r.kt)("p",null,"\u901a\u5e38 Union FS \u6709\u4e24\u4e2a\u7528\u9014, \u4e00\u65b9\u9762\u53ef\u4ee5\u5b9e\u73b0\u4e0d\u501f\u52a9 LVM\u3001RAID \u5c06\u591a\u4e2a disk \u6302\u5230\u540c\u4e00\u4e2a\u76ee\u5f55\u4e0b,\u53e6\u4e00\u4e2a\u66f4\u5e38\u7528\u7684\u5c31\u662f\u5c06\u4e00\u4e2a\u53ea\u8bfb\u7684\u5206\u652f\u548c\u4e00\u4e2a\u53ef\u5199\u7684\u5206\u652f\u8054\u5408\u5728\u4e00\u8d77\uff0cLive CD \u6b63\u662f\u57fa\u4e8e\u6b64\u65b9\u6cd5\u53ef\u4ee5\u5141\u8bb8\u5728\u955c\u50cf\u4e0d\u53d8\u7684\u57fa\u7840\u4e0a\u5141\u8bb8\u7528\u6237\u5728\u5176\u4e0a\u8fdb\u884c\u4e00\u4e9b\u5199\u64cd\u4f5c\u3002"),(0,r.kt)("h2",{id:"\u83b7\u53d6\u955c\u50cf"},"\u83b7\u53d6\u955c\u50cf"),(0,r.kt)("p",null,"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker pull --help")," \u67e5\u8be2\u53ef\u77e5\u683c\u5f0f\u4e3a:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker pull [\u9009\u9879] [Docker Registry\u5730\u5740 [:\u7aef\u53e3\u53f7] / ] \u4ed3\u5e93\u540d[:\u6807\u7b7e]")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Docker \u955c\u50cf\u4ed3\u5e93\u5730\u5740\u7684\u683c\u5f0f\u4e00\u822c\u662f <\u57df\u540d/IP>","[:\u7aef\u53e3\u53f7]","\u3002\u9ed8\u8ba4\u5730\u5740\u662f Docker Hub\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4ed3\u5e93\u540d\uff1a\u5982\u4e4b\u524d\u6240\u8bf4\uff0c\u8fd9\u91cc\u7684\u4ed3\u5e93\u540d\u662f\u4e24\u6bb5\u5f0f\u540d\u79f0\uff0c\u5373 <\u7528\u6237\u540d>/<\u8f6f\u4ef6\u540d>\u3002\u5bf9\u4e8e Docker Hub\uff0c\u5982\u679c\u4e0d\u7ed9\u51fa\u7528\u6237\u540d\uff0c\u5219\u9ed8\u8ba4\u4e3a library\uff0c\u4e5f\u5c31\u662f\u5b98\u65b9\u955c\u50cf\u3002"))),(0,r.kt)("p",null,"\u4f8b\u5982: "),(0,r.kt)("p",null,"docker pull ubuntu:16.04"),(0,r.kt)("p",null,"\u4e0a\u9762\u7684\u547d\u4ee4\u4e2d\u6ca1\u6709\u7ed9\u51fa Docker \u955c\u50cf\u4ed3\u5e93\u5730\u5740\uff0c\u56e0\u6b64\u5c06\u4f1a\u4ece Docker Hub \u83b7\u53d6\u955c\u50cf\u3002\u800c\u955c\u50cf\u540d\u79f0\u662f ubuntu:16.04\uff0c\u56e0\u6b64\u5c06\u4f1a\u83b7\u53d6\u5b98\u65b9\u955c\u50cf library/ubuntu \u4ed3\u5e93\u4e2d\u6807\u7b7e\u4e3a 16.04 \u7684\u955c\u50cf\u3002"),(0,r.kt)("p",null,"\u4ece\u4e0b\u8f7d\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u4e4b\u524d\u63d0\u53ca\u7684\u5206\u5c42\u5b58\u50a8\u7684\u6982\u5ff5\uff0c\u955c\u50cf\u662f\u7531\u591a\u5c42\u5b58\u50a8\u6240\u6784\u6210\u3002\u4e0b\u8f7d\u4e5f\u662f\u4e00\u5c42\u5c42\u7684\u53bb\u4e0b\u8f7d\uff0c\u5e76\u975e\u5355\u4e00\u6587\u4ef6\u3002\u4e0b\u8f7d\u8fc7\u7a0b\u4e2d\u7ed9\u51fa\u4e86\u6bcf\u4e00\u5c42\u7684 ID \u7684\u524d 12 \u4f4d\u3002\u5e76\u4e14\u4e0b\u8f7d\u7ed3\u675f\u540e\uff0c\u7ed9\u51fa\u8be5\u955c\u50cf\u5b8c\u6574\u7684 sha256 \u7684\u6458\u8981\uff0c\u4ee5\u786e\u4fdd\u4e0b\u8f7d\u4e00\u81f4\u6027"),(0,r.kt)("h2",{id:"\u8fd0\u884c\u955c\u50cf"},"\u8fd0\u884c\u955c\u50cf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u4ee5\u4e0a\u9762\u7684 ubuntu:16.04 \u4e3a\u4f8b\uff0c\u5982\u679c\u6211\u4eec\u6253\u7b97\u542f\u52a8\u91cc\u9762\u7684 bash \u5e76\u4e14\u8fdb\u884c\u4ea4\u4e92\u5f0f\u64cd\u4f5c\u7684\u8bdd\uff0c\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\n$ docker run -it --rm \\\n    ubuntu:16.04 \\\n    bash\n")),(0,r.kt)("h2",{id:"\u5217\u51fa\u955c\u50cf"},"\u5217\u51fa\u955c\u50cf"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"docker image ls [xxx:xxx]")," \u5217\u51fa\u6240\u6709/\u6307\u5b9a\u4e0b\u8f7d\u7684\u9876\u5c42\u955c\u50cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"docker image ls -a")," \u5217\u51fa\u6240\u6709\u5305\u62ec\u4e2d\u95f4\u5c42\u955c\u50cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"docker images")," \u4e5f\u53ef\u67e5\u770b"))),(0,r.kt)("h2",{id:"\u5220\u9664\u672c\u5730\u955c\u50cf"},"\u5220\u9664\u672c\u5730\u955c\u50cf"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker image rm [\u9009\u9879] <\u955c\u50cf1> [<\u955c\u50cf2> ...]")),(0,r.kt)("h1",{id:"\u5236\u4f5c\u955c\u50cf\u7684\u65b9\u6cd5"},"\u5236\u4f5c\u955c\u50cf\u7684\u65b9\u6cd5"),(0,r.kt)("h2",{id:"\u6700\u4f73\u5b9e\u8df5-\u4f18\u5316\u4f53\u79ef"},"\u6700\u4f73\u5b9e\u8df5 \u4f18\u5316\u4f53\u79ef"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.infoq.cn/article/3-simple-tricks-for-smaller-docker-images"},"https://www.infoq.cn/article/3-simple-tricks-for-smaller-docker-images"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://segmentfault.com/a/1190000017858358"},"https://segmentfault.com/a/1190000017858358"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/"},"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://fuckcloudnative.io/posts/docker-images-part1-reducing-image-size/"},"https://fuckcloudnative.io/posts/docker-images-part1-reducing-image-size/"),"\nTODO"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dockerfile"},'# \u7f16\u8bd1\nFROM node:latest AS builder\nmaintainer xiaoyu <775000738@qq.com>\nWORKDIR /usr/src/app\n# \nCOPY package.json yarn.lock ./\nRUN yarn\n# \u590d\u5236\u5f53\u524d\u8def\u5f84(\u901a\u8fc7 docker build -t xxx . \u8fd9\u4e2a \u70b9 \u6307\u5b9a)\u4e0b\u6240\u6709\u6587\u4ef6\u5230 \u76ee\u5f55 ${workdir}\nCOPY . ./\nRUN yarn build\n\n# \u5b9e\u9645\u955c\u50cf\nFROM nginx\nCOPY --from=builder /usr/src/app/dist /usr/share/nginx/html\nCOPY nginx.conf /etc/nginx/conf.d/default.conf\nCMD ["nginx", "-g", "daemon off;"]\n\n\n\n')),(0,r.kt)("h2",{id:"\u901a\u8fc7-dockerfile-\u6765-build-\u955c\u50cf"},"\u901a\u8fc7 dockerfile \u6765 build \u955c\u50cf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker build -f MyDockerfile -t xiaoyureed/myImage:v1 .\n\n# \u7b80\u5199\n# \u52a0\u5165\u5f53\u524d\u5c31\u5728 dockerfile \u6240\u5728\u76ee\u5f55\ndocker build -t imgName .\n")),(0,r.kt)("h2",{id:"commit\u5bb9\u5668\u6210\u4e3a\u955c\u50cf-\u4e0d\u63a8\u8350"},"commit\u5bb9\u5668\u6210\u4e3a\u955c\u50cf-\u4e0d\u63a8\u8350"),(0,r.kt)("p",null,"\u5c06\u81ea\u5b9a\u4e49\u7684\u5bb9\u5668\u4fdd\u5b58\u4e3a\u955c\u50cf, \u4e00\u822c\u4e0d\u7528commit\u5236\u4f5c\u955c\u50cf, \u56e0\u4e3a\u4f1a\u6709\u5927\u91cf\u7684\u65e0\u5173\u5185\u5bb9\u88ab\u6dfb\u52a0\u8fdb\u6765\uff0c\u5982\u679c\u4e0d\u5c0f\u5fc3\u5730\u6e05\u7406\uff0c\u5c06\u4f1a\u5bfc\u81f4\u955c\u50cf\u6781\u4e3a\u81c3\u80bf\u3002)"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker commit [\u9009\u9879] <\u5bb9\u5668ID\u6216\u5bb9\u5668\u540d> [<\u4ed3\u5e93\u540d>[:<\u6807\u7b7e>]]")),(0,r.kt)("p",null,"\u955c\u50cf\u662f\u591a\u5c42\u5b58\u50a8\uff0c\u6bcf\u4e00\u5c42\u662f\u5728\u524d\u4e00\u5c42\u7684\u57fa\u7840\u4e0a\u8fdb\u884c\u7684\u4fee\u6539\uff1b\u800c\u5bb9\u5668\u540c\u6837\u4e5f\u662f\u591a\u5c42\u5b58\u50a8\uff0c\u662f\u5728\u4ee5\u955c\u50cf\u4e3a\u57fa\u7840\u5c42\uff0c\u5728\u5176\u57fa\u7840\u4e0a\u52a0\u4e00\u5c42\u4f5c\u4e3a\u5bb9\u5668\u8fd0\u884c\u65f6\u7684\u5b58\u50a8\u5c42"),(0,r.kt)("p",null,"\u5148\u770b\u4e00\u4e2a\u4f8b\u5b50: \u5b9a\u5236\u4e00\u4e2a web server"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u7528 nginx \u955c\u50cf\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\uff0c\u547d\u540d\u4e3a webserver\uff0c\u5e76\u4e14\u6620\u5c04\u4e86 80 \u7aef\u53e3\uff0c\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u7528\u6d4f\u89c8\u5668\u53bb\u8bbf\u95ee\u8fd9\u4e2a nginx \u670d\u52a1\u5668\n$ docker run --name webserver -d -p 80:80 nginx\n\n# \u8fdb\u5165container\u5185\u90e8, \u6253\u5f00bash\ndocker exec -it webserver bash\n# \u7528 <h1>Hello, Docker!</h1> \u8986\u76d6\u4e86 /usr/share/nginx/html/index.html \u7684\u5185\u5bb9\necho '<h1>Hello, Docker!</h1>' > /usr/share/nginx/html/index.html\n\n")),(0,r.kt)("p",null,"\u6d4f\u89c8\u5668\u8f93\u5165\u865a\u62df\u673a\u7684ip\u5730\u5740\u5373\u53ef\u8bbf\u95ee;(",(0,r.kt)("inlineCode",{parentName:"p"},"docker-machine env"),"\u53ef\u4ee5\u67e5\u770b\u865a\u62df\u673aip)"),(0,r.kt)("p",null,"\u73b0\u5728\u5e0c\u671bcommit\u8fd9\u4e2a\u65b0\u7684\u955c\u50cf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'# \u5148\u9000\u51facontainer\nexit\n\n# \u770b\u4e0b\u56fe\ndocker commit --author "xy<775000738@qq.com>" --message "\u4fee\u6539 index.html" webserver nginx:v2\n\n# \u542f\u52a8\u7b2c\u4e8c\u4e2acontainer, \u6d4f\u89c8\u5668\u8bbf\u95ee81\u7aef\u53e3;\n# \u81f3\u6b64, \u624b\u52a8\u64cd\u4f5c\u7ed9\u65e7\u7684\u955c\u50cf\u6dfb\u52a0\u4e86\u65b0\u7684\u4e00\u5c42\uff0c\u5f62\u6210\u65b0\u7684\u955c\u50cf\ndocker run --name test_1 -d -p 81:80 nginx:v2\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker history nginx:v2")," \u67e5\u770b\u67d0\u4e2aRepository\u7684\u5386\u53f2\u63d0\u4ea4\u8bb0\u5f55"),(0,r.kt)("h2",{id:"\u4ece\u538b\u7f29\u5305\u5bfc\u5165"},"\u4ece\u538b\u7f29\u5305\u5bfc\u5165"),(0,r.kt)("p",null,"\u683c\u5f0f\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"docker import [\u9009\u9879] <\u6587\u4ef6>|<URL>|- [<\u4ed3\u5e93\u540d>[:<\u6807\u7b7e>]]")),(0,r.kt)("p",null,"eg:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u8fd9\u6761\u547d\u4ee4\u81ea\u52a8\u4e0b\u8f7d\u4e86 ubuntu-14.04-x86_64-minimal.tar.gz \u6587\u4ef6\uff0c\u5e76\u4e14\u4f5c\u4e3a\u6839\u6587\u4ef6\u7cfb\u7edf\u5c55\u5f00\u5bfc\u5165\uff0c\u5e76\u4fdd\u5b58\u4e3a\u955c\u50cf openvz/ubuntu:14.04\n$ docker import \\\n    http://download.openvz.org/template/precreated/ubuntu-14.04-x86_64-minimal.tar.gz \\\n    openvz/ubuntu:14.04\n")),(0,r.kt)("h2",{id:"docker-save-\u548c-docker-load"},"docker save \u548c docker load"),(0,r.kt)("p",null,"Docker \u8fd8\u63d0\u4f9b\u4e86 docker load \u548c docker save \u547d\u4ee4\uff0c\u7528\u4ee5\u5c06\u955c\u50cf\u4fdd\u5b58\u4e3a\u4e00\u4e2a tar \u6587\u4ef6\uff0c\u7136\u540e\u4f20\u8f93\u5230\u53e6\u4e00\u4e2a\u4f4d\u7f6e\u4e0a\uff0c\u518d\u52a0\u8f7d\u8fdb\u6765\u3002\u8fd9\u662f\u5728\u6ca1\u6709 Docker Registry \u65f6\u7684\u505a\u6cd5\uff0c\u73b0\u5728\u5df2\u7ecf\u4e0d\u63a8\u8350\uff0c\u955c\u50cf\u8fc1\u79fb\u5e94\u8be5\u76f4\u63a5\u4f7f\u7528 Docker Registry\uff0c\u65e0\u8bba\u662f\u76f4\u63a5\u4f7f\u7528 Docker Hub \u8fd8\u662f\u4f7f\u7528\u5185\u7f51\u79c1\u6709 Registry "),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker save alpine | gzip > alpine-latest.tar.gz")," \u4fdd\u5b58\u4e4b\u540e\u590d\u5236\u5230\u5176\u4ed6\u673a\u5668, ",(0,r.kt)("inlineCode",{parentName:"p"},"docker load -i alpine-latest.tar.gz"),"\u52a0\u8f7d\u955c\u50cf"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker save <\u955c\u50cf\u540d> | bzip2 | pv | ssh <\u7528\u6237\u540d>@<\u4e3b\u673a\u540d> 'cat | docker load'"),"\u4ece\u4e00\u4e2a\u673a\u5668\u5c06\u955c\u50cf\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a\u673a\u5668\uff0c\u5e76\u4e14\u5e26\u8fdb\u5ea6\u6761\u7684\u529f\u80fd"),(0,r.kt)("h1",{id:"dockerfile"},"Dockerfile"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dockerfile"},'FROM node:latest AS builder\nWORKDIR /usr/src/app\nCOPY package.json yarn.lock ./\nRUN yarn\nCOPY . ./\nRUN yarn build\n\nFROM nginx\nCOPY --from=builder /usr/src/app/dist /usr/share/nginx/html\nCOPY nginx.conf /etc/nginx/conf.d/default.conf\nCMD ["nginx", "-g", "daemon off;"]\n\n')),(0,r.kt)("p",null,"\u901a\u8fc7dockerfile\u6765build\u5b9a\u5236\u955c\u50cf"),(0,r.kt)("p",null,"\u662f  \u4e00\u79cd\u6784\u5efaimage\u7684 \u6587\u4ef6DSL"),(0,r.kt)("p",null,"Dockerfile \u662f\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u5176\u5185\u5305\u542b\u4e86\u4e00\u6761\u6761\u7684\u6307\u4ee4(Instruction)\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"\u6bcf\u4e00\u6761\u6307\u4ee4\u6784\u5efa\u4e00\u5c42"),"\uff0c\u56e0\u6b64\u6bcf\u4e00\u6761\u6307\u4ee4\u7684\u5185\u5bb9\uff0c\u5c31\u662f\u63cf\u8ff0\u8be5\u5c42\u5e94\u5f53\u5982\u4f55\u6784\u5efa\u3002"),(0,r.kt)("h2",{id:"run-\u548c-from"},"run \u548c from"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ mkdir mynginx\n$ cd mynginx\n\n# Dockerfile\u7684\u5185\u5bb9\u5982\u4e0b:\n# FROM nginx\n# RUN echo '<h1>Hello, Docker!</h1>' > /usr/share/nginx/html/index.html\n$ touch Dockerfile\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'`FROM`\u6307\u4ee4: \u6307\u5b9a\u57fa\u7840\u955c\u50cf; \u4e00\u4e2a Dockerfile \u4e2d FROM \u662f\u5fc5\u5907\u7684\u6307\u4ee4\uff0c\u5e76\u4e14\u5fc5\u987b\u662f\u7b2c\u4e00\u6761\u6307\u4ee4\u3002\n\n    Docker \u8fd8\u5b58\u5728\u4e00\u4e2a\u7279\u6b8a\u7684\u955c\u50cf\uff0c\u540d\u4e3a scratch\u3002\u8fd9\u4e2a\u955c\u50cf\u662f\u865a\u62df\u7684\u6982\u5ff5\uff0c\u5e76\u4e0d\u5b9e\u9645\u5b58\u5728\uff0c\u5b83\u8868\u793a\u4e00\u4e2a\u7a7a\u767d\u7684\u955c\u50cf. \u5982\u679c\u4f60\u4ee5 scratch \u4e3a\u57fa\u7840\u955c\u50cf\u7684\u8bdd\uff0c\u610f\u5473\u7740\u4f60\u4e0d\u4ee5\u4efb\u4f55\u955c\u50cf\u4e3a\u57fa\u7840\uff0c\u63a5\u4e0b\u6765\u6240\u5199\u7684\u6307\u4ee4\u5c06\u4f5c\u4e3a\u955c\u50cf\u7b2c\u4e00\u5c42\u5f00\u59cb\u5b58\u5728\u3002\n\n    \u53ef\u4ee5 from xxx as bbb, \u540e\u9762\u53ef\u4ee5\u5f15\u7528 ${bbb}\n\n`RUN`\u6307\u4ee4: \u6267\u884c\u547d\u4ee4 (\u6bcf\u4e00\u4e2a RUN \u90fd\u662f\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668 -> \u6267\u884c\u547d\u4ee4 -> \u7136\u540e\u63d0\u4ea4\u5b58\u50a8\u5c42\u6587\u4ef6\u53d8\u66f4)\n\n    \u4e24\u79cd\u683c\u5f0f , shell \u683c\u5f0f\uff1aRUN <\u547d\u4ee4>; \u5c31\u50cf\u76f4\u63a5\u5728\u547d\u4ee4\u884c\u4e2d\u8f93\u5165\u7684\u547d\u4ee4\u4e00\u6837\n\n    # \u6240\u6709\u7684\u547d\u4ee4\u53ea\u6709\u4e00\u4e2a\u76ee\u7684\uff0c\u5c31\u662f\u7f16\u8bd1\u3001\u5b89\u88c5 redis \u53ef\u6267\u884c\u6587\u4ef6\u3002\n    FROM debian:jessie\n\n    RUN buildDeps=\'gcc libc6-dev make\' \\\n    && apt-get update \\\n    && apt-get install -y $buildDeps \\\n    && wget -O redis.tar.gz "http://download.redis.io/releases/redis-3.2.5.tar.gz" \\\n    && mkdir -p /usr/src/redis \\\n    && tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \\\n    && make -C /usr/src/redis \\\n    && make -C /usr/src/redis install \\\n    # \u5fc5\u8981\u7684\u6e05\u7406\u5de5\u4f5c, \u4fdd\u8bc1\u6bcf\u4e00\u5c42\u6ca1\u6709\u5783\u573e\n    && rm -rf /var/lib/apt/lists/* \\\n    && rm redis.tar.gz \\\n    && rm -r /usr/src/redis \\\n    && apt-get purge -y --auto-remove $buildDeps\n\n    \u8fd8\u6709\u4e00\u79cd exec \u683c\u5f0f\uff1aRUN ["\u53ef\u6267\u884c\u6587\u4ef6", "\u53c2\u65701", "\u53c2\u65702"]\uff0c\u8fd9\u66f4\u50cf\u662f\u51fd\u6570\u8c03\u7528\u4e2d\u7684\u683c\u5f0f\n\n\n')),(0,r.kt)("p",null,"\u7f16\u5199\u5b8c\u6bd5, \u53ef\u4ee5\u952e\u5165\u6784\u5efa\u547d\u4ee4: ",(0,r.kt)("inlineCode",{parentName:"p"},"docker build [\u9009\u9879] < \u4e0a\u4e0b\u6587\u8def\u5f84/URL/- >")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u5728dockerfile\u6240\u5728\u7684\u76ee\u5f55\u8fd0\u884c, -t\u8868\u793a\u6307\u5b9a\u6700\u7ec8\u955c\u50cf\u540d\u79f0, \u8fd9\u91cc\u7684[.]\u8868\u793a\u4e0a\u4e0b\u6587\u8def\u5f84\ndocker build -t nginx:v3 .\n")),(0,r.kt)("h2",{id:"\u955c\u50cf\u7684\u6784\u5efa\u4e0a\u4e0b\u6587context"},"\u955c\u50cf\u7684\u6784\u5efa\u4e0a\u4e0b\u6587context"),(0,r.kt)("p",null,"docker build \u547d\u4ee4\u6784\u5efa\u955c\u50cf\uff0c\u5176\u5b9e\u5e76\u975e\u5728\u672c\u5730\u6784\u5efa\uff0c\u800c\u662f\u5728\u670d\u52a1\u7aef\uff0c\u4e5f\u5c31\u662f Docker \u5f15\u64ce\u4e2d\u6784\u5efa\u7684\u3002\u90a3\u4e48\u5728\u8fd9\u79cd\u5ba2\u6237\u7aef/\u670d\u52a1\u7aef\u7684\u67b6\u6784\u4e2d\uff0c\u5982\u4f55\u624d\u80fd\u8ba9\u670d\u52a1\u7aef\u83b7\u5f97\u672c\u5730\u6587\u4ef6\u5462\uff1f"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker build -t nginx:v3 .")," \u8fd9\u91cc\u7684","[.]","\u4e0d\u662f\u547d\u4ee4\u5f53\u524d\u6240\u5728\u7684\u76ee\u5f55, \u800c\u662f\u6307\u5b9adocker context\u8def\u5f84, Dockerfile\u4e2d\u7684\u8def\u5f84\u90fd\u662f\u76f8\u5bf9\u4e8e\u8fd9\u4e2acontxt\u8def\u5f84\u6765\u8bf4\u7684"),(0,r.kt)("p",null,"\u4e00\u822c\u5e94\u8be5\u4f1a\u5c06 Dockerfile \u7f6e\u4e8e\u4e00\u4e2a\u7a7a\u76ee\u5f55\u4e0b\uff0c\u6216\u8005\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u3002\u5982\u679c\u8be5\u76ee\u5f55\u4e0b\u6ca1\u6709\u6240\u9700\u6587\u4ef6\uff0c\u90a3\u4e48\u5e94\u8be5\u628a\u6240\u9700\u6587\u4ef6\u590d\u5236\u4e00\u4efd\u8fc7\u6765\u3002\u5982\u679c\u76ee\u5f55\u4e0b\u6709\u4e9b\u4e1c\u897f\u786e\u5b9e\u4e0d\u5e0c\u671b\u6784\u5efa\u65f6\u4f20\u7ed9 Docker \u5f15\u64ce\uff0c\u90a3\u4e48\u53ef\u4ee5\u7528 .gitignore \u4e00\u6837\u7684\u8bed\u6cd5\u5199\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},".dockerignore"),"\uff0c\u8be5\u6587\u4ef6\u662f\u7528\u4e8e\u5254\u9664\u4e0d\u9700\u8981\u4f5c\u4e3a\u4e0a\u4e0b\u6587\u4f20\u9012\u7ed9 Docker \u5f15\u64ce\u7684\u3002"),(0,r.kt)("p",null,"\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4e0d\u989d\u5916\u6307\u5b9a Dockerfile \u7684\u8bdd\uff0c\u4f1a\u5c06\u4e0a\u4e0b\u6587\u76ee\u5f55\u4e0b\u7684\u540d\u4e3a Dockerfile \u7684\u6587\u4ef6\u4f5c\u4e3a Dockerfile;\u5b9e\u9645\u4e0a Dockerfile \u7684\u6587\u4ef6\u540d\u5e76\u4e0d\u8981\u6c42\u5fc5\u987b\u4e3a Dockerfile\uff0c\u800c\u4e14\u5e76\u4e0d\u8981\u6c42\u5fc5\u987b\u4f4d\u4e8e\u4e0a\u4e0b\u6587\u76ee\u5f55\u4e2d\uff0c\u6bd4\u5982\u53ef\u4ee5\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"-f ../Dockerfile.php")," \u53c2\u6570\u6307\u5b9a\u67d0\u4e2a\u6587\u4ef6\u4f5c\u4e3a Dockerfile\u3002"),(0,r.kt)("p",null,"docker build\u8fd8\u652f\u6301\u4ecegit repo\u4e2d\u62c9\u53d6\u6587\u4ef6\u6784\u5efa",(0,r.kt)("inlineCode",{parentName:"p"},"docker build https://github.com/twang2218/gitlab-ce-zh.git#:8.14"),"\u8fd9\u884c\u547d\u4ee4\u6307\u5b9a\u4e86\u6784\u5efa\u6240\u9700\u7684 Git repo\uff0c\u5e76\u4e14\u6307\u5b9a\u9ed8\u8ba4\u7684 master \u5206\u652f\uff0c\u6784\u5efa\u76ee\u5f55\u4e3a /8.14/\uff0c\u7136\u540e Docker \u5c31\u4f1a\u81ea\u5df1\u53bb git clone \u8fd9\u4e2a\u9879\u76ee\u3001\u5207\u6362\u5230\u6307\u5b9a\u5206\u652f\u3001\u5e76\u8fdb\u5165\u5230\u6307\u5b9a\u76ee\u5f55\u540e\u5f00\u59cb\u6784\u5efa"),(0,r.kt)("p",null,"\u8fd8\u652f\u6301",(0,r.kt)("inlineCode",{parentName:"p"},"docker build http://server/context.tar.gz"),"\u4ece\u538b\u7f29\u5305\u6784\u5efa"),(0,r.kt)("h2",{id:"copy-\u548c-add"},"COPY \u548c ADD"),(0,r.kt)("p",null,"\u590d\u5236\u6587\u4ef6"),(0,r.kt)("p",null,"\u548c RUN \u6307\u4ee4\u4e00\u6837\uff0c\u4e5f\u6709\u4e24\u79cd\u683c\u5f0f\uff0c\u4e00\u79cd\u7c7b\u4f3c\u4e8e\u547d\u4ee4\u884c\uff0c\u4e00\u79cd\u7c7b\u4f3c\u4e8e\u51fd\u6570\u8c03\u7528:"),(0,r.kt)("p",null,"COPY <\u6e90\u8def\u5f84>... <\u76ee\u6807\u8def\u5f84>"),(0,r.kt)("p",null,"COPY ",'["<\u6e90\u8def\u5f841>",... "<\u76ee\u6807\u8def\u5f84>"]'),(0,r.kt)("p",null,"<\u6e90\u8def\u5f84> \u53ef\u4ee5\u662f\u591a\u4e2a\uff0c\u751a\u81f3\u53ef\u4ee5\u662f\u901a\u914d\u7b26\uff0c\u5176\u901a\u914d\u7b26\u89c4\u5219\u8981\u6ee1\u8db3 Go \u7684 filepath.Match \u89c4\u5219; "),(0,r.kt)("p",null,"<\u76ee\u6807\u8def\u5f84> \u53ef\u4ee5\u662f\u5bb9\u5668\u5185\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u4e5f\u53ef\u4ee5\u662f\u76f8\u5bf9\u4e8e\u5de5\u4f5c\u76ee\u5f55\u7684\u76f8\u5bf9\u8def\u5f84\uff08\u5de5\u4f5c\u76ee\u5f55\u53ef\u4ee5\u7528 WORKDIR \u6307\u4ee4\u6765\u6307\u5b9a\uff09\u3002\u76ee\u6807\u8def\u5f84\u4e0d\u9700\u8981\u4e8b\u5148\u521b\u5efa\uff0c\u5982\u679c\u76ee\u5f55\u4e0d\u5b58\u5728\u4f1a\u5728\u590d\u5236\u6587\u4ef6\u524d\u5148\u884c\u521b\u5efa\u7f3a\u5931\u76ee\u5f55"),(0,r.kt)("p",null,"eg:\n",(0,r.kt)("inlineCode",{parentName:"p"},"COPY package.json /usr/src/app/"),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"COPY hom* /mydir/"),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"COPY hom?.txt /mydir/")),(0,r.kt)("p",null,"ADD \u66f4\u9ad8\u7ea7\u7684\u590d\u5236\u6587\u4ef6, \u548ccopy\u7c7b\u4f3c-------\u4f46\u662f, \u53ef\u4ee5\u81ea\u52a8\u89e3\u538b\u7f29"),(0,r.kt)("h2",{id:"workdir-\u6307\u5b9a\u5de5\u4f5c\u76ee\u5f55"},"WORKDIR \u6307\u5b9a\u5de5\u4f5c\u76ee\u5f55"),(0,r.kt)("p",null,"\u4f7f\u7528 WORKDIR \u6307\u4ee4\u53ef\u4ee5\u6765\u6307\u5b9a\u5de5\u4f5c\u76ee\u5f55\uff08\u6216\u8005\u79f0\u4e3a\u5f53\u524d\u76ee\u5f55\uff09\uff0c\u5c31\u662f\u5c06\u5f53\u524d\u6267\u884c\u547d\u4ee4\u7684\u76ee\u5f55\u5b9a\u4e49\u4e3a\u786e\u5b9a\u503c, \u4ee5\u540e\u5404\u5c42\u7684\u5f53\u524d\u76ee\u5f55\u5c31\u88ab\u6539\u4e3a\u6307\u5b9a\u7684\u76ee\u5f55"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"WORKDIR <\u5de5\u4f5c\u76ee\u5f55\u8def\u5f84>"),"\u3002(\u5982\u8be5\u76ee\u5f55\u4e0d\u5b58\u5728\uff0cWORKDIR \u4f1a\u5e2e\u4f60\u5efa\u7acb\u76ee\u5f55)"),(0,r.kt)("p",null,"\u5178\u578b\u9519\u8bef: \u5982\u4e0b, \u662f\u9519\u8bef\u7684, \u4e24\u6761run\u547d\u4ee4\u5728\u5185\u5b58\u4e0a\u5b9e\u9645\u662f\u6ca1\u6709\u8054\u7cfb\u7684"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'# \u5e0c\u671b\u5728 /app \u4e0b\u521b\u5efa\u6587\u4ef6\nRUN cd /app\nRUN echo "hello" > world.txt\n')),(0,r.kt)("p",null,"\u4fee\u6539:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'WORKDIR /app\nRUN echo "hello" > world.txt\n')),(0,r.kt)("h2",{id:"run-cmd-\u548c-entrypoint-\u5bb9\u5668\u542f\u52a8\u547d\u4ee4"},"run cmd \u548c entrypoint \u5bb9\u5668\u542f\u52a8\u547d\u4ee4"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://juejin.cn/post/6844903902807080973"},"https://juejin.cn/post/6844903902807080973")),(0,r.kt)("p",null,"\u5148\u770bcmd\u6307\u4ee4"),(0,r.kt)("p",null,"Docker \u4e0d\u662f\u865a\u62df\u673a\uff0c\u5bb9\u5668\u5c31\u662f\u8fdb\u7a0b\u3002\u65e2\u7136\u662f\u8fdb\u7a0b\uff0c\u90a3\u4e48\u5728\u542f\u52a8\u5bb9\u5668\u7684\u65f6\u5019\uff0c\u9700\u8981\u6307\u5b9a\u6240\u8fd0\u884c\u7684\u7a0b\u5e8f\u53ca\u53c2\u6570\u3002CMD \u6307\u4ee4\u5c31\u662f\u7528\u4e8e\u6307\u5b9a\u9ed8\u8ba4\u7684\u5bb9\u5668\u4e3b\u8fdb\u7a0b\u7684\u542f\u52a8\u547d\u4ee4"),(0,r.kt)("p",null,"CMD \u6307\u4ee4\u7684\u683c\u5f0f\u548c RUN \u76f8\u4f3c\uff0c\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"shell \u683c\u5f0f\uff1aCMD <\u547d\u4ee4>")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"exec \u683c\u5f0f\uff1aCMD ",'["\u53ef\u6267\u884c\u6587\u4ef6", "\u53c2\u65701", "\u53c2\u65702"...]',"-------\u63a8\u8350\u8fd9\u79cd"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u53ef\u6267\u884c\u6587\u4ef6\u4e3a\u5bb9\u5668\u7684\u4e3b\u8fdb\u7a0b, \u5b83\u7ed3\u675f\u4e86, \u5bb9\u5668\u4e5f\u5c31\u9000\u51fa\u4e86"),(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u4e00\u79cd\u4f1a\u88abdocker\u8f6c\u6362\u4e3a\u8fd9\u79cd\u65b9\u5f0f. \u5982 CMD echo $HOME \u4f1a\u8f6c\u4e3a CMD ",'[ "sh", "-c", "echo $HOME" ]'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u53c2\u6570\u5217\u8868\u683c\u5f0f\uff1aCMD ",'["\u53c2\u65701", "\u53c2\u65702"...]',"\u3002\u5728\u4f7f\u7528 ENTRYPOINT \u6307\u5b9a\u4e86\u8d77\u4f7f\u547d\u4ee4\u540e\uff0c\u7528 CMD \u6307\u5b9a\u5177\u4f53\u7684\u53c2\u6570\u3002"))),(0,r.kt)("p",null,"\u5728\u8fd0\u884c\u65f6\u53ef\u4ee5\u6307\u5b9a\u65b0\u7684\u547d\u4ee4\u6765\u66ff\u4ee3\u955c\u50cf\u8bbe\u7f6e\u4e2d\u7684\u8fd9\u4e2a\u9ed8\u8ba4\u547d\u4ee4\uff0c\u6bd4\u5982\uff0cubuntu \u955c\u50cf\u9ed8\u8ba4\u7684 CMD \u662f /bin/bash\uff0c\u5982\u679c\u6211\u4eec\u76f4\u63a5",(0,r.kt)("inlineCode",{parentName:"p"}," docker run -it ubuntu")," \u7684\u8bdd\uff0c\u4f1a\u76f4\u63a5\u8fdb\u5165 bash\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u6307\u5b9a\u8fd0\u884c\u522b\u7684\u547d\u4ee4\uff0c\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker run -it ubuntu cat /etc/os-release"),"\u3002\u8fd9\u5c31\u662f\u7528 cat /etc/os-release \u547d\u4ee4\u66ff\u6362\u4e86\u9ed8\u8ba4\u7684 /bin/bash \u547d\u4ee4\u4e86\uff0c\u8f93\u51fa\u4e86\u7cfb\u7edf\u7248\u672c\u4fe1\u606f\u3002"),(0,r.kt)("p",null,"eg:\n",(0,r.kt)("inlineCode",{parentName:"p"},'CMD ["nginx", "-g", "daemon off;"]'),' \u76f4\u63a5\u6267\u884c nginx \u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5e76\u4e14\u8981\u6c42\u4ee5\u524d\u53f0\u5f62\u5f0f\u8fd0\u884c(CMD service nginx start\u662f\u9519\u7684, \u6b64\u65f6\u662f"sh"\u8fd9\u53ea\u7a0b\u5e8f\u4f5c\u4e3a\u4e3b\u7a0b\u5e8f, \u5b83\u8fd0\u884c\u7ed3\u675f, \u5bb9\u5668\u5c31\u9000\u51fa\u4e86)'),(0,r.kt)("p",null,"\u518d\u770b\u770bENTRYPOINT \u5165\u53e3\u70b9"),(0,r.kt)("p",null,"\u548cCMD\u6548\u679c\u7c7b\u4f3c, \u53ea\u662f\u53ef\u4ee5\u5c06\u547d\u4ee4\u884c\u4e2d\u955c\u50cf\u540d\u540e\u63a5\u7684cmd\u5f53\u4f5c\u53c2\u6570\u4f20\u7ed9Dockerfile\u4e2d\u7684enterpoint"),(0,r.kt)("p",null,"eg1: \u8ba9\u955c\u50cf\u53d8\u6210\u50cf\u547d\u4ee4\u4e00\u6837\u4f7f\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'# \u83b7\u53d6\u81ea\u5df1\u7684\u516c\u7f51ip, Dockerfile\u5982\u4e0b:\nFROM ubuntu:16.04\nRUN apt-get update \\\n    && apt-get install -y curl \\\n    && rm -rf /var/lib/apt/lists/*\nCMD [ "curl", "-s", "http://ip.cn" ]\n\n# \u6784\u5efa\u955c\u50cf \n$ docker build -t myip .\n\n# \u6d4b\u8bd5:\u67e5\u8be2ip\n$ docker run myip\n\n# \u4f46\u662f\u4e0a\u9762\u7684\u547d\u4ee4\u65e0\u6cd5\u5728\u540e\u9762\u63a5curl\u7684\u53c2\u6570, \u6bd4\u5982\u76f4\u63a5\u5728\u540e\u9762\u52a0"-i", \u4f1a\u628a\u9ed8\u8ba4\u7684cmd\u6574\u4e2a\u66ff\u6362\u800c\u51fa\u9519, \u4e0d\u5b8c\u7f8e\u7684\u89e3\u51b3\u65b9\u6cd5\u5982\u4e0b:\n$ docker run myip curl -s http://ip.cn -i\n\n## \u4e0a\u9762\u7684\u547d\u4ee4\u592a\u5570\u55e6\u4e86, \u6b63\u786e\u7684\u65b9\u6cd5\u662f\u4fee\u6539Dockerfile, \u7528ENTERYPOINT\u4ee3\u66ffCMD\nFROM ubuntu:16.04\nRUN apt-get update \\\n    && apt-get install -y curl \\\n    && rm -rf /var/lib/apt/lists/*\nENTRYPOINT [ "curl", "-s", "http://ip.cn" ]\n\n# \u73b0\u5728\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528"-i"\u53c2\u6570\u4e86\n$ docker run myip -i\n')),(0,r.kt)("p",null,"eg2: \u5e94\u7528\u8fd0\u884c\u524d\u7684\u51c6\u5907\u5de5\u4f5c(\u8fd9\u4e9b\u51c6\u5907\u5de5\u4f5c\u662f\u548c\u5bb9\u5668 CMD \u65e0\u5173\u7684\uff0c\u65e0\u8bba CMD \u4e3a\u4ec0\u4e48\uff0c\u90fd\u9700\u8981\u4e8b\u5148\u8fdb\u884c\u4e00\u4e2a\u9884\u5904\u7406\u7684\u5de5\u4f5c\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u7136\u540e\u653e\u5165 ENTRYPOINT \u4e2d\u53bb\u6267\u884c\uff0c\u800c\u8fd9\u4e2a\u811a\u672c\u4f1a\u5c06\u63a5\u5230\u7684\u53c2\u6570\uff08\u4e5f\u5c31\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"<CMD>"),"\uff09\u4f5c\u4e3a\u547d\u4ee4\uff0c\u5728\u811a\u672c\u6700\u540e\u6267\u884c)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'# \u53ef\u4ee5\u770b\u5230\u5176\u4e2d\u4e3a\u4e86 redis \u670d\u52a1\u521b\u5efa\u4e86 redis \u7528\u6237\uff0c\u5e76\u5728\u6700\u540e\u6307\u5b9a\u4e86 ENTRYPOINT \u4e3a docker-entrypoint.sh \u811a\u672c\u3002\nFROM alpine:3.4\n...\nRUN addgroup -S redis && adduser -S -G redis redis\n...\nENTRYPOINT ["docker-entrypoint.sh"]\n\nEXPOSE 6379\nCMD [ "redis-server" ]\n\n# docker-entrypoint.sh ,\u8be5\u811a\u672c\u7684\u5185\u5bb9\u5c31\u662f\u6839\u636e CMD \u7684\u5185\u5bb9\u6765\u5224\u65ad\uff0c\u5982\u679c\u662f redis-server \u7684\u8bdd\uff0c\u5219\u5207\u6362\u5230 redis \u7528\u6237\u8eab\u4efd\u542f\u52a8\u670d\u52a1\u5668\uff0c\u5426\u5219\u4f9d\u65e7\u4f7f\u7528 root \u8eab\u4efd\u6267\u884c\n\n#!/bin/sh\n...\n# allow the container to be started with `--user`\nif [ "$1" = \'redis-server\' -a "$(id -u)" = \'0\' ]; then\n    chown -R redis .\n    exec su-exec redis "$0" "$@"\nfi\n\nexec "$@"\n')),(0,r.kt)("h2",{id:"env-\u548c-arg-\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf"},"ENV \u548c arg \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf"),(0,r.kt)("p",null,"env \u5728container\u7684\u751f\u547d\u5468\u671f\u5185\u59cb\u7ec8\u6709\u6548"),(0,r.kt)("p",null,"\u5728 dockerfile \u58f0\u660e\u540e, \u540e\u9762\u7684\u6307\u4ee4\u4e2d\u53ef\u4ee5\u4f7f\u7528"),(0,r.kt)("p",null,"\u683c\u5f0f\u6709\u4e24\u79cd\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ENV <key> <value>")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ENV <key1>=<value1> <key2>=<value2>..."))),(0,r.kt)("p",null,"eg:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'# \u7b80\u5355\u4f7f\u7528\nENV VERSION=1.0 DEBUG=on \\\n    NAME="Happy Feet"\n\n# \u5b98\u65b9node\u955c\u50cf\nENV NODE_VERSION 7.2.0\n\nRUN curl -SLO "https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz" \\\n  && curl -SLO "https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc" \\\n  && gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \\\n  && grep " node-v$NODE_VERSION-linux-x64.tar.xz\\$" SHASUMS256.txt | sha256sum -c - \\\n  && tar -xJf "node-v$NODE_VERSION-linux-x64.tar.xz" -C /usr/local --strip-components=1 \\\n  && rm "node-v$NODE_VERSION-linux-x64.tar.xz" SHASUMS256.txt.asc SHASUMS256.txt \\\n  && ln -s /usr/local/bin/node /usr/local/bin/nodejs\n')),(0,r.kt)("p",null,"ARG \u6784\u5efa\u53c2\u6570, \u5b9a\u4e49\u53c2\u6570\u540d\u79f0\uff0c\u4ee5\u53ca\u5b9a\u4e49\u5176\u9ed8\u8ba4\u503c\u3002\u8be5\u9ed8\u8ba4\u503c\u53ef\u4ee5\u5728\u6784\u5efa\u547d\u4ee4 docker build \u4e2d\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"--build-arg <\u53c2\u6570\u540d>=<\u503c>")," \u6765\u8986\u76d6\u3002"),(0,r.kt)("p",null,"\u548c ENV \u7c7b\u4f3c, \u4f46\u662f ARG \u6240\u8bbe\u7f6e\u7684\u6784\u5efa\u73af\u5883\u7684\u73af\u5883\u53d8\u91cf\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"\u5728\u5c06\u6765\u5bb9\u5668\u8fd0\u884c\u65f6\u662f\u4e0d\u4f1a\u5b58\u5728\u8fd9\u4e9b\u73af\u5883\u53d8\u91cf\u7684"),". \u4f46\u662f\u4e0d\u8981\u56e0\u6b64\u5c31\u4f7f\u7528 ARG \u4fdd\u5b58\u5bc6\u7801\u4e4b\u7c7b\u7684\u4fe1\u606f\uff0c\u56e0\u4e3a docker history \u8fd8\u662f\u53ef\u4ee5\u770b\u5230\u6240\u6709\u503c\u7684\u3002"),(0,r.kt)("h2",{id:"volume-\u5b9a\u4e49\u533f\u540d\u6570\u636e\u5377"},"VOLUME \u5b9a\u4e49\u533f\u540d\u6570\u636e\u5377"),(0,r.kt)("p",null,"\u5bf9\u4e8e\u6570\u636e\u5e93\u7c7b\u9700\u8981\u4fdd\u5b58\u52a8\u6001\u6570\u636e\u7684\u5e94\u7528\uff0c\u5176\u6570\u636e\u5e93\u6587\u4ef6/\u52a8\u6001\u6570\u636e\u5e94\u8be5\u4fdd\u5b58\u4e8e\u5377(volume)\u4e2d, \u800c\u4e0d\u8981\u76f4\u63a5\u5199\u5165\u5bb9\u5668\u5b58\u50a8\u5c42"),(0,r.kt)("p",null,"\u4e3a\u4e86\u9632\u6b62\u8fd0\u884c\u65f6\u7528\u6237\u5fd8\u8bb0\u5c06\u52a8\u6001\u6587\u4ef6\u6240\u4fdd\u5b58\u76ee\u5f55\u6302\u8f7d\u4e3a\u5377\uff0c\u5728 Dockerfile \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4e8b\u5148\u6307\u5b9a\u67d0\u4e9b\u76ee\u5f55\u6302\u8f7d\u5230\u533f\u540d\u5377\uff0c\u8fd9\u6837\u5728\u8fd0\u884c\u65f6\u5982\u679c\u7528\u6237\u4e0d\u6307\u5b9a\u6302\u8f7d,\u52a8\u6001\u6570\u636e\u4f1a\u5199\u5165\u533f\u540d\u5377"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'VOLUME ["<\u8def\u5f841>", "<\u8def\u5f842>"...]')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"VOLUME <\u8def\u5f84>"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"VOLUME /data")," \u8fd9\u91cc\u7684 /data \u76ee\u5f55\u662f\u5bb9\u5668\u5185\u7684\u76ee\u5f55, \u4f1a\u5728\u8fd0\u884c\u65f6\u81ea\u52a8\u6302\u8f7d\u4e3a\u533f\u540d\u5377\uff0c\u4efb\u4f55\u5411 /data \u4e2d\u5199\u5165\u7684\u4fe1\u606f\u90fd\u4e0d\u4f1a\u8bb0\u5f55\u8fdb\u5bb9\u5668\u5b58\u50a8\u5c42\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u5bb9\u5668\u5b58\u50a8\u5c42\u7684\u65e0\u72b6\u6001\u5316\u3002\u53ef\u4ee5\u8fdb\u5165 container, \u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"ll")," \u67e5\u770b, \u4f1a\u53d1\u73b0\u5bb9\u5668\u81ea\u52a8\u521b\u5efa\u4e86\u76ee\u5f55 /data, \u5e76\u6302\u8f7d\u4e3a\u533f\u540d\u6570\u636e\u5377"),(0,r.kt)("p",null,"\u5f53\u7136\uff0c\u8fd0\u884c\u65f6\u53ef\u4ee5\u8986\u76d6\u8fd9\u4e2a\u6302\u8f7d\u8bbe\u7f6e",(0,r.kt)("inlineCode",{parentName:"p"},"docker run -d -v mydata:/data xxxx"),"\u5728\u8fd9\u884c\u547d\u4ee4\u4e2d\uff0c\u5c31\u4f7f\u7528\u4e86 mydata \u8fd9\u4e2a\u547d\u540d\u5377\u6302\u8f7d\u5230\u4e86 /data \u8fd9\u4e2a\u4f4d\u7f6e\uff0c\u66ff\u4ee3\u4e86 Dockerfile \u4e2d\u5b9a\u4e49\u7684\u533f\u540d\u5377\u7684\u6302\u8f7d\u914d\u7f6e"),(0,r.kt)("p",null,"\u4e3a\u4ec0\u4e48\u5728 dockerfile \u4e2d\u65e0\u6cd5\u4f7f\u7528 \u7c7b\u4f3c ",(0,r.kt)("inlineCode",{parentName:"p"},"docker -run -v /host_path:/container_path"),' \u7684\u6548\u679c? \u8fd9\u65f6\u51fa\u4e8e\u53ef\u79fb\u690d\u548c\u5206\u4eab\u7684\u8003\u8651, \u56e0\u4e3a\u4e0d\u662f\u6bcf\u4e2a \u5bbf\u4e3b\u673a\u90fd\u4e00\u5b9a\u6709\u8fd9\u6837\u7684 "host_path" \u7279\u5b9a\u76ee\u5f55'),(0,r.kt)("p",null,"\u533f\u540d\u6570\u636e\u5377\u7684\u6570\u636e\u5728\u5bbf\u4e3b\u673a\u54ea\u91cc\u5462? ",(0,r.kt)("inlineCode",{parentName:"p"},"docker inspect <container>")," \u53ef\u4ee5\u5728json\u7684 volumes \u503c\u770b\u5230"),(0,r.kt)("h2",{id:"expose-\u58f0\u660e\u7aef\u53e3"},"EXPOSE \u58f0\u660e\u7aef\u53e3"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"}," EXPOSE <\u7aef\u53e31> [<\u7aef\u53e32>...]"),"\u3002"),(0,r.kt)("p",null,"EXPOSE \u6307\u4ee4\u662f\u58f0\u660e\u8fd0\u884c\u65f6\u5bb9\u5668\u63d0\u4f9b\u670d\u52a1\u7684\u7aef\u53e3, \u8fd9\u53ea\u662f\u4e00\u4e2a\u58f0\u660e\uff0c\u5728\u8fd0\u884c\u65f6\u5e76\u4e0d\u4f1a\u56e0\u4e3a\u8fd9\u4e2a\u58f0\u660e\u5e94\u7528\u5c31\u4f1a\u5f00\u542f\u8fd9\u4e2a\u7aef\u53e3\u7684\u670d\u52a1"),(0,r.kt)("p",null,"\u8981\u5c06 EXPOSE \u548c\u5728\u8fd0\u884c\u65f6\u4f7f\u7528",(0,r.kt)("inlineCode",{parentName:"p"}," -p <\u5bbf\u4e3b\u7aef\u53e3>:<\u5bb9\u5668\u7aef\u53e3>")," \u533a\u5206\u5f00\u6765\u3002-p\uff0c\u662f\u6620\u5c04\u5bbf\u4e3b\u7aef\u53e3\u548c\u5bb9\u5668\u7aef\u53e3\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u5c31\u662f\u5c06\u5bb9\u5668\u7684\u5bf9\u5e94\u7aef\u53e3\u670d\u52a1\u516c\u5f00\u7ed9\u5916\u754c\u8bbf\u95ee\uff0c\u800c EXPOSE \u4ec5\u4ec5\u662f\u58f0\u660e\u5bb9\u5668\u6253\u7b97\u4f7f\u7528\u4ec0\u4e48\u7aef\u53e3\u800c\u5df2\uff0c\u5e76\u4e0d\u4f1a\u81ea\u52a8\u5728\u5bbf\u4e3b\u8fdb\u884c\u7aef\u53e3\u6620\u5c04"),(0,r.kt)("p",null,"\u90a3\u65e2\u7136\u53ea\u662f\u4e00\u4e2a\u58f0\u660e, \u5e76\u6ca1\u6709\u5b9e\u9645\u66b4\u9732\u7aef\u53e3, \u6709\u4ec0\u4e48\u7528\u5462? \u5728 Dockerfile \u4e2d\u5199\u5165\u8fd9\u6837\u7684\u58f0\u660e\u6709\u4e24\u4e2a\u597d\u5904"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u662f\u5e2e\u52a9\u955c\u50cf\u4f7f\u7528\u8005\u7406\u89e3\u8fd9\u4e2a\u955c\u50cf\u670d\u52a1\u7684\u5b88\u62a4\u7aef\u53e3\uff0c\u4ee5\u65b9\u4fbf\u914d\u7f6e\u6620\u5c04\uff1b\n"),(0,r.kt)("li",{parentName:"ul"},"\u53e6\u4e00\u4e2a\u7528\u5904\u5219\u662f\u5728\u8fd0\u884c\u65f6\u4f7f\u7528\u968f\u673a\u7aef\u53e3\u6620\u5c04\u65f6\uff0c\u4e5f\u5c31\u662f docker run -P \u65f6\uff0c\u4f1a\u81ea\u52a8\u968f\u673a\u6620\u5c04 EXPOSE \u7684\u7aef\u53e3")),(0,r.kt)("h2",{id:"user-\u6307\u5b9a\u5f53\u524d\u7528\u6237"},"USER \u6307\u5b9a\u5f53\u524d\u7528\u6237"),(0,r.kt)("p",null,"USER\u6307\u4ee4\u7528\u4e8e\u6307\u5b9a\u5bb9\u5668\u6267\u884c\u7a0b\u5e8f\u7684\u7528\u6237\u8eab\u4efd\uff0c\u9ed8\u8ba4\u662f root\u7528\u6237\u3002"),(0,r.kt)("p",null,"\u5728docker run \u4e2d\u53ef\u4ee5\u901a\u8fc7 -u \u9009\u9879\u6765\u8986\u76d6USER\u6307\u4ee4\u7684\u8bbe\u7f6e\u3002"),(0,r.kt)("p",null,"\u4e3e\u4f8b\uff1adocker run -i -t -u mysql newmysqldb /bin/bash"),(0,r.kt)("p",null,"\u663e\u793a\u7684shell\u63d0\u793a\u7b26\u662f\uff1a mysql@57cd57edba38:/$"),(0,r.kt)("p",null,"\u6ce8\u610f\uff1adocker\u5bb9\u5668\u4e2d\u7684root\u7528\u6237\u5bc6\u7801\u662f\u968f\u673a\u5206\u914d\u7684\u3002"),(0,r.kt)("p",null,"USER \u6307\u4ee4\u548c WORKDIR \u76f8\u4f3c\uff0c\u90fd\u662f\u6539\u53d8\u73af\u5883\u72b6\u6001\u5e76\u5f71\u54cd\u4ee5\u540e\u7684\u5c42\u3002WORKDIR \u662f\u6539\u53d8\u5de5\u4f5c\u76ee\u5f55\uff0cUSER \u5219\u662f\u6539\u53d8\u4e4b\u540e\u5c42\u7684\u6267\u884c RUN, CMD \u4ee5\u53ca ENTRYPOINT \u8fd9\u7c7b\u547d\u4ee4\u7684\u8eab\u4efd"),(0,r.kt)("p",null,"\u683c\u5f0f\uff1aUSER <\u7528\u6237\u540d> (\u8fd9\u4e2a\u7528\u6237\u5fc5\u987b\u662f\u4e8b\u5148\u5efa\u7acb\u597d\u7684\uff0c\u5426\u5219\u65e0\u6cd5\u5207\u6362\u3002)"),(0,r.kt)("p",null,"eg1:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'RUN groupadd -r redis && useradd -r -g redis redis\nUSER redis\nRUN [ "redis-server" ]\n')),(0,r.kt)("p",null,"eg2:\u5e0c\u671b\u4ee5\u67d0\u4e2a\u5df2\u7ecf\u5efa\u7acb\u597d\u7684\u7528\u6237\u6765\u8fd0\u884c\u67d0\u4e2a\u670d\u52a1\u8fdb\u7a0b\uff0c\u4e0d\u8981\u4f7f\u7528 su \u6216\u8005 sudo\uff0c\u8fd9\u4e9b\u90fd\u9700\u8981\u6bd4\u8f83\u9ebb\u70e6\u7684\u914d\u7f6e\uff0c\u800c\u4e14\u5728 TTY \u7f3a\u5931\u7684\u73af\u5883\u4e0b\u7ecf\u5e38\u51fa\u9519\u3002\u5efa\u8bae\u4f7f\u7528 gosu"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'# \u5efa\u7acb redis \u7528\u6237\uff0c\u5e76\u4f7f\u7528 gosu \u6362\u53e6\u4e00\u4e2a\u7528\u6237\u6267\u884c\u547d\u4ee4\nRUN groupadd -r redis && useradd -r -g redis redis\n# \u4e0b\u8f7d gosu\nRUN wget -O /usr/local/bin/gosu "https://github.com/tianon/gosu/releases/download/1.7/gosu-amd64" \\\n    && chmod +x /usr/local/bin/gosu \\\n    && gosu nobody true\n# \u8bbe\u7f6e CMD\uff0c\u5e76\u4ee5\u53e6\u5916\u7684\u7528\u6237\u6267\u884c\nCMD [ "exec", "gosu", "redis", "redis-server" ]\n')),(0,r.kt)("h2",{id:"healthcheck-\u5065\u5eb7\u68c0\u67e5"},"HEALTHCHECK \u5065\u5eb7\u68c0\u67e5"),(0,r.kt)("p",null,"HEALTHCHECK \u6307\u4ee4\u662f\u544a\u8bc9 Docker \u5e94\u8be5\u5982\u4f55\u8fdb\u884c\u5224\u65ad\u5bb9\u5668\u7684\u72b6\u6001\u662f\u5426\u6b63\u5e38(\u6765\u81ea 1.12 \u4e4b\u540e\uff0cDocker \u63d0\u4f9b\u4e86 HEALTHCHECK \u6307\u4ee4\uff0c\u901a\u8fc7\u8be5\u6307\u4ee4\u6307\u5b9a\u4e00\u884c\u547d\u4ee4\uff0c\u7528\u8fd9\u884c\u547d\u4ee4\u6765\u5224\u65ad\u5bb9\u5668\u4e3b\u8fdb\u7a0b\u7684\u670d\u52a1\u72b6\u6001\u662f\u5426\u8fd8\u6b63\u5e38\uff0c\u4ece\u800c\u6bd4\u8f83\u771f\u5b9e\u7684\u53cd\u5e94\u5bb9\u5668\u5b9e\u9645\u72b6\u6001\u3002)"),(0,r.kt)("p",null,"\u4e3a\u4ec0\u4e48\u51fa\u73b0\u5462? "),(0,r.kt)("p",null,"\u5728\u6ca1\u6709 HEALTHCHECK \u6307\u4ee4\u524d\uff0cDocker \u5f15\u64ce\u53ea\u53ef\u4ee5\u901a\u8fc7\u5bb9\u5668\u5185\u4e3b\u8fdb\u7a0b\u662f\u5426\u9000\u51fa\u6765\u5224\u65ad\u5bb9\u5668\u662f\u5426\u72b6\u6001\u5f02\u5e38\u3002\u5f88\u591a\u60c5\u51b5\u4e0b\u8fd9\u6ca1\u95ee\u9898\uff0c\u4f46\u662f\u5982\u679c\u7a0b\u5e8f\u8fdb\u5165\u6b7b\u9501\u72b6\u6001\uff0c\u6216\u8005\u6b7b\u5faa\u73af\u72b6\u6001\uff0c\u5e94\u7528\u8fdb\u7a0b\u5e76\u4e0d\u9000\u51fa\uff0c\u4f46\u662f\u8be5\u5bb9\u5668\u5df2\u7ecf\u65e0\u6cd5\u63d0\u4f9b\u670d\u52a1\u4e86\u3002\u5728 1.12 \u4ee5\u524d\uff0cDocker \u4e0d\u4f1a\u68c0\u6d4b\u5230\u5bb9\u5668\u7684\u8fd9\u79cd\u72b6\u6001\uff0c\u4ece\u800c\u4e0d\u4f1a\u91cd\u65b0\u8c03\u5ea6\uff0c\u5bfc\u81f4\u53ef\u80fd\u4f1a\u6709\u90e8\u5206\u5bb9\u5668\u5df2\u7ecf\u65e0\u6cd5\u63d0\u4f9b\u670d\u52a1\u4e86\u5374\u8fd8\u5728\u63a5\u53d7\u7528\u6237\u8bf7\u6c42"),(0,r.kt)("p",null,"\u751f\u6548\u7684\u539f\u7406: \u5f53\u5728\u4e00\u4e2a\u955c\u50cf\u6307\u5b9a\u4e86 HEALTHCHECK \u6307\u4ee4\u540e\uff0c\u7528\u5176\u542f\u52a8\u5bb9\u5668\uff0c\u521d\u59cb\u72b6\u6001\u4f1a\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"starting"),"\uff0c\u5728 HEALTHCHECK \u6307\u4ee4\u68c0\u67e5\u6210\u529f\u540e\u53d8\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"healthy"),"\uff0c\u5982\u679c\u8fde\u7eed\u4e00\u5b9a\u6b21\u6570\u5931\u8d25\uff0c\u5219\u4f1a\u53d8\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"unhealthy"),"\u3002"),(0,r.kt)("p",null,"\u548c CMD, ENTRYPOINT \u4e00\u6837\uff0cHEALTHCHECK \u53ea\u53ef\u4ee5\u51fa\u73b0\u4e00\u6b21\uff0c\u5982\u679c\u5199\u4e86\u591a\u4e2a\uff0c\u53ea\u6709\u6700\u540e\u4e00\u4e2a\u751f\u6548"),(0,r.kt)("p",null,"\u683c\u5f0f\uff1a"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"HEALTHCHECK [\u9009\u9879] CMD <\u547d\u4ee4>"),"\uff1a\u8bbe\u7f6e\u68c0\u67e5\u5bb9\u5668\u5065\u5eb7\u72b6\u51b5\u7684\u547d\u4ee4; \u547d\u4ee4\u90e8\u5206\u7684\u683c\u5f0f\u548c ENTRYPOINT \u4e00\u6837\uff0c\u5206\u4e3a shell \u683c\u5f0f\uff0c\u548c exec \u683c\u5f0f\u3002\u547d\u4ee4\u7684\u8fd4\u56de\u503c\u51b3\u5b9a\u4e86\u8be5\u6b21\u5065\u5eb7\u68c0\u67e5\u7684\u6210\u529f\u4e0e\u5426\uff1a0\uff1a\u6210\u529f\uff1b1\uff1a\u5931\u8d25"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u8bbe\u7f6e\u4e86\u6bcf 5 \u79d2\u68c0\u67e5\u4e00\u6b21\uff08\u8fd9\u91cc\u4e3a\u4e86\u8bd5\u9a8c\u6240\u4ee5\u95f4\u9694\u975e\u5e38\u77ed\uff0c\u5b9e\u9645\u5e94\u8be5\u76f8\u5bf9\u8f83\u957f\uff09\uff0c\u5982\u679c\u5065\u5eb7\u68c0\u67e5\u547d\u4ee4\u8d85\u8fc7 3 \u79d2\u6ca1\u54cd\u5e94\u5c31\u89c6\u4e3a\u5931\u8d25\uff0c\u5e76\u4e14\u4f7f\u7528 curl -fs http://localhost/ || exit 1 \u4f5c\u4e3a\u5065\u5eb7\u68c0\u67e5\u547d\u4ee4\nFROM nginx\nRUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*\nHEALTHCHECK --interval=5s --timeout=3s \\\nCMD curl -fs http://localhost/ || exit 1\n\n")),(0,r.kt)("p",null,"\u652f\u6301\u5982\u4e0b\u9009\u9879:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--interval=<\u95f4\u9694>"),"\uff1a\u4e24\u6b21\u5065\u5eb7\u68c0\u67e5\u7684\u95f4\u9694\uff0c\u9ed8\u8ba4\u4e3a 30 \u79d2\uff1b"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--timeout=<\u65f6\u957f>"),"\uff1a\u5065\u5eb7\u68c0\u67e5\u547d\u4ee4\u8fd0\u884c\u8d85\u65f6\u65f6\u95f4\uff0c\u5982\u679c\u8d85\u8fc7\u8fd9\u4e2a\u65f6\u95f4\uff0c\u672c\u6b21\u5065\u5eb7\u68c0\u67e5\u5c31\u88ab\u89c6\u4e3a\u5931\u8d25\uff0c\u9ed8\u8ba4 30 \u79d2\uff1b"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--retries=<\u6b21\u6570>"),"\uff1a\u5f53\u8fde\u7eed\u5931\u8d25\u6307\u5b9a\u6b21\u6570\u540e\uff0c\u5219\u5c06\u5bb9\u5668\u72b6\u6001\u89c6\u4e3a unhealthy\uff0c\u9ed8\u8ba4 3 \u6b21\u3002")),(0,r.kt)("p",null,"\u67e5\u770b\u5065\u5eb7\u68c0\u67e5\u65e5\u5fd7:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'$ docker inspect --format \'{{json .State.Health}}\' web | python -m json.tool\n{\n    "FailingStreak": 0,\n    "Log": [\n        {\n            "End": "2016-11-25T14:35:37.940957051Z",\n            "ExitCode": 0,\n            "Output": "<!DOCTYPE html>\\n<html>\\n<head>\\n<title>Welcome to nginx!</title>\\n<style>\\n    body {\\n        width: 35em;\\n        margin: 0 auto;\\n        font-family: Tahoma, Verdana, Arial, sans-serif;\\n    }\\n</style>\\n</head>\\n<body>\\n<h1>Welcome to nginx!</h1>\\n<p>If you see this page, the nginx web server is successfully installed and\\nworking. Further configuration is required.</p>\\n\\n<p>For online documentation and support please refer to\\n<a href=\\"http://nginx.org/\\">nginx.org</a>.<br/>\\nCommercial support is available at\\n<a href=\\"http://nginx.com/\\">nginx.com</a>.</p>\\n\\n<p><em>Thank you for using nginx.</em></p>\\n</body>\\n</html>\\n",\n            "Start": "2016-11-25T14:35:37.780192565Z"\n        }\n    ],\n    "Status": "healthy"\n}\n')),(0,r.kt)("p",null,"\u53e6\u5916, ",(0,r.kt)("inlineCode",{parentName:"p"},"HEALTHCHECK NONE"),"\uff1a\u5982\u679c\u57fa\u7840\u955c\u50cf\u6709\u5065\u5eb7\u68c0\u67e5\u6307\u4ee4\uff0c\u4f7f\u7528\u8fd9\u884c\u53ef\u4ee5\u5c4f\u853d\u6389\u5176\u5065\u5eb7\u68c0\u67e5\u6307\u4ee4"),(0,r.kt)("h2",{id:"onbuild-\u7ed9\u522b\u4eba\u7528"},"ONBUILD \u7ed9\u522b\u4eba\u7528"),(0,r.kt)("p",null,"\u683c\u5f0f\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"ONBUILD <\u5176\u5b83\u6307\u4ee4>")),(0,r.kt)("p",null,"ONBUILD \u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u6307\u4ee4\uff0c\u5b83\u540e\u9762\u8ddf\u7684\u662f\u5176\u5b83\u6307\u4ee4\uff0c\u6bd4\u5982 RUN, COPY \u7b49\uff0c\u800c\u8fd9\u4e9b\u6307\u4ee4\uff0c\u5728\u5f53\u524d\u955c\u50cf\u6784\u5efa\u65f6\u5e76\u4e0d\u4f1a\u88ab\u6267\u884c\u3002\u53ea\u6709\u5f53\u4ee5\u5f53\u524d\u955c\u50cf\u4e3a\u57fa\u7840\u955c\u50cf\uff0c\u53bb\u6784\u5efa\u4e0b\u4e00\u7ea7\u955c\u50cf\u7684\u65f6\u5019\u624d\u4f1a\u88ab\u6267\u884c"),(0,r.kt)("p",null,"\u4e0b\u9762\u4ee5\u4e00\u4e2a\u4f8b\u5b50\u8bf4\u660e:"),(0,r.kt)("p",null,"\u5236\u4f5c Node.js \u6240\u5199\u7684\u5e94\u7528\u7684\u955c\u50cf:  Node.js \u4f7f\u7528 npm \u8fdb\u884c\u5305\u7ba1\u7406\uff0c\u6240\u6709\u4f9d\u8d56\u3001\u914d\u7f6e\u3001\u542f\u52a8\u4fe1\u606f\u7b49\u4f1a\u653e\u5230 package.json \u6587\u4ef6\u91cc\u3002\u5728\u62ff\u5230\u7a0b\u5e8f\u4ee3\u7801\u540e\uff0c\u9700\u8981\u5148\u8fdb\u884c npm install \u624d\u53ef\u4ee5\u83b7\u5f97\u6240\u6709\u9700\u8981\u7684\u4f9d\u8d56\u3002\u7136\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7 npm start \u6765\u542f\u52a8\u5e94\u7528"),(0,r.kt)("p",null,"Dockerfile:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'FROM node:slim\nRUN mkdir /app # \u53ef\u4ee5\u7701\u6389?\nWORKDIR /app\nCOPY ./package.json /app\nRUN [ "npm", "install" ]\nCOPY . /app/\nCMD [ "npm", "start" ]\n')),(0,r.kt)("p",null,"\u628a\u8fd9\u4e2a Dockerfile \u653e\u5230 Node.js \u9879\u76ee\u7684\u6839\u76ee\u5f55\uff0c\u6784\u5efa\u597d\u955c\u50cf\u540e\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u62ff\u6765\u542f\u52a8\u5bb9\u5668\u8fd0\u884c\u3002"),(0,r.kt)("p",null,"\u73b0\u5728\u8003\u8651\u8fd9\u6837\u7684\u60c5\u666f: "),(0,r.kt)("p",null,"\u6211\u4eec\u8fd8\u6709\u7b2c\u4e8c\u4e2a Node.js \u9879\u76ee, \u548c\u8fd9\u4e2a\u7c7b\u4f3c, \u5982\u679c\u9700\u8981\u5236\u4f5c\u955c\u50cf, \u9700\u8981\u518d\u590d\u5236\u4e00\u4efdDockerfile\u5230\u9879\u76ee\u6839\u76ee\u5f55, \u6784\u5efa. \u8fd9\u91cc\u5c31\u6d89\u53ca\u5230\u91cd\u590d\u4e86, \u5982\u679c\u7b2c\u4e00\u4e2a\u9879\u76ee\u65b0\u53d1\u73b0\u6709\u95ee\u9898, \u4fee\u590d\u540e, \u7b2c\u4e8c\u4e2a\u9879\u76ee\u4e5f\u9700\u8981\u624b\u52a8\u518d\u6b21\u4fee\u590d"),(0,r.kt)("p",null,"\u521d\u7ea7\u6539\u8fdb: \u5236\u4f5c\u4e00\u4efd\u57fa\u7840\u955c\u50cf, \u540e\u7eed\u7684Dockerfile FROM\u8fd9\u4e2a\u955c\u50cf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'# \u57fa\u7840\u955c\u50cf, \u540d\u5b57\u4e3a my-node\nFROM node:slim\nRUN mkdir /app\nWORKDIR /app\nCMD [ "npm", "start" ]\n\n# \u5176\u4ed6\u5b50\u955c\u50cf, \n# \u57fa\u7840\u955c\u50cf\u53d8\u5316\u540e\uff0c\u5404\u4e2a\u9879\u76ee\u90fd\u7528\u8fd9\u4e2a Dockerfile \u91cd\u65b0\u6784\u5efa\u955c\u50cf\uff0c\u4f1a\u7ee7\u627f\u57fa\u7840\u955c\u50cf\u7684\u66f4\u65b0\nFROM my-node\nCOPY ./package.json /app\nRUN [ "npm", "install" ]\nCOPY . /app/\n')),(0,r.kt)("p",null,"\u73b0\u5728\u8003\u8651\u8fd9\u4e2a\u573a\u666f: \u5982\u679c\u5b50 Dockerfile \u91cc\u9762\u6709\u4e9b\u4e1c\u897f\u9700\u8981\u8c03\u6574\u5462\uff1f\u6bd4\u5982 npm install \u9700\u8981\u52a0\u4e00\u4e9b\u53c2\u6570\uff0c\u90a3\u600e\u4e48\u529e\uff1f\u8fd9\u4e00\u884c RUN \u662f\u4e0d\u53ef\u80fd\u653e\u5165\u57fa\u7840\u955c\u50cf\u7684\uff0c\u90a3\u4e48\u53ea\u80fd\u6bcf\u4e2a \u5b50 dockerfile \u90fd\u4fee\u6539 npm install \u8fd9\u6761\u547d\u4ee4\u4e86, \u80fd\u5426\u5c06\u5b50file\u4e2d\u7684\u547d\u4ee4\u63d0\u5230\u516c\u5171file \u4e2d\u800c\u4e0d\u6267\u884c\u5462?"),(0,r.kt)("p",null,"ONBUILD \u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898"),(0,r.kt)("p",null,"\u57fa\u7840\u955c\u50cf:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'FROM node:slim\nRUN mkdir /app\nWORKDIR /app\n# \u4e0b\u9762\u4e09\u884c\u5728\u5f53\u524d dockerfile \u6784\u5efa\u65f6\u5019\u4e0d\u4f1a\u6267\u884c\nONBUILD COPY ./package.json /app\nONBUILD RUN [ "npm", "install" ]\nONBUILD COPY . /app/\nCMD [ "npm", "start" ]\n')),(0,r.kt)("p",null,"\u7136\u540e\u5404\u4e2a\u5b50\u9879\u76ee\u7684 Dockerfile \u5c31\u53d8\u6210\u4e86\u7b80\u5355\u5730"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u5f53\u5728\u5404\u4e2a\u9879\u76ee\u76ee\u5f55\u4e2d\uff0c\u7528\u8fd9\u4e2a\u53ea\u6709\u4e00\u884c\u7684 Dockerfile \u6784\u5efa\u955c\u50cf\u65f6\uff0c\u4e4b\u524d\u57fa\u7840\u955c\u50cf\u7684\u90a3\u4e09\u884c ONBUILD \u5c31\u4f1a\u5f00\u59cb\u6267\u884c\uff0c\u6210\u529f\u7684\u5c06\u5f53\u524d\u9879\u76ee\u7684\u4ee3\u7801\u590d\u5236\u8fdb\u955c\u50cf\u3001\u5e76\u4e14\u9488\u5bf9\u672c\u9879\u76ee\u6267\u884c npm install\uff0c\u751f\u6210\u5e94\u7528\u955c\u50cf\nFROM my-node\n")),(0,r.kt)("h2",{id:"dockerfile\u7684\u591a\u9636\u6bb5\u6784\u5efa"},"Dockerfile\u7684\u591a\u9636\u6bb5\u6784\u5efa"),(0,r.kt)("p",null,"\u4e00\u79cd\u65b9\u5f0f\u662f\u5c06\u6240\u6709\u7684\u6784\u5efa\u8fc7\u7a0b\u5305\u542b\u5728\u4e00\u4e2a Dockerfile \u4e2d\uff0c\u5305\u62ec\u9879\u76ee\u53ca\u5176\u4f9d\u8d56\u5e93\u7684\u7f16\u8bd1\u3001\u6d4b\u8bd5\u3001\u6253\u5305\u7b49\u6d41\u7a0b\uff0c\u8fd9\u91cc\u53ef\u80fd\u4f1a\u5e26\u6765\u7684\u4e00\u4e9b\u95ee\u9898\uff1a"),(0,r.kt)("p",null,"Dockerfile \u7279\u522b\u957f\uff0c\u53ef\u7ef4\u62a4\u6027\u964d\u4f4e"),(0,r.kt)("p",null,"\u955c\u50cf\u5c42\u6b21\u591a\uff0c\u955c\u50cf\u4f53\u79ef\u8f83\u5927\uff0c\u90e8\u7f72\u65f6\u95f4\u53d8\u957f"),(0,r.kt)("p",null,"\u6e90\u4ee3\u7801\u5b58\u5728\u6cc4\u9732\u7684\u98ce\u9669"),(0,r.kt)("h1",{id:"\u4f7f\u7528\u5bb9\u5668"},"\u4f7f\u7528\u5bb9\u5668"),(0,r.kt)("p",null,"\u5bb9\u5668\u662f\u72ec\u7acb\u8fd0\u884c\u7684\u4e00\u4e2a\u6216\u4e00\u7ec4\u5e94\u7528\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u8fd0\u884c\u6001\u73af\u5883"),(0,r.kt)("h2",{id:"\u67e5\u770b"},"\u67e5\u770b"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"docker container ls -a"),"or",(0,r.kt)("inlineCode",{parentName:"li"},"docker ps -a")," \u67e5\u770b\u6240\u6709, \u5305\u62ec\u5904\u4e8e\u7ec8\u6b62\u72b6\u6001\u7684\u5bb9\u5668"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"docker container ls"),"or",(0,r.kt)("inlineCode",{parentName:"li"},"docker ps")," \u4ec5\u67e5\u770b\u8fd0\u884c\u72b6\u6001\u7684\u5bb9\u5668")),(0,r.kt)("h2",{id:"\u542f\u52a8"},"\u542f\u52a8"),(0,r.kt)("p",null,"\u542f\u52a8\u5bb9\u5668\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u4e00\u79cd\u662f\u57fa\u4e8e\u955c\u50cf\u65b0\u5efa\u4e00\u4e2a\u5bb9\u5668\u5e76\u542f\u52a8(\u5e38\u7528)\uff0c\u53e6\u5916\u4e00\u4e2a\u662f\u5c06\u5728\u7ec8\u6b62\u72b6\u6001\uff08stopped\uff09\u7684\u5bb9\u5668\u91cd\u65b0\u542f\u52a8\u3002"),(0,r.kt)("p",null,"\u65b0\u5efa\u5bb9\u5668\u5e76\u542f\u52a8: ",(0,r.kt)("inlineCode",{parentName:"p"},"docker run <\u5bb9\u5668\u540d:\u7248\u672c> <\u547d\u4ee4>"),")"),(0,r.kt)("p",null,"\u542f\u52a8\u5df2\u6709\u7684\u5bb9\u5668: ",(0,r.kt)("inlineCode",{parentName:"p"},"docker start <container>")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"docker container start/restart xxx")),(0,r.kt)("p",null,"\u5f53\u5229\u7528 docker run \u6765\u521b\u5efa\u5bb9\u5668\u65f6\uff0cDocker \u5728\u540e\u53f0\u8fdb\u884c\u5982\u4e0b\u6d41\u7a0b:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u68c0\u67e5\u672c\u5730\u662f\u5426\u5b58\u5728\u6307\u5b9a\u7684\u955c\u50cf\uff0c\u4e0d\u5b58\u5728\u5c31\u4ece\u516c\u6709\u4ed3\u5e93\u4e0b\u8f7d"),(0,r.kt)("li",{parentName:"ul"},"\u5229\u7528\u955c\u50cf\u521b\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668"),(0,r.kt)("li",{parentName:"ul"},"\u5206\u914d\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u5e76\u5728\u53ea\u8bfb\u7684\u955c\u50cf\u5c42\u5916\u9762\u6302\u8f7d\u4e00\u5c42\u53ef\u8bfb\u5199\u5c42"),(0,r.kt)("li",{parentName:"ul"},"\u4ece\u5bbf\u4e3b\u4e3b\u673a\u914d\u7f6e\u7684\u7f51\u6865\u63a5\u53e3\u4e2d\u6865\u63a5\u4e00\u4e2a\u865a\u62df\u63a5\u53e3\u5230\u5bb9\u5668\u4e2d\u53bb"),(0,r.kt)("li",{parentName:"ul"},"\u4ece\u5730\u5740\u6c60\u914d\u7f6e\u4e00\u4e2a ip \u5730\u5740\u7ed9\u5bb9\u5668"),(0,r.kt)("li",{parentName:"ul"},"\u6267\u884c\u7528\u6237\u6307\u5b9a\u7684\u5e94\u7528\u7a0b\u5e8f (\u5982\u679c\u6709\u7684\u8bdd)"),(0,r.kt)("li",{parentName:"ul"},"\u6267\u884c\u5b8c\u6bd5\u540e\u5bb9\u5668\u88ab\u7ec8\u6b62")),(0,r.kt)("h3",{id:"-it-\u7ef4\u6301\u4ea4\u4e92\u7ec8\u7aef"},"-it \u7ef4\u6301\u4ea4\u4e92\u7ec8\u7aef"),(0,r.kt)("p",null,"eg:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u8f93\u51fa\u4e00\u4e2a \u201cHello World\u201d\uff0c\u4e4b\u540e\u7ec8\u6b62\u5bb9\u5668\n$ docker run ubuntu:14.04 /bin/echo 'Hello world'\nHello world\n\n# \u542f\u52a8\u4e00\u4e2a bash \u7ec8\u7aef\uff0c\u5141\u8bb8\u7528\u6237\u8fdb\u884c\u4ea4\u4e92\n# \u5176\u4e2d\uff0c-t \u9009\u9879\u8ba9Docker\u5206\u914d\u4e00\u4e2a\u4f2a\u7ec8\u7aef\uff08pseudo-tty\uff09\u5e76\u7ed1\u5b9a\u5230\u5bb9\u5668\u7684\u6807\u51c6\u8f93\u5165\u4e0a\uff0c -i \u5219\u8ba9\u5bb9\u5668\u7684\u6807\u51c6\u8f93\u5165\u4fdd\u6301\u6253\u5f00(\u4ee5\u4fbf\u4ea4\u4e92\u5f0f\u64cd\u4f5c)\u3002 -it \u4e00\u822c\u4e00\u8d77\u4f7f\u7528\n$ docker run -t -i ubuntu:14.04 /bin/bash\nroot@af8bae53bdd3:/#\n")),(0,r.kt)("h3",{id:"-d-\u540e\u53f0\u8fd0\u884c"},"-d \u540e\u53f0\u8fd0\u884c"),(0,r.kt)("p",null,"\u524d\u9762\u90fd\u662f\u5728\u524d\u53f0\u8fd0\u884c\u7684, \u5982\u4f55\u4ee5\u5b88\u62a4\u72b6\u6001\u8fd0\u884c? \u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker run -d")),(0,r.kt)("p",null,"eg:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'# \u5982\u679c\u4e0d\u4f7f\u7528 -d \u53c2\u6570\u8fd0\u884c\u5bb9\u5668,\u5bb9\u5668\u4f1a\u628a\u8f93\u51fa\u7684\u7ed3\u679c (STDOUT) \u6253\u5370\u5230\u5bbf\u4e3b\u673a\u4e0a\u9762\n$ docker run ubuntu:17.10 /bin/sh -c "while true; do echo hello world; sleep 1; done"\nhello world\nhello world\nhello world\nhello world\n\n# \u5982\u679c\u4f7f\u7528\u4e86 -d \u53c2\u6570\u8fd0\u884c\u5bb9\u5668\n# \u6b64\u65f6\u5bb9\u5668\u4f1a\u5728\u540e\u53f0\u8fd0\u884c, \u5bbf\u4e3b\u673a\u5668\u6ca1\u6709\u4efb\u4f55\u8f93\u51fa(\u8f93\u51fa\u7ed3\u679c\u53ef\u4ee5\u7528 docker logs \u67e5\u770b)\n$ docker run -d ubuntu:17.10 /bin/sh -c "while true; do echo hello world; sleep 1; done"\n77b2dc01fe0f3f1265df143181e7b9af5e05279a884f4776ee75350ea9d8017a\n\n# \u67e5\u770b\u5bb9\u5668\u65e5\u5fd7\ndocker container logs <container ID or NAMES> \ndocker logs <container id or name>\n')),(0,r.kt)("h3",{id:"--privilegedtrue-\u8d4b\u4e88\u7279\u6743"},"--privileged=true \u8d4b\u4e88\u7279\u6743"),(0,r.kt)("p",null,"\u662f\u5426\u8ba9docker \u5e94\u7528\u5bb9\u5668 \u83b7\u53d6\u5bbf\u4e3b\u673aroot\u6743\u9650"),(0,r.kt)("p",null,"\u4f7f\u7528\u8be5\u53c2\u6570\uff0ccontainer\u5185\u7684root\u62e5\u6709\u771f\u6b63\u7684root\u6743\u9650\u3002\n\u5426\u5219\uff0ccontainer\u5185\u7684root\u53ea\u662f\u5916\u90e8\u7684\u4e00\u4e2a\u666e\u901a\u7528\u6237\u6743\u9650\u3002\nprivileged\u542f\u52a8\u7684\u5bb9\u5668\uff0c\u53ef\u4ee5\u770b\u5230\u5f88\u591ahost\u4e0a\u7684\u8bbe\u5907\uff0c\u5e76\u4e14\u53ef\u4ee5\u6267\u884cmount\u3002\n\u751a\u81f3\u5141\u8bb8\u4f60\u5728docker\u5bb9\u5668\u4e2d\u542f\u52a8docker\u5bb9\u5668\u3002"),(0,r.kt)("h2",{id:"\u7ec8\u6b62container"},"\u7ec8\u6b62container"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker container stop <xxx>")),(0,r.kt)("p",null,"\u6b64\u5916\uff0c\u5f53 Docker \u5bb9\u5668\u4e2d\u6307\u5b9a\u7684\u5e94\u7528\u7ec8\u7ed3\u65f6\uff0c\u5bb9\u5668\u4e5f\u81ea\u52a8\u7ec8\u6b62(\u4f8b\u5982: \u53ea\u542f\u52a8\u4e86\u4e00\u4e2a\u7ec8\u7aef\u7684\u5bb9\u5668\uff0c\u7528\u6237\u901a\u8fc7 exit \u547d\u4ee4\u6216 Ctrl+d \u6765\u9000\u51fa\u7ec8\u7aef\u65f6\uff0c\u6240\u521b\u5efa\u7684\u5bb9\u5668\u7acb\u523b\u7ec8\u6b62\u3002)"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker container ls -a")," \u67e5\u770b\u6240\u6709\u7684container, \u5305\u62ec\u505c\u6b62\u7684container"),(0,r.kt)("h2",{id:"\u5220\u9664container"},"\u5220\u9664container"),(0,r.kt)("p",null,"container\u7ec8\u6b62\u540e, \u4e0d\u4f1a\u5220\u9664, \u9700\u8981\u624b\u52a8\u5220\u9664"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"docker container rm <xxx>")," \u5220\u9664\u6307\u5b9acontainer(\u5bb9\u5668\u5904\u4e8e\u7ec8\u6b62\u72b6\u6001)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"docker container rm -f <xxx>"),"\u5982\u679c\u8981\u5220\u9664\u4e00\u4e2a\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\uff0c\u53ef\u4ee5\u6dfb\u52a0 -f \u53c2\u6570\u3002Docker \u4f1a\u53d1\u9001 SIGKILL \u4fe1\u53f7\u7ed9\u5bb9\u5668"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"docker container prune")," \u5220\u9664\u6240\u6709\u7ec8\u6b62\u7684\u5bb9\u5668")),(0,r.kt)("h2",{id:"\u8fdb\u5165\u5bb9\u5668"},"\u8fdb\u5165\u5bb9\u5668"),(0,r.kt)("p",null,"\u5728\u4f7f\u7528 -d \u53c2\u6570\u65f6\uff0c\u5bb9\u5668\u542f\u52a8\u540e\u4f1a\u8fdb\u5165\u540e\u53f0, \u67d0\u4e9b\u65f6\u5019\u9700\u8981\u8fdb\u5165\u5bb9\u5668\u8fdb\u884c\u64cd\u4f5c\uff0c\u5305\u62ec\u4f7f\u7528 docker attach \u547d\u4ee4\u6216 docker exec \u547d\u4ee4(\u63a8\u8350\u540e\u8005, \u56e0\u4e3a\u540e\u8005exit\u65f6\u4e0d\u4f1a\u5bfc\u81f4\u5bb9\u5668\u9000\u51fa)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"docker attach <xxx>")," \u8fdb\u5165container, \u5f53exit\u65f6, \u5bb9\u5668\u4e5f\u968f\u4e4b\u7ec8\u6b62")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"docker exec -it <xxx> bash")," \u8fdb\u5165container, \u9000\u51fa\u65f6\u5bb9\u5668\u4e0d\u4f1a\u7ec8\u6b62(\u6ce8\u610f, \u540e\u9762\u8981\u8ddf\u4e00\u4e2a\u547d\u4ee4bash)"))),(0,r.kt)("h2",{id:"\u5bb9\u5668\u7684\u5bfc\u5165\u548c\u5bfc\u51fa"},"\u5bb9\u5668\u7684\u5bfc\u5165\u548c\u5bfc\u51fa"),(0,r.kt)("p",null,"\u5bfc\u51fa"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'$ docker container ls -a\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                    PORTS               NAMES\n7691a814370e        ubuntu:14.04        "/bin/bash"         36 hours ago        Exited (0) 21 hours ago                       test\n$ docker export 7691a814370e > ubuntu.tar\n')),(0,r.kt)("p",null,"\u8fd9\u6837\u5c06\u5bfc\u51fa\u5bb9\u5668\u5feb\u7167\u5230\u672c\u5730\u6587\u4ef6"),(0,r.kt)("p",null,"\u5bfc\u5165\u5bb9\u5668\u5feb\u7167\u4e3a\u955c\u50cf:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ cat ubuntu.tar | docker import - test/ubuntu:v1.0\n$ docker image ls\nREPOSITORY          TAG                 IMAGE ID            CREATED              VIRTUAL SIZE\ntest/ubuntu         v1.0                9d37a6082e97        About a minute ago   171.3 MB\n\n# \u6216\u8005\n$ docker import http://example.com/exampleimage.tgz example/imagerepo\n")),(0,r.kt)("p",null,"docker import\u548cdocker load\u6bd4\u8f83: \u5bb9\u5668\u5feb\u7167\u6587\u4ef6(docker import)\u5c06\u4e22\u5f03\u6240\u6709\u7684\u5386\u53f2\u8bb0\u5f55\u548c\u5143\u6570\u636e\u4fe1\u606f\uff08\u5373\u4ec5\u4fdd\u5b58\u5bb9\u5668\u5f53\u65f6\u7684\u5feb\u7167\u72b6\u6001\uff09\uff0c\u800c\u955c\u50cf\u5b58\u50a8\u6587\u4ef6(docker load)\u5c06\u4fdd\u5b58\u5b8c\u6574\u8bb0\u5f55\uff0c\u4f53\u79ef\u4e5f\u8981\u5927\u3002\u6b64\u5916\uff0c\u4ece\u5bb9\u5668\u5feb\u7167\u6587\u4ef6\u5bfc\u5165\u65f6\u53ef\u4ee5\u91cd\u65b0\u6307\u5b9a\u6807\u7b7e\u7b49\u5143\u6570\u636e\u4fe1\u606f\u3002"),(0,r.kt)("h2",{id:"\u62f7\u8d1d\u5bb9\u5668\u5185\u6587\u4ef6\u5230\u4e3b\u673a"},"\u62f7\u8d1d\u5bb9\u5668\u5185\u6587\u4ef6\u5230\u4e3b\u673a"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker cp <container_name>:/path <host_path>")),(0,r.kt)("h1",{id:"\u8bbf\u95ee\u955c\u50cf\u4ed3\u5e93"},"\u8bbf\u95ee\u955c\u50cf\u4ed3\u5e93"),(0,r.kt)("h2",{id:"dockerhub"},"dockerhub"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker login"),"\u767b\u5f55\n",(0,r.kt)("inlineCode",{parentName:"p"},"docker logout")," \u9000\u51fa"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker search <xxx>")," \u641c\u7d22\n",(0,r.kt)("inlineCode",{parentName:"p"},"docker pull <xxx>")," \u4e0b\u8f7d\u5230\u672c\u5730"),(0,r.kt)("p",null,"\u63a8\u9001\u955c\u50cf\u5230\u81ea\u5df1\u7684\u4ed3\u5e93:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u6807\u8bb0\u65b0\u7684tag\u7528\u4e8e\u63a8\u9001\u5230\u8fdc\u7a0b\n$ docker tag ubuntu:17.10 xiaoyureed/ubuntu:17.10\n\n$ docker image ls\n\nREPOSITORY                                               TAG                    IMAGE ID            CREATED             SIZE\nubuntu                                                   17.10                  275d79972a86        6 days ago          94.6MB\nusername/ubuntu                                          17.10                  275d79972a86        6 days ago          94.6MB\n\n# \u63a8\u9001\n$ docker push xiaoyureed/ubuntu:17.10\n\n# \u73b0\u5728\u641c\u7d22\u53ef\u4ee5\u641c\u5230\u4e86\n$ docker search username\n\nNAME                      DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED\nxiaoyureed/ubuntu\n")),(0,r.kt)("p",null,"\u6b64\u5916, docker hub \u652f\u6301 \u81ea\u52a8\u521b\u5efa(Automated Builds), \u5bf9\u4e8e\u9700\u8981\u7ecf\u5e38\u5347\u7ea7\u955c\u50cf\u5185\u7a0b\u5e8f\u6765\u8bf4\uff0c\u5341\u5206\u65b9\u4fbf "),(0,r.kt)("h2",{id:"\u79c1\u6709\u4ed3\u5e93"},"\u79c1\u6709\u4ed3\u5e93"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/goharbor/harbor"},"https://github.com/goharbor/harbor")," Harbor"),(0,r.kt)("p",null,"\u6216\u8005:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u53ef\u4ee5\u901a\u8fc7\u83b7\u53d6\u5b98\u65b9 registry \u955c\u50cf\u6765\u8fd0\u884c\n# \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4ed3\u5e93\u4f1a\u88ab\u521b\u5efa\u5728\u5bb9\u5668\u7684 /var/lib/registry \u76ee\u5f55\ndocker run -d -p 5000:5000 --restart=always --name registry registry\n\n# \u4f7f\u7528 -v \u81ea\u5b9a\u4e49 \u4ed3\u5e93\u76ee\u5f55\n$ docker run -d \\\n    -p 5000:5000 \\\n    -v /opt/data/registry:/var/lib/registry \\\n    registry\n")),(0,r.kt)("p",null,"\u60f3\u8ba9\u672c\u7f51\u6bb5\u7684\u5176\u4ed6\u4e3b\u673a\u4e5f\u80fd\u628a\u955c\u50cf\u63a8\u9001\u5230\u79c1\u6709\u4ed3\u5e93\u3002\u4f60\u5c31\u5f97\u628a\u4f8b\u5982 192.168.199.100:5000 \u8fd9\u6837\u7684\u5185\u7f51\u5730\u5740\u4f5c\u4e3a\u79c1\u6709\u4ed3\u5e93\u5730\u5740\uff0c\u8fd9\u65f6\u4f60\u4f1a\u53d1\u73b0\u65e0\u6cd5\u6210\u529f\u63a8\u9001\u955c\u50cf\u3002\u8fd9\u662f\u56e0\u4e3a Docker \u9ed8\u8ba4\u4e0d\u5141\u8bb8\u975e HTTPS \u65b9\u5f0f\u63a8\u9001\u955c\u50cf\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Docker \u7684\u914d\u7f6e\u9009\u9879\u6765\u53d6\u6d88\u8fd9\u4e2a\u9650\u5236:"),(0,r.kt)("h1",{id:"docker\u6570\u636e\u7ba1\u7406"},"docker\u6570\u636e\u7ba1\u7406"),(0,r.kt)("p",null,"Docker container \u4ea7\u751f\u7684\u6570\u636e\u5728 container \u5220\u9664\u540e\u5c31\u4e22\u5931\u4e86, \u9664\u975e commit \u8fd9\u4e2a container \u751f\u6210\u65b0\u7684 image, \u90a3\u4e48\u5982\u4f55\u4fdd\u5b58\u8fd9\u4e9b\u6570\u636e\u5462:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6570\u636e\u5377\uff08Volumes\uff09")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6302\u8f7d\u4e3b\u673a\u76ee\u5f55 (Bind mounts)"))),(0,r.kt)("h2",{id:"\u6570\u636e\u5377"},"\u6570\u636e\u5377"),(0,r.kt)("p",null,"docker \u9ed8\u8ba4\u5728\u4e3b\u673a\u4e0a\u4f1a\u6709\u4e00\u4e2a\u7279\u5b9a\u7684\u533a\u57df\uff08/var/lib/docker/volumes/ Linux\uff09\uff0c\u8be5\u533a\u57df\u7528\u6765\u5b58\u653e volume\u3002volume \u5728\u751f\u6210\u7684\u65f6\u5019\u5982\u679c\u4e0d\u6307\u5b9a\u540d\u79f0\uff0c\u4fbf\u4f1a\u968f\u673a\u751f\u6210"),(0,r.kt)("p",null,"\u6570\u636e\u5377 \u662f\u88ab\u8bbe\u8ba1\u7528\u6765\u6301\u4e45\u5316\u6570\u636e\u7684 , \u7c7b\u4f3clinux\u4e0b\u76ee\u5f55\u7684mount; \u5b83\u7ed5\u8fc7 UFS\uff0c\u53ef\u4ee5\u63d0\u4f9b\u5f88\u591a\u6709\u7528\u7684\u7279\u6027\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6570\u636e\u5377 \u53ef\u4ee5\u5728\u5bb9\u5668\u4e4b\u95f4\u5171\u4eab\u548c\u91cd\u7528")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5bf9 \u6570\u636e\u5377 \u7684\u66f4\u65b0\uff0c\u4e0d\u4f1a\u5f71\u54cd\u955c\u50cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6570\u636e\u5377 \u9ed8\u8ba4\u4f1a\u4e00\u76f4\u5b58\u5728\uff0c\u5373\u4f7f\u5bb9\u5668\u88ab\u5220\u9664"),(0,r.kt)("p",{parentName:"li"},"  \u5b83\u7684\u751f\u547d\u5468\u671f\u72ec\u7acb\u4e8e\u5bb9\u5668\uff0cDocker \u4e0d\u4f1a\u5728\u5bb9\u5668\u88ab\u5220\u9664\u540e\u81ea\u52a8\u5220\u9664 \u6570\u636e\u5377"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'\n`docker volume create my-vol` \u521b\u5efa\u4e00\u4e2avolume\n`docker volume ls` \u67e5\u770b\u6240\u6709\u7684volume\n`docker volume inspect my-vol` \u67e5\u770b\u6307\u5b9a\u7684volume\n`docker inspect web` \u5728\u5bb9\u5668\u4e2d\u67e5\u770bvolume\u4fe1\u606f(\u6570\u636e\u5377 \u4fe1\u606f\u5728 "Mounts" Key \u4e0b\u9762, \u8fd9\u91cc\u7684web\u4e3acontainer\u540d)\n`docker volume rm my-vol`\u5220\u9664volume\n`docker volume prune` \u6e05\u7406\u65e0\u4e3b\u7684volume\ndocker rm -v <container_id> \u5220\u9664\u5bb9\u5668\u540c\u65f6\u5220\u9664 volume\n\n# \u521b\u5efa\u4e00\u4e2acontainer\u540c\u65f6\u6302\u8f7d\u4e00\u4e2a/\u591a\u4e2a\u6570\u636e\u5377\n# \u521b\u5efa\u4e00\u4e2a\u540d\u4e3a web \u7684\u5bb9\u5668\uff0c\u5e76\u52a0\u8f7d\u4e00\u4e2a \u6570\u636e\u5377 \u5230\u5bb9\u5668\u7684 /webapp \u76ee\u5f55\u3002, \u5982\u679c/webapp\u4e2d\u6709\u5185\u5bb9\u5219\u6682\u65f6\u4f1a\u88ab\u5c4f\u853d\n$ docker run -d -P \\\n    --name web \\\n    # -v my-vol:/wepapp \\\n    # \u7b49\u540c\n    --mount source=my-vol,target=/webapp \\\n    training/webapp \\\n    python app.py\n')),(0,r.kt)("h2",{id:"\u6302\u8f7d\u4e3b\u673a\u76ee\u5f55"},"\u6302\u8f7d\u4e3b\u673a\u76ee\u5f55"),(0,r.kt)("p",null,"\u4f7f\u7528",(0,r.kt)("inlineCode",{parentName:"p"}," --mount")," \u6807\u8bb0\u53ef\u4ee5\u6307\u5b9a\u6302\u8f7d\u4e00\u4e2a\u672c\u5730\u4e3b\u673a\u7684\u76ee\u5f55\u5230\u5bb9\u5668\u4e2d\u53bb (\u4e5f\u53ef\u4ee5\u6302\u5728\u6570\u636e\u5377\u5230\u5bb9\u5668\u4e2d\u53bb)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u52a0\u8f7d\u4e3b\u673a\u7684 /src/webapp \u76ee\u5f55\u5230\u5bb9\u5668\u7684 /opt/webapp\u76ee\u5f55\n$ docker run -d -P \\\n    --name web \\\n    # -v /src/webapp:/opt/webapp \\\n    --mount type=bind,source=/src/webapp,target=/opt/webapp \\\n    training/webapp \\\n    python app.py\n")),(0,r.kt)("p",null,"\u8fd9\u4e2a\u529f\u80fd\u5728\u8fdb\u884c\u6d4b\u8bd5\u7684\u65f6\u5019\u5341\u5206\u65b9\u4fbf\uff0c\u6bd4\u5982\u7528\u6237\u53ef\u4ee5\u653e\u7f6e\u4e00\u4e9b\u7a0b\u5e8f\u5230\u672c\u5730\u76ee\u5f55\u4e2d\uff0c\u6765\u67e5\u770b\u5bb9\u5668\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\u3002\u672c\u5730\u76ee\u5f55\u7684\u8def\u5f84\u5fc5\u987b\u662f\u7edd\u5bf9\u8def\u5f84"),(0,r.kt)("p",null,"Docker \u6302\u8f7d\u4e3b\u673a\u76ee\u5f55\u7684\u9ed8\u8ba4\u6743\u9650\u662f \u8bfb\u5199\uff0c\u7528\u6237\u4e5f\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0 readonly \u6307\u5b9a\u4e3a \u53ea\u8bfb:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ docker run -d -P \\\n    --name web \\\n    # -v /src/webapp:/opt/webapp:ro \\\n    --mount type=bind,source=/src/webapp,target=/opt/webapp,readonly \\\n    training/webapp \\\n    python app.py\n")),(0,r.kt)("p",null,"\u67e5\u770b\u4f7f\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"docker inspect <container name>"),', \u6302\u8f7d\u4e3b\u673a\u76ee\u5f55 \u7684\u914d\u7f6e\u4fe1\u606f\u5728 "Mounts" Key \u4e0b\u9762;'),(0,r.kt)("p",null,"\u4e5f\u53ef\u4ee5\u6302\u8f7d\u4e3b\u673a\u5355\u4e2a\u6587\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ docker run --rm -it \\\n   # -v $HOME/.bash_history:/root/.bash_history \\\n   --mount type=bind,source=$HOME/.bash_history,target=/root/.bash_history \\\n   ubuntu:17.10 \\\n   bash\n\nroot@2affd44b4667:/# history\n1  ls\n2  diskutil list\n")),(0,r.kt)("p",null,"\u8fd9\u6837\u5c31\u53ef\u4ee5\u8bb0\u5f55\u5728\u5bb9\u5668\u8f93\u5165\u8fc7\u7684\u547d\u4ee4\u4e86"),(0,r.kt)("p",null,"--mount \u548c -v \u533a\u522b:"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"http://einverne.github.io/post/2018/03/docker-v-and-mount.html"},"http://einverne.github.io/post/2018/03/docker-v-and-mount.html")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"-v \u9009\u9879\u5c06\u6240\u6709\u9009\u9879\u96c6\u4e2d\u5230\u4e00\u4e2a\u503c, \u66f4\u7cbe\u7b80"),(0,r.kt)("p",{parentName:"li"},"-v \u6216 --volume: \u5305\u542b\u4e09\u4e2a field\uff0c\u4f7f\u7528 : \u6765\u5206\u5272\uff0c\u6240\u6709\u503c\u9700\u8981\u6309\u7167\u6b63\u786e\u7684\u987a\u5e8f\u3002\u7b2c\u4e00\u4e2a field \u662f volume \u7684\u540d\u5b57\uff0c\u5e76\u4e14\u5728\u5bbf\u4e3b\u673a\u4e0a\u552f\u4e00\uff0c\u5bf9\u4e8e\u533f\u540d volume\uff0c\u7b2c\u4e00\u4e2afield\u901a\u5e38\u88ab\u7701\u7565\uff1b\u7b2c\u4e8c\u4e2afield\u662f\u5bbf\u4e3b\u673a\u4e0a\u5c06\u8981\u88ab\u6302\u8f7d\u5230\u5bb9\u5668\u7684path\u6216\u8005\u6587\u4ef6\uff1b\u7b2c\u4e09\u4e2afield\u53ef\u9009\uff0c\u6bd4\u5982\u8bf4 ro")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"--mount \u9009\u9879\u5c06\u53ef\u9009\u9879\u5206\u5f00, \u66f4\u5570\u55e6"),(0,r.kt)("p",{parentName:"li"},"--mount: \u5305\u542b\u591a\u4e2a key-value \u5bf9\uff0c\u4f7f\u7528\u9017\u53f7\u5206\u5272\u3002--mount \u9009\u9879\u66f4\u52a0\u590d\u6742\uff0c\u4f46\u662f\u5404\u4e2a\u503c\u4e4b\u95f4\u65e0\u9700\u8003\u8651\u987a\u5e8f\u3002"),(0,r.kt)("p",{parentName:"li"},"type\uff0c\u53ef\u4ee5\u4e3a bind, volume, tmpfs, \u901a\u5e38\u4e3a volume\nsource \u4e5f\u53ef\u4ee5\u5199\u6210 src\uff0c\u5bf9\u4e8e named volumes\uff0c\u53ef\u4ee5\u8bbe\u7f6e volume \u7684\u540d\u5b57\uff0c\u5bf9\u4e8e\u533f\u540d volume\uff0c\u53ef\u4ee5\u7701\u7565\ndestination \u53ef\u4ee5\u5199\u6210 dst\u6216\u8005 target \u8be5\u503c\u4f1a\u6302\u8f7d\u5230\u5bb9\u5668\nreadonly \u53ef\u9009\uff0c\u5982\u679c\u4f7f\u7528\uff0c\u8868\u793a\u53ea\u8bfb\nvolume-opt \u53ef\u9009\uff0c\u53ef\u4ee5\u4f7f\u7528\u591a\u6b21"))),(0,r.kt)("p",null,"\u5982:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker run -d \\\n  --name=nginxtest \\\n  --mount source=nginx-vol,destination=/usr/share/nginx/html \\\n  nginx:latest\n\ndocker run -d \\\n  --name=nginxtest \\\n  -v nginx-vol:/usr/share/nginx/html \\\n  nginx:latest\n\n")),(0,r.kt)("h2",{id:"volume-\u7684\u5171\u4eab"},"volume \u7684\u5171\u4eab"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"--volume-from")," \u4e3a\u5f53\u521b\u5efa\u7684\u5bb9\u5668\u6307\u5b9a\u5176\u4ed6\u5bb9\u5668\u7684 volume"),(0,r.kt)("p",null,"\u6709\u955c\u50cf imageA, \u6d3e\u751f\u5bb9\u5668 container1, \u6302\u8f7d\u6709\u533f\u540d\u5377 /data, ",(0,r.kt)("inlineCode",{parentName:"p"},"docker run --name container2 --volume-from container1 imageA")," \u90a3\u4e48 /data \u76ee\u5f55\u4f1a\u88ab\u4e24\u4e2a \u5bb9\u5668\u5171\u4eab"),(0,r.kt)("h1",{id:"\u7f51\u7edc\u4e92\u8054"},"\u7f51\u7edc\u4e92\u8054"),(0,r.kt)("h2",{id:"docker-\u9ed8\u8ba4\u521d\u59cb\u521b\u5efa"},"docker \u9ed8\u8ba4\u521d\u59cb\u521b\u5efa"),(0,r.kt)("p",null,"docker \u5b89\u88c5\u7684\u65f6\u5019\uff0c\u4f1a\u5728\u5bbf\u4e3b\u673a\u5efa\u7acb\u4e00\u5757\u865a\u62df\u7f51\u5361 docker0 \u4f5c\u4e3a\u7f51\u6865\uff0c \u5bbf\u4e3b\u673a \u901a\u8fc7\u8fd9\u4e2a\u7f51\u5361 \u6865\u63a5\u5230\u4e86docker\u5185\u5c40\u57df\u7f51\u3002\u5728docker\u5bb9\u5668\u5185\uff0c\u901a\u8fc7 docker0 \u7684 IP \u5730\u5740\u5c31\u80fd\u8bbf\u95ee\u5bbf\u4e3b\u673a\u7684\u670d\u52a1\u4e86\u3002"),(0,r.kt)("p",null,"Docker\u5b89\u88c5\u540e\uff0c\u9ed8\u8ba4\u4f1a\u521b\u5efa\u4e0b\u9762\u4e09\u4e2a network, \u9664\u975e\u53e6\u6709\u6307\u5b9a\uff0c\u5426\u5219\u65b0\u542f\u52a8\u7684\u5bb9\u5668\u4f1a\u94fe\u63a5 bridge \u8fd9\u4e2a network\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ docker network ls\nNETWORK ID     NAME        DRIVER       SCOPE\n9781b1f585ae    bridge       bridge(\u9ed8\u8ba4)      local   ==> \u6865\u63a5\u7f51\u7edc, \u9ed8\u8ba4, \u91cd\u542f\u4e0b\uff0cDocker\u7684IP\u5730\u5740\u5c31\u53d8\u4e86\n1252da701e55    host        host        local     ==> \u4e3b\u673a\u7f51\u7edc, \u5bb9\u5668\u7684\u7f51\u7edc\u4f1a\u9644\u5c5e\u5728\u4e3b\u673a\u4e0a\uff0c\u4e24\u8005\u662f\u4e92\u901a\u7684(\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u4e00\u4e2aWeb\u670d\u52a1\uff0c\u76d1\u542c8080\u7aef\u53e3\uff0c\u5219\u4e3b\u673a\u76848080\u7aef\u53e3\u5c31\u4f1a\u81ea\u52a8\u6620\u5c04\u5230\u5bb9\u5668\u4e2d)\n237ea3d5cfbf    none        null        local     ==> \u65e0\u6307\u5b9a\u7f51\u7edc, docker \u5bb9\u5668\u5c31\u4e0d\u4f1a\u5206\u914d\u5c40\u57df\u7f51\u7684IP\n\n")),(0,r.kt)("h2",{id:"\u7f51\u5361"},"\u7f51\u5361"),(0,r.kt)("p",null,"\u5bb9\u5668\u5185\u90e8\u5982\u4f55\u8bbf\u95ee\u5bbf\u4e3b\u673a\u5668?"),(0,r.kt)("p",null,"\u5bbf\u4e3b\u6267\u884c ifconfig, ",(0,r.kt)("inlineCode",{parentName:"p"},"eth0, eth1 ...")," \u4ee3\u8868\u771f\u5b9e\u7f51\u5361, ",(0,r.kt)("inlineCode",{parentName:"p"},"docker0")," \u662f docker \u65b0\u5efa\u7684\u865a\u62df\u7f51\u5361, \u4f5c\u4e3a\u5bb9\u5668\u8bbf\u95ee\u5bbf\u4e3b\u7684\u7f51\u6865, ",(0,r.kt)("inlineCode",{parentName:"p"},"veth2ddf66cc, vethxxxxx ...")," \u548c\u5bb9\u5668\u5185\u7684 eth0 \u7ed1\u5b9a"),(0,r.kt)("h2",{id:"network\u5206\u7c7b"},"network\u5206\u7c7b"),(0,r.kt)("h3",{id:"bridge-\u7c7b\u578b"},"bridge \u7c7b\u578b"),(0,r.kt)("p",null,'\u6865\u63a5\u7f51\u7edc, \u91cd\u542f\u4e0b\uff0cDocker\u7684IP\u5730\u5740\u5c31\u53d8\u4e86, \u7cfb\u7edf\u9ed8\u8ba4\u521d\u59cb\u521b\u5efa\u4e00\u4e2a\u9ed8\u8ba4\u6865\u63a5\u7f51\u7edc\u540d\u4e3a "bridge", \u4f46\u662f\u751f\u4ea7\u4e00\u822c\u81ea\u5b9a\u4e49\u4e00\u4e2a\u6865\u63a5\u7f51\u7edc(\u56e0\u4e3a\u81ea\u5b9a\u4e49\u6865\u63a5\u7f51\u7edc\u4f18\u5148\u7ea7\u9ad8\u4e8e\u9ed8\u8ba4\u6865\u63a5\u7f51\u7edc, \u4e0d\u8981\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528\u9ed8\u8ba4 bridge network)'),(0,r.kt)("p",null,"\u8fde\u63a5\u540c\u4e00\u4e2a\u81ea\u5b9a\u4e49\u6865\u63a5\u7f51\u7edc\u7684\u5bb9\u5668\u5f7c\u6b64\u66b4\u9732\u7aef\u53e3\uff0c\u800c\u4e0d\u4f1a\u5bf9\u5916\u4e16\u754c\u66b4\u9732\u7aef\u53e3, \u4f46\u662f\u5916\u754c\u82e5\u8981\u8fde\u63a5, \u9700\u8981\u4f7f\u7528 -p (host port):(container port) \u53d1\u5e03\u63a5\u53e3"),(0,r.kt)("p",null,"\u9ed8\u8ba4\u8bf7\u6c42\u7f51\u7edc and \u81ea\u5b9a\u4e49\u6865\u63a5\u7f51\u7edc \u7684\u533a\u522b:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u81ea\u5b9a\u4e49\u6865\u63a5\u7f51\u7edc\u4f18\u5148\u7ea7\u9ad8\u4e8e\u9ed8\u8ba4\u6865\u63a5\u7f51\u7edc, \u4e0d\u8981\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528\u9ed8\u8ba4 bridge network")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u9ed8\u8ba4\u6865\u63a5\u7f51\u7edc\u4e0a\u7684\u5bb9\u5668\u53ea\u80fd\u901a\u8fc7IP\u5730\u5740\u76f8\u4e92\u8bbf\u95ee\uff0c\u9664\u975e\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"--link")," \u9009\u9879\uff0c\u800c\u5728\u7528\u6237\u5b9a\u4e49\u7684\u6865\u63a5\u7f51\u7edc\u4e0a\uff0c\u5bb9\u5668\u53ef\u4ee5\u901a\u8fc7\u540d\u79f0\u6216\u522b\u540d\u5f7c\u6b64\u89e3\u6790")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5728\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\u4e2d\uff0c\u53ef\u4ee5\u52a8\u6001\u5730\u5c06\u5b83\u4e0e\u7528\u6237\u5b9a\u4e49\u7684\u7f51\u7edc\u8fde\u63a5\u6216\u65ad\u5f00\u3002\u800c\u8981\u4ece\u9ed8\u8ba4\u6865\u63a5\u7f51\u7edc\u4e2d\u5220\u9664\u5bb9\u5668\uff0c\u9700\u8981\u505c\u6b62\u5bb9\u5668\u5e76\u4f7f\u7528\u4e0d\u540c\u7684\u7f51\u7edc\u9009\u9879\u91cd\u65b0\u521b\u5efa\u5bb9\u5668\u3002"))),(0,r.kt)("h3",{id:"host-\u7c7b\u578b"},"host \u7c7b\u578b"),(0,r.kt)("p",null,"host: \u5bb9\u5668\u7684\u7f51\u7edc\u6808\u5e76\u4e0d\u662f\u548cdocker\u5bbf\u4e3b\u673a\u9694\u79bb\u7684"),(0,r.kt)("p",null,"\u5bb9\u5668\u7684\u7f51\u7edc\u4f1a\u9644\u5c5e\u5728\u4e3b\u673a\u4e0a\uff0c\u4e24\u8005\u662f\u4e92\u901a\u7684(\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u4e00\u4e2aWeb\u670d\u52a1\uff0c\u76d1\u542c8080\u7aef\u53e3\uff0c\u5219\u4e3b\u673a\u76848080\u7aef\u53e3\u5c31\u4f1a\u81ea\u52a8\u6620\u5c04\u5230\u5bb9\u5668\u4e2d)"),(0,r.kt)("h2",{id:"\u521b\u5efa\u56fa\u5b9aip"},"\u521b\u5efa\u56fa\u5b9aip"),(0,r.kt)("p",null,"\u81ea\u5df1\u521b\u5efa\u4e00\u4e2a\u65b0\u7684bridge\u7f51\u7edcbridge1\uff0c\u5728\u521b\u5efabridge1\u7684\u65f6\u5019\u540c\u65f6\u521b\u5efa\u5b50\u7f51\uff0c\u90a3\u4e48\u5728\u521b\u5efa\u5bb9\u5668\u7684\u65f6\u5019\u6307\u5b9a\u7f51\u7edc\u4e3abridge1\u5e76\u6307\u5b9aip\u5373\u53ef"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u521b\u5efa\u7f51\u7edc, \u6307\u5b9a\u7f51\u6bb5, \u9ed8\u8ba4\u662f bridge \u7c7b\u578b, \u6240\u4ee5\u53ef\u7701\u7565\n# --driver \u6216\u8005 -d \u6307\u5b9a\u7f51\u7edc\u7c7b\u578b\ndocker network create [--driver bridge] --subnet=172.18.0.0/16 my-network \n\ndocker run -itd --name my-container --network my-network --ip 172.18.0.10 my-image </bin/bash >\n        * \u7528 --network \u53c2\u6570\uff0c\u53ef\u4ee5\u6307\u5b9a\u7f51\u7edc\u7c7b\u578b\n        * --ip 172.17.0.10\u6307\u5b9aip\n")),(0,r.kt)("h2",{id:"\u67e5\u770bcontainer\u7684ip"},"\u67e5\u770bcontainer\u7684ip"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'# \u67e5\u770bdocker0\u7684\u7f51\u7edc(\u5bbf\u4e3b\u673a\u4e0a\u64cd\u4f5c)\nip a show docker0\n# \u5230\u5bb9\u5668\u5185\u90e8\u67e5\u770bip\nip a show eth0\n# or\ndocker inspect <id,container_name> | grep "IPAddress"\n')),(0,r.kt)("h2",{id:"\u5916\u90e8\u8bbf\u95ee\u5bb9\u5668"},"\u5916\u90e8\u8bbf\u95ee\u5bb9\u5668"),(0,r.kt)("p",null,"\u4e00\u4e2a\u662f\u901a\u8fc7 host \u7c7b\u578b\u7684 network (\u5bbf\u4e3b\u8fde\u5bb9\u5668)"),(0,r.kt)("p",null,"\u4e00\u4e2a \u662f \u67e5\u8be2 docker0 \u7f51\u5361\u7684\u5730\u5740 ",(0,r.kt)("inlineCode",{parentName:"p"},"ip addr show docker0")," \u4f5c\u4e3a \u5bbf\u4e3b\u5728 docker \u5c40\u57df\u7f51\u7684\u5730\u5740 (\u5bb9\u5668\u8fde\u5bbf\u4e3b),  \u5728 wsl2 \u4e0b\u7684\u7684 \u5bb9\u5668, \u5916\u90e8\u8fde\u63a5\u5bb9\u5668\u6682\u65f6\u8fd8\u9700\u8981\u4f7f\u7528 wsl \u7684ip\u5373 ",(0,r.kt)("inlineCode",{parentName:"p"},"ifconfig")," \u7684 eth0"),(0,r.kt)("p",null,"\u5bb9\u5668\u4e2d\u53ef\u4ee5\u8fd0\u884c\u4e00\u4e9b\u7f51\u7edc\u5e94\u7528\uff0c\u8981\u8ba9\u5916\u90e8\u4e5f\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e9b\u5e94\u7528\uff0c\u53ef\u4ee5\u901a\u8fc7"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"-P"),"(Docker \u4f1a\u968f\u673a\u6620\u5c04\u4e00\u4e2a 49000~49900 \u7684\u7aef\u53e3\u5230\u5185\u90e8\u5bb9\u5668\u5f00\u653e\u7684\u7f51\u7edc\u7aef\u53e3)"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"-p"),"(\u6307\u5b9a\u8981\u6620\u5c04\u7684\u7aef\u53e3\uff0c\u5e76\u4e14\uff0c\u5728\u4e00\u4e2a\u6307\u5b9a\u7aef\u53e3\u4e0a\u53ea\u53ef\u4ee5\u7ed1\u5b9a\u4e00\u4e2a\u5bb9\u5668\u3002\u652f\u6301\u7684\u683c\u5f0f\u6709 ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort"),(0,r.kt)("p",null,"eg: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u7aef\u53e3\u81ea\u52a8\u6620\u5c04, \u9700\u8981\u624b\u52a8\u67e5\u770b\u7aef\u53e3\u662f\u591a\u5c11\n$ docker run -d -P training/webapp python app.py\n\n$ docker container ls -l\nCONTAINER ID  IMAGE                   COMMAND       CREATED        STATUS        PORTS                    NAMES\nbc533791f3f5  training/webapp:latest  python app.py 5 seconds ago  Up 2 seconds  0.0.0.0:49155->5000/tcp  nostalgic_morse\n\n# \u6620\u5c04\u6240\u6709\u63a5\u53e3\u5730\u5740\n# \u4f7f\u7528 hostPort:containerPort \u683c\u5f0f\u672c\u5730\u7684 5000 \u7aef\u53e3\u6620\u5c04\u5230\u5bb9\u5668\u7684 5000 \u7aef\u53e3; \u6b64\u65f6\u9ed8\u8ba4\u4f1a\u7ed1\u5b9a\u672c\u5730\u6240\u6709\u63a5\u53e3\u4e0a\u7684\u6240\u6709\u5730\u5740\n$ docker run -d -p 5000:5000 training/webapp python app.py\n\n# -p \u53ef\u591a\u6b21\u4f7f\u7528, \u6307\u5b9a\u4e0d\u540c\u7684\u7aef\u53e3\u6620\u5c04\n$ docker run -d \\\n    -p 5000:5000 \\\n    -p 3000:80 \\\n    training/webapp \\\n    python app.py\n\n# \u6620\u5c04\u5230\u6307\u5b9a\u5730\u5740\u7684\u6307\u5b9a\u7aef\u53e3\n# \u53ef\u4ee5\u4f7f\u7528 ip:hostPort:containerPort \u683c\u5f0f\u6307\u5b9a\u6620\u5c04\u4f7f\u7528\u4e00\u4e2a\u7279\u5b9a\u5730\u5740\uff0c\u6bd4\u5982 localhost \u5730\u5740 127.0.0.1\n$ docker run -d -p 127.0.0.1:5000:5000 training/webapp python app.py\n\n# \u6620\u5c04\u5230\u6307\u5b9a\u5730\u5740\u7684\u968f\u673a\u7aef\u53e3\n# \u4f7f\u7528 ip::containerPort \u7ed1\u5b9a localhost \u7684\u4efb\u610f\u7aef\u53e3\u5230\u5bb9\u5668\u7684 5000 \u7aef\u53e3\uff0c\u672c\u5730\u4e3b\u673a\u4f1a\u81ea\u52a8\u5206\u914d\u4e00\u4e2a\u7aef\u53e3\u3002\n$ docker run -d -p 127.0.0.1::5000 training/webapp python app.py\n\n# \u8fd8\u53ef\u4ee5\u4f7f\u7528 udp \u6807\u8bb0\u6765\u6307\u5b9a udp \u7aef\u53e3, \u9ed8\u8ba4\u4e3atcp\n$ docker run -d -p 127.0.0.1:5000:5000/udp training/webapp python app.py\n")),(0,r.kt)("p",null,"\u67e5\u770b\u5f53\u524d\u6620\u5c04\u7684\u7aef\u53e3\u914d\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u67e5\u770b\u5230\u7ed1\u5b9a\u7684\u5730\u5740:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ docker port <container name> [port]\n127.0.0.1:49155\n")),(0,r.kt)("h2",{id:"\u5bb9\u5668\u4e92\u8054"},"\u5bb9\u5668\u4e92\u8054"),(0,r.kt)("p",null,"\u4e00\u4e2a\u662f\u901a\u8fc7 docker network"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"\n# \u521b\u5efa\u4e00\u4e2a\u53eb\u505a my-bridge \u7684\u7f51\u6865:     \ndocker network create -d bridge my-bridge\n# \u663e\u793a\u6240\u6709 bridge   : \ndocker network ls\n# \u521b\u5efa\u5bb9\u5668mynginx2\u5e76\u6dfb\u52a0\u5230 my-bridge \u7f51\u7edc\u4e2d: \ndocker run --name mynginx2 --network my-bridge -p 8080:80 -d nginx:latest\n# \u4f7f\u7528 inspect \u67e5\u770b:    \ndocker inspect mynginx2\n# \u67e5\u770b my-bridge \u7f51\u7edc\u91cc\u9762\u7684\u5bb9\u5668: \ndocker inspect my-bridge\n# \u624b\u52a8\u5c06\u67d0\u4e2a\u8fd0\u884c\u7740\u7684\u5bb9\u5668\u52a0\u5165\u7f51\u6865:  \ndocker network connect my-bridage test2s\n\n\n\n############  \u5b9e\u4f8b\n\n# BusyBox \n# \u662f\u4e00\u4e2a\u96c6\u6210\u4e86\u4e09\u767e\u591a\u4e2a\u6700\u5e38\u7528Linux\u547d\u4ee4\u548c\u5de5\u5177\u7684\u8f6f\u4ef6\n\n# \u521b\u5efadocker\u7f51\u7edc, \u542f\u52a8\u4e24\u4e2a\u5bb9\u5668, \u52a0\u5165\u7f51\u7edc\n$ docker network create -d bridge my-net\n$ docker run -it --rm --name busybox1 --network my-net busybox sh\n# \u9700\u8981\u6253\u5f00\u65b0\u7684terminal\n$ docker run -it --rm --name busybox2 --network my-net busybox sh\n# \u6700\u540e\u5728\u5404\u81ea\u7684terminal\u4e2dping\u6d4b\u8bd5\nping busybox2\nping busybox1\n\n\n# MySQL\n\ndocker network create -d bridge some-network\ndocker run -d --name some-mysql --network some-network -e MYSQL_ROOT_PASSWORD=my-secret-pw mysql:tag\n# \u542f\u52a8\u4e00\u4e2a\u4e34\u65f6\u7684 MySQL client\ndocker run -it --rm --network some-network mysql mysql -hsome-mysql -uexample-user -p\n")),(0,r.kt)("p",null,"\u4e00\u4e2a\u662f\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"--link"),", docker run --link\u53ef\u4ee5\u7528\u6765\u94fe\u63a52\u4e2a\u5bb9\u5668\uff0c\u4f7f\u5f97\u6e90\u5bb9\u5668\uff08\u88ab\u94fe\u63a5\u7684\u5bb9\u5668\uff09\u548c\u63a5\u6536\u5bb9\u5668\uff08\u4e3b\u52a8\u53bb\u94fe\u63a5\u7684\u5bb9\u5668\uff09\u4e4b\u95f4\u53ef\u4ee5\u4e92\u76f8\u901a\u4fe1\uff0c\u5e76\u4e14\u63a5\u6536\u5bb9\u5668\u53ef\u4ee5\u83b7\u53d6\u6e90\u5bb9\u5668\u7684\u4e00\u4e9b\u6570\u636e\uff0c\u5982\u6e90\u5bb9\u5668\u7684\u73af\u5883\u53d8\u91cf\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"#--link <container_name>:<link_name> \ndocker run -d --name node --link selenium_hub:hub selenium/node-chrome-debug\ndocker exec -it node /bin/bash\nping hub # \u53ef\u4ee5 ping \u901a\n\n")),(0,r.kt)("p",null,"\u66f4\u65b9\u4fbf\u7684\u5bb9\u5668\u4e92\u8054\u4f7f\u7528",(0,r.kt)("a",{parentName:"p",href:"#docker-compose"}," Docker Compose")),(0,r.kt)("h2",{id:"\u914d\u7f6edns-\u548c-\u4e3b\u673a\u540d-hostname"},"\u914d\u7f6edns \u548c \u4e3b\u673a\u540d hostname"),(0,r.kt)("p",null,"Docker \u5229\u7528\u865a\u62df\u6587\u4ef6\u6765\u6302\u8f7d\u5bb9\u5668\u7684 3 \u4e2a\u76f8\u5173\u914d\u7f6e\u6587\u4ef6\u3002"),(0,r.kt)("p",null,"\u5728\u5bb9\u5668\u4e2d\u4f7f\u7528 mount \u547d\u4ee4\u53ef\u4ee5\u770b\u5230\u6302\u8f7d\u4fe1\u606f:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ mount\n/dev/disk/by-uuid/1fec...ebdf on /etc/hostname type ext4 ...\n/dev/disk/by-uuid/1fec...ebdf on /etc/hosts type ext4 ...\ntmpfs on /etc/resolv.conf type tmpfs ...\n")),(0,r.kt)("p",null,"\u8fd9\u79cd\u673a\u5236\u53ef\u4ee5\u8ba9\u5bbf\u4e3b\u4e3b\u673a DNS \u4fe1\u606f\u53d1\u751f\u66f4\u65b0\u540e\uff0c\u6240\u6709 Docker \u5bb9\u5668\u7684 DNS \u914d\u7f6e\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/resolv.conf")," \u6587\u4ef6\u7acb\u523b\u5f97\u5230\u66f4\u65b0"),(0,r.kt)("p",null,"\u914d\u7f6e\u5168\u90e8\u5bb9\u5668\u7684 DNS \uff0c\u4e5f\u53ef\u4ee5\u5728",(0,r.kt)("inlineCode",{parentName:"p"}," /etc/docker/daemon.json")," \u6587\u4ef6\u4e2d\u589e\u52a0\u4ee5\u4e0b\u5185\u5bb9\u6765\u8bbe\u7f6e:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "dns" : [\n    "114.114.114.114",\n    "8.8.8.8"\n  ]\n}\n')),(0,r.kt)("p",null,"\u8fd9\u6837\u6bcf\u6b21\u542f\u52a8\u7684\u5bb9\u5668 DNS \u81ea\u52a8\u914d\u7f6e\u4e3a 114.114.114.114 \u548c 8.8.8.8\u3002\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6765\u8bc1\u660e\u5176\u5df2\u7ecf\u751f\u6548:",(0,r.kt)("inlineCode",{parentName:"p"},"docker run -it --rm ubuntu:17.10  cat etc/resolv.conf")),(0,r.kt)("p",null,"\u5982\u679c\u7528\u6237\u60f3\u8981\u624b\u52a8\u6307\u5b9a\u5bb9\u5668\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u5728\u4f7f\u7528 docker run \u547d\u4ee4\u542f\u52a8\u5bb9\u5668\u65f6\u52a0\u5165\u5982\u4e0b\u53c2\u6570\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"-h HOSTNAME")," \u6216\u8005",(0,r.kt)("inlineCode",{parentName:"p"}," --hostname=HOSTNAME")," \u8bbe\u5b9a\u5bb9\u5668\u7684\u4e3b\u673a\u540d\uff0c\u5b83\u4f1a\u88ab\u5199\u5230\u5bb9\u5668\u5185\u7684 /etc/hostname \u548c /etc/hosts\u3002\u4f46\u5b83\u5728\u5bb9\u5668\u5916\u90e8\u770b\u4e0d\u5230\uff0c\u65e2\u4e0d\u4f1a\u5728 docker container ls \u4e2d\u663e\u793a\uff0c\u4e5f\u4e0d\u4f1a\u5728\u5176\u4ed6\u7684\u5bb9\u5668\u7684 /etc/hosts \u770b\u5230\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"--dns=IP_ADDRESS")," \u6dfb\u52a0 DNS \u670d\u52a1\u5668\u5230\u5bb9\u5668\u7684 /etc/resolv.conf \u4e2d\uff0c\u8ba9\u5bb9\u5668\u7528\u8fd9\u4e2a\u670d\u52a1\u5668\u6765\u89e3\u6790\u6240\u6709\u4e0d\u5728 /etc/hosts \u4e2d\u7684\u4e3b\u673a\u540d\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"--dns-search=DOMAIN")," \u8bbe\u5b9a\u5bb9\u5668\u7684\u641c\u7d22\u57df\uff0c\u5f53\u8bbe\u5b9a\u641c\u7d22\u57df\u4e3a .example.com \u65f6\uff0c\u5728\u641c\u7d22\u4e00\u4e2a\u540d\u4e3a host \u7684\u4e3b\u673a\u65f6\uff0cDNS \u4e0d\u4ec5\u641c\u7d22 host\uff0c\u8fd8\u4f1a\u641c\u7d22 host.example.com\u3002"))),(0,r.kt)("h1",{id:"docker-compose"},"docker-compose"),(0,r.kt)("h2",{id:"compose\u7b80\u4ecb"},"compose\u7b80\u4ecb"),(0,r.kt)("p",null,"Docker Compose \u662f Docker \u5b98\u65b9\u7f16\u6392\uff08Orchestration\uff09\u9879\u76ee\u4e4b\u4e00\uff0c\u8d1f\u8d23\u5feb\u901f\u7684\u90e8\u7f72\u5206\u5e03\u5f0f\u5e94\u7528(\u5b9e\u73b0\u5bf9 Docker \u5bb9\u5668\u96c6\u7fa4\u7684\u5feb\u901f\u7f16\u6392\u3002\u4ece\u529f\u80fd\u4e0a\u770b\uff0c\u8ddf OpenStack \u4e2d\u7684 Heat \u5341\u5206\u7c7b\u4f3c; \u5176\u524d\u8eab\u662f\u5f00\u6e90\u9879\u76ee Fig;"),(0,r.kt)("p",null,"Compose \u9879\u76ee\u7531 Python \u7f16\u5199\uff0c\u5b9e\u73b0\u4e0a\u8c03\u7528\u4e86 Docker \u670d\u52a1\u63d0\u4f9b\u7684 API \u6765\u5bf9\u5bb9\u5668\u8fdb\u884c\u7ba1\u7406"),(0,r.kt)("p",null,"\u901a\u4fd7\u7684\u7406\u89e3: \u53ef\u4ee5\u540c\u65f6\u5b9a\u4e49\u548c\u8fd0\u884c\u591a\u4e2a Docker \u5bb9\u5668."),(0,r.kt)("p",null,"\u7528\u6237\u901a\u8fc7\u4e00\u4e2a\u5355\u72ec\u7684 docker-compose.yml \u6a21\u677f\u6587\u4ef6\uff08YAML \u683c\u5f0f\uff09\u6765\u5b9a\u4e49\u4e00\u7ec4\u76f8\u5173\u8054\u7684\u5e94\u7528\u5bb9\u5668\u4e3a\u4e00\u4e2a\u9879\u76ee\uff08project\uff09"),(0,r.kt)("p",null,"Compose \u4e2d\u6709\u4e24\u4e2a\u91cd\u8981\u7684\u6982\u5ff5\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u670d\u52a1 (service)\uff1a\u4e00\u4e2a\u5e94\u7528\u7684\u5bb9\u5668\uff0c\u5b9e\u9645\u4e0a\u53ef\u4ee5\u5305\u62ec\u82e5\u5e72\u8fd0\u884c\u76f8\u540c\u955c\u50cf\u7684\u5bb9\u5668\u5b9e\u4f8b\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u9879\u76ee (project)\uff1a\u7531\u4e00\u7ec4\u5173\u8054\u7684\u5e94\u7528\u5bb9\u5668\u7ec4\u6210\u7684\u4e00\u4e2a\u5b8c\u6574\u4e1a\u52a1\u5355\u5143\uff0c\u5728 docker-compose.yml \u6587\u4ef6\u4e2d\u5b9a\u4e49\u3002"))),(0,r.kt)("p",null,"Compose \u7684\u9ed8\u8ba4\u7ba1\u7406\u5bf9\u8c61\u662f\u9879\u76ee\uff0c\u901a\u8fc7\u5b50\u547d\u4ee4\u5bf9\u9879\u76ee\u4e2d\u7684\u4e00\u7ec4\u5bb9\u5668\u8fdb\u884c\u4fbf\u6377\u5730\u751f\u547d\u5468\u671f\u7ba1\u7406"),(0,r.kt)("p",null,"\u5b89\u88c5\u5378\u8f7d"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/compose/install/"},"https://docs.docker.com/compose/install/")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u901a\u8fc7 Python \u7684\u5305\u7ba1\u7406\u5de5\u5177 pip \u8fdb\u884c\u5b89\u88c5\uff0c"),(0,r.kt)("li",{parentName:"ol"},"\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4e0b\u8f7d\u7f16\u8bd1\u597d\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u4f7f\u7528 "),(0,r.kt)("li",{parentName:"ol"},"\u80fd\u591f\u76f4\u63a5\u5728 Docker \u5bb9\u5668\u4e2d\u8fd0\u884c")),(0,r.kt)("p",null,"\u524d\u4e24\u79cd\u65b9\u5f0f\u662f\u4f20\u7edf\u65b9\u5f0f\uff0c\u9002\u5408\u672c\u5730\u73af\u5883\u4e0b\u5b89\u88c5\u4f7f\u7528\uff1b\u6700\u540e\u4e00\u79cd\u65b9\u5f0f\u5219\u4e0d\u7834\u574f\u7cfb\u7edf\u73af\u5883\uff0c\u66f4\u9002\u5408\u4e91\u8ba1\u7b97\u573a\u666f; "),(0,r.kt)("p",null,"Docker for Windows \u81ea\u5e26 docker-compose \u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5b89\u88c5 Docker \u4e4b\u540e\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose --version")," \u67e5\u770b\u7248\u672c"),(0,r.kt)("p",null,"\u5982\u679c\u5b9e\u5728linux\u4e2d:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u76f4\u63a5\u4e0b\u8f7d\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u5305(\u63a8\u8350)\n$ sudo curl -L https://github.com/docker/compose/releases/download/1.17.1/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose\n$ sudo chmod +x /usr/local/bin/docker-compose\n\n# \u8fd8\u53ef\u4ee5\u4f7f\u7528pip\u5b89\u88c5\n$ sudo pip install -U docker-compose\n\n# \u547d\u4ee4\u8865\u5168\u529f\u80fd\u9700\u8981\u4e0b\u8f7d\u4e00\u4e2a\u6587\u4ef6\n$ curl -L https://raw.githubusercontent.com/docker/compose/1.8.0/contrib/completion/bash/docker-compose > /etc/bash_completion.d/docker-compose\n\n# \u5982\u4f55\u5728linux\u4e2d\u6267\u884c? \u4e0b\u8f7d\u7684run.sh\u5b9e\u9645\u662f\u4e0b\u8f7ddocker/compose \u955c\u50cf\u5e76\u8fd0\u884c\n$ curl -L https://github.com/docker/compose/releases/download/1.8.0/run.sh > /usr/local/bin/docker-compose\n$ chmod +x /usr/local/bin/docker-compose\n\n# \u6d4b\u8bd5\u662f\u5426\u5b89\u88c5\u6210\u529f, \u7b2c\u4e00\u6b21\u4f1a\u4e0b\u8f7dcompose\u955c\u50cf\ndocker-compose version\n")),(0,r.kt)("p",null,"\u5378\u8f7d:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u5982\u679c\u662f\u4e8c\u8fdb\u5236\u5305\u65b9\u5f0f\u5b89\u88c5\u7684\uff0c\u5220\u9664\u4e8c\u8fdb\u5236\u6587\u4ef6\u5373\u53ef\u3002\n$ sudo rm /usr/local/bin/docker-compose\n\n# \u5982\u679c\u662f\u901a\u8fc7 pip \u5b89\u88c5\u7684\uff0c\u5219\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\u5220\u9664\u3002\n$ sudo pip uninstall docker-compose\n")),(0,r.kt)("p",null,"\u770b\u4e00\u4e2a quick-start:"),(0,r.kt)("p",null,"eg: \u7528Python \u6765\u5efa\u7acb\u4e00\u4e2a\u80fd\u591f\u8bb0\u5f55\u9875\u9762\u8bbf\u95ee\u6b21\u6570\u7684 web \u7f51\u7ad9"),(0,r.kt)("p",null,"\u5728\u6587\u4ef6\u5939project/\u4e0b\u65b0\u5efaapp.py"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},"from flask import Flask\nfrom redis import Redis\n\napp = Flask(__name__)\nredis = Redis(host='redis', port=6379)\n\n@app.route('/')\ndef hello():\n    count = redis.incr('hits')\n    return 'Hello World! \u8be5\u9875\u9762\u5df2\u88ab\u8bbf\u95ee {} \u6b21\u3002\\n'.format(count)\n\nif __name__ == \"__main__\":\n    app.run(host=\"0.0.0.0\", debug=True)\n")),(0,r.kt)("p",null,"\u65b0\u5efa Dockerfile "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'FROM python:3.6-alpine\nADD . /code\nWORKDIR /code\nRUN pip install redis flask\nCMD ["python", "app.py"]\n')),(0,r.kt)("p",null,"\u65b0\u5efa docker-compose.yml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"# \u8fd9\u91cc\u7684\u7248\u672c\u548cdocker-compose\u6709\u5173, \u5982\u679c\u62a5\u9519, \u5219\u6539\u4e3a'2'\nversion: '3'\nservices:\n\n  web:\n    build: . # \u5728\u5f53\u524d\u76ee\u5f55\u5bfb\u627e dockerfile\u6784\u5efa\n    ports:\n     - \"5000:5000\"\n\n  redis:\n    image: \"redis:alpine\"\n")),(0,r.kt)("p",null,"\u8fd0\u884c: ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose up")),(0,r.kt)("h2",{id:"\u547d\u4ee4\u4f7f\u7528"},"\u547d\u4ee4\u4f7f\u7528"),(0,r.kt)("p",null,"\u9ed8\u8ba4\u7684\u547d\u4ee4\u5bf9\u8c61\u662f\u9879\u76ee\uff0c\u8fd9\u610f\u5473\u7740\u9879\u76ee\u4e2d\u6240\u6709\u7684\u670d\u52a1\u90fd\u4f1a\u53d7\u5230\u547d\u4ee4\u5f71\u54cd"),(0,r.kt)("p",null,"\u683c\u5f0f: ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose [-f=<arg>...] [options] [COMMAND] [ARGS...]")),(0,r.kt)("p",null,"options\u6709\u8fd9\u4e9b:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"-f, --file FILE \u6307\u5b9a\u4f7f\u7528\u7684 Compose \u6a21\u677f\u6587\u4ef6\uff0c\u9ed8\u8ba4\u4e3a docker-compose.yml\uff0c\u53ef\u4ee5\u591a\u6b21\u6307\u5b9a\u3002\n\n-p, --project-name NAME \u6307\u5b9a\u9879\u76ee\u540d\u79f0\uff0c\u9ed8\u8ba4\u5c06\u4f7f\u7528\u6240\u5728\u76ee\u5f55\u540d\u79f0\u4f5c\u4e3a\u9879\u76ee\u540d\u3002\n\n--x-networking \u4f7f\u7528 Docker \u7684\u53ef\u62d4\u63d2\u7f51\u7edc\u540e\u7aef\u7279\u6027\n\n--x-network-driver DRIVER \u6307\u5b9a\u7f51\u7edc\u540e\u7aef\u7684\u9a71\u52a8\uff0c\u9ed8\u8ba4\u4e3a bridge\n\n--verbose \u8f93\u51fa\u66f4\u591a\u8c03\u8bd5\u4fe1\u606f\u3002\n\n-v, --version \u6253\u5370\u7248\u672c\u5e76\u9000\u51fa\n")),(0,r.kt)("h3",{id:"up"},"up"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u683c\u5f0f\u4e3a docker-compose up ","[options][SERVICE...]")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u8be5\u547d\u4ee4\u5341\u5206\u5f3a\u5927\uff0c\u5b83\u5c06\u5c1d\u8bd5\u81ea\u52a8\u5b8c\u6210\u5305\u62ec \u6784\u5efa, \u542f\u52a8...")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u9ed8\u8ba4\u60c5\u51b5\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose up")," \u542f\u52a8\u7684\u5bb9\u5668\u90fd\u5728\u524d\u53f0\uff0c\u63a7\u5236\u53f0\u5c06\u4f1a\u540c\u65f6\u6253\u5370\u6240\u6709\u5bb9\u5668\u7684\u8f93\u51fa\u4fe1\u606f\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u8fdb\u884c\u8c03\u8bd5\u3002"),(0,r.kt)("p",{parentName:"li"},"  \u5f53\u901a\u8fc7 Ctrl-C \u505c\u6b62\u547d\u4ee4\u65f6\uff0c\u6240\u6709\u5bb9\u5668\u5c06\u4f1a\u505c\u6b62"),(0,r.kt)("p",{parentName:"li"},"  \u5982\u679c\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose up -d"),"\uff0c\u5c06\u4f1a\u5728\u540e\u53f0\u542f\u52a8\u5e76\u8fd0\u884c\u6240\u6709\u7684\u5bb9\u5668\u3002\u4e00\u822c\u63a8\u8350\u751f\u4ea7\u73af\u5883\u4e0b\u4f7f\u7528\u8be5\u9009\u9879")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose up --no-recreate"),"\u53ea\u4f1a\u542f\u52a8\u5904\u4e8e\u505c\u6b62\u72b6\u6001\u7684\u5bb9\u5668\uff0c\u800c\u5ffd\u7565\u5df2\u7ecf\u8fd0\u884c\u7684\u670d\u52a1"),(0,r.kt)("p",{parentName:"li"},"  \u9ed8\u8ba4\u60c5\u51b5\uff0c\u5982\u679c\u670d\u52a1\u5bb9\u5668\u5df2\u7ecf\u5b58\u5728\uff0cdocker-compose up \u5c06\u4f1a\u5c1d\u8bd5\u505c\u6b62\u5bb9\u5668\uff0c\u7136\u540e\u91cd\u65b0\u521b\u5efa")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose up --no-deps -d <SERVICE_NAME>")," \u53ea\u60f3\u91cd\u65b0\u90e8\u7f72\u67d0\u4e2a\u670d\u52a1, \u901a\u8fc7\u8fd9\u4e2a\u547d\u4ee4\u6765\u91cd\u65b0\u521b\u5efa\u670d\u52a1\u5e76\u540e\u53f0\u505c\u6b62\u65e7\u670d\u52a1\uff0c\u542f\u52a8\u65b0\u670d\u52a1\uff0c\u5e76\u4e0d\u4f1a\u5f71\u54cd\u5230\u5176\u6240\u4f9d\u8d56\u7684\u670d\u52a1"))),(0,r.kt)("p",null,"\u6240\u6709\u53ef\u7528\u7684\u9009\u9879:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"-d \u5728\u540e\u53f0\u8fd0\u884c\u670d\u52a1\u5bb9\u5668\u3002\n\n--no-color \u4e0d\u4f7f\u7528\u989c\u8272\u6765\u533a\u5206\u4e0d\u540c\u7684\u670d\u52a1\u7684\u63a7\u5236\u53f0\u8f93\u51fa\u3002\n\n--no-deps \u4e0d\u542f\u52a8\u670d\u52a1\u6240\u94fe\u63a5\u7684\u5bb9\u5668\u3002\n\n--force-recreate \u5f3a\u5236\u91cd\u65b0\u521b\u5efa\u5bb9\u5668\uff0c\u4e0d\u80fd\u4e0e --no-recreate \u540c\u65f6\u4f7f\u7528\u3002\n\n--no-recreate \u5982\u679c\u5bb9\u5668\u5df2\u7ecf\u5b58\u5728\u4e86\uff0c\u5219\u4e0d\u91cd\u65b0\u521b\u5efa\uff0c\u4e0d\u80fd\u4e0e --force-recreate \u540c\u65f6\u4f7f\u7528\u3002\n\n--no-build \u4e0d\u81ea\u52a8\u6784\u5efa\u7f3a\u5931\u7684\u670d\u52a1\u955c\u50cf\u3002\n\n-t, --timeout TIMEOUT \u505c\u6b62\u5bb9\u5668\u65f6\u5019\u7684\u8d85\u65f6\uff08\u9ed8\u8ba4\u4e3a 10 \u79d2\uff09\n\n")),(0,r.kt)("h3",{id:"run"},"run"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose run [options] [-p PORT...] [-e KEY=VAL...] SERVICE [COMMAND] [ARGS...]"),"\u3002"),(0,r.kt)("p",null,"\u5728\u6307\u5b9a\u670d\u52a1\u4e0a\u6267\u884c\u4e00\u4e2a\u547d\u4ee4\u3002"),(0,r.kt)("p",null,"eg:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u5c06\u4f1a\u542f\u52a8\u4e00\u4e2a ubuntu \u670d\u52a1\u5bb9\u5668\uff0c\u5e76\u6267\u884c ping docker.com \u547d\u4ee4\n$ docker-compose run ubuntu ping docker.com\n")),(0,r.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5b58\u5728\u5173\u8054\uff0c\u5219\u6240\u6709\u5173\u8054\u7684\u670d\u52a1\u5c06\u4f1a\u81ea\u52a8\u88ab\u542f\u52a8\uff0c\u9664\u975e\u8fd9\u4e9b\u670d\u52a1\u5df2\u7ecf\u5728\u8fd0\u884c\u4e2d"),(0,r.kt)("p",null,"\u5982\u679c\u4e0d\u5e0c\u671b\u81ea\u52a8\u542f\u52a8\u5173\u8054\u7684\u5bb9\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528 --no-deps \u9009\u9879"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u4e0d\u4f1a\u542f\u52a8 web \u5bb9\u5668\u6240\u5173\u8054\u7684\u5176\u5b83\u5bb9\u5668\n$ docker-compose run --no-deps web python manage.py shell\n")),(0,r.kt)("p",null,"\u8be5\u547d\u4ee4\u7c7b\u4f3c\u542f\u52a8\u5bb9\u5668\u540e\u8fd0\u884c\u6307\u5b9a\u7684\u547d\u4ee4\uff0c\u76f8\u5173\u5377\u3001\u94fe\u63a5\u7b49\u7b49\u90fd\u5c06\u4f1a\u6309\u7167\u914d\u7f6e\u81ea\u52a8\u521b\u5efa, \u4f46\u662f\u6709\u4e24\u4e2a\u4e0d\u540c\u70b9"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u7ed9\u5b9a\u547d\u4ee4\u5c06\u4f1a\u8986\u76d6\u539f\u6709\u7684\u81ea\u52a8\u8fd0\u884c\u547d\u4ee4"),(0,r.kt)("li",{parentName:"ol"},"\u4e0d\u4f1a\u81ea\u52a8\u521b\u5efa\u7aef\u53e3\uff0c\u4ee5\u907f\u514d\u51b2\u7a81")),(0,r.kt)("p",null,"\u6240\u6709\u53ef\u9009\u7684\u9009\u9879:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'-d \u540e\u53f0\u8fd0\u884c\u5bb9\u5668\u3002\n\n--name NAME \u4e3a\u5bb9\u5668\u6307\u5b9a\u4e00\u4e2a\u540d\u5b57\u3002\n\n--entrypoint CMD \u8986\u76d6\u9ed8\u8ba4\u7684\u5bb9\u5668\u542f\u52a8\u6307\u4ee4\u3002\n\n-e KEY=VAL \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u503c\uff0c\u53ef\u591a\u6b21\u4f7f\u7528\u9009\u9879\u6765\u8bbe\u7f6e\u591a\u4e2a\u73af\u5883\u53d8\u91cf\u3002\n\n-u, --user="" \u6307\u5b9a\u8fd0\u884c\u5bb9\u5668\u7684\u7528\u6237\u540d\u6216\u8005 uid\u3002\n\n--no-deps \u4e0d\u81ea\u52a8\u542f\u52a8\u5173\u8054\u7684\u670d\u52a1\u5bb9\u5668\u3002\n\n--rm \u8fd0\u884c\u547d\u4ee4\u540e\u81ea\u52a8\u5220\u9664\u5bb9\u5668\uff0cd \u6a21\u5f0f\u4e0b\u5c06\u5ffd\u7565\u3002\n\n-p, --publish=[] \u6620\u5c04\u5bb9\u5668\u7aef\u53e3\u5230\u672c\u5730\u4e3b\u673a\u3002\n\n--service-ports \u914d\u7f6e\u670d\u52a1\u7aef\u53e3\u5e76\u6620\u5c04\u5230\u672c\u5730\u4e3b\u673a\u3002\n\n-T \u4e0d\u5206\u914d\u4f2a tty\uff0c\u610f\u5473\u7740\u4f9d\u8d56 tty \u7684\u6307\u4ee4\u5c06\u65e0\u6cd5\u8fd0\u884c\u3002\n')),(0,r.kt)("h3",{id:"scale"},"scale"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u683c\u5f0f\u4e3a docker-compose scale ","[options][SERVICE=NUM...]","\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u8bbe\u7f6e\u6307\u5b9a\u670d\u52a1\u8fd0\u884c\u7684\u5bb9\u5668\u4e2a\u6570\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u901a\u8fc7 service=num \u7684\u53c2\u6570\u6765\u8bbe\u7f6e\u6570\u91cf\u3002\u4f8b\u5982"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"eg"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u5c06\u542f\u52a8 3 \u4e2a\u5bb9\u5668\u8fd0\u884c web \u670d\u52a1\uff0c2 \u4e2a\u5bb9\u5668\u8fd0\u884c db \u670d\u52a1\n$ docker-compose scale web=3 db=2\n"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5f53\u6307\u5b9a\u6570\u76ee\u591a\u4e8e\u8be5\u670d\u52a1\u5f53\u524d\u5b9e\u9645\u8fd0\u884c\u5bb9\u5668\uff0c\u5c06\u65b0\u521b\u5efa\u5e76\u542f\u52a8\u5bb9\u5668\uff1b\u53cd\u4e4b\uff0c\u5c06\u505c\u6b62\u5bb9\u5668"))),(0,r.kt)("p",null,"\u53ef\u7528\u9009\u9879:"),(0,r.kt)("p",null,"-t, --timeout TIMEOUT \u505c\u6b62\u5bb9\u5668\u65f6\u5019\u7684\u8d85\u65f6\uff08\u9ed8\u8ba4\u4e3a 10 \u79d2\uff09\u3002"),(0,r.kt)("h3",{id:"start"},"start"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a docker-compose start ","[SERVICE...]","\u3002"),(0,r.kt)("p",null,"\u542f\u52a8\u5df2\u7ecf\u5b58\u5728\u7684\u670d\u52a1\u5bb9\u5668"),(0,r.kt)("h3",{id:"build"},"build"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u683c\u5f0f\u4e3a docker-compose build ","[options][SERVICE...]")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6784\u5efa\uff08\u91cd\u65b0\u6784\u5efa\uff09\u9879\u76ee\u4e2d\u7684\u670d\u52a1\u5bb9\u5668")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u670d\u52a1\u5bb9\u5668\u4e00\u65e6\u6784\u5efa\u540e\uff0c\u5c06\u4f1a\u5e26\u4e0a\u4e00\u4e2a\u6807\u8bb0\u540d\uff0c\u4f8b\u5982\u5bf9\u4e8e web \u9879\u76ee\u4e2d\u7684\u4e00\u4e2a db \u5bb9\u5668\uff0c\u53ef\u80fd\u662f web_db")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u53ef\u4ee5\u968f\u65f6\u5728\u9879\u76ee\u76ee\u5f55\u4e0b\u8fd0\u884c docker-compose build \u6765\u91cd\u65b0\u6784\u5efa\u670d\u52a1"))),(0,r.kt)("p",null,"\u6240\u6709\u9009\u9879:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"--force-rm \u5220\u9664\u6784\u5efa\u8fc7\u7a0b\u4e2d\u7684\u4e34\u65f6\u5bb9\u5668\u3002\n\n--no-cache \u6784\u5efa\u955c\u50cf\u8fc7\u7a0b\u4e2d\u4e0d\u4f7f\u7528 cache\uff08\u8fd9\u5c06\u52a0\u957f\u6784\u5efa\u8fc7\u7a0b\uff09\u3002\n\n--pull \u59cb\u7ec8\u5c1d\u8bd5\u901a\u8fc7 pull \u6765\u83b7\u53d6\u66f4\u65b0\u7248\u672c\u7684\u955c\u50cf\u3002\n\n")),(0,r.kt)("h3",{id:"config"},"config"),(0,r.kt)("p",null,"\u9a8c\u8bc1 Compose \u6587\u4ef6\u683c\u5f0f\u662f\u5426\u6b63\u786e\uff0c\u82e5\u6b63\u786e\u5219\u663e\u793a\u914d\u7f6e\uff0c\u82e5\u683c\u5f0f\u9519\u8bef\u663e\u793a\u9519\u8bef\u539f\u56e0"),(0,r.kt)("h3",{id:"exec"},"exec"),(0,r.kt)("p",null,"\u8fdb\u5165\u6307\u5b9a\u7684\u5bb9\u5668"),(0,r.kt)("h3",{id:"images"},"images"),(0,r.kt)("p",null,"\u5217\u51fa Compose \u6587\u4ef6\u4e2d\u5305\u542b\u7684\u955c\u50cf\u3002"),(0,r.kt)("h3",{id:"kill"},"kill"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a docker-compose kill ","[options][SERVICE...]"),(0,r.kt)("p",null,"\u901a\u8fc7\u53d1\u9001 SIGKILL \u4fe1\u53f7\u6765\u5f3a\u5236\u505c\u6b62\u670d\u52a1\u5bb9\u5668\u3002"),(0,r.kt)("p",null,"\u652f\u6301\u901a\u8fc7 -s \u53c2\u6570\u6765\u6307\u5b9a\u53d1\u9001\u7684\u4fe1\u53f7\uff0c\u4f8b\u5982\u901a\u8fc7\u5982\u4e0b\u6307\u4ee4\u53d1\u9001 SIGINT \u4fe1\u53f7\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ docker-compose kill -s SIGINT\n")),(0,r.kt)("h3",{id:"down"},"down"),(0,r.kt)("p",null,"\u6b64\u547d\u4ee4\u5c06\u4f1a\u505c\u6b62 up \u547d\u4ee4\u6240\u542f\u52a8\u7684\u5bb9\u5668\uff0c\u5e76\u79fb\u9664\u7f51\u7edc"),(0,r.kt)("h3",{id:"pause"},"pause"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a docker-compose pause ","[SERVICE...]","\u3002"),(0,r.kt)("p",null,"\u6682\u505c\u4e00\u4e2a\u670d\u52a1\u5bb9\u5668\u3002"),(0,r.kt)("h3",{id:"unpause"},"unpause"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a docker-compose unpause ","[SERVICE...]","\u3002"),(0,r.kt)("p",null,"\u6062\u590d\u5904\u4e8e\u6682\u505c\u72b6\u6001\u4e2d\u7684\u670d\u52a1\u3002"),(0,r.kt)("h3",{id:"restart"},"restart"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a docker-compose restart ","[options][SERVICE...]","\u3002"),(0,r.kt)("p",null,"\u91cd\u542f\u9879\u76ee\u4e2d\u7684\u670d\u52a1\u3002"),(0,r.kt)("p",null,"\u9009\u9879\uff1a"),(0,r.kt)("p",null,"-t, --timeout TIMEOUT \u6307\u5b9a\u91cd\u542f\u524d\u505c\u6b62\u5bb9\u5668\u7684\u8d85\u65f6\uff08\u9ed8\u8ba4\u4e3a 10 \u79d2\uff09\u3002"),(0,r.kt)("h3",{id:"stop"},"stop"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a docker-compose stop ","[options][SERVICE...]","\u3002"),(0,r.kt)("p",null,"\u505c\u6b62\u5df2\u7ecf\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\u7684\u5bb9\u5668\uff0c\u4f46\u4e0d\u5220\u9664\u5b83\u3002\u901a\u8fc7 docker-compose start \u53ef\u4ee5\u518d\u6b21\u542f\u52a8\u8fd9\u4e9b\u5bb9\u5668\u3002"),(0,r.kt)("p",null,"\u9009\u9879\uff1a"),(0,r.kt)("p",null,"-t, --timeout TIMEOUT \u505c\u6b62\u5bb9\u5668\u65f6\u5019\u7684\u8d85\u65f6\uff08\u9ed8\u8ba4\u4e3a 10 \u79d2\uff09\u3002"),(0,r.kt)("h3",{id:"rm"},"rm"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a docker-compose rm ","[options][SERVICE...]","\u3002"),(0,r.kt)("p",null,"\u5220\u9664\u6240\u6709\uff08\u505c\u6b62\u72b6\u6001\u7684\uff09\u670d\u52a1\u5bb9\u5668\u3002\u63a8\u8350\u5148\u6267\u884c docker-compose stop \u547d\u4ee4\u6765\u505c\u6b62\u5bb9\u5668\u3002"),(0,r.kt)("p",null,"\u9009\u9879\uff1a"),(0,r.kt)("p",null,"-f, --force \u5f3a\u5236\u76f4\u63a5\u5220\u9664\uff0c\u5305\u62ec\u975e\u505c\u6b62\u72b6\u6001\u7684\u5bb9\u5668\u3002\u4e00\u822c\u5c3d\u91cf\u4e0d\u8981\u4f7f\u7528\u8be5\u9009\u9879\u3002"),(0,r.kt)("p",null,"-v \u5220\u9664\u5bb9\u5668\u6240\u6302\u8f7d\u7684\u6570\u636e\u5377\u3002"),(0,r.kt)("h3",{id:"logs"},"logs"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a docker-compose logs ","[options][SERVICE...]","\u3002"),(0,r.kt)("p",null,"\u67e5\u770b\u670d\u52a1\u5bb9\u5668\u7684\u8f93\u51fa\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cdocker-compose \u5c06\u5bf9\u4e0d\u540c\u7684\u670d\u52a1\u8f93\u51fa\u4f7f\u7528\u4e0d\u540c\u7684\u989c\u8272\u6765\u533a\u5206\u3002\u53ef\u4ee5\u901a\u8fc7 --no-color \u6765\u5173\u95ed\u989c\u8272\u3002"),(0,r.kt)("p",null,"\u8be5\u547d\u4ee4\u5728\u8c03\u8bd5\u95ee\u9898\u7684\u65f6\u5019\u5341\u5206\u6709\u7528\u3002"),(0,r.kt)("h3",{id:"top"},"top"),(0,r.kt)("p",null,"\u67e5\u770b\u5404\u4e2a\u670d\u52a1\u5bb9\u5668\u5185\u8fd0\u884c\u7684\u8fdb\u7a0b"),(0,r.kt)("h3",{id:"version"},"version"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a docker-compose version\u3002"),(0,r.kt)("p",null,"\u6253\u5370\u7248\u672c\u4fe1\u606f\u3002"),(0,r.kt)("h3",{id:"port"},"port"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a docker-compose port ","[options]"," SERVICE PRIVATE_PORT\u3002"),(0,r.kt)("p",null,"\u6253\u5370\u67d0\u4e2a\u5bb9\u5668\u7aef\u53e3\u6240\u6620\u5c04\u7684\u516c\u5171\u7aef\u53e3\u3002"),(0,r.kt)("p",null,"\u9009\u9879\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"--protocol=proto \u6307\u5b9a\u7aef\u53e3\u534f\u8bae\uff0ctcp\uff08\u9ed8\u8ba4\u503c\uff09\u6216\u8005 udp\u3002\n--index=index \u5982\u679c\u540c\u4e00\u670d\u52a1\u5b58\u5728\u591a\u4e2a\u5bb9\u5668\uff0c\u6307\u5b9a\u547d\u4ee4\u5bf9\u8c61\u5bb9\u5668\u7684\u5e8f\u53f7\uff08\u9ed8\u8ba4\u4e3a 1\uff09\u3002\n")),(0,r.kt)("h3",{id:"ps"},"ps"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a docker-compose ps ","[options][SERVICE...]","\u3002"),(0,r.kt)("p",null,"\u5217\u51fa\u9879\u76ee\u4e2d\u76ee\u524d\u7684\u6240\u6709\u5bb9\u5668\u3002"),(0,r.kt)("p",null,"\u9009\u9879\uff1a"),(0,r.kt)("p",null,"-q \u53ea\u6253\u5370\u5bb9\u5668\u7684 ID \u4fe1\u606f\u3002"),(0,r.kt)("h3",{id:"pull"},"pull"),(0,r.kt)("p",null,"\u683c\u5f0f\u4e3a docker-compose pull ","[options][SERVICE...]","\u3002"),(0,r.kt)("p",null,"\u62c9\u53d6\u670d\u52a1\u4f9d\u8d56\u7684\u955c\u50cf\u3002"),(0,r.kt)("p",null,"\u9009\u9879\uff1a"),(0,r.kt)("p",null,"--ignore-pull-failures \u5ffd\u7565\u62c9\u53d6\u955c\u50cf\u8fc7\u7a0b\u4e2d\u7684\u9519\u8bef\u3002"),(0,r.kt)("h3",{id:"push"},"push"),(0,r.kt)("p",null,"\u63a8\u9001\u670d\u52a1\u4f9d\u8d56\u7684\u955c\u50cf\u5230 Docker \u955c\u50cf\u4ed3\u5e93\u3002"),(0,r.kt)("h2",{id:"docker-composeyml"},"docker-compose.yml"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/compose/compose-file/"},"https://docs.docker.com/compose/compose-file/")," "),(0,r.kt)("p",null,"\u9ed8\u8ba4\u7684\u6a21\u677f\u6587\u4ef6\u540d\u79f0\u4e3a docker-compose.yml"),(0,r.kt)("p",null,"\u6a21\u7248\u4e2d\u7684\u547d\u4ee4\u57fa\u672c\u8ddf docker run \u4e2d\u5bf9\u5e94\u53c2\u6570\u7684\u529f\u80fd\u4e00\u81f4\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u53d8\u91cf\u540d\u79f0\u6216\u8005\u503c\u4e2d\u7528\u5230 true|false\uff0cyes|no \u7b49\u8868\u8fbe \u5e03\u5c14 \u542b\u4e49\u7684\u8bcd\u6c47\uff0c\u6700\u597d\u653e\u5230\u5f15\u53f7\u91cc, \u8fd9\u4e9b\u7b26\u53f7\u5305\u62ec:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"y|Y|yes|Yes|YES|n|N|no|No|NO|true|True|TRUE|false|False|FALSE|on|On|ON|off|Off|OFF\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'version: "3"\n\nservices:\n    webapp:\n        # \u6307\u5b9a\u4e3a\u955c\u50cf\u540d\u79f0\u6216\u955c\u50cf ID\u3002\u5982\u679c\u955c\u50cf\u5728\u672c\u5730\u4e0d\u5b58\u5728\uff0cCompose \u5c06\u4f1a\u5c1d\u8bd5\u62c9\u53d6\u8fd9\u4e2a\u955c\u50cf\n        # \u6bcf\u4e2a\u670d\u52a1\u90fd\u5fc5\u987b\u901a\u8fc7 image \u6307\u4ee4\u6307\u5b9a\u955c\u50cf\u6216 build \u6307\u4ee4\uff08\u9700\u8981 Dockerfile\uff09\u7b49\u6765\u81ea\u52a8\u6784\u5efa\u751f\u6210\u955c\u50cf\u3002\n        # \u53ef\u4ee5\u4e0d\u52a0\u5f15\u53f7\n        image: "examples/web"\n        ports:\n            - "80:80"\n        volumes:\n            - "/data"\n        # cap_add, cap_drop \u6307\u5b9a\u5bb9\u5668\u7684\u5185\u6838\u80fd\u529b\uff08capacity\uff09\u5206\u914d\n        cap_add:\n            - ALL # \u8ba9\u5bb9\u5668\u62e5\u6709\u6240\u6709\u80fd\u529b\n        cap_drop:\n            - NET_ADMIN # \u53bb\u6389 NET_ADMIN \u80fd\u529b\n        # \u8986\u76d6\u5bb9\u5668\u542f\u52a8\u540e\u9ed8\u8ba4\u6267\u884c\u7684\u547d\u4ee4\n        command: echo "hello world"\n        # \u4ec5\u7528\u4e8e Swarm mode\n        configs:\n        # \u4ec5\u7528\u4e8e Swarm mode\n        deploy:\n        # \u6307\u5b9a\u7236 cgroup \u7ec4\uff0c\u610f\u5473\u7740\u5c06\u7ee7\u627f\u8be5\u7ec4\u7684\u8d44\u6e90\u9650\u5236; \u4f8b\u5982\uff0c\u521b\u5efa\u4e86\u4e00\u4e2a cgroup \u7ec4\u540d\u79f0\u4e3a cgroups_1\n        cgroup_parent: cgroups_1\n        # \u6307\u5b9a\u5bb9\u5668\u540d\u79f0\u3002\u9ed8\u8ba4\u5c06\u4f1a\u4f7f\u7528 \u9879\u76ee\u540d\u79f0_\u670d\u52a1\u540d\u79f0_\u5e8f\u53f7 \u8fd9\u6837\u7684\u683c\u5f0f\n        # \u6ce8\u610f: \u6307\u5b9a\u5bb9\u5668\u540d\u79f0\u540e\uff0c\u8be5\u670d\u52a1\u5c06\u65e0\u6cd5\u8fdb\u884c\u6269\u5c55\uff08scale\uff09\uff0c\u56e0\u4e3a Docker \u4e0d\u5141\u8bb8\u591a\u4e2a\u5bb9\u5668\u5177\u6709\u76f8\u540c\u7684\u540d\u79f0\n        container_name: docker-web-container\n        # \u6307\u5b9a\u8bbe\u5907\u6620\u5c04\u5173\u7cfb\n        devices:\n            - "/dev/ttyUSB1:/dev/ttyUSB0"\n        # \u89e3\u51b3\u5bb9\u5668\u7684\u4f9d\u8d56\u3001\u542f\u52a8\u5148\u540e\u7684\u95ee\u9898\u3002\u4ee5\u4e0b\u4f8b\u5b50\u4e2d\u4f1a\u5148\u542f\u52a8 redis db \u518d\u542f\u52a8 webapp\n        # \u6ce8\u610f\uff1awebapp \u670d\u52a1\u4e0d\u4f1a\u7b49\u5f85 redis db \u300c\u5b8c\u5168\u542f\u52a8\u300d\u4e4b\u540e\u624d\u542f\u52a8\n        depends_on:\n            - db\n            - redis\n        # \u81ea\u5b9a\u4e49 DNS \u670d\u52a1\u5668\u3002\u53ef\u4ee5\u662f\u4e00\u4e2a\u503c\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u5217\u8868\n        # dns: 8.8.8.8\n        dns:\n            - 8.8.8.8\n            - 114.114.114.114\n        # \u914d\u7f6e DNS \u641c\u7d22\u57df\u3002\u53ef\u4ee5\u662f\u4e00\u4e2a\u503c\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u5217\u8868\n        # dns_search: example.com\n        dns_search:\n            - domain1.example.com\n            - domain2.example.com\n        # \u6302\u8f7d\u4e00\u4e2a tmpfs \u6587\u4ef6\u7cfb\u7edf\u5230\u5bb9\u5668\u3002\u53ef\u4ee5\u4e3a\u5355\u4e2a, \u4e5f\u53ef\u4ee5\u4e3a\u5217\u8868\n        # tmpfs: /run\n        tmpfs:\n            - /run\n            - /tmp\n        # \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u6570\u7ec4\u6216\u5b57\u5178\u4e24\u79cd\u683c\u5f0f\n        # \u53ea\u7ed9\u5b9a\u540d\u79f0\u7684\u53d8\u91cf\u4f1a\u81ea\u52a8\u83b7\u53d6\u8fd0\u884c Compose \u4e3b\u673a\u4e0a\u5bf9\u5e94\u53d8\u91cf\u7684\u503c\uff0c\u53ef\u4ee5\u7528\u6765\u9632\u6b62\u6cc4\u9732\u4e0d\u5fc5\u8981\u7684\u6570\u636e\u3002\n        # environment:\n        #     RACK_ENV: development\n        #     SESSION_SECRET:\n        environment:\n            - RACK_ENV=development\n            - SESSION_SECRET\n        # \u4ece\u6587\u4ef6\u4e2d\u83b7\u53d6\u73af\u5883\u53d8\u91cf\uff0c\u53ef\u4ee5\u4e3a\u5355\u72ec\u7684\u6587\u4ef6\u8def\u5f84\u6216\u5217\u8868\n        # \u5982\u679c\u901a\u8fc7 docker-compose -f FILE \u65b9\u5f0f\u6765\u6307\u5b9a Compose \u6a21\u677f\u6587\u4ef6\uff0c\u5219 env_file \u4e2d\u53d8\u91cf\u7684\u8def\u5f84\u4f1a\u57fa\u4e8e\u6a21\u677f\u6587\u4ef6\u8def\u5f84\n        # \u5982\u679c\u6709\u53d8\u91cf\u540d\u79f0\u4e0e environment \u6307\u4ee4\u51b2\u7a81\uff0c\u5219\u6309\u7167\u60ef\u4f8b\uff0c\u4ee5\u540e\u8005\u4e3a\u51c6\n        # \u73af\u5883\u53d8\u91cf\u6587\u4ef6\u4e2d\u6bcf\u4e00\u884c\u5fc5\u987b\u7b26\u5408\u683c\u5f0f(PROG_ENV=development)\uff0c\u652f\u6301 # \u5f00\u5934\u7684\u6ce8\u91ca\u884c\n        # env_file: .env\n        env_file:\n            - ./common.env\n            - ./apps/web.env\n            - /opt/secrets.env\n        # \u66b4\u9732\u7aef\u53e3\uff0c\u4f46\u4e0d\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\uff0c\u53ea\u8ba9\u5185\u90e8\u7684\u670d\u52a1\u8bbf\u95ee\n        expose:\n            - "3000"\n            - "8000"\n        # \u66b4\u9732\u7aef\u53e3\u4fe1\u606f\u3002\n        # \u4f7f\u7528\u5bbf\u4e3b\u7aef\u53e3\uff1a\u5bb9\u5668\u7aef\u53e3 (HOST:CONTAINER) \u683c\u5f0f\uff0c\u6216\u8005\u4ec5\u4ec5\u6307\u5b9a\u5bb9\u5668\u7684\u7aef\u53e3\uff08\u5bbf\u4e3b\u5c06\u4f1a\u968f\u673a\u9009\u62e9\u7aef\u53e3\uff09\u90fd\u53ef\u4ee5\u3002\n        ports:\n            - "3000"\n            - "8000:8000"\n            - "49100:22"\n            - "127.0.0.1:8001:8001"\n        # \u94fe\u63a5\u5230 docker-compose.yml \u5916\u90e8\u7684\u5bb9\u5668\uff0c\u751a\u81f3\u5e76\u975e Compose \u7ba1\u7406\u7684\u5916\u90e8\u5bb9\u5668\u3002\u4e0d\u5efa\u8bae\u4f7f\u7528\n        external_links:\n            - redis_1\n            - project_db_1:mysql\n            - project_db_1:postgresql\n        # \u7c7b\u4f3c Docker \u4e2d\u7684 --add-host \u53c2\u6570\uff0c\u6307\u5b9a\u989d\u5916\u7684 host \u540d\u79f0\u6620\u5c04\u4fe1\u606f\n        # \u4f1a\u5728\u542f\u52a8\u540e\u7684\u670d\u52a1\u5bb9\u5668\u4e2d /etc/hosts \u6587\u4ef6\u4e2d\u6dfb\u52a0host\u6620\u5c04\u6761\u76ee8.8.8.8 googledns\u548c52.1.157.61 dockerhub\n        extra_hosts:\n            - "googledns:8.8.8.8"\n            - "dockerhub:52.1.157.61"\n        # \u901a\u8fc7\u547d\u4ee4\u68c0\u67e5\u5bb9\u5668\u662f\u5426\u5065\u5eb7\u8fd0\u884c\u3002\n        healthcheck:\n            test: ["CMD", "curl", "-f", "http://localhost"]\n            interval: 1m30s\n            timeout: 10s\n            retries: 3\n        # \u4e3a\u5bb9\u5668\u6dfb\u52a0 Docker \u5143\u6570\u636e\uff08metadata\uff09\u4fe1\u606f\u3002\u4f8b\u5982\u53ef\u4ee5\u4e3a\u5bb9\u5668\u6dfb\u52a0\u8f85\u52a9\u8bf4\u660e\u4fe1\u606f\n        labels:\n            com.startupteam.description: "webapp for a startup team"\n            com.startupteam.department: "devops department"\n            com.startupteam.release: "rc3 for v1.0"\n        # \u914d\u7f6e\u65e5\u5fd7\u9009\u9879\u3002\n        logging:\n            driver: syslog # \u652f\u6301\u4e09\u79cd\u65e5\u5fd7\u9a71\u52a8\u7c7b\u578b: "json-file", "syslog", "none"\n            # \u914d\u7f6e\u65e5\u5fd7\u9a71\u52a8\u7684\u76f8\u5173\u53c2\u6570\n            options:\n                syslog-address: "tcp://192.168.0.42:123"\n        # \u8bbe\u7f6e\u7f51\u7edc\u6a21\u5f0f\u3002\u4f7f\u7528\u548c docker run \u7684 --network \u53c2\u6570\u4e00\u6837\u7684\u503c\n        network_mode: "bridge" # \u652f\u6301"bridge", "host", "none", "service:[service name]", "container:[container name/id]"\n        # \u8ddf\u4e3b\u673a\u7cfb\u7edf\u5171\u4eab\u8fdb\u7a0b\u547d\u540d\u7a7a\u95f4\u3002\u6253\u5f00\u8be5\u9009\u9879\u7684\u5bb9\u5668\u4e4b\u95f4\uff0c\u4ee5\u53ca\u5bb9\u5668\u548c\u5bbf\u4e3b\u673a\u7cfb\u7edf\u4e4b\u95f4\u53ef\u4ee5\u901a\u8fc7\u8fdb\u7a0b ID \u6765\u76f8\u4e92\u8bbf\u95ee\u548c\u64cd\u4f5c\u3002\n        pid: "host"\n        # \u6307\u5b9a\u5bb9\u5668\u6a21\u677f\u6807\u7b7e\uff08label\uff09\u673a\u5236\u7684\u9ed8\u8ba4\u5c5e\u6027\uff08\u7528\u6237\u3001\u89d2\u8272\u3001\u7c7b\u578b\u3001\u7ea7\u522b\u7b49\uff09\u3002\u4f8b\u5982\u914d\u7f6e\u6807\u7b7e\u7684\u7528\u6237\u540d\u548c\u89d2\u8272\u540d\n        security_opt:\n            - label:user:USER\n            - label:role:ROLE\n        # \u8bbe\u7f6e\u53e6\u4e00\u4e2a\u4fe1\u53f7\u6765\u505c\u6b62\u5bb9\u5668\u3002\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f7f\u7528\u7684\u662f SIGTERM \u505c\u6b62\u5bb9\u5668\n        stop_signal: SIGUSR1\n        # \u914d\u7f6e\u5bb9\u5668\u5185\u6838\u53c2\u6570, \u4e24\u79cd\u65b9\u5f0f\n        # sysctls:\n        #     net.core.somaxconn: 1024\n        #     net.ipv4.tcp_syncookies: 0\n        sysctls:\n            - net.core.somaxconn=1024\n            - net.ipv4.tcp_syncookies=0\n        # \u6307\u5b9a\u5bb9\u5668\u7684 ulimits \u9650\u5236\u503c\n        # \u4f8b\u5982\uff0c\u6307\u5b9a\u6700\u5927\u8fdb\u7a0b\u6570\u4e3a 65535\uff0c\u6307\u5b9a\u6587\u4ef6\u53e5\u67c4\u6570\u4e3a 20000\uff08\u8f6f\u9650\u5236\uff0c\u5e94\u7528\u53ef\u4ee5\u968f\u65f6\u4fee\u6539\uff0c\u4e0d\u80fd\u8d85\u8fc7\u786c\u9650\u5236\uff09 \u548c 40000\uff08\u7cfb\u7edf\u786c\u9650\u5236\uff0c\u53ea\u80fd root \u7528\u6237\u63d0\u9ad8\uff09\u3002\n        ulimits:\n            nproc: 65535\n            nofile:\n                soft: 20000\n                hard: 40000\n        # \u6570\u636e\u5377\u6240\u6302\u8f7d\u8def\u5f84\u8bbe\u7f6e\u3002\u53ef\u4ee5\u8bbe\u7f6e\u5bbf\u4e3b\u673a\u8def\u5f84 \uff08HOST:CONTAINER\uff09 \u6216\u52a0\u4e0a\u8bbf\u95ee\u6a21\u5f0f \uff08HOST:CONTAINER:ro\uff09\u3002\n        volumes:\n            - /var/lib/mysql\n            - cache/:/tmp/cache\n            - ~/configs:/etc/configs/:ro\n\n    db:\n        # \u5982\u679c\u4f7f\u7528 build \u6307\u4ee4\uff0c\u5728 Dockerfile \u4e2d\u8bbe\u7f6e\u7684\u9009\u9879(\u4f8b\u5982\uff1aCMD, EXPOSE, VOLUME, ENV \u7b49) \u5c06\u4f1a\u81ea\u52a8\u88ab\u83b7\u53d6\uff0c\u65e0\u9700\u5728 docker-compose.yml \u4e2d\u518d\u6b21\u8bbe\u7f6e\u3002\n        # \u6307\u5b9a Dockerfile \u6240\u5728\u6587\u4ef6\u5939\u7684\u8def\u5f84\uff08\u53ef\u4ee5\u662f\u7edd\u5bf9\u8def\u5f84\uff0c\u6216\u8005\u76f8\u5bf9 docker-compose.yml \u6587\u4ef6\u7684\u8def\u5f84\uff09\n        build: ./dir\n        # \u914d\u7f6e\u5bb9\u5668\u8fde\u63a5\u7684\u7f51\u7edc\u3002\u6ce8\u610f\u8fd9\u91cc\u662f\u5f15\u7528\u548cservices\u540c\u7ea7\u7684networks\u4e0b\u7684\u9879\n        networks:\n            - some-network\n            - other-network\n        # \u5b58\u50a8\u654f\u611f\u6570\u636e\uff0c\u4f8b\u5982 mysql \u670d\u52a1\u5bc6\u7801, \u6ce8\u610f\u8fd9\u91cc\u662f\u5f15\u7528\n        secrets:\n            - db_root_password\n            - my_other_secret\n    # \u53e6\u4e00\u79cd\u6307\u5b9aDockerfile\u7684\u65b9\u5f0f, \u81ea\u7531\u5ea6\u66f4\u9ad8\n    redis:\n        build:\n            context: ./dir # Dockerfile\u6240\u5728\u6587\u4ef6\u5939\n            dockerfile: Dockerfile-alternate # Dockerfile \u6587\u4ef6\u540d\n            # \u6307\u5b9a\u6784\u5efa\u955c\u50cf\u65f6\u7684\u53d8\u91cf\n            args:\n                buildno: 1\n            cache_from: # \u6307\u5b9a\u6784\u5efa\u955c\u50cf\u7684\u7f13\u5b58\n                - alpine:latest\n                - corp/web_app:3.14\nnetworks:\n  some-network:\n  other-network:\nsecrets:\n  my_secret:\n    file: ./my_secret.txt\n  my_other_secret:\n    external: true\n')),(0,r.kt)("p",null,"Compose \u6a21\u677f\u6587\u4ef6\u652f\u6301\u52a8\u6001\u8bfb\u53d6\u4e3b\u673a\u7684\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u548c\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 .env \u6587\u4ef6\u4e2d\u7684\u53d8\u91cf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'version: "3"\nservices:\n\n    db:\n    # \u5982\u679c\u6267\u884c MONGO_VERSION=3.2 docker-compose up \u5219\u4f1a\u542f\u52a8\u4e00\u4e2a mongo:3.2 \u955c\u50cf\u7684\u5bb9\u5668\uff1b\u5982\u679c\u6267\u884c MONGO_VERSION=2.8 docker-compose up \u5219\u4f1a\u542f\u52a8\u4e00\u4e2a mongo:2.8 \u955c\u50cf\u7684\u5bb9\u5668\n    image: "mongo:${MONGO_VERSION}"\n')),(0,r.kt)("p",null,"\u82e5\u5f53\u524d\u76ee\u5f55\u5b58\u5728 .env \u6587\u4ef6\uff0c\u6267\u884c docker-compose \u547d\u4ee4\u65f6\u5c06\u4ece\u8be5\u6587\u4ef6\u4e2d\u8bfb\u53d6\u53d8\u91cf"),(0,r.kt)("p",null,"\u5728\u5f53\u524d\u76ee\u5f55\u65b0\u5efa .env \u6587\u4ef6\u5e76\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-props"},"# \u652f\u6301 # \u53f7\u6ce8\u91ca\nMONGO_VERSION=3.6\n")),(0,r.kt)("p",null,"\u6267\u884c docker-compose up \u5219\u4f1a\u542f\u52a8\u4e00\u4e2a mongo:3.6 \u955c\u50cf\u7684\u5bb9\u5668"),(0,r.kt)("p",null,"docker-compose.yml\u6a21\u7248\u6587\u4ef6\u4e2d\u7684\u5176\u4ed6\u6307\u4ee4:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'\u6307\u5b9a\u670d\u52a1\u5bb9\u5668\u542f\u52a8\u540e\u6267\u884c\u7684\u5165\u53e3\u6587\u4ef6\u3002\n\nentrypoint: /code/entrypoint.sh\n\u6307\u5b9a\u5bb9\u5668\u4e2d\u8fd0\u884c\u5e94\u7528\u7684\u7528\u6237\u540d\u3002\n\nuser: nginx\n\u6307\u5b9a\u5bb9\u5668\u4e2d\u5de5\u4f5c\u76ee\u5f55\u3002\n\nworking_dir: /code\n\u6307\u5b9a\u5bb9\u5668\u4e2d\u641c\u7d22\u57df\u540d\u3001\u4e3b\u673a\u540d\u3001mac \u5730\u5740\u7b49\u3002\n\ndomainname: your_website.com\nhostname: test\nmac_address: 08-00-27-00-0C-0A\n\u5141\u8bb8\u5bb9\u5668\u4e2d\u8fd0\u884c\u4e00\u4e9b\u7279\u6743\u547d\u4ee4\u3002\n\n# \u5141\u8bb8container\u5185\u7684root\u62e5\u6709\u771f\u6b63\u7684root\u6743\u9650, \u53ef\u4ee5\u770b\u5230\u5f88\u591ahost\u4e0a\u7684\u8bbe\u5907\uff0c\u5e76\u4e14\u53ef\u4ee5\u6267\u884cmount\u3002\u751a\u81f3\u5141\u8bb8\u4f60\u5728docker\u5bb9\u5668\u4e2d\u542f\u52a8docker\u5bb9\u5668\u3002\nprivileged: true\n\n#\u6307\u5b9a\u5bb9\u5668\u9000\u51fa\u540e\u7684\u91cd\u542f\u7b56\u7565\u4e3a\u59cb\u7ec8\u91cd\u542f\u3002\u8be5\u547d\u4ee4\u5bf9\u4fdd\u6301\u670d\u52a1\u59cb\u7ec8\u8fd0\u884c\u5341\u5206\u6709\u6548\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u63a8\u8350\u914d\u7f6e\u4e3a always \u6216\u8005 unless-stopped\u3002\n# \u547d\u4ee4\u884c\u4e2d --restart always, \u91cd\u542f\u7b56\u7565\u662f\u9762\u5411\u751f\u4ea7\u73af\u5883\u7684\u4e00\u4e2a\u542f\u52a8\u7b56\u7565\uff0c\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u5ffd\u7565\n# \u5171\u6709\u5982\u4e0b\u7b56\u7565:\n# no\uff0c\u9ed8\u8ba4\u7b56\u7565\uff0c\u5728\u5bb9\u5668\u9000\u51fa\u65f6\u4e0d\u91cd\u542f\u5bb9\u5668\n# on-failure\uff0c\u5728\u5bb9\u5668\u975e\u6b63\u5e38\u9000\u51fa\u65f6\uff08\u9000\u51fa\u72b6\u6001\u975e0\uff09\uff0c\u624d\u4f1a\u91cd\u542f\u5bb9\u5668\n# on-failure:3\uff0c\u5728\u5bb9\u5668\u975e\u6b63\u5e38\u9000\u51fa\u65f6\u91cd\u542f\u5bb9\u5668\uff0c\u6700\u591a\u91cd\u542f3\u6b21, \u53ef\u81ea\u5df1\u6307\u5b9a\n# always\uff0c\u5728\u5bb9\u5668\u9000\u51fa\u65f6\u603b\u662f\u91cd\u542f\u5bb9\u5668\n# unless-stopped\uff0c\u5728\u5bb9\u5668\u9000\u51fa\u65f6\u603b\u662f\u91cd\u542f\u5bb9\u5668\uff0c\u4f46\u662f\u4e0d\u8003\u8651\u5728Docker\u5b88\u62a4\u8fdb\u7a0b\u542f\u52a8\u65f6\u5c31\u5df2\u7ecf\u505c\u6b62\u4e86\u7684\u5bb9\u5668\n# \u67e5\u770b\u5bb9\u5668\u91cd\u542f\u6b21\u6570 docker inspect -f "{{ .RestartCount }}" ba-208\n# \u67e5\u770b\u5bb9\u5668\u6700\u540e\u4e00\u6b21\u7684\u542f\u52a8\u65f6\u95f4 docker inspect -f "{{ .State.StartedAt }}" ba-208\nrestart: always\n\n# \u4ee5\u53ea\u8bfb\u6a21\u5f0f\u6302\u8f7d\u5bb9\u5668\u7684 root \u6587\u4ef6\u7cfb\u7edf\uff0c\u610f\u5473\u7740\u4e0d\u80fd\u5bf9\u5bb9\u5668\u5185\u5bb9\u8fdb\u884c\u4fee\u6539\u3002\nread_only: true\n\u6253\u5f00\u6807\u51c6\u8f93\u5165\uff0c\u53ef\u4ee5\u63a5\u53d7\u5916\u90e8\u8f93\u5165\u3002\n\nstdin_open: true\n\u6a21\u62df\u4e00\u4e2a\u4f2a\u7ec8\u7aef\u3002\n\ntty: true\n')),(0,r.kt)("h1",{id:"docker-machine"},"docker-machine"),(0,r.kt)("p",null,"Docker Machine \u662f Docker \u5b98\u65b9\u7f16\u6392\uff08Orchestration\uff09\u9879\u76ee\u4e4b\u4e00\uff0c\u8d1f\u8d23\u5728\u591a\u79cd\u5e73\u53f0\u4e0a\u5feb\u901f\u5b89\u88c5 Docker \u73af\u5883, \u5305\u62ec\u865a\u62df\u673a\u3001\u672c\u5730\u4e3b\u673a\u548c\u4e91\u5e73\u53f0"),(0,r.kt)("p",null,"linux\u4e0a\u5b89\u88c5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ sudo curl -L https://github.com/docker/machine/releases/download/v0.13.0/docker-machine-`uname -s`-`uname -m` > /usr/local/bin/docker-machine\n$ sudo chmod +x /usr/local/bin/docker-machine\n\n`docker-machine -v` # \u67e5\u770b\u7248\u672c\n")),(0,r.kt)("p",null,"\u4f7f\u7528virtualbox\u9a71\u52a8\u521b\u5efa\u672c\u5730\u4e3b\u673a\u5b9e\u4f8b:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker-machine create -d virtualbox test")),(0,r.kt)("h1",{id:"docker-swarmswarm-mode"},"docker-swarm,swarm-mode"),(0,r.kt)("p",null,"Docker Swarm \u662f Docker \u5b98\u65b9\u4e09\u5251\u5ba2\u9879\u76ee\u4e4b\u4e00\uff0c\u63d0\u4f9b Docker \u5bb9\u5668\u96c6\u7fa4\u670d\u52a1\uff0c\u662f Docker \u5b98\u65b9\u5bf9\u5bb9\u5668\u4e91\u751f\u6001\u8fdb\u884c\u652f\u6301\u7684\u6838\u5fc3\u65b9\u6848; \u4f7f\u7528\u5b83\uff0c\u7528\u6237\u53ef\u4ee5\u5c06\u591a\u4e2a Docker \u4e3b\u673a\u5c01\u88c5\u4e3a\u5355\u4e2a\u5927\u578b\u7684\u865a\u62df Docker \u4e3b\u673a\uff0c\u5feb\u901f\u6253\u9020\u4e00\u5957\u5bb9\u5668\u4e91\u5e73\u53f0;Docker 1.12.0+ Swarm mode \u5df2\u7ecf\u5185\u5d4c\u5165 Docker \u5f15\u64ce\uff0c\u6210\u4e3a\u4e86 docker \u5b50\u547d\u4ee4 docker swarm, \u56e0\u6b64\u4e00\u822c\u4f7f\u7528docker\u7684swarm mode"),(0,r.kt)("h1",{id:"docker\u5b9e\u8df5"},"docker\u5b9e\u8df5"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/wenshunbiao/docker"},"https://github.com/wenshunbiao/docker")),(0,r.kt)("h2",{id:"\u642d\u5efa\u6301\u7eed\u96c6\u6210\u7cfb\u7edf"},"\u642d\u5efa\u6301\u7eed\u96c6\u6210\u7cfb\u7edf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'# \u67e5\u770b\u7aef\u53e3\u5360\u7528\nlsof -i:8080\n# \u67e5\u770b\u6307\u5b9a\u7aef\u53e3\u7684\u8fdb\u7a0b\nnetstat -tunlp | grep 8000\n\n\n# \u642d\u5efa jenkins\n\n# \u521d\u59cb\u5bc6\u7801\u5230jenkins\u5185\u90e8[/var/jenkins_home/secrets/initialAdminPassword]\u770b\n# -u 0 \u8868\u793a\u8986\u76d6\u955c\u50cf\u5185\u90e8\u7684\u5e10\u53f7, \u4f7f\u7528\u5916\u90e8\u7684root, \u7528\u4e8e\u89e3\u51b3volume\u6743\u9650\u95ee\u9898\n# -v xxx:yyy \u8868\u793a volume:container\u4e2d\u7684\u76ee\u5f55\ndocker run -d -p 8090:8080 -p 50000:50000 -v /srv/docker/jenkins:/var/jenkins_home --name jenkins -u 0 jenkins\n\n# \u6216\u8005 \u4f7f\u7528docker-compose\u7f16\u6392\n# docker-compose.yml:(http://www.voidcn.com/article/p-keekrhyk-brk.html)\nversion: \'2\'\n\nservices:\n  gitlab:\n      image: gitlab/gitlab-ce:latest\n      ports:\n          - "20443:443"\n          - "20080:80"\n          - "20022:22"\n      networks:\n          - devops\n      volumes:\n          - /data/gitlab/config:/etc/gitlab\n          - /data/gitlab/logs:/var/log/gitlab\n          - /data/gitlab/data:/var/opt/gitlab\n\n  jenkins:\n      image: jenkins:latest\n      ports:\n          - "28080:8080"\n          - "50000:50000"\n      networks:\n          - devops\n      volumes:\n          - /data/jenkins:/var/jenkins_home\n          - /var/run/docker.sock:/var/run/docker.sock\n\n  sonarqube:\n      image: sonarqube:latest\n      ports:\n          - "29000:9000"\n          - "29092:9092"\n      networks:\n          - devops\n\nnetworks:\n  devops:\n    driver: bridge\n')),(0,r.kt)("p",null,"\u642d\u5efagitlab, \u4e0a\u4f20\u4ee3\u7801\u65f6\u5019, ",(0,r.kt)("inlineCode",{parentName:"p"},"git remote add origin http://43.254.2.51:20080/root/rest-api-starter.git"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"git push --set-upstream origin master")),(0,r.kt)("p",null,"\u81ea\u52a8\u90e8\u7f72\u9700\u8981jenkins\u7684\u63d2\u4ef6 Publish over SSH;"),(0,r.kt)("h2",{id:"docker\u548cspringboot"},"docker\u548cspringboot"),(0,r.kt)("p",null,"\u8001\u5916\u7684\u4e00\u7bc7\u535a\u6587: ",(0,r.kt)("a",{parentName:"p",href:"https://www.callicoder.com/spring-boot-docker-example/"},"https://www.callicoder.com/spring-boot-docker-example/"),", \u5148\u6ca1\u6709\u4f7f\u7528maven\u5de5\u5177, \u7136\u540e\u5f15\u5165maven\u63d2\u4ef6, \u4e24\u79cd\u5b9e\u73b0"),(0,r.kt)("p",null,"\u4f7f\u7528\u4e86 maven \u63d2\u4ef6: ",(0,r.kt)("a",{parentName:"p",href:"http://www.ityouknow.com/springboot/2018/03/19/spring-boot-docker.html"},"http://www.ityouknow.com/springboot/2018/03/19/spring-boot-docker.html")),(0,r.kt)("h2",{id:"oracle11g"},"oracle11g"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/qq_33982232/article/details/83133870"},"https://blog.csdn.net/qq_33982232/article/details/83133870"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://www.35youth.cn/685.html"},"https://www.35youth.cn/685.html")," (",(0,r.kt)("a",{parentName:"p",href:"https://registry.hub.docker.com/r/jaspeen/oracle-11g"},"https://registry.hub.docker.com/r/jaspeen/oracle-11g"),")"),(0,r.kt)("h2",{id:"\u4f7f\u7528-mysql-\u955c\u50cf"},"\u4f7f\u7528 mysql \u955c\u50cf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker pull mysql\ndocker run -d -p 3306:3306 --name mysql_xy -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=a4flocal mysql\nmysql -h127.0.0.1 -uroot -p # password is 'hello'\n\n# \u82e5 local \u6ca1\u6709\u5b89\u88c5 MySQL client, \u5219\u4f7f\u7528 container client\ndocker network create my-net\ndocker network connect my-net my-mysql\ndocker run -it --network my-net --rm mysql mysql -hmy-mysql -uroot -p\n\n# or\ndocker run -it --rm --link my-mysql:xxxhost mysql mysql -hxxxhost -uroot -p \n\n\n# \u5916\u90e8\u5b58\u50a8 volume\n# https://www.cnblogs.com/sablier/p/11605606.html\n# mysql8 (\u624b\u52a8\u6572\u5165, \u4e0d\u8981\u590d\u5236\u7c98\u8d34, \u5bb9\u6613\u51fa\u975e\u6cd5\u5b57\u7b26)\ndocker run -d --name mysql8 -p 3306:3306 -v /root/mysql/conf:/etc/mysql -v /root/mysql/logs:/var/log/mysql -v /root/mysql/data:/var/lib/mysql -v /root/mysql/mysql-files:/var/lib/mysql-files/\u3000-e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=face mysql:latest --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci # utf8mb4_unicode_ci \u53ef\u4ee5\u8003\u8651\u66ff\u6362\u4e3a \u66f4\u5feb\u7684 utf8mb4_general_ci\n\n# mysql5.7\ndocker run -d --name mysql5_7 -p 3306:3306 -v /root/mysql/conf:/etc/mysql -v /root/mysql/logs:/var/log/mysql -v /root/mysql/data:/var/lib/mysql\u3000-e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=face mysql:5.7.34 --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci\n\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.jianshu.com/p/530d00f97cbf"},"mysql\u5bb9\u5668\u7684\u6570\u636e\u6301\u4e45\u5316\u95ee\u9898")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://zhuanlan.zhihu.com/p/26129750"},"\u5bfc\u5165\u5bfc\u51fa")),(0,r.kt)("p",null,"\u5728\u5bbf\u4e3b\u673a\u4e0a\u8fde\u63a5 MySQL \u5bb9\u5668, \u5730\u5740\u662f 127.0.0.1:3306 , \u800c\u4e0d\u662f localhost, (\u67e5container ip\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"cat /etc/hosts"),")"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"}," Authentication plugin 'caching_sha2_password' cannot be loaded")," \u5f02\u5e38 - ",(0,r.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/chuancheng/p/8964385.html"},"https://www.cnblogs.com/chuancheng/p/8964385.html")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Access denied for user 'root'@'172.19.0.1'")," \u5f02\u5e38 - \u8fdb\u5165dockers\u5185\u90e8 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker exec -it <xxx> bash"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"mysql -uroot -p")," \u767b\u9646MySQL, ",(0,r.kt)("inlineCode",{parentName:"p"},"update mysql.user set host = '%' where user = 'root';")," \u4fee\u6539root\u7528\u6237\u5141\u8bb8\u6240\u6709ip\u8bbf\u95ee, \u9ed8\u8ba4\u53ea\u80fdlocalhost\u8bbf\u95ee; \u5982\u679c\u8fd8\u4e0d\u884c ",(0,r.kt)("inlineCode",{parentName:"p"},"ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'root'; flush privileges;")," \u4fee\u6539root\u7528\u6237\u7684\u6743\u9650 (",(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/iw1210/article/details/54646093"},"https://blog.csdn.net/iw1210/article/details/54646093"),")"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'version: "3.2"\nservices: \n  mysql:\n    image: mysql\n    ports: \n      - 3306:3306\n    environment:\n        # \u6821\u6b63\u65f6\u533a\n      - TZ=Asia/Shanghai\n    # \u8bbe\u7f6e\u7f16\u7801\n    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci\n    # \u6570\u636e\u5377\n    volumes: \n      - ./data:/var/lib/mysql\n    # root \u7684\u5bc6\u7801, \u4e0d\u8fc7\u8c8c\u4f3c\u6ca1\u6709\u751f\u6548 \u4e0d\u8981\u7d27 \u624b\u52a8\u8bbe\u7f6e\u4e5f\u53ef\n    environment: \n      - MYSQL_ROOT_PASSWORD=root\n\n')),(0,r.kt)("p",null,"root, root \u767b\u9646"),(0,r.kt)("h2",{id:"\u4f7f\u7528postgres\u955c\u50cf"},"\u4f7f\u7528postgres\u955c\u50cf"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker run -d --name Postgres -p 5432:5432 -e POSTGRES_USER=dev -e POSTGRES_PASSWORD=dev123 postgres")),(0,r.kt)("p",null,"or"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'version: "3"\nservices:\n  postgresdb:\n    image: postgres\n    volumes: \n      #- ./data:/var/lib/postgresql/data # \u6302\u8f7d\u672c\u5730\u76ee\u5f55\n      # \u4f7f\u7528\u6570\u636e\u5377\n      - pgdata:/var/lib/postgresql/data # data volume\n    ports:\n      - 5432:5432\n# data volume \u9700\u8981\u5728\u8fd9\u91cc\u58f0\u660e\n# \nvolumes: \n  pgdata:\n\n')),(0,r.kt)("p",null,'\u53ef\u80fd\u9519\u8bef: data directory "/var/lib/postgresql/data" has wrong ownership'),(0,r.kt)("p",null,"ref: ",(0,r.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/49148754/docker-container-shuts-down-giving-data-directory-has-wrong-ownership-error-wh"},"https://stackoverflow.com/questions/49148754/docker-container-shuts-down-giving-data-directory-has-wrong-ownership-error-wh")),(0,r.kt)("h2",{id:"\u4f7f\u7528-rabbitmq\u955c\u50cf"},"\u4f7f\u7528 rabbitmq\u955c\u50cf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'version: "3"\nservices:\n  rabbitmq:\n    image: rabbitmq:management\n    ports:\n      - "5672:5672"\n      - "15672:15672"\n    \n')),(0,r.kt)("h2",{id:"redis\u955c\u50cf"},"redis\u955c\u50cf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'redis:\n  image: redis \n  ports: \n    - "6379:6379"\n  \n\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'docker run -p 6379:6379 -d redis:latest redis-server\n# \u6570\u636e\u6301\u4e45\u5316\u5b58\u65b9\u5f0f\u542f\u52a8\ndocker run -p 6379:6379 -v $PWD/data:/data --name redis -d redis redis-server --appendonly yes\n# \u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6, \u5148\u521b\u5efa /usr/local/docker/redis.conf\ndocker run -p 6379:6379 --name myredis -v /usr/local/docker/redis.conf:/etc/redis/redis.conf -v /usr/local/docker/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes\n\n# \u5e26\u5bc6\u7801\u542f\u52a8\ndocker run --name redis_with_auth -p 6379:6379 -d --restart=always redis:latest redis-server --appendonly yes --requirepass "@w-(*102Y613}-Redis"\n\n\n# redis client\ndocker exec -ti d0b86 redis-cli [-h localhost -p 6379]\n# remote client\ndocker exec -it redis_image redis-cli -h 192.168.1.100 -p 6379 -a your_password //\u5982\u679c\u6709\u5bc6\u7801 \u4f7f\u7528 -a\u53c2\u6570\n\n')),(0,r.kt)("p",null,"redis.conf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-conf"},"bind 127.0.0.1 #\u6ce8\u91ca\u6389\u8fd9\u90e8\u5206\uff0c\u8fd9\u662f\u9650\u5236redis\u53ea\u80fd\u672c\u5730\u8bbf\u95ee\n# or\n# \u5141\u8bb8\u5916\u7f51\u8bbf\u95eeredis\nbind 0.0.0.0 \n\nprotected-mode no #\u9ed8\u8ba4yes\uff0c\u5f00\u542f\u4fdd\u62a4\u6a21\u5f0f\uff0c\u4f1a\u9650\u5236\u4e3a\u672c\u5730\u8bbf\u95ee\n\ndaemonize no#\u9ed8\u8ba4no\uff0c\u6539\u4e3ayes\u610f\u4e3a\u4ee5\u5b88\u62a4\u8fdb\u7a0b\u65b9\u5f0f\u542f\u52a8\uff0c\u53ef\u540e\u53f0\u8fd0\u884c\uff0c\u9664\u975ekill\u8fdb\u7a0b\uff0c\u6539\u4e3ayes\u4f1a\u4f7f\u914d\u7f6e\u6587\u4ef6\u65b9\u5f0f\u542f\u52a8redis\u5931\u8d25\n\ndatabases 16 #\u6570\u636e\u5e93\u4e2a\u6570\uff08\u53ef\u9009\uff09\n\ndir ./ #\u8f93\u5165\u672c\u5730redis\u6570\u636e\u5e93\u5b58\u653e\u6587\u4ef6\u5939\uff08\u53ef\u9009\uff09\n\nappendonly yes #redis\u6301\u4e45\u5316\uff08\u53ef\u9009\uff09\n\n# \u8bbe\u7f6e\u8bbf\u95eeredis\u7684\u5bc6\u7801\u4e3a123(\u53ef\u9009)\nrequirepass 123 \n\n\n")),(0,r.kt)("p",null,"redis-commander: \u63d0\u4f9b redis web \u7ba1\u7406\u754c\u9762"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker run --rm -d --name redis-cmder -p 8081:8081 --link redis:re -e REDIS_HOSTS=re:6379 rediscommander/redis-commander")),(0,r.kt)("h2",{id:"ubuntu\u955c\u50cf"},"ubuntu\u955c\u50cf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'docker pull ubuntu\ndocker run -it ubuntu bash\n\napt update\n# \u5b89\u88c5 vim ping wget ifconfig\napt install vim iputils-ping wget net-tools zsh\n# 2\u3001\u628a\u9ed8\u8ba4\u7684Shell\u6539\u6210zsh\nchsh -s /bin/zsh\n# \u5b89\u88c5 oh-my-zsh \u9700\u8981\u5148\u88c5git\napt install git\nsh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"\n')),(0,r.kt)("h2",{id:"zookeeper"},"zookeeper"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker run --name some-zookeeper -d -p 2181:2181 zookeeper\n# \u67e5\u770b\u65e5\u5fd7\ndocker logs -f --tail=10 some-zookeeper\n# \u8fdb\u5165\u547d\u4ee4\u884c client (\u8fdb\u5165\u540e \u6267\u884c zkCli.sh -server <ip>)\ndocker run -it --rm --link some-zookeeper:zk zookeeper zkCli.sh -server zk\n\n\n###### zookeeper client cmd\nls / # \u67e5\u770b\u6839\u8282\u70b9\nget /zookeeper\n\n")),(0,r.kt)("h2",{id:"kafka"},"kafka"),(0,r.kt)("p",null,"if error ",(0,r.kt)("inlineCode",{parentName:"p"}," dial tcp: lookup cbacb08a78fe: no such host")," occured, maybe it is because the domain name ",(0,r.kt)("inlineCode",{parentName:"p"},"cbacb08a78fe")," is not defined in host file, add ",(0,r.kt)("inlineCode",{parentName:"p"},"127.0.0.1 cbacb08a78fe")," in host file (",(0,r.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/xwxz/p/13565422.html"},"https://www.cnblogs.com/xwxz/p/13565422.html"),")"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://hub.docker.com/r/bitnami/kafka/"},"https://hub.docker.com/r/bitnami/kafka/"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"version: '3'\n\nnetworks:\n  app-tier:\n    driver: bridge\n\nservices:\n  zookeeper:\n    image: 'bitnami/zookeeper:3.7'\n    ports:\n      - 2181:2181\n    restart: unless-stopped\n    networks:\n      - app-tier\n    environment:\n      - ALLOW_ANONYMOUS_LOGIN=yes\n  kafka:\n    image: 'bitnami/kafka:3'\n    ports:\n      - 9092:9092\n    restart: unless-stopped\n    networks:\n      - app-tier\n    environment:\n      - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181\n      - KAFKA_BROKER_ID=1\n      - ALLOW_PLAINTEXT_LISTENER=yes\n      - KAFKA_CFG_LISTENERS=PLAINTEXT://:9092\n      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://127.0.0.1:9092\n      - KAFKA_CFG_AUTO_CREATE_TOPICS_ENABLE=true\n    depends_on:\n      - zookeeper\n    \n    \n\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker exec -it --rm kafka_kafka_1 bash\ncd /opt/bitnami/kafka/bin\n#  check topics (\u53ef\u4ee5\u662f service name \u4e5f\u53ef\u4ee5\u662f container_name)\n./kafka-topics.sh --list --bootstrap-server kafka:9092\n# create topic\n# https://www.baeldung.com/kafka-topic-creation \u4f7f\u7528\u4ee3\u7801\u521b\u5efa\n./kafka-topics.sh --create --topic kafka_topic --replication-factor 1 --partitions 1 --bootstrap-server kafka:9092\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/wurstmeister/kafka-docker"},"https://github.com/wurstmeister/kafka-docker")," \u63a8\u8350"),(0,r.kt)("h2",{id:"rabbitmq"},"rabbitmq"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u5e26 management \u7684\u7248\u672c\u6709 web \u754c\u9762\ndocker pull rabbitmq:3.8.3-management\n# 15672 \u4e3a web ui \u7aef\u53e3, \u767b\u5f55 guest/guest\ndocker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management\n\ndocker run -d --name rabbitmq3.7.7 -p 5672:5672 -p 15672:15672 -v `pwd`/data:/var/lib/rabbitmq --hostname myRabbit -e RABBITMQ_DEFAULT_VHOST=my_vhost  -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin df80af9ca0c9\n\n")),(0,r.kt)("h2",{id:"zipkin"},"zipkin"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://zipkin.io/pages/quickstart.html"},"https://zipkin.io/pages/quickstart.html")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker run --name zipkin-x -d -p 9411:9411 openzipkin/zipkin\n")),(0,r.kt)("p",null,"http://localhost:9411/zipkin/"),(0,r.kt)("h2",{id:"nginx"},"nginx"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/nginx-proxy/nginx-proxy"},"https://github.com/nginx-proxy/nginx-proxy")," \u5bb9\u5668\u91cc\u7684 nginx \u53cd\u5411\u4ee3\u7406"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u4fdd\u8bc1 nginx \u4e0b\u6709 conf, conf \u6587\u4ef6\u5939\u590d\u5236\u81ea nginx docker \u5185\u90e8 (docker container cp nginx:/etc/nginx .)\ndocker run -d --name nginx -p 80:80 -v ~/docker_data/nginx/html:/usr/share/nginx/html -v ~/docker_data/nginx/logs:/var/nginx/logs -v ~/docker_data/nginx/conf:/etc/nginx nginx\n\n")),(0,r.kt)("h2",{id:"mongodb"},"mongodb"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# --auth\uff1a\u9700\u8981\u5bc6\u7801\u624d\u80fd\u8bbf\u95ee\u5bb9\u5668\u670d\u52a1\u3002(\u9ed8\u8ba4\u6ca1\u6709\u8d26\u6237\u5bc6\u7801)\ndocker run -d --name mongo -p 27017:27017 -v /Users/xiaoyu/one/docker_data/mongo/data:/data/db -v /Users/xiaoyu/one/docker_data/mongo/backup:/data/backup mongo:latest --auth\n\n\ndocker exec -it mongo mongo admin\n# \u521b\u5efa\u4e00\u4e2a\u540d\u4e3a admin\uff0c\u5bc6\u7801\u4e3a 123456 \u7684\u7528\u6237\u3002\n>  db.createUser({ user:'admin',pwd:'123456',roles:[ { role:'userAdminAnyDatabase', db: 'admin'},\"readWriteAnyDatabase\"]});\n# \u5c1d\u8bd5\u4f7f\u7528\u4e0a\u9762\u521b\u5efa\u7684\u7528\u6237\u4fe1\u606f\u8fdb\u884c\u8fde\u63a5\u3002\n> db.auth('admin', '123456')\n\n# \u5907\u4efd\ndocker exec mongo sh -c 'exec var=`date +%Y%m%d%H%M` &amp;&amp; mongodump -h localhost --port 27017 -u jsmith -p password -d dbname -o /data/backup/$var_test1.dat'\n\n\n# \u8fdc\u7a0b\u8fde\u63a5\ndocker run -it --rm mongo mongo --host 192.168.10.130 --port 27017\n\n")),(0,r.kt)("h2",{id:"gitlab"},"gitlab"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# \u62c9\u53d6gitlab\u955c\u50cf\ndocker pull beginor/gitlab-ce:11.0.1-ce.0\n\n# \u521b\u5efa volume \u76ee\u5f55\nmkdir -p ./gitlab/etc ./gitlab/log ./gitlab/data\n# \u590d\u5236\u914d\u7f6e\u6587\u4ef6\u5230\u5bbf\u4e3b\u7684 volume \u76ee\u5f55\u91cc\n# \u53ef\u4ee5\u624b\u52a8\u590d\u5236, \n# \u4e5f\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\u7136\u540e\u5173\u95ed\u6765\u8fbe\u5230\u590d\u5236\u7684\u6548\u679c (\u63a8\u8350)\ndocker run --rm --privileged=true -v /root/gitlab/etc:/etc/gitlab -v /root/gitlab/log:/var/log/gitlab -v /root/gitlab/data:/var/opt/gitlab beginor/gitlab-ce:11.0.1-ce.0\n# Ctrl+c \u5173\u95ed, \u6b64\u65f6\u914d\u7f6e\u6587\u4ef6\u88ab\u590d\u5236\u5230\u5bbf\u4e3b\u7684 volume \u76ee\u5f55\u4e86\n\n# \u4fee\u6539 gitlab.rb,\n# \u6dfb\u52a0 external_url 'http://<\u5bbf\u4e3b\u673a host>:<\u5bbf\u4e3b\u673a port>' (\u610f\u601d\u662f\u544a\u8bc9\u5bb9\u5668\u5185\u7684 gitlab, \u5728\u5bb9\u5668\u5185\u90e8\u4e5f\u8981\u4f7f\u7528\u8fd9\u4e2a\u7aef\u53e3, \u4ee5\u548c\u5bbf\u4e3b\u673a\u51c6\u5907\u66b4\u9732\u7684\u7aef\u53e3\u4fdd\u6301\u76f8\u540c. \u82e5\u5bbf\u4e3b\u91c7\u7528 80 \u4f5c\u4e3a gitlab \u5bf9\u5916\u7aef\u53e3, \u5219 external_url \u7684\u7aef\u53e3\u53ef\u7701\u7565, )\n# \n# attention!!! \u8fd9\u91cc\u7aef\u53e3\u914d\u7f6e\u4e3aa_port, \u90a3\u4e48 docker run \u8fd0\u884c\u5bb9\u5668\u65f6 , \u9700\u8981 -p a_port:a_port\n# \ncd gitlab\nvim etc/gitlab.rb\n\n# \u4fee\u6539 gitlab.yml\n# \u4fee\u6539 gitlab.host: \u5bbf\u4e3b\u673aip\u5730\u5740, gitlab.port: \u5bbf\u4e3b\u673a\u66b4\u9732\u7684\u7aef\u53e3, gitlab.https: false\nvim data/gitlab-rails/etc/gitlab.yml\n\n# \u82e5\u5bbf\u4e3b\u51c6\u5907\u4f7f\u7528\u9ed8\u8ba4\u7aef\u53e3 80, \u90a3\u4e48\u53ef\u4ee5 -p 80:80 , \u6b64\u65f6\u4fee\u6539 external_url \u65f6, \u53ef\u7701\u7565\u7aef\u53e3 \ndocker run -d --name gitlab -p 8443:443 -p 80:80 --restart unless-stopped -v /root/gitlab/etc:/etc/gitlab -v /root/gitlab/log:/var/log/gitlab -v /root/gitlab/data:/var/opt/gitlab beginor/gitlab-ce:11.0.1-ce.0\n\n# \u81ea\u5b9a\u4e49\u66b4\u9732\u7aef\u53e3\u4e3a 8090, \u5219\u9700\u8981\u4fee\u6539 external_url \u65f6\u52a0\u4e0a\u7aef\u53e3 8090\ndocker run -d --name gitlab -p 8443:443 -p 8090:8090 --privileged=true --restart unless-stopped -v /root/gitlab/etc:/etc/gitlab -v /root/gitlab/log:/var/log/gitlab -v /root/gitlab/data:/var/opt/gitlab beginor/gitlab-ce:11.0.1-ce.0\n")),(0,r.kt)("h2",{id:"etcd"},"etcd"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker pull bitnami/etcd:latest\n# \u5355\u8282\u70b9\n$ docker run -p 2379:2379 -e ALLOW_NO_AUTH=yes --name Etcd bitnami/etcd\n\n\n")),(0,r.kt)("h2",{id:"influxdb"},"influxdb"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker run -d \\\n    --name influxdb \\\n    -p 8086:8086 \\\n    --volume $PWD:/var/lib/influxdb2 \\\n    influxdb:2.1.1\n\n")),(0,r.kt)("h1",{id:"vagrant"},"vagrant"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/hashicorp/vagrant"},"https://github.com/hashicorp/vagrant")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/utmapp/UTM"},"https://github.com/utmapp/UTM")," ios \u5e73\u53f0, mac \u5e73\u53f0"),(0,r.kt)("p",null," firecracker, kata \u4e4b\u7c7b\u65b0\u8f7b\u91cf\u865a\u62df\u673a"),(0,r.kt)("h2",{id:"\u57fa\u672c\u4f7f\u7528"},"\u57fa\u672c\u4f7f\u7528"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.vagrantup.com/downloads.html"},"https://www.vagrantup.com/downloads.html")," \u4e0b\u8f7d\n",(0,r.kt)("a",{parentName:"p",href:"https://www.virtualbox.org/wiki/Downloads"},"https://www.virtualbox.org/wiki/Downloads")," virtualbox \u4e0b\u8f7d\n",(0,r.kt)("a",{parentName:"p",href:"https://learn.hashicorp.com/collections/vagrant/getting-started"},"https://learn.hashicorp.com/collections/vagrant/getting-started")," \u5165\u95e8"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"http://www.vagrantbox.es/"},"http://www.vagrantbox.es/")," \u641c\u7d22 box\n",(0,r.kt)("a",{parentName:"p",href:"https://app.vagrantup.com/boxes/search"},"https://app.vagrantup.com/boxes/search")," \u641c\u7d22 box\n",(0,r.kt)("a",{parentName:"p",href:"https://c4ys.com/archives/1230"},"https://c4ys.com/archives/1230")," \u56fd\u5185\u955c\u50cf\u6536\u96c6 (",(0,r.kt)("a",{parentName:"p",href:"http://mirrors.ustc.edu.cn/centos-cloud/centos/7/vagrant/x86_64/images/"},"\u6e05\u534e centos"),")"),(0,r.kt)("p",null,"\u5982\u4f55\u624b\u52a8\u4e0b\u8f7d box?\n\u4f8b\u5982 \u627e\u5230 kali \u7684 box \u9875\u9762 ",(0,r.kt)("a",{parentName:"p",href:"https://app.vagrantup.com/kalilinux/boxes/rolling"},"https://app.vagrantup.com/kalilinux/boxes/rolling"),", \u70b9\u8fdb \u6307\u5b9a\u7248\u672c\u7684\u9875\u9762 ",(0,r.kt)("a",{parentName:"p",href:"https://app.vagrantup.com/kalilinux/boxes/rolling/versions/2020.4.0"},"https://app.vagrantup.com/kalilinux/boxes/rolling/versions/2020.4.0")," , \u90a3\u4e48\u53ef\u4ee5 ",(0,r.kt)("inlineCode",{parentName:"p"},"curl -L https://app.vagrantup.com/kalilinux/boxes/rolling/versions/2020.4.0/providers/virtualbox.box -O kali-2020.4.0.box")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# verify the installation\nvagrant -v  \n\nvagrant box list # list all available vm\n\n# \u4e0b\u8f7d\u597d box \u6587\u4ef6\u7136\u540e\n# \u52a0\u8f7d\u5230 vagrant\nvagrant box add <xxx_box_name> <box_file_Url_path>\nvagrant init <xxx_box_name>         #\u521d\u59cb\u5316, create a vagrantfile in current folder\nvagrant up        # \u542f\u52a8\u73af\u5883\n\n# \u4e5f\u53ef\u4ee5\u4e0d\u4e0b\u8f7d box file, \u76f4\u63a5 init a box (box name can be find from some website), \u4f46\u662f\u53ef\u80fd\u5f88\u6162\nvagrant init centos/7\nvagrant up # \u542f\u52a8\u7684\u7cfb\u7edf \n\n# \u4f7f\u7528 vagrant \u7528\u6237\u8fde\u63a5 \u865a\u62df\u673a , \u4e0d\u7528\u5bc6\u7801, \u82e5\u4ec5\u4ec5\u4e00\u4e2a machine, \u65e0\u9700\u6307\u5b9a machine name\n# \u5207\u6362 root, \u4e5f\u53ef\u4f7f\u7528 root/vagrant \u767b\u5f55 or : sudo su\nvagrant ssh [machine_name]\nvagrant upload <source> [dest] [name|id] # \u4e0a\u4f20\u6587\u4ef6\n\nvagrant reload # \u91cd\u542f\nvagrant halt  # \u5173\u95ed\u865a\u62df\u673a\nvagrant status  # \u67e5\u770b\u865a\u62df\u673a\u8fd0\u884c\u72b6\u6001\nvagrant destroy  # \u9500\u6bc1\u5f53\u524d\u865a\u62df\u673a\n\n# \u6253\u5305\u81ea\u5df1\u7684 box \u8fdb\u884c\u5206\u53d1, \u6253\u5305\u5b8c\u6210\u540e\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u751f\u6210\u4e00\u4e2a package.box \u7684\u6587\u4ef6\nvagrant package\n\n\n# \u4e0a\u4f20, \u9ed8\u8ba4\u4f20\u5230 vagrant home\nvagrant upload xxx_file [dest_path]\n")),(0,r.kt)("h2",{id:"vagrant-\u8bbe\u7f6e-ip"},"vagrant \u8bbe\u7f6e ip"),(0,r.kt)("p",null,"\u914d\u7f6e\u865a\u62df\u673a\u4e3a\u56fa\u5b9a ip: \u4fee\u6539 vagrantfile , \u914d\u7f6e\u4e3a\u79c1\u6709\u7f51\u7edc (\u9700\u8981\u5148\u4f7f\u7528 virtualbox \u7684\u4e3b\u673a\u7f51\u7edc\u7ba1\u7406\u5668\u914d\u7f6e\u65b0\u589e hostonly \u7f51\u7edc)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'config.vm.network "private_network", ip:"virtualbox_host_only_ip"\n')),(0,r.kt)("p",null,"virtualbox_host_only_ip \u5c31\u662f \u5bbf\u4e3b\u673a \u4e2d virtualbox \u7684 hostonly ip, \u5982 192.168.56.1/24"),(0,r.kt)("p",null,"\u5176\u5b9e Vagrant \u4e2d\u4e00\u5171\u6709\u4e09\u79cd\u7f51\u7edc\u914d\u7f6e, "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'\u7aef\u53e3\u6620\u5c04(Forwarded port):\n\nconfig.vm.forwarded_port 80, 8080   \u5c06\u8bbf\u95ee\u5bbf\u4e3b\u8ba1\u7b97\u673a8080\u7aef\u53e3\u7684\u8bf7\u6c42\u90fd\u8f6c\u53d1\u5230\u865a\u62df\u673a\u768480\u7aef\u53e3\u4e0a\nconfig.vm.forwarded_port 80, 8080, protocol: "udp"    \u9ed8\u8ba4\u53ea\u8f6c\u53d1TCP\u5305\uff0cUDP\u9700\u8981\u989d\u5916\u6dfb\u52a0\u4ee5\u4e0b\u8bed\u53e5\n\n\u597d\u5904:\n\n\u7b80\u5355\u6613\u7406\u89e3\n\u5bb9\u6613\u5b9e\u73b0\u5916\u7f51\u8bbf\u95ee\u865a\u62df\u673a\n\n\u574f\u5904:\n\n\u5982\u679c\u4e00\u4e24\u4e2a\u7aef\u53e3\u9700\u8981\u6620\u5c04\u5f88\u5bb9\u6613\uff0c\u4f46\u662f\u5982\u679c\u6709\u6709\u5f88\u591a\u7aef\u53e3\uff0c\u6bd4\u5982MySQL\uff0cMongoDB\uff0ctomcat\u7b49\u670d\u52a1\uff0c\u7aef\u53e3\u6bd4\u8f83\u591a\u65f6\uff0c\u5c31\u6bd4\u8f83\u9ebb\u70e6\u3002\n\u4e0d\u652f\u6301\u5728\u5bbf\u4e3b\u673a\u5668\u4e0a\u4f7f\u7528\u5c0f\u4e8e1024\u7684\u7aef\u53e3\u6765\u8f6c\u53d1\u3002\u6bd4\u5982\uff1a\u4e0d\u80fd\u4f7f\u7528SSL\u7684443\u7aef\u53e3\u6765\u8fdb\u884chttps\u8fde\u63a5\u3002\n\n\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'\u79c1\u6709\u7f51\u7edc\uff08Private network\uff09\uff0c\u53ea\u6709\u4e3b\u673a\u53ef\u4ee5\u8bbf\u95ee\u865a\u62df\u673a\uff0c\u5982\u679c\u591a\u4e2a\u865a\u62df\u673a\u8bbe\u5b9a\u5728\u540c\u4e00\u4e2a\u7f51\u6bb5\u4e5f\u53ef\u4ee5\u4e92\u76f8\u8bbf\u95ee\uff0c\u5f53\u7136\u865a\u62df\u673a\u662f\u53ef\u4ee5\u8bbf\u95ee\u5916\u90e8\u7f51\u7edc\u7684\n\nconfig.vm.network "private_network", ip: "192.168.50.4"   \u8fd9\u91cc ip \u4e3a \u5bbf\u4e3b\u673a \u4e0a virtualbox \u5bf9\u5e94\u7684 host only ip \u5730\u5740\n\n\u597d\u5904:\n\n\u5b89\u5168\uff0c\u53ea\u6709\u81ea\u5df1\u80fd\u8bbf\u95ee\n\n\u574f\u5904:\n\n\u56e0\u4e3a\u79c1\u6709\u7684\u539f\u56e0\uff0c\u6240\u4ee5\u56e2\u961f\u6210\u5458\u5176\u4ed6\u4eba\u4e0d\u80fd\u548c\u4f60\u5199\u4f5c\n\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'\u516c\u6709\u7f51\u7edc\uff08Public network\uff09\uff0c\u865a\u62df\u673a\u4eab\u53d7\u5b9e\u4f53\u673a\u5668\u4e00\u6837\u7684\u5f85\u9047\uff0c\u4e00\u6837\u7684\u7f51\u7edc\u914d\u7f6e\uff0cvagrant1.3\u7248\u672c\u4e4b\u540e\u4e5f\u53ef\u4ee5\u8bbe\u5b9a\u9759\u6001IP\n\nconfig.vm.network "public_network", ip: "192.168.1.120"\n\n\u516c\u6709\u7f51\u7edc\u4e2d\u8fd8\u53ef\u4ee5\u8bbe\u7f6e\u6865\u63a5\u7684\u7f51\u5361\nconfig.vm.network "public_network", :bridge => \'en1: Wi-Fi (AirPort)\'\n\n\u597d\u5904:\n\u65b9\u4fbf\u56e2\u961f\u534f\u4f5c\uff0c\u522b\u4eba\u53ef\u4ee5\u8bbf\u95ee\u4f60\u7684\u865a\u62df\u673a\n\n\u574f\u5904:\n\u9700\u8981\u6709\u7f51\u7edc\uff0c\u6709\u8def\u7531\u5668\u5206\u914dIP\n\n')),(0,r.kt)("h2",{id:"virtualbox\u56db\u79cd\u7f51\u7edc\u6a21\u5f0f"},"VirtualBox\u56db\u79cd\u7f51\u7edc\u6a21\u5f0f"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/qq_28513801/article/details/90138491"},"https://blog.csdn.net/qq_28513801/article/details/90138491")),(0,r.kt)("h1",{id:"kali"},"kali"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"http://uni.mirrors.163.com/kali-images/kali-2020.4/"},"http://uni.mirrors.163.com/kali-images/kali-2020.4/"),"\n",(0,r.kt)("a",{parentName:"p",href:"http://mirrors.ustc.edu.cn/kali-images/"},"http://mirrors.ustc.edu.cn/kali-images/"),"\n",(0,r.kt)("a",{parentName:"p",href:"http://old.kali.org/kali-images/kali-2020.4/"},"http://old.kali.org/kali-images/kali-2020.4/")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.kali.org/docs/virtualization/install-virtualbox-guest-vm/"},"https://www.kali.org/docs/virtualization/install-virtualbox-guest-vm/")),(0,r.kt)("p",null,"\u9ed8\u8ba4\u7528\u6237\u540d\u662f root\uff0c\u9ed8\u8ba4\u5bc6\u7801\u662f toor\nkali/kali"),(0,r.kt)("h1",{id:"\u865a\u62df\u7f51\u5361-macvlan"},"\u865a\u62df\u7f51\u5361 macvlan"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://fuckcloudnative.io/posts/netwnetwork-virtualization-macvlan/"},"https://fuckcloudnative.io/posts/netwnetwork-virtualization-macvlan/")),(0,r.kt)("h1",{id:"multipass"},"Multipass"),(0,r.kt)("p",null,"\u7c7b\u4f3c vagrant, \u5feb\u901f\u83b7\u53d6 Linux \u73af\u5883"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.chenmo.com.cn/402492"},"https://www.chenmo.com.cn/402492")))}d.isMDXComponent=!0}}]);