"use strict";(self.webpackChunkwiki_1=self.webpackChunkwiki_1||[]).push([[9858],{3905:(e,n,a)=>{a.d(n,{Zo:()=>s,kt:()=>d});var t=a(7294);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function l(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?i(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function o(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=t.createContext({}),u=function(e){var n=t.useContext(p),a=n;return e&&(a="function"==typeof e?e(n):l(l({},n),e)),a},s=function(e){var n=u(e.components);return t.createElement(p.Provider,{value:n},e.children)},c="mdxType",k={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),c=u(a),m=r,d=c["".concat(p,".").concat(m)]||c[m]||k[m]||i;return a?t.createElement(d,l(l({ref:n},s),{},{components:a})):t.createElement(d,l({ref:n},s))}));function d(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=m;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o[c]="string"==typeof e?e:r,l[1]=o;for(var u=2;u<i;u++)l[u]=a[u];return t.createElement.apply(null,l)}return t.createElement.apply(null,a)}m.displayName="MDXCreateElement"},1350:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>k,frontMatter:()=>i,metadata:()=>o,toc:()=>u});var t=a(7462),r=(a(7294),a(3905));const i={title:"Message Queue\ud83c\udf08",tags:["mq"],date:new Date("2019-04-13T19:23:02.000Z"),toc_min_heading_level:2,toc_max_heading_level:5},l=void 0,o={unversionedId:"message-queue",id:"message-queue",title:"Message Queue\ud83c\udf08",description:"https://www.zhihu.com/question/43557507",source:"@site/docs/message-queue.md",sourceDirName:".",slug:"/message-queue",permalink:"/en/docs/message-queue",draft:!1,editUrl:"https://github.com/xiaoyureed/xiaoyureed.github.io/tree/main/docs/message-queue.md",tags:[{label:"mq",permalink:"/en/docs/tags/mq"}],version:"current",frontMatter:{title:"Message Queue\ud83c\udf08",tags:["mq"],date:"2019-04-13T19:23:02.000Z",toc_min_heading_level:2,toc_max_heading_level:5},sidebar:"tutorialSidebar",previous:{title:"Maven Notes\ud83c\udf08",permalink:"/en/docs/maven-note"},next:{title:"Investment Intro",permalink:"/en/docs/money"}},p={},u=[{value:"\u5e26\u6765\u7684\u597d\u5904",id:"\u5e26\u6765\u7684\u597d\u5904",level:2},{value:"\u5f15\u5165mq\u5e26\u6765\u7684\u95ee\u9898-\u600e\u4e48\u89e3\u51b3",id:"\u5f15\u5165mq\u5e26\u6765\u7684\u95ee\u9898-\u600e\u4e48\u89e3\u51b3",level:2},{value:"\u89e3\u51b3\u9ad8\u53ef\u7528\u95ee\u9898",id:"\u89e3\u51b3\u9ad8\u53ef\u7528\u95ee\u9898",level:3},{value:"\u89e3\u51b3\u6d88\u606f\u4f20\u9012\u53ef\u9760\u6027",id:"\u89e3\u51b3\u6d88\u606f\u4f20\u9012\u53ef\u9760\u6027",level:3},{value:"\u5982\u4f55\u9632\u6b62\u91cd\u590d\u6d88\u8d39",id:"\u5982\u4f55\u9632\u6b62\u91cd\u590d\u6d88\u8d39",level:4},{value:"\u5982\u4f55\u9632\u6b62\u6d88\u606f\u4e22\u5931",id:"\u5982\u4f55\u9632\u6b62\u6d88\u606f\u4e22\u5931",level:4},{value:"\u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u987a\u5e8f",id:"\u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u987a\u5e8f",level:4},{value:"\u5982\u4f55\u9632\u6b62\u6d88\u606f\u7684\u5927\u91cf\u79ef\u538b",id:"\u5982\u4f55\u9632\u6b62\u6d88\u606f\u7684\u5927\u91cf\u79ef\u538b",level:4},{value:"\u5982\u4f55\u9632\u6b62\u6d88\u606f\u8fc7\u671f\u5931\u6548",id:"\u5982\u4f55\u9632\u6b62\u6d88\u606f\u8fc7\u671f\u5931\u6548",level:4},{value:"\u5982\u4f55\u4fdd\u8bc1\u5206\u5e03\u5f0f\u6700\u7ec8\u4e00\u81f4\u6027",id:"\u5982\u4f55\u4fdd\u8bc1\u5206\u5e03\u5f0f\u6700\u7ec8\u4e00\u81f4\u6027",level:4},{value:"AMQP\u534f\u8bae",id:"amqp\u534f\u8bae",level:2},{value:"\u6982\u5ff5",id:"\u6982\u5ff5",level:3},{value:"\u5de5\u4f5c\u8fc7\u7a0b",id:"\u5de5\u4f5c\u8fc7\u7a0b",level:3},{value:"\u6d88\u606f\u786e\u8ba4",id:"\u6d88\u606f\u786e\u8ba4",level:3},{value:"\u57fa\u672c\u4ecb\u7ecd",id:"\u57fa\u672c\u4ecb\u7ecd",level:2},{value:"\u51e0\u79cd\u6d88\u606f\u6a21\u578b",id:"\u51e0\u79cd\u6d88\u606f\u6a21\u578b",level:2},{value:"hello-world",id:"hello-world",level:3},{value:"worker-queue",id:"worker-queue",level:3},{value:"\u53d1\u5e03\u8ba2\u9605",id:"\u53d1\u5e03\u8ba2\u9605",level:3},{value:"rpc",id:"rpc",level:3},{value:"\u4f7f\u7528 rabbit",id:"\u4f7f\u7528-rabbit",level:2},{value:"\u6d88\u606f\u7684\u5e8f\u5217\u5316",id:"\u6d88\u606f\u7684\u5e8f\u5217\u5316",level:3},{value:"\u53d1\u9001",id:"\u53d1\u9001",level:3},{value:"\u63a5\u6536",id:"\u63a5\u6536",level:3},{value:"\u6301\u4e45\u5316",id:"\u6301\u4e45\u5316",level:3},{value:"\u6d88\u606f\u786e\u8ba4\u673a\u5236-\u624b\u52a8\u786e\u8ba4-\u56de\u8c03",id:"\u6d88\u606f\u786e\u8ba4\u673a\u5236-\u624b\u52a8\u786e\u8ba4-\u56de\u8c03",level:3},{value:"\u6d88\u606f\u53d1\u9001\u786e\u8ba4",id:"\u6d88\u606f\u53d1\u9001\u786e\u8ba4",level:4},{value:"\u6d88\u606f\u6d88\u8d39\u786e\u8ba4",id:"\u6d88\u606f\u6d88\u8d39\u786e\u8ba4",level:4},{value:"\u4f7f\u7528 amqpAdmin \u96c6\u4e2d\u914d\u7f6e rabbitmq",id:"\u4f7f\u7528-amqpadmin-\u96c6\u4e2d\u914d\u7f6e-rabbitmq",level:3},{value:"kafka \u57fa\u672c\u6982\u5ff5",id:"kafka-\u57fa\u672c\u6982\u5ff5",level:2},{value:"\u903b\u8f91\u67b6\u6784",id:"\u903b\u8f91\u67b6\u6784",level:3},{value:"\u7269\u7406\u67b6\u6784",id:"\u7269\u7406\u67b6\u6784",level:3},{value:"\u5199\u5165\u6d88\u606f\u5de5\u4f5c\u6d41\u7a0b",id:"\u5199\u5165\u6d88\u606f\u5de5\u4f5c\u6d41\u7a0b",level:3},{value:"\u6d88\u8d39\u6d88\u606f\u7684\u539f\u7406",id:"\u6d88\u8d39\u6d88\u606f\u7684\u539f\u7406",level:3},{value:"partition \u5206\u533a\u9009\u62e9\u539f\u5219\u903b\u8f91",id:"partition-\u5206\u533a\u9009\u62e9\u539f\u5219\u903b\u8f91",level:3},{value:"kafka \u6d88\u606f\u6709\u5e8f\u6027",id:"kafka-\u6d88\u606f\u6709\u5e8f\u6027",level:3},{value:"kafka \u4e3a\u4ec0\u4e48\u5feb",id:"kafka-\u4e3a\u4ec0\u4e48\u5feb",level:3},{value:"kafka \u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u53ef\u9760\u6027",id:"kafka-\u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u53ef\u9760\u6027",level:3},{value:"\u5982\u4f55\u4fdd\u8bc1\u4e0d\u91cd\u590d\u6d88\u8d39",id:"\u5982\u4f55\u4fdd\u8bc1\u4e0d\u91cd\u590d\u6d88\u8d39",level:3},{value:"\u4e3a\u4ec0\u4e48\u4f7f\u7528 kafka",id:"\u4e3a\u4ec0\u4e48\u4f7f\u7528-kafka",level:2},{value:"kafka\u4f7f\u7528\u573a\u666f",id:"kafka\u4f7f\u7528\u573a\u666f",level:3},{value:"\u548c redis \u6d88\u606f\u961f\u5217\u7684\u533a\u522b",id:"\u548c-redis-\u6d88\u606f\u961f\u5217\u7684\u533a\u522b",level:3},{value:"\u5982\u4f55\u4f7f\u7528kafka",id:"\u5982\u4f55\u4f7f\u7528kafka",level:2},{value:"kafka\u914d\u7f6e\u6587\u4ef6",id:"kafka\u914d\u7f6e\u6587\u4ef6",level:3},{value:"KafkaManager web \u754c\u9762",id:"kafkamanager-web-\u754c\u9762",level:3},{value:"springboot \u96c6\u6210 kafka",id:"springboot-\u96c6\u6210-kafka",level:3},{value:"\u521b\u5efa\u4e3b\u9898",id:"\u521b\u5efa\u4e3b\u9898",level:3},{value:"\u751f\u4ea7\u8005\u53d1\u9001",id:"\u751f\u4ea7\u8005\u53d1\u9001",level:3},{value:"kafka template \u540c\u6b65 \u5f02\u6b65",id:"kafka-template-\u540c\u6b65-\u5f02\u6b65",level:4},{value:"\u751f\u4ea7\u8005\u914d\u7f6e",id:"\u751f\u4ea7\u8005\u914d\u7f6e",level:4},{value:"\u751f\u4ea7\u8005\u4e8b\u52a1\u6d88\u606f",id:"\u751f\u4ea7\u8005\u4e8b\u52a1\u6d88\u606f",level:4},{value:"\u6d88\u8d39\u8005\u6d88\u8d39",id:"\u6d88\u8d39\u8005\u6d88\u8d39",level:3},{value:"\u914d\u7f6e \u8fc7\u6ee4\u5668 \u5168\u5c40\u5f02\u5e38\u5904\u7406",id:"\u914d\u7f6e-\u8fc7\u6ee4\u5668-\u5168\u5c40\u5f02\u5e38\u5904\u7406",level:4},{value:"\u76d1\u542c\u6d88\u8d39",id:"\u76d1\u542c\u6d88\u8d39",level:4},{value:"@kafkaListener\u57fa\u672c\u4f7f\u7528",id:"kafkalistener\u57fa\u672c\u4f7f\u7528",level:5},{value:"\u6d88\u8d39\u6307\u5b9a\u5206\u533a",id:"\u6d88\u8d39\u6307\u5b9a\u5206\u533a",level:5},{value:"\u52a8\u6001\u5f00\u542f\u5173\u95ed\u76d1\u542c",id:"\u52a8\u6001\u5f00\u542f\u5173\u95ed\u76d1\u542c",level:5},{value:"\u7981\u7528\u81ea\u542f\u52a8",id:"\u7981\u7528\u81ea\u542f\u52a8",level:5},{value:"\u5b9a\u65f6\u542f\u505c\u76d1\u542c\u5668",id:"\u5b9a\u65f6\u542f\u505c\u76d1\u542c\u5668",level:5},{value:"\u901a\u8fc7\u6d88\u8d39\u8005\u6d88\u8d39",id:"\u901a\u8fc7\u6d88\u8d39\u8005\u6d88\u8d39",level:4},{value:"\u6d88\u8d39\u8005\u9519\u8bef\u5904\u7406 \u5355\u6d88\u606f \u6279\u91cf\u6d88\u606f",id:"\u6d88\u8d39\u8005\u9519\u8bef\u5904\u7406-\u5355\u6d88\u606f-\u6279\u91cf\u6d88\u606f",level:4},{value:"offset \u63d0\u4ea4",id:"offset-\u63d0\u4ea4",level:4},{value:"\u6d88\u606f\u5e8f\u5217\u5316",id:"\u6d88\u606f\u5e8f\u5217\u5316",level:4},{value:"\u81ea\u5b9a\u4e49\u4ee3\u66ff\u9ed8\u8ba4\u7ebf\u7a0b\u6c60",id:"\u81ea\u5b9a\u4e49\u4ee3\u66ff\u9ed8\u8ba4\u7ebf\u7a0b\u6c60",level:4},{value:"\u6d88\u8d39\u8005\u7ec4 \u591a\u7ebf\u7a0b\u6d88\u8d39",id:"\u6d88\u8d39\u8005\u7ec4-\u591a\u7ebf\u7a0b\u6d88\u8d39",level:4},{value:"\u6d88\u606f\u8f6c\u53d1",id:"\u6d88\u606f\u8f6c\u53d1",level:4},{value:"\u53c2\u6570\u8c03\u4f18",id:"\u53c2\u6570\u8c03\u4f18",level:2}],s={toc:u},c="wrapper";function k(e){let{components:n,...a}=e;return(0,r.kt)(c,(0,t.Z)({},s,a,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("div",{align:"center"},"https://www.zhihu.com/question/43557507 https://www.jianshu.com/p/79ca08116d57 \u6d88\u606f\u961f\u5217\uff08Message Queue\uff09\u662f\u4e00\u79cd\u5e94\u7528\u95f4\u7684\u901a\u4fe1\u65b9\u5f0f, \u662f\u4e00\u79cd\u5e94\u7528\u95f4\u7684\u5f02\u6b65\u534f\u4f5c\u673a\u5236 rabbitmq\uff1ahttps://www.rabbitmq.com",(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/jiaowo_ccc/article/details/93893715"},"https://blog.csdn.net/jiaowo_ccc/article/details/93893715")," usage scenario")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#1-%E6%80%BB%E7%BB%93"},"1. \u603b\u7ed3")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#2-mq-%E6%98%AF%E4%BB%80%E4%B9%88"},"2. mq \u662f\u4ec0\u4e48")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#3-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8mq-%E4%BC%98%E7%BC%BA%E7%82%B9"},"3. \u4e3a\u4ec0\u4e48\u4f7f\u7528mq-\u4f18\u7f3a\u70b9"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#31-%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%A5%BD%E5%A4%84"},"3.1. \u5e26\u6765\u7684\u597d\u5904")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#32-%E5%BC%95%E5%85%A5mq%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98-%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3"},"3.2. \u5f15\u5165mq\u5e26\u6765\u7684\u95ee\u9898-\u600e\u4e48\u89e3\u51b3"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#321-%E8%A7%A3%E5%86%B3%E9%AB%98%E5%8F%AF%E7%94%A8%E9%97%AE%E9%A2%98"},"3.2.1. \u89e3\u51b3\u9ad8\u53ef\u7528\u95ee\u9898")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#322-%E8%A7%A3%E5%86%B3%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E5%8F%AF%E9%9D%A0%E6%80%A7"},"3.2.2. \u89e3\u51b3\u6d88\u606f\u4f20\u9012\u53ef\u9760\u6027"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#3221-%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9"},"3.2.2.1. \u5982\u4f55\u9632\u6b62\u91cd\u590d\u6d88\u8d39")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#3222-%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E6%B6%88%E6%81%AF%E4%B8%A2%E5%A4%B1"},"3.2.2.2. \u5982\u4f55\u9632\u6b62\u6d88\u606f\u4e22\u5931")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#3223-%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E9%A1%BA%E5%BA%8F"},"3.2.2.3. \u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u987a\u5e8f")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#3224-%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E6%B6%88%E6%81%AF%E7%9A%84%E5%A4%A7%E9%87%8F%E7%A7%AF%E5%8E%8B"},"3.2.2.4. \u5982\u4f55\u9632\u6b62\u6d88\u606f\u7684\u5927\u91cf\u79ef\u538b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#3225-%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E6%B6%88%E6%81%AF%E8%BF%87%E6%9C%9F%E5%A4%B1%E6%95%88"},"3.2.2.5. \u5982\u4f55\u9632\u6b62\u6d88\u606f\u8fc7\u671f\u5931\u6548")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#3226-%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E5%88%86%E5%B8%83%E5%BC%8F%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7"},"3.2.2.6. \u5982\u4f55\u4fdd\u8bc1\u5206\u5e03\u5f0f\u6700\u7ec8\u4e00\u81f4\u6027")))))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#4-%E6%9C%89%E5%93%AA%E4%BA%9B%E4%BA%A7%E5%93%81%E5%8F%AF%E4%BE%9B%E9%80%89%E6%8B%A9-%E9%80%89%E5%9E%8B"},"4. \u6709\u54ea\u4e9b\u4ea7\u54c1\u53ef\u4f9b\u9009\u62e9-\u9009\u578b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#5-rabbitmq"},"5. RabbitMQ"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#51-amqp%E5%8D%8F%E8%AE%AE"},"5.1. AMQP\u534f\u8bae"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#511-%E6%A6%82%E5%BF%B5"},"5.1.1. \u6982\u5ff5")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#512-%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B"},"5.1.2. \u5de5\u4f5c\u8fc7\u7a0b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#513-%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4"},"5.1.3. \u6d88\u606f\u786e\u8ba4")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#52-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"},"5.2. \u57fa\u672c\u4ecb\u7ecd")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#53-%E5%87%A0%E7%A7%8D%E6%B6%88%E6%81%AF%E6%A8%A1%E5%9E%8B"},"5.3. \u51e0\u79cd\u6d88\u606f\u6a21\u578b"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#531-hello-world"},"5.3.1. hello-world")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#532-worker-queue"},"5.3.2. worker-queue")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#533-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85"},"5.3.3. \u53d1\u5e03\u8ba2\u9605")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#534-rpc"},"5.3.4. rpc")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#54-%E4%BD%BF%E7%94%A8-rabbit"},"5.4. \u4f7f\u7528 rabbit"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#541-%E6%B6%88%E6%81%AF%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96"},"5.4.1. \u6d88\u606f\u7684\u5e8f\u5217\u5316")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#542-%E5%8F%91%E9%80%81"},"5.4.2. \u53d1\u9001")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#543-%E6%8E%A5%E6%94%B6"},"5.4.3. \u63a5\u6536")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#544-%E6%8C%81%E4%B9%85%E5%8C%96"},"5.4.4. \u6301\u4e45\u5316")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#545-%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6-%E6%89%8B%E5%8A%A8%E7%A1%AE%E8%AE%A4-%E5%9B%9E%E8%B0%83"},"5.4.5. \u6d88\u606f\u786e\u8ba4\u673a\u5236-\u624b\u52a8\u786e\u8ba4-\u56de\u8c03"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#5451-%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E7%A1%AE%E8%AE%A4"},"5.4.5.1. \u6d88\u606f\u53d1\u9001\u786e\u8ba4")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#5452-%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E7%A1%AE%E8%AE%A4"},"5.4.5.2. \u6d88\u606f\u6d88\u8d39\u786e\u8ba4")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#546-%E4%BD%BF%E7%94%A8-amqpadmin-%E9%9B%86%E4%B8%AD%E9%85%8D%E7%BD%AE-rabbitmq"},"5.4.6. \u4f7f\u7528 amqpAdmin \u96c6\u4e2d\u914d\u7f6e rabbitmq")))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6-kafka"},"6. kafka"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#61-kafka-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"},"6.1. kafka \u57fa\u672c\u6982\u5ff5"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#611-%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84"},"6.1.1. \u903b\u8f91\u67b6\u6784")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#612-%E7%89%A9%E7%90%86%E6%9E%B6%E6%9E%84"},"6.1.2. \u7269\u7406\u67b6\u6784")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#613-%E5%86%99%E5%85%A5%E6%B6%88%E6%81%AF%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"},"6.1.3. \u5199\u5165\u6d88\u606f\u5de5\u4f5c\u6d41\u7a0b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#614-%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF%E7%9A%84%E5%8E%9F%E7%90%86"},"6.1.4. \u6d88\u8d39\u6d88\u606f\u7684\u539f\u7406")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#615-partition-%E5%88%86%E5%8C%BA%E9%80%89%E6%8B%A9%E5%8E%9F%E5%88%99%E9%80%BB%E8%BE%91"},"6.1.5. partition \u5206\u533a\u9009\u62e9\u539f\u5219\u903b\u8f91")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#616-kafka-%E6%B6%88%E6%81%AF%E6%9C%89%E5%BA%8F%E6%80%A7"},"6.1.6. kafka \u6d88\u606f\u6709\u5e8f\u6027")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#617-kafka-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB"},"6.1.7. kafka \u4e3a\u4ec0\u4e48\u5feb")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#618-kafka-%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E5%8F%AF%E9%9D%A0%E6%80%A7"},"6.1.8. kafka \u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u53ef\u9760\u6027")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#619-%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E4%B8%8D%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9"},"6.1.9. \u5982\u4f55\u4fdd\u8bc1\u4e0d\u91cd\u590d\u6d88\u8d39")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#62-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8-kafka"},"6.2. \u4e3a\u4ec0\u4e48\u4f7f\u7528 kafka"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#621-kafka%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"},"6.2.1. kafka\u4f7f\u7528\u573a\u666f")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#622-%E5%92%8C-redis-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E5%8C%BA%E5%88%AB"},"6.2.2. \u548c redis \u6d88\u606f\u961f\u5217\u7684\u533a\u522b")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#63-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8kafka"},"6.3. \u5982\u4f55\u4f7f\u7528kafka"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#631-kafka%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"},"6.3.1. kafka\u914d\u7f6e\u6587\u4ef6")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#632-kafkamanager-web-%E7%95%8C%E9%9D%A2"},"6.3.2. KafkaManager web \u754c\u9762")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#633-springboot-%E9%9B%86%E6%88%90-kafka"},"6.3.3. springboot \u96c6\u6210 kafka")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#634-%E5%88%9B%E5%BB%BA%E4%B8%BB%E9%A2%98"},"6.3.4. \u521b\u5efa\u4e3b\u9898")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#635-%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E9%80%81"},"6.3.5. \u751f\u4ea7\u8005\u53d1\u9001"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6351-kafka-template-%E5%90%8C%E6%AD%A5-%E5%BC%82%E6%AD%A5"},"6.3.5.1. kafka template \u540c\u6b65 \u5f02\u6b65")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6352-%E7%94%9F%E4%BA%A7%E8%80%85%E9%85%8D%E7%BD%AE"},"6.3.5.2. \u751f\u4ea7\u8005\u914d\u7f6e")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6353-%E7%94%9F%E4%BA%A7%E8%80%85%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF"},"6.3.5.3. \u751f\u4ea7\u8005\u4e8b\u52a1\u6d88\u606f")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#636-%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E8%B4%B9"},"6.3.6. \u6d88\u8d39\u8005\u6d88\u8d39"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6361-%E9%85%8D%E7%BD%AE-%E8%BF%87%E6%BB%A4%E5%99%A8-%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"},"6.3.6.1. \u914d\u7f6e \u8fc7\u6ee4\u5668 \u5168\u5c40\u5f02\u5e38\u5904\u7406")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6362-%E7%9B%91%E5%90%AC%E6%B6%88%E8%B4%B9"},"6.3.6.2. \u76d1\u542c\u6d88\u8d39"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#63621-kafkalistener%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"},"6.3.6.2.1. @kafkaListener\u57fa\u672c\u4f7f\u7528")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#63622-%E6%B6%88%E8%B4%B9%E6%8C%87%E5%AE%9A%E5%88%86%E5%8C%BA"},"6.3.6.2.2. \u6d88\u8d39\u6307\u5b9a\u5206\u533a")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#63623-%E5%8A%A8%E6%80%81%E5%BC%80%E5%90%AF%E5%85%B3%E9%97%AD%E7%9B%91%E5%90%AC"},"6.3.6.2.3. \u52a8\u6001\u5f00\u542f\u5173\u95ed\u76d1\u542c")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#63624-%E7%A6%81%E7%94%A8%E8%87%AA%E5%90%AF%E5%8A%A8"},"6.3.6.2.4. \u7981\u7528\u81ea\u542f\u52a8")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#63625-%E5%AE%9A%E6%97%B6%E5%90%AF%E5%81%9C%E7%9B%91%E5%90%AC%E5%99%A8"},"6.3.6.2.5. \u5b9a\u65f6\u542f\u505c\u76d1\u542c\u5668")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6363-%E9%80%9A%E8%BF%87%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E8%B4%B9"},"6.3.6.3. \u901a\u8fc7\u6d88\u8d39\u8005\u6d88\u8d39")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6364-%E6%B6%88%E8%B4%B9%E8%80%85%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86-%E5%8D%95%E6%B6%88%E6%81%AF-%E6%89%B9%E9%87%8F%E6%B6%88%E6%81%AF"},"6.3.6.4. \u6d88\u8d39\u8005\u9519\u8bef\u5904\u7406 \u5355\u6d88\u606f \u6279\u91cf\u6d88\u606f")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6365-offset-%E6%8F%90%E4%BA%A4"},"6.3.6.5. offset \u63d0\u4ea4")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6366-%E6%B6%88%E6%81%AF%E5%BA%8F%E5%88%97%E5%8C%96"},"6.3.6.6. \u6d88\u606f\u5e8f\u5217\u5316")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6367-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BB%A3%E6%9B%BF%E9%BB%98%E8%AE%A4%E7%BA%BF%E7%A8%8B%E6%B1%A0"},"6.3.6.7. \u81ea\u5b9a\u4e49\u4ee3\u66ff\u9ed8\u8ba4\u7ebf\u7a0b\u6c60")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6368-%E6%B6%88%E8%B4%B9%E8%80%85%E7%BB%84-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B6%88%E8%B4%B9"},"6.3.6.8. \u6d88\u8d39\u8005\u7ec4 \u591a\u7ebf\u7a0b\u6d88\u8d39")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#6369-%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91"},"6.3.6.9. \u6d88\u606f\u8f6c\u53d1")))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#64-%E5%8F%82%E6%95%B0%E8%B0%83%E4%BC%98"},"6.4. \u53c2\u6570\u8c03\u4f18")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#7-%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF-mqtt%E5%8D%8F%E8%AE%AE"},"7. \u5373\u65f6\u901a\u8baf MQTT\u534f\u8bae"))),(0,r.kt)("h1",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"\u573a\u666f: \u89e3\u8026, \u524a\u5cf0, \u5f02\u6b65(\u63d0\u524d\u8fd4\u56de)\n\u6a21\u578b: producer, consumer, queue(exchange, queue)\n    exchange type: fanout, direct, topic, headers\n        topic: *\u53f7, #\u53f7\n    binding: \u7ed1\u5b9aexchange\u548cqueue, \u8bbe\u7f6e bingdingKey,\u53d1\u9001\u6570\u636e\u65f6\u9700\u8981\u540c\u65f6\u53d1\u9001bindingKey\n\u7279\u6027: \u6d88\u606f\u786e\u8ba4(msg ack), \u6301\u4e45\u5316, \u516c\u5e73\u53d1\u5e03(fair dispatch)\n    msg ack: \u6bcf\u4e2aconsumer \u6d88\u8d39\u5b8c\u6d88\u606f, \u4f1a\u53d1\u9001\u4e00\u4e2a\u56de\u6267\u7ed9 rabbit, rabbit\u7136\u540e\u624d\u80fd\u5220\u9664\u961f\u5217\u4e2d\u7684\u6d88\u606f, \u5426\u5219 rabbit \u4f1a\u5c1d\u8bd5\u53d1\u9001\u8fd9\u4e2a\u6d88\u606f\u7ed9\u5176\u4ed6 consumer\n    \u6301\u4e45\u5316: \n    \u8f6e\u8be2\u673a\u5236\n\u5e26\u6765\u7684\u95ee\u9898: \u989d\u5916\u7684\u7ec4\u4ef6\u5f15\u5165\u590d\u6742\u6027; \u6682\u65f6\u7684\u4e0d\u4e00\u81f4\u6027(\u6700\u7ec8\u4f1a\u4e00\u81f4)\n\n")),(0,r.kt)("h1",{id:"mq-\u662f\u4ec0\u4e48"},"mq \u662f\u4ec0\u4e48"),(0,r.kt)("p",null,"\u6d88\u606f\u961f\u5217\uff1a\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u4f20\u9012\u6570\u636e"),(0,r.kt)("p",null,"\u6d89\u53ca\u4e09\u4e2a\u6982\u5ff5 -- producer\uff0cconsumer\uff0cmq\u4e2d\u95f4\u4ef6\uff1b"),(0,r.kt)("h1",{id:"\u4e3a\u4ec0\u4e48\u4f7f\u7528mq-\u4f18\u7f3a\u70b9"},"\u4e3a\u4ec0\u4e48\u4f7f\u7528mq-\u4f18\u7f3a\u70b9"),(0,r.kt)("p",null,"\u4f7f\u7528\u7684\u5927\u524d\u63d0: \u751f\u4ea7\u8005\u4e0d\u9700\u8981\u4ece\u6d88\u8d39\u8005\u5904\u83b7\u5f97\u53cd\u9988/\u5bb9\u8bb8\u77ed\u6682\u7684\u4e0d\u4e00\u81f4\u6027, \u5176\u5b9e\u5c31\u662f\u5bb9\u8bb8\u5f02\u6b65"),(0,r.kt)("h2",{id:"\u5e26\u6765\u7684\u597d\u5904"},"\u5e26\u6765\u7684\u597d\u5904"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u7cfb\u7edf\u89e3\u8026"),(0,r.kt)("p",{parentName:"li"},"\u4e0a\u6e38\u7cfb\u7edf\u5c06\u6570\u636e\u53d1\u9001\u5230 mq, \u4e0b\u6e38\u7cfb\u7edf\u65e0\u8bba\u6709\u591a\u5c11\u4e2a, \u53ea\u9700\u8981\u8ba2\u9605\u81ea\u5df1\u611f\u5174\u8da3\u7684\u4e3b\u9898\u5373\u53ef."),(0,r.kt)("p",{parentName:"li"},"\u6848\u4f8b: \u7cfb\u7edfa\u7684\u6570\u636e\u9700\u8981\u4e3b\u52a8\u53d1\u9001\u7ed9\u4e0b\u6e38\u7cfb\u7edfb\u6d88\u8d39, \u90a3\u4e48a \u76f4\u63a5\u8c03\u7528b\u7684\u63a5\u53e3\u5c31\u597d\u4e86, \u73b0\u5728\u9700\u6c42\u66f4\u6539: \u53c8\u6709\u7cfb\u7edfc, d\u9700\u8981\u8fd9\u4e2a\u6570\u636e (\u4e5f\u5c31\u662f\u4e00\u4e2a producer \u6709\u591a\u4e2a consumer), \u90a3\u4e48\u7cfb\u7edfa\u9700\u8981\u4fee\u6539, \u52a0\u5165\u8c03\u7528c, d \u63a5\u53e3\u7684\u4ee3\u7801; \u73b0\u5728\u5f15\u5165  mq, \u4e0a\u6709\u7cfb\u7edfa\u53d1\u9001\u6570\u636e\u5230 mq, \u4e0b\u6e38\u7cfb\u7edfbcd\u9700\u8981\u6570\u636e, \u76f4\u63a5\u8ba2\u9605\u611f\u5174\u8da3\u7684 topic \u5373\u53ef.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5f02\u6b65\u8c03\u7528 (\u63d0\u65e9\u8fd4\u56de)"),(0,r.kt)("p",{parentName:"li"},"\u4e00\u4e2a\u8bf7\u6c42\u8fc7\u6765\uff0c\u4f1a\u6267\u884c\u4e00\u7cfb\u5217\u52a8\u4f5c\uff0c\u5982\u679c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u662f\u6ca1\u6709\u8fd4\u56de\u7ed3\u679c\u7684\u90a3\u4e48\u53ef\u4ee5\u76f4\u63a5\u90fd\u653e\u5165\u6d88\u606f\u961f\u5217\u6267\u884c,\u8bf7\u6c42\u7acb\u523b\u8fd4\u56de"),(0,r.kt)("p",{parentName:"li"},"\u5982\u679c\u8fd9\u4e9b\u52a8\u4f5c\u53ef\u4ee5\u4e2d\u95f4\u4e00\u5207\u5206\u4e3a\u4e24\u7c7b\uff0c\u4e00\u7c7b\u662f\u6709\u8fd4\u56de\u7ed3\u679c\uff0c\u4e8c\u7c7b\u662f\u6ca1\u6709\u8fd4\u56de\u7ed3\u679c\uff0c\u5f15\u5165mq\u540e\uff0c\u4e00\u7c7b\u64cd\u4f5c\u6267\u884c\u5b8c\u76f4\u63a5\u8fd4\u56de\uff0c \u4e8c\u7c7b\u64cd\u4f5c\u8fdb\u5165mq\u4e2d\u6162\u6162\u6267\u884c\uff0c\u8fd9\u6837\u6574\u4e2a\u8bf7\u6c42\u901f\u5ea6\u5c31\u52a0\u5feb\u4e86\uff1b"),(0,r.kt)("p",{parentName:"li"},"\u6bd4\u5982\uff1a\u5916\u5356\u8ba2\u5355\u7684\u4f8b\u5b50\uff0c\u6267\u884c\u94fe\u6761\u4e2d\u53ef\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u4e00\u662f\u521b\u5efa\u8ba2\u5355\uff0c\u901a\u77e5\u996d\u5e97\u63a5\u5355\uff08\u6267\u884c\u5b8c\u76f4\u63a5\u8fd4\u56de\uff09\uff0c \u4e8c\u662f\u627e\u5230\u9a91\u624b\uff08\u8017\u65f6\u64cd\u4f5c\uff0c\u653e\u5230mq\u4e2d\u6267\u884c\uff09\uff1b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u627f\u8f7d\u6fc0\u589e\u7684\u5927\u6d41\u91cf, \u6162\u6162\u6d88\u5316 (\u6d41\u91cf\u9519\u5cf0)"),(0,r.kt)("p",{parentName:"li"},"\u7cfb\u7edf\u7684\u8bf7\u6c42\u4e0d\u5747\u5300\uff0c\u6d41\u91cf\u9ad8\u7684\u65f6\u5019\uff0c\u8bf7\u6c42\u5148\u8fdb\u5165mq\uff0c\u5728\u6d41\u91cf\u4f4e\u65f6\u6162\u6162\u6d88\u5316\u5904\u7406 \uff0c\u7528\u6709\u9650\u7684\u673a\u5668\u627f\u8f7d\u9ad8\u5e76\u53d1\u8bf7\u6c42"))),(0,r.kt)("h2",{id:"\u5f15\u5165mq\u5e26\u6765\u7684\u95ee\u9898-\u600e\u4e48\u89e3\u51b3"},"\u5f15\u5165mq\u5e26\u6765\u7684\u95ee\u9898-\u600e\u4e48\u89e3\u51b3"),(0,r.kt)("h3",{id:"\u89e3\u51b3\u9ad8\u53ef\u7528\u95ee\u9898"},"\u89e3\u51b3\u9ad8\u53ef\u7528\u95ee\u9898"),(0,r.kt)("p",null,"\u5f15\u5165 mq, \u4f1a\u9020\u6210\u6574\u4e2a\u7cfb\u7edf ",(0,r.kt)("inlineCode",{parentName:"p"},"\u53ef\u7528\u6027\u4e0d\u597d")," \uff08\u56e0\u4e3a mq \u4e2d\u95f4\u4ef6\u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u6302\uff09"),(0,r.kt)("p",null,"\u90a3\u4e48\u600e\u4e48\u505a\u9ad8\u53ef\u7528?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u505a\u96c6\u7fa4 -  \u4ee5rabbitmq\u4e3a\u4f8b, \u96c6\u7fa4\u6709\u4e24\u79cd\u6a21\u5f0f "),(0,r.kt)("p",{parentName:"li"},"\u7f72\u591a\u4e2arabbitmq\u8282\u70b9,\u6d88\u606f\u6570\u636e\u53ea\u5b58\u5728\u4e8e\u4e00\u4e2a\u8282\u70b9,\u4f46\u662f\u5143\u6570\u636e\u5b58\u5728\u4e8e\u6bcf\u4e2a\u8282\u70b9, \u6d88\u8d39\u8005\u5982\u679c\u8fde\u63a5\u5230\u4e00\u4e2a\u7a7a\u8282\u70b9,\u8fd9\u4e2a\u8282\u70b9\u4f1a\u6839\u636e\u5143\u6570\u636e\u5230queue\u6240\u5728\u8282\u70b9\u540c\u6b65queue\u6570\u636e; \u5b9e\u9645\u4e0a,\u8fd8\u662f\u6ca1\u6cd5\u4fdd\u8bc1\u9ad8\u53ef\u7528,\u56e0\u4e3aqueue\u6570\u636e\u8fd8\u662f\u53ea\u5b58\u5728\u4e8e\u4e00\u4e2a\u8282\u70b9, \u8fd9\u6837\u505a\u53ea\u662f\u63d0\u9ad8\u4e86\u541e\u5410\u91cf"),(0,r.kt)("p",{parentName:"li"},"\u955c\u50cf\u96c6\u7fa4\u6a21\u5f0f(\u53ef\u4ee5\u4fdd\u8bc1\u9ad8\u53ef\u7528,\u6ca1\u6cd5\u4fdd\u8bc1\u53ef\u62d3\u5c55): \u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u6709queue\u6570\u636e, \u5199\u6d88\u606f\u65f6\u4f1a\u81ea\u52a8\u628a\u6d88\u606f\u540c\u6b65\u5230\u6bcf\u4e2a\u8282\u70b9; \u600e\u4e48\u5f00\u542f:RabbitMQ \u6709\u5f88\u597d\u7684\u7ba1\u7406\u63a7\u5236\u53f0\uff0c\u5c31\u662f\u5728\u540e\u53f0\u65b0\u589e\u4e00\u4e2a\u7b56\u7565\uff0c\u8fd9\u4e2a\u7b56\u7565\u662f\u955c\u50cf\u96c6\u7fa4\u6a21\u5f0f\u7684\u7b56\u7565\uff0c\u6307\u5b9a\u7684\u65f6\u5019\u662f\u53ef\u4ee5\u8981\u6c42\u6570\u636e\u540c\u6b65\u5230\u6240\u6709\u8282\u70b9\u7684\uff0c\u4e5f\u53ef\u4ee5\u8981\u6c42\u540c\u6b65\u5230\u6307\u5b9a\u6570\u91cf\u7684\u8282\u70b9")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4f7f\u7528\u5206\u5e03\u5f0f\u6d88\u606f\u961f\u5217 Kafka "),(0,r.kt)("p",{parentName:"li"},"Kafka \u4e00\u4e2a\u6700\u57fa\u672c\u7684\u67b6\u6784\u8ba4\u8bc6\uff1a\u7531\u591a\u4e2a broker \u7ec4\u6210\uff0c\u6bcf\u4e2a broker \u662f\u4e00\u4e2a\u8282\u70b9\uff1b\u4f60\u521b\u5efa\u4e00\u4e2a topic\uff0c\u8fd9\u4e2a topic \u53ef\u4ee5\u5212\u5206\u4e3a\u591a\u4e2a partition\uff0c\u6bcf\u4e2a partition \u53ef\u4ee5\u5b58\u5728\u4e8e\u4e0d\u540c\u7684 broker \u4e0a\uff0c\u6bcf\u4e2a partition \u5c31\u653e\u4e00\u90e8\u5206\u6570\u636e\u3002"),(0,r.kt)("p",{parentName:"li"},"Kafka 0.8 \u4ee5\u540e\uff0c\u63d0\u4f9b\u4e86 HA (\u9ad8\u53ef\u7528)\u673a\u5236, \u6bcf\u4e2a partition \u7684\u6570\u636e\u90fd\u4f1a\u540c\u6b65\u5230\u5176\u5b83\u673a\u5668\u4e0a\uff0c\u5f62\u6210\u81ea\u5df1\u7684\u591a\u4e2a replica \u526f\u672c\u3002\u6240\u6709 replica \u4f1a\u9009\u4e3e\u4e00\u4e2a leader \u51fa\u6765(\u4e00\u4e2a\u6302\u6389\u4e86\u5728\u9009\u4e3e\u4e00\u4e2a)\uff0c\u90a3\u4e48\u751f\u4ea7\u548c\u6d88\u8d39\u90fd\u8ddf\u8fd9\u4e2a leader \u6253\u4ea4\u9053\uff0c\u7136\u540e\u5176\u4ed6 replica \u5c31\u662f follower\u3002"),(0,r.kt)("p",{parentName:"li"},"\u5199\u7684\u65f6\u5019\uff0cleader \u4f1a\u8d1f\u8d23\u628a\u6570\u636e\u540c\u6b65\u5230\u6240\u6709 follower \u4e0a\u53bb(\u4e00\u65e6\u6240\u6709 follower \u540c\u6b65\u597d\u6570\u636e\u4e86\uff0c\u5c31\u4f1a\u53d1\u9001 ack \u7ed9 leader\uff0cleader \u6536\u5230\u6240\u6709 follower \u7684 ack \u4e4b\u540e\uff0c\u5c31\u4f1a\u8fd4\u56de\u5199\u6210\u529f\u7684\u6d88\u606f\u7ed9\u751f\u4ea7\u8005)\uff0c\u8bfb\u7684\u65f6\u5019\u5c31\u76f4\u63a5\u8bfb leader \u4e0a\u7684\u6570\u636e\u5373\u53ef"),(0,r.kt)("p",{parentName:"li"},"(\u53ea\u80fd\u8bfb\u5199leader, \u8981\u662f\u4f60\u53ef\u4ee5\u968f\u610f\u8bfb\u5199\u6bcf\u4e2a follower, \u5c31\u6709\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898), \u53ea\u6709\u5f53\u4e00\u4e2a\u6d88\u606f\u5df2\u7ecf\u88ab\u6240\u6709 follower \u90fd\u540c\u6b65\u6210\u529f\u8fd4\u56de ack \u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u6d88\u606f\u624d\u4f1a\u88ab\u6d88\u8d39\u8005\u8bfb\u5230\u3002"))),(0,r.kt)("h3",{id:"\u89e3\u51b3\u6d88\u606f\u4f20\u9012\u53ef\u9760\u6027"},"\u89e3\u51b3\u6d88\u606f\u4f20\u9012\u53ef\u9760\u6027"),(0,r.kt)("p",null,"\u6d88\u606f",(0,r.kt)("inlineCode",{parentName:"p"},"\u53ef\u9760\u6027\u4e0d\u597d")," \uff08\u6d88\u606f\u4e22\u5931\uff0c\u6d88\u606f\u91cd\u590d/\u5e42\u7b49\u6027\uff0c \u5927\u91cf\u6d88\u606f\u79ef\u538b, \u6d88\u606f\u8fc7\u671f\u5931\u6548, \u600e\u4e48\u4fdd\u8bc1\u6d88\u606f\u987a\u5e8f\u6027\uff09"),(0,r.kt)("h4",{id:"\u5982\u4f55\u9632\u6b62\u91cd\u590d\u6d88\u8d39"},"\u5982\u4f55\u9632\u6b62\u91cd\u590d\u6d88\u8d39"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4ec0\u4e48\u65f6\u5019\u51fa\u73b0: "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},'\u4e3a\u4e86\u786e\u4fdd\u6d88\u606f\u88ab\u6210\u529f\u6d88\u8d39, \u5f00\u542f "\u624b\u52a8\u786e\u8ba4", \u5982\u679c\u6d88\u606f\u5df2\u88ab\u6210\u529f\u5904\u7406\uff0c\u4f46\u5728\u6d88\u606f\u786e\u8ba4\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u95ee\u9898\uff0c\u90a3\u4e48\u5728\u6d88\u8d39\u7aef\u91cd\u542f\u540e\uff0c\u6d88\u606f\u4f1a\u91cd\u65b0\u88ab\u6d88\u8d39\u3002')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u53d1\u9001\u7aef\u4e3a\u4e86\u4fdd\u8bc1\u6d88\u606f\u4f1a\u6210\u529f\u6295\u9012\uff0c\u4e00\u822c\u4f1a\u8bbe\u5b9a\u91cd\u8bd5\u3002\u5982\u679c\u6d88\u606f\u53d1\u9001\u81f3RabbitMQ\u4e4b\u540e\uff0c\u5728RabbitMQ\u56de\u590d\u5df2\u6210\u529f\u63a5\u6536\u6d88\u606f\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u5f02\u5e38\uff0c\u90a3\u4e48\u53d1\u9001\u7aef\u4f1a\u91cd\u65b0\u53d1\u9001\u8be5\u6d88\u606f\uff0c\u4ece\u800c\u9020\u6210\u6d88\u606f\u91cd\u590d\u53d1\u9001")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Kafka\u6d88\u606f\u91cd\u590d\u7684\u8868\u73b0: Kafka \u5b9e\u9645\u4e0a\u6709\u4e2a offset \u7684\u6982\u5ff5\uff0c\u5c31\u662f\u6bcf\u4e2a\u6d88\u606f\u5199\u8fdb\u53bb\uff0c\u90fd\u6709\u4e00\u4e2a offset\uff0c\u4ee3\u8868\u6d88\u606f\u7684\u5e8f\u53f7\uff0c\u7136\u540e consumer \u6d88\u8d39\u4e86\u6570\u636e\u4e4b\u540e\uff0c\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\uff08\u5b9a\u65f6\u5b9a\u671f\uff09\uff0c\u4f1a\u628a\u81ea\u5df1\u6d88\u8d39\u8fc7\u7684\u6d88\u606f\u7684 offset \u63d0\u4ea4\u4e00\u4e0b(\u6b64\u65f6\u6d88\u606f\u53ef\u80fd\u8fd8\u6ca1\u6709\u6b63\u5f0f\u5f00\u59cb\u5904\u7406)\uff0c\u8868\u793a\u201c\u6211\u5df2\u7ecf\u6d88\u8d39\u8fc7\u4e86\uff0c\u4e0b\u6b21\u6211\u8981\u662f\u91cd\u542f\u5565\u7684\uff0c\u4f60\u5c31\u8ba9\u6211\u7ee7\u7eed\u4ece\u4e0a\u6b21\u6d88\u8d39\u5230\u7684 offset \u6765\u7ee7\u7eed\u6d88\u8d39\u5427\u201d; --- \u5982\u679c\u6d88\u8d39\u7aef\u7a81\u7136\u5d29\u6389, \u6b64\u65f6\u8fd8\u6ca1\u6709\u5c06\u5df2\u7ecf\u6d88\u8d39\u7684\u6d88\u606f\u7684offset\u63d0\u4ea4, \u91cd\u542f\u540e\u5c31\u4f1a\u91cd\u590d\u6d88\u8d39\u6d88\u606f")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u600e\u4e48\u89e3\u51b3\u5462,\u9700\u8981\u6839\u636e\u5177\u4f53\u4e1a\u52a1\u6765\u770b: (\u9632\u6b62\u6d88\u606f\u91cd\u590d/\u4fdd\u8bc1\u5e42\u7b49\u6027 - \u6d88\u606f\u91cd\u590d\u4e0d\u53ef\u6015, \u91cd\u8981\u7684\u662f\u8981\u4fdd\u8bc1\u6d88\u606f\u5904\u7406\u7684\u5e42\u7b49\u6027)"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6bd4\u5982\u4f60\u62ff\u4e2a\u6570\u636e\u8981\u5199\u5e93\uff0c\u4f60\u5148\u6839\u636e\u4e3b\u952e\u67e5\u4e00\u4e0b\uff0c\u5982\u679c\u8fd9\u6570\u636e\u90fd\u6709\u4e86\uff0c\u4f60\u5c31\u522b\u63d2\u5165\u4e86\uff0cupdate \u4e00\u4e0b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6bd4\u5982\u4f60\u662f\u5199 Redis\uff0c\u90a3\u6ca1\u95ee\u9898\u4e86\uff0c\u53cd\u6b63\u6bcf\u6b21\u90fd\u662f set\uff0c\u5929\u7136\u5e42\u7b49\u6027\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u751f\u4ea7\u8005\u53d1\u9001\u6bcf\u6761\u6570\u636e\u7684\u65f6\u5019\uff0c\u91cc\u9762\u52a0\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684 id, \u6d88\u8d39\u5230\u4e86\u4e4b\u540e\uff0c\u5148\u6839\u636e\u8fd9\u4e2a id \u53bb\u6bd4\u5982 Redis \u91cc\u67e5\u4e00\u4e0b\uff0c\u5982\u679c\u6ca1\u67e5\u5230, \u8bc1\u660e\u6ca1\u6709\u6d88\u8d39\u8fc7\uff0c\u5904\u7406\uff0c\u7136\u540e\u8fd9\u4e2a id \u5199 Redis\u3002\u5982\u679c\u6d88\u8d39\u8fc7\u4e86\uff0c\u5c31\u522b\u5904\u7406\u4e86"))))),(0,r.kt)("h4",{id:"\u5982\u4f55\u9632\u6b62\u6d88\u606f\u4e22\u5931"},"\u5982\u4f55\u9632\u6b62\u6d88\u606f\u4e22\u5931"),(0,r.kt)("p",null,"\u9632\u6b62\u6d88\u606f\u4e22\u5931 - \u6d88\u606f\u53ef\u80fd\u5728\u4e09\u4e2a\u70b9\u4e22\u5931 -- \u6d88\u8d39\u8005,mq,\u751f\u4ea7\u8005 ;  RabbitMQ \u548c Kafka \u7684\u673a\u5236\u4e0d\u540c"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5bf9\u4e8erabbitmq:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u751f\u4ea7\u8005\u5c06\u6570\u636e\u53d1\u9001\u5230 RabbitMQ \u7684\u65f6\u5019\uff0c\u53ef\u80fd\u6570\u636e\u5c31\u5728\u534a\u8def\u7ed9\u641e\u4e22\u4e86"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5229\u7528\u4e8b\u52a1(\u540c\u6b65\u6a21\u5f0f\u7684,\u541e\u5410\u91cf\u4e0b\u964d,\u4e0d\u597d\u7528) - \u53d1\u9001\u6570\u636e\u4e4b\u524d,\u5f00\u542f RabbitMQ \u4e8b\u52a1channel.txSelect, \u5982\u679c\u6d88\u606f\u6ca1\u6709\u6210\u529f\u88ab RabbitMQ \u63a5\u6536\u5230\uff0c\u90a3\u4e48\u751f\u4ea7\u8005\u4f1a\u6536\u5230\u5f02\u5e38\u62a5\u9519\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u56de\u6eda\u4e8b\u52a1channel.txRollback,\u5982\u679c\u6536\u5230\u4e86\u6d88\u606f\uff0c\u90a3\u4e48\u53ef\u4ee5\u63d0\u4ea4\u4e8b\u52a1channel.txCommit")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u901a\u8fc7 \u5f00\u542f confirm \u6a21\u5f0f(\u5f02\u6b65\u6a21\u5f0f\u7684, \u4e0d\u4f1a\u963b\u585e) - \u5982\u679c\u5199\u5165\u4e86 RabbitMQ \u4e2d\uff0cRabbitMQ \u4f1a\u7ed9\u4f60\u56de\u4f20\u4e00\u4e2a ack \u6d88\u606f\uff0c\u544a\u8bc9\u4f60\u8bf4\u8fd9\u4e2a\u6d88\u606f ok \u4e86\u3002\u5982\u679c RabbitMQ \u6ca1\u80fd\u5904\u7406\u8fd9\u4e2a\u6d88\u606f\uff0c\u4f1a\u56de\u8c03\u4f60\u7684\u4e00\u4e2a nack \u63a5\u53e3\uff0c\u544a\u8bc9\u4f60\u8fd9\u4e2a\u6d88\u606f\u63a5\u6536\u5931\u8d25\uff0c\u4f60\u53ef\u4ee5\u91cd\u8bd5")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"rabbitmq\u5f04\u4e22\u6d88\u606f - \u5f00\u542f RabbitMQ \u7684\u6301\u4e45\u5316. "),(0,r.kt)("p",{parentName:"li"},"\u7b2c\u4e00\u6b65,\u521b\u5efa queue \u7684\u65f6\u5019\u5c06\u5176\u8bbe\u7f6e\u4e3a\u6301\u4e45\u5316,\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1 RabbitMQ \u6301\u4e45\u5316 queue \u7684\u5143\u6570\u636e\uff0c\u4f46\u662f\u5b83\u662f\u4e0d\u4f1a\u6301\u4e45\u5316 queue \u91cc\u7684\u6570\u636e\u7684\u3002"),(0,r.kt)("p",{parentName:"li"},"\u7b2c\u4e8c\u4e2a\u662f\u53d1\u9001\u6d88\u606f\u7684\u65f6\u5019\u5c06\u6d88\u606f\u7684 deliveryMode \u8bbe\u7f6e\u4e3a 2 ,\u5c31\u662f\u5c06\u6d88\u606f\u8bbe\u7f6e\u4e3a\u6301\u4e45\u5316\u7684\uff0c\u6b64\u65f6 RabbitMQ \u5c31\u4f1a\u5c06\u6d88\u606f\u6301\u4e45\u5316\u5230\u78c1\u76d8\u4e0a\u53bb")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6d88\u8d39\u8005\u5f04\u4e22\u6d88\u606f - RabbitMQ \u63d0\u4f9b\u7684 ack \u673a\u5236, \u5fc5\u987b\u5173\u95ed RabbitMQ \u7684\u81ea\u52a8 ack, \u7136\u540e\u6bcf\u6b21\u4f60\u81ea\u5df1\u4ee3\u7801\u91cc\u786e\u4fdd\u5904\u7406\u5b8c\u7684\u65f6\u5019\uff0c\u518d\u5728\u7a0b\u5e8f\u91cc ack\u4e00\u4e0b, \u5982\u679c\u6d88\u8d39\u8005\u6ca1\u6709\u5904\u7406\u5b8c\u5c31\u6302\u4e86,rabbitmq\u6ca1\u6709\u6536\u5230ack,\u4f1a\u5c06\u8fd9\u4e2a\u6d88\u606f\u53d1\u9001\u7ed9\u5176\u4ed6\u6d88\u8d39\u8005\u5904\u7406;")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5bf9\u4e8eKafka:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6d88\u8d39\u7aef\u4e22\u5931\u6d88\u606f - \u6b63\u5e38\u6765\u8bf4, kafka\u662f\u6bcf\u9694\u4e00\u6bb5\u5b9e\u8df5\u5c31\u63d0\u4ea4\u4e00\u6b21offset, \u5982\u679c\u6d88\u8d39\u7aef\u63a5\u6536\u5230\u6d88\u606f\u8fd8\u6ca1\u5904\u7406, \u78b0\u5230kafka\u521a\u597d\u81ea\u52a8\u63d0\u4ea4\u4e86offset, \u5904\u7406\u6d88\u606f\u65f6\u6d88\u8d39\u7aef\u6302\u6389\u4e86,\u5c31\u9020\u6210\u4e86\u6d88\u606f\u4e22\u5931; \u8fd9\u548c rabbitmq\u7684\u6d88\u8d39\u7aef(ack\u673a\u5236)\u7c7b\u4f3c; \u6b64\u65f6\u53ea\u8981\u5173\u95edoffset, \u5904\u7406\u5b8c\u624b\u52a8\u63d0\u4ea4offset")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"kafka\u5f04\u4e22\u6d88\u606f"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u67d0\u4e2abroker\u6302\u4e86, \u7136\u540e\u56de\u91cd\u65b0\u9009\u4e3e partition \u7684 leader,\u8981\u662f\u6b64\u65f6\u5176\u4ed6broker\u4e2d\u7684 follower \u521a\u597d\u8fd8\u6709\u4e9b\u6570\u636e\u6ca1\u6709\u540c\u6b65, \u7136\u540e\u9009\u4e3e\u67d0\u4e2a follower \u6210 leader \u4e4b\u540e,\u6570\u636e\u5c31\u4e22\u5931\u4e86")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5982\u4f55\u89e3\u51b3\u5462: (\u4fdd\u8bc1\u5728 leader \u6240\u5728 broker \u53d1\u751f\u6545\u969c\uff0c\u8fdb\u884c leader \u5207\u6362\u65f6\uff0c\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u3002)"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u7ed9 topic \u8bbe\u7f6e replication.factor \u53c2\u6570\uff1a\u8fd9\u4e2a\u503c\u5fc5\u987b\u5927\u4e8e 1\uff0c\u8981\u6c42\u6bcf\u4e2a partition \u5fc5\u987b\u6709\u81f3\u5c11 2 \u4e2a\u526f\u672c"),(0,r.kt)("li",{parentName:"ul"},"\u5728 Kafka \u670d\u52a1\u7aef\u8bbe\u7f6e min.insync.replicas \u53c2\u6570\uff1a\u8fd9\u4e2a\u503c\u5fc5\u987b\u5927\u4e8e 1\uff0c\u8fd9\u4e2a\u662f\u8981\u6c42\u4e00\u4e2a leader \u81f3\u5c11\u611f\u77e5\u5230\u6709\u81f3\u5c11\u4e00\u4e2a follower \u8fd8\u8ddf\u81ea\u5df1\u4fdd\u6301\u8054\u7cfb\uff0c\u6ca1\u6389\u961f\uff0c\u8fd9\u6837\u624d\u80fd\u786e\u4fdd leader \u6302\u4e86\u8fd8\u6709\u4e00\u4e2a follower \u5427")))))))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u751f\u4ea7\u8005\u4e22\u5931\u6570\u636e "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u8bbe\u7f6e ",(0,r.kt)("inlineCode",{parentName:"li"},"acks=all"),", \u548c ",(0,r.kt)("inlineCode",{parentName:"li"},"retries=MAX"),"\u540e\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u6ca1\u6709\u6570\u636e\u4e22\u5931\u4e86;",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5728 producer \u7aef\u8bbe\u7f6e acks=all\uff1a\u8fd9\u4e2a\u662f\u8981\u6c42\u6bcf\u6761\u6570\u636e\uff0c\u5fc5\u987b\u662f\u5199\u5165\u6240\u6709 replica \u4e4b\u540e\uff0c\u624d\u80fd\u8ba4\u4e3a\u662f\u5199\u6210\u529f\u4e86\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5728 producer \u7aef\u8bbe\u7f6e retries=MAX\uff08\u5f88\u5927\u5f88\u5927\u5f88\u5927\u7684\u4e00\u4e2a\u503c\uff0c\u65e0\u9650\u6b21\u91cd\u8bd5\u7684\u610f\u601d\uff09\uff1a\u8fd9\u4e2a\u662f\u8981\u6c42\u4e00\u65e6\u5199\u5165\u5931\u8d25\uff0c\u5c31\u65e0\u9650\u91cd\u8bd5\uff0c\u5361\u5728\u8fd9\u91cc\u4e86\u3002"))),(0,r.kt)("li",{parentName:"ul"},"\u4e0d\u8981\u4f7f\u7528 send(xxx, xxx), \u800c\u662f\u4f7f\u7528 send(xxx, xxx, callback), \u5728 callback \u91cc\u5904\u7406\u53d1\u9001\u5931\u8d25\u7684\u540e\u7684\u8865\u507f\u63aa\u65bd")))),(0,r.kt)("h4",{id:"\u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u987a\u5e8f"},"\u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u987a\u5e8f"),(0,r.kt)("p",null,"\u4fdd\u8bc1\u6d88\u606f\u987a\u5e8f\u6027, \u6ca1\u6709\u987a\u5e8f\u4f1a\u9020\u6210\u4ec0\u4e48\u95ee\u9898? "),(0,r.kt)("p",null,"\u6bd4\u5982\u4e24\u4e2a\u6570\u636e\u5e93\u901a\u8fc7 binglog \u540c\u6b65\u6570\u636e, binglog \u4e2d\u6709\u589e\u52a0,\u4fee\u6539,\u5220\u9664\u4e09\u4e2a\u64cd\u4f5c, \u5982\u679c\u6d88\u8d39\u8005\u8bfb\u53d6\u7684\u987a\u5e8f\u53d8\u4e86,\u540c\u6b65\u6570\u636e\u5c31\u9519\u4e86; rabbit\u548ckafka\u673a\u5236\u4e0d\u540c\u5206\u5f00\u6765\u8bf4"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5bf9\u4e8e rabbitmq:"),(0,r.kt)("p",{parentName:"li"},"\u95ee\u9898: \u4e00\u4e2aqueue, \u591a\u4e2aconsumer, msg1,msg2,msg3 \u987a\u5e8f\u8fdb\u5165queue, \u7ed3\u679c\u67d0\u4e2a\u6d88\u8d39\u8005\u5148\u5f97\u5230msg2, \u90a3\u4e48\u987a\u5e8f\u5c31\u53d8\u4e86;"),(0,r.kt)("p",{parentName:"li"},"\u89e3\u51b3\u65b9\u6cd51: rabbit\u4e2d\u5c06\u4e00\u4e2a queue, \u66ff\u6362\u4e3a\u591a\u4e2a queue, \u6bcf\u4e2aconsumer\u5bf9\u5e94\u4e00\u4e2aqueue, \u4e00\u7ec4\u6709\u5e8f\u7684\u6d88\u606f\u4e00\u8d77\u88ab\u53d1\u9001\u5230\u4e00\u4e2aqueue, \u88ab\u540c\u4e00\u4e2aconsumer\u6d88\u8d39; "),(0,r.kt)("p",{parentName:"li"},"\u65b9\u6cd52: \u6216\u8005\u53ea\u6709\u4e00\u4e2aqueue, \u548c\u4e00\u4e2aconsumer, \u5728consumer\u5185\u90e8\u7ef4\u62a4\u5185\u5b58\u961f\u5217\u505a\u6392\u961f, \u5206\u53d1\u7ed9\u4e0d\u540c\u7684worker\u5904\u7406;")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5bf9\u4e8eKafka"),(0,r.kt)("p",{parentName:"li"},"  \u65b9\u6cd5:  \u5bf9\u67d0\u4e2a topic \u8bbe\u7f6e N \u4e2apartition\uff0c\u8fdb\u6765\u7684\u6570\u636e\u6839\u636e key \u5bf9 N \u53d6\u4f59\u6570, \u5177\u6709\u76f8\u540c \u4f59\u6570\u7684\u7684\u6570\u636e\u90fd\u5230\u540c\u4e00 partition, \u800c partition \u5185\u90e8\u662f\u6709\u5e8f\u7684,\u8fd9\u6837\u5c31\u80fd\u4fdd\u8bc1\u987a\u5e8f\u6027"))),(0,r.kt)("h4",{id:"\u5982\u4f55\u9632\u6b62\u6d88\u606f\u7684\u5927\u91cf\u79ef\u538b"},"\u5982\u4f55\u9632\u6b62\u6d88\u606f\u7684\u5927\u91cf\u79ef\u538b"),(0,r.kt)("p",null,"\u6d88\u606f\u5927\u91cf\u79ef\u538b\u7684\u95ee\u9898: consumer\u51fa\u73b0\u95ee\u9898, \u4e0d\u6d88\u8d39\u4e86; -- \u4e34\u65f6\u7d27\u6025\u6269\u5bb9\u6d88\u606f\u961f\u5217"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5148\u4fee\u590dconsumer\u7684\u95ee\u9898, \u8fd9\u662f\u80af\u5b9a\u8981\u505a\u4e86, \u7136\u540e\u5c06\u6240\u6709\u7684consumer\u505c\u6b62;"),(0,r.kt)("li",{parentName:"ul"},"\u65b0\u5efa\u5bb9\u91cf\u66f4\u5927\u7684\u6d88\u606f\u961f\u5217, \u5199\u4e00\u4e2a\u4e34\u65f6\u7684\u5206\u53d1\u6570\u636e\u7684consumer, \u5c06\u6d88\u606f\u8f6c\u5165\u5230\u5927\u5bb9\u91cf\u7684\u961f\u5217\u4e2d"),(0,r.kt)("li",{parentName:"ul"},"\u7136\u540e\u5c06\u4fee\u590d\u597d\u7684consumer\u90e8\u7f72\u523010\u500d\u6570\u91cf\u7684\u673a\u5668\u4e0a, \u542f\u52a8, \u6d88\u8d39\u4e34\u65f6\u961f\u5217\u4e2d\u7684\u6d88\u606f(\u76f8\u5f53\u4e8e\u5c06queue\u8d44\u6e90, consumer\u8d44\u6e90\u90fd\u4e34\u65f6\u6269\u5927\u4e86)"),(0,r.kt)("li",{parentName:"ul"},"\u7b49\u6d88\u8d39\u5b8c\u79ef\u538b\u7684\u6d88\u606f\u540e, \u6062\u590d\u539f\u5148\u7684queue\u548cconsumer\u67b6\u6784;")),(0,r.kt)("h4",{id:"\u5982\u4f55\u9632\u6b62\u6d88\u606f\u8fc7\u671f\u5931\u6548"},"\u5982\u4f55\u9632\u6b62\u6d88\u606f\u8fc7\u671f\u5931\u6548"),(0,r.kt)("p",null,"\u6d88\u606f\u8fc7\u671f\u5931\u6548 - \u6bd4\u5982 rabbitmq \u4e2d\u53ef\u4ee5\u8bbe\u7f6e\u6d88\u606f\u8fc7\u671f\u65f6\u95f4, \u79ef\u538b\u8fc7\u4e86\u8fd9\u4e2a\u65f6\u95f4, \u6d88\u606f\u56de\u76f4\u63a5\u4e22\u5931; \u600e\u4e48\u89e3\u51b3: \u91cd\u65b0\u5bfc\u5165, \u5728\u534a\u591c\u6d41\u91cf\u5c0f\u7684\u65f6\u5019, \u5199\u4e34\u65f6\u7a0b\u5e8f, \u5728\u6d88\u8d39\u8005\u4e2d\u5c06\u4e22\u5931\u7684\u6d88\u606f\u67e5\u51fa\u6765,\u91cd\u65b0\u53d1\u9001\u5230queue\u4e2d(\u6bd4\u5982\u5728\u8ba2\u5355\u670d\u52a1\u4e2d\u67e5\u627e\u4e22\u5931\u76841000\u4e2a\u8ba2\u5355, \u91cd\u65b0\u5bfc\u5165\u5230queue\u4e2d\u7ed9\u5e93\u5b58\u670d\u52a1\u6d88\u8d39;)"),(0,r.kt)("h4",{id:"\u5982\u4f55\u4fdd\u8bc1\u5206\u5e03\u5f0f\u6700\u7ec8\u4e00\u81f4\u6027"},"\u5982\u4f55\u4fdd\u8bc1\u5206\u5e03\u5f0f\u6700\u7ec8\u4e00\u81f4\u6027"),(0,r.kt)("p",null,"\u5206\u5e03\u5f0f\u6700\u7ec8\u4e00\u81f4\u6027\u95ee\u9898 (\u6b63\u5e38\u6765\u8bf4mq\u4f1a\u4fdd\u8bc1\u6700\u7ec8\u4e00\u81f4\u6027,\u4f46\u662f\u5982\u679c\u751f\u4ea7\u8005\u7cfb\u7edf\u5904\u7406\u6210\u529f\u76f4\u63a5\u8fd4\u56de\u6210\u529f, \u67d0\u4e2a\u6d88\u8d39\u8005\u7cfb\u7edf\u51fa\u73b0\u5f02\u5e38,\u6700\u7ec8\u6570\u636e\u4e00\u81f4\u6027\u5c31\u65e0\u6cd5\u4fdd\u8bc1 -- \u9700\u8981\u5f15\u5165\u5206\u5e03\u5f0f\u4e8b\u52a1)"),(0,r.kt)("h1",{id:"\u6709\u54ea\u4e9b\u4ea7\u54c1\u53ef\u4f9b\u9009\u62e9-\u9009\u578b"},"\u6709\u54ea\u4e9b\u4ea7\u54c1\u53ef\u4f9b\u9009\u62e9-\u9009\u578b"),(0,r.kt)("p",null,"ActiveMQ, RabbitMQ\uff0cRocketMQ\uff0cKafka\uff0cRedis"),(0,r.kt)("p",null,"\u9009\u62e9\u54ea\u4e2a\u597d\u5462"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"ActiveMQ - Java\u5b9e\u73b0\uff0c\u51fa\u73b0\u7684\u6700\u65e9\uff0c\u6027\u80fd\u6ca1\u6709\u540e\u6765\u7684mq\u597d\uff1b\u7528\u7684\u8f83\u5c11;")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"RabbitMQ - erlang\u5b9e\u73b0\uff0c\u6027\u80fd\u597d\uff0c \u540e\u53f0\u7ba1\u7406\u754c\u9762\uff1b\u793e\u533a\u6d3b\u8dc3\uff1b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"rocket - \u53ef\u4ee5\u8bf4\u662fkafka\u7684\u53d8\u79cd, java\u7248\u672c\u5b9e\u73b0, \u963f\u91cc\u5f00\u6e90; rocket\u548ckafka\u6709\u7c7b\u4f3c\u65e0\u9650\u5806\u79ef\u7684\u80fd\u529b\uff1b\u652f\u6301\u5206\u5e03\u5f0f\u4e8b\u52a1")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"redis:  \u5e38\u5e38\u7528\u4e8e\u7f13\u5b58\uff0c\u6d88\u606f\u961f\u5217\u4e0d\u662f\u4e3b\u8981\u529f\u80fd"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"redis \u6d88\u606f\u63a8\u9001\uff08\u57fa\u4e8e\u5206\u5e03\u5f0f pub/sub\uff09\u591a\u7528\u4e8e\u5b9e\u65f6\u6027\u8f83\u9ad8\u7684\u6d88\u606f\u63a8\u9001\uff0c\u5e76\u4e0d\u4fdd\u8bc1\u53ef\u9760; \u5176\u4ed6\u7684mq\u548ckafka\u4fdd\u8bc1\u53ef\u9760\u4f46\u6709\u4e00\u4e9b\u5ef6\u8fdf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"redis \u53d1\u5e03\u8ba2\u9605\u9664\u4e86\u8868\u793a\u4e0d\u540c\u7684 topic \u5916\uff0c\u5e76\u4e0d\u652f\u6301\u5206\u7ec4")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Kafka - \u771f\u6b63\u7684\u5206\u5e03\u5f0f\u6d88\u606f\u961f\u5217\uff0c\u4e3b\u8981\u7528\u4e8e\u65e5\u5fd7\u91c7\u96c6\uff0c\u5b9e\u65f6\u6570\u636e\u8ba1\u7b97\uff08spark streaming\uff0cstorm\u4e00\u8d77\u7528\uff09"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"kafka\u4e2d\u53d1\u5e03\u4e00\u4e2a\u4e1c\u897f\uff0c\u591a\u4e2a\u8ba2\u9605\u8005\u53ef\u4ee5\u5206\u7ec4\uff0c\u540c\u4e00\u4e2a\u7ec4\u91cc\u53ea\u6709\u4e00\u4e2a\u8ba2\u9605\u8005\u4f1a\u6536\u5230\u8be5\u6d88\u606f\uff0c\u8fd9\u6837\u53ef\u4ee5\u7528\u4f5c\u8d1f\u8f7d\u5747\u8861")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5b9e\u65f6log\u5206\u6790, \u5e94\u4ed8\u5927\u5e76\u53d1"))))),(0,r.kt)("h1",{id:"rabbitmq"},"RabbitMQ"),(0,r.kt)("h2",{id:"amqp\u534f\u8bae"},"AMQP\u534f\u8bae"),(0,r.kt)("h3",{id:"\u6982\u5ff5"},"\u6982\u5ff5"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://blog.yoodb.com/yoodb/article/detail/1347"},"https://blog.yoodb.com/yoodb/article/detail/1347")),(0,r.kt)("p",null,"AMQP\uff08\u9ad8\u7ea7\u6d88\u606f\u961f\u5217\u534f\u8bae\uff09\u662f\u4e00\u4e2a\u7f51\u7edc\u534f\u8bae\u3002\u5b83\u652f\u6301\u7b26\u5408\u8981\u6c42\u7684\u5ba2\u6237\u7aef\u5e94\u7528\uff08application\uff09\u548c\u6d88\u606f\u4e2d\u95f4\u4ef6\u4ee3\u7406\uff08messaging middleware broker\uff09\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Server: \u4e2d\u95f4\u4ef6\u672c\u4f53, \u63a5\u6536 client \u8fde\u63a5")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"virtual host: \u4e00\u4e2a virtual host \u8868\u793a\u4e00\u4e2a\u4ea4\u6362\u5668\u3001\u6d88\u606f\u961f\u5217\u7684\u96c6\u5408. "),(0,r.kt)("p",{parentName:"li"},"\u6743\u9650\u63a7\u5236\u7684\u6700\u5c0f\u7c92\u5ea6\u662fVirtual Host"),(0,r.kt)("p",{parentName:"li"},"\u6bcf\u4e2a vhost \u672c\u8d28\u4e0a\u5c31\u662f\u4e00\u4e2a mini \u7248\u7684 RabbitMQ \u670d\u52a1\u5668\uff0c\u62e5\u6709\u81ea\u5df1\u7684\u961f\u5217\u3001\u4ea4\u6362\u5668\u3001\u7ed1\u5b9a\u548c\u6743\u9650\u673a\u5236"),(0,r.kt)("p",{parentName:"li"},"\u8fde\u63a5\u65f6\u5fc5\u987b\u6307\u5b9a, RabbitMQ \u9ed8\u8ba4\u7684 vhost \u662f / ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Exchange: \u63a5\u53d7\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\uff0c\u5e76\u6839\u636eBinding\u89c4\u5219\u5c06\u6d88\u606f\u8def\u7531\u7ed9\u670d\u52a1\u5668\u4e2d\u7684\u961f\u5217\u3002 \u5c31\u662f\u4e00\u4e2a\u8def\u7531\u8868"),(0,r.kt)("p",{parentName:"li"},"ExchangeType\u51b3\u5b9a\u4e86Exchange\u8def\u7531\u6d88\u606f\u7684\u884c\u4e3a\uff0c\u4f8b\u5982\uff0c\u5728RabbitMQ\u4e2d\uff0cExchangeType\u6709direct\u3001Fanout\u548cTopic\u4e09\u79cd\uff0c\u4e0d\u540c\u7c7b\u578b\u7684Exchange\u8def\u7531\u7684\u884c\u4e3a\u662f\u4e0d\u4e00\u6837\u7684")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Binding: \u7528\u4e8e Exchange\u4e0eMessage Queue \u7684\u5173\u8054"),(0,r.kt)("p",{parentName:"li"},"Exchange\u5728\u4e0e\u591a\u4e2aMessage Queue\u53d1\u751fBinding\u540e\u4f1a\u751f\u6210\u4e00\u5f20\u8def\u7531\u8868\uff0c\u8def\u7531\u8868\u4e2d\u5b58\u50a8\u7740Message Queue\u6240\u9700\u6d88\u606f\u7684\u9650\u5236\u6761\u4ef6\u5373Binding Key\u3002\u5f53Exchange\u6536\u5230Message\u65f6\u4f1a\u89e3\u6790\u5176Header\u5f97\u5230Routing Key\uff0cExchange\u6839\u636eRouting Key\u4e0eExchange Type\u5c06Message\u8def\u7531\u5230Message Queue\u3002Binding Key\u7531Consumer\u5728Binding Exchange\u4e0eMessage Queue\u65f6\u6307\u5b9a\uff0c\u800cRouting Key\u7531Producer\u53d1\u9001Message\u65f6\u6307\u5b9a\uff0c\u4e24\u8005\u7684\u5339\u914d\u65b9\u5f0f\u7531Exchange Type\u51b3\u5b9a"),(0,r.kt)("p",{parentName:"li"},"Exchange \u548cQueue\u7684\u7ed1\u5b9a\u53ef\u4ee5\u662f\u591a\u5bf9\u591a\u7684\u5173\u7cfb"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Message Queue\uff1a\u6d88\u606f\u961f\u5217\uff0c\u7528\u4e8e\u5b58\u50a8\u8fd8\u672a\u88ab\u6d88\u8d39\u8005\u6d88\u8d39\u7684\u6d88\u606f")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"broker \u5404\u79cd\u5404\u6837\u7684 exchange \u548c queue \u5408\u5728\u4e00\u8d77\u6210\u4e3a broker")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Message: \u7531Header\u548cBody\u7ec4\u6210\uff0c"),(0,r.kt)("p",{parentName:"li"},"Header\u662f\u7531\u751f\u4ea7\u8005\u6dfb\u52a0\u7684\u5404\u79cd\u5c5e\u6027\u7684\u96c6\u5408\uff0c\u5305\u62ecMessage\u662f\u5426\u88ab\u6301\u4e45\u5316\u3001\u7531\u54ea\u4e2aMessage Queue\u63a5\u53d7\u3001\u4f18\u5148\u7ea7\u662f\u591a\u5c11\u7b49\u3002"),(0,r.kt)("p",{parentName:"li"},"\u800cBody\u662f\u771f\u6b63\u9700\u8981\u4f20\u8f93\u7684APP\u6570\u636e"))),(0,r.kt)("p",null,"-Channel:\u4fe1\u9053\uff0c\u4ec5\u4ec5\u521b\u5efa\u4e86\u5ba2\u6237\u7aef\u5230Broker\u4e4b\u95f4\u7684\u8fde\u63a5\u540e\uff0c\u5ba2\u6237\u7aef\u8fd8\u662f\u4e0d\u80fd\u53d1\u9001\u6d88\u606f\u7684\u3002\u9700\u8981\u4e3a\u6bcf\u4e00\u4e2aConnection\u521b\u5efaChannel\uff0cAMQP\u534f\u8bae\u89c4\u5b9a\u53ea\u6709\u901a\u8fc7Channel\u624d\u80fd\u6267\u884cAMQP\u7684\u547d\u4ee4\u3002"),(0,r.kt)("p",null,"  \u4e00\u4e2aConnection\u53ef\u4ee5\u5305\u542b\u591a\u4e2aChannel\u3002\u56e0\u4e3a\u5bf9\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u6765\u8bf4\u5efa\u7acb\u548c\u9500\u6bc1 TCP \u90fd\u662f\u975e\u5e38\u6602\u8d35\u7684\u5f00\u9500\uff0c\u6240\u4ee5\u5f15\u5165\u4e86\u4fe1\u9053\u7684\u6982\u5ff5\uff0c\u4ee5\u590d\u7528\u4e00\u6761 TCP \u8fde\u63a5\u3002"),(0,r.kt)("h3",{id:"\u5de5\u4f5c\u8fc7\u7a0b"},"\u5de5\u4f5c\u8fc7\u7a0b"),(0,r.kt)("p",null,"\u6d88\u606f\uff08message\uff09\u88ab\u53d1\u5e03\u8005\uff08publisher\uff09\u53d1\u9001\u7ed9\u4ea4\u6362\u673a\uff08exchange\uff09, "),(0,r.kt)("p",null,"\u7136\u540e\u4ea4\u6362\u673a\u5c06\u6536\u5230\u7684\u6d88\u606f\u6839\u636e\u8def\u7531\u89c4\u5219\u5206\u53d1\u7ed9\u7ed1\u5b9a\u7684\u961f\u5217\uff08queue\uff09\u3002"),(0,r.kt)("p",null,"\u6700\u540eAMQP\u4ee3\u7406\u4f1a\u5c06\u6d88\u606f\u6295\u9012\u7ed9\u8ba2\u9605\u4e86\u6b64\u961f\u5217\u7684\u6d88\u8d39\u8005\uff0c\u6216\u8005\u6d88\u8d39\u8005\u6309\u7167\u9700\u6c42\u81ea\u884c\u83b7\u53d6"),(0,r.kt)("h3",{id:"\u6d88\u606f\u786e\u8ba4"},"\u6d88\u606f\u786e\u8ba4"),(0,r.kt)("p",null,"\u63a5\u6536\u6d88\u606f\u7684\u5e94\u7528\u4e5f\u6709\u53ef\u80fd\u5728\u5904\u7406\u6d88\u606f\u7684\u65f6\u5019\u5931\u8d25\u3002\u57fa\u4e8e\u6b64\u539f\u56e0\uff0cAMQP\u6a21\u5757\u5305\u542b\u4e86\u4e00\u4e2a\u6d88\u606f\u786e\u8ba4\uff08message acknowledgements\uff09\u7684\u6982\u5ff5\uff1a\u5f53\u4e00\u4e2a\u6d88\u606f\u4ece\u961f\u5217\u4e2d\u6295\u9012\u7ed9\u6d88\u8d39\u8005\u540e\uff08consumer\uff09\uff0c\u6d88\u8d39\u8005\u4f1a\u901a\u77e5\u4e00\u4e0b\u6d88\u606f\u4ee3\u7406\uff08broker\uff09"),(0,r.kt)("p",null,"\u5f53\u201c\u6d88\u606f\u786e\u8ba4\u201d\u88ab\u542f\u7528\u7684\u65f6\u5019\uff0c\u6d88\u606f\u4ee3\u7406\u4e0d\u4f1a\u5b8c\u5168\u5c06\u6d88\u606f\u4ece\u961f\u5217\u4e2d\u5220\u9664\uff0c\u76f4\u5230\u5b83\u6536\u5230\u6765\u81ea\u6d88\u8d39\u8005\u7684\u786e\u8ba4\u56de\u6267\uff08acknowledgement\uff09"),(0,r.kt)("h2",{id:"\u57fa\u672c\u4ecb\u7ecd"},"\u57fa\u672c\u4ecb\u7ecd"),(0,r.kt)("p",null,"\u7531 Erlang \u8bed\u8a00\u5f00\u53d1\u7684 AMQP \u7684\u5f00\u6e90\u5b9e\u73b0, \u53ef\u96c6\u7fa4, \u6709 ui \u754c\u9762, \u6709\u63d2\u4ef6\u673a\u5236"),(0,r.kt)("p",null,"\u4fdd\u8bc1\u6d88\u606f\u53ef\u9760: RabbitMQ \u4f7f\u7528\u4e00\u4e9b\u673a\u5236\u6765\u4fdd\u8bc1\u53ef\u9760\u6027"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"msg ack ",(0,r.kt)("inlineCode",{parentName:"p"},"\u6d88\u606f\u786e\u8ba4(message acknowledgement)"),': \u6709\u591a\u4e2a\u6d88\u8d39\u8005\u7684\u60c5\u51b5\u4e0b, \u4e00\u4e2aconsumer\u5904\u7406\u6d88\u606f\u65f6\u6302\u4e86, \u8fd9\u4e2a\u6d88\u606f\u6ca1\u6709 "\u6d88\u606f\u786e\u8ba4" \u53d1\u7ed9 rabbitmq, \u961f\u5217\u4e2d\u7684\u6d88\u606f\u4e0d\u4f1a\u5220\u9664, \u4f1a\u5c1d\u8bd5\u53d1\u9001\u7ed9\u53e6\u5916\u7684consumer\u5904\u7406')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6301\u4e45\u5316:message, queue \u6301\u4e45\u5316, \u5373\u4f7f rabbitmq \u91cd\u542f, \u961f\u5217, \u6d88\u606f\u4e5f\u4e0d\u4f1a\u4e22\u5931")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u516c\u5e73\u53d1\u5e03: \u4e00\u4e2aconsumer \u540c\u65f6\u53ea\u80fd\u63a5\u53d7\u4e00\u4e2a\u6d88\u606f, \u53d1\u9001\u7ed9 rabbitmq \u4e00\u4e2a\u6d88\u606f\u56de\u6267\u540e\u624d\u4f1a\u88ab\u53d1\u9001\u4e0b\u4e00\u4e2a\u6d88\u606f, \u907f\u514d\u4e86\u4e00\u4e2aconsumer\u7279\u522b\u5fd9\u788c, \u4e00\u4e2aconsumer\u7279\u522b\u95f2\u7684\u95ee\u9898"))),(0,r.kt)("p",null,"\u5176\u4ed6\u7279\u6027:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u865a\u62df\u4e3b\u673a(vhost): \u652f\u6301\u5c06\u4e00\u4e2a rabbit \u5b9e\u4f8b\u5212\u5206\u6210\u591a\u4e2a \u865a\u62df\u5b9e\u4f8b, \u5206\u522b\u7ed9\u4e0d\u540c\u7684\u7cfb\u7edf\u7528, \u8d77\u5230\u9694\u79bb\u7684\u6548\u679c, \u4e00\u4e2a\u7cfb\u7edf\u5bf9\u5e94\u7684\u865a\u62df\u4e3b\u673a\u5d29\u4e86, \u4e0d\u5f71\u54cd\u5269\u4e0b\u7684\u865a\u62df\u4e3b\u673a")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u96c6\u7fa4: \u662f\u955c\u50cf\u96c6\u7fa4, \u53ea\u80fd\u63d0\u9ad8\u541e\u5410\u91cf, \u65e0\u6cd5\u4fdd\u8bc1\u53ef\u65e0\u9650\u62d3\u5c55"))),(0,r.kt)("p",null,"\u5b89\u88c5:"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/qq_22638399/article/details/81704372"},"https://blog.csdn.net/qq_22638399/article/details/81704372")),(0,r.kt)("p",null,"erlang \u547d\u4ee4\u884c\u9000\u51fa\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/cnxieyang/article/details/52710967"},"https://blog.csdn.net/cnxieyang/article/details/52710967")),(0,r.kt)("p",null,"WSL \u4e2d\u6709bug \uff0c \u5751\u7239\u8d27"),(0,r.kt)("p",null,"docker + rabbitmq\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://www.jianshu.com/p/14ffe0f3db94"},"https://www.jianshu.com/p/14ffe0f3db94")),(0,r.kt)("h2",{id:"\u51e0\u79cd\u6d88\u606f\u6a21\u578b"},"\u51e0\u79cd\u6d88\u606f\u6a21\u578b"),(0,r.kt)("p",null,"RabbitMQ\u63d0\u4f9b\u4e866\u79cd\u6d88\u606f\u6a21\u578b\uff0c\u4f46\u662f\u7b2c6\u79cd\u5176\u5b9e\u662fRPC\uff0c\u5e76\u4e0d\u662fMQ; 3\u30014\u30015\u8fd9\u4e09\u79cd\u90fd\u5c5e\u4e8e\u8ba2\u9605\u6a21\u578b\uff0c\u53ea\u4e0d\u8fc7\u8fdb\u884c\u8def\u7531\u7684\u65b9\u5f0f\u4e0d\u540c\u3002"),(0,r.kt)("h3",{id:"hello-world"},"hello-world"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"+------------------+                                                                  +---------------------+\n|                  |                                                                  |                     |\n|                  |              +------+----+-----+-----+-----+-----+               |                     |\n|                  |              |      |    |     |     |     |     |               |                     |\n|    publisher     |              | queue|    |     |     |     |     |               |       consumer      |\n|                  |              |      |    |     |     |     |     |               |                     |\n|                  +----------\x3e   |      |    |     |     |     |     +--------------\x3e+                     |\n|                  |              |      |    |     |     |     |     |               |                     |\n|                  |              |      |    |     |     |     |     |               |                     |\n|                  |              +------+----+-----+-----+-----+-----+               |                     |\n|                  |                                                                  +---------------------+\n+------------------+\n\n\n")),(0,r.kt)("h3",{id:"worker-queue"},"worker-queue"),(0,r.kt)("p",null,"\u8ba9\u591a\u4e2a\u6d88\u8d39\u8005\u7ed1\u5b9a\u5230\u4e00\u4e2a\u961f\u5217\uff0c\u5171\u540c\u6d88\u8d39\u961f\u5217\u4e2d\u7684\u6d88\u606f\u3002\u961f\u5217\u4e2d\u7684\u6d88\u606f\u4e00\u65e6\u6d88\n\u8d39\uff0c\u5c31\u4f1a\u6d88\u5931\uff0c\u56e0\u6b64\u6d88\u606f\u4e0d\u4f1a\u91cd\u590d\u6d88\u8d39"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"+--------------+         +------+----+-----+        +-------------+\n|              |         |      |    |     |        |             |\n               |         | queue|    |     |        | consumer    |\n|   publisher  |         |      |    |     |        |             |\n|              +-----\x3e   |      |    |     | -------+             |\n|              |         |      |    |     |        +-------------+\n|              |         |      |    |     |        +--------------+\n+--------------+         +------+----+-+---+        |              |\n                                       |            |    consumer  |\n                                       +------------+              |\n                                                    |              |\n                                                    +--------------+\n\n\n")),(0,r.kt)("h3",{id:"\u53d1\u5e03\u8ba2\u9605"},"\u53d1\u5e03\u8ba2\u9605"),(0,r.kt)("p",null,"\u53ef\u4ee5\u5206\u4e09\u7c7b (\u5b9e\u9645\u4e0a\u5bf9\u5e94\u4e86\u4e09\u79cdExchange\u7c7b\u578b)"),(0,r.kt)("p",null,"=================\u5e7f\u64ad\u8ba2\u9605: \u5bf9\u5e94 exchange type \u4e3a fanout"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"provider \u5411 exchange \u53d1\u9001\u6d88\u606f")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"exchange \u5c06\u6d88\u606f\u53d1\u9001\u7ed9\u6240\u6709 queue (\u6d88\u606f\u88ab\u5e7f\u64ad)"),(0,r.kt)("p",{parentName:"li"},"exchange \u548c\u6240\u6709 queue \u7ed1\u5b9a")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"consumer \u4ece queue \u62ff\u5230\u6d88\u606f "),(0,r.kt)("p",{parentName:"li"},"\u82e5 \u4e24\u4e2a consumer \u4ece\u540c\u4e00\u4e2a queue \u62ff\u53bb\u6d88\u606f, \u6d88\u606f\u4e0d\u4f1a\u91cd\u590d"),(0,r.kt)("p",{parentName:"li"},"\u82e5\u4e24\u4e2a consumer \u4ece\u4e0d\u540c queue \u62ff\u6d88\u606f, \u4f1a\u91cd\u590d (\u4e5f\u5c31\u662f\u6d88\u606f\u88ab\u5e7f\u64ad\u4e86)"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"                                        +------+\n                                        |      |\n                                        +------+       +---------+\n                                        |      |       |         |\n                            +-----------+      +-------+   consumer\n                            |           +------+       |         |\n+-------------+             |           |      |       +---------+\n|             |     +-------+-+         +------+\n|             +-----+exchange |\n|    publisher|     |         |        +------+\n|             |     +-------+-+        |      |\n+-------------+             |          +------+      +------------+\n                            +----------+      +------+            |\n                     type: fanout      +------+      |  consumer  |\n                                       +------+      |            |\n                                                     +------------+\n\n")),(0,r.kt)("p",null,"=======================\u8def\u7531\u8ba2\u9605: exchange type \u4e3a Direct"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"provider \u5411 exchange \u53d1\u9001\u6d88\u606f, \u5fc5\u987b\u6307\u5b9a\u6d88\u606f\u7684routing key")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"exchange \u63a5\u6536\u6d88\u606f, \u7136\u540e\u628a\u6d88\u606f\u9012\u4ea4\u7ed9 \u4e0erouting key\u5b8c\u5168\u5339\u914d\u7684\u961f\u5217"),(0,r.kt)("p",{parentName:"li"},"queue \u6307\u5b9a\u63a5\u6536\u54ea\u4e9b routing key"),(0,r.kt)("p",{parentName:"li"},"\u5982 \u67d0\u4e2a\u6d88\u606f msg1 (routing key = xxx), msg2 (key = yyy), msg3 (key = zzz), queue1 (\u6307\u5b9a routing key = xxx), queue2 (key = xxx, yyy), \u90a3\u4e48 queue1 \u7684consumer\u4f1a\u63a5\u6536\u5230 msg1, queue2 \u7684consumer \u4f1a\u63a5\u6536\u5230 msg1, msg2. ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5404\u4e2a consumer \u4ece \u81ea\u5df1\u7684queue\u62ff\u53bb\u6d88\u606f"))),(0,r.kt)("p",null,"=============================topic \u4e3b\u9898\u8ba2\u9605: exchange type = topic. \u662f\u8def\u7531\u8ba2\u9605\u7684\u5347\u7ea7\u7248, routing key \u652f\u6301\u901a\u914d\u7b26"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"#\uff1a\u5339\u914d\u4e00\u4e2a\u6216\u591a\u4e2a\u8bcd (\u6ce8\u610f\u4e0d\u662f\u5b57\u6bcd)"),(0,r.kt)("li",{parentName:"ul"},"*\uff1a\u5339\u914d\u4e0d\u591a\u4e0d\u5c11\u6070\u597d 1 \u4e2a\u8bcd")),(0,r.kt)("h3",{id:"rpc"},"rpc"),(0,r.kt)("h2",{id:"\u4f7f\u7528-rabbit"},"\u4f7f\u7528 rabbit"),(0,r.kt)("p",null,"springboot\u6574\u5408"),(0,r.kt)("p",null,"\u5f15\u5165 ",(0,r.kt)("inlineCode",{parentName:"p"},"spring-boot-starter-amqp")," (\u7b26\u5408 amqp \u534f\u8bae\u7684\u5b9e\u73b0\u90fd\u53ef\u4ee5\u7528)"),(0,r.kt)("h3",{id:"\u6d88\u606f\u7684\u5e8f\u5217\u5316"},"\u6d88\u606f\u7684\u5e8f\u5217\u5316"),(0,r.kt)("p",null,"RabbitMQ \u7684\u5e8f\u5217\u5316\u662f\u6307 Message \u7684 body \u5c5e\u6027\uff0c\u5373\u6211\u4eec\u771f\u6b63\u9700\u8981\u4f20\u8f93\u7684\u5185\u5bb9\uff0c"),(0,r.kt)("p",null,"RabbitMQ \u62bd\u8c61\u51fa\u4e00\u4e2a MessageConvert \u63a5\u53e3\u5904\u7406\u6d88\u606f\u7684\u5e8f\u5217\u5316, \u5f53\u8c03\u7528\u4e86 convertAndSend \u65b9\u6cd5\u65f6\u4f1a\u4f7f\u7528 MessageConvert \u8fdb\u884c\u6d88\u606f\u7684\u5e8f\u5217\u5316\uff0c\u5176\u5b9e\u73b0\u6709 : "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"SimpleMessageConverter\uff08\u9ed8\u8ba4\uff09"),(0,r.kt)("p",{parentName:"li"},"\u5bf9\u4e8e\u8981\u53d1\u9001\u7684\u6d88\u606f\u4f53 body \u4e3a byte[] \u65f6\u4e0d\u8fdb\u884c\u5904\u7406\uff0c"),(0,r.kt)("p",{parentName:"li"},"\u5982\u679c\u662f String \u5219\u8f6c\u6210\u5b57\u8282\u6570\u7ec4,"),(0,r.kt)("p",{parentName:"li"},"\u5982\u679c\u662f Java \u5bf9\u8c61\uff0c\u5219\u4f7f\u7528 jdk \u5e8f\u5217\u5316\u5c06\u6d88\u606f\u8f6c\u6210\u5b57\u8282\u6570\u7ec4\uff0c\u8f6c\u51fa\u6765\u7684\u7ed3\u679c\u8f83\u5927\uff0c\u542bclass\u7c7b\u540d\uff0c\u7c7b\u76f8\u5e94\u65b9\u6cd5\u7b49\u4fe1\u606f\u3002\u56e0\u6b64\u6027\u80fd\u8f83\u5dee;\u6b64\u65f6\u5c31\u8981\u8003\u8651\u4f7f\u7528\u7c7b\u4f3c Jackson2JsonMessageConverter \u7b49\u5e8f\u5217\u5316\u5f62\u5f0f\u4ee5\u6b64\u63d0\u9ad8\u6027\u80fd")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Jackson2JsonMessageConverter ;"))),(0,r.kt)("p",null,"\u8981\u81ea\u5b9a\u4e49\u9700\u8981\u5982\u4e0b\u914d\u7f6e:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\npublic class MyAMQPConfig {\n    @Bean\n    public MessageConverter messageConverter(){\n          return new Jackson2JsonMessageConverter();\n    }\n}\n")),(0,r.kt)("p",null,"\u6216\u8005:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\npublic class RabbitMQConfig {\n\n    @Bean\n    public RabbitListenerContainerFactory<?> rabbitListenerContainerFactory(ConnectionFactory connectionFactory){\n        SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory();\n        factory.setConnectionFactory(connectionFactory);\n        factory.setMessageConverter(new MessageConverter() {\n            @Override\n            public Message toMessage(Object object, MessageProperties messageProperties) throws MessageConversionException {\n                return null;\n            }\n\n            @Override\n            public Object fromMessage(Message message) throws MessageConversionException {\n                try(ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(message.getBody()))){\n                    return (User)ois.readObject();\n                }catch (Exception e){\n                    e.printStackTrace();\n                    return null;\n                }\n            }\n        });\n\n        return factory;\n    }\n\n}\n")),(0,r.kt)("h3",{id:"\u53d1\u9001"},"\u53d1\u9001"),(0,r.kt)("p",null,"\u4f7f\u7528\u9ed8\u8ba4\u7684 exchange"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// \u9700\u8981\u6ce8\u518c\u4e00\u4e2a queue, \u5426\u5219\u6d88\u606f\u53ea\u4f1a\u5230 exchange, \u4e0d\u4f1a\u5b58\u5165 queue\n@Configuration\npublic class RabbitConfig {\n    @Bean\n    public Queue queueHello() {\n        return new Queue("hello_queue");\n    }\n\n}\n\n// \u7136\u540e\u4f7f\u7528:\n\n@Autowired\nprivate final AmqpTemplate template;\n\n/**\n* \u53d1\u9001\u5230\u9ed8\u8ba4 exchange, \u4e0d\u4f1a\u53d1\u9001\u5230 queue\n*\n*/\npublic void sendMessage(String msg) {\n  // \u6ce8\u610fMessageBuilder \u4e0d\u662f\u5e26\u6cdb\u578b\u7684\u90a3\u4e2a\n    template.send(MessageBuilder.withBody(msg.getBytes(StandardCharsets.UTF_8)).build());\n}\n\n/**\n\u53d1\u9001\u5230 \u9ed8\u8ba4 exchange, \u7136\u540e\u8f6c\u53d1\u5230 queue (queue name  = hello_queue)\n\n\u4e5f\u5c31\u662f\u8bf4, \u9ed8\u8ba4 exchange \u4e0d\u7528 binding , \u53d1\u9001\u65f6, routing key \u6307\u5b9a\u4e3a queue name \u5373\u53ef\u88ab \u8be5 queue \u6536\u5230\n*/\npublic void send1(String msg) {\n  // \u81ea\u52a8\u8f6c\u6362\u4e3a Message \u540e\u53d1\u9001\n    this.template.convertAndSend("hello_queue", msg);\n    System.out.println("sender: \u53d1\u9001\u4e86 " + msg);\n}\n\npublic void sendWithTopic(String msg, String routingKey) {\n  // \u53d1\u9001\u7ed9\u6307\u5b9a\u7684 exchange\n    this.template.convertAndSend("exchange", routingKey, msg);\n}\n')),(0,r.kt)("p",null,"\u81ea\u5df1\u6307\u5b9a exchange:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Configuration\npublic class TopicExchangeConfig {\n    @Bean\n    public Queue queue1() {\n        return new Queue("queue_1");\n    }\n\n    @Bean\n    public Queue queue2() {\n        return new Queue("queue_2");  // \u9700\u8981\u6307\u5b9a name\n    }\n\n    @Bean\n    public TopicExchange exchange() {\n        return new TopicExchange("exchange");  // \u9700\u8981\u6307\u5b9a name\n    }\n\n    // binding exchange and queue with routing key\n    @Bean\n    public Binding bindingQueue1(Queue queue1, TopicExchange exchange) {\n        return BindingBuilder.bind(queue1).to(exchange).with("topic.message");\n    }\n\n    @Bean\n    public Binding bindingQueue2(Queue queue2, TopicExchange exchange) {\n        return BindingBuilder.bind(queue2).to(exchange).with("topic.#");\n    }\n}\n\n// \u4f7f\u7528\n\n/**\n  * \u5e26 exchange \u548c routing key \u53d1\u9001\n  */\npublic void sendWithTopic(String msg, String routingKey) {\n    this.template.convertAndSend("exchange", routingKey, msg);\n}\n')),(0,r.kt)("h3",{id:"\u63a5\u6536"},"\u63a5\u6536"),(0,r.kt)("p",null,"========================\u5355\u72ec\u4f7f\u7528 @RabbitListener \u6ce8\u89e3\u6765\u6307\u5b9a\u67d0\u65b9\u6cd5\u4f5c\u4e3a\u6d88\u606f\u6d88\u8d39\u7684\u65b9\u6cd5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class Receiver2 {\n    @RabbitListener(queues = "queue_2")\n    public void process(String msg) {\n        System.out.println("receiver2: " + msg);\n    }\n\n    @RabbitListener(queues = {"hello_queue"})\n    public void processHelloQueue(String msg) {\n        System.out.println(">>> receive msg from hello_queue: " + msg);\n    }\n}\n')),(0,r.kt)("p",null,"========================@RabbitListener \u548c @RabbitHandler \u642d\u914d\u4f7f\u7528"),(0,r.kt)("p",null,"(@RabbitListener \u6807\u6ce8\u5728\u7c7b\u4e0a\u9762\u8868\u793a\u5f53\u6709\u6536\u5230\u6d88\u606f\u7684\u65f6\u5019\uff0c\u5c31\u4ea4\u7ed9 @RabbitHandler \u7684\u65b9\u6cd5\u5904\u7406\uff0c\u5177\u4f53\u4f7f\u7528\u54ea\u4e2a\u65b9\u6cd5\u5904\u7406\uff0c\u6839\u636e MessageConverter \u8f6c\u6362\u540e\u7684\u53c2\u6570\u7c7b\u578b)"),(0,r.kt)("p",null,"\u6b64\u65f6\u9700\u8981\u6709\u4e00\u4e2a\u9ed8\u8ba4\u7684\u5904\u7406\u65b9\u6cd5 @RabbitHandler(isDefault=true)\uff0c\u9ed8\u8ba4\u662ffalse\u3002\u4e0d\u8bbe\u7f6e\u4e00\u4e2atrue\uff0c\u6d88\u8d39mq\u6d88\u606f\u7684\u65f6\u5019\u4f1a\u51fa\u73b0\u201cListener method \u2018no match\u2019 threw exception\u201d\u5f02\u5e38\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// \u4e3a consumer \u6307\u5b9a queue\n// \u76d1\u542c\n@Component\n@RabbitListener(queues = "consumer_queue")\npublic class Receiver {\n\n    @RabbitHandler\n    public void processMessage1(String message) {\n        System.out.println(message);\n    }\n\n    @RabbitHandler\n    public void processMessage2(byte[] message) {\n        System.out.println(new String(message));\n    }\n}\n')),(0,r.kt)("p",null,"===============\u4f7f\u7528 \u4f7f\u7528 @Payload \u548c @Headers \u6ce8\u89e3\u53ef\u4ee5\u6d88\u606f\u4e2d\u7684 body \u4e0e headers \u4fe1\u606f, \u4e0d\u4f7f\u7528\u7684\u8bdd\u9ed8\u8ba4\u65b9\u6cd5\u53c2\u6570\u5c31\u662f body"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@RabbitListener(queues = "debug")\npublic void processMessage1(@Payload String body, @Headers Map<String,Object> headers) {\n    System.out.println("body\uff1a"+body);\n    System.out.println("Headers\uff1a"+headers);\n}\n\n// \u83b7\u53d6\u5355\u4e2a header\u5c5e\u6027\n\n@RabbitListener(queues = "debug")\npublic void processMessage1(@Payload String body, @Header String token) {\n    System.out.println("body\uff1a"+body);\n    System.out.println("token\uff1a"+token);\n}\n')),(0,r.kt)("p",null,"===========================\u751a\u81f3 \u53ef\u4ee5\u5728 consumer \u7aef \u901a\u8fc7 rabbitListener \u8bbe\u7f6e binding:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@RabbitListener(bindings = @QueueBinding(\n        exchange = @Exchange(value = "topic.exchange",durable = "true",type = "topic"),\n        value = @Queue(value = "consumer_queue",durable = "true"),\n        key = "key.#"\n))\npublic void processMessage1(Message message) {\n    System.out.println(message);\n}\n')),(0,r.kt)("h3",{id:"\u6301\u4e45\u5316"},"\u6301\u4e45\u5316"),(0,r.kt)("p",null,"\u4e3a\u4ec0\u4e48\u9700\u8981\u6301\u4e45\u5316? \u4e2d\u95f4\u4ef6\u670d\u52a1\u5668\u5f02\u5e38\u91cd\u542f, \u6570\u636e\u4f1a\u4e22\u5931"),(0,r.kt)("p",null,"\u6301\u4e45\u5316\u4f1a\u9020\u6210\u6027\u80fd\u635f\u8017\u3002\u53ef\u4ee5\u901a\u8fc7",(0,r.kt)("inlineCode",{parentName:"p"},"\u8bbe\u7f6e\u6d88\u606f\u8fc7\u671f\u65f6\u95f4"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"\u964d\u4f4e\u53d1\u9001\u6d88\u606f\u5927\u5c0f"),"\u7b49\u5176\u4ed6\u65b9\u5f0f\u6765\u5c3d\u53ef\u80fd\u7684\u964d\u4f4eMQ\u6027\u80fd\u7684\u964d\u4f4e\u3002"),(0,r.kt)("p",null,"\u5206\u4e3a\u5982\u4e0b\u4e09\u4e2a: (\u5747\u53ef\u901a\u8fc7 \u6784\u9020\u51fd\u6570\u7684 durable \u6307\u5b9a, \u9ed8\u8ba4\u90fd\u662f true)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"queue \u7684\u6301\u4e45\u5316"),(0,r.kt)("p",{parentName:"li"},"\u901a\u8fc7\u6784\u9020\u51fd\u6570\u8bbe\u7f6e")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"exchange \u7684\u6301\u4e45\u5316"),(0,r.kt)("p",{parentName:"li"},"\u901a\u8fc7\u6784\u9020\u51fd\u6570\u8bbe\u7f6e")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"message \u7684\u6301\u4e45\u5316 (\u5fc5\u987b\u5728 queue \u7684\u6301\u4e45\u5316\u57fa\u7840\u4e0a\u624d\u6709\u610f\u4e49)"),(0,r.kt)("p",{parentName:"li"},"\u5e95\u5c42\u5c31\u662f AMQP.BasicProperties\u7684\u5c5e\u6027deliveryMode\u8bbe\u7f6e\u4e3a2"),(0,r.kt)("p",{parentName:"li"},"\u53d1\u9001\u6d88\u606f\u65f6, \u901a\u8fc7\u6d88\u606f\u540e\u5904\u7406\u8bbe\u7f6e\u6301\u4e45\u5316",(0,r.kt)("inlineCode",{parentName:"p"},"convertAndSend(.... , new MessagePostProcessor() {message.getMessageProperties().setDeliveryMode(MessageDeliveryMode.PERSISTENT);})")))),(0,r.kt)("p",null,"\u90fd\u8bbe\u7f6e\u6301\u4e45\u5316\u4e4b\u540e\u5c31\u80fd\u4fdd\u8bc1\u6570\u636e\u4e0d\u4f1a\u88ab\u4e22\u5931\u5417\uff1f\u5f53\u7136\u4e0d\u662f\uff0c\u591a\u4e2a\u65b9\u9762:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5728\u6d88\u8d39\u8005\u7aef, \u5982\u679c\u6d88\u606f\u7684\u81ea\u52a8\u786e\u8ba4\u4e3atrue\uff0c\u90a3\u4e48\u5728\u6d88\u606f\u88ab\u63a5\u6536\u4ee5\u540e\uff0cRabbitMQ\u5c31\u4f1a\u5220\u9664\u8be5\u6d88\u606f\uff0c\u5047\u5982\u6d88\u8d39\u7aef\u6b64\u65f6\u5b95\u673a\uff0c\u90a3\u4e48\u6d88\u606f\u5c31\u4f1a\u4e22\u5931\u3002"),(0,r.kt)("p",{parentName:"li"},"\u56e0\u6b64\u9700\u8981\u5c06\u6d88\u606f\u8bbe\u7f6e\u4e3a\u624b\u52a8\u786e\u8ba4\u3002\u5373\u6d88\u8d39\u5b8c\u6210\u540e\u518d\u53d1\u9001\u786e\u8ba4")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5728rabbitmq\u670d\u52a1\u7aef\uff0c\u5982\u679c\u6d88\u606f\u6b63\u786e\u88ab\u53d1\u9001\uff0c\u4f46\u662frabbitmq\u672a\u6765\u5f97\u53ca\u6301\u4e45\u5316\uff0c\u6ca1\u6709\u5c06\u6570\u636e\u5199\u5165\u78c1\u76d8\uff0c\u670d\u52a1\u5f02\u5e38\u800c\u5bfc\u81f4\u6570\u636e\u4e22\u5931\uff0c"),(0,r.kt)("p",{parentName:"li"},"\u89e3\u51b3\u65b9\u6848\uff0c\u53ef\u4ee5\u901a\u8fc7rabbitmq\u96c6\u7fa4\u7684\u65b9\u5f0f\u5b9e\u73b0\u6d88\u606f\u4e2d\u95f4\u4ef6\u7684\u9ad8\u53ef\u7528\u6027"))),(0,r.kt)("h3",{id:"\u6d88\u606f\u786e\u8ba4\u673a\u5236-\u624b\u52a8\u786e\u8ba4-\u56de\u8c03"},"\u6d88\u606f\u786e\u8ba4\u673a\u5236-\u624b\u52a8\u786e\u8ba4-\u56de\u8c03"),(0,r.kt)("p",null,"\u786e\u8ba4\u673a\u5236\u6709\u4e24\u79cd:"),(0,r.kt)("h4",{id:"\u6d88\u606f\u53d1\u9001\u786e\u8ba4"},"\u6d88\u606f\u53d1\u9001\u786e\u8ba4"),(0,r.kt)("p",null,"\u5206\u4e3a\u4e24\u6b65"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u662f\u5426\u5230\u8fbe exchange \u7684\u786e\u8ba4; "),(0,r.kt)("p",{parentName:"li"},"\u5b9e\u73b0 RabbitTemplate.ConfirmCallBack\u63a5\u53e3\uff0c\u6d88\u606f\u53d1\u9001\u5230\u4ea4\u6362\u5668Exchange\u540e\u89e6\u53d1\u56de\u8c03 (\u5b9e\u9645\u662f\u53d1\u9001\u5230 broker \u51fa\u53d1\u56de\u8c03, \u800c broker \u5305\u542b exchange \u548c queue, \u6240\u4ee5\u53ef\u4ee5\u8ba4\u4e3a exchange \u51fa\u53d1\u56de\u8c03)"),(0,r.kt)("p",{parentName:"li"},"\u4e3a rabbitTemplate \u914d\u7f6e @PostConstruct ",(0,r.kt)("inlineCode",{parentName:"p"},"rabbitTemplate.setConfirmCallback(new ConfirmCallBackHandler())")),(0,r.kt)("p",{parentName:"li"},"\u8bbe\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"spring.rabbitmq.publisher-confirms = true"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u662f\u5426\u5230\u8fbe queue \u7684\u786e\u8ba4 (\u6bd4\u5982\u6839\u636e\u53d1\u9001\u6d88\u606f\u65f6\u6307\u5b9a\u7684routingKey\u627e\u4e0d\u5230\u961f\u5217\u65f6\u4f1a\u89e6\u53d1)"),(0,r.kt)("p",{parentName:"li"},"\u5b9e\u73b0 RabbitTemplate.ReturnCallback \u63a5\u53e3"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"abbitTemplate.setReturnCallback(new ReturnCallBackHandler());")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"spring.rabbitmq.publisher-returns = true")))),(0,r.kt)("p",null,"\u82e5\u6ca1\u6709 ack, \u751f\u4ea7\u8005\u8fd9\u8fb9\u4e1a\u52a1\u8fd9\u6837\u63a7\u5236: \u6bd4\u5982\u751f\u4ea7\u8005\u6bcf\u6b21\u53d1\u6d88\u606f\u4e4b\u524d\u5148\u628a\u6d88\u606f\u4fdd\u5b58\u5230\u672c\u5730\uff0c\u5982\u679c\u6536\u5230ack\u5c31\u628a\u8fd9\u4e2a\u6d88\u606f\u7ed9\u5220\u9664\uff0c\u6ca1\u6709\u6536\u5230\u5c31\u9694\u4e00\u6bb5\u65f6\u95f4\u91cd\u8bd5\uff0c\u6700\u591a\u91cd\u8bd5\u4e2a3\u6b21\uff0c\u8fd8\u662f\u6ca1\u6536\u5230\u5c31\u628a\u8fd9\u4e2a\u6d88\u606f\u767b\u8bb0\u8d77\u6765\u540e\u7eed\u5904\u7406\uff0c\u4e0d\u518d\u53d1\u9001\u4e86"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@configuration\nclass config {\n  @autowired\n  RabbitmqTemplate tt;\n\n\n  @PostConstruct\n  public void initRabbitTemplate() {\n    //RabbitTemplate.ConfirmCallBack\n    tt.setConfirmCallback(() -> {\n      // ...\n    })\n  }\n}\n")),(0,r.kt)("h4",{id:"\u6d88\u606f\u6d88\u8d39\u786e\u8ba4"},"\u6d88\u606f\u6d88\u8d39\u786e\u8ba4"),(0,r.kt)("p",null,"\u5c31\u662f \u6d88\u606f\u662f\u5426\u88ab consumer \u6d88\u8d39"),(0,r.kt)("p",null,"\u6709\u4e09\u79cd\u6a21\u5f0f: AcknowledgeMode.NONE/AUTO/MANUAL, \u9ed8\u8ba4\u662f auto, consumer \u63a5\u6536\u5230\u6d88\u606f\u4f1a\u81ea\u52a8\u786e\u8ba4, \u4e0d\u7ba1\u6d88\u606f\u662f\u5426\u5b8c\u5168\u88ab\u6d88\u8d39\u5b8c\u6210, broker \u90fd\u4f1a\u5220\u9664\u8fd9\u6761\u6d88\u606f,\u4efb\u52a1\u6d88\u8d39\u5b8c\u6210\u4e86"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"spring.rabbitmq.listener.simple.acknowledge-mode = manual")," \u624b\u52a8\u786e\u8ba4"),(0,r.kt)("p",null,"\u5982\u679c\u662f\u81ea\u5b9a\u4e49\u7684\u76d1\u542c\u5bb9\u5668, \u914d\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"SimpleRabbitListenerContainerFactory")," \u5373\u53ef"),(0,r.kt)("p",null,"\u6d88\u8d39\u8005\u6210\u529f\u786e\u8ba4:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Component\n@RabbitListener(queues = "confirm_queue_B")\npublic class Customer {\n    @RabbitHandler\n    public void process(Message message, Channel channel){\n        System.out.println("ReceiverA\uff1a"+new String(message.getBody()));\n        // delivertag \u5c31\u662f\u4e00\u4e2a\u6570\u5b57, \u5728 channel \u5185\u6bcf\u6536\u5230\u4e00\u6761\u6d88\u606f\u5c31\u81ea\u589e\n        // \u53c2\u6570 2: \u662f\u5426\u6279\u91cf\u786e\u8ba4\u6d88\u606f; \u4e00\u822c\u4e3a false, \u6bcf\u6761\u6d88\u606f\u90fd\u5206\u522b\u7b7e\u6536\u786e\u8ba4\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(),true);\n}\n\n')),(0,r.kt)("p",null,"\u6d88\u8d39\u8005\u5931\u8d25\u786e\u8ba4:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Component\n@RabbitListener(queues = "confirm_queue_B")\npublic class Customer {\n    @RabbitHandler\n    public void processJsonMessage(@Payload String body, @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag, Message message,Channel channel){      \n        System.out.println("ReceiverA\uff1a"+new String(message.getBody()));\n        // \u53c2\u6570 2: \u662f\u5426\u6279\u91cf\u62d2\u7edd\n        // \u53c2\u6570 3: \u662f\u5426\u91cd\u65b0\u52a0\u5165 queue \u7b49\u5f85\u6d88\u8d39\n        channel.basicNack(deliveryTag,true,true);\n}\n\n// \u8fd8\u53ef\u4ee5\u4e00\u6b21\u53ea\u62d2\u7edd\u4e00\u6761\u6d88\u606f\n@Component\n@RabbitListener(queues = "confirm_queue_B")\npublic class Customer {\n     public void processJsonMessage(@Payload String body, @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag, Message message,Channel channel){  \n        System.out.println("ReceiverA\uff1a"+new String(message.getBody()));\n        channel.basicReject(deliveryTag,true);\n}\n\n// channel.basicNack \u4e0e channel.basicReject \u7684\u533a\u522b\u5728\u4e8ebasicNack\u53ef\u4ee5\u6279\u91cf\u62d2\u7edd\u591a\u6761\u6d88\u606f\uff0c\u800cbasicReject\u4e00\u6b21\u53ea\u80fd\u62d2\u7edd\u4e00\u6761\u6d88\u606f\n')),(0,r.kt)("p",null,"\u6d88\u606f\u624b\u52a8\u62d2\u7edd\u4e2d\u5982\u679crequeue\u4e3atrue\u4f1a\u91cd\u65b0\u653e\u5165\u961f\u5217\uff0c\u4f46\u662f\u5982\u679c\u6d88\u8d39\u8005\u5728\u5904\u7406\u8fc7\u7a0b\u4e2d\u4e00\u76f4\u629b\u51fa\u5f02\u5e38\uff0c\u4f1a\u5bfc\u81f4\u5165\u961f-\u300b\u62d2\u7edd-\u300b\u5165\u961f\u7684\u5faa\u73af\uff0c\u8be5\u600e\u4e48\u5904\u7406\u5462\uff1f======== \u5148\u6210\u529f\u786e\u8ba4\uff0c\u7136\u540e\u901a\u8fc7",(0,r.kt)("strong",{parentName:"p"},"channel.basicPublish()"),"\u91cd\u65b0\u53d1\u5e03\u8fd9\u4e2a\u6d88\u606f\u3002\u91cd\u65b0\u53d1\u5e03\u7684\u6d88\u606f\u7f51\u4e0a\u8bf4\u4f1a\u653e\u5230\u961f\u5217\u540e\u9762\uff0c\u8fdb\u800c\u4e0d\u4f1a\u5f71\u54cd\u5df2\u7ecf\u8fdb\u5165\u961f\u5217\u7684\u6d88\u606f\u5904\u7406\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Component\n@RabbitListener(queues = "confirm_queue_B")\npublic class AckTempalte {\n    enum Action{\n        ACCEPT, // \u5904\u7406\u6210\u529f\n        RETRY, // \u53ef\u4ee5\u91cd\u8bd5\u7684\u9519\u8bef\n        REJECT, // \u65e0\u9700\u91cd\u8bd5\u7684\u9519\u8bef\n    }\n    @RabbitHandler\n    public void processJsonUser(Message message, Channel channel){\n        Action action=Action.ACCEPT;\n        long tag=message.getMessageProperties().getDeliveryTag();\n        try{\n            System.out.println( message.getMessageProperties().getConsumerTag());\n            String message1 = new String(message.getBody(), "UTF-8");\n            System.out.println("\u83b7\u53d6\u6d88\u606f\'" + message1 + "\'");\n\n        }catch (Exception e){\n            // \u6839\u636e\u5f02\u5e38\u79cd\u7c7b\u51b3\u5b9a\u662fACCEPT\u3001RETRY\u8fd8\u662f REJECT\n            action = Action.RETRY;\n            e.printStackTrace();\n\n        }finally {\n            try {\n                // \u901a\u8fc7finally\u5757\u6765\u4fdd\u8bc1Ack/Nack\u4f1a\u4e14\u53ea\u4f1a\u6267\u884c\u4e00\u6b21\n                if (action == Action.ACCEPT) {\n                    channel.basicAck(tag, true);\n                    \n                }\n                // \u91cd\u8bd5\n                else if (action == Action.RETRY) {\n                    channel.basicNack(tag, false, true);// \u6700\u540e\u4e00\u4e2a true \u8868\u793a \u91cd\u65b0\u5165 queue\n                    Thread.sleep(2000L);\n                } \n                // \u62d2\u7edd\u6d88\u606f\u4e5f\u76f8\u5f53\u4e8e\u4e3b\u52a8\u5220\u9664mq\u961f\u5217\u7684\u6d88\u606f\n                else {\n                    channel.basicNack(tag, false, false);\n                }\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\n')),(0,r.kt)("h3",{id:"\u4f7f\u7528-amqpadmin-\u96c6\u4e2d\u914d\u7f6e-rabbitmq"},"\u4f7f\u7528 amqpAdmin \u96c6\u4e2d\u914d\u7f6e rabbitmq"),(0,r.kt)("h1",{id:"kafka"},"kafka"),(0,r.kt)("h2",{id:"kafka-\u57fa\u672c\u6982\u5ff5"},"kafka \u57fa\u672c\u6982\u5ff5"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.bilibili.com/video/BV1jt4y1C7PZ?p=49"},"https://www.bilibili.com/video/BV1jt4y1C7PZ?p=49")),(0,r.kt)("p",null,"\u5206\u5e03\u5f0f\u57fa\u4e8e\u53d1\u5e03 / \u8ba2\u9605\u7684\u6d88\u606f\u7cfb\u7edf\u6d88\u606f\u4e2d\u95f4\u4ef6"),(0,r.kt)("p",null,"\u63a8\u8350\u73b0\u5728\u5927\u5bb6\u7528Pulsar\uff0c\u76f8\u6bd4 kafka\uff0c\u66f4\u52a0\u7b80\u6d01\u66f4\u597d\u7528"),(0,r.kt)("p",null,"\u9002\u7528\u4e8e\u5bf9\u6d88\u8d39\u6b21\u5e8f\u6216\u65f6\u95f4\u6ca1\u6709\u5f3a\u4e00\u81f4\u6027\u9700\u8981\u7684\u573a\u666f"),(0,r.kt)("h3",{id:"\u903b\u8f91\u67b6\u6784"},"\u903b\u8f91\u67b6\u6784"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\n\u6709\u8fd9\u4e48\u51e0\u4e2a\u6982\u5ff5:\n\n- producer, consumer,\n\n- kafka cluster: \u4e00\u53f0 or \u591a\u53f0 server \u7ec4\u6210\n\n  broker: kafka \u5b9e\u4f8b, \u4e00\u53f0\u7269\u7406\u673a\u53ef\u80fd\u90e8\u7f72\u591a\u4e2a broker, \u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e2a broker \u90fd\u6709\u4e00\u4e2a\u4e0d\u91cd\u590d\u7684\u7f16\u53f7\n\n  topic \u4e3b\u9898: \u53ef\u4ee5\u7406\u89e3\u4e3a\u6d88\u606f\u5206\u7c7b, \u662f\u903b\u8f91\u4e0a\u7684\u6982\u5ff5(\u4e00\u4e2a\u4e3b\u9898\u5305\u62ec\u4e86\u591a\u4e2a\u5206\u533a), \u5728\u6bcf\u4e2a broker \u4e0a\u53ef\u80fd\u65b0\u5efa\u591a\u4e2a topic, \n  \n    \u5b9e\u9645\u573a\u666f\u4e0b, \u4e00\u822c\u662f\u4e00\u4e2a\u4e1a\u52a1\u7ebf\u5efa\u4e00\u4e2atopic (producer \u53d1\u9001\u5fc5\u987b\u6307\u5b9a topic); \n    \n    \u82e5\u5199\u5165\u7684 topic \u4e0d\u5b58\u5728, kafka \u4f1a\u81ea\u52a8\u521b\u5efa\u4e3b\u9898, partition \u548c replication \u6570\u91cf\u5747\u9ed8\u8ba4\u4e3a 1\n\n  partition \u5206\u533a: \u6bcf\u4e2a topic \u53ef\u80fd\u5305\u542b\u591a\u4e2a\u5206\u533a(\u8fd9\u4e9b\u5206\u533a\u4f1a\u5e73\u5747\u5206\u914d\u7ed9\u67d0\u4e2a consumer group\u7684\u4e0d\u540c consumer \u6d88\u8d39, \u8fd9\u4e9b\u5206\u533a\u53ef\u80fd\u5206\u5e03\u5728\u4e0d\u540c\u7684 broker \u4e0a), \u6570\u636e\u5b9e\u9645\u5206\u5e03\u5728\u8fd9\u4e9b\u5206\u533a\u4e0a, \u4e0d\u4f1a\u6570\u636e\u91cd\u590d, \u5206\u533a\u7684\u4f5c\u7528\u662f\u505a\u8d1f\u8f7d , \u7528\u6765\u63d0\u9ad8kafka\u7684\u541e\u5410\u91cf\u3002 \u5206\u533a\u7684\u8868\u73b0\u5f62\u5f0f\u5c31\u662f\u4e00\u4e2a\u4e00\u4e2a\u7684\u6587\u4ef6\u5939, \u91cc\u9762\u5b58\u50a8\u8fd9\u4e2a\u5206\u533a\u6240\u6709\u7684\u6d88\u606f\u548c\u7d22\u5f15\u6587\u4ef6 \n\n    \u65e0\u8bba\u6d88\u606f\u662f\u5426\u88ab\u6d88\u8d39\uff0c\u9664\u975e\u6d88\u606f\u5230\u671f Partition \u4ece\u4e0d\u5220\u9664\u6d88\u606f, Partition \u4f1a\u4e3a\u6bcf\u4e2a Consumer Group \u4fdd\u5b58\u4e00\u4e2a\u504f\u79fb\u91cf\uff0c\u8bb0\u5f55 Group \u6d88\u8d39\u5230\u7684\u4f4d\u7f6e\n\n    \u5bf9\u4e8e\u540c\u4e00\u4e2a\u5206\u533a, \u6570\u636e\u5199\u5165\u4fdd\u5b58\u662f\u6709\u5e8f\u7684, \u6d88\u606f\u90fd\u4f1a\u88ab\u8ffd\u52a0\u5230 Partition \u6570\u636e\u6587\u4ef6\u7684\u5c3e\u90e8, \u78c1\u76d8\u6548\u7387\u5f88\u9ad8 \n\n  replication \u526f\u672c: \u6bcf\u4e2a\u5206\u533a\u4f1a\u6709\u591a\u4e2a\u526f\u672c, \u526f\u672c\u7684\u4f5c\u7528\u662f\u7528\u6765\u505a\u5907\u80ce\u3002 \u6bcf\u5f53\u4e3b\u5206\u533a(leader)\u6545\u969c\u5c31\u4f1a\u9009\u4e00\u4e2a\u5907\u80ce(follower)\u4e0a\u4f4d\u3002 \u9ed8\u8ba4\u5907\u80ce\u6570\u662f10\u4e2a\u3002  \n\n- ack \u786e\u8ba4\u673a\u5236\n  \u751f\u4ea7\u8005\u5728\u5f80 kafka\u53d1\u9001\u6d88\u606f\u65f6\u53ef\u4ee5\u8bbe\u7f6e\u5e94\u7b54\u673a\u5236\u7684\u7b49\u7ea7, 0, 1, all\n\n  0: \u8868\u793a\uff0c\u751f\u4ea7\u8005\u5728\u53d1\u9001\u6d88\u606f\u540e\uff0c\u4e0d\u7528\u7b49\u5f85\uff0c\u786e\u8ba4\u8fd4\u56de\u6548\u7387\u6700\u9ad8\uff0c\u4f46\u4e0d\u4fdd\u8bc1\u53d1\u9001\u6210\u529f\u3002\u5b89\u5168\u6027\u4e0d\u597d \u6548\u7387\u6700\u9ad8\n  1: \u8868\u793a\uff0c\u751f\u4ea7\u8005\u5f80\u96c6\u7fa4\u53d1\u9001\u6d88\u606f\u3002\u53ea\u9700\u8981\u5206\u533a leader \u8fd4\u56de ack, \u5c31\u8ba4\u4e3a\u53d1\u9001\u6210\u529f, \u53ef\u4ee5\u53d1\u9001\u4e0b\u4e00\u6761. \u53ea\u786e\u4fdd leader \u53d1\u9001\u6210\u529f\n  all: \u9700\u8981\u6240\u6709\u7684\u5206\u533afollower \u4ece leader\u540c\u6b65\u6d88\u606f\u6210\u529f(\u6240\u6709\u526f\u672c\u90fd\u5b8c\u6210\u5907\u4efd)\uff0c producer\u6210\u529f\u624d\u8ba4\u4e3a\u6d88\u606f\u53d1\u9001\u6210\u529f\u3002  \u5b89\u5168\u6027\u6700\u597d \u6548\u7387\u6700\u4f4e\n\n- consumer group:  \u53ef\u4ee5\u5c06\u591a\u4e2a\u6d88\u8d39\u8005\u7ec4\u6210\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4, \u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53, \u7528\u4e00\u4e2a\u6807\u7b7e\u6807\u8bc6\u3002  \n  \n    (\u4e0d\u5728\u540c\u4e00\u4e2aGroup \u7684Consumer\u80fd\u91cd\u590d\u6d88\u8d39\u540c\u4e00\u6761\u6d88\u606f\uff08\u8ba2\u9605\uff09\uff0c\u76f8\u540cGroup\u7684Consumer\u5b58\u5728\u6d88\u8d39\u7ade\u4e89\uff08\u4e0d\u4f1a\u6d88\u8d39\u540c\u6761\u6570\u636e, \u5373\u8d1f\u8f7d\u5747\u8861\uff09)\n\n    \u53ef\u4ee5\u901a\u8fc7\u589e\u52a0\u6d88\u8d39\u7ec4\u7684\u6d88\u8d39\u8005\u6765\u8fdb\u884c\u6c34\u5e73\u6269\u5c55\u63d0\u5347\u6d88\u8d39\u80fd\u529b, \u7ec4\u4e2d\u6d88\u8d39\u8005\u7684\u6570\u91cf\u4e0d\u5e94\u8be5\u6bd4\u5206\u533a\u6570\u591a\uff0c\u56e0\u4e3a\u591a\u51fa\u6765\u7684\u6d88\u8d39\u8005\u662f\u7a7a\u95f2\u7684 (\u6240\u4ee5\u521b\u5efa\u4e3b\u9898\u65f6\u5e94\u8be5\u4f7f\u7528\u6bd4\u8f83\u591a\u7684\u5206\u533a\u6570)\n\n    Kafka\u7684\u8ba2\u9605\u8005\u662f\u901a\u8fc7\u6d88\u8d39\u7ec4\uff08Consumer Group\uff09\u6765\u4f53\u73b0\u7684\uff0c\u6bcf\u4e2a\u6d88\u8d39\u7ec4\u90fd\u53ef\u4ee5\u91cd\u590d\u6d88\u8d39Topic\u4e00\u4efd\u5b8c\u6574\u7684\u6d88\u606f\uff0c\u4e0d\u540c\u6d88\u8d39\u7ec4\u4e4b\u95f4\u6d88\u8d39\u8fdb\u5ea6\u5f7c\u6b64\u4e0d\u53d7\u5f71\u54cd\u3002\u4f8b\u5982Message1\u80fd\u88abConsumer Group 1\u548cConsumer Group2\u91cc\u7684\u6d88\u8d39\u8005\u90fd\u6d88\u8d39\u4e00\u6b21\u3002\n\n    \u5f53\u6d88\u8d39\u8005\u79bb\u5f00\u6d88\u8d39\u7ec4\uff08\u6bd4\u5982\u91cd\u542f\u3001\u5b95\u673a\u7b49\uff09\u65f6\uff0c\u5b83\u6240\u6d88\u8d39\u7684\u5206\u533a\u4f1a\u5206\u914d\u7ed9\u5176\u4ed6\u5206\u533a\u3002\u8fd9\u79cd\u73b0\u8c61\u79f0\u4e3a\u91cd\u5e73\u8861\uff08rebalance\uff09, \u5728\u91cd\u5e73\u8861\u671f\u95f4\uff0c\u6240\u6709\u6d88\u8d39\u8005\u90fd\u4e0d\u80fd\u6d88\u8d39\u6d88\u606f\uff0c\u56e0\u6b64\u4f1a\u9020\u6210\u6574\u4e2a\u6d88\u8d39\u7ec4\u77ed\u6682\u7684\u4e0d\u53ef\u7528 (\u652f\u6301\u4e09\u79cd\u5206\u914d\u7b56\u7565: https://zhuanlan.zhihu.com/p/418158376)\n\n\n")),(0,r.kt)("h3",{id:"\u7269\u7406\u67b6\u6784"},"\u7269\u7406\u67b6\u6784"),(0,r.kt)("p",null,"partition \u5bf9\u5e94\u78c1\u76d8\u4e0a\u7684\u6587\u4ef6\u5939, \u4e00\u4e2a\u5206\u533a\u6839\u636e\u5b58\u50a8\u7684\u6d88\u606f\u6570\u91cf, \u4f1a\u6709\u591a\u4e2a\u6587\u4ef6\u5939, \u6587\u4ef6\u5939\u5305\u62ec\u4e09\u4e2a\u6587\u4ef6:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\n0000000001.log    \u6570\u636e\u6587\u4ef6, \u5b58\u50a8\u6d88\u606f, \u6bcf\u6761\u6d88\u606f\u5305\u62ec (\u6570\u636e, offset\u7f16\u53f7, \u7269\u7406\u5730\u5740)\n\n0000000001.index  \u7d22\u5f15, \u91c7\u7528\u7a00\u758f\u7d22\u5f15\u7684\u65b9\u5f0f, \u8bb0\u5f55 log \u6587\u4ef6\u7684\u7d22\u5f15\n\n  log \u6587\u4ef6\u6bcf\u589e\u52a0 4kb, \u8bb0\u5f55\u4e00\u6761\u7d22\u5f15\u4fe1\u606f, \u7d22\u5f15\u4fe1\u606f\u5c31\u662f offset\u7f16\u53f7 \u548c \u7269\u7406\u5730\u5740\u7684\u6620\u5c04\n\n0000000001.timeindex  \u65f6\u95f4\u7d22\u5f15\n\n\n\n\n")),(0,r.kt)("h3",{id:"\u5199\u5165\u6d88\u606f\u5de5\u4f5c\u6d41\u7a0b"},"\u5199\u5165\u6d88\u606f\u5de5\u4f5c\u6d41\u7a0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\n\u5de5\u4f5c\u6d41\u7a0b:\n\n1. \u751f\u4ea7\u8005\u4ececluster\u4e2d\u83b7\u53d6 partition leader \u7684\u4fe1\u606f\u3002 \u751f\u4ea7\u8005\u5c06\u6d88\u606f\u53d1\u9001\u7ed9\u5206\u533a leader\u3002 \n1. \u5206\u533a leader \u5c06\u6548\u5173\u7cfb\u5199\u5165\u78c1\u76d8\n1. follower \u4ece leader \u62c9\u53d6\u6d88\u606f\u6570\u636e, \u5199\u5165\u78c1\u76d8, \u5411 leader \u53d1\u9001 ack \u6d88\u606f\n1. leader \u6536\u5230\u6240\u6709 follower \u7684 ack \u540e\u5411\u751f\u4ea7\u8005\u53d1\u9001 ack, \u8868\u793a\u5199\u5165\u6210\u529f\n")),(0,r.kt)("h3",{id:"\u6d88\u8d39\u6d88\u606f\u7684\u539f\u7406"},"\u6d88\u8d39\u6d88\u606f\u7684\u539f\u7406"),(0,r.kt)("p",null,"\u7a00\u758f\u7d22\u5f15 + \u4e8c\u5206\u67e5\u627e"),(0,r.kt)("p",null,"consumer \u7684\u6d88\u8d39\u7b56\u7565:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"earliest \u4ece\u5934\u5f00\u59cb\u6d88\u8d39"),(0,r.kt)("li",{parentName:"ul"},"latest \u4ece\u5f53\u524d\u4f4d\u7f6e\u5f00\u59cb\u6d88\u8d39"),(0,r.kt)("li",{parentName:"ul"},"none \u4ece\u6307\u5b9aoffset \u5f00\u59cb\u6d88\u8d39, \u82e5\u6d88\u8d39\u8005\u6ca1\u6709\u63d0\u4f9b offset \u5219\u62a5\u9519")),(0,r.kt)("h3",{id:"partition-\u5206\u533a\u9009\u62e9\u539f\u5219\u903b\u8f91"},"partition \u5206\u533a\u9009\u62e9\u539f\u5219\u903b\u8f91"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u82e5\u67d0\u4e2a topic \u4e0b\u6709\u591a\u4e2a partition, producer \u5982\u4f55\u51b3\u5b9a\u5f80\u54ea\u4e2a partition \u5199\u6570\u636e?\n\n- producer \u5728\u5199\u5165\u65f6, \u80fd\u6307\u5b9apartition, \u82e5\u6307\u5b9a\u4e86, \u8fd9\u5199\u5165\u76f8\u5e94\u7684 partition\n- \u82e5producer \u6ca1\u6307\u5b9a partition, \u4f46\u662f\u8bbe\u7f6e\u4e86\u6570\u636e\u7684 key, \u5219\u6839\u636e key \u4f1a hash \u51fa\u4e00\u4e2a partition\n- \u82e5\u6ca1\u6709\u6307\u5b9a partition, \u4e5f\u6ca1\u6709\u6307\u5b9a\u6570\u636e key, kafka \u4f1a\u91c7\u7528\u8f6e\u8bad\u7684\u65b9\u5f0f, \u67d0\u4e00\u6bb5\u65f6\u95f4, \u6240\u6709\u6570\u636e\u4f1a\u5199\u5165 partition1, \u67d0\u4e00\u6bb5\u65f6\u95f4, \u6570\u636e\u4f1a\u5199\u5165 partition2...\n")),(0,r.kt)("h3",{id:"kafka-\u6d88\u606f\u6709\u5e8f\u6027"},"kafka \u6d88\u606f\u6709\u5e8f\u6027"),(0,r.kt)("p",null,"\u5bf9\u4e8e\u540c\u4e2a\u5206\u533a\u6765\u8bf4\uff0c\u5b83\u7684\u6d88\u606f\u662f\u6709\u5e8f\u7684, \u4e0d\u540c partition \u5c31\u662f\u65e0\u5e8f\u7684\u4e86"),(0,r.kt)("p",null,"\u6240\u4ee5\u5bf9\u4e8e\u6d88\u606f, \u53ef\u4ee5\u5bf9 id \u4f7f\u7528 partition num \u53d6\u6a21\u5f97\u5230 partition id"),(0,r.kt)("h3",{id:"kafka-\u4e3a\u4ec0\u4e48\u5feb"},"kafka \u4e3a\u4ec0\u4e48\u5feb"),(0,r.kt)("p",null,"\u5f02\u6b65\u6279\u91cf\u5904\u7406: \u4f8b\u5982\u751f\u4ea7\u8005\u5ba2\u6237\u7aef\uff0c\u4ed6\u4f1a\u79ef\u7d2f\u4e00\u5b9a\u91cf\uff08\u6761\u6570\u3001\u5927\u5c0f\uff09\u7684\u6d88\u606f\uff0c\u518d\u6279\u91cf\u7684\u53d1\u7ed9kafka broker"),(0,r.kt)("p",null,"\u78c1\u76d8\u987a\u5e8f\u8bfb\u5199: \u6bcf\u4e2apartition \u90fd\u662f\u8ffd\u52a0\u5230\u5c3e\u90e8, \u5728\u8868\u73b0\u5728\u78c1\u76d8\u4e0a\u5c31\u662f\u987a\u5e8f\u8bfb\u5199, \u901f\u5ea6\u5feb"),(0,r.kt)("p",null,"\u5206\u6bb5\u5b58\u50a8: \u6570\u636e\u5b58\u50a8\u4e3a\u591a\u4e2a\u6587\u4ef6, \u52a0\u8f7d\u5feb, \u907f\u514d\u6570\u636e\u7ade\u4e89"),(0,r.kt)("p",null,"\u64cd\u4f5c\u7cfb\u7edfPageCache\u7f13\u5b58\u6570\u636e"),(0,r.kt)("p",null,"\u96f6\u62f7\u8d1d\u52a0\u901f\u6d88\u8d39"),(0,r.kt)("h3",{id:"kafka-\u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u53ef\u9760\u6027"},"kafka \u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u53ef\u9760\u6027"),(0,r.kt)("p",null,"\u5373\u6d88\u606f\u4e0d\u4e22\u5931"),(0,r.kt)("p",null,"\u751f\u4ea7\u8005\u8bbe\u7f6eack\uff1a"),(0,r.kt)("p",null,"0\uff1aproducer\u4e0d\u7b49\u5f85broker\u7684ack\uff0cbroker\u4e00\u63a5\u6536\u5230\u8fd8\u6ca1\u6709\u5199\u5165\u78c1\u76d8\u5c31\u5df2\u7ecf\u8fd4\u56de\uff0c\u53ef\u9760\u6027\u6700\u4f4e\uff1b\n1\uff1aproducer\u7b49\u5f85broker\u7684ack\uff0cpartition\u7684leader\u5237\u76d8\u6210\u529f\u540e\u8fd4\u56deack\uff0c\u5982\u679c\u5728follower\u540c\u6b65\u6210\u529f\u4e4b\u524dleader\u6545\u969c\uff0c\u90a3\u4e48\u5c06\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u53ef\u9760\u6027\u4e2d\uff1b\n-1\uff1aproducer\u7b49\u5f85broker\u7684ack\uff0cpartition\u7684leader\u548cfollower\u5168\u90e8\u843d\u76d8\u6210\u529f\u540e\u624d\u8fd4\u56deack\uff0c\u6570\u636e\u4e00\u822c\u4e0d\u4f1a\u4e22\u5931\uff0c\u5ef6\u8fdf\u65f6\u95f4\u957f\u4f46\u662f\u53ef\u9760\u6027\u9ad8"),(0,r.kt)("p",null,"\u6d88\u8d39\u8005\n\u8bbe\u7f6eenable.auto.commit=true\uff0c\u4e0d\u7ba1\u6267\u884c\u7ed3\u679c\u5982\u4f55\uff0c\u6d88\u8d39\u8005\u4f1a\u81ea\u52a8\u63d0\u4ea4offset\u3002false\uff0c\u9700\u8981\u7528\u6237\u9700\u8981\u624b\u52a8\u63d0\u4ea4offset\uff0c\u53ef\u4ee5\u6839\u636e\u6267\u884c\u7ed3\u679c\u5177\u4f53\u5904\u7406offset"),(0,r.kt)("h3",{id:"\u5982\u4f55\u4fdd\u8bc1\u4e0d\u91cd\u590d\u6d88\u8d39"},"\u5982\u4f55\u4fdd\u8bc1\u4e0d\u91cd\u590d\u6d88\u8d39"),(0,r.kt)("p",null,"\u6bcf\u4e2a partition \u5bf9\u5e94\u4e00\u4e2a\u6d88\u8d39\u8005\u7ebf\u7a0b, \u6216\u8005 \u6bcf\u4e2a partition \u5bf9\u5e94\u4e00\u4e2a consumer group"),(0,r.kt)("h2",{id:"\u4e3a\u4ec0\u4e48\u4f7f\u7528-kafka"},"\u4e3a\u4ec0\u4e48\u4f7f\u7528 kafka"),(0,r.kt)("h3",{id:"kafka\u4f7f\u7528\u573a\u666f"},"kafka\u4f7f\u7528\u573a\u666f"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6d88\u606f\u961f\u5217 (\u89e3\u8026, \u6d41\u91cf\u524a\u5cf0..)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u8ffd\u8e2a\u7f51\u7ad9\u6d3b\u52a8 : \u5c06\u4e0d\u540c\u7684\u6d3b\u52a8\u653e\u5165\u4e0d\u540c\u7684\u4e3b\u9898, \u4f9b\u540e\u7eed\u7684\u5b9e\u65f6\u8ba1\u7b97/\u76d1\u63a7\u7a0b\u5e8f\u4f7f\u7528")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u65e5\u5fd7\u548c\u76d1\u63a7metrics\u805a\u5408:   \u805a\u5408\u5206\u5e03\u5f0f\u5e94\u7528\u7684\u65e5\u5fd7, \u8fdb\u884c\u7edf\u4e00\u5206\u6790\u5c55\u793a"))),(0,r.kt)("h3",{id:"\u548c-redis-\u6d88\u606f\u961f\u5217\u7684\u533a\u522b"},"\u548c redis \u6d88\u606f\u961f\u5217\u7684\u533a\u522b"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"redis \u5b9e\u73b0\u7684\u6d88\u606f\u961f\u5217\u4f7f\u7528\u63a8\u6a21\u5f0f, \u82e5\u6d88\u8d39\u8005\u5728\u6d88\u606f\u63a8\u8fc7\u6765\u7684\u65f6\u5019\u6389\u7ebf\u4e86, \u4e5f\u5c31\u9519\u8fc7\u4e86\u6d88\u606f; kafka \u662f\u57fa\u4e8e\u62c9\u6a21\u5f0f, \u6bcf\u4e2a\u6d88\u8d39\u8005\u4e3b\u52a8\u62c9\u53d6\u6d88\u606f")),(0,r.kt)("p",null,"\u5b9e\u9645\u4e0a redis \u4f5c\u8005\u770b\u5230\u8fd9\u4e48\u591a\u4eba\u4f7f\u7528 redis \u6765\u505a\u6d88\u606f\u961f\u5217, \u8fdd\u80cc\u4e86\u4ed6\u7ed9\u672c\u610f, \u7279\u5730\u5f00\u53d1\u4e86 Disque \u4e13\u95e8\u5e94\u5bf9\u6d88\u606f\u961f\u5217\u573a\u666f"),(0,r.kt)("h2",{id:"\u5982\u4f55\u4f7f\u7528kafka"},"\u5982\u4f55\u4f7f\u7528kafka"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://kafka.apache.org/documentation/#quickstart"},"https://kafka.apache.org/documentation/#quickstart")," \u542f\u52a8\u6d4b\u8bd5\u7528\u670d\u52a1, kafka \u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost:9092"),", zookeeper \u5728",(0,r.kt)("inlineCode",{parentName:"p"},"xxx")),(0,r.kt)("h3",{id:"kafka\u914d\u7f6e\u6587\u4ef6"},"kafka\u914d\u7f6e\u6587\u4ef6"),(0,r.kt)("p",null,"config\u6587\u4ef6\u5939\u4e0b\uff0c\u4f1a\u53d1\u73b0\u6709\u5f88\u591a\u5f88\u591a\u7684\u914d\u7f6e\u6587\u4ef6, \u53ea\u9700\u8981\u5173\u6ce8 server.properties"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u3010broker.id\u3011\n\u6bcf\u4e2abroker\u90fd\u5fc5\u987b\u81ea\u5df1\u8bbe\u7f6e\u7684\u4e00\u4e2a\u552f\u4e00id\uff0c\u53ef\u4ee5\u57280~255\u4e4b\u95f4\n\u3010log.dirs\u3011\n\u8fd9\u4e2a\u6781\u4e3a\u91cd\u8981\uff0cKafka\u7684\u6240\u6709\u6570\u636e\u5c31\u662f\u5199\u5165\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684\u78c1\u76d8\u6587\u4ef6\u4e2d\u7684\uff0c\u5982\u679c\u8bf4\u673a\u5668\u4e0a\u6709\u591a\u5757\u7269\u7406\u786c\u76d8\uff0c\u90a3\u4e48\u53ef\u4ee5\u628a\u591a\u4e2a\u76ee\u5f55\u6302\u8f7d\u5230\u4e0d\u540c\u7684\u7269\u7406\u786c\u76d8\u4e0a\uff0c\u7136\u540e\u8fd9\u91cc\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u76ee\u5f55\uff0c\u8fd9\u6837Kafka\u53ef\u4ee5\u6570\u636e\u5206\u6563\u5230\u591a\u5757\u7269\u7406\u786c\u76d8\uff0c\u591a\u4e2a\u786c\u76d8\u7684\u78c1\u5934\u53ef\u4ee5\u5e76\u884c\u5199\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u5347\u541e\u5410\u91cf\u3002ps\uff1a\u591a\u4e2a\u76ee\u5f55\u7528\u82f1\u6587\u9017\u53f7\u5206\u9694\n\u3010zookeeper.connect\u3011\n\u8fde\u63a5Kafka\u5e95\u5c42\u7684ZooKeeper\u96c6\u7fa4\u7684\n\u3010Listeners\u3011\nbroker\u76d1\u542c\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\u7684\u7aef\u53e3\u53f7\uff0c\u9ed8\u8ba4\u662f9092\n\u3010num.network.threads\u3011\u9ed8\u8ba4\u503c\u4e3a3\n\u3010num.io.threads\u3011\u9ed8\u8ba4\u503c\u4e3a8\n\u7ec6\u5fc3\u7684\u670b\u53cb\u4eec\u5e94\u8be5\u5df2\u7ecf\u53d1\u73b0\u4e86\uff0c\u8fd9\u5c31\u662f\u4e0a\u4e00\u7bc7\u6211\u4eec\u5728\u7f51\u7edc\u67b6\u6784\u4e0a\u63d0\u5230\u7684processor\u548c\u5904\u7406\u7ebf\u7a0b\u6c60\u7684\u7ebf\u7a0b\u6570\u76ee\u3002\n\u6240\u4ee5\u8bf4\u638c\u63e1Kafka\u7f51\u7edc\u67b6\u6784\u663e\u5f97\u5c24\u4e3a\u91cd\u8981\u3002\n\u73b0\u5728\u4f60\u770b\u5230\u8fd9\u4e24\u4e2a\u53c2\u6570\uff0c\u5c31\u77e5\u9053\u8fd9\u5c31\u662fKafka\u96c6\u7fa4\u6027\u80fd\u7684\u5173\u952e\u53c2\u6570\u4e86\n\u3010unclean.leader.election.enable\u3011\n\u9ed8\u8ba4\u662ffalse\uff0c\u610f\u601d\u5c31\u662f\u53ea\u80fd\u9009\u4e3eISR\u5217\u8868\u91cc\u7684follower\u6210\u4e3a\u65b0\u7684leader\uff0c1.0\u7248\u672c\u540e\u624d\u8bbe\u4e3afalse\uff0c\u4e4b\u524d\u90fd\u662ftrue\uff0c\u5141\u8bb8\u975eISR\u5217\u8868\u7684follower\u9009\u4e3e\u4e3a\u65b0\u7684leader\n\u3010delete.topic.enable\u3011\n\u9ed8\u8ba4true\uff0c\u5141\u8bb8\u5220\u9664topic\n\u3010log.retention.hours\u3011\n\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e0b\uff0c\u8981\u4fdd\u7559\u6570\u636e\u591a\u5c11\u4e2a\u5c0f\u65f6\uff0c\u8fd9\u4e2a\u5c31\u662f\u5e95\u5c42\u7684\u78c1\u76d8\u6587\u4ef6\uff0c\u9ed8\u8ba4\u4fdd\u75597\u5929\u7684\u6570\u636e\uff0c\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u6765\u5c31\u884c\u4e86\n\u3010min.insync.replicas\u3011\nacks=-1(\u4e00\u6761\u6570\u636e\u5fc5\u987b\u5199\u5165ISR\u91cc\u6240\u6709\u526f\u672c\u624d\u7b97\u6210\u529f)\uff0c\u4f60\u5199\u4e00\u6761\u6570\u636e\u53ea\u8981\u5199\u5165leader\u5c31\u7b97\u6210\u529f\u4e86\uff0c\u4e0d\u9700\u8981\u7b49\u5f85\u540c\u6b65\u5230follower\u624d\u7b97\u5199\u6210\u529f\u3002\u4f46\u662f\u6b64\u65f6\u5982\u679c\u4e00\u4e2afollower\u5b95\u673a\u4e86\uff0c\u4f60\u5199\u4e00\u6761\u6570\u636e\u5230leader\u4e4b\u540e\uff0cleader\u4e5f\u5b95\u673a\uff0c\u4f1a\u5bfc\u81f4\u6570\u636e\u7684\u4e22\u5931\u3002\n\n\n")),(0,r.kt)("h3",{id:"kafkamanager-web-\u754c\u9762"},"KafkaManager web \u754c\u9762"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/obsidiandynamics/kafdrop"},"https://github.com/obsidiandynamics/kafdrop")),(0,r.kt)("p",null,"\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e09\u65b9\u7684Kafka Eagle\u4ee3\u66ff\uff0cKafka Manager\u8fc7\u4e8e\u96be\u7528"),(0,r.kt)("h3",{id:"springboot-\u96c6\u6210-kafka"},"springboot \u96c6\u6210 kafka"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/conduktor/kafka-beginners-course"},"https://github.com/conduktor/kafka-beginners-course")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/gwenshap/kafka-examples"},"https://github.com/gwenshap/kafka-examples")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/confluentinc/kafka-streams-examples"},"https://github.com/confluentinc/kafka-streams-examples")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/confluentinc/kafka-rest"},"https://github.com/confluentinc/kafka-rest")," rest \u63a5\u53e3")),(0,r.kt)("p",null,"Spring\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u4e3aSpring kafka\u7684\u9879\u76ee\uff0c\u5b83\u5c01\u88c5\u4e86Apache\u7684kafka\u5ba2\u6237\u7aef\u90e8\u5206(\u751f\u4ea7\u8005/\u6d88\u8d39\u8005/\u6d41\u5904\u7406\u7b49"),(0,r.kt)("p",null,"@EnableKafka\u5e76\u4e0d\u662f\u5728Spring Boot\u4e2d\u542f\u7528Kafka\u5fc5\u987b\u7684\uff0cSpring Boot\u9644\u5e26\u4e86Spring Kafka\u7684\u81ea\u52a8\u914d\u7f6e\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u4f7f\u7528\u663e\u5f0f\u7684@EnableKafka\u3002\u5982\u679c\u60f3\u8981\u81ea\u5df1\u5b9e\u73b0Kafka\u914d\u7f6e\u7c7b\uff0c\u5219\u9700\u8981\u52a0\u4e0a@EnableKafka\uff0c\u5982\u679c\u4f60\u4e0d\u60f3\u8981Kafka\u81ea\u52a8\u914d\u7f6e\uff0c\u6bd4\u5982\u6d4b\u8bd5\u4e2d\uff0c\u9700\u8981\u505a\u7684\u53ea\u662f\u79fb\u9664KafkaAutoConfiguration ",(0,r.kt)("inlineCode",{parentName:"p"},'@SpringBootTest("spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration")')),(0,r.kt)("h3",{id:"\u521b\u5efa\u4e3b\u9898"},"\u521b\u5efa\u4e3b\u9898"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// \u521b\u5efa\u4e3b\u9898\n\n@Configuration\n@Data\npublic class KafkaTopicConfig {\n\n    @Value("${kafka.topic.topic1}")\n    private final String topic1;\n\n    @Value("${kafka.topic.topic2}")\n    private final String topic2;\n\n    @Bean\n    public NewTopic topic1() {\n        return TopicBuilder.name(topic1)\n                .partitions(1)\n                .replicas(1)\n                .build();\n    }\n\n    @Bean\n    public NewTopic topic2() {\n        return TopicBuilder.name(topic2)\n                .partitions(2)\n                .replicas(1)\n                .build();\n    }\n\n\n\n}\n\n')),(0,r.kt)("p",null,"\u6216\u8005:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Configuration\n@Slf4j\n@Data\npublic class KafkaConfig {\n\n    private final KafkaProps kafkaProps;\n\n    private final DefaultListableBeanFactory defaultListableBeanFactory;\n\n    \n\n    @PostConstruct\n    public void init() {\n        initTopics();\n    }\n\n    /**\n     * create kafka topics\n     */\n    private void initTopics() {\n        kafkaProps.getTopics().forEach(ele -> {\n            defaultListableBeanFactory.registerSingleton(ele.getName(), TopicBuilder.name(ele.getName())\n                    .partitions(ele.getPartitions()).replicas(ele.getReplicationFactor()).build());\n            log.debug(">>> register topic ok: {}", ele.getName());\n        });\n    }\n\n    @Data\n    @Component\n    @ConfigurationProperties(prefix = "kafka")\n    static class KafkaProps {\n        private List<Topic> topics = new ArrayList<>();\n    }\n\n    @Data\n    static class Topic {\n        private String name;\n        private int partitions;\n        private int replicationFactor;\n    }\n\n}\n')),(0,r.kt)("h3",{id:"\u751f\u4ea7\u8005\u53d1\u9001"},"\u751f\u4ea7\u8005\u53d1\u9001"),(0,r.kt)("h4",{id:"kafka-template-\u540c\u6b65-\u5f02\u6b65"},"kafka template \u540c\u6b65 \u5f02\u6b65"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'\n// \u53d1\u9001\n\n@Service\n@Data\n@Slf4j\npublic class BookProducerService<T> {\n\n    private final KafkaTemplate<String, T> kafkaTemplate;    \n\n    public void send(String topic, T data) {\n      // \u540c\u6b65\u7684\u65b9\u5f0f\n        // try {\n        //     SendResult<String, T> sendResult = kafkaTemplate.send(topic,data).get();\n        //     RecordMetadata meta = sendResult.getRecordMetadata();\n        //     if (meta != null) {\n        //         ProducerRecord<String, T> producerRecord = sendResult.getProducerRecord();\n        //         log.debug("producer record: {}", producerRecord);\n\n        //     }\n        // } catch (InterruptedException | ExecutionException e) {\n        //     e.printStackTrace();\n        // }\n\n        // \u5229\u7528 future \u5f02\u6b65\u7684\u5199\u6cd5:\n        // \u53d1\u9001\u5bf9\u8c61\u9700\u8981\u914d\u7f6e value \u7684\u5e8f\u5217\u5316\u65b9\u5f0f\n        kafkaTemplate.send(topic, data).addCallback(new ListenableFutureCallback<SendResult<String, T>>() {\n            @Override\n            public void onFailure(Throwable throwable) {\n                log.error("send message failed, topic: {}, data: {}, err: {}", topic, data, throwable.getMessage());\n            }\n\n            @Override\n            public void onSuccess(SendResult<String, T> sendResult) {\n                RecordMetadata meta = sendResult.getRecordMetadata();\n                if (meta != null) {\n                    ProducerRecord<String, T> producerRecord = sendResult.getProducerRecord();\n                    log.debug("Send ok, producer record: {}", producerRecord);\n                }\n            }\n        });\n    }\n}\n\n\n')),(0,r.kt)("h4",{id:"\u751f\u4ea7\u8005\u914d\u7f6e"},"\u751f\u4ea7\u8005\u914d\u7f6e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"spring:\n  application:\n    name: springboot-kafka-demo\n  kafka:\n    bootstrap-servers:\n      - localhost:9092\n    consumer:\n      # \u914d\u7f6e\u6d88\u8d39\u8005\u91cd\u8fde\u65f6, offset \u91cd\u7f6e\u7684\u89c4\u5219 (\u8fd9\u91cc\u662f: \u6d88\u8d39\u8005\u91cd\u8fde\u4f1a\u91cd\u65b0\u63a5\u6536\u6700\u5f00\u59cb\u7684\u6d88\u606f)\n      auto-offset-reset: earliest\n      # \u7981\u7528offset \u81ea\u52a8\u63d0\u4ea4, \u81ea\u5df1\u624b\u52a8\u63d0\u4ea4\u9632\u6b62\u6d88\u606f\u4e22\u5931\n      enable-auto-commit: false\n    producer:\n      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer\n\nserver:\n  port: 8080\n\nlogging:\n  level:\n    '[io.github.xiaoyureed.springbootkafkademo]': DEBUG\n\nkafka:\n  topic: \n    topic1: topic1\n    topic2: topic2\n\n\n")),(0,r.kt)("p",null,"\u4e5f\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u914d\u7f6e:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Bean\npublic Map<String, Object> producerConfigs() {\n    Map<String, Object> props = new HashMap<>();\n    props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");\n    props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n    props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n\n    // \u63a7\u5236\u6279\u5904\u7406\u5927\u5c0f\uff0c\u5355\u4f4d\u4e3a\u5b57\u8282\n        props.put(ProducerConfig.BATCH_SIZE_CONFIG, 4096);\n        // \u6279\u91cf\u53d1\u9001\uff0c\u5ef6\u8fdf\u4e3a1\u6beb\u79d2\uff0c\u542f\u7528\u8be5\u529f\u80fd\u80fd\u6709\u6548\u51cf\u5c11\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u6b21\u6570\uff0c\u4ece\u800c\u63d0\u9ad8\u5e76\u53d1\u91cf\n        props.put(ProducerConfig.LINGER_MS_CONFIG, 1);\n\n        // \u751f\u4ea7\u8005\u53ef\u4ee5\u4f7f\u7528\u7684\u603b\u5185\u5b58\u5b57\u8282\u6765\u7f13\u51b2\u7b49\u5f85\u53d1\u9001\u5230\u670d\u52a1\u5668\u7684\u8bb0\u5f55d\n        props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 40960);\n        // \u6d88\u606f\u7684\u6700\u5927\u5927\u5c0f\u9650\u5236,\u4e5f\u5c31\u662f\u8bf4send\u7684\u6d88\u606f\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7\u8fd9\u4e2a\u9650\u5236, \u9ed8\u8ba41048576(1MB)\n        props.put(ProducerConfig.MAX_REQUEST_SIZE_CONFIG,1048576);\n\n     \n    // \u6d88\u606f\u786e\u8ba4\u673a\u5236\n    /*\n     //\u5e42\u7b49\u6027\n      props.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);\n      // \u91cd\u8bd5\u6b21\u6570\uff0c0\u4e3a\u4e0d\u542f\u7528\u91cd\u8bd5\u673a\u5236\uff0c\u5e42\u7b49\u6027\u7684\u65f6\u5019\u5fc5\u987b\u5927\u4e8e0\n      props.put(ProducerConfig.RETRIES_CONFIG, 1);\n      //\u540c\u6b65\u5230\u526f\u672c,\n      // \u5f53\u5e42\u7b49\u6027 enable.idempotence \u4e3a true\uff0c\u8fd9\u91cc\u9ed8\u8ba4\u4e3a all\n      props.put(ProducerConfig.ACKS_CONFIG, "all");\n    */\n    // \u91cd\u8bd5\u6b21\u6570\uff0c0\u4e3a\u4e0d\u542f\u7528\u91cd\u8bd5\u673a\u5236\n        props.put(ProducerConfig.RETRIES_CONFIG, 0);\n        //\u540c\u6b65\u5230\u526f\u672c, \u9ed8\u8ba4\u4e3a1\n        // acks=0 \u628a\u6d88\u606f\u53d1\u9001\u5230kafka\u5c31\u8ba4\u4e3a\u53d1\u9001\u6210\u529f\n        // acks=1 \u628a\u6d88\u606f\u53d1\u9001\u5230kafka leader\u5206\u533a\uff0c\u5e76\u4e14\u5199\u5165\u78c1\u76d8\u5c31\u8ba4\u4e3a\u53d1\u9001\u6210\u529f\n        // acks=all \u628a\u6d88\u606f\u53d1\u9001\u5230kafka leader\u5206\u533a\uff0c\u5e76\u4e14leader\u5206\u533a\u7684\u526f\u672cfollower\u5bf9\u6d88\u606f\u8fdb\u884c\u4e86\u540c\u6b65\u5c31\u4efb\u52a1\u53d1\u9001\u6210\u529f\n        props.put(ProducerConfig.ACKS_CONFIG, 1);\n\n        // \u538b\u7f29\u6d88\u606f\uff0c\u652f\u6301\u56db\u79cd\u7c7b\u578b\uff0c\u5206\u522b\u4e3a\uff1anone\u3001lz4\u3001gzip\u3001snappy\uff0c\u9ed8\u8ba4\u4e3anone\u3002\n        // \u6d88\u8d39\u8005\u9ed8\u8ba4\u652f\u6301\u89e3\u538b\uff0c\u6240\u4ee5\u538b\u7f29\u8bbe\u7f6e\u5728\u751f\u4ea7\u8005\uff0c\u6d88\u8d39\u8005\u65e0\u9700\u8bbe\u7f6e\u3002\n        props.put(ProducerConfig.COMPRESSION_TYPE_CONFIG,"none");\n\n    // See https://kafka.apache.org/documentation/#producerconfigs for more properties\n    return props;\n}\n\n@Bean\npublic ProducerFactory<Integer, String> producerFactory() {\n    return new DefaultKafkaProducerFactory<>(producerConfigs());\n}\n\n// springboot \u9ed8\u8ba4\u63d0\u4f9b\u4e86\n@Bean\npublic KafkaTemplate<Integer, String> kafkaTemplate() {\n    // KafkaTemplate\u6784\u9020\u51fd\u6570\u4e2d\u8f93\u5165\u751f\u4ea7\u8005\u5de5\u5382\u914d\u7f6e\n    return new KafkaTemplate<Integer, String>(producerFactory());\n}\n')),(0,r.kt)("h4",{id:"\u751f\u4ea7\u8005\u4e8b\u52a1\u6d88\u606f"},"\u751f\u4ea7\u8005\u4e8b\u52a1\u6d88\u606f"),(0,r.kt)("p",null,"Kafka \u7684\u4e8b\u52a1\u6d88\u606f\u9ed8\u8ba4\u8981\u6c42\u4f60\u7684 Kafka Broker\u7684\u8282\u70b9\u5728 3 \u4e2a\u4ee5\u4e0a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"\n@Service\npublic class BookProducerService {\n\n    private List<Object> sendedBooks = new ArrayList<>();\n    private static final Logger logger = LoggerFactory.getLogger(BookProducerService.class);\n\n    private final KafkaTemplate<String, Object> kafkaTemplate;\n\n    public BookProducerService(KafkaTemplate<String, Object> kafkaTemplate) {\n        this.kafkaTemplate = kafkaTemplate;\n    }\n\n    public void sendMessage(String topic, Object o) {\n        kafkaTemplate.executeInTransaction(new KafkaOperations.OperationsCallback<String, Object, Object>() {\n            @Override\n            public Object doInOperations(KafkaOperations<String, Object> operations) {\n                // \u53d1\u9001\u6d88\u606f\n                operations.send(topic, o);\n                // \u6a21\u62df\u53d1\u751f\u5f02\u5e38\n                int a = 1 / 0;\n                // \u6a21\u62df\u4e1a\u52a1\u64cd\u4f5c\n                sendedBooks.add(o);\n                return null;\n            }\n        });\n    }\n}\n\n\n\n// \u76f4\u63a5\u4f7f\u7528 @Transactional\u4e5f\u53ef\u4ee5\uff1a\n\n    @Transactional(rollbackFor = Exception.class)\n    public void sendMessage(String topic, Object o) {\n        // \u53d1\u9001\u6d88\u606f\n        kafkaTemplate.send(topic, o);\n        // \u6a21\u62df\u53d1\u751f\u5f02\u5e38\n        int a = 1 / 0;\n        // \u6a21\u62df\u4e1a\u52a1\u64cd\u4f5c\n        sendedBooks.add(o);\n    }\n")),(0,r.kt)("p",null,"transaction-id-prefix: \u4e8b\u52a1\u7f16\u53f7\u524d\u7f00"),(0,r.kt)("p",null,"isolation-level: read_committed :\u4ec5\u8bfb\u53d6\u5df2\u63d0\u4ea4\u7684\u6d88\u606f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"server:\n port: 9090\nspring:\n kafka:\n   bootstrap-servers: localhost:9092,localhost:9093,localhost:9094\n   consumer:\n     # \u914d\u7f6e\u6d88\u8d39\u8005\u6d88\u606foffset\u662f\u5426\u81ea\u52a8\u91cd\u7f6e(\u6d88\u8d39\u8005\u91cd\u8fde\u4f1a\u80fd\u591f\u63a5\u6536\u6700\u5f00\u59cb\u7684\u6d88\u606f)\n     auto-offset-reset: earliest\n     # \u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\n     isolation-level: read_committed #\u4ec5\u8bfb\u53d6\u5df2\u63d0\u4ea4\u7684\u6d88\u606f\n   producer:\n     value-serializer: org.springframework.kafka.support.serializer.JsonSerializer\n     retries: 3  #  \u91cd\u8bd5\u6b21\u6570\n     # \u542f\u7528\u4e8b\u52a1\n     transaction-id-prefix: my-tx. # \u4e8b\u52a1\u7f16\u53f7\u524d\u7f00\nkafka:\n topic:\n   topic-test-transaction: topic-test-transaction\n\n\n")),(0,r.kt)("h3",{id:"\u6d88\u8d39\u8005\u6d88\u8d39"},"\u6d88\u8d39\u8005\u6d88\u8d39"),(0,r.kt)("h4",{id:"\u914d\u7f6e-\u8fc7\u6ee4\u5668-\u5168\u5c40\u5f02\u5e38\u5904\u7406"},"\u914d\u7f6e \u8fc7\u6ee4\u5668 \u5168\u5c40\u5f02\u5e38\u5904\u7406"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// \u914d\u7f6e\n@Configuration\n@EnableKafka\npublic class KafkaConsumerConfig {\n\n    @Bean\n    KafkaListenerContainerFactory<ConcurrentMessageListenerContainer<String, String>> kafkaListenerContainerFactory() {\n        ConcurrentKafkaListenerContainerFactory<String, String>\n                factory = new ConcurrentKafkaListenerContainerFactory<>();\n        // \u8bbe\u7f6e\u6d88\u8d39\u8005\u5de5\u5382\n        factory.setConsumerFactory(consumerFactory());\n        // \u6d88\u8d39\u8005\u7ec4\u4e2d\u7ebf\u7a0b\u6570\u91cf\n        factory.setConcurrency(3);\n        // \u62c9\u53d6\u8d85\u65f6\u65f6\u95f4\n        factory.getContainerProperties().setPollTimeout(3000);\n\n        // \u5f53\u4f7f\u7528\u6279\u91cf\u76d1\u542c\u5668\u65f6\u9700\u8981\u8bbe\u7f6e\u4e3atrue\n        factory.setBatchListener(true);\n\n        // \u88ab\u8fc7\u6ee4\u7684\u6d88\u606f\u5c06\u88ab\u4e22\u5f03\n        factory.setAckDiscarded(true);\n        // \u8fc7\u6ee4\u76d1\u542c\u7684\u6d88\u606f\n        // \u5c06\u8fc7\u6ee4\u5668\u6dfb\u6dfb\u52a0\u5230\u53c2\u6570\u4e2d\n        factory.setRecordFilterStrategy(consumerRecord -> {\n            // \u8bbe\u7f6e\u8fc7\u6ee4\u5668\uff0c\u53ea\u63a5\u6536\u6d88\u606f\u5185\u5bb9\u4e2d\u5305\u542b "test" \u7684\u6d88\u606f\n            String value = consumerRecord.value().toString();\n            if (value !=null && value.contains("test")) {\n                System.err.println(consumerRecord.value());\n                // \u8fd4\u56de false \u5219\u63a5\u6536\u6d88\u606f\n                return false;\n            }\n            // \u8fd4\u56de true \u5219\u629b\u5f03\u6d88\u606f\n            return true;\n        });\n\n         // \u5c06\u5355\u6761\u6d88\u606f\u5f02\u5e38\u5904\u7406\u5668\u6dfb\u52a0\u5230\u53c2\u6570\u4e2d\n        factory.setErrorHandler(new ConsumerAwareErrorHandler() {\n            @Override\n            public void handle(Exception thrownException, ConsumerRecord<?, ?> data, Consumer<?, ?> consumer) {\n                log.error("// \u5c06\u5355\u6761\u6d88\u606f\u5f02\u5e38");\n            }\n        });\n        // \u5c06\u6279\u91cf\u6d88\u606f\u5f02\u5e38\u5904\u7406\u5668\u6dfb\u52a0\u5230\u53c2\u6570\u4e2d\n        factory.setBatchErrorHandler(new BatchErrorHandler() {\n            @Override\n            public void handle(Exception thrownException, ConsumerRecords<?, ?> data) {\n                log.error("// \u5c06\u6279\u91cf\u6d88\u606f\u5f02\u5e38");\n            }\n        });\n\n        return factory;\n    }\n\n    @Bean\n    public ConsumerFactory<String, String> consumerFactory() {\n        return new DefaultKafkaConsumerFactory<>(consumerConfigs());\n    }\n\n    @Bean\n    public Map<String, Object> consumerConfigs() {\n        Map<String, Object> propsMap = new HashMap<>();\n        // Kafka\u5730\u5740\n        propsMap.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, KafkaConstants.bootstrapServers);\n        //\u914d\u7f6e\u9ed8\u8ba4\u5206\u7ec4\uff0c\u8fd9\u91cc\u6ca1\u6709\u914d\u7f6e+\u5728\u76d1\u542c\u7684\u5730\u65b9\u6ca1\u6709\u8bbe\u7f6egroupId\uff0c\u591a\u4e2a\u670d\u52a1\u4f1a\u51fa\u73b0\u6536\u5230\u76f8\u540c\u6d88\u606f\u60c5\u51b5\n        propsMap.put(ConsumerConfig.GROUP_ID_CONFIG, "defaultGroup");\n        // \u662f\u5426\u81ea\u52a8\u63d0\u4ea4offset\u504f\u79fb\u91cf(\u9ed8\u8ba4true)\n        propsMap.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, true);\n        // \u81ea\u52a8\u63d0\u4ea4\u7684\u9891\u7387(ms)\n        propsMap.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, "100");\n        // Session\u8d85\u65f6\u8bbe\u7f6e\n        propsMap.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, "15000");\n        // \u952e\u7684\u53cd\u5e8f\u5217\u5316\u65b9\u5f0f\n        propsMap.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n        // \u503c\u7684\u53cd\u5e8f\u5217\u5316\u65b9\u5f0f\n        propsMap.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n        // offset\u504f\u79fb\u91cf\u89c4\u5219\u8bbe\u7f6e\uff1a\n        // (1)\u3001earliest\uff1a\u5f53\u5404\u5206\u533a\u4e0b\u6709\u5df2\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4ece\u63d0\u4ea4\u7684offset\u5f00\u59cb\u6d88\u8d39\uff1b\u65e0\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4ece\u5934\u5f00\u59cb\u6d88\u8d39\n        // (2)\u3001latest\uff1a\u5f53\u5404\u5206\u533a\u4e0b\u6709\u5df2\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4ece\u63d0\u4ea4\u7684offset\u5f00\u59cb\u6d88\u8d39\uff1b\u65e0\u63d0\u4ea4\u7684offset\u65f6\uff0c\u6d88\u8d39\u65b0\u4ea7\u751f\u7684\u8be5\u5206\u533a\u4e0b\u7684\u6570\u636e\n        // (3)\u3001none\uff1atopic\u5404\u5206\u533a\u90fd\u5b58\u5728\u5df2\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4eceoffset\u540e\u5f00\u59cb\u6d88\u8d39\uff1b\u53ea\u8981\u6709\u4e00\u4e2a\u5206\u533a\u4e0d\u5b58\u5728\u5df2\u63d0\u4ea4\u7684offset\uff0c\u5219\u629b\u51fa\u5f02\u5e38\n        propsMap.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");\n        return propsMap;\n    }\n}\n\n')),(0,r.kt)("h4",{id:"\u76d1\u542c\u6d88\u8d39"},"\u76d1\u542c\u6d88\u8d39"),(0,r.kt)("h5",{id:"kafkalistener\u57fa\u672c\u4f7f\u7528"},"@kafkaListener\u57fa\u672c\u4f7f\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// \u76d1\u542c \u65b9\u5f0f 1:, \u901a\u8fc7\u6ce8\u89e3\n@Component\npublic class KafkaConsumerListener {\n\n   @KafkaListener(topics = {"test"},groupId = "group1", containerFactory="kafkaListenerContainerFactory")\n   public void kafkaListener(String message, @Header(KafkaHeaders.RECEIVED_PARTITION_ID) int partition){\n       System.out.println(message);\n   }\n\n   @KafkaListener(id = "webGroup1", topics = "hello")\n    public void onMessage(ConsumerRecord<Object, Object> record, Acknowledgment ack,\n            @Header(KafkaHeaders.RECEIVED_TOPIC) String topic) {\n        System.out.println("\u5355\u6761\u6d88\u8d39\u6d88\u606f\uff1a" + record.topic() + "----" + record.partition() + "----" + record.value());\n        ack.acknowledge();\n    }\n    \n    \n    @KafkaListener(id = "webGroup2", topics = "hello")\n    public void onMessageButch(List<ConsumerRecord<?, ?>> records, Acknowledgment ack) {\n        for(ConsumerRecord<?, ?> record:records) {\n            System.out.println("\u6279\u91cf\u6d88\u8d39\u6d88\u606f\uff1a" + record.topic() + "----" + record.partition() + "----" + record.value());\n        }\n        ack.acknowledge();\n    }\n\n}\n\n\n// \u76d1\u542c\u65b9\u5f0f 2:\n /**\n     * \u521b\u5efa KafkaMessageListenerContainer \u5b9e\u4f8b\u76d1\u542c kafka \u6d88\u606f\n     */\n    @Bean\n    public KafkaMessageListenerContainer demoListenerContainer() {\n        // \u521b\u5efacontainer\u914d\u7f6e\u53c2\u6570\uff0c\u5e76\u6307\u5b9a\u8981\u76d1\u542c\u7684 topic \u540d\u79f0\n        ContainerProperties properties = new ContainerProperties("test");\n        // \u8bbe\u7f6e\u6d88\u8d39\u8005\u7ec4\u540d\u79f0\n        properties.setGroupId("group2");\n        // \u8bbe\u7f6e\u76d1\u542c\u5668\u76d1\u542c kafka \u6d88\u606f\n        properties.setMessageListener(new MessageListener<Integer,String>() {\n            @Override\n            public void onMessage(ConsumerRecord<Integer, String> record) {\n                System.out.println("\u6d88\u606f\uff1a" + record);\n            }\n        });\n        return new KafkaMessageListenerContainer(consumerFactory(), properties);\n    }\n\n')),(0,r.kt)("h5",{id:"\u6d88\u8d39\u6307\u5b9a\u5206\u533a"},"\u6d88\u8d39\u6307\u5b9a\u5206\u533a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@KafkaListener(\n  topicPartitions = @TopicPartition(\n    topic = "topicName",\n    partitionOffsets = {\n      @PartitionOffset(partition = "0", initialOffset = "0"), // msgs will be re-consuming every time this listener is initialized\n      @PartitionOffset(partition = "3", initialOffset = "0")\n    }\n  ),\n  containerFactory = "partitionsKafkaListenerContainerFactory")\npublic void listenToPartition(\n  @Payload String message, \n  @Header(KafkaHeaders.RECEIVED_PARTITION_ID) int partition) {\n      System.out.println(\n        "Received Message: " + message+ "from partition: " + partition);\n}\n\n\n// \u82e5\u4e0d\u9700\u8981\u6307\u5b9a offset\n@KafkaListener(topicPartitions \n  = @TopicPartition(topic = "topicName", partitions = { "0", "1" }))\n')),(0,r.kt)("h5",{id:"\u52a8\u6001\u5f00\u542f\u5173\u95ed\u76d1\u542c"},"\u52a8\u6001\u5f00\u542f\u5173\u95ed\u76d1\u542c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'/*\n\u542f\u52a8\u9879\u76ee\uff0c\u8c03\u7528 /test \u63a5\u53e3\u53d1\u9001\u4e00\u6761\u6d88\u606f\uff0c\u76d1\u542c\u5668\u6210\u529f\u63a5\u6536\u5230\u6d88\u606f\u3002\n\n\u8c03\u7528 /stop \u63a5\u53e3\u5173\u95ed\u76d1\u542c\uff0c\u518d\u6b21\u53d1\u9001\u4e00\u6761\u6d88\u606f\uff0c\u76d1\u542c\u5668\u4e0d\u4f1a\u6536\u5230\u6d88\u606f\u3002\n\n\u8c03\u7528 /start \u63a5\u53e3\u5f00\u542f\u76d1\u542c\uff0c\u76d1\u542c\u5668\u6536\u5230\u4e4b\u524d\u53d1\u9001\u7684\u6d88\u606f\u3002\n\n\u7531\u4e8e\u76d1\u542c\u5df2\u7ecf\u5f00\u542f\uff0c\u518d\u6b21\u53d1\u9001\u4e00\u6761\u6d88\u606f\uff0c\u76d1\u542c\u5668\u6210\u529f\u63a5\u6536\u5230\u6d88\u606f\u3002\n*/\n@RestController\npublic class KafkaProducer {\n \n    @Autowired\n    private KafkaListenerEndpointRegistry registry;\n \n    @Autowired\n    private KafkaTemplate<String, Object> kafkaTemplate;\n \n    // \u53d1\u9001\u6d88\u606f\n    @GetMapping("/test")\n    public void test() {\n        System.out.println("\u76d1\u542c\u5668\u53d1\u9001\u6d88\u606f!");\n        kafkaTemplate.send("topic1", "1\u6761\u6d4b\u8bd5\u6d88\u606f");\n    }\n \n    // \u5f00\u542f\u76d1\u542c\n    @GetMapping("/start")\n    public void start() {\n        System.out.println("\u5f00\u542f\u76d1\u542c");\n        //\u5224\u65ad\u76d1\u542c\u5bb9\u5668\u662f\u5426\u542f\u52a8\uff0c\u672a\u542f\u52a8\u5219\u5c06\u5176\u542f\u52a8\n        if (!registry.getListenerContainer("myListener1").isRunning()) {\n            registry.getListenerContainer("myListener1").start();\n        }\n        registry.getListenerContainer("myListener1").resume();\n    }\n \n    // \u5173\u95ed\u76d1\u542c\n    @GetMapping("/stop")\n    public void stop() {\n        System.out.println("\u5173\u95ed\u76d1\u542c");\n        //\u5224\u65ad\u76d1\u542c\u5bb9\u5668\u662f\u5426\u542f\u52a8\uff0c\u672a\u542f\u52a8\u5219\u5c06\u5176\u542f\u52a8\n        registry.getListenerContainer("myListener1").pause();\n    }\n}\n\n')),(0,r.kt)("h5",{id:"\u7981\u7528\u81ea\u542f\u52a8"},"\u7981\u7528\u81ea\u542f\u52a8"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'\n// \u7981\u6b62\u76d1\u542c\u5668\u81ea\u542f\u52a8\n@Configuration\npublic class KafkaInitialConfiguration {\n \n    // \u76d1\u542c\u5668\u5de5\u5382\n    @Autowired\n    private ConsumerFactory consumerFactory;\n \n    // \u76d1\u542c\u5668\u5bb9\u5668\u5de5\u5382(\u8bbe\u7f6e\u7981\u6b62KafkaListener\u81ea\u542f\u52a8)\n    @Bean\n    public ConcurrentKafkaListenerContainerFactory delayContainerFactory() {\n        ConcurrentKafkaListenerContainerFactory container =\n                new ConcurrentKafkaListenerContainerFactory();\n        container.setConsumerFactory(consumerFactory);\n        //\u7981\u6b62\u81ea\u52a8\u542f\u52a8\n        container.setAutoStartup(false);\n        return container;\n    }\n}\n//\u7136\u540e\u5c06\u8fd9\u4e2a\u5bb9\u5668\u5de5\u5382\u7684 BeanName \u653e\u5230 @KafkaListener \u6ce8\u89e3\u7684 containerFactory \u5c5e\u6027\u91cc\u9762\u3002\u8fd9\u6837\u8be5\u76d1\u542c\u5668\u5c31\u4e0d\u4f1a\u81ea\u52a8\u542f\u52a8\u4e86 \n@Component\npublic class KafkaConsumer {\n    // \u6d88\u8d39\u76d1\u542c\n    @KafkaListener(id = "myListener1", topics = {"topic1"},\n            containerFactory = "delayContainerFactory")\n    public void listen1(String data) {\n        System.out.println("\u76d1\u542c\u5668\u6536\u5230\u6d88\u606f\uff1a" + data);\n    }\n}\n\n')),(0,r.kt)("h5",{id:"\u5b9a\u65f6\u542f\u505c\u76d1\u542c\u5668"},"\u5b9a\u65f6\u542f\u505c\u76d1\u542c\u5668"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// \u573a\u666f: \u9879\u76ee\u9700\u8981\u5229\u7528 Kafka \u505a\u6570\u636e\u6301\u4e45\u5316\u7684\u529f\u80fd\uff0c\u7531\u4e8e\u7528\u6237\u6d3b\u8dc3\u7684\u65f6\u95f4\u4e3a\u65e9\u4e0a 10 \u70b9\u81f3\u665a\u4e0a 12 \u70b9, \u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u5728\u7528\u6237\u6d3b\u8dc3\u5ea6\u4f4e\u7684\u65f6\u95f4\u6bb5\u53bb\u505a\u6301\u4e45\u5316\u7684\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u665a\u4e0a 12 \u70b9\u540e\u5230\u7b2c\u4e8c\u6761\u7684\u65e9\u4e0a 10 \u70b9\u524d\n\n@SpringBootApplication\n@EnableScheduling // \u5f00\u542f\u5b9a\u65f6\u4efb\u52a1\npublic class KtestApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(KtestApplication.class, args);\n    }\n}\n\n@Component\npublic class MyKafkaSchedule {\n    @Autowired\n    private KafkaListenerEndpointRegistry registry;\n \n    //\u5b9a\u65f6\u5668\uff0c\u6bcf\u5929\u51cc\u66680\u70b9\u5f00\u542f\u76d1\u542c\n    @Scheduled(cron = "0 0 0 * * ?")\n    public void startListener() {\n        System.out.println("\u5f00\u542f\u76d1\u542c");\n        //\u5224\u65ad\u76d1\u542c\u5bb9\u5668\u662f\u5426\u542f\u52a8\uff0c\u672a\u542f\u52a8\u5219\u5c06\u5176\u542f\u52a8\n        if (!registry.getListenerContainer("myListener1").isRunning()) {\n            registry.getListenerContainer("myListener1").start();\n        }\n        registry.getListenerContainer("myListener1").resume();\n\n        // ... \u6301\u4e45\u5316\u64cd\u4f5c\n\n    }\n \n    //\u5b9a\u65f6\u5668\uff0c\u6bcf\u5929\u65e9\u4e0a10\u70b9\u5173\u95ed\u76d1\u542c\n    @Scheduled(cron = "0 0 10 * * ?")\n    public void shutDownListener() {\n\n        // ... \u505c\u6b62\u6301\u4e45\u5316\n\n        System.out.println("\u5173\u95ed\u76d1\u542c");\n        registry.getListenerContainer("myListener1").pause();\n    }\n}\n')),(0,r.kt)("h4",{id:"\u901a\u8fc7\u6d88\u8d39\u8005\u6d88\u8d39"},"\u901a\u8fc7\u6d88\u8d39\u8005\u6d88\u8d39"),(0,r.kt)("h4",{id:"\u6d88\u8d39\u8005\u9519\u8bef\u5904\u7406-\u5355\u6d88\u606f-\u6279\u91cf\u6d88\u606f"},"\u6d88\u8d39\u8005\u9519\u8bef\u5904\u7406 \u5355\u6d88\u606f \u6279\u91cf\u6d88\u606f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * \u5355\u6d88\u606f\u6d88\u8d39\u5f02\u5e38\u5904\u7406\u5668\n */\n@Service\npublic class ConsumerService {\n\n    private static final Logger log = LoggerFactory.getLogger(ConsumerService.class);\n\n    /**\n     * \u6d88\u606f\u76d1\u542c\u5668\n     * errorHandler \u4e0d\u6307\u5b9alistenErrorHandler\u7684\u60c5\u51b5\uff0c\u4f7f\u7528\u5168\u5c40\u5f02\u5e38\n     */\n    @KafkaListener( topics = {"test"},groupId = "group21",errorHandler = "listenErrorHandler")\n    public void listen(String message) {\n        log.info(message);\n        // \u521b\u5efa\u5f02\u5e38\uff0c\u89e6\u53d1\u5f02\u5e38\u5904\u7406\u5668\n        throw new NullPointerException("\u6d4b\u8bd5\u9519\u8bef\u5904\u7406\u5668");\n    }\n\n    /**\n     * \u5f02\u5e38\u5904\u7406\u5668\n     */\n    @Bean\n    public ConsumerAwareListenerErrorHandler listenErrorHandler() {\n        return new ConsumerAwareListenerErrorHandler() {\n\n            @Override\n            public Object handleError(Message<?> message,\n                                      ListenerExecutionFailedException e,\n                                      Consumer<?, ?> consumer) {\n                log.info("message:" + message.getPayload());\n                log.info("exception:" + e.getMessage());\n                return null;\n            }\n        };\n    }\n}\n\n\n\n/**\n *  \u6279\u91cf\u6d88\u8d39\u5f02\u5e38\u5904\u7406\u5668\n */\n@Service\npublic class ConsumerBatchService {\n\n    private static final Logger log = LoggerFactory.getLogger(ConsumerBatchService.class);\n    /**\n     * \u6d88\u606f\u76d1\u542c\u5668\n     */\n    @KafkaListener( topics = {"test"},groupId = "group20",errorHandler = "listenErrorHandler")\n    public void listen(List<String> messages) {\n        for(String msg:messages){\n            System.out.println(msg);\n        }\n        // \u521b\u5efa\u5f02\u5e38\uff0c\u89e6\u53d1\u5f02\u5e38\u5904\u7406\u5668\n        throw new NullPointerException("\u6d4b\u8bd5\u9519\u8bef\u5904\u7406\u5668");\n    }\n\n\n    /**\n     * \u5f02\u5e38\u5904\u7406\u5668\n     */\n    @Bean\n    public ConsumerAwareListenerErrorHandler listenErrorHandler() {\n        return new ConsumerAwareListenerErrorHandler() {\n            @Override\n            public Object handleError(Message<?> message, ListenerExecutionFailedException e, Consumer<?, ?> consumer) {\n                log.info("consumerAwareErrorHandler receive : "+message.getPayload().toString());\n                MessageHeaders headers = message.getHeaders();\n                List<String> topics = headers.get(KafkaHeaders.RECEIVED_TOPIC, List.class);\n                List<Integer> partitions = headers.get(KafkaHeaders.RECEIVED_PARTITION_ID, List.class);\n                List<Long> offsets = headers.get(KafkaHeaders.OFFSET, List.class);\n                Map<TopicPartition, Long> offsetsToReset = new HashMap<>();\n                return null;\n            }\n        };\n    }\n}\n\n\n')),(0,r.kt)("h4",{id:"offset-\u63d0\u4ea4"},"offset \u63d0\u4ea4"),(0,r.kt)("p",null,"\u5728kafka\u7684\u6d88\u8d39\u8005\u4e2d\u6709\u4e00\u4e2a\u975e\u5e38\u5173\u952e\u7684\u673a\u5236\uff0c\u90a3\u5c31\u662f offset \u673a\u5236\u3002\u5b83\u4f7f\u5f97 Kafka \u5728\u6d88\u8d39\u7684\u8fc7\u7a0b\u4e2d\u5373\u4f7f\u6302\u4e86\u6216\u8005\u5f15\u53d1\u518d\u5747\u8861\u95ee\u9898\u91cd\u65b0\u5206\u914d Partation\uff0c\u5f53\u4e0b\u6b21\u91cd\u65b0\u6062\u590d\u6d88\u8d39\u65f6\u4ecd\u7136\u53ef\u4ee5\u77e5\u9053\u4ece\u54ea\u91cc\u5f00\u59cb\u6d88\u8d39\u3002"),(0,r.kt)("p",null,"Kafka\u4e2d\u504f\u79fb\u91cf\u7684\u81ea\u52a8\u63d0\u4ea4\u662f\u7531\u53c2\u6570 enable_auto_commit \u548c auto_commit_interval_ms \u63a7\u5236\u7684\uff0c\u5f53 enable_auto_commit=true \u65f6\uff0cKafka\u5728\u6d88\u8d39\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u4ee5\u9891\u7387\u4e3a auto_commit_interval_ms \u5411 Kafka \u81ea\u5e26\u7684 topic(__consumer_offsets) \u8fdb\u884c\u504f\u79fb\u91cf\u63d0\u4ea4"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// \u81ea\u52a8\u63d0\u4ea4\nauto.commit.enable=true\uff1a\u662f\u5426\u5c06offset\u7ef4\u62a4\u4ea4\u7ed9kafka\u8fdb\u884c\u7ef4\u62a4\uff08\u8001\u7248\u672c\u4e2d\u63d0\u4ea4\u5230zookeeper\u4e2d\u7ef4\u62a4\uff09\uff0c\u8bbe\u7f6e\u4e3atrue\u3002\nauto.commit.interval.ms=10000\uff1a\u81ea\u52a8\u63d0\u4ea4\u65f6\u95f4\u95f4\u9694\u3002\n\n// \u624b\u52a8\u63d0\u4ea4\nauto.commit.enable=false\uff1a\u662f\u5426\u5c06offset\u7ef4\u62a4\u4ea4\u7ed9kafka\u8fdb\u884c\u7ef4\u62a4\uff08\u8001\u7248\u672c\u4e2d\u63d0\u4ea4\u5230zookeeper\u4e2d\u7ef4\u62a4\uff09\uff0c\u8bbe\u7f6e\u4e3afalse\u3002\n\u7136\u540e\u9700\u8981\u5728\u7a0b\u5e8f\u4e2d\u8bbe\u7f6eack\u6a21\u5f0f,\u4ece\u800c\u8fdb\u884c\u624b\u52a8\u63d0\u4ea4\u7ef4\u62a4offset\u3002\n@Bean\nKafkaListenerContainerFactory<ConcurrentMessageListenerContainer<Integer, String>> kafkaListenerContainerFactory() {\n    ConcurrentKafkaListenerContainerFactory<Integer, String> factory = new ConcurrentKafkaListenerContainerFactory<>();\n    factory.setConsumerFactory(consumerFactory());\n    factory.setConcurrency(3);\n    factory.getContainerProperties().setPollTimeout(3000);\n    // \u8bbe\u7f6eACK\u6a21\u5f0f(\u624b\u52a8\u63d0\u4ea4\u6a21\u5f0f\uff0c\u8fd9\u91cc\u6709\u4e03\u79cd)\n    /*\n    RECORD\uff1a \u6bcf\u5904\u7406\u5b8c\u4e00\u6761\u8bb0\u5f55\u540e\u63d0\u4ea4\u3002\n    BATCH(\u9ed8\u8ba4)\uff1a \u6bcf\u6b21poll\u4e00\u6279\u6570\u636e\u540e\u63d0\u4ea4\u4e00\u6b21\uff0c\u9891\u7387\u53d6\u51b3\u4e8e\u6bcf\u6b21poll\u7684\u8c03\u7528\u9891\u7387\u3002\n    TIME\uff1a \u6bcf\u6b21\u95f4\u9694ackTime\u7684\u65f6\u95f4\u63d0\u4ea4\u3002\n    COUNT\uff1a \u5904\u7406\u5b8cpoll\u7684\u4e00\u6279\u6570\u636e\u540e\u5e76\u4e14\u8ddd\u79bb\u4e0a\u6b21\u63d0\u4ea4\u5904\u7406\u7684\u8bb0\u5f55\u6570\u8d85\u8fc7\u4e86\u8bbe\u7f6e\u7684ackCount\u5c31\u63d0\u4ea4\u3002\n    COUNT_TIME\uff1a TIME\u548cCOUNT\u4e2d\u4efb\u610f\u4e00\u6761\u6ee1\u8db3\u5373\u63d0\u4ea4\u3002\n    MANUAL\uff1a \u624b\u52a8\u8c03\u7528Acknowledgment.acknowledge()\u540e\uff0c\u5e76\u4e14\u5904\u7406\u5b8cpoll\u7684\u8fd9\u6279\u6570\u636e\u540e\u63d0\u4ea4\u3002\n    MANUAL_IMMEDIATE\uff1a \u624b\u52a8\u8c03\u7528Acknowledgment.acknowledge()\u540e\u7acb\u5373\u63d0\u4ea4\n    \n    */\n    // \u4e0d\u914d\u7f6e\u4f1a error\n    factory.getContainerProperties().setAckMode(ContainerProperties.AckMode.MANUAL_IMMEDIATE);\n    return factory;\n}\n\n// \u624b\u52a8\u63d0\u4ea4\n @KafkaListener(id = "webGroup1", topics = "hello")\n    public void onMessage(ConsumerRecord<Object, Object> record, Acknowledgment ack,\n            @Header(KafkaHeaders.RECEIVED_TOPIC) String topic) {\n        System.out.println("\u5355\u6761\u6d88\u8d39\u6d88\u606f\uff1a" + record.topic() + "----" + record.partition() + "----" + record.value());\n        ack.acknowledge();\n    }\n\n')),(0,r.kt)("h4",{id:"\u6d88\u606f\u5e8f\u5217\u5316"},"\u6d88\u606f\u5e8f\u5217\u5316"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// producer\n\n@Bean\npublic ProducerFactory<String, Greeting> greetingProducerFactory() {\n    // ...\n    configProps.put(\n      ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, \n      JsonSerializer.class);\n    return new DefaultKafkaProducerFactory<>(configProps);\n}\n\n@Bean\npublic KafkaTemplate<String, Greeting> greetingKafkaTemplate() {\n    return new KafkaTemplate<>(greetingProducerFactory());\n}\n\n\n// consumer\n\n@Bean\npublic ConsumerFactory<String, Greeting> greetingConsumerFactory() {\n    // ...\n    return new DefaultKafkaConsumerFactory<>(\n      props,\n      new StringDeserializer(), \n      new JsonDeserializer<>(Greeting.class));\n}\n\n@Bean\npublic ConcurrentKafkaListenerContainerFactory<String, Greeting> \n  greetingKafkaListenerContainerFactory() {\n\n    ConcurrentKafkaListenerContainerFactory<String, Greeting> factory =\n      new ConcurrentKafkaListenerContainerFactory<>();\n    factory.setConsumerFactory(greetingConsumerFactory());\n    return factory;\n}\n\n@KafkaListener(\n  topics = "topicName", \n  containerFactory = "greetingKafkaListenerContainerFactory")\npublic void greetingListener(Greeting greeting) {\n    // process greeting message\n}\n')),(0,r.kt)("h4",{id:"\u81ea\u5b9a\u4e49\u4ee3\u66ff\u9ed8\u8ba4\u7ebf\u7a0b\u6c60"},"\u81ea\u5b9a\u4e49\u4ee3\u66ff\u9ed8\u8ba4\u7ebf\u7a0b\u6c60"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.jianshu.com/p/cf367a8c6d67"},"https://www.jianshu.com/p/cf367a8c6d67")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class CustomConcurrentKafkaListenerContainerFactory<K,V> extends ConcurrentKafkaListenerContainerFactory<K,V> {\n\n    /**\n     * The executor for threads that poll the consumer.\n     */\n    private AsyncListenableTaskExecutor consumerTaskExecutor;\n\n    /**\n     * The executor for threads that invoke the listener.\n     */\n    private AsyncListenableTaskExecutor listenerTaskExecutor;\n\n    public CustomConcurrentKafkaListenerContainerFactory(AsyncListenableTaskExecutor consumerTaskExecutor, AsyncListenableTaskExecutor listenerTaskExecutor) {\n        this.consumerTaskExecutor = consumerTaskExecutor;\n        this.listenerTaskExecutor = listenerTaskExecutor;\n    }\n\n    @Override\n    protected void initializeContainer(ConcurrentMessageListenerContainer<K, V> instance) {\n        super.initializeContainer(instance);\n        instance.getContainerProperties().setConsumerTaskExecutor(consumerTaskExecutor);\n        instance.getContainerProperties().setListenerTaskExecutor(listenerTaskExecutor);\n    }\n}\n\n\n@Configuration\n@AutoConfigureBefore(KafkaAutoConfiguration.class)\npublic class KafkaExecutorConfig {\n\n    @Bean(name = "consumerTaskExecutor")\n    public ThreadPoolTaskExecutor consumerTaskExecutor(){\n        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();\n        executor.setCorePoolSize(Runtime.getRuntime().availableProcessors());\n        executor.setMaxPoolSize(5);\n        executor.setQueueCapacity(100);\n        executor.setThreadNamePrefix("my-C-");\n        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());\n        executor.setWaitForTasksToCompleteOnShutdown(true);\n        executor.initialize();\n        return executor;\n    }\n\n    @Bean(name = "listenerTaskExecutor")\n    public ThreadPoolTaskExecutor listenerTaskExecutor(){\n        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();\n        executor.setCorePoolSize(5);\n        executor.setMaxPoolSize(10);\n        executor.setQueueCapacity(100);\n        executor.setThreadNamePrefix("my-L-");\n        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());\n        executor.setWaitForTasksToCompleteOnShutdown(true);\n        executor.initialize();\n        return executor;\n    }\n\n    @Bean("kafkaListenerContainerFactory")\n    public ConcurrentKafkaListenerContainerFactory<?, ?> kafkaListenerContainerFactory(\n            ConcurrentKafkaListenerContainerFactoryConfigurer configurer,\n            ConsumerFactory<Object, Object> kafkaConsumerFactory) {\n        ConcurrentKafkaListenerContainerFactory<Object, Object> factory = new CustomConcurrentKafkaListenerContainerFactory<Object, Object>(consumerTaskExecutor(),listenerTaskExecutor());\n        configurer.configure(factory, kafkaConsumerFactory);\n        return factory;\n    }\n}\n\n\n\n')),(0,r.kt)("h4",{id:"\u6d88\u8d39\u8005\u7ec4-\u591a\u7ebf\u7a0b\u6d88\u8d39"},"\u6d88\u8d39\u8005\u7ec4 \u591a\u7ebf\u7a0b\u6d88\u8d39"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.modb.pro/db/51256"},"https://www.modb.pro/db/51256")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// \u65b9\u6848\u4e00: \u591a\u7ebf\u7a0b+\u591a consumer \u5b9e\u4f8b\n\npublic class KafkaConsumerRunner implements Runnable {\n  private final AtomicBoolean closed = new AtomicBoolean(false);\n  private final KafkaConsumer consumer;\n\n  public void run() {\n    try{\n      consumer.subscribe(Arrays.asList("topic"));\n      while(!closed.get()){\n        ConsumerRecords records = consumer.poll(Duration.ofMillis(10000));\n      }\n    }catch (WakeupException e){\n      if (!closed.get()) throw e;\n    }finally {\n      consumer.close();\n    }\n  }\n\n  public void shutdown() {\n    closed.set(true);\n    consumer.wakeup();\n  }\n}\n\n\n\n\n// \u65b9\u6848\u4e8c: \u5355\u7ebf\u7a0b+\u5355 consumer \u5b9e\u4f8b + worker \u7ebf\u7a0b\u6c60\nprivate final KafkaConsumer<String, String> consumer;\nprivate ExecutorService executors;\n...\n\nprivate int workerNum = ...;\nexecutors = new ThreadPoolExecutor(\n            workerNum, workerNum, 0L, TimeUnit.MILLISECONDS,\n            new ArrayBlockingQueue<>(1000),\n            new ThreadPoolExecutor.CallerRunsPolicy());\n\n...\nwhile (true) {\n  ConsumerRecords<String, String> records = consumer.poll(Duration.ofSeconds(1));\n  for (final ConsumerRecord record : records) {\n    executors.submit(new Worker(record));\n  }\n}\n\n')),(0,r.kt)("h4",{id:"\u6d88\u606f\u8f6c\u53d1"},"\u6d88\u606f\u8f6c\u53d1"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class KafkaConsumer {\n    // \u6d88\u8d39\u76d1\u542c\n    @KafkaListener(topics = {"topic1"})\n    @SendTo("topic2")\n    public String listen1(String data) {\n        System.out.println("\u4e1a\u52a1A\u6536\u5230\u6d88\u606f\uff1a" + data);\n        return data + "(\u5df2\u5904\u7406)";\n    }\n \n    // \u6d88\u8d39\u76d1\u542c\n    @KafkaListener(topics = {"topic2"})\n    public void listen2(String data) {\n        System.out.println("\u4e1a\u52a1B\u6536\u5230\u6d88\u606f\uff1a" + data);\n    }\n}\n')),(0,r.kt)("h2",{id:"\u53c2\u6570\u8c03\u4f18"},"\u53c2\u6570\u8c03\u4f18"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/hanjibing1990/article/details/51673540"},"https://blog.csdn.net/hanjibing1990/article/details/51673540")," \u6d88\u606f\u4f53\u5927\u5c0f"),(0,r.kt)("h1",{id:"\u5373\u65f6\u901a\u8baf-mqtt\u534f\u8bae"},"\u5373\u65f6\u901a\u8baf MQTT\u534f\u8bae"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.jianshu.com/p/e132261456b5"},"https://www.jianshu.com/p/e132261456b5"),"\nTODO"))}k.isMDXComponent=!0}}]);